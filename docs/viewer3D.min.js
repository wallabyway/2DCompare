// LMV v6.1.0
//
// Copyright 2018 Autodesk, Inc.
// All rights reserved.
// 
// This computer source code and related instructions and comments are the
// unpublished confidential and proprietary information of Autodesk, Inc.
// and are protected under Federal copyright and state trade secret law.
// They may not be disclosed to, copied or used by any third party without
// the prior written consent of Autodesk, Inc.
// 
// Autodesk Forge Viewer Usage Limitations:
// 
// The Autodesk Forge viewer can only be used to view files generated by
// Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
// delivered from an Autodesk hosted URL.
var LMV=function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(b,c){for(var d in b)b.hasOwnProperty(d)&&(a.exports[d]=b[d],c&&(a.exports[c][d]=b[d]))}a.exports.Autodesk=c(1).Autodesk;var e=Object.assign||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};(a.exports.THREE=c(2),a.exports.av={},a.exports.avp={},(0,c(4).isNodeJS)())||d({Hammer:c(5)},"av");d(c(4),"av"),d(c(4),"avp"),d(c(6),"avp"),d(c(6),"av"),d(c(7),"avp"),d(c(7),"av"),d(c(34),"avp"),d(c(35),"av"),d(c(36),"avp"),d(c(8),"avp"),d(c(37),"avp"),d(c(38),"avp"),d(c(50),"avp"),d(c(56),"avp"),d(c(57),"avp"),d(c(92),"avp"),d(c(95),"avp"),d(c(58),"avp"),d(c(97),"avp"),d(c(99),"avp"),d(c(96),"avp"),d(c(40),"avp"),d(c(100),"avp"),d(c(101),"avp"),d(c(104),"avp"),d(c(109),"avp"),d(c(111),"avp"),d(c(148),"avp"),d(c(178),"avp"),d(c(179),"avp"),d(c(49),"avp"),d(c(115),"avp"),d(c(121),"avp"),d(c(138),"avp"),d(c(119),"avp"),d(c(128),"avp"),d(c(122),"avp"),d(c(118),"avp"),d(c(181),"avp"),d(c(182),"avp"),d(c(117),"avp"),d(c(113),"avp"),d(c(116),"avp"),d(c(129),"avp"),d(c(131),"avp"),d(c(123),"avp"),d(c(130),"avp"),d(c(133),"avp"),d(c(125),"avp"),d(c(124),"avp"),d(c(183),"avp"),d(c(136),"avp"),d(c(112),"avp"),d(c(120),"avp"),d(c(114),"avp"),d(c(135),"avp"),d(c(134),"avp"),d(c(184),"avp"),d(c(187),"av"),d(c(188),"avp"),d(c(189),"avp"),d(c(190),"avp"),d(c(191),"avp"),d(c(127),"avp"),d(c(192),"avp"),d(c(193),"avp"),d(c(13),"av"),d(c(9),"av"),d(c(12),"avp"),d(c(32),"avp"),d(c(195),"avp"),d(c(140),"avp"),d(c(199),"av"),d(c(200),"av"),d(c(33),"av"),d(c(201),"av"),d(c(202),"av"),d(c(203),"av"),d(c(198),"av"),d(c(204),"av"),d(c(197),"avp"),d(c(205),"avp"),d(c(206),"avp"),d(c(207),"av"),d(c(208),"av"),d(c(211),"avp"),d(c(212),"av"),d(c(225),"avp"),d(c(196),"avp"),d(c(233),"av"),d(c(234),"av"),d(c(232),"av"),d(c(235),"avp"),d(c(236),"avp");var f=a.exports.av.MeasureCommon={};e(f,c(237)),f.MeasurementTypes=c(239).MeasurementTypes,f.SnapType=c(238).SnapType,f.Events=c(240).MeasureEvents,f.Measurement=c(241).Measurement,f.SnapResult=c(242).SnapResult,f.Snapper=c(243).Snapper,d(c(230),"avp"),d(c(229),"avp"),d(c(215),"av"),d(c(231),"av"),d(c(226),"avp"),d(c(227),"avp"),d(c(214),"av"),d(c(216),"av"),d(c(213),"av"),d(c(218),"av"),d(c(217),"av"),d(c(219),"av"),d(c(245),"av"),d(c(221),"av"),d(c(246),"av"),d(c(247),"av"),d(c(248),"av"),d(c(224),"av"),d(c(223),"avp"),d(c(249),"avp"),d(c(222),"avp"),d(c(250),"avp"),d(c(252),"avp"),d(c(209),"avp"),d(c(220),"avp"),d(c(139),"avp"),d(c(254),"avp"),d(c(255),"avp"),d(c(228),"avp"),d(c(260),"avp"),d(c(10),"avp"),d(c(210),"av"),d(c(261),"av"),d(c(262),"avp"),d(c(253),"avp"),c(263).initializeLegacyNamespaces(a.exports)},function(a,b){(function(b){"use strict";function c(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:b}function d(a){for(var b=c(),d=a.split("."),e=0;e<d.length;++e)b[d[e]]=b[d[e]]||{},b=b[d[e]];return b}d("Autodesk.Viewing.Private"),d("Autodesk.Viewing.Extensions"),d("Autodesk.Extensions"),d("Autodesk.Viewing.Shaders"),d("Autodesk.Viewing.UI"),d("Autodesk.LMVTK"),Autodesk.Viewing.getGlobal=c,Autodesk.Viewing.AutodeskNamespace=d,c().AutodeskNamespace=d;var e=c().Autodesk.Viewing.Private;e.BUILD_LMV_WORKER_URL="lmvworker.min.js",e.LMV_WORKER_URL=e.BUILD_LMV_WORKER_URL,e.ENABLE_DEBUG=e.ENABLE_DEBUG||!1,c().ENABLE_DEBUG=e.ENABLE_DEBUG,e.ENABLE_INLINE_WORKER=!0,a.exports.Autodesk=c().Autodesk}).call(b,function(){return this}())},function(a,b,c){(function(a){"use strict";var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},c={REVISION:"71"};"object"===b(a)&&(a.exports=c),void 0===Math.sign&&(Math.sign=function(a){return a<0?-1:a>0?1:+a}),c.log=function(){console.log.apply(console,arguments)},c.warn=function(){console.warn.apply(console,arguments)},c.error=function(){console.error.apply(console,arguments)},c.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},c.CullFaceNone=0,c.CullFaceBack=1,c.CullFaceFront=2,c.CullFaceFrontBack=3,c.FrontFaceDirectionCW=0,c.FrontFaceDirectionCCW=1,c.BasicShadowMap=0,c.PCFShadowMap=1,c.PCFSoftShadowMap=2,c.FrontSide=0,c.BackSide=1,c.DoubleSide=2,c.NoShading=0,c.FlatShading=1,c.SmoothShading=2,c.NoColors=0,c.FaceColors=1,c.VertexColors=2,c.NoBlending=0,c.NormalBlending=1,c.AdditiveBlending=2,c.SubtractiveBlending=3,c.MultiplyBlending=4,c.CustomBlending=5,c.AddEquation=100,c.SubtractEquation=101,c.ReverseSubtractEquation=102,c.MinEquation=103,c.MaxEquation=104,c.ZeroFactor=200,c.OneFactor=201,c.SrcColorFactor=202,c.OneMinusSrcColorFactor=203,c.SrcAlphaFactor=204,c.OneMinusSrcAlphaFactor=205,c.DstAlphaFactor=206,c.OneMinusDstAlphaFactor=207,c.DstColorFactor=208,c.OneMinusDstColorFactor=209,c.SrcAlphaSaturateFactor=210,c.MultiplyOperation=0,c.MixOperation=1,c.AddOperation=2,c.UVMapping=300,c.CubeReflectionMapping=301,c.CubeRefractionMapping=302,c.EquirectangularReflectionMapping=303,c.EquirectangularRefractionMapping=304,c.SphericalReflectionMapping=305,c.RepeatWrapping=1e3,c.ClampToEdgeWrapping=1001,c.MirroredRepeatWrapping=1002,c.NearestFilter=1003,c.NearestMipMapNearestFilter=1004,c.NearestMipMapLinearFilter=1005,c.LinearFilter=1006,c.LinearMipMapNearestFilter=1007,c.LinearMipMapLinearFilter=1008,c.UnsignedByteType=1009,c.ByteType=1010,c.ShortType=1011,c.UnsignedShortType=1012,c.IntType=1013,c.UnsignedIntType=1014,c.FloatType=1015,c.HalfFloatType=1025,c.UnsignedShort4444Type=1016,c.UnsignedShort5551Type=1017,c.UnsignedShort565Type=1018,c.AlphaFormat=1019,c.RGBFormat=1020,c.RGBAFormat=1021,c.LuminanceFormat=1022,c.LuminanceAlphaFormat=1023,c.RGBEFormat=c.RGBAFormat,c.RGB_S3TC_DXT1_Format=2001,c.RGBA_S3TC_DXT1_Format=2002,c.RGBA_S3TC_DXT3_Format=2003,c.RGBA_S3TC_DXT5_Format=2004,c.RGB_PVRTC_4BPPV1_Format=2100,c.RGB_PVRTC_2BPPV1_Format=2101,c.RGBA_PVRTC_4BPPV1_Format=2102,c.RGBA_PVRTC_2BPPV1_Format=2103,c.Projector=function(){c.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(a,b){c.warn("THREE.Projector: .projectVector() is now vector.project()."),a.project(b)},this.unprojectVector=function(a,b){c.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),a.unproject(b)},this.pickingRay=function(a,b){c.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},c.CanvasRenderer=function(){c.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},c.Color=function(a){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(a)},c.Color.prototype={constructor:c.Color,r:1,g:1,b:1,set:function(a){return a instanceof c.Color?this.copy(a):"number"==typeof a?this.setHex(a):"string"==typeof a&&this.setStyle(a),this},setHex:function(a){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,this},setRGB:function(a,b,c){return this.r=a,this.g=b,this.b=c,this},setHSL:function(a,b,c){if(0===b)this.r=this.g=this.b=c;else{var d=function(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+6*(b-a)*(2/3-c):a},e=c<=.5?c*(1+b):c+b-c*b,f=2*c-e;this.r=d(f,e,a+1/3),this.g=d(f,e,a),this.b=d(f,e,a-1/3)}return this},setStyle:function(a){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a)){var b=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a);return this.r=Math.min(255,parseInt(b[1],10))/255,this.g=Math.min(255,parseInt(b[2],10))/255,this.b=Math.min(255,parseInt(b[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(a)){var b=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(a);return this.r=Math.min(100,parseInt(b[1],10))/100,this.g=Math.min(100,parseInt(b[2],10))/100,this.b=Math.min(100,parseInt(b[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(a)){var b=/^\#([0-9a-f]{6})$/i.exec(a);return this.setHex(parseInt(b[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a)){var b=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a);return this.setHex(parseInt(b[1]+b[1]+b[2]+b[2]+b[3]+b[3],16)),this}if(/^(\w+)$/i.test(a))return this.setHex(c.ColorKeywords[a]),this},copy:function(a){return this.r=a.r,this.g=a.g,this.b=a.b,this},copyGammaToLinear:function(a,b){return void 0===b&&(b=2),this.r=Math.pow(a.r,b),this.g=Math.pow(a.g,b),this.b=Math.pow(a.b,b),this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);var c=b>0?1/b:1;return this.r=Math.pow(a.r,c),this.g=Math.pow(a.g,c),this.b=Math.pow(a.b,c),this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;return this.r=a*a,this.g=b*b,this.b=c*c,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){var b,c,d=a||{h:0,s:0,l:0},e=this.r,f=this.g,g=this.b,h=Math.max(e,f,g),i=Math.min(e,f,g),j=(i+h)/2;if(i===h)b=0,c=0;else{var k=h-i;switch(c=j<=.5?k/(h+i):k/(2-h-i),h){case e:b=(f-g)/k+(f<g?6:0);break;case f:b=(g-e)/k+2;break;case g:b=(e-f)/k+4}b/=6}return d.h=b,d.s=c,d.l=j,d},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var d=this.getHSL();return d.h+=a,d.s+=b,d.l+=c,this.setHSL(d.h,d.s,d.l),this},add:function(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this},addColors:function(a,b){return this.r=a.r+b.r,this.g=a.g+b.g,this.b=a.b+b.b,this},addScalar:function(a){return this.r+=a,this.g+=a,this.b+=a,this},multiply:function(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this},multiplyScalar:function(a){return this.r*=a,this.g*=a,this.b*=a,this},lerp:function(a,b){return this.r+=(a.r-this.r)*b,this.g+=(a.g-this.g)*b,this.b+=(a.b-this.b)*b,this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a){return this.r=a[0],this.g=a[1],this.b=a[2],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.r,a[b+1]=this.g,a[b+2]=this.b,a},clone:function(){return(new c.Color).setRGB(this.r,this.g,this.b)}},c.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},c.Quaternion=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._w=void 0!==d?d:1},c.Quaternion.prototype={constructor:c.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(a){this._x=a,this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a,this.onChangeCallback()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._w=d,this.onChangeCallback(),this},copy:function(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this.onChangeCallback(),this},setFromEuler:function(a,b){if(a instanceof c.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var d=Math.cos(a._x/2),e=Math.cos(a._y/2),f=Math.cos(a._z/2),g=Math.sin(a._x/2),h=Math.sin(a._y/2),i=Math.sin(a._z/2);return"XYZ"===a.order?(this._x=g*e*f+d*h*i,this._y=d*h*f-g*e*i,this._z=d*e*i+g*h*f,this._w=d*e*f-g*h*i):"YXZ"===a.order?(this._x=g*e*f+d*h*i,this._y=d*h*f-g*e*i,this._z=d*e*i-g*h*f,this._w=d*e*f+g*h*i):"ZXY"===a.order?(this._x=g*e*f-d*h*i,this._y=d*h*f+g*e*i,this._z=d*e*i+g*h*f,this._w=d*e*f-g*h*i):"ZYX"===a.order?(this._x=g*e*f-d*h*i,this._y=d*h*f+g*e*i,this._z=d*e*i-g*h*f,this._w=d*e*f+g*h*i):"YZX"===a.order?(this._x=g*e*f+d*h*i,this._y=d*h*f+g*e*i,this._z=d*e*i-g*h*f,this._w=d*e*f-g*h*i):"XZY"===a.order&&(this._x=g*e*f-d*h*i,this._y=d*h*f-g*e*i,this._z=d*e*i+g*h*f,this._w=d*e*f+g*h*i),!1!==b&&this.onChangeCallback(),this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);return this._x=a.x*d,this._y=a.y*d,this._z=a.z*d,this._w=Math.cos(c),this.onChangeCallback(),this},setFromRotationMatrix:function(a){var b,c=a.elements,d=c[0],e=c[4],f=c[8],g=c[1],h=c[5],i=c[9],j=c[2],k=c[6],l=c[10],m=d+h+l;return m>0?(b=.5/Math.sqrt(m+1),this._w=.25/b,this._x=(k-i)*b,this._y=(f-j)*b,this._z=(g-e)*b):d>h&&d>l?(b=2*Math.sqrt(1+d-h-l),this._w=(k-i)/b,this._x=.25*b,this._y=(e+g)/b,this._z=(f+j)/b):h>l?(b=2*Math.sqrt(1+h-d-l),this._w=(f-j)/b,this._x=(e+g)/b,this._y=.25*b,this._z=(i+k)/b):(b=2*Math.sqrt(1+l-d-h),this._w=(g-e)/b,this._x=(f+j)/b,this._y=(i+k)/b,this._z=.25*b),this.onChangeCallback(),this},setFromUnitVectors:function(){var a,b;return function(d,e){return void 0===a&&(a=new c.Vector3),b=d.dot(e)+1,b<1e-6?(b=0,Math.abs(d.x)>Math.abs(d.z)?a.set(-d.y,d.x,0):a.set(0,-d.z,d.y)):a.crossVectors(d,e),this._x=a.x,this._y=a.y,this._z=a.z,this._w=b,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();return 0===a?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this.onChangeCallback(),this},multiply:function(a,b){return void 0!==b?(c.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,i=b._z,j=b._w;return this._x=c*j+f*g+d*i-e*h,this._y=d*j+f*h+e*g-c*i,this._z=e*j+f*i+c*h-d*g,this._w=f*j-c*g-d*h-e*i,this.onChangeCallback(),this},multiplyVector3:function(a){return c.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),a.applyQuaternion(this)},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;if(g<0?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a),g>=1)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=Math.acos(g),i=Math.sqrt(1-g*g);if(Math.abs(i)<.001)return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;var j=Math.sin((1-b)*h)/i,k=Math.sin(b*h)/i;return this._w=f*j+this._w*k,this._x=c*j+this._x*k,this._y=d*j+this._y*k,this._z=e*j+this._z*k,this.onChangeCallback(),this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){return void 0===b&&(b=0),this._x=a[b],this._y=a[b+1],this._z=a[b+2],this._w=a[b+3],this.onChangeCallback(),this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._w,a},onChange:function(a){return this.onChangeCallback=a,this},onChangeCallback:function(){},clone:function(){return new c.Quaternion(this._x,this._y,this._z,this._w)}},c.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)},c.Vector2=function(a,b){this.x=a||0,this.y=b||0},c.Vector2.prototype={constructor:c.Vector2,set:function(a,b){return this.x=a,this.y=b,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this},add:function(a,b){return void 0!==b?(c.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this)},addScalar:function(a){return this.x+=a,this.y+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},sub:function(a,b){return void 0!==b?(c.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this)},subScalar:function(a){return this.x-=a,this.y-=a,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiply:function(a){return this.x*=a.x,this.y*=a.y,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this},divide:function(a){return this.x/=a.x,this.y/=a.y,this},divideScalar:function(a){if(0!==a){var b=1/a;this.x*=b,this.y*=b}else this.x=0,this.y=0;return this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this},clampScalar:function(){var a,b;return function(d,e){return void 0===a&&(a=new c.Vector2,b=new c.Vector2),a.set(d,d),b.set(e,e),this.clamp(a,b)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a),this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){return void 0===b&&(b=0),this.x=a[b],this.y=a[b+1],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a},fromAttribute:function(a,b,c){return void 0===c&&(c=0),b=b*a.itemSize+c,this.x=a.array[b],this.y=a.array[b+1],this},clone:function(){return new c.Vector2(this.x,this.y)}},c.Vector3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},c.Vector3.prototype={constructor:c.Vector3,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return void 0!==b?(c.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},sub:function(a,b){return void 0!==b?(c.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this)},subScalar:function(a){return this.x-=a,this.y-=a,this.z-=a,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(a,b){return void 0!==b?(c.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b)):(this.x*=a.x,this.y*=a.y,this.z*=a.z,this)},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyEuler:function(){var a;return function(b){return b instanceof c.Euler==!1&&c.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===a&&(a=new c.Quaternion),this.applyQuaternion(a.setFromEuler(b)),this}}(),applyAxisAngle:function(){var a;return function(b,d){return void 0===a&&(a=new c.Quaternion),this.applyQuaternion(a.setFromAxisAngle(b,d)),this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this.x=i*h+l*-e+j*-g-k*-f,this.y=j*h+l*-f+k*-e-i*-g,this.z=k*h+l*-g+i*-f-j*-e,this},project:function(){var a;return function(b){return void 0===a&&(a=new c.Matrix4),a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld)),this.applyProjection(a)}}(),unproject:function(){var a;return function(b){return void 0===a&&(a=new c.Matrix4),a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix)),this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize(),this},divide:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){if(0!==a){var b=1/a;this.x*=b,this.y*=b,this.z*=b}else this.x=0,this.y=0,this.z=0;return this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this},clampScalar:function(){var a,b;return function(d,e){return void 0===a&&(a=new c.Vector3,b=new c.Vector3),a.set(d,d,d),b.set(e,e,e),this.clamp(a,b)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a),this},cross:function(a,b){if(void 0!==b)return c.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var d=this.x,e=this.y,f=this.z;return this.x=e*a.z-f*a.y,this.y=f*a.x-d*a.z,this.z=d*a.y-e*a.x,this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this},projectOnVector:function(){var a,b;return function(d){return void 0===a&&(a=new c.Vector3),a.copy(d).normalize(),b=this.dot(a),this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){return void 0===a&&(a=new c.Vector3),a.copy(this).projectOnVector(b),this.sub(a)}}(),reflect:function(){var a;return function(b){return void 0===a&&(a=new c.Vector3),this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){var b=this.dot(a)/(this.length()*a.length());return Math.acos(c.Math.clamp(b,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},setEulerFromRotationMatrix:function(a,b){c.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(a,b){c.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){return c.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){return c.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){return c.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();return this.x=b,this.y=c,this.z=d,this},setFromMatrixColumn:function(a,b){var c=4*a,d=b.elements;return this.x=d[c],this.y=d[c+1],this.z=d[c+2],this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){return void 0===b&&(b=0),this.x=a[b],this.y=a[b+1],this.z=a[b+2],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a},fromAttribute:function(a,b,c){return void 0===c&&(c=0),b=b*a.itemSize+c,this.x=a.array[b],this.y=a.array[b+1],this.z=a.array[b+2],this},clone:function(){return new c.Vector3(this.x,this.y,this.z)}},c.Vector4=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=void 0!==d?d:1},c.Vector4.prototype={constructor:c.Vector4,set:function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setW:function(a){return this.w=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=void 0!==a.w?a.w:1,this},add:function(a,b){return void 0!==b?(c.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},sub:function(a,b){return void 0!==b?(c.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this)},subScalar:function(a){return this.x-=a,this.y-=a,this.z-=a,this.w-=a,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w,f=a.elements;return this.x=f[0]*b+f[4]*c+f[8]*d+f[12]*e,this.y=f[1]*b+f[5]*c+f[9]*d+f[13]*e,this.z=f[2]*b+f[6]*c+f[10]*d+f[14]*e,this.w=f[3]*b+f[7]*c+f[11]*d+f[15]*e,this},divideScalar:function(a){if(0!==a){var b=1/a;this.x*=b,this.y*=b,this.z*=b,this.w*=b}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);return b<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b),this},setAxisAngleFromRotationMatrix:function(a){
var b,c,d,e,f=a.elements,g=f[0],h=f[4],i=f[8],j=f[1],k=f[5],l=f[9],m=f[2],n=f[6],o=f[10];if(Math.abs(h-j)<.01&&Math.abs(i-m)<.01&&Math.abs(l-n)<.01){if(Math.abs(h+j)<.1&&Math.abs(i+m)<.1&&Math.abs(l+n)<.1&&Math.abs(g+k+o-3)<.1)return this.set(1,0,0,0),this;b=Math.PI;var p=(g+1)/2,q=(k+1)/2,r=(o+1)/2,s=(h+j)/4,t=(i+m)/4,u=(l+n)/4;return p>q&&p>r?p<.01?(c=0,d=.707106781,e=.707106781):(c=Math.sqrt(p),d=s/c,e=t/c):q>r?q<.01?(c=.707106781,d=0,e=.707106781):(d=Math.sqrt(q),c=s/d,e=u/d):r<.01?(c=.707106781,d=.707106781,e=0):(e=Math.sqrt(r),c=t/e,d=u/e),this.set(c,d,e,b),this}var v=Math.sqrt((n-l)*(n-l)+(i-m)*(i-m)+(j-h)*(j-h));return Math.abs(v)<.001&&(v=1),this.x=(n-l)/v,this.y=(i-m)/v,this.z=(j-h)/v,this.w=Math.acos((g+k+o-1)/2),this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this.w>a.w&&(this.w=a.w),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this.w<a.w&&(this.w=a.w),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this.w<a.w?this.w=a.w:this.w>b.w&&(this.w=b.w),this},clampScalar:function(){var a,b;return function(d,e){return void 0===a&&(a=new c.Vector4,b=new c.Vector4),a.set(d,d,d,d),b.set(e,e,e,e),this.clamp(a,b)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this.w+=(a.w-this.w)*b,this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a),this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){return void 0===b&&(b=0),this.x=a[b],this.y=a[b+1],this.z=a[b+2],this.w=a[b+3],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a[b+3]=this.w,a},fromAttribute:function(a,b,c){return void 0===c&&(c=0),b=b*a.itemSize+c,this.x=a.array[b],this.y=a.array[b+1],this.z=a.array[b+2],this.w=a.array[b+3],this},clone:function(){return new c.Vector4(this.x,this.y,this.z,this.w)}},c.Euler=function(a,b,d,e){this._x=a||0,this._y=b||0,this._z=d||0,this._order=e||c.Euler.DefaultOrder},c.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],c.Euler.DefaultOrder="XYZ",c.Euler.prototype={constructor:c.Euler,_x:0,_y:0,_z:0,_order:c.Euler.DefaultOrder,get x(){return this._x},set x(a){this._x=a,this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a,this.onChangeCallback()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._order=d||this._order,this.onChangeCallback(),this},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this.onChangeCallback(),this},setFromRotationMatrix:function(a,b,d){var e=c.Math.clamp,f=a.elements,g=f[0],h=f[4],i=f[8],j=f[1],k=f[5],l=f[9],m=f[2],n=f[6],o=f[10];return b=b||this._order,"XYZ"===b?(this._y=Math.asin(e(i,-1,1)),Math.abs(i)<.99999?(this._x=Math.atan2(-l,o),this._z=Math.atan2(-h,g)):(this._x=Math.atan2(n,k),this._z=0)):"YXZ"===b?(this._x=Math.asin(-e(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(i,o),this._z=Math.atan2(j,k)):(this._y=Math.atan2(-m,g),this._z=0)):"ZXY"===b?(this._x=Math.asin(e(n,-1,1)),Math.abs(n)<.99999?(this._y=Math.atan2(-m,o),this._z=Math.atan2(-h,k)):(this._y=0,this._z=Math.atan2(j,g))):"ZYX"===b?(this._y=Math.asin(-e(m,-1,1)),Math.abs(m)<.99999?(this._x=Math.atan2(n,o),this._z=Math.atan2(j,g)):(this._x=0,this._z=Math.atan2(-h,k))):"YZX"===b?(this._z=Math.asin(e(j,-1,1)),Math.abs(j)<.99999?(this._x=Math.atan2(-l,k),this._y=Math.atan2(-m,g)):(this._x=0,this._y=Math.atan2(i,o))):"XZY"===b?(this._z=Math.asin(-e(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(n,k),this._y=Math.atan2(i,g)):(this._x=Math.atan2(-l,o),this._y=0)):c.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b),this._order=b,!1!==d&&this.onChangeCallback(),this},setFromQuaternion:function(){var a;return function(b,d,e){return void 0===a&&(a=new c.Matrix4),a.makeRotationFromQuaternion(b),this.setFromRotationMatrix(a,d,e),this}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new c.Quaternion;return function(b){a.setFromEuler(this),this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],void 0!==a[3]&&(this._order=a[3]),this.onChangeCallback(),this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._order,a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new c.Vector3(this._x,this._y,this._z)},onChange:function(a){return this.onChangeCallback=a,this},onChangeCallback:function(){},clone:function(){return new c.Euler(this._x,this._y,this._z,this._order)}},c.Line3=function(a,b){this.start=void 0!==a?a:new c.Vector3,this.end=void 0!==b?b:new c.Vector3},c.Line3.prototype={constructor:c.Line3,set:function(a,b){return this.start.copy(a),this.end.copy(b),this},copy:function(a){return this.start.copy(a.start),this.end.copy(a.end),this},center:function(a){return(a||new c.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new c.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,b){var d=b||new c.Vector3;return this.delta(d).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new c.Vector3,b=new c.Vector3;return function(d,e){a.subVectors(d,this.start),b.subVectors(this.end,this.start);var f=b.dot(b),g=b.dot(a),h=g/f;return e&&(h=c.Math.clamp(h,0,1)),h}}(),closestPointToPoint:function(a,b,d){var e=this.closestPointToPointParameter(a,b),f=d||new c.Vector3;return this.delta(f).multiplyScalar(e).add(this.start)},applyMatrix4:function(a){return this.start.applyMatrix4(a),this.end.applyMatrix4(a),this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new c.Line3).copy(this)}},c.Box2=function(a,b){this.min=void 0!==a?a:new c.Vector2(1/0,1/0),this.max=void 0!==b?b:new c.Vector2(-1/0,-1/0)},c.Box2.prototype={constructor:c.Box2,set:function(a,b){return this.min.copy(a),this.max.copy(b),this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new c.Vector2;return function(b,c){var d=a.copy(c).multiplyScalar(.5);return this.min.copy(b).sub(d),this.max.copy(b).add(d),this}}(),copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new c.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new c.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},containsPoint:function(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y)},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y},getParameter:function(a,b){return(b||new c.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y)},clampPoint:function(a,b){return(b||new c.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new c.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new c.Box2).copy(this)}},c.Box3=function(a,b){this.min=void 0!==a?a:new c.Vector3(1/0,1/0,1/0),this.max=void 0!==b?b:new c.Vector3(-1/0,-1/0,-1/0)},c.Box3.prototype={constructor:c.Box3,set:function(a,b){return this.min.copy(a),this.max.copy(b),this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new c.Vector3;return function(b,c){var d=a.copy(c).multiplyScalar(.5);return this.min.copy(b).sub(d),this.max.copy(b).add(d),this}}(),setFromObject:function(){var a=new c.Vector3;return function(b){var d=this;return b.updateMatrixWorld(!0),this.makeEmpty(),b.traverse(function(b){var e=b.geometry;if(void 0!==e)if(e instanceof c.Geometry)for(var f=e.vertices,g=0,h=f.length;g<h;g++)a.copy(f[g]),a.applyMatrix4(b.matrixWorld),d.expandByPoint(a);else if(e instanceof c.BufferGeometry&&void 0!==e.attributes.position)for(var i=e.attributes.position.array,g=0,h=i.length;g<h;g+=3)a.set(i[g],i[g+1],i[g+2]),a.applyMatrix4(b.matrixWorld),d.expandByPoint(a)}),this}}(),copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||new c.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new c.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},containsPoint:function(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z)},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z},getParameter:function(a,b){return(b||new c.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)},clampPoint:function(a,b){return(b||new c.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new c.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new c.Vector3;return function(b){var d=b||new c.Sphere;return d.center=this.center(),d.radius=.5*this.size(a).length(),d}}(),intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},applyMatrix4:function(){var a=[new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3,new c.Vector3];return function(b){return a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b),a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b),a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b),a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b),a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b),a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b),a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b),a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b),this.makeEmpty(),this.setFromPoints(a),this}}(),translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new c.Box3).copy(this)}},c.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&c.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},c.Matrix3.prototype={constructor:c.Matrix3,set:function(a,b,c,d,e,f,g,h,i){var j=this.elements;return j[0]=a,j[3]=b,j[6]=c,j[1]=d,j[4]=e,j[7]=f,j[2]=g,j[5]=h,j[8]=i,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(a){var b=a.elements;return this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]),this},multiplyVector3:function(a){return c.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),a.applyMatrix3(this)},multiplyVector3Array:function(a){return c.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new c.Vector3;return function(b,c,d){void 0===c&&(c=0),void 0===d&&(d=b.length);for(var e=0,f=c;e<d;e+=3,f+=3)a.x=b[f],a.y=b[f+1],a.z=b[f+2],a.applyMatrix3(this),b[f]=a.x,b[f+1]=a.y,b[f+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[3]*=a,b[6]*=a,b[1]*=a,b[4]*=a,b[7]*=a,b[2]*=a,b[5]*=a,b[8]*=a,this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j-b*g*i-c*e*j+c*g*h+d*e*i-d*f*h},getInverse:function(a,b){var d=a.elements,e=this.elements;e[0]=d[10]*d[5]-d[6]*d[9],e[1]=-d[10]*d[1]+d[2]*d[9],e[2]=d[6]*d[1]-d[2]*d[5],e[3]=-d[10]*d[4]+d[6]*d[8],e[4]=d[10]*d[0]-d[2]*d[8],e[5]=-d[6]*d[0]+d[2]*d[4],e[6]=d[9]*d[4]-d[5]*d[8],e[7]=-d[9]*d[0]+d[1]*d[8],e[8]=d[5]*d[0]-d[1]*d[4];var f=d[0]*e[0]+d[1]*e[3]+d[2]*e[6];if(0===f){var g="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(g);return c.warn(g),this.identity(),this}return this.multiplyScalar(1/f),this},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[3],b[3]=a,a=b[2],b[2]=b[6],b[6]=a,a=b[5],b[5]=b[7],b[7]=a,this},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a},getNormalMatrix:function(a){return this.getInverse(a).transpose(),this},transposeIntoArray:function(a){var b=this.elements;return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],this},fromArray:function(a){return this.elements.set(a),this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]},clone:function(){return(new c.Matrix3).fromArray(this.elements)}},c.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&c.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},c.Matrix4.prototype={constructor:c.Matrix4,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(a){return this.elements.set(a.elements),this},extractPosition:function(a){return c.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(a)},copyPosition:function(a){var b=this.elements,c=a.elements;return b[12]=c[12],b[13]=c[13],b[14]=c[14],this},extractBasis:function(a,b,c){var d=this.elements;return a.set(d[0],d[1],d[2]),b.set(d[4],d[5],d[6]),c.set(d[8],d[9],d[10]),this},makeBasis:function(a,b,c){return this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1),this},extractRotation:function(){var a=new c.Vector3;return function(b){var c=this.elements,d=b.elements,e=1/a.set(d[0],d[1],d[2]).length(),f=1/a.set(d[4],d[5],d[6]).length(),g=1/a.set(d[8],d[9],d[10]).length();return c[0]=d[0]*e,c[1]=d[1]*e,c[2]=d[2]*e,c[4]=d[4]*f,c[5]=d[5]*f,c[6]=d[6]*f,c[8]=d[8]*g,c[9]=d[9]*g,c[10]=d[10]*g,this}}(),makeRotationFromEuler:function(a){a instanceof c.Euler==!1&&c.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,d=a.x,e=a.y,f=a.z,g=Math.cos(d),h=Math.sin(d),i=Math.cos(e),j=Math.sin(e),k=Math.cos(f),l=Math.sin(f);if("XYZ"===a.order){var m=g*k,n=g*l,o=h*k,p=h*l;b[0]=i*k,b[4]=-i*l,b[8]=j,b[1]=n+o*j,b[5]=m-p*j,b[9]=-h*i,b[2]=p-m*j,b[6]=o+n*j,b[10]=g*i}else if("YXZ"===a.order){var q=i*k,r=i*l,s=j*k,t=j*l;b[0]=q+t*h,b[4]=s*h-r,b[8]=g*j,b[1]=g*l,b[5]=g*k,b[9]=-h,b[2]=r*h-s,b[6]=t+q*h,b[10]=g*i}else if("ZXY"===a.order){var q=i*k,r=i*l,s=j*k,t=j*l;b[0]=q-t*h,b[4]=-g*l,b[8]=s+r*h,b[1]=r+s*h,b[5]=g*k,b[9]=t-q*h,b[2]=-g*j,b[6]=h,b[10]=g*i}else if("ZYX"===a.order){var m=g*k,n=g*l,o=h*k,p=h*l;b[0]=i*k,b[4]=o*j-n,b[8]=m*j+p,b[1]=i*l,b[5]=p*j+m,b[9]=n*j-o,b[2]=-j,b[6]=h*i,b[10]=g*i}else if("YZX"===a.order){var u=g*i,v=g*j,w=h*i,x=h*j;b[0]=i*k,b[4]=x-u*l,b[8]=w*l+v,b[1]=l,b[5]=g*k,b[9]=-h*k,b[2]=-j*k,b[6]=v*l+w,b[10]=u-x*l}else if("XZY"===a.order){var u=g*i,v=g*j,w=h*i,x=h*j;b[0]=i*k,b[4]=-l,b[8]=j*k,b[1]=u*l+x,b[5]=g*k,b[9]=v*l-w,b[2]=w*l-v,b[6]=h*k,b[10]=x*l+u}return b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},setRotationFromQuaternion:function(a){return c.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(a)},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},lookAt:function(){var a=new c.Vector3,b=new c.Vector3,d=new c.Vector3;return function(c,e,f){var g=this.elements;return d.subVectors(c,e).normalize(),0===d.length()&&(d.z=1),a.crossVectors(f,d).normalize(),0===a.length()&&(d.x+=1e-4,a.crossVectors(f,d).normalize()),b.crossVectors(d,a),g[0]=a.x,g[4]=b.x,g[8]=d.x,g[1]=a.y,g[5]=b.y,g[9]=d.y,g[2]=a.z,g[6]=b.z,g[10]=d.z,this}}(),multiply:function(a,b){return void 0!==b?(c.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},multiplyToArray:function(a,b,c){var d=this.elements;return this.multiplyMatrices(a,b),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},multiplyVector3:function(a){return c.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),a.applyProjection(this)},multiplyVector4:function(a){return c.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},multiplyVector3Array:function(a){return c.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new c.Vector3;return function(b,c,d){void 0===c&&(c=0),void 0===d&&(d=b.length);for(var e=0,f=c;e<d;e+=3,f+=3)a.x=b[f],a.y=b[f+1],a.z=b[f+2],a.applyMatrix4(this),b[f]=a.x,b[f+1]=a.y,b[f+2]=a.z;return b}}(),rotateAxis:function(a){c.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),a.transformDirection(this)},crossVector:function(a){return c.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14];return a[3]*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+a[7]*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+a[11]*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+a[15]*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a},getPosition:function(){var a=new c.Vector3;return function(){c.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},getInverse:function(a,b){var d=this.elements,e=a.elements,f=e[0],g=e[4],h=e[8],i=e[12],j=e[1],k=e[5],l=e[9],m=e[13],n=e[2],o=e[6],p=e[10],q=e[14],r=e[3],s=e[7],t=e[11],u=e[15];d[0]=l*q*s-m*p*s+m*o*t-k*q*t-l*o*u+k*p*u,d[4]=i*p*s-h*q*s-i*o*t+g*q*t+h*o*u-g*p*u,d[8]=h*m*s-i*l*s+i*k*t-g*m*t-h*k*u+g*l*u,d[12]=i*l*o-h*m*o-i*k*p+g*m*p+h*k*q-g*l*q,d[1]=m*p*r-l*q*r-m*n*t+j*q*t+l*n*u-j*p*u,d[5]=h*q*r-i*p*r+i*n*t-f*q*t-h*n*u+f*p*u,d[9]=i*l*r-h*m*r-i*j*t+f*m*t+h*j*u-f*l*u,d[13]=h*m*n-i*l*n+i*j*p-f*m*p-h*j*q+f*l*q,d[2]=k*q*r-m*o*r+m*n*s-j*q*s-k*n*u+j*o*u,d[6]=i*o*r-g*q*r-i*n*s+f*q*s+g*n*u-f*o*u,d[10]=g*m*r-i*k*r+i*j*s-f*m*s-g*j*u+f*k*u,d[14]=i*k*n-g*m*n-i*j*o+f*m*o+g*j*q-f*k*q,d[3]=l*o*r-k*p*r-l*n*s+j*p*s+k*n*t-j*o*t,d[7]=g*p*r-h*o*r+h*n*s-f*p*s-g*n*t+f*o*t,d[11]=h*k*r-g*l*r-h*j*s+f*l*s+g*j*t-f*k*t,d[15]=g*l*n-h*k*n+h*j*o-f*l*o-g*j*p+f*k*p;var v=f*d[0]+j*d[4]+n*d[8]+r*d[12];if(0==v){var w="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(w);return c.warn(w),this.identity(),this}return this.multiplyScalar(1/v),this},translate:function(a){c.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){c.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){c.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){c.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(a,b){c.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this},getMaxScaleOnAxis:function(){var a=this.elements,b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],c=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],d=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(b,Math.max(c,d)))},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},compose:function(a,b,c){return this.makeRotationFromQuaternion(b),this.scale(c),this.setPosition(a),this},decompose:function(){var a=new c.Vector3,b=new c.Matrix4;return function(c,d,e){var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),i=a.set(f[8],f[9],f[10]).length();this.determinant()<0&&(g=-g),c.x=f[12],c.y=f[13],c.z=f[14],b.elements.set(this.elements);var j=1/g,k=1/h,l=1/i;return b.elements[0]*=j,b.elements[1]*=j,b.elements[2]*=j,b.elements[4]*=k,b.elements[5]*=k,b.elements[6]*=k,b.elements[8]*=l,b.elements[9]*=l,b.elements[10]*=l,d.setFromRotationMatrix(b),e.x=g,e.y=h,e.z=i,this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements,h=2*e/(b-a),i=2*e/(d-c),j=(b+a)/(b-a),k=(d+c)/(d-c),l=-(f+e)/(f-e),m=-2*f*e/(f-e);return g[0]=h,g[4]=0,g[8]=j,g[12]=0,g[1]=0,g[5]=i,g[9]=k,g[13]=0,g[2]=0,g[6]=0,g[10]=l,g[14]=m,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this},makePerspective:function(a,b,d,e){var f=d*Math.tan(c.Math.degToRad(.5*a)),g=-f,h=g*b,i=f*b;return this.makeFrustum(h,i,g,f,d,e)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=b-a,i=c-d,j=f-e,k=(b+a)/h,l=(c+d)/i,m=(f+e)/j;return g[0]=2/h,g[4]=0,g[8]=0,g[12]=-k,g[1]=0,g[5]=2/i,g[9]=0,g[13]=-l,g[2]=0,g[6]=0,g[10]=-2/j,g[14]=-m,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this},fromArray:function(a){return this.elements.set(a),this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return(new c.Matrix4).fromArray(this.elements)}},c.Ray=function(a,b){this.origin=void 0!==a?a:new c.Vector3,this.direction=void 0!==b?b:new c.Vector3},c.Ray.prototype={constructor:c.Ray,set:function(a,b){return this.origin.copy(a),this.direction.copy(b),this},copy:function(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this},at:function(a,b){return(b||new c.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(){var a=new c.Vector3;return function(b){return this.origin.copy(this.at(b,a)),this}}(),closestPointToPoint:function(a,b){var d=b||new c.Vector3;d.subVectors(a,this.origin);var e=d.dot(this.direction);return e<0?d.copy(this.origin):d.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(){var a=new c.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);return c<0?this.origin.distanceTo(b):(a.copy(this.direction).multiplyScalar(c).add(this.origin),a.distanceTo(b))}}(),distanceSqToSegment:function(){var a=new c.Vector3,b=new c.Vector3,d=new c.Vector3;return function(c,e,f,g){a.copy(c).add(e).multiplyScalar(.5),b.copy(e).sub(c).normalize(),d.copy(this.origin).sub(a);var h,i,j,k,l=.5*c.distanceTo(e),m=-this.direction.dot(b),n=d.dot(this.direction),o=-d.dot(b),p=d.lengthSq(),q=Math.abs(1-m*m);if(q>0)if(h=m*o-n,i=m*n-o,k=l*q,h>=0)if(i>=-k)if(i<=k){var r=1/q;h*=r,i*=r,j=h*(h+m*i+2*n)+i*(m*h+i+2*o)+p}else i=l,h=Math.max(0,-(m*i+n)),j=-h*h+i*(i+2*o)+p;else i=-l,h=Math.max(0,-(m*i+n)),j=-h*h+i*(i+2*o)+p;else i<=-k?(h=Math.max(0,-(-m*l+n)),i=h>0?-l:Math.min(Math.max(-l,-o),l),j=-h*h+i*(i+2*o)+p):i<=k?(h=0,i=Math.min(Math.max(-l,-o),l),j=i*(i+2*o)+p):(h=Math.max(0,-(m*l+n)),i=h>0?l:Math.min(Math.max(-l,-o),l),j=-h*h+i*(i+2*o)+p);else i=m>0?-l:l,h=Math.max(0,-(m*i+n)),j=-h*h+i*(i+2*o)+p;return f&&f.copy(this.direction).multiplyScalar(h).add(this.origin),g&&g.copy(b).multiplyScalar(i).add(a),j}}(),isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},intersectSphere:function(){var a=new c.Vector3;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d,f=b.radius*b.radius;if(e>f)return null;var g=Math.sqrt(f-e),h=d-g,i=d+g;return h<0&&i<0?null:h<0?this.at(i,c):this.at(h,c)}}(),isIntersectionPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||a.normal.dot(this.direction)*b<0},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0==b)return 0==a.distanceToPoint(this.origin)?0:null;var c=-(this.origin.dot(a.normal)+a.constant)/b;return c>=0?c:null},intersectPlane:function(a,b){var c=this.distanceToPlane(a);return null===c?null:this.at(c,b)},isIntersectionBox:function(){var a=new c.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectBox:function(a,b){var c,d,e,f,g,h,i=1/this.direction.x,j=1/this.direction.y,k=1/this.direction.z,l=this.origin;return i>=0?(c=(a.min.x-l.x)*i,d=(a.max.x-l.x)*i):(c=(a.max.x-l.x)*i,d=(a.min.x-l.x)*i),j>=0?(e=(a.min.y-l.y)*j,f=(a.max.y-l.y)*j):(e=(a.max.y-l.y)*j,f=(a.min.y-l.y)*j),c>f||e>d?null:((e>c||c!==c)&&(c=e),(f<d||d!==d)&&(d=f),k>=0?(g=(a.min.z-l.z)*k,h=(a.max.z-l.z)*k):(g=(a.max.z-l.z)*k,h=(a.min.z-l.z)*k),c>h||g>d?null:((g>c||c!==c)&&(c=g),(h<d||d!==d)&&(d=h),d<0?null:this.at(c>=0?c:d,b)))},intersectTriangle:function(){var a=new c.Vector3,b=new c.Vector3,d=new c.Vector3,e=new c.Vector3;return function(c,f,g,h,i){b.subVectors(f,c),d.subVectors(g,c),e.crossVectors(b,d);var j,k=this.direction.dot(e);if(k>0){if(h)return null;j=1}else{if(!(k<0))return null;j=-1,k=-k}a.subVectors(this.origin,c);var l=j*this.direction.dot(d.crossVectors(a,d));if(l<0)return null;var m=j*this.direction.dot(b.cross(a));if(m<0)return null;if(l+m>k)return null;var n=-j*a.dot(e);return n<0?null:this.at(n/k,i)}}(),applyMatrix4:function(a){return this.direction.add(this.origin).applyMatrix4(a),this.origin.applyMatrix4(a),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return(new c.Ray).copy(this)}},c.Sphere=function(a,b){this.center=void 0!==a?a:new c.Vector3,this.radius=void 0!==b?b:0},c.Sphere.prototype={constructor:c.Sphere,set:function(a,b){return this.center.copy(a),this.radius=b,this},setFromPoints:function(){var a=new c.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=0,f=0,g=b.length;f<g;f++)e=Math.max(e,d.distanceToSquared(b[f]));return this.radius=Math.sqrt(e),this}}(),copy:function(a){return this.center.copy(a.center),this.radius=a.radius,this},empty:function(){return this.radius<=0},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){
var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var d=this.center.distanceToSquared(a),e=b||new c.Vector3;return e.copy(a),d>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(a){var b=a||new c.Box3;return b.set(this.center,this.center),b.expandByScalar(this.radius),b},applyMatrix4:function(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this},translate:function(a){return this.center.add(a),this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new c.Sphere).copy(this)}},c.Frustum=function(a,b,d,e,f,g){this.planes=[void 0!==a?a:new c.Plane,void 0!==b?b:new c.Plane,void 0!==d?d:new c.Plane,void 0!==e?e:new c.Plane,void 0!==f?f:new c.Plane,void 0!==g?g:new c.Plane]},c.Frustum.prototype={constructor:c.Frustum,set:function(a,b,c,d,e,f){var g=this.planes;return g[0].copy(a),g[1].copy(b),g[2].copy(c),g[3].copy(d),g[4].copy(e),g[5].copy(f),this},copy:function(a){for(var b=this.planes,c=0;c<6;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=c[9],n=c[10],o=c[11],p=c[12],q=c[13],r=c[14],s=c[15];return b[0].setComponents(g-d,k-h,o-l,s-p).normalize(),b[1].setComponents(g+d,k+h,o+l,s+p).normalize(),b[2].setComponents(g+e,k+i,o+m,s+q).normalize(),b[3].setComponents(g-e,k-i,o-m,s-q).normalize(),b[4].setComponents(g-f,k-j,o-n,s-r).normalize(),b[5].setComponents(g+f,k+j,o+n,s+r).normalize(),this},intersectsObject:function(){var a=new c.Sphere;return function(b){var c=b.geometry;return null===c.boundingSphere&&c.computeBoundingSphere(),a.copy(c.boundingSphere),a.applyMatrix4(b.matrixWorld),this.intersectsSphere(a)}}(),intersectsSphere:function(a){for(var b=this.planes,c=a.center,d=-a.radius,e=0;e<6;e++){if(b[e].distanceToPoint(c)<d)return!1}return!0},intersectsBox:function(){var a=new c.Vector3,b=new c.Vector3;return function(c){for(var d=this.planes,e=0;e<6;e++){var f=d[e];a.x=f.normal.x>0?c.min.x:c.max.x,b.x=f.normal.x>0?c.max.x:c.min.x,a.y=f.normal.y>0?c.min.y:c.max.y,b.y=f.normal.y>0?c.max.y:c.min.y,a.z=f.normal.z>0?c.min.z:c.max.z,b.z=f.normal.z>0?c.max.z:c.min.z;var g=f.distanceToPoint(a),h=f.distanceToPoint(b);if(g<0&&h<0)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;c<6;c++)if(b[c].distanceToPoint(a)<0)return!1;return!0},clone:function(){return(new c.Frustum).copy(this)}},c.Plane=function(a,b){this.normal=void 0!==a?a:new c.Vector3(1,0,0),this.constant=void 0!==b?b:0},c.Plane.prototype={constructor:c.Plane,set:function(a,b){return this.normal.copy(a),this.constant=b,this},setComponents:function(a,b,c,d){return this.normal.set(a,b,c),this.constant=d,this},setFromNormalAndCoplanarPoint:function(a,b){return this.normal.copy(a),this.constant=-b.dot(this.normal),this},setFromCoplanarPoints:function(){var a=new c.Vector3,b=new c.Vector3;return function(c,d,e){var f=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();return this.setFromNormalAndCoplanarPoint(f,c),this}}(),copy:function(a){return this.normal.copy(a.normal),this.constant=a.constant,this},normalize:function(){var a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var d=this.distanceToPoint(a);return(b||new c.Vector3).copy(this.normal).multiplyScalar(d)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start),c=this.distanceToPoint(a.end);return b<0&&c>0||c<0&&b>0},intersectLine:function(){var a=new c.Vector3;return function(b,d){var e=d||new c.Vector3,f=b.delta(a),g=this.normal.dot(f);if(0!=g){var h=-(b.start.dot(this.normal)+this.constant)/g;if(!(h<0||h>1))return e.copy(f).multiplyScalar(h).add(b.start)}else if(0==this.distanceToPoint(b.start))return e.copy(b.start)}}(),coplanarPoint:function(a){return(a||new c.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new c.Vector3,b=new c.Vector3,d=new c.Matrix3;return function(c,e){var f=e||d.getNormalMatrix(c),g=a.copy(this.normal).applyMatrix3(f);g.normalize();var h=this.coplanarPoint(b);return h.applyMatrix4(c),this.setFromNormalAndCoplanarPoint(g,h),this}}(),translate:function(a){return this.constant=this.constant-a.dot(this.normal),this},equals:function(a){return a.normal.equals(this.normal)&&a.constant==this.constant},clone:function(){return(new c.Plane).copy(this)}},c.Math={generateUUID:function(){var a,b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),c=new Array(36),d=0;return function(){for(var e=0;e<36;e++)8==e||13==e||18==e||23==e?c[e]="-":14==e?c[e]="4":(d<=2&&(d=33554432+16777216*Math.random()|0),a=15&d,d>>=4,c[e]=b[19==e?3&a|8:a]);return c.join("")}}(),clamp:function(a,b,c){return a<b?b:a>c?c:a},clampBottom:function(a,b){return a<b?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){return a<=b?0:a>=c?1:(a=(a-b)/(c-b))*a*(3-2*a)},smootherstep:function(a,b,c){return a<=b?0:a>=c?1:(a=(a-b)/(c-b))*a*a*(a*(6*a-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return Math.floor(this.randFloat(a,b))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0==(a&a-1)&&0!==a},nextPowerOfTwo:function(a){return a--,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,++a}},c.Spline=function(a){function b(a,b,c,d,e,f,g){var h=.5*(c-a),i=.5*(d-b);return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b}this.points=a;var d,e,f,g,h,i,j,k,l,m=[],n={x:0,y:0,z:0};this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}},this.getPoint=function(a){return d=(this.points.length-1)*a,e=Math.floor(d),f=d-e,m[0]=0===e?e:e-1,m[1]=e,m[2]=e>this.points.length-2?this.points.length-1:e+1,m[3]=e>this.points.length-3?this.points.length-1:e+2,i=this.points[m[0]],j=this.points[m[1]],k=this.points[m[2]],l=this.points[m[3]],g=f*f,h=f*g,n.x=b(i.x,j.x,k.x,l.x,f,g,h),n.y=b(i.y,j.y,k.y,l.y,f,g,h),n.z=b(i.z,j.z,k.z,l.z,f,g,h),n},this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d},this.getLength=function(a){var b,d,e,f,g=0,h=0,i=0,j=new c.Vector3,k=new c.Vector3,l=[],m=0;for(l[0]=0,a||(a=100),e=this.points.length*a,j.copy(this.points[0]),b=1;b<e;b++)d=b/e,f=this.getPoint(d),k.copy(f),m+=k.distanceTo(j),j.copy(f),g=(this.points.length-1)*d,(h=Math.floor(g))!=i&&(l[h]=m,i=h);return l[l.length]=m,{chunks:l,total:m}},this.reparametrizeByArcLength=function(a){var b,d,e,f,g,h,i,j,k=[],l=new c.Vector3,m=this.getLength();for(k.push(l.copy(this.points[0]).clone()),b=1;b<this.points.length;b++){for(h=m.chunks[b]-m.chunks[b-1],i=Math.ceil(a*h/m.total),f=(b-1)/(this.points.length-1),g=b/(this.points.length-1),d=1;d<i-1;d++)e=f+d*(1/i)*(g-f),j=this.getPoint(e),k.push(l.copy(j).clone());k.push(l.copy(this.points[b]).clone())}this.points=k}},c.Triangle=function(a,b,d){this.a=void 0!==a?a:new c.Vector3,this.b=void 0!==b?b:new c.Vector3,this.c=void 0!==d?d:new c.Vector3},c.Triangle.normal=function(){var a=new c.Vector3;return function(b,d,e,f){var g=f||new c.Vector3;g.subVectors(e,d),a.subVectors(b,d),g.cross(a);var h=g.lengthSq();return h>0?g.multiplyScalar(1/Math.sqrt(h)):g.set(0,0,0)}}(),c.Triangle.barycoordFromPoint=function(){var a=new c.Vector3,b=new c.Vector3,d=new c.Vector3;return function(e,f,g,h,i){a.subVectors(h,f),b.subVectors(g,f),d.subVectors(e,f);var j=a.dot(a),k=a.dot(b),l=a.dot(d),m=b.dot(b),n=b.dot(d),o=j*m-k*k,p=i||new c.Vector3;if(0==o)return p.set(-2,-1,-1);var q=1/o,r=(m*l-k*n)*q,s=(j*n-k*l)*q;return p.set(1-r-s,s,r)}}(),c.Triangle.containsPoint=function(){var a=new c.Vector3;return function(b,d,e,f){var g=c.Triangle.barycoordFromPoint(b,d,e,f,a);return g.x>=0&&g.y>=0&&g.x+g.y<=1}}(),c.Triangle.prototype={constructor:c.Triangle,set:function(a,b,c){return this.a.copy(a),this.b.copy(b),this.c.copy(c),this},setFromPointsAndIndices:function(a,b,c,d){return this.a.copy(a[b]),this.b.copy(a[c]),this.c.copy(a[d]),this},copy:function(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this},area:function(){var a=new c.Vector3,b=new c.Vector3;return function(){return a.subVectors(this.c,this.b),b.subVectors(this.a,this.b),.5*a.cross(b).length()}}(),midpoint:function(a){return(a||new c.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return c.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new c.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return c.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return c.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},clone:function(){return(new c.Triangle).copy(this)}},c.Clock=function(a){this.autoStart=void 0===a||a,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},c.Clock.prototype={constructor:c.Clock,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var a=0;if(this.autoStart&&!this.running&&this.start(),this.running){var b=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();a=.001*(b-this.oldTime),this.oldTime=b,this.elapsedTime+=a}return a}},c.EventDispatcher=function(){},c.EventDispatcher.prototype={constructor:c.EventDispatcher,apply:function(a){a.addEventListener=c.EventDispatcher.prototype.addEventListener,a.hasEventListener=c.EventDispatcher.prototype.hasEventListener,a.removeEventListener=c.EventDispatcher.prototype.removeEventListener,a.dispatchEvent=c.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners,d=c[a];if(void 0!==d){var e=d.indexOf(b);-1!==e&&d.splice(e,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners,c=b[a.type];if(void 0!==c){a.target=this;for(var d=[],e=c.length,f=0;f<e;f++)d[f]=c[f];for(var f=0;f<e;f++)d[f].call(this,a)}}}},function(a){a.Raycaster=function(b,c,d,e){this.ray=new a.Ray(b,c),this.near=d||0,this.far=e||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var b=function(a,b){return a.distance-b.distance},c=function a(b,c,d,e){if(b.raycast(c,d),!0===e)for(var f=b.children,g=0,h=f.length;g<h;g++)a(f[g],c,d,!0)};a.Raycaster.prototype={constructor:a.Raycaster,precision:1e-4,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(b,c){c instanceof a.PerspectiveCamera?(this.ray.origin.copy(c.position),this.ray.direction.set(b.x,b.y,.5).unproject(c).sub(c.position).normalize()):c instanceof a.OrthographicCamera?(this.ray.origin.set(b.x,b.y,-1).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld)):a.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,d){var e=[];return c(a,this,e,d),e.sort(b),e},intersectObjects:function(d,e){var f=[];if(d instanceof Array==!1)return a.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),f;for(var g=0,h=d.length;g<h;g++)c(d[g],this,f,e);return f.sort(b),f}}}(c),c.Object3D=function(){Object.defineProperty(this,"id",{value:c.Object3DIdCount++}),this.uuid=c.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=void 0,this.children=[],this.up=c.Object3D.DefaultUp.clone();var a=new c.Vector3,b=new c.Euler,d=new c.Quaternion,e=new c.Vector3(1,1,1),f=function(){d.setFromEuler(b,!1)},g=function(){b.setFromQuaternion(d,void 0,!1)};b.onChange(f),d.onChange(g),Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:d},scale:{enumerable:!0,value:e}}),this.rotationAutoUpdate=!0,this.matrix=new c.Matrix4,this.matrixWorld=new c.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},c.Object3D.DefaultUp=new c.Vector3(0,1,0),c.Object3D.prototype={constructor:c.Object3D,get eulerOrder(){return c.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(a){c.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=a},get useQuaternion(){c.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(a){c.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new c.Quaternion;return function(b,c){return a.setFromAxisAngle(b,c),this.quaternion.multiply(a),this}}(),rotateX:function(){var a=new c.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new c.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new c.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new c.Vector3;return function(b,c){return a.copy(b).applyQuaternion(this.quaternion),this.position.add(a.multiplyScalar(c)),this}}(),translate:function(a,b){return c.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(b,a)},translateX:function(){var a=new c.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new c.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new c.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new c.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new c.Matrix4;return function(b){a.lookAt(b,this.position,this.up),this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(arguments.length>1){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}return a===this?(c.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this):(a instanceof c.Object3D?(void 0!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):c.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a),this)},remove:function(a){if(arguments.length>1)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);var c=this.children.indexOf(a);-1!==c&&(a.parent=void 0,a.dispatchEvent({type:"removed"}),this.children.splice(c,1))},getChildByName:function(a){return c.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(a)},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c],f=e.getObjectByProperty(a,b);if(void 0!==f)return f}},getWorldPosition:function(a){var b=a||new c.Vector3;return this.updateMatrixWorld(!0),b.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new c.Vector3,b=new c.Vector3;return function(d){var e=d||new c.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(a,e,b),e}}(),getWorldRotation:function(){var a=new c.Quaternion;return function(b){var d=b||new c.Euler;return this.getWorldQuaternion(a),d.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new c.Vector3,b=new c.Quaternion;return function(d){var e=d||new c.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(a,b,e),e}}(),getWorldDirection:function(){var a=new c.Quaternion;return function(b){var d=b||new c.Vector3;return this.getWorldQuaternion(a),d.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverseVisible(a)}},traverseAncestors:function(a){this.parent&&(a(this.parent),this.parent.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==a||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},toJSON:function(){var a={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},b={},d=function(c){if(void 0===a.geometries&&(a.geometries=[]),void 0===b[c.uuid]){var d=c.toJSON();delete d.metadata,b[c.uuid]=d,a.geometries.push(d)}return c.uuid},e={},f=function(b){if(void 0===a.materials&&(a.materials=[]),void 0===e[b.uuid]){var c=b.toJSON();delete c.metadata,e[b.uuid]=c,a.materials.push(c)}return b.uuid};return a.object=function a(b){var e={};if(e.uuid=b.uuid,e.type=b.type,""!==b.name&&(e.name=b.name),"{}"!==JSON.stringify(b.userData)&&(e.userData=b.userData),!0!==b.visible&&(e.visible=b.visible),b instanceof c.PerspectiveCamera?(e.fov=b.fov,e.aspect=b.aspect,e.near=b.near,e.far=b.far):b instanceof c.OrthographicCamera?(e.left=b.left,e.right=b.right,e.top=b.top,e.bottom=b.bottom,e.near=b.near,e.far=b.far):b instanceof c.AmbientLight?e.color=b.color.getHex():b instanceof c.DirectionalLight?(e.color=b.color.getHex(),e.intensity=b.intensity):b instanceof c.PointLight?(e.color=b.color.getHex(),e.intensity=b.intensity,e.distance=b.distance,e.decay=b.decay):b instanceof c.SpotLight?(e.color=b.color.getHex(),e.intensity=b.intensity,e.distance=b.distance,e.angle=b.angle,e.exponent=b.exponent,e.decay=b.decay):b instanceof c.HemisphereLight?(e.color=b.color.getHex(),e.groundColor=b.groundColor.getHex()):b instanceof c.Mesh||b instanceof c.Line||b instanceof c.PointCloud?(e.geometry=d(b.geometry),e.material=f(b.material),b instanceof c.Line&&(e.mode=b.mode)):b instanceof c.Sprite&&(e.material=f(b.material)),e.matrix=b.matrix.toArray(),b.children.length>0){e.children=[];for(var g=0;g<b.children.length;g++)e.children.push(a(b.children[g]))}return e}(this),a},clone:function(a,b){if(void 0===a&&(a=new c.Object3D),void 0===b&&(b=!0),a.name=this.name,a.up.copy(this.up),a.position.copy(this.position),a.quaternion.copy(this.quaternion),a.scale.copy(this.scale),a.rotationAutoUpdate=this.rotationAutoUpdate,a.matrix.copy(this.matrix),a.matrixWorld.copy(this.matrixWorld),a.matrixAutoUpdate=this.matrixAutoUpdate,a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,a.visible=this.visible,a.castShadow=this.castShadow,a.receiveShadow=this.receiveShadow,a.frustumCulled=this.frustumCulled,a.userData=JSON.parse(JSON.stringify(this.userData)),!0===b)for(var d=0;d<this.children.length;d++){var e=this.children[d];a.add(e.clone())}return a}},c.EventDispatcher.prototype.apply(c.Object3D.prototype),c.Object3DIdCount=0,c.Face3=function(a,b,d,e,f,g){this.a=a,this.b=b,this.c=d,this.normal=e instanceof c.Vector3?e:new c.Vector3,this.vertexNormals=e instanceof Array?e:[],this.color=f instanceof c.Color?f:new c.Color,this.vertexColors=f instanceof Array?f:[],this.vertexTangents=[],this.materialIndex=void 0!==g?g:0},c.Face3.prototype={constructor:c.Face3,clone:function(){var a=new c.Face3(this.a,this.b,this.c);a.normal.copy(this.normal),a.color.copy(this.color),a.materialIndex=this.materialIndex;for(var b=0,d=this.vertexNormals.length;b<d;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();for(var b=0,d=this.vertexColors.length;b<d;b++)a.vertexColors[b]=this.vertexColors[b].clone();for(var b=0,d=this.vertexTangents.length;b<d;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}},c.Face4=function(a,b,d,e,f,g,h){return c.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new c.Face3(a,b,d,f,g,h)},c.BufferAttribute=function(a,b){this.array=a,this.itemSize=b,this.needsUpdate=!1},c.BufferAttribute.prototype={constructor:c.BufferAttribute,get length(){return this.array.length},copyAt:function(a,b,c){a*=this.itemSize,c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){return void 0===b&&(b=0),this.array.set(a,b),this},setX:function(a,b){return this.array[a*this.itemSize]=b,this},setY:function(a,b){return this.array[a*this.itemSize+1]=b,this},setZ:function(a,b){return this.array[a*this.itemSize+2]=b,this},setXY:function(a,b,c){return a*=this.itemSize,this.array[a]=b,this.array[a+1]=c,this},setXYZ:function(a,b,c,d){return a*=this.itemSize,this.array[a]=b,this.array[a+1]=c,this.array[a+2]=d,this},setXYZW:function(a,b,c,d,e){return a*=this.itemSize,this.array[a]=b,this.array[a+1]=c,this.array[a+2]=d,this.array[a+3]=e,this},clone:function(){return new c.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}},c.Int8Attribute=function(a,b){return c.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new c.BufferAttribute(a,b)},c.Uint8Attribute=function(a,b){return c.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new c.BufferAttribute(a,b)},c.Uint8ClampedAttribute=function(a,b){return c.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new c.BufferAttribute(a,b)},c.Int16Attribute=function(a,b){return c.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new c.BufferAttribute(a,b)},c.Uint16Attribute=function(a,b){return c.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new c.BufferAttribute(a,b)},c.Int32Attribute=function(a,b){return c.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new c.BufferAttribute(a,b)},c.Uint32Attribute=function(a,b){return c.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new c.BufferAttribute(a,b)},c.Float32Attribute=function(a,b){return c.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new c.BufferAttribute(a,b)},c.Float64Attribute=function(a,b){return c.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new c.BufferAttribute(a,b)},c.DynamicBufferAttribute=function(a,b){c.BufferAttribute.call(this,a,b),this.updateRange={offset:0,count:-1}},c.DynamicBufferAttribute.prototype=Object.create(c.BufferAttribute.prototype),c.DynamicBufferAttribute.prototype.constructor=c.DynamicBufferAttribute,c.DynamicBufferAttribute.prototype.clone=function(){return new c.DynamicBufferAttribute(new this.array.constructor(this.array),this.itemSize)},c.BufferGeometry=function(){Object.defineProperty(this,"id",{value:c.GeometryIdCount++}),this.uuid=c.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.attributes={},this.attributesKeys=[],this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null},c.BufferGeometry.prototype={constructor:c.BufferGeometry,addAttribute:function(a,b){if(b instanceof c.BufferAttribute==!1)return c.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void(this.attributes[a]={array:arguments[1],itemSize:arguments[2]});this.attributes[a]=b,this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(a){return this.attributes[a]},addDrawCall:function(a,b,c){this.drawcalls.push({start:a,count:b,index:void 0!==c?c:0})},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);var d=this.attributes.normal;if(void 0!==d){(new c.Matrix3).getNormalMatrix(a).applyToVector3Array(d.array),d.needsUpdate=!0}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();return this.applyMatrix((new c.Matrix4).setPosition(a)),a},fromGeometry:function(a,b){b=b||{vertexColors:c.NoColors};var d=a.vertices,e=a.faces,f=a.faceVertexUvs,g=b.vertexColors,h=f[0].length>0,i=3==e[0].vertexNormals.length,j=new Float32Array(3*e.length*3);this.addAttribute("position",new c.BufferAttribute(j,3));var k=new Float32Array(3*e.length*3);if(this.addAttribute("normal",new c.BufferAttribute(k,3)),g!==c.NoColors){var l=new Float32Array(3*e.length*3);this.addAttribute("color",new c.BufferAttribute(l,3))}if(!0===h){var m=new Float32Array(3*e.length*2);this.addAttribute("uv",new c.BufferAttribute(m,2))}for(var n=0,o=0,p=0;n<e.length;n++,o+=6,p+=9){var q=e[n],r=d[q.a],s=d[q.b],t=d[q.c];if(j[p]=r.x,j[p+1]=r.y,j[p+2]=r.z,j[p+3]=s.x,j[p+4]=s.y,j[p+5]=s.z,j[p+6]=t.x,j[p+7]=t.y,j[p+8]=t.z,!0===i){var u=q.vertexNormals[0],v=q.vertexNormals[1],w=q.vertexNormals[2];k[p]=u.x,k[p+1]=u.y,k[p+2]=u.z,k[p+3]=v.x,k[p+4]=v.y,k[p+5]=v.z,k[p+6]=w.x,k[p+7]=w.y,k[p+8]=w.z}else{var x=q.normal;k[p]=x.x,k[p+1]=x.y,k[p+2]=x.z,k[p+3]=x.x,k[p+4]=x.y,k[p+5]=x.z,k[p+6]=x.x,k[p+7]=x.y,k[p+8]=x.z}if(g===c.FaceColors){var y=q.color;l[p]=y.r,l[p+1]=y.g,l[p+2]=y.b,l[p+3]=y.r,l[p+4]=y.g,l[p+5]=y.b,l[p+6]=y.r,l[p+7]=y.g,l[p+8]=y.b}else if(g===c.VertexColors){var z=q.vertexColors[0],A=q.vertexColors[1],B=q.vertexColors[2];l[p]=z.r,l[p+1]=z.g,l[p+2]=z.b,l[p+3]=A.r,l[p+4]=A.g,l[p+5]=A.b,l[p+6]=B.r,l[p+7]=B.g,l[p+8]=B.b}if(!0===h){var C=f[0][n][0],D=f[0][n][1],E=f[0][n][2];m[o]=C.x,m[o+1]=C.y,m[o+2]=D.x,m[o+3]=D.y,m[o+4]=E.x,m[o+5]=E.y}}return this.computeBoundingSphere(),this},computeBoundingBox:function(){var a=new c.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new c.Box3);var b=this.attributes.position.array;if(b){var d=this.boundingBox;d.makeEmpty();for(var e=0,f=b.length;e<f;e+=3)a.set(b[e],b[e+1],b[e+2]),d.expandByPoint(a)}void 0!==b&&0!==b.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&c.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var a=new c.Box3,b=new c.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new c.Sphere);var d=this.attributes.position.array;if(d){a.makeEmpty();for(var e=this.boundingSphere.center,f=0,g=d.length;f<g;f+=3)b.set(d[f],d[f+1],d[f+2]),a.expandByPoint(b);a.center(e);for(var h=0,f=0,g=d.length;f<g;f+=3)b.set(d[f],d[f+1],d[f+2]),h=Math.max(h,e.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(h),isNaN(this.boundingSphere.radius)&&c.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.attributes;if(a.position){var b=a.position.array;if(void 0===a.normal)this.addAttribute("normal",new c.BufferAttribute(new Float32Array(b.length),3));else for(var d=a.normal.array,e=0,f=d.length;e<f;e++)d[e]=0;var g,h,i,d=a.normal.array,j=new c.Vector3,k=new c.Vector3,l=new c.Vector3,m=new c.Vector3,n=new c.Vector3;if(a.index)for(var o=a.index.array,p=this.offsets.length>0?this.offsets:[{start:0,count:o.length,index:0}],q=0,r=p.length;q<r;++q)for(var s=p[q].start,t=p[q].count,u=p[q].index,e=s,f=s+t;e<f;e+=3)g=3*(u+o[e]),h=3*(u+o[e+1]),i=3*(u+o[e+2]),j.fromArray(b,g),k.fromArray(b,h),l.fromArray(b,i),m.subVectors(l,k),n.subVectors(j,k),m.cross(n),d[g]+=m.x,d[g+1]+=m.y,d[g+2]+=m.z,d[h]+=m.x,d[h+1]+=m.y,d[h+2]+=m.z,d[i]+=m.x,d[i+1]+=m.y,d[i+2]+=m.z;else for(var e=0,f=b.length;e<f;e+=9)j.fromArray(b,e),k.fromArray(b,e+3),l.fromArray(b,e+6),m.subVectors(l,k),n.subVectors(j,k),m.cross(n),d[e]=m.x,d[e+1]=m.y,d[e+2]=m.z,d[e+3]=m.x,d[e+4]=m.y,d[e+5]=m.z,d[e+6]=m.x,d[e+7]=m.y,d[e+8]=m.z;this.normalizeNormals(),a.normal.needsUpdate=!0}},computeTangents:function(){function a(a){U.fromArray(e,3*a),V.copy(U),Q=i[a],S.copy(Q),S.sub(U.multiplyScalar(U.dot(Q))).normalize(),T.crossVectors(V,Q),R=T.dot(j[a]),P=R<0?-1:1,h[4*a]=S.x,h[4*a+1]=S.y,h[4*a+2]=S.z,h[4*a+3]=P}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)return void c.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");var b=this.attributes.index.array,d=this.attributes.position.array,e=this.attributes.normal.array,f=this.attributes.uv.array,g=d.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new c.BufferAttribute(new Float32Array(4*g),4));for(var h=this.attributes.tangent.array,i=[],j=[],k=0;k<g;k++)i[k]=new c.Vector3,j[k]=new c.Vector3;var l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=new c.Vector3,E=new c.Vector3,F=new c.Vector3,G=new c.Vector2,H=new c.Vector2,I=new c.Vector2,J=new c.Vector3,K=new c.Vector3;0===this.drawcalls.length&&this.addDrawCall(0,b.length,0);var L=this.drawcalls;for(y=0,z=L.length;y<z;++y){var M=L[y].start,N=L[y].count,O=L[y].index;for(w=M,x=M+N;w<x;w+=3)A=O+b[w],B=O+b[w+1],C=O+b[w+2],function(a,b,c){D.fromArray(d,3*a),E.fromArray(d,3*b),F.fromArray(d,3*c),G.fromArray(f,2*a),H.fromArray(f,2*b),I.fromArray(f,2*c),l=E.x-D.x,m=F.x-D.x,n=E.y-D.y,o=F.y-D.y,p=E.z-D.z,q=F.z-D.z,r=H.x-G.x,s=I.x-G.x,t=H.y-G.y,u=I.y-G.y,v=1/(r*u-s*t),J.set((u*l-t*m)*v,(u*n-t*o)*v,(u*p-t*q)*v),K.set((r*m-s*l)*v,(r*o-s*n)*v,(r*q-s*p)*v),i[a].add(J),i[b].add(J),i[c].add(J),j[a].add(K),j[b].add(K),j[c].add(K)}(A,B,C)}var P,Q,R,S=new c.Vector3,T=new c.Vector3,U=new c.Vector3,V=new c.Vector3;for(y=0,z=L.length;y<z;++y){var M=L[y].start,N=L[y].count,O=L[y].index;for(w=M,x=M+N;w<x;w+=3)A=O+b[w],B=O+b[w+1],C=O+b[w+2],a(A),a(B),a(C)}},computeOffsets:function(a){void 0===a&&(a=65535);for(var b=this.attributes.index.array,c=this.attributes.position.array,d=b.length/3,e=new Uint16Array(b.length),f=0,g=0,h=[{start:0,count:0,index:0}],i=h[0],j=0,k=0,l=new Int32Array(6),m=new Int32Array(c.length),n=new Int32Array(c.length),o=0;o<c.length;o++)m[o]=-1,n[o]=-1;for(var p=0;p<d;p++){k=0;for(var q=0;q<3;q++){var r=b[3*p+q]
;-1==m[r]?(l[2*q]=r,l[2*q+1]=-1,k++):m[r]<i.index?(l[2*q]=r,l[2*q+1]=-1,j++):(l[2*q]=r,l[2*q+1]=m[r])}if(g+k>i.index+a){var s={start:f,count:0,index:g};h.push(s),i=s;for(var t=0;t<6;t+=2){var u=l[t+1];u>-1&&u<i.index&&(l[t+1]=-1)}}for(var t=0;t<6;t+=2){var r=l[t],u=l[t+1];-1===u&&(u=g++),m[r]=u,n[u]=r,e[f++]=u-i.index,i.count++}}return this.reorderBuffers(e,n,g),this.offsets=h,this.drawcalls=h,h},merge:function(a,b){if(a instanceof c.BufferGeometry==!1)return void c.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a);void 0===b&&(b=0);var d=this.attributes;for(var e in d)if(void 0!==a.attributes[e])for(var f=d[e],g=f.array,h=a.attributes[e],i=h.array,j=h.itemSize,k=0,l=j*b;k<i.length;k++,l++)g[l]=i[k];return this},normalizeNormals:function(){for(var a,b,c,d,e=this.attributes.normal.array,f=0,g=e.length;f<g;f+=3)a=e[f],b=e[f+1],c=e[f+2],d=1/Math.sqrt(a*a+b*b+c*c),e[f]*=d,e[f+1]*=d,e[f+2]*=d},reorderBuffers:function(a,b,c){var d={};for(var e in this.attributes)if("index"!=e){var f=this.attributes[e].array;d[e]=new f.constructor(this.attributes[e].itemSize*c)}for(var g=0;g<c;g++){var h=b[g];for(var e in this.attributes)if("index"!=e)for(var i=this.attributes[e].array,j=this.attributes[e].itemSize,k=d[e],l=0;l<j;l++)k[g*j+l]=i[h*j+l]}this.attributes.index.array=a;for(var e in this.attributes)"index"!=e&&(this.attributes[e].array=d[e],this.attributes[e].numItems=this.attributes[e].itemSize*c)},toJSON:function(){var a={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},b=this.attributes,c=this.offsets,d=this.boundingSphere;for(var e in b){var f=b[e],g=Array.prototype.slice.call(f.array);a.data.attributes[e]={itemSize:f.itemSize,type:f.array.constructor.name,array:g}}return c.length>0&&(a.data.offsets=JSON.parse(JSON.stringify(c))),null!==d&&(a.data.boundingSphere={center:d.center.toArray(),radius:d.radius}),a},clone:function(){var a=new c.BufferGeometry;for(var b in this.attributes){var d=this.attributes[b];a.addAttribute(b,d.clone())}for(var e=0,f=this.offsets.length;e<f;e++){var g=this.offsets[e];a.offsets.push({start:g.start,index:g.index,count:g.count})}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}},c.EventDispatcher.prototype.apply(c.BufferGeometry.prototype),c.Geometry=function(){Object.defineProperty(this,"id",{value:c.GeometryIdCount++}),this.uuid=c.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},c.Geometry.prototype={constructor:c.Geometry,applyMatrix:function(a){for(var b=(new c.Matrix3).getNormalMatrix(a),d=0,e=this.vertices.length;d<e;d++){this.vertices[d].applyMatrix4(a)}for(var d=0,e=this.faces.length;d<e;d++){var f=this.faces[d];f.normal.applyMatrix3(b).normalize();for(var g=0,h=f.vertexNormals.length;g<h;g++)f.vertexNormals[g].applyMatrix3(b).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},fromBufferGeometry:function(a){for(var b=this,d=a.attributes,e=d.position.array,f=void 0!==d.index?d.index.array:void 0,g=void 0!==d.normal?d.normal.array:void 0,h=void 0!==d.color?d.color.array:void 0,i=void 0!==d.uv?d.uv.array:void 0,j=[],k=[],l=0,m=0;l<e.length;l+=3,m+=2)b.vertices.push(new c.Vector3(e[l],e[l+1],e[l+2])),void 0!==g&&j.push(new c.Vector3(g[l],g[l+1],g[l+2])),void 0!==h&&b.colors.push(new c.Color(h[l],h[l+1],h[l+2])),void 0!==i&&k.push(new c.Vector2(i[m],i[m+1]));var n=function(a,d,e){var f=void 0!==g?[j[a].clone(),j[d].clone(),j[e].clone()]:[],l=void 0!==h?[b.colors[a].clone(),b.colors[d].clone(),b.colors[e].clone()]:[];b.faces.push(new c.Face3(a,d,e,f,l)),void 0!==i&&b.faceVertexUvs[0].push([k[a].clone(),k[d].clone(),k[e].clone()])};if(void 0!==f){var o=a.drawcalls;if(o.length>0)for(var l=0;l<o.length;l++)for(var p=o[l],q=p.start,r=p.count,s=p.index,m=q,t=q+r;m<t;m+=3)n(s+f[m],s+f[m+1],s+f[m+2]);else for(var l=0;l<f.length;l+=3)n(f[l],f[l+1],f[l+2])}else for(var l=0;l<e.length/3;l+=3)n(l,l+1,l+2);return this.computeFaceNormals(),null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone()),null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();return this.applyMatrix((new c.Matrix4).setPosition(a)),a},computeFaceNormals:function(){for(var a=new c.Vector3,b=new c.Vector3,d=0,e=this.faces.length;d<e;d++){var f=this.faces[d],g=this.vertices[f.a],h=this.vertices[f.b],i=this.vertices[f.c];a.subVectors(i,h),b.subVectors(g,h),a.cross(b),a.normalize(),f.normal.copy(a)}},computeVertexNormals:function(a){var b,d,e,f,g,h;for(h=new Array(this.vertices.length),b=0,d=this.vertices.length;b<d;b++)h[b]=new c.Vector3;if(a){var i,j,k,l=new c.Vector3,m=new c.Vector3;for(e=0,f=this.faces.length;e<f;e++)g=this.faces[e],i=this.vertices[g.a],j=this.vertices[g.b],k=this.vertices[g.c],l.subVectors(k,j),m.subVectors(i,j),l.cross(m),h[g.a].add(l),h[g.b].add(l),h[g.c].add(l)}else for(e=0,f=this.faces.length;e<f;e++)g=this.faces[e],h[g.a].add(g.normal),h[g.b].add(g.normal),h[g.c].add(g.normal);for(b=0,d=this.vertices.length;b<d;b++)h[b].normalize();for(e=0,f=this.faces.length;e<f;e++)g=this.faces[e],g.vertexNormals[0]=h[g.a].clone(),g.vertexNormals[1]=h[g.b].clone(),g.vertexNormals[2]=h[g.c].clone()},computeMorphNormals:function(){var a,b,d,e,f;for(d=0,e=this.faces.length;d<e;d++)for(f=this.faces[d],f.__originalFaceNormal?f.__originalFaceNormal.copy(f.normal):f.__originalFaceNormal=f.normal.clone(),f.__originalVertexNormals||(f.__originalVertexNormals=[]),a=0,b=f.vertexNormals.length;a<b;a++)f.__originalVertexNormals[a]?f.__originalVertexNormals[a].copy(f.vertexNormals[a]):f.__originalVertexNormals[a]=f.vertexNormals[a].clone();var g=new c.Geometry;for(g.faces=this.faces,a=0,b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={},this.morphNormals[a].faceNormals=[],this.morphNormals[a].vertexNormals=[];var h,i,j=this.morphNormals[a].faceNormals,k=this.morphNormals[a].vertexNormals;for(d=0,e=this.faces.length;d<e;d++)h=new c.Vector3,i={a:new c.Vector3,b:new c.Vector3,c:new c.Vector3},j.push(h),k.push(i)}var l=this.morphNormals[a];g.vertices=this.morphTargets[a].vertices,g.computeFaceNormals(),g.computeVertexNormals();var h,i;for(d=0,e=this.faces.length;d<e;d++)f=this.faces[d],h=l.faceNormals[d],i=l.vertexNormals[d],h.copy(f.normal),i.a.copy(f.vertexNormals[0]),i.b.copy(f.vertexNormals[1]),i.c.copy(f.vertexNormals[2])}for(d=0,e=this.faces.length;d<e;d++)f=this.faces[d],f.normal=f.__originalFaceNormal,f.vertexNormals=f.__originalVertexNormals},computeTangents:function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=[],E=[],F=new c.Vector3,G=new c.Vector3,H=new c.Vector3,I=new c.Vector3,J=new c.Vector3;for(d=0,e=this.vertices.length;d<e;d++)D[d]=new c.Vector3,E[d]=new c.Vector3;for(a=0,b=this.faces.length;a<b;a++)h=this.faces[a],i=this.faceVertexUvs[0][a],function(a,b,c,d,e,f,g){j=a.vertices[b],k=a.vertices[c],l=a.vertices[d],m=i[e],n=i[f],o=i[g],p=k.x-j.x,q=l.x-j.x,r=k.y-j.y,s=l.y-j.y,t=k.z-j.z,u=l.z-j.z,v=n.x-m.x,w=o.x-m.x,x=n.y-m.y,y=o.y-m.y,z=1/(v*y-w*x),F.set((y*p-x*q)*z,(y*r-x*s)*z,(y*t-x*u)*z),G.set((v*q-w*p)*z,(v*s-w*r)*z,(v*u-w*t)*z),D[b].add(F),D[c].add(F),D[d].add(F),E[b].add(G),E[c].add(G),E[d].add(G)}(this,h.a,h.b,h.c,0,1,2);var K=["a","b","c","d"];for(a=0,b=this.faces.length;a<b;a++)for(h=this.faces[a],f=0;f<Math.min(h.vertexNormals.length,3);f++)J.copy(h.vertexNormals[f]),g=h[K[f]],A=D[g],H.copy(A),H.sub(J.multiplyScalar(J.dot(A))).normalize(),I.crossVectors(h.vertexNormals[f],A),B=I.dot(E[g]),C=B<0?-1:1,h.vertexTangents[f]=new c.Vector4(H.x,H.y,H.z,C);this.hasTangents=!0},computeLineDistances:function(){for(var a=0,b=this.vertices,c=0,d=b.length;c<d;c++)c>0&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new c.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new c.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,d){if(a instanceof c.Geometry==!1)return void c.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a);var e,f=this.vertices.length,g=this.vertices,h=a.vertices,i=this.faces,j=a.faces,k=this.faceVertexUvs[0],l=a.faceVertexUvs[0];void 0===d&&(d=0),void 0!==b&&(e=(new c.Matrix3).getNormalMatrix(b));for(var m=0,n=h.length;m<n;m++){var o=h[m],p=o.clone();void 0!==b&&p.applyMatrix4(b),g.push(p)}for(m=0,n=j.length;m<n;m++){var q,r,s,t=j[m],u=t.vertexNormals,v=t.vertexColors;q=new c.Face3(t.a+f,t.b+f,t.c+f),q.normal.copy(t.normal),void 0!==e&&q.normal.applyMatrix3(e).normalize();for(var w=0,x=u.length;w<x;w++)r=u[w].clone(),void 0!==e&&r.applyMatrix3(e).normalize(),q.vertexNormals.push(r);q.color.copy(t.color);for(var w=0,x=v.length;w<x;w++)s=v[w],q.vertexColors.push(s.clone());q.materialIndex=t.materialIndex+d,i.push(q)}for(m=0,n=l.length;m<n;m++){var y=l[m],z=[];if(void 0!==y){for(var w=0,x=y.length;w<x;w++)z.push(y[w].clone());k.push(z)}}},mergeMesh:function(a){if(a instanceof c.Mesh==!1)return void c.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a);a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,a.matrix)},mergeVertices:function(){var a,b,c,d,e,f,g,h,i={},j=[],k=[],l=Math.pow(10,4);for(c=0,d=this.vertices.length;c<d;c++)a=this.vertices[c],b=Math.round(a.x*l)+"_"+Math.round(a.y*l)+"_"+Math.round(a.z*l),void 0===i[b]?(i[b]=c,j.push(this.vertices[c]),k[c]=j.length-1):k[c]=k[i[b]];var m=[];for(c=0,d=this.faces.length;c<d;c++){e=this.faces[c],e.a=k[e.a],e.b=k[e.b],e.c=k[e.c],f=[e.a,e.b,e.c];for(var n=0;n<3;n++)if(f[n]==f[(n+1)%3]){n,m.push(c);break}}for(c=m.length-1;c>=0;c--){var o=m[c];for(this.faces.splice(o,1),g=0,h=this.faceVertexUvs.length;g<h;g++)this.faceVertexUvs[g].splice(o,1)}var p=this.vertices.length-j.length;return this.vertices=j,p},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=a.x.toString()+a.y.toString()+a.z.toString();return void 0!==m[b]?m[b]:(m[b]=l.length/3,l.push(a.x,a.y,a.z),m[b])}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();return void 0!==o[b]?o[b]:(o[b]=n.length,n.push(a.getHex()),o[b])}function d(a){var b=a.x.toString()+a.y.toString();return void 0!==q[b]?q[b]:(q[b]=p.length/2,p.push(a.x,a.y),q[b])}var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(""!==this.name&&(e.name=this.name),void 0!==this.parameters){var f=this.parameters;for(var g in f)void 0!==f[g]&&(e[g]=f[g]);return e}for(var h=[],i=0;i<this.vertices.length;i++){var j=this.vertices[i];h.push(j.x,j.y,j.z)}for(var k=[],l=[],m={},n=[],o={},p=[],q={},i=0;i<this.faces.length;i++){var r=this.faces[i],s=void 0!==this.faceVertexUvs[0][i],t=r.normal.length()>0,u=r.vertexNormals.length>0,v=1!==r.color.r||1!==r.color.g||1!==r.color.b,w=r.vertexColors.length>0,x=0;if(x=a(x,0,0),x=a(x,1,!1),x=a(x,2,!1),x=a(x,3,s),x=a(x,4,t),x=a(x,5,u),x=a(x,6,v),x=a(x,7,w),k.push(x),k.push(r.a,r.b,r.c),s){var y=this.faceVertexUvs[0][i];k.push(d(y[0]),d(y[1]),d(y[2]))}if(t&&k.push(b(r.normal)),u){var z=r.vertexNormals;k.push(b(z[0]),b(z[1]),b(z[2]))}if(v&&k.push(c(r.color)),w){var A=r.vertexColors;k.push(c(A[0]),c(A[1]),c(A[2]))}}return e.data={},e.data.vertices=h,e.data.normals=l,n.length>0&&(e.data.colors=n),p.length>0&&(e.data.uvs=[p]),e.data.faces=k,e},clone:function(){for(var a=new c.Geometry,b=this.vertices,d=0,e=b.length;d<e;d++)a.vertices.push(b[d].clone());for(var f=this.faces,d=0,e=f.length;d<e;d++)a.faces.push(f[d].clone());for(var d=0,e=this.faceVertexUvs.length;d<e;d++){var g=this.faceVertexUvs[d];void 0===a.faceVertexUvs[d]&&(a.faceVertexUvs[d]=[]);for(var h=0,i=g.length;h<i;h++){for(var j=g[h],k=[],l=0,m=j.length;l<m;l++){var n=j[l];k.push(n.clone())}a.faceVertexUvs[d].push(k)}}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}},c.EventDispatcher.prototype.apply(c.Geometry.prototype),c.GeometryIdCount=0,c.Camera=function(){c.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new c.Matrix4,this.projectionMatrix=new c.Matrix4},c.Camera.prototype=Object.create(c.Object3D.prototype),c.Camera.prototype.constructor=c.Camera,c.Camera.prototype.getWorldDirection=function(){var a=new c.Quaternion;return function(b){var d=b||new c.Vector3;return this.getWorldQuaternion(a),d.set(0,0,-1).applyQuaternion(a)}}(),c.Camera.prototype.lookAt=function(){var a=new c.Matrix4;return function(b){a.lookAt(this.position,b,this.up),this.quaternion.setFromRotationMatrix(a)}}(),c.Camera.prototype.clone=function(a){return void 0===a&&(a=new c.Camera),c.Object3D.prototype.clone.call(this,a),a.matrixWorldInverse.copy(this.matrixWorldInverse),a.projectionMatrix.copy(this.projectionMatrix),a},c.CubeCamera=function(a,b,d){c.Object3D.call(this),this.type="CubeCamera";var e=new c.PerspectiveCamera(90,1,a,b);e.up.set(0,-1,0),e.lookAt(new c.Vector3(1,0,0)),this.add(e);var f=new c.PerspectiveCamera(90,1,a,b);f.up.set(0,-1,0),f.lookAt(new c.Vector3(-1,0,0)),this.add(f);var g=new c.PerspectiveCamera(90,1,a,b);g.up.set(0,0,1),g.lookAt(new c.Vector3(0,1,0)),this.add(g);var h=new c.PerspectiveCamera(90,1,a,b);h.up.set(0,0,-1),h.lookAt(new c.Vector3(0,-1,0)),this.add(h);var i=new c.PerspectiveCamera(90,1,a,b);i.up.set(0,-1,0),i.lookAt(new c.Vector3(0,0,1)),this.add(i);var j=new c.PerspectiveCamera(90,1,a,b);j.up.set(0,-1,0),j.lookAt(new c.Vector3(0,0,-1)),this.add(j),this.renderTarget=new c.WebGLRenderTargetCube(d,d,{format:c.RGBFormat,magFilter:c.LinearFilter,minFilter:c.LinearFilter}),this.updateCubeMap=function(a,b){var c=this.renderTarget,d=c.generateMipmaps;c.generateMipmaps=!1,c.activeCubeFace=0,a.render(b,e,c),c.activeCubeFace=1,a.render(b,f,c),c.activeCubeFace=2,a.render(b,g,c),c.activeCubeFace=3,a.render(b,h,c),c.activeCubeFace=4,a.render(b,i,c),c.generateMipmaps=d,c.activeCubeFace=5,a.render(b,j,c)}},c.CubeCamera.prototype=Object.create(c.Object3D.prototype),c.CubeCamera.prototype.constructor=c.CubeCamera,c.OrthographicCamera=function(a,b,d,e,f,g){c.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=a,this.right=b,this.top=d,this.bottom=e,this.near=void 0!==f?f:.1,this.far=void 0!==g?g:2e3,this.updateProjectionMatrix()},c.OrthographicCamera.prototype=Object.create(c.Camera.prototype),c.OrthographicCamera.prototype.constructor=c.OrthographicCamera,c.OrthographicCamera.prototype.updateProjectionMatrix=function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(c-a,c+a,d+b,d-b,this.near,this.far)},c.OrthographicCamera.prototype.clone=function(){var a=new c.OrthographicCamera;return c.Camera.prototype.clone.call(this,a),a.zoom=this.zoom,a.left=this.left,a.right=this.right,a.top=this.top,a.bottom=this.bottom,a.near=this.near,a.far=this.far,a.projectionMatrix.copy(this.projectionMatrix),a},c.PerspectiveCamera=function(a,b,d,e){c.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==a?a:50,this.aspect=void 0!==b?b:1,this.near=void 0!==d?d:.1,this.far=void 0!==e?e:2e3,this.updateProjectionMatrix()},c.PerspectiveCamera.prototype=Object.create(c.Camera.prototype),c.PerspectiveCamera.prototype.constructor=c.PerspectiveCamera,c.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24),this.fov=2*c.Math.radToDeg(Math.atan(b/(2*a))),this.updateProjectionMatrix()},c.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a,this.fullHeight=b,this.x=c,this.y=d,this.width=e,this.height=f,this.updateProjectionMatrix()},c.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=c.Math.radToDeg(2*Math.atan(Math.tan(.5*c.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var b=this.fullWidth/this.fullHeight,d=Math.tan(c.Math.degToRad(.5*a))*this.near,e=-d,f=b*e,g=b*d,h=Math.abs(g-f),i=Math.abs(d-e);this.projectionMatrix.makeFrustum(f+this.x*h/this.fullWidth,f+(this.x+this.width)*h/this.fullWidth,d-(this.y+this.height)*i/this.fullHeight,d-this.y*i/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(a,this.aspect,this.near,this.far)},c.PerspectiveCamera.prototype.clone=function(){var a=new c.PerspectiveCamera;return c.Camera.prototype.clone.call(this,a),a.zoom=this.zoom,a.fov=this.fov,a.aspect=this.aspect,a.near=this.near,a.far=this.far,a.projectionMatrix.copy(this.projectionMatrix),a},c.Light=function(a){c.Object3D.call(this),this.type="Light",this.color=new c.Color(a)},c.Light.prototype=Object.create(c.Object3D.prototype),c.Light.prototype.constructor=c.Light,c.Light.prototype.clone=function(a){return void 0===a&&(a=new c.Light),c.Object3D.prototype.clone.call(this,a),a.color.copy(this.color),a},c.AmbientLight=function(a){c.Light.call(this,a),this.type="AmbientLight"},c.AmbientLight.prototype=Object.create(c.Light.prototype),c.AmbientLight.prototype.constructor=c.AmbientLight,c.AmbientLight.prototype.clone=function(){var a=new c.AmbientLight;return c.Light.prototype.clone.call(this,a),a},c.AreaLight=function(a,b){c.Light.call(this,a),this.type="AreaLight",this.normal=new c.Vector3(0,-1,0),this.right=new c.Vector3(1,0,0),this.intensity=void 0!==b?b:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},c.AreaLight.prototype=Object.create(c.Light.prototype),c.AreaLight.prototype.constructor=c.AreaLight,c.DirectionalLight=function(a,b){c.Light.call(this,a),this.type="DirectionalLight",this.position.set(0,1,0),this.target=new c.Object3D,this.intensity=void 0!==b?b:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new c.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null};c.DirectionalLight.prototype=Object.create(c.Light.prototype),c.DirectionalLight.prototype.constructor=c.DirectionalLight,c.DirectionalLight.prototype.clone=function(){var a=new c.DirectionalLight;return c.Light.prototype.clone.call(this,a),a.target=this.target.clone(),a.intensity=this.intensity,a.castShadow=this.castShadow,a.onlyShadow=this.onlyShadow,a.shadowCameraNear=this.shadowCameraNear,a.shadowCameraFar=this.shadowCameraFar,a.shadowCameraLeft=this.shadowCameraLeft,a.shadowCameraRight=this.shadowCameraRight,a.shadowCameraTop=this.shadowCameraTop,a.shadowCameraBottom=this.shadowCameraBottom,a.shadowCameraVisible=this.shadowCameraVisible,a.shadowBias=this.shadowBias,a.shadowDarkness=this.shadowDarkness,a.shadowMapWidth=this.shadowMapWidth,a.shadowMapHeight=this.shadowMapHeight,a.shadowCascade=this.shadowCascade,a.shadowCascadeOffset.copy(this.shadowCascadeOffset),a.shadowCascadeCount=this.shadowCascadeCount,a.shadowCascadeBias=this.shadowCascadeBias.slice(0),a.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),a.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),a.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),a.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),a},c.HemisphereLight=function(a,b,d){c.Light.call(this,a),this.type="HemisphereLight",this.position.set(0,100,0),this.groundColor=new c.Color(b),this.intensity=void 0!==d?d:1},c.HemisphereLight.prototype=Object.create(c.Light.prototype),c.HemisphereLight.prototype.constructor=c.HemisphereLight,c.HemisphereLight.prototype.clone=function(){var a=new c.HemisphereLight;return c.Light.prototype.clone.call(this,a),a.groundColor.copy(this.groundColor),a.intensity=this.intensity,a},c.PointLight=function(a,b,d,e){c.Light.call(this,a),this.type="PointLight",this.intensity=void 0!==b?b:1,this.distance=void 0!==d?d:0,this.decay=void 0!==e?e:1},c.PointLight.prototype=Object.create(c.Light.prototype),c.PointLight.prototype.constructor=c.PointLight,c.PointLight.prototype.clone=function(){var a=new c.PointLight;return c.Light.prototype.clone.call(this,a),a.intensity=this.intensity,a.distance=this.distance,a.decay=this.decay,a},c.SpotLight=function(a,b,d,e,f,g){c.Light.call(this,a),this.type="SpotLight",this.position.set(0,1,0),this.target=new c.Object3D,this.intensity=void 0!==b?b:1,this.distance=void 0!==d?d:0,this.angle=void 0!==e?e:Math.PI/3,this.exponent=void 0!==f?f:10,this.decay=void 0!==g?g:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},c.SpotLight.prototype=Object.create(c.Light.prototype),c.SpotLight.prototype.constructor=c.SpotLight,c.SpotLight.prototype.clone=function(){var a=new c.SpotLight;return c.Light.prototype.clone.call(this,a),a.target=this.target.clone(),a.intensity=this.intensity,a.distance=this.distance,a.angle=this.angle,a.exponent=this.exponent,a.decay=this.decay,a.castShadow=this.castShadow,a.onlyShadow=this.onlyShadow,a.shadowCameraNear=this.shadowCameraNear,a.shadowCameraFar=this.shadowCameraFar,a.shadowCameraFov=this.shadowCameraFov,a.shadowCameraVisible=this.shadowCameraVisible,a.shadowBias=this.shadowBias,a.shadowDarkness=this.shadowDarkness,a.shadowMapWidth=this.shadowMapWidth,a.shadowMapHeight=this.shadowMapHeight,a},c.Cache={files:{},add:function(a,b){this.files[a]=b},get:function(a){return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}},c.Loader=function(a){this.showStatus=a,this.statusDomElement=a?c.Loader.prototype.addStatusElement():null,this.imageLoader=new c.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},c.Loader.prototype={constructor:c.Loader,crossOrigin:void 0,addStatusElement:function(){var a=document.createElement("div");return a.style.position="absolute",a.style.right="0px",a.style.top="0px",a.style.fontSize="0.8em",a.style.textAlign="left",a.style.background="rgba(0,0,0,0.25)",a.style.color="#fff",a.style.width="120px",a.style.padding="0.5em 0.5em 0.5em 0.5em",a.style.zIndex=1e3,a.innerHTML="Loading ...",a},updateProgress:function(a){var b="Loaded ";a.total?b+=(100*a.loaded/a.total).toFixed(0)+"%":b+=(a.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=b},extractUrlBase:function(a){var b=a.split("/");return 1===b.length?"./":(b.pop(),b.join("/")+"/")},initMaterials:function(a,b){for(var c=[],d=0;d<a.length;++d)c[d]=this.createMaterial(a[d],b);return c},needsTangents:function(a){for(var b=0,d=a.length;b<d;b++){if(a[b]instanceof c.ShaderMaterial)return!0}return!1},createMaterial:function(a,b){function d(a){var b=Math.log(a)/Math.LN2;return Math.pow(2,Math.round(b))}function e(a,e,f,h,i,j,k){var l,m=b+f,n=c.Loader.Handlers.get(m);if(null!==n?l=n.load(m):(l=new c.Texture,n=g.imageLoader,n.crossOrigin=g.crossOrigin,n.load(m,function(a){if(!1===c.Math.isPowerOfTwo(a.width)||!1===c.Math.isPowerOfTwo(a.height)){var b=d(a.width),e=d(a.height),f=document.createElement("canvas");f.width=b,f.height=e;f.getContext("2d").drawImage(a,0,0,b,e),l.image=f}else l.image=a;l.needsUpdate=!0})),l.sourceFile=f,h&&(l.repeat.set(h[0],h[1]),1!==h[0]&&(l.wrapS=c.RepeatWrapping),1!==h[1]&&(l.wrapT=c.RepeatWrapping)),i&&l.offset.set(i[0],i[1]),j){var o={repeat:c.RepeatWrapping,mirror:c.MirroredRepeatWrapping};void 0!==o[j[0]]&&(l.wrapS=o[j[0]]),void 0!==o[j[1]]&&(l.wrapT=o[j[1]])}k&&(l.anisotropy=k),a[e]=l}function f(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]}var g=this,h="MeshLambertMaterial",i={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(a.shading){var j=a.shading.toLowerCase();"phong"===j?h="MeshPhongMaterial":"basic"===j&&(h="MeshBasicMaterial")}void 0!==a.blending&&void 0!==c[a.blending]&&(i.blending=c[a.blending]),void 0!==a.transparent&&(i.transparent=a.transparent),void 0!==a.opacity&&a.opacity<1&&(i.transparent=!0),void 0!==a.depthTest&&(i.depthTest=a.depthTest),void 0!==a.depthWrite&&(i.depthWrite=a.depthWrite),void 0!==a.visible&&(i.visible=a.visible),void 0!==a.flipSided&&(i.side=c.BackSide),void 0!==a.doubleSided&&(i.side=c.DoubleSide),void 0!==a.wireframe&&(i.wireframe=a.wireframe),void 0!==a.vertexColors&&("face"===a.vertexColors?i.vertexColors=c.FaceColors:a.vertexColors&&(i.vertexColors=c.VertexColors)),a.colorDiffuse?i.color=f(a.colorDiffuse):a.DbgColor&&(i.color=a.DbgColor),a.colorSpecular&&(i.specular=f(a.colorSpecular)),a.colorEmissive&&(i.emissive=f(a.colorEmissive)),void 0!==a.transparency&&(console.warn("THREE.Loader: transparency has been renamed to opacity"),a.opacity=a.transparency),void 0!==a.opacity&&(i.opacity=a.opacity),a.specularCoef&&(i.shininess=a.specularCoef),a.mapDiffuse&&b&&e(i,"map",a.mapDiffuse,a.mapDiffuseRepeat,a.mapDiffuseOffset,a.mapDiffuseWrap,a.mapDiffuseAnisotropy),a.mapLight&&b&&e(i,"lightMap",a.mapLight,a.mapLightRepeat,a.mapLightOffset,a.mapLightWrap,a.mapLightAnisotropy),a.mapBump&&b&&e(i,"bumpMap",a.mapBump,a.mapBumpRepeat,a.mapBumpOffset,a.mapBumpWrap,a.mapBumpAnisotropy),a.mapNormal&&b&&e(i,"normalMap",a.mapNormal,a.mapNormalRepeat,a.mapNormalOffset,a.mapNormalWrap,a.mapNormalAnisotropy),a.mapSpecular&&b&&e(i,"specularMap",a.mapSpecular,a.mapSpecularRepeat,a.mapSpecularOffset,a.mapSpecularWrap,a.mapSpecularAnisotropy),a.mapAlpha&&b&&e(i,"alphaMap",a.mapAlpha,a.mapAlphaRepeat,a.mapAlphaOffset,a.mapAlphaWrap,a.mapAlphaAnisotropy),a.mapBumpScale&&(i.bumpScale=a.mapBumpScale),a.mapNormalFactor&&(i.normalScale=new c.Vector2(a.mapNormalFactor,a.mapNormalFactor));var k=new c[h](i);return void 0!==a.DbgName&&(k.name=a.DbgName),k}},c.Loader.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=0,c=this.handlers.length;b<c;b+=2){var d=this.handlers[b],e=this.handlers[b+1];if(d.test(a))return e}return null}},c.XHRLoader=function(a){this.manager=void 0!==a?a:c.DefaultLoadingManager},c.XHRLoader.prototype={constructor:c.XHRLoader,load:function(a,b,d,e){var f=this,g=c.Cache.get(a);if(void 0!==g)return void(b&&b(g));var h=new XMLHttpRequest;h.open("GET",a,!0),h.addEventListener("load",function(d){c.Cache.add(a,this.response),b&&b(this.response),f.manager.itemEnd(a)},!1),void 0!==d&&h.addEventListener("progress",function(a){d(a)},!1),void 0!==e&&h.addEventListener("error",function(a){e(a)},!1),void 0!==this.crossOrigin&&(h.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(h.responseType=this.responseType),h.send(null),f.manager.itemStart(a)},setResponseType:function(a){this.responseType=a},setCrossOrigin:function(a){this.crossOrigin=a}},c.ImageLoader=function(a){this.manager=void 0!==a?a:c.DefaultLoadingManager},c.ImageLoader.prototype={constructor:c.ImageLoader,load:function(a,b,d,e){var f=this,g=c.Cache.get(a);if(void 0!==g)return void b(g);var h=document.createElement("img");return h.addEventListener("load",function(d){c.Cache.add(a,this),b&&b(this),f.manager.itemEnd(a)},!1),void 0!==d&&h.addEventListener("progress",function(a){d(a)},!1),void 0!==e&&h.addEventListener("error",function(a){e(a)},!1),void 0!==this.crossOrigin&&(h.crossOrigin=this.crossOrigin),h.src=a,f.manager.itemStart(a),h},setCrossOrigin:function(a){this.crossOrigin=a}},c.JSONLoader=function(a){c.Loader.call(this,a),this.withCredentials=!1},c.JSONLoader.prototype=Object.create(c.Loader.prototype),c.JSONLoader.prototype.constructor=c.JSONLoader,c.JSONLoader.prototype.load=function(a,b,c){c=c&&"string"==typeof c?c:this.extractUrlBase(a),this.onLoadStart(),this.loadAjaxJSON(this,a,b,c)},c.JSONLoader.prototype.loadAjaxJSON=function(a,b,d,e,f){var g=new XMLHttpRequest,h=0;g.onreadystatechange=function(){if(g.readyState===g.DONE)if(200===g.status||0===g.status){if(g.responseText){var i=JSON.parse(g.responseText),j=i.metadata;if(void 0!==j){if("object"===j.type)return void c.error("THREE.JSONLoader: "+b+" should be loaded with THREE.ObjectLoader instead.");if("scene"===j.type)return void c.error("THREE.JSONLoader: "+b+" seems to be a Scene. Use THREE.SceneLoader instead.")}var k=a.parse(i,e);d(k.geometry,k.materials)}else c.error("THREE.JSONLoader: "+b+" seems to be unreachable or the file is empty.");a.onLoadComplete()}else c.error("THREE.JSONLoader: Couldn't load "+b+" ("+g.status+")");else g.readyState===g.LOADING?f&&(0===h&&(h=g.getResponseHeader("Content-Length")),f({total:h,loaded:g.responseText.length})):g.readyState===g.HEADERS_RECEIVED&&void 0!==f&&(h=g.getResponseHeader("Content-Length"))},g.open("GET",b,!0),g.withCredentials=this.withCredentials,g.send(null)},c.JSONLoader.prototype.parse=function(a,b){var d=new c.Geometry,e=void 0!==a.scale?1/a.scale:1;if(function(b){function e(a,b){return a&1<<b}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=a.faces,H=a.vertices,I=a.normals,J=a.colors,K=0;if(void 0!==a.uvs){for(f=0;f<a.uvs.length;f++)a.uvs[f].length&&K++;for(f=0;f<K;f++)d.faceVertexUvs[f]=[]}for(i=0,j=H.length;i<j;)w=new c.Vector3,w.x=H[i++]*b,w.y=H[i++]*b,w.z=H[i++]*b,d.vertices.push(w);for(i=0,j=G.length;i<j;)if(o=G[i++],p=e(o,0),q=e(o,1),r=e(o,3),s=e(o,4),t=e(o,5),u=e(o,6),v=e(o,7),p){if(y=new c.Face3,y.a=G[i],y.b=G[i+1],y.c=G[i+3],z=new c.Face3,z.a=G[i+1],z.b=G[i+2],z.c=G[i+3],i+=4,q&&(n=G[i++],y.materialIndex=n,z.materialIndex=n),h=d.faces.length,r)for(f=0;f<K;f++)for(C=a.uvs[f],d.faceVertexUvs[f][h]=[],d.faceVertexUvs[f][h+1]=[],g=0;g<4;g++)m=G[i++],E=C[2*m],F=C[2*m+1],D=new c.Vector2(E,F),2!==g&&d.faceVertexUvs[f][h].push(D),0!==g&&d.faceVertexUvs[f][h+1].push(D);if(s&&(l=3*G[i++],y.normal.set(I[l++],I[l++],I[l]),z.normal.copy(y.normal)),t)for(f=0;f<4;f++)l=3*G[i++],B=new c.Vector3(I[l++],I[l++],I[l]),2!==f&&y.vertexNormals.push(B),0!==f&&z.vertexNormals.push(B);if(u&&(k=G[i++],A=J[k],y.color.setHex(A),z.color.setHex(A)),v)for(f=0;f<4;f++)k=G[i++],A=J[k],2!==f&&y.vertexColors.push(new c.Color(A)),0!==f&&z.vertexColors.push(new c.Color(A));d.faces.push(y),d.faces.push(z)}else{if(x=new c.Face3,x.a=G[i++],x.b=G[i++],x.c=G[i++],q&&(n=G[i++],x.materialIndex=n),h=d.faces.length,r)for(f=0;f<K;f++)for(C=a.uvs[f],d.faceVertexUvs[f][h]=[],g=0;g<3;g++)m=G[i++],E=C[2*m],F=C[2*m+1],D=new c.Vector2(E,F),d.faceVertexUvs[f][h].push(D);if(s&&(l=3*G[i++],x.normal.set(I[l++],I[l++],I[l])),t)for(f=0;f<3;f++)l=3*G[i++],B=new c.Vector3(I[l++],I[l++],I[l]),x.vertexNormals.push(B);if(u&&(k=G[i++],x.color.setHex(J[k])),v)for(f=0;f<3;f++)k=G[i++],x.vertexColors.push(new c.Color(J[k]));d.faces.push(x)}}(e),function(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var e=0,f=a.skinWeights.length;e<f;e+=b){var g=a.skinWeights[e],h=b>1?a.skinWeights[e+1]:0,i=b>2?a.skinWeights[e+2]:0,j=b>3?a.skinWeights[e+3]:0;d.skinWeights.push(new c.Vector4(g,h,i,j))}if(a.skinIndices)for(var e=0,f=a.skinIndices.length;e<f;e+=b){var k=a.skinIndices[e],l=b>1?a.skinIndices[e+1]:0,m=b>2?a.skinIndices[e+2]:0,n=b>3?a.skinIndices[e+3]:0;d.skinIndices.push(new c.Vector4(k,l,m,n))}d.bones=a.bones,
d.bones&&d.bones.length>0&&(d.skinWeights.length!==d.skinIndices.length||d.skinIndices.length!==d.vertices.length)&&c.warn("THREE.JSONLoader: When skinning, number of vertices ("+d.vertices.length+"), skinIndices ("+d.skinIndices.length+"), and skinWeights ("+d.skinWeights.length+") should match."),d.animation=a.animation,d.animations=a.animations}(),function(b){if(void 0!==a.morphTargets){var e,f,g,h,i,j;for(e=0,f=a.morphTargets.length;e<f;e++)for(d.morphTargets[e]={},d.morphTargets[e].name=a.morphTargets[e].name,d.morphTargets[e].vertices=[],i=d.morphTargets[e].vertices,j=a.morphTargets[e].vertices,g=0,h=j.length;g<h;g+=3){var k=new c.Vector3;k.x=j[g]*b,k.y=j[g+1]*b,k.z=j[g+2]*b,i.push(k)}}if(void 0!==a.morphColors){var e,f,l,m,n,o,p;for(e=0,f=a.morphColors.length;e<f;e++)for(d.morphColors[e]={},d.morphColors[e].name=a.morphColors[e].name,d.morphColors[e].colors=[],n=d.morphColors[e].colors,o=a.morphColors[e].colors,l=0,m=o.length;l<m;l+=3)p=new c.Color(16755200),p.setRGB(o[l],o[l+1],o[l+2]),n.push(p)}}(e),d.computeFaceNormals(),d.computeBoundingSphere(),void 0===a.materials||0===a.materials.length)return{geometry:d};var f=this.initMaterials(a.materials,b);return this.needsTangents(f)&&d.computeTangents(),{geometry:d,materials:f}},c.LoadingManager=function(a,b,c){var d=this,e=0,f=0;this.onLoad=a,this.onProgress=b,this.onError=c,this.itemStart=function(a){f++},this.itemEnd=function(a){e++,void 0!==d.onProgress&&d.onProgress(a,e,f),e===f&&void 0!==d.onLoad&&d.onLoad()}},c.DefaultLoadingManager=new c.LoadingManager,c.BufferGeometryLoader=function(a){this.manager=void 0!==a?a:c.DefaultLoadingManager},c.BufferGeometryLoader.prototype={constructor:c.BufferGeometryLoader,load:function(a,b,d,e){var f=this,g=new c.XHRLoader(f.manager);g.setCrossOrigin(this.crossOrigin),g.load(a,function(a){b(f.parse(JSON.parse(a)))},d,e)},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){var b=new c.BufferGeometry,d=a.data.attributes;for(var e in d){var f=d[e],g=new self[f.type](f.array);b.addAttribute(e,new c.BufferAttribute(g,f.itemSize))}var h=a.data.offsets;void 0!==h&&(b.offsets=JSON.parse(JSON.stringify(h)));var i=a.data.boundingSphere;if(void 0!==i){var j=new c.Vector3;void 0!==i.center&&j.fromArray(i.center),b.boundingSphere=new c.Sphere(j,i.radius)}return b}},c.MaterialLoader=function(a){this.manager=void 0!==a?a:c.DefaultLoadingManager},c.MaterialLoader.prototype={constructor:c.MaterialLoader,load:function(a,b,d,e){var f=this,g=new c.XHRLoader(f.manager);g.setCrossOrigin(this.crossOrigin),g.load(a,function(a){b(f.parse(JSON.parse(a)))},d,e)},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){var b=new c[a.type];if(void 0!==a.color&&b.color.setHex(a.color),void 0!==a.emissive&&b.emissive.setHex(a.emissive),void 0!==a.specular&&b.specular.setHex(a.specular),void 0!==a.shininess&&(b.shininess=a.shininess),void 0!==a.uniforms&&(b.uniforms=a.uniforms),void 0!==a.vertexShader&&(b.vertexShader=a.vertexShader),void 0!==a.fragmentShader&&(b.fragmentShader=a.fragmentShader),void 0!==a.vertexColors&&(b.vertexColors=a.vertexColors),void 0!==a.shading&&(b.shading=a.shading),void 0!==a.blending&&(b.blending=a.blending),void 0!==a.side&&(b.side=a.side),void 0!==a.opacity&&(b.opacity=a.opacity),void 0!==a.transparent&&(b.transparent=a.transparent),void 0!==a.wireframe&&(b.wireframe=a.wireframe),void 0!==a.size&&(b.size=a.size),void 0!==a.sizeAttenuation&&(b.sizeAttenuation=a.sizeAttenuation),void 0!==a.materials)for(var d=0,e=a.materials.length;d<e;d++)b.materials.push(this.parse(a.materials[d]));return b}},c.ObjectLoader=function(a){this.manager=void 0!==a?a:c.DefaultLoadingManager,this.texturePath=""},c.ObjectLoader.prototype={constructor:c.ObjectLoader,load:function(a,b,d,e){""===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf("/")+1));var f=this,g=new c.XHRLoader(f.manager);g.setCrossOrigin(this.crossOrigin),g.load(a,function(a){f.parse(JSON.parse(a),b)},d,e)},setTexturePath:function(a){this.texturePath=a},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a,b){var c=this.parseGeometries(a.geometries),d=this.parseImages(a.images,function(){void 0!==b&&b(g)}),e=this.parseTextures(a.textures,d),f=this.parseMaterials(a.materials,e),g=this.parseObject(a.object,c,f);return void 0!==a.images&&0!==a.images.length||void 0!==b&&b(g),g},parseGeometries:function(a){var b={};if(void 0!==a)for(var d=new c.JSONLoader,e=new c.BufferGeometryLoader,f=0,g=a.length;f<g;f++){var h,i=a[f];switch(i.type){case"PlaneGeometry":case"PlaneBufferGeometry":h=new c[i.type](i.width,i.height,i.widthSegments,i.heightSegments);break;case"BoxGeometry":case"CubeGeometry":h=new c.BoxGeometry(i.width,i.height,i.depth,i.widthSegments,i.heightSegments,i.depthSegments);break;case"CircleGeometry":h=new c.CircleGeometry(i.radius,i.segments);break;case"CylinderGeometry":h=new c.CylinderGeometry(i.radiusTop,i.radiusBottom,i.height,i.radialSegments,i.heightSegments,i.openEnded);break;case"SphereGeometry":h=new c.SphereGeometry(i.radius,i.widthSegments,i.heightSegments,i.phiStart,i.phiLength,i.thetaStart,i.thetaLength);break;case"IcosahedronGeometry":h=new c.IcosahedronGeometry(i.radius,i.detail);break;case"TorusGeometry":h=new c.TorusGeometry(i.radius,i.tube,i.radialSegments,i.tubularSegments,i.arc);break;case"TorusKnotGeometry":h=new c.TorusKnotGeometry(i.radius,i.tube,i.radialSegments,i.tubularSegments,i.p,i.q,i.heightScale);break;case"BufferGeometry":h=e.parse(i);break;case"Geometry":h=d.parse(i.data).geometry}h.uuid=i.uuid,void 0!==i.name&&(h.name=i.name),b[i.uuid]=h}return b},parseMaterials:function(a,b){var d={};if(void 0!==a)for(var e=function(a){return void 0===b[a]&&c.warn("THREE.ObjectLoader: Undefined texture",a),b[a]},f=new c.MaterialLoader,g=0,h=a.length;g<h;g++){var i=a[g],j=f.parse(i);j.uuid=i.uuid,void 0!==i.name&&(j.name=i.name),void 0!==i.map&&(j.map=e(i.map)),void 0!==i.bumpMap&&(j.bumpMap=e(i.bumpMap),i.bumpScale&&(j.bumpScale=new c.Vector2(i.bumpScale,i.bumpScale))),void 0!==i.alphaMap&&(j.alphaMap=e(i.alphaMap)),void 0!==i.envMap&&(j.envMap=e(i.envMap)),void 0!==i.normalMap&&(j.normalMap=e(i.normalMap),i.normalScale&&(j.normalScale=new c.Vector2(i.normalScale,i.normalScale))),void 0!==i.lightMap&&(j.lightMap=e(i.lightMap)),void 0!==i.specularMap&&(j.specularMap=e(i.specularMap)),d[i.uuid]=j}return d},parseImages:function(a,b){var d=this,e={};if(void 0!==a&&a.length>0){var f=new c.LoadingManager(b),g=new c.ImageLoader(f);g.setCrossOrigin(this.crossOrigin);for(var h=0,i=a.length;h<i;h++){var j=a[h],k=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(j.url)?j.url:d.texturePath+j.url;e[j.uuid]=function(a){return d.manager.itemStart(a),g.load(a,function(){d.manager.itemEnd(a)})}(k)}}return e},parseTextures:function(a,b){var d={};if(void 0!==a)for(var e=0,f=a.length;e<f;e++){var g=a[e];void 0===g.image&&c.warn('THREE.ObjectLoader: No "image" speficied for',g.uuid),void 0===b[g.image]&&c.warn("THREE.ObjectLoader: Undefined image",g.image);var h=new c.Texture(b[g.image]);h.needsUpdate=!0,h.uuid=g.uuid,void 0!==g.name&&(h.name=g.name),void 0!==g.repeat&&(h.repeat=new c.Vector2(g.repeat[0],g.repeat[1])),void 0!==g.minFilter&&(h.minFilter=c[g.minFilter]),void 0!==g.magFilter&&(h.magFilter=c[g.magFilter]),void 0!==g.anisotropy&&(h.anisotropy=g.anisotropy),g.wrap instanceof Array&&(h.wrapS=c[g.wrap[0]],h.wrapT=c[g.wrap[1]]),d[g.uuid]=h}return d},parseObject:function(){var a=new c.Matrix4;return function(b,d,e){var f,g=function(a){return void 0===d[a]&&c.warn("THREE.ObjectLoader: Undefined geometry",a),d[a]},h=function(a){return void 0===e[a]&&c.warn("THREE.ObjectLoader: Undefined material",a),e[a]};switch(b.type){case"Scene":f=new c.Scene;break;case"PerspectiveCamera":f=new c.PerspectiveCamera(b.fov,b.aspect,b.near,b.far);break;case"OrthographicCamera":f=new c.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case"AmbientLight":f=new c.AmbientLight(b.color);break;case"DirectionalLight":f=new c.DirectionalLight(b.color,b.intensity);break;case"PointLight":f=new c.PointLight(b.color,b.intensity,b.distance,b.decay);break;case"SpotLight":f=new c.SpotLight(b.color,b.intensity,b.distance,b.angle,b.exponent,b.decay);break;case"HemisphereLight":f=new c.HemisphereLight(b.color,b.groundColor,b.intensity);break;case"Mesh":f=new c.Mesh(g(b.geometry),h(b.material));break;case"Line":f=new c.Line(g(b.geometry),h(b.material),b.mode);break;case"PointCloud":f=new c.PointCloud(g(b.geometry),h(b.material));break;case"Sprite":f=new c.Sprite(h(b.material));break;case"Group":f=new c.Group;break;default:f=new c.Object3D}if(f.uuid=b.uuid,void 0!==b.name&&(f.name=b.name),void 0!==b.matrix?(a.fromArray(b.matrix),a.decompose(f.position,f.quaternion,f.scale)):(void 0!==b.position&&f.position.fromArray(b.position),void 0!==b.rotation&&f.rotation.fromArray(b.rotation),void 0!==b.scale&&f.scale.fromArray(b.scale)),void 0!==b.visible&&(f.visible=b.visible),void 0!==b.userData&&(f.userData=b.userData),void 0!==b.children)for(var i in b.children)f.add(this.parseObject(b.children[i],d,e));return f}}()},c.TextureLoader=function(a){this.manager=void 0!==a?a:c.DefaultLoadingManager},c.TextureLoader.prototype={constructor:c.TextureLoader,load:function(a,b,d,e){var f=this,g=new c.ImageLoader(f.manager);g.setCrossOrigin(this.crossOrigin),g.load(a,function(a){var d=new c.Texture(a);d.needsUpdate=!0,void 0!==b&&b(d)},d,e)},setCrossOrigin:function(a){this.crossOrigin=a}},c.DataTextureLoader=c.BinaryTextureLoader=function(){this._parser=null},c.BinaryTextureLoader.prototype={constructor:c.BinaryTextureLoader,load:function(a,b,d,e){var f=this,g=new c.DataTexture,h=new c.XHRLoader;return h.setResponseType("arraybuffer"),h.load(a,function(a){var d=f._parser(a);d&&(void 0!==d.image?g.image=d.image:void 0!==d.data&&(g.image.width=d.width,g.image.height=d.height,g.image.data=d.data),g.wrapS=void 0!==d.wrapS?d.wrapS:c.ClampToEdgeWrapping,g.wrapT=void 0!==d.wrapT?d.wrapT:c.ClampToEdgeWrapping,g.magFilter=void 0!==d.magFilter?d.magFilter:c.LinearFilter,g.minFilter=void 0!==d.minFilter?d.minFilter:c.LinearMipMapLinearFilter,g.anisotropy=void 0!==d.anisotropy?d.anisotropy:1,void 0!==d.format&&(g.format=d.format),void 0!==d.type&&(g.type=d.type),void 0!==d.mipmaps&&(g.mipmaps=d.mipmaps),1===d.mipmapCount&&(g.minFilter=c.LinearFilter),g.needsUpdate=!0,b&&b(g,d))},d,e),g}},c.CompressedTextureLoader=function(){this._parser=null},c.CompressedTextureLoader.prototype={constructor:c.CompressedTextureLoader,load:function(a,b,d){var e=this,f=[],g=new c.CompressedTexture;g.image=f;var h=new c.XHRLoader;if(h.setResponseType("arraybuffer"),a instanceof Array)for(var i=0,j=0,k=a.length;j<k;++j)!function(d){h.load(a[d],function(a){var h=e._parser(a,!0);f[d]={width:h.width,height:h.height,format:h.format,mipmaps:h.mipmaps},6===(i+=1)&&(1==h.mipmapCount&&(g.minFilter=c.LinearFilter),g.format=h.format,g.needsUpdate=!0,b&&b(g))})}(j);else h.load(a,function(a){var d=e._parser(a,!0);if(d.isCubemap)for(var h=d.mipmaps.length/d.mipmapCount,i=0;i<h;i++){f[i]={mipmaps:[]};for(var j=0;j<d.mipmapCount;j++)f[i].mipmaps.push(d.mipmaps[i*d.mipmapCount+j]),f[i].format=d.format,f[i].width=d.width,f[i].height=d.height}else g.image.width=d.width,g.image.height=d.height,g.mipmaps=d.mipmaps;1===d.mipmapCount&&(g.minFilter=c.LinearFilter),g.format=d.format,g.needsUpdate=!0,b&&b(g)});return g}},c.Material=function(){Object.defineProperty(this,"id",{value:c.MaterialIdCount++}),this.uuid=c.Math.generateUUID(),this.name="",this.type="Material",this.side=c.FrontSide,this.opacity=1,this.transparent=!1,this.blending=c.NormalBlending,this.blendSrc=c.SrcAlphaFactor,this.blendDst=c.OneMinusSrcAlphaFactor,this.blendEquation=c.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},c.Material.prototype={constructor:c.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update(),this._needsUpdate=a},setValues:function(a){if(void 0!==a)for(var b in a){var d=a[b];if(void 0!==d){if(b in this){var e=this[b];e instanceof c.Color?e.set(d):e instanceof c.Vector3&&d instanceof c.Vector3?e.copy(d):this[b]="overdraw"==b?Number(d):d}}else c.warn("THREE.Material: '"+b+"' parameter is undefined.")}},toJSON:function(){var a={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};return""!==this.name&&(a.name=this.name),this instanceof c.MeshBasicMaterial?(a.color=this.color.getHex(),this.vertexColors!==c.NoColors&&(a.vertexColors=this.vertexColors),this.blending!==c.NormalBlending&&(a.blending=this.blending),this.side!==c.FrontSide&&(a.side=this.side)):this instanceof c.MeshLambertMaterial?(a.color=this.color.getHex(),a.emissive=this.emissive.getHex(),this.vertexColors!==c.NoColors&&(a.vertexColors=this.vertexColors),this.shading!==c.SmoothShading&&(a.shading=this.shading),this.blending!==c.NormalBlending&&(a.blending=this.blending),this.side!==c.FrontSide&&(a.side=this.side)):this instanceof c.MeshPhongMaterial?(a.color=this.color.getHex(),a.emissive=this.emissive.getHex(),a.specular=this.specular.getHex(),a.shininess=this.shininess,this.vertexColors!==c.NoColors&&(a.vertexColors=this.vertexColors),this.shading!==c.SmoothShading&&(a.shading=this.shading),this.blending!==c.NormalBlending&&(a.blending=this.blending),this.side!==c.FrontSide&&(a.side=this.side)):this instanceof c.MeshNormalMaterial?(this.blending!==c.NormalBlending&&(a.blending=this.blending),this.side!==c.FrontSide&&(a.side=this.side)):this instanceof c.MeshDepthMaterial?(this.blending!==c.NormalBlending&&(a.blending=this.blending),this.side!==c.FrontSide&&(a.side=this.side)):this instanceof c.PointCloudMaterial?(a.size=this.size,a.sizeAttenuation=this.sizeAttenuation,a.color=this.color.getHex(),this.vertexColors!==c.NoColors&&(a.vertexColors=this.vertexColors),this.blending!==c.NormalBlending&&(a.blending=this.blending)):this instanceof c.ShaderMaterial?(a.uniforms=this.uniforms,a.vertexShader=this.vertexShader,a.fragmentShader=this.fragmentShader):this instanceof c.SpriteMaterial&&(a.color=this.color.getHex()),this.opacity<1&&(a.opacity=this.opacity),!1!==this.transparent&&(a.transparent=this.transparent),!1!==this.wireframe&&(a.wireframe=this.wireframe),a},clone:function(a){return void 0===a&&(a=new c.Material),a.name=this.name,a.side=this.side,a.opacity=this.opacity,a.transparent=this.transparent,a.blending=this.blending,a.blendSrc=this.blendSrc,a.blendDst=this.blendDst,a.blendEquation=this.blendEquation,a.blendSrcAlpha=this.blendSrcAlpha,a.blendDstAlpha=this.blendDstAlpha,a.blendEquationAlpha=this.blendEquationAlpha,a.depthTest=this.depthTest,a.depthWrite=this.depthWrite,a.polygonOffset=this.polygonOffset,a.polygonOffsetFactor=this.polygonOffsetFactor,a.polygonOffsetUnits=this.polygonOffsetUnits,a.alphaTest=this.alphaTest,a.overdraw=this.overdraw,a.visible=this.visible,a},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},c.EventDispatcher.prototype.apply(c.Material.prototype),c.MaterialIdCount=0,c.LineBasicMaterial=function(a){c.Material.call(this),this.type="LineBasicMaterial",this.color=new c.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=c.NoColors,this.fog=!0,this.setValues(a)},c.LineBasicMaterial.prototype=Object.create(c.Material.prototype),c.LineBasicMaterial.prototype.constructor=c.LineBasicMaterial,c.LineBasicMaterial.prototype.clone=function(){var a=new c.LineBasicMaterial;return c.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.linewidth=this.linewidth,a.linecap=this.linecap,a.linejoin=this.linejoin,a.vertexColors=this.vertexColors,a.fog=this.fog,a},c.LineDashedMaterial=function(a){c.Material.call(this),this.type="LineDashedMaterial",this.color=new c.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(a)},c.LineDashedMaterial.prototype=Object.create(c.Material.prototype),c.LineDashedMaterial.prototype.constructor=c.LineDashedMaterial,c.LineDashedMaterial.prototype.clone=function(){var a=new c.LineDashedMaterial;return c.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.linewidth=this.linewidth,a.scale=this.scale,a.dashSize=this.dashSize,a.gapSize=this.gapSize,a.vertexColors=this.vertexColors,a.fog=this.fog,a},c.MeshBasicMaterial=function(a){c.Material.call(this),this.type="MeshBasicMaterial",this.color=new c.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=c.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=c.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=c.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(a)},c.MeshBasicMaterial.prototype=Object.create(c.Material.prototype),c.MeshBasicMaterial.prototype.constructor=c.MeshBasicMaterial,c.MeshBasicMaterial.prototype.clone=function(){var a=new c.MeshBasicMaterial;return c.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.map=this.map,a.lightMap=this.lightMap,a.specularMap=this.specularMap,a.alphaMap=this.alphaMap,a.envMap=this.envMap,a.combine=this.combine,a.reflectivity=this.reflectivity,a.refractionRatio=this.refractionRatio,a.fog=this.fog,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.wireframeLinecap=this.wireframeLinecap,a.wireframeLinejoin=this.wireframeLinejoin,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a},c.MeshLambertMaterial=function(a){c.Material.call(this),this.type="MeshLambertMaterial",this.color=new c.Color(16777215),this.emissive=new c.Color(0),this.wrapAround=!1,this.wrapRGB=new c.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=c.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=c.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=c.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)},c.MeshLambertMaterial.prototype=Object.create(c.Material.prototype),c.MeshLambertMaterial.prototype.constructor=c.MeshLambertMaterial,c.MeshLambertMaterial.prototype.clone=function(){var a=new c.MeshLambertMaterial;return c.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.emissive.copy(this.emissive),a.wrapAround=this.wrapAround,a.wrapRGB.copy(this.wrapRGB),a.map=this.map,a.lightMap=this.lightMap,a.specularMap=this.specularMap,a.alphaMap=this.alphaMap,a.envMap=this.envMap,a.combine=this.combine,a.reflectivity=this.reflectivity,a.refractionRatio=this.refractionRatio,a.fog=this.fog,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.wireframeLinecap=this.wireframeLinecap,a.wireframeLinejoin=this.wireframeLinejoin,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a.morphNormals=this.morphNormals,a},c.MeshPhongMaterial=function(a){c.Material.call(this),this.type="MeshPhongMaterial",this.color=new c.Color(16777215),this.emissive=new c.Color(0),this.specular=new c.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new c.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new c.Vector2(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=c.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=c.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=c.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)},c.MeshPhongMaterial.prototype=Object.create(c.Material.prototype),c.MeshPhongMaterial.prototype.constructor=c.MeshPhongMaterial,c.MeshPhongMaterial.prototype.clone=function(){var a=new c.MeshPhongMaterial;return c.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.emissive.copy(this.emissive),a.specular.copy(this.specular),a.shininess=this.shininess,a.metal=this.metal,a.wrapAround=this.wrapAround,a.wrapRGB.copy(this.wrapRGB),a.map=this.map,a.lightMap=this.lightMap,a.bumpMap=this.bumpMap,a.bumpScale=this.bumpScale,a.normalMap=this.normalMap,a.normalScale.copy(this.normalScale),a.specularMap=this.specularMap,a.alphaMap=this.alphaMap,a.envMap=this.envMap,a.combine=this.combine,a.reflectivity=this.reflectivity,a.refractionRatio=this.refractionRatio,a.fog=this.fog,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.wireframeLinecap=this.wireframeLinecap,a.wireframeLinejoin=this.wireframeLinejoin,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a.morphNormals=this.morphNormals,a},c.MeshDepthMaterial=function(a){c.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(a)},c.MeshDepthMaterial.prototype=Object.create(c.Material.prototype),c.MeshDepthMaterial.prototype.constructor=c.MeshDepthMaterial,c.MeshDepthMaterial.prototype.clone=function(){var a=new c.MeshDepthMaterial;return c.Material.prototype.clone.call(this,a),a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a},c.MeshNormalMaterial=function(a){c.Material.call(this,a),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(a)},c.MeshNormalMaterial.prototype=Object.create(c.Material.prototype),c.MeshNormalMaterial.prototype.constructor=c.MeshNormalMaterial,c.MeshNormalMaterial.prototype.clone=function(){var a=new c.MeshNormalMaterial;return c.Material.prototype.clone.call(this,a),a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a},c.MeshFaceMaterial=function(a){this.uuid=c.Math.generateUUID(),this.type="MeshFaceMaterial",this.materials=a instanceof Array?a:[]},c.MeshFaceMaterial.prototype={constructor:c.MeshFaceMaterial,toJSON:function(){for(var a={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},b=0,c=this.materials.length;b<c;b++)a.materials.push(this.materials[b].toJSON());return a},clone:function(){for(var a=new c.MeshFaceMaterial,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());return a}},c.PointCloudMaterial=function(a){c.Material.call(this),this.type="PointCloudMaterial",this.color=new c.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=c.NoColors,this.fog=!0,this.setValues(a)},c.PointCloudMaterial.prototype=Object.create(c.Material.prototype),c.PointCloudMaterial.prototype.constructor=c.PointCloudMaterial,c.PointCloudMaterial.prototype.clone=function(){var a=new c.PointCloudMaterial;return c.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.map=this.map,a.size=this.size,a.sizeAttenuation=this.sizeAttenuation,a.vertexColors=this.vertexColors,a.fog=this.fog,a},c.ParticleBasicMaterial=function(a){return c.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new c.PointCloudMaterial(a)},c.ParticleSystemMaterial=function(a){return c.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new c.PointCloudMaterial(a)},c.ShaderMaterial=function(a){c.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=c.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=c.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(a)},c.ShaderMaterial.prototype=Object.create(c.Material.prototype),c.ShaderMaterial.prototype.constructor=c.ShaderMaterial,c.ShaderMaterial.prototype.clone=function(){var a=new c.ShaderMaterial;return c.Material.prototype.clone.call(this,a),a.fragmentShader=this.fragmentShader,a.vertexShader=this.vertexShader,a.uniforms=c.UniformsUtils.clone(this.uniforms),a.attributes=this.attributes,a.defines=this.defines,a.shading=this.shading,a.wireframe=this.wireframe,a.wireframeLinewidth=this.wireframeLinewidth,a.fog=this.fog,a.lights=this.lights,a.vertexColors=this.vertexColors,a.skinning=this.skinning,a.morphTargets=this.morphTargets,a.morphNormals=this.morphNormals,a},c.RawShaderMaterial=function(a){c.ShaderMaterial.call(this,a),this.type="RawShaderMaterial"},c.RawShaderMaterial.prototype=Object.create(c.ShaderMaterial.prototype),c.RawShaderMaterial.prototype.constructor=c.RawShaderMaterial,c.RawShaderMaterial.prototype.clone=function(){var a=new c.RawShaderMaterial;return c.ShaderMaterial.prototype.clone.call(this,a),a},c.SpriteMaterial=function(a){c.Material.call(this),this.type="SpriteMaterial",this.color=new c.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(a)},c.SpriteMaterial.prototype=Object.create(c.Material.prototype),c.SpriteMaterial.prototype.constructor=c.SpriteMaterial,c.SpriteMaterial.prototype.clone=function(){var a=new c.SpriteMaterial;return c.Material.prototype.clone.call(this,a),a.color.copy(this.color),a.map=this.map,a.rotation=this.rotation,a.fog=this.fog,a},c.Texture=function(a,b,d,e,f,g,h,i,j){Object.defineProperty(this,"id",{value:c.TextureIdCount++}),this.uuid=c.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==a?a:c.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==b?b:c.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==d?d:c.ClampToEdgeWrapping,this.wrapT=void 0!==e?e:c.ClampToEdgeWrapping,this.magFilter=void 0!==f?f:c.LinearFilter,this.minFilter=void 0!==g?g:c.LinearMipMapLinearFilter,this.anisotropy=void 0!==j?j:1,this.format=void 0!==h?h:c.RGBAFormat,this.type=void 0!==i?i:c.UnsignedByteType,this.offset=new c.Vector2(0,0),this.repeat=new c.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},c.Texture.DEFAULT_IMAGE=void 0,c.Texture.DEFAULT_MAPPING=c.UVMapping,c.Texture.prototype={constructor:c.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update(),this._needsUpdate=a},clone:function(a){return void 0===a&&(a=new c.Texture),a.image=this.image,a.mipmaps=this.mipmaps.slice(0),a.mapping=this.mapping,a.wrapS=this.wrapS,a.wrapT=this.wrapT,a.magFilter=this.magFilter,a.minFilter=this.minFilter,a.anisotropy=this.anisotropy,a.format=this.format,a.type=this.type,a.offset.copy(this.offset),a.repeat.copy(this.repeat),a.generateMipmaps=this.generateMipmaps,a.premultiplyAlpha=this.premultiplyAlpha,a.flipY=this.flipY,a.unpackAlignment=this.unpackAlignment,a},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},c.EventDispatcher.prototype.apply(c.Texture.prototype),c.TextureIdCount=0,c.CubeTexture=function(a,b,d,e,f,g,h,i,j){b=void 0!==b?b:c.CubeReflectionMapping,c.Texture.call(this,a,b,d,e,f,g,h,i,j),this.images=a},c.CubeTexture.prototype=Object.create(c.Texture.prototype),c.CubeTexture.prototype.constructor=c.CubeTexture,c.CubeTexture.clone=function(a){return void 0===a&&(a=new c.CubeTexture),c.Texture.prototype.clone.call(this,a),a.images=this.images,a},c.CompressedTexture=function(a,b,d,e,f,g,h,i,j,k,l){c.Texture.call(this,null,g,h,i,j,k,e,f,l),this.image={width:b,height:d},this.mipmaps=a,this.flipY=!1,this.generateMipmaps=!1},c.CompressedTexture.prototype=Object.create(c.Texture.prototype),c.CompressedTexture.prototype.constructor=c.CompressedTexture,c.CompressedTexture.prototype.clone=function(){var a=new c.CompressedTexture;return c.Texture.prototype.clone.call(this,a),a},c.DataTexture=function(a,b,d,e,f,g,h,i,j,k,l){c.Texture.call(this,null,g,h,i,j,k,e,f,l),this.image={data:a,width:b,height:d}},c.DataTexture.prototype=Object.create(c.Texture.prototype),c.DataTexture.prototype.constructor=c.DataTexture,c.DataTexture.prototype.clone=function(){var a=new c.DataTexture;return c.Texture.prototype.clone.call(this,a),a},c.VideoTexture=function(a,b,d,e,f,g,h,i,j){c.Texture.call(this,a,b,d,e,f,g,h,i,j),this.generateMipmaps=!1;var k=this;!function b(){requestAnimationFrame(b),a.readyState===a.HAVE_ENOUGH_DATA&&(k.needsUpdate=!0)}()},c.VideoTexture.prototype=Object.create(c.Texture.prototype),c.VideoTexture.prototype.constructor=c.VideoTexture,c.Group=function(){c.Object3D.call(this),this.type="Group"},c.Group.prototype=Object.create(c.Object3D.prototype),c.Group.prototype.constructor=c.Group,c.PointCloud=function(a,b){c.Object3D.call(this),this.type="PointCloud",this.geometry=void 0!==a?a:new c.Geometry,this.material=void 0!==b?b:new c.PointCloudMaterial({color:16777215*Math.random()})},c.PointCloud.prototype=Object.create(c.Object3D.prototype),c.PointCloud.prototype.constructor=c.PointCloud,c.PointCloud.prototype.raycast=function(){var a=new c.Matrix4,b=new c.Ray;return function(d,e){var f=this,g=f.geometry,h=d.params.PointCloud.threshold;if(a.getInverse(this.matrixWorld),b.copy(d.ray).applyMatrix4(a),null===g.boundingBox||!1!==b.isIntersectionBox(g.boundingBox)){var i=h/((this.scale.x+this.scale.y+this.scale.z)/3),j=new c.Vector3,k=function(a,c){var g=b.distanceToPoint(a);if(g<i){var h=b.closestPointToPoint(a);h.applyMatrix4(f.matrixWorld);var j=d.ray.origin.distanceTo(h);e.push({distance:j,distanceToRay:g,point:h.clone(),index:c,face:null,object:f})}};if(g instanceof c.BufferGeometry){var l=g.attributes,m=l.position.array;if(void 0!==l.index){var n=l.index.array,o=g.offsets;if(0===o.length){o=[{start:0,count:n.length,index:0}]}for(var p=0,q=o.length;p<q;++p)for(var r=o[p].start,s=o[p].count,t=o[p].index,u=r,v=r+s;u<v;u++){var w=t+n[u];j.fromArray(m,3*w),k(j,w)}}else for(var x=m.length/3,u=0;u<x;u++)j.set(m[3*u],m[3*u+1],m[3*u+2]),k(j,u)}else for(var y=this.geometry.vertices,u=0;u<y.length;u++)k(y[u],u)}}}(),c.PointCloud.prototype.clone=function(a){return void 0===a&&(a=new c.PointCloud(this.geometry,this.material)),c.Object3D.prototype.clone.call(this,a),a},c.ParticleSystem=function(a,b){return c.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new c.PointCloud(a,b)},c.Line=function(a,b,d){c.Object3D.call(this),this.type="Line",this.geometry=void 0!==a?a:new c.Geometry,this.material=void 0!==b?b:new c.LineBasicMaterial({color:16777215*Math.random()}),this.mode=void 0!==d?d:c.LineStrip},c.LineStrip=0,c.LinePieces=1,c.Line.prototype=Object.create(c.Object3D.prototype),c.Line.prototype.constructor=c.Line,c.Line.prototype.raycast=function(){var a=new c.Matrix4,b=new c.Ray,d=new c.Sphere;return function(e,f){var g=e.linePrecision,h=g*g,i=this.geometry;if(null===i.boundingSphere&&i.computeBoundingSphere(),d.copy(i.boundingSphere),d.applyMatrix4(this.matrixWorld),!1!==e.ray.isIntersectionSphere(d)){a.getInverse(this.matrixWorld),b.copy(e.ray).applyMatrix4(a);var j=new c.Vector3,k=new c.Vector3,l=new c.Vector3,m=new c.Vector3,n=this.mode===c.LineStrip?1:2;if(i instanceof c.BufferGeometry){var o=i.attributes;if(void 0!==o.index){var p=o.index.array,q=o.position.array,r=i.offsets;0===r.length&&(r=[{start:0,count:p.length,index:0}]);for(var s=0;s<r.length;s++)for(var t=r[s].start,u=r[s].count,v=r[s].index,w=t;w<t+u-1;w+=n){var x=v+p[w],y=v+p[w+1];j.fromArray(q,3*x),k.fromArray(q,3*y);var z=b.distanceSqToSegment(j,k,m,l);if(!(z>h)){var A=b.origin.distanceTo(m)
;A<e.near||A>e.far||f.push({distance:A,point:l.clone().applyMatrix4(this.matrixWorld),index:w,offsetIndex:s,face:null,faceIndex:null,object:this})}}}else for(var q=o.position.array,w=0;w<q.length/3-1;w+=n){j.fromArray(q,3*w),k.fromArray(q,3*w+3);var z=b.distanceSqToSegment(j,k,m,l);if(!(z>h)){var A=b.origin.distanceTo(m);A<e.near||A>e.far||f.push({distance:A,point:l.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}}else if(i instanceof c.Geometry)for(var B=i.vertices,C=B.length,w=0;w<C-1;w+=n){var z=b.distanceSqToSegment(B[w],B[w+1],m,l);if(!(z>h)){var A=b.origin.distanceTo(m);A<e.near||A>e.far||f.push({distance:A,point:l.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}}}}(),c.Line.prototype.clone=function(a){return void 0===a&&(a=new c.Line(this.geometry,this.material,this.mode)),c.Object3D.prototype.clone.call(this,a),a},c.Mesh=function(a,b){c.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==a?a:new c.Geometry,this.material=void 0!==b?b:new c.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},c.Mesh.prototype=Object.create(c.Object3D.prototype),c.Mesh.prototype.constructor=c.Mesh,c.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}},c.Mesh.prototype.getMorphTargetIndexByName=function(a){return void 0!==this.morphTargetDictionary[a]?this.morphTargetDictionary[a]:(c.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0."),0)},c.Mesh.prototype.raycast=function(){var a=new c.Matrix4,b=new c.Ray,d=new c.Sphere,e=new c.Vector3,f=new c.Vector3,g=new c.Vector3;return function(h,i){var j=this.geometry;if(null===j.boundingSphere&&j.computeBoundingSphere(),d.copy(j.boundingSphere),d.applyMatrix4(this.matrixWorld),!1!==h.ray.isIntersectionSphere(d)&&(a.getInverse(this.matrixWorld),b.copy(h.ray).applyMatrix4(a),null===j.boundingBox||!1!==b.isIntersectionBox(j.boundingBox)))if(j instanceof c.BufferGeometry){var k=this.material;if(void 0===k)return;var l,m,n,o=j.attributes,p=h.precision;if(void 0!==o.index){var q=o.index.array,r=o.position.array,s=j.offsets;0===s.length&&(s=[{start:0,count:q.length,index:0}]);for(var t=0,u=s.length;t<u;++t)for(var v=s[t].start,w=s[t].count,x=s[t].index,y=v,z=v+w;y<z;y+=3){if(l=x+q[y],m=x+q[y+1],n=x+q[y+2],e.fromArray(r,3*l),f.fromArray(r,3*m),g.fromArray(r,3*n),k.side===c.BackSide)var A=b.intersectTriangle(g,f,e,!0);else var A=b.intersectTriangle(e,f,g,k.side!==c.DoubleSide);if(null!==A){A.applyMatrix4(this.matrixWorld);var B=h.ray.origin.distanceTo(A);B<p||B<h.near||B>h.far||i.push({distance:B,point:A,face:new c.Face3(l,m,n,c.Triangle.normal(e,f,g)),faceIndex:null,object:this})}}}else for(var r=o.position.array,y=0,C=0,z=r.length;y<z;y+=3,C+=9){if(l=y,m=y+1,n=y+2,e.fromArray(r,C),f.fromArray(r,C+3),g.fromArray(r,C+6),k.side===c.BackSide)var A=b.intersectTriangle(g,f,e,!0);else var A=b.intersectTriangle(e,f,g,k.side!==c.DoubleSide);if(null!==A){A.applyMatrix4(this.matrixWorld);var B=h.ray.origin.distanceTo(A);B<p||B<h.near||B>h.far||i.push({distance:B,point:A,face:new c.Face3(l,m,n,c.Triangle.normal(e,f,g)),faceIndex:null,object:this})}}}else if(j instanceof c.Geometry)for(var l,m,n,D=this.material instanceof c.MeshFaceMaterial,E=!0===D?this.material.materials:null,p=h.precision,F=j.vertices,G=0,H=j.faces.length;G<H;G++){var I=j.faces[G],k=!0===D?E[I.materialIndex]:this.material;if(void 0!==k){if(l=F[I.a],m=F[I.b],n=F[I.c],!0===k.morphTargets){var J=j.morphTargets,K=this.morphTargetInfluences;e.set(0,0,0),f.set(0,0,0),g.set(0,0,0);for(var L=0,M=J.length;L<M;L++){var N=K[L];if(0!==N){var O=J[L].vertices;e.x+=(O[I.a].x-l.x)*N,e.y+=(O[I.a].y-l.y)*N,e.z+=(O[I.a].z-l.z)*N,f.x+=(O[I.b].x-m.x)*N,f.y+=(O[I.b].y-m.y)*N,f.z+=(O[I.b].z-m.z)*N,g.x+=(O[I.c].x-n.x)*N,g.y+=(O[I.c].y-n.y)*N,g.z+=(O[I.c].z-n.z)*N}}e.add(l),f.add(m),g.add(n),l=e,m=f,n=g}if(k.side===c.BackSide)var A=b.intersectTriangle(n,m,l,!0);else var A=b.intersectTriangle(l,m,n,k.side!==c.DoubleSide);if(null!==A){A.applyMatrix4(this.matrixWorld);var B=h.ray.origin.distanceTo(A);B<p||B<h.near||B>h.far||i.push({distance:B,point:A,face:I,faceIndex:G,object:this})}}}}}(),c.Mesh.prototype.clone=function(a,b){return void 0===a&&(a=new c.Mesh(this.geometry,this.material)),c.Object3D.prototype.clone.call(this,a,b),a},c.Bone=function(a){c.Object3D.call(this),this.type="Bone",this.skin=a},c.Bone.prototype=Object.create(c.Object3D.prototype),c.Bone.prototype.constructor=c.Bone,c.Skeleton=function(a,b,d){if(this.useVertexTexture=void 0===d||d,this.identityMatrix=new c.Matrix4,a=a||[],this.bones=a.slice(0),this.useVertexTexture){var e;e=this.bones.length>256?64:this.bones.length>64?32:this.bones.length>16?16:8,this.boneTextureWidth=e,this.boneTextureHeight=e,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new c.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,c.RGBAFormat,c.FloatType),this.boneTexture.minFilter=c.NearestFilter,this.boneTexture.magFilter=c.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else{c.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var f=0,g=this.bones.length;f<g;f++)this.boneInverses.push(new c.Matrix4)}},c.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var d=new c.Matrix4;this.bones[a]&&d.getInverse(this.bones[a].matrixWorld),this.boneInverses.push(d)}},c.Skeleton.prototype.pose=function(){for(var a,b=0,c=this.bones.length;b<c;b++)(a=this.bones[b])&&a.matrixWorld.getInverse(this.boneInverses[b]);for(var b=0,c=this.bones.length;b<c;b++)(a=this.bones[b])&&(a.parent?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))},c.Skeleton.prototype.update=function(){var a=new c.Matrix4;return function(){for(var b=0,c=this.bones.length;b<c;b++){var d=this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix;a.multiplyMatrices(d,this.boneInverses[b]),a.flattenToArrayOffset(this.boneMatrices,16*b)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),c.SkinnedMesh=function(a,b,d){c.Mesh.call(this,a,b),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new c.Matrix4,this.bindMatrixInverse=new c.Matrix4;var e=[];if(this.geometry&&void 0!==this.geometry.bones){for(var f,g,h,i,j,k=0,l=this.geometry.bones.length;k<l;++k)g=this.geometry.bones[k],h=g.pos,i=g.rotq,j=g.scl,f=new c.Bone(this),e.push(f),f.name=g.name,f.position.set(h[0],h[1],h[2]),f.quaternion.set(i[0],i[1],i[2],i[3]),void 0!==j?f.scale.set(j[0],j[1],j[2]):f.scale.set(1,1,1);for(var k=0,l=this.geometry.bones.length;k<l;++k)g=this.geometry.bones[k],-1!==g.parent?e[g.parent].add(e[k]):this.add(e[k])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new c.Skeleton(e,void 0,d))},c.SkinnedMesh.prototype=Object.create(c.Mesh.prototype),c.SkinnedMesh.prototype.constructor=c.SkinnedMesh,c.SkinnedMesh.prototype.bind=function(a,b){this.skeleton=a,void 0===b&&(this.updateMatrixWorld(!0),b=this.matrixWorld),this.bindMatrix.copy(b),this.bindMatrixInverse.getInverse(b)},c.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},c.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof c.Geometry)for(var a=0;a<this.geometry.skinIndices.length;a++){var b=this.geometry.skinWeights[a],d=1/b.lengthManhattan();d!==1/0?b.multiplyScalar(d):b.set(1)}},c.SkinnedMesh.prototype.updateMatrixWorld=function(a){c.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):c.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},c.SkinnedMesh.prototype.clone=function(a){return void 0===a&&(a=new c.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),c.Mesh.prototype.clone.call(this,a),a},c.MorphAnimMesh=function(a,b){c.Mesh.call(this,a,b),this.type="MorphAnimMesh",this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},c.MorphAnimMesh.prototype=Object.create(c.Mesh.prototype),c.MorphAnimMesh.prototype.constructor=c.MorphAnimMesh,c.MorphAnimMesh.prototype.setFrameRange=function(a,b){this.startKeyframe=a,this.endKeyframe=b,this.length=this.endKeyframe-this.startKeyframe+1},c.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},c.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},c.MorphAnimMesh.prototype.parseAnimations=function(){var a=this.geometry;a.animations||(a.animations={});for(var b,c=a.animations,d=/([a-z]+)_?(\d+)/,e=0,f=a.morphTargets.length;e<f;e++){var g=a.morphTargets[e],h=g.name.match(d);if(h&&h.length>1){var i=h[1];c[i]||(c[i]={start:1/0,end:-1/0});var j=c[i];e<j.start&&(j.start=e),e>j.end&&(j.end=e),b||(b=i)}}a.firstAnimation=b},c.MorphAnimMesh.prototype.setAnimationLabel=function(a,b,c){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[a]={start:b,end:c}},c.MorphAnimMesh.prototype.playAnimation=function(a,b){var d=this.geometry.animations[a];d?(this.setFrameRange(d.start,d.end),this.duration=(d.end-d.start)/b*1e3,this.time=0):c.warn("THREE.MorphAnimMesh: animation["+a+"] undefined in .playAnimation()")},c.MorphAnimMesh.prototype.updateAnimation=function(a){var b=this.duration/this.length;this.time+=this.direction*a,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var d=this.startKeyframe+c.Math.clamp(Math.floor(this.time/b),0,this.length-1);d!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[d]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=d);var e=this.time%b/b;this.directionBackwards&&(e=1-e),this.morphTargetInfluences[this.currentKeyframe]=e,this.morphTargetInfluences[this.lastKeyframe]=1-e},c.MorphAnimMesh.prototype.interpolateTargets=function(a,b,c){for(var d=this.morphTargetInfluences,e=0,f=d.length;e<f;e++)d[e]=0;a>-1&&(d[a]=1-c),b>-1&&(d[b]=c)},c.MorphAnimMesh.prototype.clone=function(a){return void 0===a&&(a=new c.MorphAnimMesh(this.geometry,this.material)),a.duration=this.duration,a.mirroredLoop=this.mirroredLoop,a.time=this.time,a.lastKeyframe=this.lastKeyframe,a.currentKeyframe=this.currentKeyframe,a.direction=this.direction,a.directionBackwards=this.directionBackwards,c.Mesh.prototype.clone.call(this,a),a},c.LOD=function(){c.Object3D.call(this),this.objects=[]},c.LOD.prototype=Object.create(c.Object3D.prototype),c.LOD.prototype.constructor=c.LOD,c.LOD.prototype.addLevel=function(a,b){void 0===b&&(b=0),b=Math.abs(b);for(var c=0;c<this.objects.length&&!(b<this.objects[c].distance);c++);this.objects.splice(c,0,{distance:b,object:a}),this.add(a)},c.LOD.prototype.getObjectForDistance=function(a){for(var b=1,c=this.objects.length;b<c&&!(a<this.objects[b].distance);b++);return this.objects[b-1].object},c.LOD.prototype.raycast=function(){var a=new c.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.origin.distanceTo(a);this.getObjectForDistance(d).raycast(b,c)}}(),c.LOD.prototype.update=function(){var a=new c.Vector3,b=new c.Vector3;return function(c){if(this.objects.length>1){a.setFromMatrixPosition(c.matrixWorld),b.setFromMatrixPosition(this.matrixWorld);var d=a.distanceTo(b);this.objects[0].object.visible=!0;for(var e=1,f=this.objects.length;e<f&&d>=this.objects[e].distance;e++)this.objects[e-1].object.visible=!1,this.objects[e].object.visible=!0;for(;e<f;e++)this.objects[e].object.visible=!1}}}(),c.LOD.prototype.clone=function(a){void 0===a&&(a=new c.LOD),c.Object3D.prototype.clone.call(this,a);for(var b=0,d=this.objects.length;b<d;b++){var e=this.objects[b].object.clone();e.visible=0===b,a.addLevel(e,this.objects[b].distance)}return a},c.Sprite=function(){var a=new Uint16Array([0,1,2,0,2,3]),b=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),d=new Float32Array([0,0,1,0,1,1,0,1]),e=new c.BufferGeometry;return e.addAttribute("index",new c.BufferAttribute(a,1)),e.addAttribute("position",new c.BufferAttribute(b,3)),e.addAttribute("uv",new c.BufferAttribute(d,2)),function(a){c.Object3D.call(this),this.type="Sprite",this.geometry=e,this.material=void 0!==a?a:new c.SpriteMaterial}}(),c.Sprite.prototype=Object.create(c.Object3D.prototype),c.Sprite.prototype.constructor=c.Sprite,c.Sprite.prototype.raycast=function(){var a=new c.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.distanceToPoint(a);d>this.scale.x||c.push({distance:d,point:this.position,face:null,object:this})}}(),c.Sprite.prototype.clone=function(a){return void 0===a&&(a=new c.Sprite(this.material)),c.Object3D.prototype.clone.call(this,a),a},c.Particle=c.Sprite,c.LensFlare=function(a,b,d,e,f){c.Object3D.call(this),this.lensFlares=[],this.positionScreen=new c.Vector3,this.customUpdateCallback=void 0,void 0!==a&&this.add(a,b,d,e,f)},c.LensFlare.prototype=Object.create(c.Object3D.prototype),c.LensFlare.prototype.constructor=c.LensFlare,c.LensFlare.prototype.add=function(a,b,d,e,f,g){void 0===b&&(b=-1),void 0===d&&(d=0),void 0===g&&(g=1),void 0===f&&(f=new c.Color(16777215)),void 0===e&&(e=c.NormalBlending),d=Math.min(d,Math.max(0,d)),this.lensFlares.push({texture:a,size:b,distance:d,x:0,y:0,z:0,scale:1,rotation:1,opacity:g,color:f,blending:e})},c.LensFlare.prototype.updateLensFlares=function(){var a,b,c=this.lensFlares.length,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;a<c;a++)b=this.lensFlares[a],b.x=this.positionScreen.x+d*b.distance,b.y=this.positionScreen.y+e*b.distance,b.wantedRotation=b.x*Math.PI*.25,b.rotation+=.25*(b.wantedRotation-b.rotation)},c.Scene=function(){c.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},c.Scene.prototype=Object.create(c.Object3D.prototype),c.Scene.prototype.constructor=c.Scene,c.Scene.prototype.clone=function(a){return void 0===a&&(a=new c.Scene),c.Object3D.prototype.clone.call(this,a),null!==this.fog&&(a.fog=this.fog.clone()),null!==this.overrideMaterial&&(a.overrideMaterial=this.overrideMaterial.clone()),a.autoUpdate=this.autoUpdate,a.matrixAutoUpdate=this.matrixAutoUpdate,a},c.Fog=function(a,b,d){this.name="",this.color=new c.Color(a),this.near=void 0!==b?b:1,this.far=void 0!==d?d:1e3},c.Fog.prototype.clone=function(){return new c.Fog(this.color.getHex(),this.near,this.far)},c.FogExp2=function(a,b){this.name="",this.color=new c.Color(a),this.density=void 0!==b?b:25e-5},c.FogExp2.prototype.clone=function(){return new c.FogExp2(this.color.getHex(),this.density)},c.ShaderChunk={},c.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\n\treturn point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\tif ( decayExponent > 0.0 ) {\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n\t}\n\treturn 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\n",c.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",c.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack += ambientLightColor;\n\n#endif\n",c.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n",c.ShaderChunk.default_vertex="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",c.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif";c.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n",c.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif",c.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif",
c.ShaderChunk.lights_phong_fragment="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalDiffuseLight += hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\n#ifdef METAL\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n",c.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif",c.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif",c.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n",c.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",c.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",c.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n",c.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif",c.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif",c.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif",c.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif",c.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif",c.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",c.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",c.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\tvColor.xyz = inputToLinear( color.xyz );\n\n#endif",c.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n",c.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n",c.ShaderChunk.linear_to_gamma_fragment="\n\toutgoingLight = linearToOutput( outgoingLight );\n",c.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif",c.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n",c.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n",c.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",c.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif",c.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif",c.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif",c.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif",c.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n\t\tfogFactor = whiteCompliment( fogFactor );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",c.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",c.ShaderChunk.defaultnormal_vertex="#ifdef USE_SKINNING\n\n\tvec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n\tvec3 objectNormal = morphedNormal;\n\n#else\n\n\tvec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",c.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n",c.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",c.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",c.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif",c.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",c.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif",c.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif",c.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n",c.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n\tshadowColor = inputToLinear( shadowColor );\n\n\toutgoingLight = outgoingLight * shadowColor;\n\n#endif\n",c.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#elif defined( USE_MORPHTARGETS )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif\n",c.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif",c.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",
c.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif",c.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",c.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",c.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]);for(var e in d)b[e]=d[e]}return b},clone:function(a){var b={};for(var d in a){b[d]={};for(var e in a[d]){var f=a[d][e];f instanceof c.Color||f instanceof c.Vector2||f instanceof c.Vector3||f instanceof c.Vector4||f instanceof c.Matrix4||f instanceof c.Texture?b[d][e]=f.clone():f instanceof Array?b[d][e]=f.slice():b[d][e]=f}}return b}},c.UniformsLib={common:{diffuse:{type:"c",value:new c.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new c.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new c.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new c.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new c.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new c.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new c.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},c.ShaderLib={basic:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.shadowmap]),vertexShader:[c.ShaderChunk.common,c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,c.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.color_vertex,c.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",c.ShaderChunk.morphnormal_vertex,c.ShaderChunk.skinnormal_vertex,c.ShaderChunk.defaultnormal_vertex,"\t#endif",c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.logdepthbuf_vertex,c.ShaderChunk.worldpos_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",c.ShaderChunk.common,c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.alphamap_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,c.ShaderChunk.specularmap_pars_fragment,c.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",c.ShaderChunk.logdepthbuf_fragment,c.ShaderChunk.map_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.alphamap_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.specularmap_fragment,"\toutgoingLight = diffuseColor.rgb;",c.ShaderChunk.lightmap_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{emissive:{type:"c",value:new c.Color(0)},wrapRGB:{type:"v3",value:new c.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",c.ShaderChunk.common,c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.lights_lambert_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,c.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.color_vertex,c.ShaderChunk.morphnormal_vertex,c.ShaderChunk.skinbase_vertex,c.ShaderChunk.skinnormal_vertex,c.ShaderChunk.defaultnormal_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.logdepthbuf_vertex,c.ShaderChunk.worldpos_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.lights_lambert_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",c.ShaderChunk.common,c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.alphamap_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,c.ShaderChunk.specularmap_pars_fragment,c.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",c.ShaderChunk.logdepthbuf_fragment,c.ShaderChunk.map_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.alphamap_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.specularmap_fragment,"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t\telse","\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;","\t#else","\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t#endif",c.ShaderChunk.lightmap_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.bump,c.UniformsLib.normalmap,c.UniformsLib.fog,c.UniformsLib.lights,c.UniformsLib.shadowmap,{emissive:{type:"c",value:new c.Color(0)},specular:{type:"c",value:new c.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new c.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif",c.ShaderChunk.common,c.ShaderChunk.map_pars_vertex,c.ShaderChunk.lightmap_pars_vertex,c.ShaderChunk.envmap_pars_vertex,c.ShaderChunk.lights_phong_pars_vertex,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,c.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",c.ShaderChunk.map_vertex,c.ShaderChunk.lightmap_vertex,c.ShaderChunk.color_vertex,c.ShaderChunk.morphnormal_vertex,c.ShaderChunk.skinbase_vertex,c.ShaderChunk.skinnormal_vertex,c.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = -mvPosition.xyz;",c.ShaderChunk.worldpos_vertex,c.ShaderChunk.envmap_vertex,c.ShaderChunk.lights_phong_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",c.ShaderChunk.common,c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_pars_fragment,c.ShaderChunk.alphamap_pars_fragment,c.ShaderChunk.lightmap_pars_fragment,c.ShaderChunk.envmap_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.lights_phong_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,c.ShaderChunk.bumpmap_pars_fragment,c.ShaderChunk.normalmap_pars_fragment,c.ShaderChunk.specularmap_pars_fragment,c.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",c.ShaderChunk.logdepthbuf_fragment,c.ShaderChunk.map_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.alphamap_fragment,c.ShaderChunk.alphatest_fragment,c.ShaderChunk.specularmap_fragment,c.ShaderChunk.lights_phong_fragment,c.ShaderChunk.lightmap_fragment,c.ShaderChunk.envmap_fragment,c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.linear_to_gamma_fragment,c.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},particle_basic:{uniforms:c.UniformsUtils.merge([c.UniformsLib.particle,c.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",c.ShaderChunk.common,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.shadowmap_pars_vertex,c.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",c.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",c.ShaderChunk.logdepthbuf_vertex,c.ShaderChunk.worldpos_vertex,c.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",c.ShaderChunk.common,c.ShaderChunk.color_pars_fragment,c.ShaderChunk.map_particle_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.shadowmap_pars_fragment,c.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( psColor, opacity );",c.ShaderChunk.logdepthbuf_fragment,c.ShaderChunk.map_particle_fragment,c.ShaderChunk.color_fragment,c.ShaderChunk.alphatest_fragment,"\toutgoingLight = diffuseColor.rgb;",c.ShaderChunk.shadowmap_fragment,c.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:c.UniformsUtils.merge([c.UniformsLib.common,c.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",c.ShaderChunk.common,c.ShaderChunk.color_pars_vertex,c.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",c.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",c.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",c.ShaderChunk.common,c.ShaderChunk.color_pars_fragment,c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",c.ShaderChunk.logdepthbuf_fragment,c.ShaderChunk.color_fragment,"\toutgoingLight = diffuseColor.rgb;",c.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[c.ShaderChunk.common,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",c.ShaderChunk.common,c.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",c.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",c.ShaderChunk.common,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvNormal = normalize( normalMatrix * normal );",c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",c.ShaderChunk.common,c.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",c.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",c.ShaderChunk.common,c.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",c.ShaderChunk.common,c.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",c.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",c.ShaderChunk.common,c.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",c.ShaderChunk.common,c.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",c.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[c.ShaderChunk.common,c.ShaderChunk.morphtarget_pars_vertex,c.ShaderChunk.skinning_pars_vertex,c.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",c.ShaderChunk.skinbase_vertex,c.ShaderChunk.morphtarget_vertex,c.ShaderChunk.skinning_vertex,c.ShaderChunk.default_vertex,c.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[c.ShaderChunk.common,c.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",c.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")}},c.WebGLRenderer=function(a){function b(a){a.__webglVertexBuffer=Fa.createBuffer(),a.__webglColorBuffer=Fa.createBuffer(),Ga.info.memory.geometries++}function d(a){a.__webglVertexBuffer=Fa.createBuffer(),a.__webglColorBuffer=Fa.createBuffer(),a.__webglLineDistanceBuffer=Fa.createBuffer(),Ga.info.memory.geometries++}function e(a){a.__webglVertexBuffer=Fa.createBuffer(),a.__webglNormalBuffer=Fa.createBuffer(),a.__webglTangentBuffer=Fa.createBuffer(),a.__webglColorBuffer=Fa.createBuffer(),a.__webglUVBuffer=Fa.createBuffer(),a.__webglUV2Buffer=Fa.createBuffer(),a.__webglSkinIndicesBuffer=Fa.createBuffer(),a.__webglSkinWeightsBuffer=Fa.createBuffer(),a.__webglFaceBuffer=Fa.createBuffer(),a.__webglLineBuffer=Fa.createBuffer();var b=a.numMorphTargets;if(b){a.__webglMorphTargetsBuffers=[];for(var c=0,d=b;c<d;c++)a.__webglMorphTargetsBuffers.push(Fa.createBuffer())}var e=a.numMorphNormals;if(e){a.__webglMorphNormalsBuffers=[];for(var c=0,d=e;c<d;c++)a.__webglMorphNormalsBuffers.push(Fa.createBuffer())}Ga.info.memory.geometries++}function f(a){var b=a.geometry,c=a.material,d=b.vertices.length;if(c.attributes){void 0===b.__webglCustomAttributesList&&(b.__webglCustomAttributesList=[]);for(var e in c.attributes){var f=c.attributes[e];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=!0;var g=1;"v2"===f.type?g=2:"v3"===f.type?g=3:"v4"===f.type?g=4:"c"===f.type&&(g=3),f.size=g,f.array=new Float32Array(d*g),f.buffer=Fa.createBuffer(),f.buffer.belongsToAttribute=e,f.needsUpdate=!0}b.__webglCustomAttributesList.push(f)}}}function g(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(3*c),a.__colorArray=new Float32Array(3*c),a.__webglParticleCount=c,f(b)}function h(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(3*c),a.__colorArray=new Float32Array(3*c),a.__lineDistanceArray=new Float32Array(1*c),a.__webglLineCount=c,f(b)}function i(a,b){var c=b.geometry,d=a.faces3,e=3*d.length,f=1*d.length,g=3*d.length,h=j(b,a);a.__vertexArray=new Float32Array(3*e),a.__normalArray=new Float32Array(3*e),a.__colorArray=new Float32Array(3*e),a.__uvArray=new Float32Array(2*e),c.faceVertexUvs.length>1&&(a.__uv2Array=new Float32Array(2*e)),c.hasTangents&&(a.__tangentArray=new Float32Array(4*e)),b.geometry.skinWeights.length&&b.geometry.skinIndices.length&&(a.__skinIndexArray=new Float32Array(4*e),a.__skinWeightArray=new Float32Array(4*e));var i=null!==ab.get("OES_element_index_uint")&&f>21845?Uint32Array:Uint16Array;a.__typeArray=i,a.__faceArray=new i(3*f),a.__lineArray=new i(2*g);var k=a.numMorphTargets;if(k){a.__morphTargetsArrays=[];for(var l=0,m=k;l<m;l++)a.__morphTargetsArrays.push(new Float32Array(3*e))}var n=a.numMorphNormals;if(n){a.__morphNormalsArrays=[];for(var l=0,m=n;l<m;l++)a.__morphNormalsArrays.push(new Float32Array(3*e))}if(a.__webglFaceCount=3*f,a.__webglLineCount=2*g,h.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var o in h.attributes){var p=h.attributes[o],q={};for(var r in p)q[r]=p[r];if(!q.__webglInitialized||q.createUniqueBuffers){q.__webglInitialized=!0;var s=1;"v2"===q.type?s=2:"v3"===q.type?s=3:"v4"===q.type?s=4:"c"===q.type&&(s=3),q.size=s,q.array=new Float32Array(e*s),q.buffer=Fa.createBuffer(),q.buffer.belongsToAttribute=o,p.needsUpdate=!0,q.__original=p}a.__webglCustomAttributesList.push(q)}}a.__inittedArrays=!0}function j(a,b){return a.material instanceof c.MeshFaceMaterial?a.material.materials[b.materialIndex]:a.material}function k(a){return a instanceof c.MeshPhongMaterial==!1&&a.shading===c.FlatShading}function l(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=a.vertices,p=o.length,q=a.colors,r=q.length,s=a.__vertexArray,t=a.__colorArray,u=a.verticesNeedUpdate,v=a.colorsNeedUpdate,w=a.__webglCustomAttributesList;if(u){for(d=0;d<p;d++)f=o[d],g=3*d,s[g]=f.x,s[g+1]=f.y,s[g+2]=f.z;Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglVertexBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,s,b)}if(v){for(e=0;e<r;e++)h=q[e],g=3*e,t[g]=h.r,t[g+1]=h.g,t[g+2]=h.b;Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglColorBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,t,b)}if(w)for(i=0,j=w.length;i<j;i++){if(n=w[i],n.needsUpdate&&(void 0===n.boundTo||"vertices"===n.boundTo))if(l=n.value.length,g=0,1===n.size)for(k=0;k<l;k++)n.array[k]=n.value[k];else if(2===n.size)for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,g+=2;else if(3===n.size)if("c"===n.type)for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.r,n.array[g+1]=m.g,n.array[g+2]=m.b,g+=3;else for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,n.array[g+2]=m.z,g+=3;else if(4===n.size)for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,n.array[g+2]=m.z,n.array[g+3]=m.w,g+=4;Fa.bindBuffer(Fa.ARRAY_BUFFER,n.buffer),Fa.bufferData(Fa.ARRAY_BUFFER,n.array,b),n.needsUpdate=!1}}function m(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=a.vertices,p=a.colors,q=a.lineDistances,r=o.length,s=p.length,t=q.length,u=a.__vertexArray,v=a.__colorArray,w=a.__lineDistanceArray,x=a.verticesNeedUpdate,y=a.colorsNeedUpdate,z=a.lineDistancesNeedUpdate,A=a.__webglCustomAttributesList;if(x){for(c=0;c<r;c++)f=o[c],g=3*c,u[g]=f.x,u[g+1]=f.y,u[g+2]=f.z;Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglVertexBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,u,b)}if(y){for(d=0;d<s;d++)h=p[d],g=3*d,v[g]=h.r,v[g+1]=h.g,v[g+2]=h.b;Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglColorBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,v,b)}if(z){for(e=0;e<t;e++)w[e]=q[e];Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglLineDistanceBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,w,b)}if(A)for(i=0,j=A.length;i<j;i++)if(n=A[i],n.needsUpdate&&(void 0===n.boundTo||"vertices"===n.boundTo)){if(g=0,l=n.value.length,1===n.size)for(k=0;k<l;k++)n.array[k]=n.value[k];else if(2===n.size)for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,g+=2;else if(3===n.size)if("c"===n.type)for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.r,n.array[g+1]=m.g,n.array[g+2]=m.b,g+=3;else for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,n.array[g+2]=m.z,g+=3;else if(4===n.size)for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,n.array[g+2]=m.z,n.array[g+3]=m.w,g+=4;Fa.bindBuffer(Fa.ARRAY_BUFFER,n.buffer),Fa.bufferData(Fa.ARRAY_BUFFER,n.array,b),n.needsUpdate=!1}}function n(a,b,d,e,f){if(a.__inittedArrays){var g,h,i,j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X=k(f),Y=0,Z=0,$=0,_=0,aa=0,ba=0,ca=0,da=0,ea=0,fa=0,ga=0,ha=0,ia=a.__vertexArray,ja=a.__uvArray,ka=a.__uv2Array,la=a.__normalArray,ma=a.__tangentArray,na=a.__colorArray,oa=a.__skinIndexArray,pa=a.__skinWeightArray,qa=a.__morphTargetsArrays,ra=a.__morphNormalsArrays,sa=a.__webglCustomAttributesList,ta=a.__faceArray,ua=a.__lineArray,va=b.geometry,wa=va.verticesNeedUpdate,xa=va.elementsNeedUpdate,ya=va.uvsNeedUpdate,za=va.normalsNeedUpdate,Aa=va.tangentsNeedUpdate,Ba=va.colorsNeedUpdate,Ca=va.morphTargetsNeedUpdate,Da=va.vertices,Ea=a.faces3,Ga=va.faces,Ha=va.faceVertexUvs[0],Ia=va.faceVertexUvs[1],Ja=va.skinIndices,Ka=va.skinWeights,La=va.morphTargets,Ma=va.morphNormals;if(wa){for(g=0,h=Ea.length;g<h;g++)j=Ga[Ea[g]],s=Da[j.a],t=Da[j.b],u=Da[j.c],ia[Z]=s.x,ia[Z+1]=s.y,ia[Z+2]=s.z,ia[Z+3]=t.x,ia[Z+4]=t.y,ia[Z+5]=t.z,ia[Z+6]=u.x,ia[Z+7]=u.y,ia[Z+8]=u.z,Z+=9;Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglVertexBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,ia,d)}if(Ca)for(P=0,Q=La.length;P<Q;P++){for(ga=0,g=0,h=Ea.length;g<h;g++)T=Ea[g],j=Ga[T],s=La[P].vertices[j.a],t=La[P].vertices[j.b],u=La[P].vertices[j.c],R=qa[P],R[ga]=s.x,R[ga+1]=s.y,R[ga+2]=s.z,R[ga+3]=t.x,R[ga+4]=t.y,R[ga+5]=t.z,R[ga+6]=u.x,R[ga+7]=u.y,R[ga+8]=u.z,f.morphNormals&&(X?(y=Ma[P].faceNormals[T],z=y,A=y):(U=Ma[P].vertexNormals[T],y=U.a,z=U.b,A=U.c),S=ra[P],S[ga]=y.x,S[ga+1]=y.y,S[ga+2]=y.z,S[ga+3]=z.x,S[ga+4]=z.y,S[ga+5]=z.z,S[ga+6]=A.x,S[ga+7]=A.y,S[ga+8]=A.z),ga+=9;Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglMorphTargetsBuffers[P]),Fa.bufferData(Fa.ARRAY_BUFFER,qa[P],d),f.morphNormals&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglMorphNormalsBuffers[P]),Fa.bufferData(Fa.ARRAY_BUFFER,ra[P],d))}if(Ka.length){for(g=0,h=Ea.length;g<h;g++)j=Ga[Ea[g]],E=Ka[j.a],F=Ka[j.b],G=Ka[j.c],pa[fa]=E.x,pa[fa+1]=E.y,pa[fa+2]=E.z,pa[fa+3]=E.w,pa[fa+4]=F.x,pa[fa+5]=F.y,pa[fa+6]=F.z,pa[fa+7]=F.w,pa[fa+8]=G.x,pa[fa+9]=G.y,pa[fa+10]=G.z,pa[fa+11]=G.w,H=Ja[j.a],I=Ja[j.b],J=Ja[j.c],oa[fa]=H.x,oa[fa+1]=H.y,oa[fa+2]=H.z,oa[fa+3]=H.w,oa[fa+4]=I.x,oa[fa+5]=I.y,oa[fa+6]=I.z,oa[fa+7]=I.w,oa[fa+8]=J.x,oa[fa+9]=J.y,oa[fa+10]=J.z,oa[fa+11]=J.w,fa+=12;fa>0&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglSkinIndicesBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,oa,d),Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglSkinWeightsBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,pa,d))}if(Ba){for(g=0,h=Ea.length;g<h;g++)j=Ga[Ea[g]],n=j.vertexColors,o=j.color,3===n.length&&f.vertexColors===c.VertexColors?(B=n[0],C=n[1],D=n[2]):(B=o,C=o,D=o),na[ea]=B.r,na[ea+1]=B.g,na[ea+2]=B.b,na[ea+3]=C.r,na[ea+4]=C.g,na[ea+5]=C.b,na[ea+6]=D.r,na[ea+7]=D.g,na[ea+8]=D.b,ea+=9;ea>0&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglColorBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,na,d))}if(Aa&&va.hasTangents){for(g=0,h=Ea.length;g<h;g++)j=Ga[Ea[g]],p=j.vertexTangents,v=p[0],w=p[1],x=p[2],ma[ca]=v.x,ma[ca+1]=v.y,ma[ca+2]=v.z,ma[ca+3]=v.w,ma[ca+4]=w.x,ma[ca+5]=w.y,ma[ca+6]=w.z,ma[ca+7]=w.w,ma[ca+8]=x.x,ma[ca+9]=x.y,ma[ca+10]=x.z,ma[ca+11]=x.w,ca+=12;Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglTangentBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,ma,d)}if(za){for(g=0,h=Ea.length;g<h;g++)if(j=Ga[Ea[g]],l=j.vertexNormals,m=j.normal,3===l.length&&!1===X)for(K=0;K<3;K++)M=l[K],la[ba]=M.x,la[ba+1]=M.y,la[ba+2]=M.z,ba+=3;else for(K=0;K<3;K++)la[ba]=m.x,la[ba+1]=m.y,la[ba+2]=m.z,ba+=3;Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglNormalBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,la,d)}if(ya&&Ha){for(g=0,h=Ea.length;g<h;g++)if(i=Ea[g],void 0!==(q=Ha[i]))for(K=0;K<3;K++)N=q[K],ja[$]=N.x,ja[$+1]=N.y,$+=2;$>0&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglUVBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,ja,d))}if(ya&&Ia){for(g=0,h=Ea.length;g<h;g++)if(i=Ea[g],void 0!==(r=Ia[i]))for(K=0;K<3;K++)O=r[K],ka[_]=O.x,ka[_+1]=O.y,_+=2;_>0&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglUV2Buffer),Fa.bufferData(Fa.ARRAY_BUFFER,ka,d))}if(xa){for(g=0,h=Ea.length;g<h;g++)ta[aa]=Y,ta[aa+1]=Y+1,ta[aa+2]=Y+2,aa+=3,ua[da]=Y,ua[da+1]=Y+1,ua[da+2]=Y,ua[da+3]=Y+2,ua[da+4]=Y+1,ua[da+5]=Y+2,da+=6,Y+=3;Fa.bindBuffer(Fa.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer),Fa.bufferData(Fa.ELEMENT_ARRAY_BUFFER,ta,d),Fa.bindBuffer(Fa.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer),Fa.bufferData(Fa.ELEMENT_ARRAY_BUFFER,ua,d)}if(sa)for(K=0,L=sa.length;K<L;K++)if(W=sa[K],W.__original.needsUpdate){if(ha=0,1===W.size){if(void 0===W.boundTo||"vertices"===W.boundTo)for(g=0,h=Ea.length;g<h;g++)j=Ga[Ea[g]],W.array[ha]=W.value[j.a],W.array[ha+1]=W.value[j.b],W.array[ha+2]=W.value[j.c],ha+=3;else if("faces"===W.boundTo)for(g=0,h=Ea.length;g<h;g++)V=W.value[Ea[g]],W.array[ha]=V,W.array[ha+1]=V,W.array[ha+2]=V,ha+=3}else if(2===W.size){if(void 0===W.boundTo||"vertices"===W.boundTo)for(g=0,h=Ea.length;g<h;g++)j=Ga[Ea[g]],s=W.value[j.a],t=W.value[j.b],u=W.value[j.c],W.array[ha]=s.x,W.array[ha+1]=s.y,W.array[ha+2]=t.x,W.array[ha+3]=t.y,W.array[ha+4]=u.x,W.array[ha+5]=u.y,ha+=6;else if("faces"===W.boundTo)for(g=0,h=Ea.length;g<h;g++)V=W.value[Ea[g]],s=V,t=V,u=V,W.array[ha]=s.x,W.array[ha+1]=s.y,W.array[ha+2]=t.x,W.array[ha+3]=t.y,W.array[ha+4]=u.x,W.array[ha+5]=u.y,ha+=6}else if(3===W.size){var Na;if(Na="c"===W.type?["r","g","b"]:["x","y","z"],void 0===W.boundTo||"vertices"===W.boundTo)for(g=0,h=Ea.length;g<h;g++)j=Ga[Ea[g]],s=W.value[j.a],t=W.value[j.b],u=W.value[j.c],W.array[ha]=s[Na[0]],W.array[ha+1]=s[Na[1]],W.array[ha+2]=s[Na[2]],W.array[ha+3]=t[Na[0]],W.array[ha+4]=t[Na[1]],W.array[ha+5]=t[Na[2]],W.array[ha+6]=u[Na[0]],W.array[ha+7]=u[Na[1]],W.array[ha+8]=u[Na[2]],ha+=9;else if("faces"===W.boundTo)for(g=0,h=Ea.length;g<h;g++)V=W.value[Ea[g]],s=V,t=V,u=V,W.array[ha]=s[Na[0]],W.array[ha+1]=s[Na[1]],W.array[ha+2]=s[Na[2]],W.array[ha+3]=t[Na[0]],W.array[ha+4]=t[Na[1]],W.array[ha+5]=t[Na[2]],W.array[ha+6]=u[Na[0]],W.array[ha+7]=u[Na[1]],W.array[ha+8]=u[Na[2]],ha+=9;else if("faceVertices"===W.boundTo)for(g=0,h=Ea.length;g<h;g++)V=W.value[Ea[g]],s=V[0],t=V[1],u=V[2],W.array[ha]=s[Na[0]],W.array[ha+1]=s[Na[1]],W.array[ha+2]=s[Na[2]],W.array[ha+3]=t[Na[0]],W.array[ha+4]=t[Na[1]],W.array[ha+5]=t[Na[2]],W.array[ha+6]=u[Na[0]],W.array[ha+7]=u[Na[1]],W.array[ha+8]=u[Na[2]],ha+=9}else if(4===W.size)if(void 0===W.boundTo||"vertices"===W.boundTo)for(g=0,h=Ea.length;g<h;g++)j=Ga[Ea[g]],s=W.value[j.a],t=W.value[j.b],u=W.value[j.c],W.array[ha]=s.x,W.array[ha+1]=s.y,W.array[ha+2]=s.z,W.array[ha+3]=s.w,W.array[ha+4]=t.x,W.array[ha+5]=t.y,W.array[ha+6]=t.z,W.array[ha+7]=t.w,W.array[ha+8]=u.x,W.array[ha+9]=u.y,W.array[ha+10]=u.z,W.array[ha+11]=u.w,ha+=12;else if("faces"===W.boundTo)for(g=0,h=Ea.length;g<h;g++)V=W.value[Ea[g]],s=V,t=V,u=V,W.array[ha]=s.x,W.array[ha+1]=s.y,W.array[ha+2]=s.z,W.array[ha+3]=s.w,W.array[ha+4]=t.x,W.array[ha+5]=t.y,W.array[ha+6]=t.z,W.array[ha+7]=t.w,W.array[ha+8]=u.x,W.array[ha+9]=u.y,W.array[ha+10]=u.z,W.array[ha+11]=u.w,ha+=12;else if("faceVertices"===W.boundTo)for(g=0,h=Ea.length;g<h;g++)V=W.value[Ea[g]],s=V[0],t=V[1],u=V[2],W.array[ha]=s.x,W.array[ha+1]=s.y,W.array[ha+2]=s.z,W.array[ha+3]=s.w,W.array[ha+4]=t.x,W.array[ha+5]=t.y,W.array[ha+6]=t.z,W.array[ha+7]=t.w,W.array[ha+8]=u.x,W.array[ha+9]=u.y,W.array[ha+10]=u.z,W.array[ha+11]=u.w,ha+=12;Fa.bindBuffer(Fa.ARRAY_BUFFER,W.buffer),Fa.bufferData(Fa.ARRAY_BUFFER,W.array,d)}e&&(delete a.__inittedArrays,delete a.__colorArray,delete a.__normalArray,delete a.__tangentArray,delete a.__uvArray,delete a.__uv2Array,delete a.__faceArray,delete a.__vertexArray,delete a.__lineArray,delete a.__skinIndexArray,delete a.__skinWeightArray)}}function o(a,b,c,d){for(var e=c.attributes,f=b.attributes,g=b.attributesKeys,h=0,i=g.length;h<i;h++){var j=g[h],k=f[j];if(k>=0){var l=e[j];if(void 0!==l){var m=l.itemSize;Fa.bindBuffer(Fa.ARRAY_BUFFER,l.buffer),_a.enableAttribute(k),Fa.vertexAttribPointer(k,m,Fa.FLOAT,!1,0,d*m*4)}else void 0!==a.defaultAttributeValues&&(2===a.defaultAttributeValues[j].length?Fa.vertexAttrib2fv(k,a.defaultAttributeValues[j]):3===a.defaultAttributeValues[j].length&&Fa.vertexAttrib3fv(k,a.defaultAttributeValues[j]))}}_a.disableUnusedAttributes()}function p(a,b,c){var d=a.program.attributes;if(-1!==c.morphTargetBase&&d.position>=0?(Fa.bindBuffer(Fa.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[c.morphTargetBase]),_a.enableAttribute(d.position),Fa.vertexAttribPointer(d.position,3,Fa.FLOAT,!1,0,0)):d.position>=0&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,b.__webglVertexBuffer),_a.enableAttribute(d.position),Fa.vertexAttribPointer(d.position,3,Fa.FLOAT,!1,0,0)),c.morphTargetForcedOrder.length)for(var e,f=0,g=c.morphTargetForcedOrder,h=c.morphTargetInfluences;f<a.numSupportedMorphTargets&&f<g.length;)e=d["morphTarget"+f],e>=0&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[g[f]]),_a.enableAttribute(e),Fa.vertexAttribPointer(e,3,Fa.FLOAT,!1,0,0)),e=d["morphNormal"+f],e>=0&&a.morphNormals&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,b.__webglMorphNormalsBuffers[g[f]]),_a.enableAttribute(e),Fa.vertexAttribPointer(e,3,Fa.FLOAT,!1,0,0)),c.__webglMorphTargetInfluences[f]=h[g[f]],f++;else{var i=[],h=c.morphTargetInfluences,j=c.geometry.morphTargets;h.length>j.length&&(console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array."),h.length=j.length);for(var k=0,l=h.length;k<l;k++){var m=h[k];i.push([m,k])}i.length>a.numSupportedMorphTargets?(i.sort(s),i.length=a.numSupportedMorphTargets):i.length>a.numSupportedMorphNormals?i.sort(s):0===i.length&&i.push([0,0])
;for(var e,f=0,n=a.numSupportedMorphTargets;f<n;f++)if(i[f]){var o=i[f][1];e=d["morphTarget"+f],e>=0&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,b.__webglMorphTargetsBuffers[o]),_a.enableAttribute(e),Fa.vertexAttribPointer(e,3,Fa.FLOAT,!1,0,0)),e=d["morphNormal"+f],e>=0&&a.morphNormals&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,b.__webglMorphNormalsBuffers[o]),_a.enableAttribute(e),Fa.vertexAttribPointer(e,3,Fa.FLOAT,!1,0,0)),c.__webglMorphTargetInfluences[f]=h[o]}else c.__webglMorphTargetInfluences[f]=0}null!==a.program.uniforms.morphTargetInfluences&&Fa.uniform1fv(a.program.uniforms.morphTargetInfluences,c.__webglMorphTargetInfluences)}function q(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function r(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function s(a,b){return b[0]-a[0]}function t(a){if(!1!==a.visible){if(a instanceof c.Scene||a instanceof c.Group);else if(y(a),a instanceof c.Light)ya.push(a);else if(a instanceof c.Sprite)Da.push(a);else if(a instanceof c.LensFlare)Ea.push(a);else{var b=za[a.id];if(b&&(!1===a.frustumCulled||!0===Ua.intersectsObject(a)))for(var d=0,e=b.length;d<e;d++){var f=b[d];x(f),f.render=!0,!0===Ga.sortObjects&&(Wa.setFromMatrixPosition(a.matrixWorld),Wa.applyProjection(Va),f.z=Wa.z)}}for(var d=0,e=a.children.length;d<e;d++)t(a.children[d])}}function u(a,b,d,e,f){for(var g,h=0,i=a.length;h<i;h++){var j=a[h],k=j.object,l=j.buffer;if(Y(k,b),f)g=f;else{if(!(g=j.material))continue;J(g)}Ga.setMaterialFaces(g),l instanceof c.BufferGeometry?Ga.renderBufferDirect(b,d,e,g,l,k):Ga.renderBuffer(b,d,e,g,l,k)}}function v(a,b,c,d,e,f){for(var g,h=0,i=a.length;h<i;h++){var j=a[h],k=j.object;if(k.visible){if(f)g=f;else{if(!(g=j[b]))continue;J(g)}Ga.renderImmediateObject(c,d,e,g,k)}}}function w(a){var b=a.object,c=b.material;c.transparent?(a.transparent=c,a.opaque=null):(a.opaque=c,a.transparent=null)}function x(a){var b=a.object,d=a.buffer,e=b.geometry,f=b.material;if(f instanceof c.MeshFaceMaterial){var g=e instanceof c.BufferGeometry?0:d.materialIndex;f=f.materials[g],a.material=f,f.transparent?Ca.push(a):Ba.push(a)}else f&&(a.material=f,f.transparent?Ca.push(a):Ba.push(a))}function y(a){void 0===a.__webglInit&&(a.__webglInit=!0,a._modelViewMatrix=new c.Matrix4,a._normalMatrix=new c.Matrix3,a.addEventListener("removed",ub));var e=a.geometry;if(void 0===e||void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",vb),e instanceof c.BufferGeometry?Ga.info.memory.geometries++:a instanceof c.Mesh?A(a,e):a instanceof c.Line?void 0===e.__webglVertexBuffer&&(d(e),h(e,a),e.verticesNeedUpdate=!0,e.colorsNeedUpdate=!0,e.lineDistancesNeedUpdate=!0):a instanceof c.PointCloud&&void 0===e.__webglVertexBuffer&&(b(e),g(e,a),e.verticesNeedUpdate=!0,e.colorsNeedUpdate=!0)),void 0===a.__webglActive)if(a.__webglActive=!0,a instanceof c.Mesh){if(e instanceof c.BufferGeometry)B(za,e,a);else if(e instanceof c.Geometry)for(var f=Eb[e.id],i=0,j=f.length;i<j;i++)B(za,f[i],a)}else a instanceof c.Line||a instanceof c.PointCloud?B(za,e,a):(a instanceof c.ImmediateRenderObject||a.immediateRenderCallback)&&C(Aa,a)}function z(a,b){for(var c,d,e=ab.get("OES_element_index_uint")?4294967296:65535,f={},g=a.morphTargets.length,h=a.morphNormals.length,i={},j=[],k=0,l=a.faces.length;k<l;k++){var m=a.faces[k],n=b?m.materialIndex:0;n in f||(f[n]={hash:n,counter:0}),c=f[n].hash+"_"+f[n].counter,c in i||(d={id:Fb++,faces3:[],materialIndex:n,vertices:0,numMorphTargets:g,numMorphNormals:h},i[c]=d,j.push(d)),i[c].vertices+3>e&&(f[n].counter+=1,(c=f[n].hash+"_"+f[n].counter)in i||(d={id:Fb++,faces3:[],materialIndex:n,vertices:0,numMorphTargets:g,numMorphNormals:h},i[c]=d,j.push(d))),i[c].faces3.push(k),i[c].vertices+=3}return j}function A(a,b){var d=a.material,f=!1;void 0!==Eb[b.id]&&!0!==b.groupsNeedUpdate||(delete za[a.id],Eb[b.id]=z(b,d instanceof c.MeshFaceMaterial),b.groupsNeedUpdate=!1);for(var g=Eb[b.id],h=0,j=g.length;h<j;h++){var k=g[h];void 0===k.__webglVertexBuffer?(e(k),i(k,a),b.verticesNeedUpdate=!0,b.morphTargetsNeedUpdate=!0,b.elementsNeedUpdate=!0,b.uvsNeedUpdate=!0,b.normalsNeedUpdate=!0,b.tangentsNeedUpdate=!0,b.colorsNeedUpdate=!0,f=!0):f=!1,(f||void 0===a.__webglActive)&&B(za,k,a)}a.__webglActive=!0}function B(a,b,c){var d=c.id;a[d]=a[d]||[],a[d].push({id:d,buffer:b,object:c,material:null,z:0})}function C(a,b){a.push({id:null,object:b,opaque:null,transparent:null,z:0})}function D(a){var b=a.geometry;if(b instanceof c.BufferGeometry)for(var d=b.attributes,e=b.attributesKeys,f=0,g=e.length;f<g;f++){var h=e[f],i=d[h],k="index"===h?Fa.ELEMENT_ARRAY_BUFFER:Fa.ARRAY_BUFFER;void 0===i.buffer?(i.buffer=Fa.createBuffer(),Fa.bindBuffer(k,i.buffer),Fa.bufferData(k,i.array,i instanceof c.DynamicBufferAttribute?Fa.DYNAMIC_DRAW:Fa.STATIC_DRAW),i.needsUpdate=!1):!0===i.needsUpdate&&(Fa.bindBuffer(k,i.buffer),void 0===i.updateRange||-1===i.updateRange.count?Fa.bufferSubData(k,0,i.array):0===i.updateRange.count?console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually."):(Fa.bufferSubData(k,i.updateRange.offset*i.array.BYTES_PER_ELEMENT,i.array.subarray(i.updateRange.offset,i.updateRange.offset+i.updateRange.count)),i.updateRange.count=0),i.needsUpdate=!1)}else if(a instanceof c.Mesh){!0===b.groupsNeedUpdate&&A(a,b);for(var o=Eb[b.id],f=0,p=o.length;f<p;f++){var q=o[f],r=j(a,q),s=r.attributes&&E(r);(b.verticesNeedUpdate||b.morphTargetsNeedUpdate||b.elementsNeedUpdate||b.uvsNeedUpdate||b.normalsNeedUpdate||b.colorsNeedUpdate||b.tangentsNeedUpdate||s)&&n(q,a,Fa.DYNAMIC_DRAW,!b.dynamic,r)}b.verticesNeedUpdate=!1,b.morphTargetsNeedUpdate=!1,b.elementsNeedUpdate=!1,b.uvsNeedUpdate=!1,b.normalsNeedUpdate=!1,b.colorsNeedUpdate=!1,b.tangentsNeedUpdate=!1,r.attributes&&F(r)}else if(a instanceof c.Line){var r=j(a,b),s=r.attributes&&E(r);(b.verticesNeedUpdate||b.colorsNeedUpdate||b.lineDistancesNeedUpdate||s)&&m(b,Fa.DYNAMIC_DRAW),b.verticesNeedUpdate=!1,b.colorsNeedUpdate=!1,b.lineDistancesNeedUpdate=!1,r.attributes&&F(r)}else if(a instanceof c.PointCloud){var r=j(a,b),s=r.attributes&&E(r);(b.verticesNeedUpdate||b.colorsNeedUpdate||s)&&l(b,Fa.DYNAMIC_DRAW,a),b.verticesNeedUpdate=!1,b.colorsNeedUpdate=!1,r.attributes&&F(r)}}function E(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return!0;return!1}function F(a){for(var b in a.attributes)a.attributes[b].needsUpdate=!1}function G(a){a instanceof c.Mesh||a instanceof c.PointCloud||a instanceof c.Line?delete za[a.id]:(a instanceof c.ImmediateRenderObject||a.immediateRenderCallback)&&H(Aa,a),delete a.__webglInit,delete a._modelViewMatrix,delete a._normalMatrix,delete a.__webglActive}function H(a,b){for(var c=a.length-1;c>=0;c--)a[c].object===b&&a.splice(c,1)}function I(a,b,d,e){a.addEventListener("dispose",yb);var f=Gb[a.type];if(f){var g=c.ShaderLib[f];a.__webglShader={uniforms:c.UniformsUtils.clone(g.uniforms),vertexShader:g.vertexShader,fragmentShader:g.fragmentShader}}else a.__webglShader={uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader};var h=ja(b),i=ka(b),j=ia(e),k={precision:oa,supportsVertexTextures:ib,map:!!a.map,envMap:!!a.envMap,envMapMode:a.envMap&&a.envMap.mapping,lightMap:!!a.lightMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,specularMap:!!a.specularMap,alphaMap:!!a.alphaMap,combine:a.combine,vertexColors:a.vertexColors,fog:d,useFog:a.fog,fogExp:d instanceof c.FogExp2,flatShading:a.shading===c.FlatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:va,skinning:a.skinning,maxBones:j,useVertexTexture:jb&&e&&e.skeleton&&e.skeleton.useVertexTexture,morphTargets:a.morphTargets,morphNormals:a.morphNormals,maxMorphTargets:Ga.maxMorphTargets,maxMorphNormals:Ga.maxMorphNormals,maxDirLights:h.directional,maxPointLights:h.point,maxSpotLights:h.spot,maxHemiLights:h.hemi,maxShadows:i,shadowMapEnabled:Ga.shadowMapEnabled&&e.receiveShadow&&i>0,shadowMapType:Ga.shadowMapType,shadowMapDebug:Ga.shadowMapDebug,shadowMapCascade:Ga.shadowMapCascade,alphaTest:a.alphaTest,metal:a.metal,wrapAround:a.wrapAround,doubleSided:a.side===c.DoubleSide,flipSided:a.side===c.BackSide},l=[];if(f?l.push(f):(l.push(a.fragmentShader),l.push(a.vertexShader)),void 0!==a.defines)for(var m in a.defines)l.push(m),l.push(a.defines[m]);for(var m in k)l.push(m),l.push(k[m]);for(var n,o=l.join(),p=0,q=Ha.length;p<q;p++){var r=Ha[p];if(r.code===o){n=r,n.usedTimes++;break}}void 0===n&&(n=new c.WebGLProgram(Ga,o,a,k),Ha.push(n),Ga.info.memory.programs=Ha.length),a.program=n;var s=n.attributes;if(a.morphTargets){a.numSupportedMorphTargets=0;for(var t,u="morphTarget",v=0;v<Ga.maxMorphTargets;v++)t=u+v,s[t]>=0&&a.numSupportedMorphTargets++}if(a.morphNormals){a.numSupportedMorphNormals=0;var t,u="morphNormal";for(v=0;v<Ga.maxMorphNormals;v++)t=u+v,s[t]>=0&&a.numSupportedMorphNormals++}a.uniformsList=[];for(var w in a.__webglShader.uniforms){var x=a.program.uniforms[w];x&&a.uniformsList.push([a.__webglShader.uniforms[w],x])}}function J(a){!0===a.transparent?_a.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha):_a.setBlending(c.NoBlending),_a.setDepthTest(a.depthTest),_a.setDepthWrite(a.depthWrite),_a.setColorWrite(a.colorWrite),_a.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function K(a,b,d,e,f){Na=0,e.needsUpdate&&(e.program&&Db(e),I(e,b,d,f),e.needsUpdate=!1),e.morphTargets&&(f.__webglMorphTargetInfluences||(f.__webglMorphTargetInfluences=new Float32Array(Ga.maxMorphTargets)));var g=!1,h=!1,i=!1,j=e.program,k=j.uniforms,l=e.__webglShader.uniforms;if(j.id!==Ia&&(Fa.useProgram(j.program),Ia=j.id,g=!0,h=!0,i=!0),e.id!==Ka&&(-1===Ka&&(i=!0),Ka=e.id,h=!0),(g||a!==Ma)&&(Fa.uniformMatrix4fv(k.projectionMatrix,!1,a.projectionMatrix.elements),va&&Fa.uniform1f(k.logDepthBufFC,2/(Math.log(a.far+1)/Math.LN2)),a!==Ma&&(Ma=a),(e instanceof c.ShaderMaterial||e instanceof c.MeshPhongMaterial||e.envMap)&&null!==k.cameraPosition&&(Wa.setFromMatrixPosition(a.matrixWorld),Fa.uniform3f(k.cameraPosition,Wa.x,Wa.y,Wa.z)),(e instanceof c.MeshPhongMaterial||e instanceof c.MeshLambertMaterial||e instanceof c.MeshBasicMaterial||e instanceof c.ShaderMaterial||e.skinning)&&null!==k.viewMatrix&&Fa.uniformMatrix4fv(k.viewMatrix,!1,a.matrixWorldInverse.elements)),e.skinning)if(f.bindMatrix&&null!==k.bindMatrix&&Fa.uniformMatrix4fv(k.bindMatrix,!1,f.bindMatrix.elements),f.bindMatrixInverse&&null!==k.bindMatrixInverse&&Fa.uniformMatrix4fv(k.bindMatrixInverse,!1,f.bindMatrixInverse.elements),jb&&f.skeleton&&f.skeleton.useVertexTexture){if(null!==k.boneTexture){var m=W();Fa.uniform1i(k.boneTexture,m),Ga.setTexture(f.skeleton.boneTexture,m)}null!==k.boneTextureWidth&&Fa.uniform1i(k.boneTextureWidth,f.skeleton.boneTextureWidth),null!==k.boneTextureHeight&&Fa.uniform1i(k.boneTextureHeight,f.skeleton.boneTextureHeight)}else f.skeleton&&f.skeleton.boneMatrices&&null!==k.boneGlobalMatrices&&Fa.uniformMatrix4fv(k.boneGlobalMatrices,!1,f.skeleton.boneMatrices);return h&&(d&&e.fog&&P(l,d),(e instanceof c.MeshPhongMaterial||e instanceof c.MeshLambertMaterial||e.lights)&&(Ya&&(i=!0,$(b),Ya=!1),i?(S(l,Za),T(l,!0)):T(l,!1)),(e instanceof c.MeshBasicMaterial||e instanceof c.MeshLambertMaterial||e instanceof c.MeshPhongMaterial)&&L(l,e),e instanceof c.LineBasicMaterial?M(l,e):e instanceof c.LineDashedMaterial?(M(l,e),N(l,e)):e instanceof c.PointCloudMaterial?O(l,e):e instanceof c.MeshPhongMaterial?Q(l,e):e instanceof c.MeshLambertMaterial?R(l,e):e instanceof c.MeshDepthMaterial?(l.mNear.value=a.near,l.mFar.value=a.far,l.opacity.value=e.opacity):e instanceof c.MeshNormalMaterial&&(l.opacity.value=e.opacity),f.receiveShadow&&!e._shadowPass&&U(l,b),X(e.uniformsList)),V(k,f),null!==k.modelMatrix&&Fa.uniformMatrix4fv(k.modelMatrix,!1,f.matrixWorld.elements),j}function L(a,b){a.opacity.value=b.opacity,a.diffuse.value=b.color,a.map.value=b.map,a.lightMap.value=b.lightMap,a.specularMap.value=b.specularMap,a.alphaMap.value=b.alphaMap,b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale),b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale));var d;if(b.map?d=b.map:b.specularMap?d=b.specularMap:b.normalMap?d=b.normalMap:b.bumpMap?d=b.bumpMap:b.alphaMap&&(d=b.alphaMap),void 0!==d){var e=d.offset,f=d.repeat;a.offsetRepeat.value.set(e.x,e.y,f.x,f.y)}a.envMap.value=b.envMap,a.flipEnvMap.value=b.envMap instanceof c.WebGLRenderTargetCube?1:-1,a.reflectivity.value=b.reflectivity,a.refractionRatio.value=b.refractionRatio}function M(a,b){a.diffuse.value=b.color,a.opacity.value=b.opacity}function N(a,b){a.dashSize.value=b.dashSize,a.totalSize.value=b.dashSize+b.gapSize,a.scale.value=b.scale}function O(a,b){if(a.psColor.value=b.color,a.opacity.value=b.opacity,a.size.value=b.size,a.scale.value=la.height/2,a.map.value=b.map,null!==b.map){var c=b.map.offset,d=b.map.repeat;a.offsetRepeat.value.set(c.x,c.y,d.x,d.y)}}function P(a,b){a.fogColor.value=b.color,b instanceof c.Fog?(a.fogNear.value=b.near,a.fogFar.value=b.far):b instanceof c.FogExp2&&(a.fogDensity.value=b.density)}function Q(a,b){a.shininess.value=b.shininess,a.emissive.value=b.emissive,a.specular.value=b.specular,b.wrapAround&&a.wrapRGB.value.copy(b.wrapRGB)}function R(a,b){a.emissive.value=b.emissive,b.wrapAround&&a.wrapRGB.value.copy(b.wrapRGB)}function S(a,b){a.ambientLightColor.value=b.ambient,a.directionalLightColor.value=b.directional.colors,a.directionalLightDirection.value=b.directional.positions,a.pointLightColor.value=b.point.colors,a.pointLightPosition.value=b.point.positions,a.pointLightDistance.value=b.point.distances,a.pointLightDecay.value=b.point.decays,a.spotLightColor.value=b.spot.colors,a.spotLightPosition.value=b.spot.positions,a.spotLightDistance.value=b.spot.distances,a.spotLightDirection.value=b.spot.directions,a.spotLightAngleCos.value=b.spot.anglesCos,a.spotLightExponent.value=b.spot.exponents,a.spotLightDecay.value=b.spot.decays,a.hemisphereLightSkyColor.value=b.hemi.skyColors,a.hemisphereLightGroundColor.value=b.hemi.groundColors,a.hemisphereLightDirection.value=b.hemi.positions}function T(a,b){a.ambientLightColor.needsUpdate=b,a.directionalLightColor.needsUpdate=b,a.directionalLightDirection.needsUpdate=b,a.pointLightColor.needsUpdate=b,a.pointLightPosition.needsUpdate=b,a.pointLightDistance.needsUpdate=b,a.pointLightDecay.needsUpdate=b,a.spotLightColor.needsUpdate=b,a.spotLightPosition.needsUpdate=b,a.spotLightDistance.needsUpdate=b,a.spotLightDirection.needsUpdate=b,a.spotLightAngleCos.needsUpdate=b,a.spotLightExponent.needsUpdate=b,a.spotLightDecay.needsUpdate=b,a.hemisphereLightSkyColor.needsUpdate=b,a.hemisphereLightGroundColor.needsUpdate=b,a.hemisphereLightDirection.needsUpdate=b}function U(a,b){if(a.shadowMatrix)for(var d=0,e=0,f=b.length;e<f;e++){var g=b[e];g.castShadow&&((g instanceof c.SpotLight||g instanceof c.DirectionalLight&&!g.shadowCascade)&&(a.shadowMap.value[d]=g.shadowMap,a.shadowMapSize.value[d]=g.shadowMapSize,a.shadowMatrix.value[d]=g.shadowMatrix,a.shadowDarkness.value[d]=g.shadowDarkness,a.shadowBias.value[d]=g.shadowBias,d++))}}function V(a,b){Fa.uniformMatrix4fv(a.modelViewMatrix,!1,b._modelViewMatrix.elements),a.normalMatrix&&Fa.uniformMatrix3fv(a.normalMatrix,!1,b._normalMatrix.elements)}function W(){var a=Na;return a>=eb&&c.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+eb),Na+=1,a}function X(a){for(var b,d,e,f=0,g=a.length;f<g;f++){var h=a[f][0];if(!1!==h.needsUpdate){var i=h.type,j=h.value,k=a[f][1];switch(i){case"1i":Fa.uniform1i(k,j);break;case"1f":Fa.uniform1f(k,j);break;case"2f":Fa.uniform2f(k,j[0],j[1]);break;case"3f":Fa.uniform3f(k,j[0],j[1],j[2]);break;case"4f":Fa.uniform4f(k,j[0],j[1],j[2],j[3]);break;case"1iv":Fa.uniform1iv(k,j);break;case"3iv":Fa.uniform3iv(k,j);break;case"1fv":Fa.uniform1fv(k,j);break;case"2fv":Fa.uniform2fv(k,j);break;case"3fv":Fa.uniform3fv(k,j);break;case"4fv":Fa.uniform4fv(k,j);break;case"Matrix3fv":Fa.uniformMatrix3fv(k,!1,j);break;case"Matrix4fv":Fa.uniformMatrix4fv(k,!1,j);break;case"i":Fa.uniform1i(k,j);break;case"f":Fa.uniform1f(k,j);break;case"v2":Fa.uniform2f(k,j.x,j.y);break;case"v3":Fa.uniform3f(k,j.x,j.y,j.z);break;case"v4":Fa.uniform4f(k,j.x,j.y,j.z,j.w);break;case"c":Fa.uniform3f(k,j.r,j.g,j.b);break;case"iv1":Fa.uniform1iv(k,j);break;case"iv":Fa.uniform3iv(k,j);break;case"fv1":Fa.uniform1fv(k,j);break;case"fv":Fa.uniform3fv(k,j);break;case"v2v":void 0===h._array&&(h._array=new Float32Array(2*j.length));for(var l=0,m=j.length;l<m;l++)e=2*l,h._array[e]=j[l].x,h._array[e+1]=j[l].y;Fa.uniform2fv(k,h._array);break;case"v3v":void 0===h._array&&(h._array=new Float32Array(3*j.length));for(var l=0,m=j.length;l<m;l++)e=3*l,h._array[e]=j[l].x,h._array[e+1]=j[l].y,h._array[e+2]=j[l].z;Fa.uniform3fv(k,h._array);break;case"v4v":void 0===h._array&&(h._array=new Float32Array(4*j.length));for(var l=0,m=j.length;l<m;l++)e=4*l,h._array[e]=j[l].x,h._array[e+1]=j[l].y,h._array[e+2]=j[l].z,h._array[e+3]=j[l].w;Fa.uniform4fv(k,h._array);break;case"m3":Fa.uniformMatrix3fv(k,!1,j.elements);break;case"m3v":void 0===h._array&&(h._array=new Float32Array(9*j.length));for(var l=0,m=j.length;l<m;l++)j[l].flattenToArrayOffset(h._array,9*l);Fa.uniformMatrix3fv(k,!1,h._array);break;case"m4":Fa.uniformMatrix4fv(k,!1,j.elements);break;case"m4v":void 0===h._array&&(h._array=new Float32Array(16*j.length));for(var l=0,m=j.length;l<m;l++)j[l].flattenToArrayOffset(h._array,16*l);Fa.uniformMatrix4fv(k,!1,h._array);break;case"t":if(b=j,d=W(),Fa.uniform1i(k,d),!b)continue;b instanceof c.CubeTexture||b.image instanceof Array&&6===b.image.length?ba(b,d):b instanceof c.WebGLRenderTargetCube?ca(b,d):Ga.setTexture(b,d);break;case"tv":void 0===h._array&&(h._array=[]);for(var l=0,m=h.value.length;l<m;l++)h._array[l]=W();Fa.uniform1iv(k,h._array);for(var l=0,m=h.value.length;l<m;l++)b=h.value[l],d=h._array[l],b&&Ga.setTexture(b,d);break;default:c.warn("THREE.WebGLRenderer: Unknown uniform type: "+i)}}}}function Y(a,b){a._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,a.matrixWorld),a._normalMatrix.getNormalMatrix(a._modelViewMatrix)}function Z(a,b,c,d){a[b]=c.r*d,a[b+1]=c.g*d,a[b+2]=c.b*d}function $(a){var b,d,e,f,g,h,i,j,k=0,l=0,m=0,n=Za,o=n.directional.colors,p=n.directional.positions,q=n.point.colors,r=n.point.positions,s=n.point.distances,t=n.point.decays,u=n.spot.colors,v=n.spot.positions,w=n.spot.distances,x=n.spot.directions,y=n.spot.anglesCos,z=n.spot.exponents,A=n.spot.decays,B=n.hemi.skyColors,C=n.hemi.groundColors,D=n.hemi.positions,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0;for(b=0,d=a.length;b<d;b++)if(e=a[b],!e.onlyShadow)if(f=e.color,i=e.intensity,j=e.distance,e instanceof c.AmbientLight){if(!e.visible)continue;k+=f.r,l+=f.g,m+=f.b}else if(e instanceof c.DirectionalLight){if(I+=1,!e.visible)continue;Xa.setFromMatrixPosition(e.matrixWorld),Wa.setFromMatrixPosition(e.target.matrixWorld),Xa.sub(Wa),Xa.normalize(),M=3*E,p[M]=Xa.x,p[M+1]=Xa.y,p[M+2]=Xa.z,Z(o,M,f,i),E+=1}else if(e instanceof c.PointLight){if(J+=1,!e.visible)continue;N=3*F,Z(q,N,f,i),Wa.setFromMatrixPosition(e.matrixWorld),r[N]=Wa.x,r[N+1]=Wa.y,r[N+2]=Wa.z,s[F]=j,t[F]=0===e.distance?0:e.decay,F+=1}else if(e instanceof c.SpotLight){if(K+=1,!e.visible)continue;O=3*G,Z(u,O,f,i),Xa.setFromMatrixPosition(e.matrixWorld),v[O]=Xa.x,v[O+1]=Xa.y,v[O+2]=Xa.z,w[G]=j,Wa.setFromMatrixPosition(e.target.matrixWorld),Xa.sub(Wa),Xa.normalize(),x[O]=Xa.x,x[O+1]=Xa.y,x[O+2]=Xa.z,y[G]=Math.cos(e.angle),z[G]=e.exponent,A[G]=0===e.distance?0:e.decay,G+=1}else if(e instanceof c.HemisphereLight){if(L+=1,!e.visible)continue;Xa.setFromMatrixPosition(e.matrixWorld),Xa.normalize(),P=3*H,D[P]=Xa.x,D[P+1]=Xa.y,D[P+2]=Xa.z,g=e.color,h=e.groundColor,Z(B,P,g,i),Z(C,P,h,i),H+=1}for(b=3*E,d=Math.max(o.length,3*I);b<d;b++)o[b]=0;for(b=3*F,d=Math.max(q.length,3*J);b<d;b++)q[b]=0;for(b=3*G,d=Math.max(u.length,3*K);b<d;b++)u[b]=0;for(b=3*H,d=Math.max(B.length,3*L);b<d;b++)B[b]=0;for(b=3*H,d=Math.max(C.length,3*L);b<d;b++)C[b]=0;n.directional.length=E,n.point.length=F,n.spot.length=G,n.hemi.length=H,n.ambient[0]=k,n.ambient[1]=l,n.ambient[2]=m}function _(a,b,d){var e;d?(Fa.texParameteri(a,Fa.TEXTURE_WRAP_S,ha(b.wrapS)),Fa.texParameteri(a,Fa.TEXTURE_WRAP_T,ha(b.wrapT)),Fa.texParameteri(a,Fa.TEXTURE_MAG_FILTER,ha(b.magFilter)),Fa.texParameteri(a,Fa.TEXTURE_MIN_FILTER,ha(b.minFilter))):(Fa.texParameteri(a,Fa.TEXTURE_WRAP_S,Fa.CLAMP_TO_EDGE),Fa.texParameteri(a,Fa.TEXTURE_WRAP_T,Fa.CLAMP_TO_EDGE),b.wrapS===c.ClampToEdgeWrapping&&b.wrapT===c.ClampToEdgeWrapping||c.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+b.sourceFile+" )"),Fa.texParameteri(a,Fa.TEXTURE_MAG_FILTER,ga(b.magFilter)),Fa.texParameteri(a,Fa.TEXTURE_MIN_FILTER,ga(b.minFilter)),b.minFilter!==c.NearestFilter&&b.minFilter!==c.LinearFilter&&c.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+b.sourceFile+" )")),(e=ab.get("EXT_texture_filter_anisotropic"))&&b.type!==c.FloatType&&b.type!==c.HalfFloatType&&(b.anisotropy>1||b.__currentAnisotropy)&&(Fa.texParameterf(a,e.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,Ga.getMaxAnisotropy())),b.__currentAnisotropy=b.anisotropy)}function aa(a,b){if(a.width>b||a.height>b){var d=b/Math.max(a.width,a.height),e=document.createElement("canvas");e.width=Math.floor(a.width*d),e.height=Math.floor(a.height*d);return e.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,e.width,e.height),c.warn("THREE.WebGLRenderer: image is too big ("+a.width+"x"+a.height+"). Resized to "+e.width+"x"+e.height,a),e}return a}function ba(a,b){if(6===a.image.length)if(a.needsUpdate){a.image.__webglTextureCube||(a.addEventListener("dispose",wb),a.image.__webglTextureCube=Fa.createTexture(),Ga.info.memory.textures++),Fa.activeTexture(Fa.TEXTURE0+b),Fa.bindTexture(Fa.TEXTURE_CUBE_MAP,a.image.__webglTextureCube),Fa.pixelStorei(Fa.UNPACK_FLIP_Y_WEBGL,a.flipY);for(var d=a instanceof c.CompressedTexture,e=a.image[0]instanceof c.DataTexture,f=[],g=0;g<6;g++)!Ga.autoScaleCubemaps||d||e?f[g]=e?a.image[g].image:a.image[g]:f[g]=aa(a.image[g],hb);var h=f[0],i=c.Math.isPowerOfTwo(h.width)&&c.Math.isPowerOfTwo(h.height),j=ha(a.format),k=ha(a.type);_(Fa.TEXTURE_CUBE_MAP,a,i);for(var g=0;g<6;g++)if(d)for(var l,m=f[g].mipmaps,n=0,o=m.length;n<o;n++)l=m[n],a.format!==c.RGBAFormat&&a.format!==c.RGBFormat?ob().indexOf(j)>-1?Fa.compressedTexImage2D(Fa.TEXTURE_CUBE_MAP_POSITIVE_X+g,n,j,l.width,l.height,0,l.data):c.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):Fa.texImage2D(Fa.TEXTURE_CUBE_MAP_POSITIVE_X+g,n,j,l.width,l.height,0,j,k,l.data);else e?Fa.texImage2D(Fa.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,j,f[g].width,f[g].height,0,j,k,f[g].data):Fa.texImage2D(Fa.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,j,j,k,f[g]);a.generateMipmaps&&i&&Fa.generateMipmap(Fa.TEXTURE_CUBE_MAP),a.needsUpdate=!1,a.onUpdate&&a.onUpdate()}else Fa.activeTexture(Fa.TEXTURE0+b),Fa.bindTexture(Fa.TEXTURE_CUBE_MAP,a.image.__webglTextureCube)}function ca(a,b){Fa.activeTexture(Fa.TEXTURE0+b),Fa.bindTexture(Fa.TEXTURE_CUBE_MAP,a.__webglTexture)}function da(a,b,c){Fa.bindFramebuffer(Fa.FRAMEBUFFER,a),Fa.framebufferTexture2D(Fa.FRAMEBUFFER,Fa.COLOR_ATTACHMENT0,c,b.__webglTexture,0)}function ea(a,b){Fa.bindRenderbuffer(Fa.RENDERBUFFER,a),b.depthBuffer&&!b.stencilBuffer?(Fa.renderbufferStorage(Fa.RENDERBUFFER,Fa.DEPTH_COMPONENT16,b.width,b.height),Fa.framebufferRenderbuffer(Fa.FRAMEBUFFER,Fa.DEPTH_ATTACHMENT,Fa.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(Fa.renderbufferStorage(Fa.RENDERBUFFER,Fa.DEPTH_STENCIL,b.width,b.height),Fa.framebufferRenderbuffer(Fa.FRAMEBUFFER,Fa.DEPTH_STENCIL_ATTACHMENT,Fa.RENDERBUFFER,a)):Fa.renderbufferStorage(Fa.RENDERBUFFER,Fa.RGBA4,b.width,b.height)}function fa(a){a instanceof c.WebGLRenderTargetCube?(Fa.bindTexture(Fa.TEXTURE_CUBE_MAP,a.__webglTexture),Fa.generateMipmap(Fa.TEXTURE_CUBE_MAP),Fa.bindTexture(Fa.TEXTURE_CUBE_MAP,null)):(Fa.bindTexture(Fa.TEXTURE_2D,a.__webglTexture),Fa.generateMipmap(Fa.TEXTURE_2D),Fa.bindTexture(Fa.TEXTURE_2D,null))}function ga(a){return a===c.NearestFilter||a===c.NearestMipMapNearestFilter||a===c.NearestMipMapLinearFilter?Fa.NEAREST:Fa.LINEAR}function ha(a){var b;if(a===c.RepeatWrapping)return Fa.REPEAT;if(a===c.ClampToEdgeWrapping)return Fa.CLAMP_TO_EDGE;if(a===c.MirroredRepeatWrapping)return Fa.MIRRORED_REPEAT;if(a===c.NearestFilter)return Fa.NEAREST;if(a===c.NearestMipMapNearestFilter)return Fa.NEAREST_MIPMAP_NEAREST;if(a===c.NearestMipMapLinearFilter)return Fa.NEAREST_MIPMAP_LINEAR;if(a===c.LinearFilter)return Fa.LINEAR;if(a===c.LinearMipMapNearestFilter)return Fa.LINEAR_MIPMAP_NEAREST;if(a===c.LinearMipMapLinearFilter)return Fa.LINEAR_MIPMAP_LINEAR;if(a===c.UnsignedByteType)return Fa.UNSIGNED_BYTE;if(a===c.UnsignedShort4444Type)return Fa.UNSIGNED_SHORT_4_4_4_4;if(a===c.UnsignedShort5551Type)return Fa.UNSIGNED_SHORT_5_5_5_1;if(a===c.UnsignedShort565Type)return Fa.UNSIGNED_SHORT_5_6_5;if(a===c.ByteType)return Fa.BYTE;if(a===c.ShortType)return Fa.SHORT;if(a===c.UnsignedShortType)return Fa.UNSIGNED_SHORT;if(a===c.IntType)return Fa.INT;if(a===c.UnsignedIntType)return Fa.UNSIGNED_INT;if(a===c.FloatType)return Fa.FLOAT;if(null!==(b=ab.get("OES_texture_half_float"))&&a===c.HalfFloatType)return b.HALF_FLOAT_OES;if(a===c.AlphaFormat)return Fa.ALPHA;if(a===c.RGBFormat)return Fa.RGB;if(a===c.RGBAFormat)return Fa.RGBA;if(a===c.LuminanceFormat)return Fa.LUMINANCE;if(a===c.LuminanceAlphaFormat)return Fa.LUMINANCE_ALPHA;if(a===c.AddEquation)return Fa.FUNC_ADD;if(a===c.SubtractEquation)return Fa.FUNC_SUBTRACT;if(a===c.ReverseSubtractEquation)return Fa.FUNC_REVERSE_SUBTRACT;if(a===c.ZeroFactor)return Fa.ZERO;if(a===c.OneFactor)return Fa.ONE;if(a===c.SrcColorFactor)return Fa.SRC_COLOR;if(a===c.OneMinusSrcColorFactor)return Fa.ONE_MINUS_SRC_COLOR;if(a===c.SrcAlphaFactor)return Fa.SRC_ALPHA;if(a===c.OneMinusSrcAlphaFactor)return Fa.ONE_MINUS_SRC_ALPHA;if(a===c.DstAlphaFactor)return Fa.DST_ALPHA;if(a===c.OneMinusDstAlphaFactor)return Fa.ONE_MINUS_DST_ALPHA;if(a===c.DstColorFactor)return Fa.DST_COLOR;if(a===c.OneMinusDstColorFactor)return Fa.ONE_MINUS_DST_COLOR;if(a===c.SrcAlphaSaturateFactor)return Fa.SRC_ALPHA_SATURATE;if(null!==(b=ab.get("WEBGL_compressed_texture_s3tc"))){if(a===c.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===c.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===c.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===c.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(b=ab.get("WEBGL_compressed_texture_pvrtc"))){if(a===c.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===c.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===c.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===c.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(b=ab.get("EXT_blend_minmax"))){if(a===c.MinEquation)return b.MIN_EXT;if(a===c.MaxEquation)return b.MAX_EXT}return 0}function ia(a){if(jb&&a&&a.skeleton&&a.skeleton.useVertexTexture)return 1024;var b=Fa.getParameter(Fa.MAX_VERTEX_UNIFORM_VECTORS),d=Math.floor((b-20)/4),e=d;return void 0!==a&&a instanceof c.SkinnedMesh&&(e=Math.min(a.skeleton.bones.length,e))<a.skeleton.bones.length&&c.warn("WebGLRenderer: too many bones - "+a.skeleton.bones.length+", this GPU supports just "+e+" (try OpenGL instead of ANGLE)"),e}function ja(a){for(var b=0,d=0,e=0,f=0,g=0,h=a.length;g<h;g++){var i=a[g];i.onlyShadow||!1===i.visible||(i instanceof c.DirectionalLight&&b++,i instanceof c.PointLight&&d++,i instanceof c.SpotLight&&e++,i instanceof c.HemisphereLight&&f++)}return{directional:b,point:d,spot:e,hemi:f}}function ka(a){for(var b=0,d=0,e=a.length;d<e;d++){var f=a[d];f.castShadow&&(f instanceof c.SpotLight&&b++,f instanceof c.DirectionalLight&&!f.shadowCascade&&b++)}return b}console.log("THREE.WebGLRenderer",c.REVISION),a=a||{};var la=void 0!==a.canvas?a.canvas:document.createElement("canvas"),ma=void 0!==a.context?a.context:null,na=1,oa=void 0!==a.precision?a.precision:"highp",pa=void 0!==a.alpha&&a.alpha,qa=void 0===a.depth||a.depth,ra=void 0===a.stencil||a.stencil,sa=void 0!==a.antialias&&a.antialias,ta=void 0===a.premultipliedAlpha||a.premultipliedAlpha,ua=void 0!==a.preserveDrawingBuffer&&a.preserveDrawingBuffer,va=void 0!==a.logarithmicDepthBuffer&&a.logarithmicDepthBuffer,wa=new c.Color(0),xa=0,ya=[],za={},Aa=[],Ba=[],Ca=[],Da=[],Ea=[];this.domElement=la,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapType=c.PCFShadowMap,this.shadowMapCullFace=c.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Fa,Ga=this,Ha=[],Ia=null,Ja=null,Ka=-1,La="",Ma=null,Na=0,Oa=0,Pa=0,Qa=la.width,Ra=la.height,Sa=0,Ta=0,Ua=new c.Frustum,Va=new c.Matrix4,Wa=new c.Vector3,Xa=new c.Vector3,Ya=!0,Za={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var $a={alpha:pa,depth:qa,stencil:ra,antialias:sa,premultipliedAlpha:ta,preserveDrawingBuffer:ua};if(null===(Fa=ma||la.getContext("webgl",$a)||la.getContext("experimental-webgl",$a)))throw null!==la.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";la.addEventListener("webglcontextlost",function(a){a.preventDefault(),db(),cb(),za={}},!1)}catch(a){c.error("THREE.WebGLRenderer: "+a)}var _a=new c.WebGLState(Fa,ha);void 0===Fa.getShaderPrecisionFormat&&(Fa.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var ab=new c.WebGLExtensions(Fa);ab.get("OES_texture_float"),ab.get("OES_texture_float_linear"),ab.get("OES_texture_half_float"),ab.get("OES_texture_half_float_linear"),ab.get("OES_standard_derivatives"),va&&ab.get("EXT_frag_depth");var bb=function(a,b,c,d){!0===ta&&(a*=d,b*=d,c*=d),Fa.clearColor(a,b,c,d)},cb=function(){Fa.clearColor(0,0,0,1),Fa.clearDepth(1),Fa.clearStencil(0),Fa.enable(Fa.DEPTH_TEST),Fa.depthFunc(Fa.LEQUAL),Fa.frontFace(Fa.CCW),Fa.cullFace(Fa.BACK),Fa.enable(Fa.CULL_FACE),Fa.enable(Fa.BLEND),Fa.blendEquation(Fa.FUNC_ADD),Fa.blendFunc(Fa.SRC_ALPHA,Fa.ONE_MINUS_SRC_ALPHA),Fa.viewport(Oa,Pa,Qa,Ra),bb(wa.r,wa.g,wa.b,xa)},db=function(){Ia=null,Ma=null,La="",Ka=-1,Ya=!0,_a.reset()};cb(),this.context=Fa,this.state=_a;var eb=Fa.getParameter(Fa.MAX_TEXTURE_IMAGE_UNITS),fb=Fa.getParameter(Fa.MAX_VERTEX_TEXTURE_IMAGE_UNITS),gb=Fa.getParameter(Fa.MAX_TEXTURE_SIZE),hb=Fa.getParameter(Fa.MAX_CUBE_MAP_TEXTURE_SIZE),ib=fb>0,jb=ib&&ab.get("OES_texture_float"),kb=Fa.getShaderPrecisionFormat(Fa.VERTEX_SHADER,Fa.HIGH_FLOAT),lb=Fa.getShaderPrecisionFormat(Fa.VERTEX_SHADER,Fa.MEDIUM_FLOAT),mb=Fa.getShaderPrecisionFormat(Fa.FRAGMENT_SHADER,Fa.HIGH_FLOAT),nb=Fa.getShaderPrecisionFormat(Fa.FRAGMENT_SHADER,Fa.MEDIUM_FLOAT),ob=function(){var a;return function(){if(void 0!==a)return a;if(a=[],ab.get("WEBGL_compressed_texture_pvrtc")||ab.get("WEBGL_compressed_texture_s3tc"))for(var b=Fa.getParameter(Fa.COMPRESSED_TEXTURE_FORMATS),c=0;c<b.length;c++)a.push(b[c]);return a}}(),pb=kb.precision>0&&mb.precision>0,qb=lb.precision>0&&nb.precision>0;"highp"!==oa||pb||(qb?(oa="mediump",c.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(oa="lowp",
c.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),"mediump"!==oa||qb||(oa="lowp",c.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var rb=new c.ShadowMapPlugin(this,ya,za,Aa),sb=new c.SpritePlugin(this,Da),tb=new c.LensFlarePlugin(this,Ea);this.getContext=function(){return Fa},this.forceContextLoss=function(){ab.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return ib},this.supportsFloatTextures=function(){return ab.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return ab.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return ab.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return ab.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return ab.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return ab.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){var a;return function(){if(void 0!==a)return a;var b=ab.get("EXT_texture_filter_anisotropic");return a=null!==b?Fa.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return oa},this.getPixelRatio=function(){return na},this.setPixelRatio=function(a){na=a},this.setSize=function(a,b,c){la.width=a*na,la.height=b*na,!1!==c&&(la.style.width=a+"px",la.style.height=b+"px"),this.setViewport(0,0,a,b)},this.setViewport=function(a,b,c,d){Oa=a*na,Pa=b*na,Qa=c*na,Ra=d*na,Fa.viewport(Oa,Pa,Qa,Ra)},this.setScissor=function(a,b,c,d){Fa.scissor(a*na,b*na,c*na,d*na)},this.enableScissorTest=function(a){a?Fa.enable(Fa.SCISSOR_TEST):Fa.disable(Fa.SCISSOR_TEST)},this.getClearColor=function(){return wa},this.setClearColor=function(a,b){wa.set(a),xa=void 0!==b?b:1,bb(wa.r,wa.g,wa.b,xa)},this.getClearAlpha=function(){return xa},this.setClearAlpha=function(a){xa=a,bb(wa.r,wa.g,wa.b,xa)},this.clear=function(a,b,c){var d=0;(void 0===a||a)&&(d|=Fa.COLOR_BUFFER_BIT),(void 0===b||b)&&(d|=Fa.DEPTH_BUFFER_BIT),(void 0===c||c)&&(d|=Fa.STENCIL_BUFFER_BIT),Fa.clear(d)},this.clearColor=function(){Fa.clear(Fa.COLOR_BUFFER_BIT)},this.clearDepth=function(){Fa.clear(Fa.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Fa.clear(Fa.STENCIL_BUFFER_BIT)},this.clearTarget=function(a,b,c,d){this.setRenderTarget(a),this.clear(b,c,d)},this.resetGLState=db;var ub=function a(b){b.target.traverse(function(b){b.removeEventListener("remove",a),G(b)})},vb=function a(b){var c=b.target;c.removeEventListener("dispose",a),Ab(c)},wb=function a(b){var c=b.target;c.removeEventListener("dispose",a),Bb(c),Ga.info.memory.textures--},xb=function a(b){var c=b.target;c.removeEventListener("dispose",a),Cb(c),Ga.info.memory.textures--},yb=function a(b){var c=b.target;c.removeEventListener("dispose",a),Db(c)},zb=function(a){for(var b=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"],c=0,d=b.length;c<d;c++){var e=b[c];void 0!==a[e]&&(Fa.deleteBuffer(a[e]),delete a[e])}if(void 0!==a.__webglCustomAttributesList){for(var e in a.__webglCustomAttributesList)Fa.deleteBuffer(a.__webglCustomAttributesList[e].buffer);delete a.__webglCustomAttributesList}Ga.info.memory.geometries--},Ab=function(a){if(delete a.__webglInit,a instanceof c.BufferGeometry){for(var b in a.attributes){var d=a.attributes[b];void 0!==d.buffer&&(Fa.deleteBuffer(d.buffer),delete d.buffer)}Ga.info.memory.geometries--}else{var e=Eb[a.id];if(void 0!==e){for(var f=0,g=e.length;f<g;f++){var h=e[f];if(void 0!==h.numMorphTargets){for(var i=0,j=h.numMorphTargets;i<j;i++)Fa.deleteBuffer(h.__webglMorphTargetsBuffers[i]);delete h.__webglMorphTargetsBuffers}if(void 0!==h.numMorphNormals){for(var i=0,j=h.numMorphNormals;i<j;i++)Fa.deleteBuffer(h.__webglMorphNormalsBuffers[i]);delete h.__webglMorphNormalsBuffers}zb(h)}delete Eb[a.id]}else zb(a)}La=""},Bb=function(a){if(a.image&&a.image.__webglTextureCube)Fa.deleteTexture(a.image.__webglTextureCube),delete a.image.__webglTextureCube;else{if(void 0===a.__webglInit)return;Fa.deleteTexture(a.__webglTexture),delete a.__webglTexture,delete a.__webglInit}},Cb=function(a){if(a&&void 0!==a.__webglTexture){if(Fa.deleteTexture(a.__webglTexture),delete a.__webglTexture,a instanceof c.WebGLRenderTargetCube)for(var b=0;b<6;b++)Fa.deleteFramebuffer(a.__webglFramebuffer[b]),Fa.deleteRenderbuffer(a.__webglRenderbuffer[b]);else Fa.deleteFramebuffer(a.__webglFramebuffer),Fa.deleteRenderbuffer(a.__webglRenderbuffer);delete a.__webglFramebuffer,delete a.__webglRenderbuffer}},Db=function(a){var b=a.program.program;if(void 0!==b){a.program=void 0;var c,d,e,f=!1;for(c=0,d=Ha.length;c<d;c++)if(e=Ha[c],e.program===b){e.usedTimes--,0===e.usedTimes&&(f=!0);break}if(!0===f){var g=[];for(c=0,d=Ha.length;c<d;c++)e=Ha[c],e.program!==b&&g.push(e);Ha=g,Fa.deleteProgram(b),Ga.info.memory.programs--}}};this.renderBufferImmediate=function(a,b,d){if(_a.initAttributes(),a.hasPositions&&!a.__webglVertexBuffer&&(a.__webglVertexBuffer=Fa.createBuffer()),a.hasNormals&&!a.__webglNormalBuffer&&(a.__webglNormalBuffer=Fa.createBuffer()),a.hasUvs&&!a.__webglUvBuffer&&(a.__webglUvBuffer=Fa.createBuffer()),a.hasColors&&!a.__webglColorBuffer&&(a.__webglColorBuffer=Fa.createBuffer()),a.hasPositions&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglVertexBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,a.positionArray,Fa.DYNAMIC_DRAW),_a.enableAttribute(b.attributes.position),Fa.vertexAttribPointer(b.attributes.position,3,Fa.FLOAT,!1,0,0)),a.hasNormals){if(Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglNormalBuffer),d instanceof c.MeshPhongMaterial==!1&&d.shading===c.FlatShading){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=3*a.count;for(r=0;r<s;r+=9)q=a.normalArray,h=q[r],k=q[r+1],n=q[r+2],i=q[r+3],l=q[r+4],o=q[r+5],j=q[r+6],m=q[r+7],p=q[r+8],e=(h+i+j)/3,f=(k+l+m)/3,g=(n+o+p)/3,q[r]=e,q[r+1]=f,q[r+2]=g,q[r+3]=e,q[r+4]=f,q[r+5]=g,q[r+6]=e,q[r+7]=f,q[r+8]=g}Fa.bufferData(Fa.ARRAY_BUFFER,a.normalArray,Fa.DYNAMIC_DRAW),_a.enableAttribute(b.attributes.normal),Fa.vertexAttribPointer(b.attributes.normal,3,Fa.FLOAT,!1,0,0)}a.hasUvs&&d.map&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglUvBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,a.uvArray,Fa.DYNAMIC_DRAW),_a.enableAttribute(b.attributes.uv),Fa.vertexAttribPointer(b.attributes.uv,2,Fa.FLOAT,!1,0,0)),a.hasColors&&d.vertexColors!==c.NoColors&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,a.__webglColorBuffer),Fa.bufferData(Fa.ARRAY_BUFFER,a.colorArray,Fa.DYNAMIC_DRAW),_a.enableAttribute(b.attributes.color),Fa.vertexAttribPointer(b.attributes.color,3,Fa.FLOAT,!1,0,0)),_a.disableUnusedAttributes(),Fa.drawArrays(Fa.TRIANGLES,0,a.count),a.count=0},this.renderBufferDirect=function(a,b,d,e,f,g){if(!1!==e.visible){D(g);var h=K(a,b,d,e,g),i=!1,j=e.wireframe?1:0,k="direct_"+f.id+"_"+h.id+"_"+j;if(k!==La&&(La=k,i=!0),i&&_a.initAttributes(),g instanceof c.Mesh){var l=!0===e.wireframe?Fa.LINES:Fa.TRIANGLES,m=f.attributes.index;if(m){var n,p;m.array instanceof Uint32Array&&ab.get("OES_element_index_uint")?(n=Fa.UNSIGNED_INT,p=4):(n=Fa.UNSIGNED_SHORT,p=2);var q=f.offsets;if(0===q.length)i&&(o(e,h,f,0),Fa.bindBuffer(Fa.ELEMENT_ARRAY_BUFFER,m.buffer)),Fa.drawElements(l,m.array.length,n,0),Ga.info.render.calls++,Ga.info.render.vertices+=m.array.length,Ga.info.render.faces+=m.array.length/3;else{i=!0;for(var r=0,s=q.length;r<s;r++){var t=q[r].index;i&&(o(e,h,f,t),Fa.bindBuffer(Fa.ELEMENT_ARRAY_BUFFER,m.buffer)),Fa.drawElements(l,q[r].count,n,q[r].start*p),Ga.info.render.calls++,Ga.info.render.vertices+=q[r].count,Ga.info.render.faces+=q[r].count/3}}}else{i&&o(e,h,f,0);var u=f.attributes.position;Fa.drawArrays(l,0,u.array.length/u.itemSize),Ga.info.render.calls++,Ga.info.render.vertices+=u.array.length/u.itemSize,Ga.info.render.faces+=u.array.length/(3*u.itemSize)}}else if(g instanceof c.PointCloud){var l=Fa.POINTS,m=f.attributes.index;if(m){var n,p;m.array instanceof Uint32Array&&ab.get("OES_element_index_uint")?(n=Fa.UNSIGNED_INT,p=4):(n=Fa.UNSIGNED_SHORT,p=2);var q=f.offsets;if(0===q.length)i&&(o(e,h,f,0),Fa.bindBuffer(Fa.ELEMENT_ARRAY_BUFFER,m.buffer)),Fa.drawElements(l,m.array.length,n,0),Ga.info.render.calls++,Ga.info.render.points+=m.array.length;else{q.length>1&&(i=!0);for(var r=0,s=q.length;r<s;r++){var t=q[r].index;i&&(o(e,h,f,t),Fa.bindBuffer(Fa.ELEMENT_ARRAY_BUFFER,m.buffer)),Fa.drawElements(l,q[r].count,n,q[r].start*p),Ga.info.render.calls++,Ga.info.render.points+=q[r].count}}}else{i&&o(e,h,f,0);var u=f.attributes.position,q=f.offsets;if(0===q.length)Fa.drawArrays(l,0,u.array.length/3),Ga.info.render.calls++,Ga.info.render.points+=u.array.length/3;else for(var r=0,s=q.length;r<s;r++)Fa.drawArrays(l,q[r].index,q[r].count),Ga.info.render.calls++,Ga.info.render.points+=q[r].count}}else if(g instanceof c.Line){var l=g.mode===c.LineStrip?Fa.LINE_STRIP:Fa.LINES;_a.setLineWidth(e.linewidth*na);var m=f.attributes.index;if(m){var n,p;m.array instanceof Uint32Array?(n=Fa.UNSIGNED_INT,p=4):(n=Fa.UNSIGNED_SHORT,p=2);var q=f.offsets;if(0===q.length)i&&(o(e,h,f,0),Fa.bindBuffer(Fa.ELEMENT_ARRAY_BUFFER,m.buffer)),Fa.drawElements(l,m.array.length,n,0),Ga.info.render.calls++,Ga.info.render.vertices+=m.array.length;else{q.length>1&&(i=!0);for(var r=0,s=q.length;r<s;r++){var t=q[r].index;i&&(o(e,h,f,t),Fa.bindBuffer(Fa.ELEMENT_ARRAY_BUFFER,m.buffer)),Fa.drawElements(l,q[r].count,n,q[r].start*p),Ga.info.render.calls++,Ga.info.render.vertices+=q[r].count}}}else{i&&o(e,h,f,0);var u=f.attributes.position,q=f.offsets;if(0===q.length)Fa.drawArrays(l,0,u.array.length/3),Ga.info.render.calls++,Ga.info.render.vertices+=u.array.length/3;else for(var r=0,s=q.length;r<s;r++)Fa.drawArrays(l,q[r].index,q[r].count),Ga.info.render.calls++,Ga.info.render.vertices+=q[r].count}}}},this.renderBuffer=function(a,b,d,e,f,g){if(!1!==e.visible){D(g);var h=K(a,b,d,e,g),i=h.attributes,j=!1,k=e.wireframe?1:0,l=f.id+"_"+h.id+"_"+k;if(l!==La&&(La=l,j=!0),j&&_a.initAttributes(),!e.morphTargets&&i.position>=0?j&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,f.__webglVertexBuffer),_a.enableAttribute(i.position),Fa.vertexAttribPointer(i.position,3,Fa.FLOAT,!1,0,0)):g.morphTargetBase&&p(e,f,g),j){if(f.__webglCustomAttributesList)for(var m=0,n=f.__webglCustomAttributesList.length;m<n;m++){var o=f.__webglCustomAttributesList[m];i[o.buffer.belongsToAttribute]>=0&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,o.buffer),_a.enableAttribute(i[o.buffer.belongsToAttribute]),Fa.vertexAttribPointer(i[o.buffer.belongsToAttribute],o.size,Fa.FLOAT,!1,0,0))}i.color>=0&&(g.geometry.colors.length>0||g.geometry.faces.length>0?(Fa.bindBuffer(Fa.ARRAY_BUFFER,f.__webglColorBuffer),_a.enableAttribute(i.color),Fa.vertexAttribPointer(i.color,3,Fa.FLOAT,!1,0,0)):void 0!==e.defaultAttributeValues&&Fa.vertexAttrib3fv(i.color,e.defaultAttributeValues.color)),i.normal>=0&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,f.__webglNormalBuffer),_a.enableAttribute(i.normal),Fa.vertexAttribPointer(i.normal,3,Fa.FLOAT,!1,0,0)),i.tangent>=0&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,f.__webglTangentBuffer),_a.enableAttribute(i.tangent),Fa.vertexAttribPointer(i.tangent,4,Fa.FLOAT,!1,0,0)),i.uv>=0&&(g.geometry.faceVertexUvs[0]?(Fa.bindBuffer(Fa.ARRAY_BUFFER,f.__webglUVBuffer),_a.enableAttribute(i.uv),Fa.vertexAttribPointer(i.uv,2,Fa.FLOAT,!1,0,0)):void 0!==e.defaultAttributeValues&&Fa.vertexAttrib2fv(i.uv,e.defaultAttributeValues.uv)),i.uv2>=0&&(g.geometry.faceVertexUvs[1]?(Fa.bindBuffer(Fa.ARRAY_BUFFER,f.__webglUV2Buffer),_a.enableAttribute(i.uv2),Fa.vertexAttribPointer(i.uv2,2,Fa.FLOAT,!1,0,0)):void 0!==e.defaultAttributeValues&&Fa.vertexAttrib2fv(i.uv2,e.defaultAttributeValues.uv2)),e.skinning&&i.skinIndex>=0&&i.skinWeight>=0&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,f.__webglSkinIndicesBuffer),_a.enableAttribute(i.skinIndex),Fa.vertexAttribPointer(i.skinIndex,4,Fa.FLOAT,!1,0,0),Fa.bindBuffer(Fa.ARRAY_BUFFER,f.__webglSkinWeightsBuffer),_a.enableAttribute(i.skinWeight),Fa.vertexAttribPointer(i.skinWeight,4,Fa.FLOAT,!1,0,0)),i.lineDistance>=0&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,f.__webglLineDistanceBuffer),_a.enableAttribute(i.lineDistance),Fa.vertexAttribPointer(i.lineDistance,1,Fa.FLOAT,!1,0,0))}if(_a.disableUnusedAttributes(),g instanceof c.Mesh){var q=f.__typeArray===Uint32Array?Fa.UNSIGNED_INT:Fa.UNSIGNED_SHORT;e.wireframe?(_a.setLineWidth(e.wireframeLinewidth*na),j&&Fa.bindBuffer(Fa.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer),Fa.drawElements(Fa.LINES,f.__webglLineCount,q,0)):(j&&Fa.bindBuffer(Fa.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),Fa.drawElements(Fa.TRIANGLES,f.__webglFaceCount,q,0)),Ga.info.render.calls++,Ga.info.render.vertices+=f.__webglFaceCount,Ga.info.render.faces+=f.__webglFaceCount/3}else if(g instanceof c.Line){var r=g.mode===c.LineStrip?Fa.LINE_STRIP:Fa.LINES;_a.setLineWidth(e.linewidth*na),Fa.drawArrays(r,0,f.__webglLineCount),Ga.info.render.calls++}else g instanceof c.PointCloud&&(Fa.drawArrays(Fa.POINTS,0,f.__webglParticleCount),Ga.info.render.calls++,Ga.info.render.points+=f.__webglParticleCount)}},this.render=function(a,b,d,e){if(b instanceof c.Camera==!1)return void c.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var f=a.fog;La="",Ka=-1,Ma=null,Ya=!0,!0===a.autoUpdate&&a.updateMatrixWorld(),void 0===b.parent&&b.updateMatrixWorld(),a.traverse(function(a){a instanceof c.SkinnedMesh&&a.skeleton.update()}),b.matrixWorldInverse.getInverse(b.matrixWorld),Va.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),Ua.setFromMatrix(Va),ya.length=0,Ba.length=0,Ca.length=0,Da.length=0,Ea.length=0,t(a),!0===Ga.sortObjects&&(Ba.sort(q),Ca.sort(r)),rb.render(a,b),Ga.info.render.calls=0,Ga.info.render.vertices=0,Ga.info.render.faces=0,Ga.info.render.points=0,this.setRenderTarget(d),(this.autoClear||e)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var g=0,h=Aa.length;g<h;g++){var i=Aa[g],j=i.object;j.visible&&(Y(j,b),w(i))}if(a.overrideMaterial){var k=a.overrideMaterial;J(k),u(Ba,b,ya,f,k),u(Ca,b,ya,f,k),v(Aa,"",b,ya,f,k)}else _a.setBlending(c.NoBlending),u(Ba,b,ya,f,null),v(Aa,"opaque",b,ya,f,null),u(Ca,b,ya,f,null),v(Aa,"transparent",b,ya,f,null);sb.render(a,b),tb.render(a,b,Sa,Ta),d&&d.generateMipmaps&&d.minFilter!==c.NearestFilter&&d.minFilter!==c.LinearFilter&&fa(d),_a.setDepthTest(!0),_a.setDepthWrite(!0),_a.setColorWrite(!0)},this.renderImmediateObject=function(a,b,c,d,e){var f=K(a,b,c,d,e);La="",Ga.setMaterialFaces(d),e.immediateRenderCallback?e.immediateRenderCallback(f,Fa,Ua):e.render(function(a){Ga.renderBufferImmediate(a,f,d)})};var Eb={},Fb=0,Gb={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};this.setFaceCulling=function(a,b){a===c.CullFaceNone?Fa.disable(Fa.CULL_FACE):(b===c.FrontFaceDirectionCW?Fa.frontFace(Fa.CW):Fa.frontFace(Fa.CCW),a===c.CullFaceBack?Fa.cullFace(Fa.BACK):a===c.CullFaceFront?Fa.cullFace(Fa.FRONT):Fa.cullFace(Fa.FRONT_AND_BACK),Fa.enable(Fa.CULL_FACE))},this.setMaterialFaces=function(a){_a.setDoubleSided(a.side===c.DoubleSide),_a.setFlipSided(a.side===c.BackSide)},this.uploadTexture=function(a){void 0===a.__webglInit&&(a.__webglInit=!0,a.addEventListener("dispose",wb),a.__webglTexture=Fa.createTexture(),Ga.info.memory.textures++),Fa.bindTexture(Fa.TEXTURE_2D,a.__webglTexture),Fa.pixelStorei(Fa.UNPACK_FLIP_Y_WEBGL,a.flipY),Fa.pixelStorei(Fa.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),Fa.pixelStorei(Fa.UNPACK_ALIGNMENT,a.unpackAlignment),a.image=aa(a.image,gb);var b=a.image,d=c.Math.isPowerOfTwo(b.width)&&c.Math.isPowerOfTwo(b.height),e=ha(a.format),f=ha(a.type);_(Fa.TEXTURE_2D,a,d);var g,h=a.mipmaps;if(a instanceof c.DataTexture)if(h.length>0&&d){for(var i=0,j=h.length;i<j;i++)g=h[i],Fa.texImage2D(Fa.TEXTURE_2D,i,e,g.width,g.height,0,e,f,g.data);a.generateMipmaps=!1}else Fa.texImage2D(Fa.TEXTURE_2D,0,e,b.width,b.height,0,e,f,b.data);else if(a instanceof c.CompressedTexture)for(var i=0,j=h.length;i<j;i++)g=h[i],a.format!==c.RGBAFormat&&a.format!==c.RGBFormat?ob().indexOf(e)>-1?Fa.compressedTexImage2D(Fa.TEXTURE_2D,i,e,g.width,g.height,0,g.data):c.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Fa.texImage2D(Fa.TEXTURE_2D,i,e,g.width,g.height,0,e,f,g.data);else if(h.length>0&&d){for(var i=0,j=h.length;i<j;i++)g=h[i],Fa.texImage2D(Fa.TEXTURE_2D,i,e,e,f,g);a.generateMipmaps=!1}else Fa.texImage2D(Fa.TEXTURE_2D,0,e,e,f,a.image);a.generateMipmaps&&d&&Fa.generateMipmap(Fa.TEXTURE_2D),a.needsUpdate=!1,a.onUpdate&&a.onUpdate()},this.setTexture=function(a,b){Fa.activeTexture(Fa.TEXTURE0+b),a.needsUpdate?Ga.uploadTexture(a):Fa.bindTexture(Fa.TEXTURE_2D,a.__webglTexture)},this.setRenderTarget=function(a){var b=a instanceof c.WebGLRenderTargetCube;if(a&&void 0===a.__webglFramebuffer){void 0===a.depthBuffer&&(a.depthBuffer=!0),void 0===a.stencilBuffer&&(a.stencilBuffer=!0),a.addEventListener("dispose",xb),a.__webglTexture=Fa.createTexture(),Ga.info.memory.textures++;var d=c.Math.isPowerOfTwo(a.width)&&c.Math.isPowerOfTwo(a.height),e=ha(a.format),f=ha(a.type);if(b){a.__webglFramebuffer=[],a.__webglRenderbuffer=[],Fa.bindTexture(Fa.TEXTURE_CUBE_MAP,a.__webglTexture),_(Fa.TEXTURE_CUBE_MAP,a,d);for(var g=0;g<6;g++)a.__webglFramebuffer[g]=Fa.createFramebuffer(),a.__webglRenderbuffer[g]=Fa.createRenderbuffer(),Fa.texImage2D(Fa.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,e,a.width,a.height,0,e,f,null),da(a.__webglFramebuffer[g],a,Fa.TEXTURE_CUBE_MAP_POSITIVE_X+g),ea(a.__webglRenderbuffer[g],a);d&&Fa.generateMipmap(Fa.TEXTURE_CUBE_MAP)}else a.__webglFramebuffer=Fa.createFramebuffer(),a.shareDepthFrom?a.__webglRenderbuffer=a.shareDepthFrom.__webglRenderbuffer:a.__webglRenderbuffer=Fa.createRenderbuffer(),Fa.bindTexture(Fa.TEXTURE_2D,a.__webglTexture),_(Fa.TEXTURE_2D,a,d),Fa.texImage2D(Fa.TEXTURE_2D,0,e,a.width,a.height,0,e,f,null),da(a.__webglFramebuffer,a,Fa.TEXTURE_2D),a.shareDepthFrom?a.depthBuffer&&!a.stencilBuffer?Fa.framebufferRenderbuffer(Fa.FRAMEBUFFER,Fa.DEPTH_ATTACHMENT,Fa.RENDERBUFFER,a.__webglRenderbuffer):a.depthBuffer&&a.stencilBuffer&&Fa.framebufferRenderbuffer(Fa.FRAMEBUFFER,Fa.DEPTH_STENCIL_ATTACHMENT,Fa.RENDERBUFFER,a.__webglRenderbuffer):ea(a.__webglRenderbuffer,a),d&&Fa.generateMipmap(Fa.TEXTURE_2D);b?Fa.bindTexture(Fa.TEXTURE_CUBE_MAP,null):Fa.bindTexture(Fa.TEXTURE_2D,null),Fa.bindRenderbuffer(Fa.RENDERBUFFER,null),Fa.bindFramebuffer(Fa.FRAMEBUFFER,null)}var h,i,j,k,l;a?(h=b?a.__webglFramebuffer[a.activeCubeFace]:a.__webglFramebuffer,i=a.width,j=a.height,k=0,l=0):(h=null,i=Qa,j=Ra,k=Oa,l=Pa),h!==Ja&&(Fa.bindFramebuffer(Fa.FRAMEBUFFER,h),Fa.viewport(k,l,i,j),Ja=h),Sa=i,Ta=j},this.readRenderTargetPixels=function(a,b,d,e,f,g){if(!(a instanceof c.WebGLRenderTarget))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");if(a.__webglFramebuffer){if(a.format!==c.RGBAFormat)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");var h=!1;a.__webglFramebuffer!==Ja&&(Fa.bindFramebuffer(Fa.FRAMEBUFFER,a.__webglFramebuffer),h=!0),Fa.checkFramebufferStatus(Fa.FRAMEBUFFER)===Fa.FRAMEBUFFER_COMPLETE?Fa.readPixels(b,d,e,f,Fa.RGBA,Fa.UNSIGNED_BYTE,g):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),h&&Fa.bindFramebuffer(Fa.FRAMEBUFFER,Ja)}},this.initMaterial=function(){c.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){c.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){c.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){c.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},c.WebGLRenderTarget=function(a,b,d){this.width=a,this.height=b,d=d||{},this.wrapS=void 0!==d.wrapS?d.wrapS:c.ClampToEdgeWrapping,this.wrapT=void 0!==d.wrapT?d.wrapT:c.ClampToEdgeWrapping,this.magFilter=void 0!==d.magFilter?d.magFilter:c.LinearFilter,this.minFilter=void 0!==d.minFilter?d.minFilter:c.LinearMipMapLinearFilter,this.anisotropy=void 0!==d.anisotropy?d.anisotropy:1,this.offset=new c.Vector2(0,0),this.repeat=new c.Vector2(1,1),this.format=void 0!==d.format?d.format:c.RGBAFormat,this.type=void 0!==d.type?d.type:c.UnsignedByteType,this.depthBuffer=void 0===d.depthBuffer||d.depthBuffer,this.stencilBuffer=void 0===d.stencilBuffer||d.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=void 0!==d.shareDepthFrom?d.shareDepthFrom:null},c.WebGLRenderTarget.prototype={constructor:c.WebGLRenderTarget,setSize:function(a,b){this.width=a,this.height=b},clone:function(){var a=new c.WebGLRenderTarget(this.width,this.height);return a.wrapS=this.wrapS,a.wrapT=this.wrapT,a.magFilter=this.magFilter,a.minFilter=this.minFilter,a.anisotropy=this.anisotropy,a.offset.copy(this.offset),a.repeat.copy(this.repeat),a.format=this.format,a.type=this.type,a.depthBuffer=this.depthBuffer,a.stencilBuffer=this.stencilBuffer,a.generateMipmaps=this.generateMipmaps,a.shareDepthFrom=this.shareDepthFrom,a},dispose:function(){this.dispatchEvent({type:"dispose"})}},c.EventDispatcher.prototype.apply(c.WebGLRenderTarget.prototype),c.WebGLRenderTargetCube=function(a,b,d){c.WebGLRenderTarget.call(this,a,b,d),this.activeCubeFace=0},c.WebGLRenderTargetCube.prototype=Object.create(c.WebGLRenderTarget.prototype),c.WebGLRenderTargetCube.prototype.constructor=c.WebGLRenderTargetCube,c.WebGLExtensions=function(a){var b={};this.get=function(d){if(void 0!==b[d])return b[d];var e;switch(d){case"EXT_texture_filter_anisotropic":e=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":e=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":e=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:e=a.getExtension(d)}return null===e&&c.warn("THREE.WebGLRenderer: "+d+" extension not supported."),b[d]=e,e}},c.WebGLProgram=function(){var a=0,b=function(a){var b,c,d=[];for(var e in a)!1!==(b=a[e])&&(c="#define "+e+" "+b,d.push(c));return d.join("\n")},d=function(a,b,c){for(var d={},e=0,f=c.length;e<f;e++){var g=c[e];d[g]=a.getUniformLocation(b,g)}return d},e=function(a,b,c){for(var d={},e=0,f=c.length;e<f;e++){var g=c[e];d[g]=a.getAttribLocation(b,g)}return d};return function(f,g,h,i){var j=f,k=j.context,l=h.defines,m=h.__webglShader.uniforms,n=h.attributes,o=h.__webglShader.vertexShader,p=h.__webglShader.fragmentShader,q=h.index0AttributeName;void 0===q&&!0===i.morphTargets&&(q="position");var r="SHADOWMAP_TYPE_BASIC";i.shadowMapType===c.PCFShadowMap?r="SHADOWMAP_TYPE_PCF":i.shadowMapType===c.PCFSoftShadowMap&&(r="SHADOWMAP_TYPE_PCF_SOFT");var s="ENVMAP_TYPE_CUBE",t="ENVMAP_MODE_REFLECTION",u="ENVMAP_BLENDING_MULTIPLY";if(i.envMap){switch(h.envMap.mapping){case c.CubeReflectionMapping:case c.CubeRefractionMapping:s="ENVMAP_TYPE_CUBE";break;case c.EquirectangularReflectionMapping:case c.EquirectangularRefractionMapping:s="ENVMAP_TYPE_EQUIREC";break;case c.SphericalReflectionMapping:s="ENVMAP_TYPE_SPHERE"}switch(h.envMap.mapping){case c.CubeRefractionMapping:case c.EquirectangularRefractionMapping:t="ENVMAP_MODE_REFRACTION"}switch(h.combine){case c.MultiplyOperation:u="ENVMAP_BLENDING_MULTIPLY";break;case c.MixOperation:u="ENVMAP_BLENDING_MIX";break;case c.AddOperation:u="ENVMAP_BLENDING_ADD"}}var v,w,x=f.gammaFactor>0?f.gammaFactor:1,y=b(l),z=k.createProgram();h instanceof c.RawShaderMaterial?(v="",w=""):(v=["precision "+i.precision+" float;","precision "+i.precision+" int;",y,i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",j.gammaInput?"#define GAMMA_INPUT":"",j.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+x,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+t:"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexColors?"#define USE_COLOR":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+r:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif",""].join("\n"),w=["precision "+i.precision+" float;","precision "+i.precision+" int;",i.bumpMap||i.normalMap||i.flatShading?"#extension GL_OES_standard_derivatives : enable":"",y,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",j.gammaInput?"#define GAMMA_INPUT":"",j.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+x,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+s:"",i.envMap?"#define "+t:"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexColors?"#define USE_COLOR":"",i.flatShading?"#define FLAT_SHADED":"",i.metal?"#define METAL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+r:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"));var A=new c.WebGLShader(k,k.VERTEX_SHADER,v+o),B=new c.WebGLShader(k,k.FRAGMENT_SHADER,w+p);k.attachShader(z,A),k.attachShader(z,B),void 0!==q&&k.bindAttribLocation(z,0,q),k.linkProgram(z);var C=k.getProgramInfoLog(z);!1===k.getProgramParameter(z,k.LINK_STATUS)&&c.error("THREE.WebGLProgram: shader error: "+k.getError(),"gl.VALIDATE_STATUS",k.getProgramParameter(z,k.VALIDATE_STATUS),"gl.getPRogramInfoLog",C),""!==C&&c.warn("THREE.WebGLProgram: gl.getProgramInfoLog()"+C),k.deleteShader(A),k.deleteShader(B);var D=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];i.useVertexTexture?(D.push("boneTexture"),D.push("boneTextureWidth"),D.push("boneTextureHeight")):D.push("boneGlobalMatrices"),i.logarithmicDepthBuffer&&D.push("logDepthBufFC");for(var E in m)D.push(E);this.uniforms=d(k,z,D),D=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var F=0;F<i.maxMorphTargets;F++)D.push("morphTarget"+F);for(var F=0;F<i.maxMorphNormals;F++)D.push("morphNormal"+F);for(var G in n)D.push(G);return this.attributes=e(k,z,D),this.attributesKeys=Object.keys(this.attributes),this.id=a++,this.code=g,this.usedTimes=1,this.program=z,this.vertexShader=A,this.fragmentShader=B,this}}(),c.WebGLShader=function(){var a=function(a){for(var b=a.split("\n"),c=0;c<b.length;c++)b[c]=c+1+": "+b[c];return b.join("\n")};return function(b,d,e){var f=b.createShader(d);return b.shaderSource(f,e),b.compileShader(f),!1===b.getShaderParameter(f,b.COMPILE_STATUS)&&c.error("THREE.WebGLShader: Shader couldn't compile."),""!==b.getShaderInfoLog(f)&&c.warn("THREE.WebGLShader: gl.getShaderInfoLog()",b.getShaderInfoLog(f),a(e)),f}}(),c.WebGLState=function(a,b){var d=new Uint8Array(16),e=new Uint8Array(16),f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=null;this.initAttributes=function(){for(var a=0,b=d.length;a<b;a++)d[a]=0},this.enableAttribute=function(b){d[b]=1,0===e[b]&&(a.enableVertexAttribArray(b),e[b]=1)},this.disableUnusedAttributes=function(){for(var b=0,c=e.length;b<c;b++)e[b]!==d[b]&&(a.disableVertexAttribArray(b),e[b]=0)},this.setBlending=function(d,e,m,n,o,p,q){d!==f&&(d===c.NoBlending?a.disable(a.BLEND):d===c.AdditiveBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):d===c.SubtractiveBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):d===c.MultiplyBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):d===c.CustomBlending?a.enable(a.BLEND):(a.enable(a.BLEND),a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),f=d),d===c.CustomBlending?(o=o||e,p=p||m,q=q||n,e===g&&o===j||(a.blendEquationSeparate(b(e),b(o)),g=e,j=o),m===h&&n===i&&p===k&&q===l||(a.blendFuncSeparate(b(m),b(n),b(p),b(q)),h=m,i=n,k=p,l=q)):(g=null,h=null,i=null,j=null,k=null,l=null)},this.setDepthTest=function(b){m!==b&&(b?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),m=b)},this.setDepthWrite=function(b){n!==b&&(a.depthMask(b),n=b)},this.setColorWrite=function(b){o!==b&&(a.colorMask(b,b,b,b),o=b)},this.setDoubleSided=function(b){p!==b&&(b?a.disable(a.CULL_FACE):a.enable(a.CULL_FACE),p=b)},this.setFlipSided=function(b){q!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),q=b)},this.setLineWidth=function(b){b!==r&&(a.lineWidth(b),r=b)},this.setPolygonOffset=function(b,c,d){s!==b&&(b?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL),s=b),!b||t===c&&u===d||(a.polygonOffset(c,d),t=c,u=d)},this.reset=function(){for(var a=0;a<e.length;a++)e[a]=0;f=null,m=null,n=null,o=null,p=null,q=null}},c.LensFlarePlugin=function(a,b){function d(b){var c=m.createProgram(),d=m.createShader(m.FRAGMENT_SHADER),e=m.createShader(m.VERTEX_SHADER),f="precision "+a.getPrecision()+" float;\n";return m.shaderSource(d,f+b.fragmentShader),m.shaderSource(e,f+b.vertexShader),m.compileShader(d),m.compileShader(e),m.attachShader(c,d),m.attachShader(c,e),m.linkProgram(c),c}var e,f,g,h,i,j,k,l,m=a.context,n=function(){var a=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),b=new Uint16Array([0,1,2,0,2,3]);e=m.createBuffer(),f=m.createBuffer(),m.bindBuffer(m.ARRAY_BUFFER,e),m.bufferData(m.ARRAY_BUFFER,a,m.STATIC_DRAW),
m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,f),m.bufferData(m.ELEMENT_ARRAY_BUFFER,b,m.STATIC_DRAW),k=m.createTexture(),l=m.createTexture(),m.bindTexture(m.TEXTURE_2D,k),m.texImage2D(m.TEXTURE_2D,0,m.RGB,16,16,0,m.RGB,m.UNSIGNED_BYTE,null),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.bindTexture(m.TEXTURE_2D,l),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,16,16,0,m.RGBA,m.UNSIGNED_BYTE,null),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),j=m.getParameter(m.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var c;c=j?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},g=d(c),h={vertex:m.getAttribLocation(g,"position"),uv:m.getAttribLocation(g,"uv")},i={renderType:m.getUniformLocation(g,"renderType"),map:m.getUniformLocation(g,"map"),occlusionMap:m.getUniformLocation(g,"occlusionMap"),opacity:m.getUniformLocation(g,"opacity"),color:m.getUniformLocation(g,"color"),scale:m.getUniformLocation(g,"scale"),rotation:m.getUniformLocation(g,"rotation"),screenPosition:m.getUniformLocation(g,"screenPosition")}};this.render=function(d,o,p,q){if(0!==b.length){var r=new c.Vector3,s=q/p,t=.5*p,u=.5*q,v=16/q,w=new c.Vector2(v*s,v),x=new c.Vector3(1,1,0),y=new c.Vector2(1,1);void 0===g&&n(),m.useProgram(g),m.enableVertexAttribArray(h.vertex),m.enableVertexAttribArray(h.uv),m.uniform1i(i.occlusionMap,0),m.uniform1i(i.map,1),m.bindBuffer(m.ARRAY_BUFFER,e),m.vertexAttribPointer(h.vertex,2,m.FLOAT,!1,16,0),m.vertexAttribPointer(h.uv,2,m.FLOAT,!1,16,8),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,f),m.disable(m.CULL_FACE),m.depthMask(!1);for(var z=0,A=b.length;z<A;z++){v=16/q,w.set(v*s,v);var B=b[z];if(r.set(B.matrixWorld.elements[12],B.matrixWorld.elements[13],B.matrixWorld.elements[14]),r.applyMatrix4(o.matrixWorldInverse),r.applyProjection(o.projectionMatrix),x.copy(r),y.x=x.x*t+t,y.y=x.y*u+u,j||y.x>0&&y.x<p&&y.y>0&&y.y<q){m.activeTexture(m.TEXTURE1),m.bindTexture(m.TEXTURE_2D,k),m.copyTexImage2D(m.TEXTURE_2D,0,m.RGB,y.x-8,y.y-8,16,16,0),m.uniform1i(i.renderType,0),m.uniform2f(i.scale,w.x,w.y),m.uniform3f(i.screenPosition,x.x,x.y,x.z),m.disable(m.BLEND),m.enable(m.DEPTH_TEST),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0),m.activeTexture(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,l),m.copyTexImage2D(m.TEXTURE_2D,0,m.RGBA,y.x-8,y.y-8,16,16,0),m.uniform1i(i.renderType,1),m.disable(m.DEPTH_TEST),m.activeTexture(m.TEXTURE1),m.bindTexture(m.TEXTURE_2D,k),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0),B.positionScreen.copy(x),B.customUpdateCallback?B.customUpdateCallback(B):B.updateLensFlares(),m.uniform1i(i.renderType,2),m.enable(m.BLEND);for(var C=0,D=B.lensFlares.length;C<D;C++){var E=B.lensFlares[C];E.opacity>.001&&E.scale>.001&&(x.x=E.x,x.y=E.y,x.z=E.z,v=E.size*E.scale/q,w.x=v*s,w.y=v,m.uniform3f(i.screenPosition,x.x,x.y,x.z),m.uniform2f(i.scale,w.x,w.y),m.uniform1f(i.rotation,E.rotation),m.uniform1f(i.opacity,E.opacity),m.uniform3f(i.color,E.color.r,E.color.g,E.color.b),a.state.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst),a.setTexture(E.texture,1),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0))}}}m.enable(m.CULL_FACE),m.enable(m.DEPTH_TEST),m.depthMask(!0),a.resetGLState()}}},c.ShadowMapPlugin=function(a,b,d,e){function f(a,b,c){if(b.visible){var e=d[b.id];if(e&&b.castShadow&&(!1===b.frustumCulled||!0===p.intersectsObject(b)))for(var g=0,h=e.length;g<h;g++){var i=e[g];b._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,b.matrixWorld),u.push(i)}for(var g=0,h=b.children.length;g<h;g++)f(a,b.children[g],c)}}function g(a,b){var d=new c.DirectionalLight;d.isVirtual=!0,d.onlyShadow=!0,d.castShadow=!0,d.shadowCameraNear=a.shadowCameraNear,d.shadowCameraFar=a.shadowCameraFar,d.shadowCameraLeft=a.shadowCameraLeft,d.shadowCameraRight=a.shadowCameraRight,d.shadowCameraBottom=a.shadowCameraBottom,d.shadowCameraTop=a.shadowCameraTop,d.shadowCameraVisible=a.shadowCameraVisible,d.shadowDarkness=a.shadowDarkness,d.shadowBias=a.shadowCascadeBias[b],d.shadowMapWidth=a.shadowCascadeWidth[b],d.shadowMapHeight=a.shadowCascadeHeight[b],d.pointsWorld=[],d.pointsFrustum=[];for(var e=d.pointsWorld,f=d.pointsFrustum,g=0;g<8;g++)e[g]=new c.Vector3,f[g]=new c.Vector3;var h=a.shadowCascadeNearZ[b],i=a.shadowCascadeFarZ[b];return f[0].set(-1,-1,h),f[1].set(1,-1,h),f[2].set(-1,1,h),f[3].set(1,1,h),f[4].set(-1,-1,i),f[5].set(1,-1,i),f[6].set(-1,1,i),f[7].set(1,1,i),d}function h(a,b){var c=a.shadowCascadeArray[b];c.position.copy(a.position),c.target.position.copy(a.target.position),c.lookAt(c.target),c.shadowCameraVisible=a.shadowCameraVisible,c.shadowDarkness=a.shadowDarkness,c.shadowBias=a.shadowCascadeBias[b];var d=a.shadowCascadeNearZ[b],e=a.shadowCascadeFarZ[b],f=c.pointsFrustum;f[0].z=d,f[1].z=d,f[2].z=d,f[3].z=d,f[4].z=e,f[5].z=e,f[6].z=e,f[7].z=e}function i(a,b){var c=b.shadowCamera,d=b.pointsFrustum,e=b.pointsWorld;r.set(1/0,1/0,1/0),s.set(-1/0,-1/0,-1/0);for(var f=0;f<8;f++){var g=e[f];g.copy(d[f]),g.unproject(a),g.applyMatrix4(c.matrixWorldInverse),g.x<r.x&&(r.x=g.x),g.x>s.x&&(s.x=g.x),g.y<r.y&&(r.y=g.y),g.y>s.y&&(s.y=g.y),g.z<r.z&&(r.z=g.z),g.z>s.z&&(s.z=g.z)}c.left=r.x,c.right=s.x,c.top=s.y,c.bottom=r.y,c.updateProjectionMatrix()}function j(a){return a.material instanceof c.MeshFaceMaterial?a.material.materials[0]:a.material}var k,l,m,n,o=a.context,p=new c.Frustum,q=new c.Matrix4,r=new c.Vector3,s=new c.Vector3,t=new c.Vector3,u=[],v=c.ShaderLib.depthRGBA,w=c.UniformsUtils.clone(v.uniforms);k=new c.ShaderMaterial({uniforms:w,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader}),l=new c.ShaderMaterial({uniforms:w,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,morphTargets:!0}),m=new c.ShaderMaterial({uniforms:w,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,skinning:!0}),n=new c.ShaderMaterial({uniforms:w,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,morphTargets:!0,skinning:!0}),k._shadowPass=!0,l._shadowPass=!0,m._shadowPass=!0,n._shadowPass=!0,this.render=function(d,r){if(!1!==a.shadowMapEnabled){var s,v,w,x,y,z,A,B,C,D,E,F,G,H=[],I=0;for(o.clearColor(1,1,1,1),o.disable(o.BLEND),o.enable(o.CULL_FACE),o.frontFace(o.CCW),a.shadowMapCullFace===c.CullFaceFront?o.cullFace(o.FRONT):o.cullFace(o.BACK),a.state.setDepthTest(!0),s=0,v=b.length;s<v;s++)if(G=b[s],G.castShadow)if(G instanceof c.DirectionalLight&&G.shadowCascade)for(y=0;y<G.shadowCascadeCount;y++){var J;if(G.shadowCascadeArray[y])J=G.shadowCascadeArray[y];else{J=g(G,y),J.originalCamera=r;var K=new c.Gyroscope;K.position.copy(G.shadowCascadeOffset),K.add(J),K.add(J.target),r.add(K),G.shadowCascadeArray[y]=J}h(G,y),H[I]=J,I++}else H[I]=G,I++;for(s=0,v=H.length;s<v;s++){if(G=H[s],!G.shadowMap){var L=c.LinearFilter;a.shadowMapType===c.PCFSoftShadowMap&&(L=c.NearestFilter);var M={minFilter:L,magFilter:L,format:c.RGBAFormat};G.shadowMap=new c.WebGLRenderTarget(G.shadowMapWidth,G.shadowMapHeight,M),G.shadowMapSize=new c.Vector2(G.shadowMapWidth,G.shadowMapHeight),G.shadowMatrix=new c.Matrix4}if(!G.shadowCamera){if(G instanceof c.SpotLight)G.shadowCamera=new c.PerspectiveCamera(G.shadowCameraFov,G.shadowMapWidth/G.shadowMapHeight,G.shadowCameraNear,G.shadowCameraFar);else{if(!(G instanceof c.DirectionalLight)){c.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",G);continue}G.shadowCamera=new c.OrthographicCamera(G.shadowCameraLeft,G.shadowCameraRight,G.shadowCameraTop,G.shadowCameraBottom,G.shadowCameraNear,G.shadowCameraFar)}d.add(G.shadowCamera),!0===d.autoUpdate&&d.updateMatrixWorld()}G.shadowCameraVisible&&!G.cameraHelper&&(G.cameraHelper=new c.CameraHelper(G.shadowCamera),d.add(G.cameraHelper)),G.isVirtual&&J.originalCamera==r&&i(r,G),z=G.shadowMap,A=G.shadowMatrix,B=G.shadowCamera,B.position.setFromMatrixPosition(G.matrixWorld),t.setFromMatrixPosition(G.target.matrixWorld),B.lookAt(t),B.updateMatrixWorld(),B.matrixWorldInverse.getInverse(B.matrixWorld),G.cameraHelper&&(G.cameraHelper.visible=G.shadowCameraVisible),G.shadowCameraVisible&&G.cameraHelper.update(),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(B.projectionMatrix),A.multiply(B.matrixWorldInverse),q.multiplyMatrices(B.projectionMatrix,B.matrixWorldInverse),p.setFromMatrix(q),a.setRenderTarget(z),a.clear(),u.length=0,f(d,d,B);var N,O,P;for(w=0,x=u.length;w<x;w++)E=u[w],F=E.object,C=E.buffer,N=j(F),O=void 0!==F.geometry.morphTargets&&F.geometry.morphTargets.length>0&&N.morphTargets,P=F instanceof c.SkinnedMesh&&N.skinning,D=F.customDepthMaterial?F.customDepthMaterial:P?O?n:m:O?l:k,a.setMaterialFaces(N),C instanceof c.BufferGeometry?a.renderBufferDirect(B,b,null,D,C,F):a.renderBuffer(B,b,null,D,C,F);for(w=0,x=e.length;w<x;w++)E=e[w],F=E.object,F.visible&&F.castShadow&&(F._modelViewMatrix.multiplyMatrices(B.matrixWorldInverse,F.matrixWorld),a.renderImmediateObject(B,b,null,k,F))}var Q=a.getClearColor(),R=a.getClearAlpha();o.clearColor(Q.r,Q.g,Q.b,R),o.enable(o.BLEND),a.shadowMapCullFace===c.CullFaceFront&&o.cullFace(o.BACK),a.resetGLState()}}},c.SpritePlugin=function(a,b){function d(){var b=l.createProgram(),c=l.createShader(l.VERTEX_SHADER),d=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(c,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),l.shaderSource(d,["precision "+a.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),l.compileShader(c),l.compileShader(d),l.attachShader(b,c),l.attachShader(b,d),l.linkProgram(b),b}function e(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}var f,g,h,i,j,k,l=a.context,m=new c.Vector3,n=new c.Quaternion,o=new c.Vector3,p=function(){var a=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),b=new Uint16Array([0,1,2,0,2,3]);f=l.createBuffer(),g=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,f),l.bufferData(l.ARRAY_BUFFER,a,l.STATIC_DRAW),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,g),l.bufferData(l.ELEMENT_ARRAY_BUFFER,b,l.STATIC_DRAW),h=d(),i={position:l.getAttribLocation(h,"position"),uv:l.getAttribLocation(h,"uv")},j={uvOffset:l.getUniformLocation(h,"uvOffset"),uvScale:l.getUniformLocation(h,"uvScale"),rotation:l.getUniformLocation(h,"rotation"),scale:l.getUniformLocation(h,"scale"),color:l.getUniformLocation(h,"color"),map:l.getUniformLocation(h,"map"),opacity:l.getUniformLocation(h,"opacity"),modelViewMatrix:l.getUniformLocation(h,"modelViewMatrix"),projectionMatrix:l.getUniformLocation(h,"projectionMatrix"),fogType:l.getUniformLocation(h,"fogType"),fogDensity:l.getUniformLocation(h,"fogDensity"),fogNear:l.getUniformLocation(h,"fogNear"),fogFar:l.getUniformLocation(h,"fogFar"),fogColor:l.getUniformLocation(h,"fogColor"),alphaTest:l.getUniformLocation(h,"alphaTest")};var e=document.createElement("canvas");e.width=8,e.height=8;var m=e.getContext("2d");m.fillStyle="white",m.fillRect(0,0,8,8),k=new c.Texture(e),k.needsUpdate=!0};this.render=function(d,q){if(0!==b.length){void 0===h&&p(),l.useProgram(h),l.enableVertexAttribArray(i.position),l.enableVertexAttribArray(i.uv),l.disable(l.CULL_FACE),l.enable(l.BLEND),l.bindBuffer(l.ARRAY_BUFFER,f),l.vertexAttribPointer(i.position,2,l.FLOAT,!1,16,0),l.vertexAttribPointer(i.uv,2,l.FLOAT,!1,16,8),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,g),l.uniformMatrix4fv(j.projectionMatrix,!1,q.projectionMatrix.elements),l.activeTexture(l.TEXTURE0),l.uniform1i(j.map,0);var r=0,s=0,t=d.fog;t?(l.uniform3f(j.fogColor,t.color.r,t.color.g,t.color.b),t instanceof c.Fog?(l.uniform1f(j.fogNear,t.near),l.uniform1f(j.fogFar,t.far),l.uniform1i(j.fogType,1),r=1,s=1):t instanceof c.FogExp2&&(l.uniform1f(j.fogDensity,t.density),l.uniform1i(j.fogType,2),r=2,s=2)):(l.uniform1i(j.fogType,0),r=0,s=0);for(var u=0,v=b.length;u<v;u++){var w=b[u];w._modelViewMatrix.multiplyMatrices(q.matrixWorldInverse,w.matrixWorld),w.z=-w._modelViewMatrix.elements[14]}b.sort(e);for(var x=[],u=0,v=b.length;u<v;u++){var w=b[u],y=w.material;l.uniform1f(j.alphaTest,y.alphaTest),l.uniformMatrix4fv(j.modelViewMatrix,!1,w._modelViewMatrix.elements),w.matrixWorld.decompose(m,n,o),x[0]=o.x,x[1]=o.y;var z=0;d.fog&&y.fog&&(z=s),r!==z&&(l.uniform1i(j.fogType,z),r=z),null!==y.map?(l.uniform2f(j.uvOffset,y.map.offset.x,y.map.offset.y),l.uniform2f(j.uvScale,y.map.repeat.x,y.map.repeat.y)):(l.uniform2f(j.uvOffset,0,0),l.uniform2f(j.uvScale,1,1)),l.uniform1f(j.opacity,y.opacity),l.uniform3f(j.color,y.color.r,y.color.g,y.color.b),l.uniform1f(j.rotation,y.rotation),l.uniform2fv(j.scale,x),a.state.setBlending(y.blending,y.blendEquation,y.blendSrc,y.blendDst),a.state.setDepthTest(y.depthTest),a.state.setDepthWrite(y.depthWrite),y.map&&y.map.image&&y.map.image.width?a.setTexture(y.map,0):a.setTexture(k,0),l.drawElements(l.TRIANGLES,6,l.UNSIGNED_SHORT,0)}l.enable(l.CULL_FACE),a.resetGLState()}}},c.GeometryUtils={merge:function(a,b,d){c.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var e;b instanceof c.Mesh&&(b.matrixAutoUpdate&&b.updateMatrix(),e=b.matrix,b=b.geometry),a.merge(b,e,d)},center:function(a){return c.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),a.center()}},c.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,d,e){var f=new c.ImageLoader;f.crossOrigin=this.crossOrigin;var g=new c.Texture(void 0,b);return f.load(a,function(a){g.image=a,g.needsUpdate=!0,d&&d(g)},void 0,function(a){e&&e(a)}),g.sourceFile=a,g},loadTextureCube:function(a,b,d,e){var f=[],g=new c.ImageLoader;g.crossOrigin=this.crossOrigin;var h=new c.CubeTexture(f,b);h.flipY=!1;for(var i=0,j=0,k=a.length;j<k;++j)!function(b){g.load(a[b],function(a){h.images[b]=a,6===(i+=1)&&(h.needsUpdate=!0,d&&d(h))},void 0,e)}(j);return h},loadCompressedTexture:function(){c.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){c.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(a,b){var c=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]};b|=1;var d=a.width,e=a.height,f=document.createElement("canvas");f.width=d,f.height=e;var g=f.getContext("2d");g.drawImage(a,0,0);for(var h=g.getImageData(0,0,d,e).data,i=g.createImageData(d,e),j=i.data,k=0;k<d;k++)for(var l=0;l<e;l++){var m=l-1<0?0:l-1,n=l+1>e-1?e-1:l+1,o=k-1<0?0:k-1,p=k+1>d-1?d-1:k+1,q=[],r=[0,0,h[4*(l*d+k)]/255*b];q.push([-1,0,h[4*(l*d+o)]/255*b]),q.push([-1,-1,h[4*(m*d+o)]/255*b]),q.push([0,-1,h[4*(m*d+k)]/255*b]),q.push([1,-1,h[4*(m*d+p)]/255*b]),q.push([1,0,h[4*(l*d+p)]/255*b]),q.push([1,1,h[4*(n*d+p)]/255*b]),q.push([0,1,h[4*(n*d+k)]/255*b]),q.push([-1,1,h[4*(n*d+o)]/255*b]);for(var s=[],t=q.length,u=0;u<t;u++){var v=q[u],w=q[(u+1)%t];v=c(v,r),w=c(w,r),s.push(function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/b,a[1]/b,a[2]/b]}(function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}(v,w)))}for(var x=[0,0,0],u=0;u<s.length;u++)x[0]+=s[u][0],x[1]+=s[u][1],x[2]+=s[u][2];x[0]/=s.length,x[1]/=s.length,x[2]/=s.length;var y=4*(l*d+k);j[y]=(x[0]+1)/2*255|0,j[y+1]=(x[1]+1)/2*255|0,j[y+2]=255*x[2]|0,j[y+3]=255}return g.putImageData(i,0,0),f},generateDataTexture:function(a,b,d){for(var e=a*b,f=new Uint8Array(3*e),g=Math.floor(255*d.r),h=Math.floor(255*d.g),i=Math.floor(255*d.b),j=0;j<e;j++)f[3*j]=g,f[3*j+1]=h,f[3*j+2]=i;var k=new c.DataTexture(f,a,b,c.RGBFormat);return k.needsUpdate=!0,k}},c.SceneUtils={createMultiMaterialObject:function(a,b){for(var d=new c.Object3D,e=0,f=b.length;e<f;e++)d.add(new c.Mesh(a,b[e]));return d},detach:function(a,b,c){a.applyMatrix(b.matrixWorld),b.remove(a),c.add(a)},attach:function(a,b,d){var e=new c.Matrix4;e.getInverse(d.matrixWorld),a.applyMatrix(e),b.remove(a),d.add(a)}},c.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(a){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(a){var b=a.familyName.toLowerCase(),c=this;return c.faces[b]=c.faces[b]||{},c.faces[b][a.cssFontWeight]=c.faces[b][a.cssFontWeight]||{},c.faces[b][a.cssFontWeight][a.cssFontStyle]=a,c.faces[b][a.cssFontWeight][a.cssFontStyle]=a,a},drawText:function(a){var b,d=this.getFace(),e=this.size/d.resolution,f=0,g=String(a).split(""),h=g.length,i=[];for(b=0;b<h;b++){var j=new c.Path,k=this.extractGlyphPoints(g[b],d,e,f,j);f+=k.offset,i.push(k.path)}return{paths:i,offset:f/2}},extractGlyphPoints:function(a,b,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=[],z=b.glyphs[a]||b.glyphs["?"];if(z){if(z.o)for(j=z._cachedOutline||(z._cachedOutline=z.o.split(" ")),k=j.length,l=d,m=d,g=0;g<k;)switch(j[g++]){case"m":n=j[g++]*l+e,o=j[g++]*m,f.moveTo(n,o);break;case"l":n=j[g++]*l+e,o=j[g++]*m,f.lineTo(n,o);break;case"q":if(p=j[g++]*l+e,q=j[g++]*m,t=j[g++]*l+e,u=j[g++]*m,f.quadraticCurveTo(t,u,p,q),x=y[y.length-1])for(r=x.x,s=x.y,h=1,i=this.divisions;h<=i;h++){var A=h/i;c.Shape.Utils.b2(A,r,t,p),c.Shape.Utils.b2(A,s,u,q)}break;case"b":if(p=j[g++]*l+e,q=j[g++]*m,t=j[g++]*l+e,u=j[g++]*m,v=j[g++]*l+e,w=j[g++]*m,f.bezierCurveTo(t,u,v,w,p,q),x=y[y.length-1])for(r=x.x,s=x.y,h=1,i=this.divisions;h<=i;h++){var A=h/i;c.Shape.Utils.b3(A,r,t,v,p),c.Shape.Utils.b3(A,s,u,w,q)}}return{offset:z.ha*d,path:f}}}},c.FontUtils.generateShapes=function(a,b){b=b||{};var d=void 0!==b.size?b.size:100,e=void 0!==b.curveSegments?b.curveSegments:4,f=void 0!==b.font?b.font:"helvetiker",g=void 0!==b.weight?b.weight:"normal",h=void 0!==b.style?b.style:"normal";c.FontUtils.size=d,c.FontUtils.divisions=e,c.FontUtils.face=f,c.FontUtils.weight=g,c.FontUtils.style=h;for(var i=c.FontUtils.drawText(a),j=i.paths,k=[],l=0,m=j.length;l<m;l++)Array.prototype.push.apply(k,j[l].toShapes());return k},function(a){var b=function(a,b){var f=a.length;if(f<3)return null;var g,h,i,j=[],k=[],l=[];if(d(a)>0)for(h=0;h<f;h++)k[h]=h;else for(h=0;h<f;h++)k[h]=f-1-h;var m=f,n=2*m;for(h=m-1;m>2;){if(n--<=0)return c.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()"),b?l:j;if(g=h,m<=g&&(g=0),h=g+1,m<=h&&(h=0),i=h+1,m<=i&&(i=0),e(a,g,h,i,m,k)){var o,p,q,r,s;for(o=k[g],p=k[h],q=k[i],j.push([a[o],a[p],a[q]]),l.push([k[g],k[h],k[i]]),r=h,s=h+1;s<m;r++,s++)k[r]=k[s];m--,n=2*m}}return b?l:j},d=function(a){for(var b=a.length,c=0,d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return.5*c},e=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o;if(h=a[f[b]].x,i=a[f[b]].y,j=a[f[c]].x,k=a[f[c]].y,l=a[f[d]].x,m=a[f[d]].y,1e-10>(j-h)*(m-i)-(k-i)*(l-h))return!1;var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;for(p=l-j,q=m-k,r=h-l,s=i-m,t=j-h,u=k-i,g=0;g<e;g++)if(n=a[f[g]].x,o=a[f[g]].y,!(n===h&&o===i||n===j&&o===k||n===l&&o===m)&&(v=n-h,w=o-i,x=n-j,y=o-k,z=n-l,A=o-m,D=p*y-q*x,B=t*w-u*v,C=r*A-s*z,D>=-1e-10&&C>=-1e-10&&B>=-1e-10))return!1;return!0};a.Triangulate=b,a.Triangulate.area=d}(c.FontUtils),c.Audio=function(a){c.Object3D.call(this),this.type="Audio",this.context=a.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.isPlaying=!1},c.Audio.prototype=Object.create(c.Object3D.prototype),c.Audio.prototype.constructor=c.Audio,c.Audio.prototype.load=function(a){var b=this,c=new XMLHttpRequest;return c.open("GET",a,!0),c.responseType="arraybuffer",c.onload=function(a){b.context.decodeAudioData(this.response,function(a){b.source.buffer=a,b.autoplay&&b.play()})},c.send(),this},c.Audio.prototype.play=function(){if(!0===this.isPlaying)return void c.warn("THREE.Audio: Audio is already playing.");var a=this.context.createBufferSource();a.buffer=this.source.buffer,a.loop=this.source.loop,a.onended=this.source.onended,a.connect(this.panner),a.start(0,this.startTime),this.isPlaying=!0,this.source=a},c.Audio.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},c.Audio.prototype.stop=function(){this.source.stop(),this.startTime=0},c.Audio.prototype.onEnded=function(){this.isPlaying=!1},c.Audio.prototype.setLoop=function(a){this.source.loop=a},c.Audio.prototype.setRefDistance=function(a){this.panner.refDistance=a},c.Audio.prototype.setRolloffFactor=function(a){this.panner.rolloffFactor=a},c.Audio.prototype.setVolume=function(a){this.gain.gain.value=a},c.Audio.prototype.updateMatrixWorld=function(){var a=new c.Vector3;return function(b){c.Object3D.prototype.updateMatrixWorld.call(this,b),a.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(a.x,a.y,a.z)}}(),c.AudioListener=function(){c.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},c.AudioListener.prototype=Object.create(c.Object3D.prototype),c.AudioListener.prototype.constructor=c.AudioListener,c.AudioListener.prototype.updateMatrixWorld=function(){var a=new c.Vector3,b=new c.Quaternion,d=new c.Vector3,e=new c.Vector3,f=new c.Vector3,g=new c.Vector3;return function(h){c.Object3D.prototype.updateMatrixWorld.call(this,h);var i=this.context.listener,j=this.up;this.matrixWorld.decompose(a,b,d),e.set(0,0,-1).applyQuaternion(b),f.subVectors(a,g),i.setPosition(a.x,a.y,a.z),i.setOrientation(e.x,e.y,e.z,j.x,j.y,j.z),i.setVelocity(f.x,f.y,f.z),g.copy(a)}}(),c.Curve=function(){},c.Curve.prototype.getPoint=function(a){return c.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},c.Curve.prototype.getPointAt=function(a){var b=this.getUtoTmapping(a);return this.getPoint(b)},c.Curve.prototype.getPoints=function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPoint(b/a));return c},c.Curve.prototype.getSpacedPoints=function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPointAt(b/a));return c},c.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]},c.Curve.prototype.getLengths=function(a){if(a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b,c,d=[],e=this.getPoint(0),f=0;for(d.push(0),c=1;c<=a;c++)b=this.getPoint(c/a),f+=b.distanceTo(e),d.push(f),e=b;return this.cacheArcLengths=d,d},c.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},c.Curve.prototype.getUtoTmapping=function(a,b){var c,d=this.getLengths(),e=0,f=d.length;c=b||a*d[f-1];for(var g,h=0,i=f-1;h<=i;)if(e=Math.floor(h+(i-h)/2),(g=d[e]-c)<0)h=e+1;else{if(!(g>0)){i=e;break}i=e-1}if(e=i,d[e]==c){var j=e/(f-1);return j}var k=d[e],l=d[e+1],m=l-k,n=(c-k)/m,j=(e+n)/(f-1);return j},c.Curve.prototype.getTangent=function(a){var b=a-1e-4,c=a+1e-4;b<0&&(b=0),c>1&&(c=1);var d=this.getPoint(b);return this.getPoint(c).clone().sub(d).normalize()},c.Curve.prototype.getTangentAt=function(a){var b=this.getUtoTmapping(a);return this.getTangent(b)},c.Curve.Utils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a,b,c,d,e){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e;return(2*b-2*c+f+g)*(e*h)+(-3*b+3*c-2*f-g)*h+f*e+b}},c.Curve.create=function(a,b){return a.prototype=Object.create(c.Curve.prototype),a.prototype.constructor=a,a.prototype.getPoint=b,a},c.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},c.CurvePath.prototype=Object.create(c.Curve.prototype),c.CurvePath.prototype.constructor=c.CurvePath,c.CurvePath.prototype.add=function(a){this.curves.push(a)},c.CurvePath.prototype.checkConnection=function(){},c.CurvePath.prototype.closePath=function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new c.LineCurve(b,a))},c.CurvePath.prototype.getPoint=function(a){for(var b,c,d=a*this.getLength(),e=this.getCurveLengths(),f=0;f<e.length;){if(e[f]>=d){b=e[f]-d,c=this.curves[f];var g=1-b/c.getLength();return c.getPointAt(g)}f++}return null},c.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]},c.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var a,b=[],c=0,d=this.curves.length;for(a=0;a<d;a++)c+=this.curves[a].getLength(),b.push(c);return this.cacheLengths=b,b},c.CurvePath.prototype.getBoundingBox=function(){var a,b,d,e,f,g,h=this.getPoints();a=b=Number.NEGATIVE_INFINITY,e=f=Number.POSITIVE_INFINITY;var i,j,k,l,m=h[0]instanceof c.Vector3;for(l=m?new c.Vector3:new c.Vector2,j=0,k=h.length;j<k;j++)i=h[j],i.x>a?a=i.x:i.x<e&&(e=i.x),i.y>b?b=i.y:i.y<f&&(f=i.y),m&&(i.z>d?d=i.z:i.z<g&&(g=i.z)),l.add(i);var n={minX:e,minY:f,maxX:a,maxY:b};return m&&(n.maxZ=d,n.minZ=g),n},c.CurvePath.prototype.createPointsGeometry=function(a){var b=this.getPoints(a,!0);return this.createGeometry(b)},c.CurvePath.prototype.createSpacedPointsGeometry=function(a){var b=this.getSpacedPoints(a,!0);return this.createGeometry(b)},c.CurvePath.prototype.createGeometry=function(a){for(var b=new c.Geometry,d=0;d<a.length;d++)b.vertices.push(new c.Vector3(a[d].x,a[d].y,a[d].z||0));return b},c.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)},c.CurvePath.prototype.getTransformedPoints=function(a,b){var c,d,e=this.getPoints(a);for(b||(b=this.bends),c=0,d=b.length;c<d;c++)e=this.getWrapPoints(e,b[c]);return e},c.CurvePath.prototype.getTransformedSpacedPoints=function(a,b){var c,d,e=this.getSpacedPoints(a);for(b||(b=this.bends),c=0,d=b.length;c<d;c++)e=this.getWrapPoints(e,b[c]);return e},c.CurvePath.prototype.getWrapPoints=function(a,b){var c,d,e,f,g,h,i=this.getBoundingBox();for(c=0,d=a.length;c<d;c++){e=a[c],f=e.x,g=e.y,h=f/i.maxX,h=b.getUtoTmapping(h,f);var j=b.getPoint(h),k=b.getTangent(h);k.set(-k.y,k.x).multiplyScalar(g),e.x=j.x+k.x,e.y=j.y+k.y}return a},c.Gyroscope=function(){c.Object3D.call(this)},c.Gyroscope.prototype=Object.create(c.Object3D.prototype),c.Gyroscope.prototype.constructor=c.Gyroscope,c.Gyroscope.prototype.updateMatrixWorld=function(){var a=new c.Vector3,b=new c.Quaternion,d=new c.Vector3,e=new c.Vector3,f=new c.Quaternion,g=new c.Vector3;return function(c){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||c)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(e,f,g),this.matrix.decompose(a,b,d),this.matrixWorld.compose(e,b,g)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,c=!0);for(var h=0,i=this.children.length;h<i;h++)this.children[h].updateMatrixWorld(c)}}(),c.Path=function(a){c.CurvePath.call(this),this.actions=[],a&&this.fromPoints(a)},c.Path.prototype=Object.create(c.CurvePath.prototype),c.Path.prototype.constructor=c.Path,c.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},c.Path.prototype.fromPoints=function(a){
this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)},c.Path.prototype.moveTo=function(a,b){var d=Array.prototype.slice.call(arguments);this.actions.push({action:c.PathActions.MOVE_TO,args:d})},c.Path.prototype.lineTo=function(a,b){var d=Array.prototype.slice.call(arguments),e=this.actions[this.actions.length-1].args,f=e[e.length-2],g=e[e.length-1],h=new c.LineCurve(new c.Vector2(f,g),new c.Vector2(a,b));this.curves.push(h),this.actions.push({action:c.PathActions.LINE_TO,args:d})},c.Path.prototype.quadraticCurveTo=function(a,b,d,e){var f=Array.prototype.slice.call(arguments),g=this.actions[this.actions.length-1].args,h=g[g.length-2],i=g[g.length-1],j=new c.QuadraticBezierCurve(new c.Vector2(h,i),new c.Vector2(a,b),new c.Vector2(d,e));this.curves.push(j),this.actions.push({action:c.PathActions.QUADRATIC_CURVE_TO,args:f})},c.Path.prototype.bezierCurveTo=function(a,b,d,e,f,g){var h=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,j=i[i.length-2],k=i[i.length-1],l=new c.CubicBezierCurve(new c.Vector2(j,k),new c.Vector2(a,b),new c.Vector2(d,e),new c.Vector2(f,g));this.curves.push(l),this.actions.push({action:c.PathActions.BEZIER_CURVE_TO,args:h})},c.Path.prototype.splineThru=function(a){var b=Array.prototype.slice.call(arguments),d=this.actions[this.actions.length-1].args,e=d[d.length-2],f=d[d.length-1],g=[new c.Vector2(e,f)];Array.prototype.push.apply(g,a);var h=new c.SplineCurve(g);this.curves.push(h),this.actions.push({action:c.PathActions.CSPLINE_THRU,args:b})},c.Path.prototype.arc=function(a,b,c,d,e,f){var g=this.actions[this.actions.length-1].args,h=g[g.length-2],i=g[g.length-1];this.absarc(a+h,b+i,c,d,e,f)},c.Path.prototype.absarc=function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},c.Path.prototype.ellipse=function(a,b,c,d,e,f,g){var h=this.actions[this.actions.length-1].args,i=h[h.length-2],j=h[h.length-1];this.absellipse(a+i,b+j,c,d,e,f,g)},c.Path.prototype.absellipse=function(a,b,d,e,f,g,h){var i=Array.prototype.slice.call(arguments),j=new c.EllipseCurve(a,b,d,e,f,g,h);this.curves.push(j);var k=j.getPoint(1);i.push(k.x),i.push(k.y),this.actions.push({action:c.PathActions.ELLIPSE,args:i})},c.Path.prototype.getSpacedPoints=function(a,b){a||(a=40);for(var c=[],d=0;d<a;d++)c.push(this.getPoint(d/a));return c},c.Path.prototype.getPoints=function(a,b){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(a,b);a=a||12;var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=[];for(d=0,e=this.actions.length;d<e;d++)switch(f=this.actions[d],g=f.action,h=f.args,g){case c.PathActions.MOVE_TO:case c.PathActions.LINE_TO:v.push(new c.Vector2(h[0],h[1]));break;case c.PathActions.QUADRATIC_CURVE_TO:for(i=h[2],j=h[3],m=h[0],n=h[1],v.length>0?(q=v[v.length-1],o=q.x,p=q.y):(q=this.actions[d-1].args,o=q[q.length-2],p=q[q.length-1]),r=1;r<=a;r++)s=r/a,t=c.Shape.Utils.b2(s,o,m,i),u=c.Shape.Utils.b2(s,p,n,j),v.push(new c.Vector2(t,u));break;case c.PathActions.BEZIER_CURVE_TO:for(i=h[4],j=h[5],m=h[0],n=h[1],k=h[2],l=h[3],v.length>0?(q=v[v.length-1],o=q.x,p=q.y):(q=this.actions[d-1].args,o=q[q.length-2],p=q[q.length-1]),r=1;r<=a;r++)s=r/a,t=c.Shape.Utils.b3(s,o,m,k,i),u=c.Shape.Utils.b3(s,p,n,l,j),v.push(new c.Vector2(t,u));break;case c.PathActions.CSPLINE_THRU:q=this.actions[d-1].args;var w=new c.Vector2(q[q.length-2],q[q.length-1]),x=[w],y=a*h[0].length;x=x.concat(h[0]);var z=new c.SplineCurve(x);for(r=1;r<=y;r++)v.push(z.getPointAt(r/y));break;case c.PathActions.ARC:var A,B=h[0],C=h[1],D=h[2],E=h[3],F=h[4],G=!!h[5],H=F-E,I=2*a;for(r=1;r<=I;r++)s=r/I,G||(s=1-s),A=E+s*H,t=B+D*Math.cos(A),u=C+D*Math.sin(A),v.push(new c.Vector2(t,u));break;case c.PathActions.ELLIPSE:var A,B=h[0],C=h[1],J=h[2],K=h[3],E=h[4],F=h[5],G=!!h[6],H=F-E,I=2*a;for(r=1;r<=I;r++)s=r/I,G||(s=1-s),A=E+s*H,t=B+J*Math.cos(A),u=C+K*Math.sin(A),v.push(new c.Vector2(t,u))}var L=v[v.length-1];return Math.abs(L.x-v[0].x)<1e-10&&Math.abs(L.y-v[0].y)<1e-10&&v.splice(v.length-1,1),b&&v.push(v[0]),v},c.Path.prototype.toShapes=function(a,b){function d(a){for(var b=[],d=0,e=a.length;d<e;d++){var f=a[d],g=new c.Shape;g.actions=f.actions,g.curves=f.curves,b.push(g)}return b}var e=function(a){var b,d,e,f,g,h=[],i=new c.Path;for(b=0,d=a.length;b<d;b++)e=a[b],g=e.args,f=e.action,f==c.PathActions.MOVE_TO&&0!=i.actions.length&&(h.push(i),i=new c.Path),i[f].apply(i,g);return 0!=i.actions.length&&h.push(i),h}(this.actions);if(0==e.length)return[];if(!0===b)return d(e);var f,g,h,i=[];if(1==e.length)return g=e[0],h=new c.Shape,h.actions=g.actions,h.curves=g.curves,i.push(h),i;var j=!c.Shape.Utils.isClockWise(e[0].getPoints());j=a?!j:j;var k,l=[],m=[],n=[],o=0;m[o]=void 0,n[o]=[];var p,q;for(p=0,q=e.length;p<q;p++)g=e[p],k=g.getPoints(),f=c.Shape.Utils.isClockWise(k),f=a?!f:f,f?(!j&&m[o]&&o++,m[o]={s:new c.Shape,p:k},m[o].s.actions=g.actions,m[o].s.curves=g.curves,j&&o++,n[o]=[]):n[o].push({h:g,p:k[0]});if(!m[0])return d(e);if(m.length>1){for(var r=!1,s=[],t=0,u=m.length;t<u;t++)l[t]=[];for(var t=0,u=m.length;t<u;t++)for(var v=n[t],w=0;w<v.length;w++){for(var x=v[w],y=!0,z=0;z<m.length;z++)(function(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],i=h.x-g.x,j=h.y-g.y;if(Math.abs(j)>1e-10){if(j<0&&(g=b[f],i=-i,h=b[e],j=-j),a.y<g.y||a.y>h.y)continue;if(a.y==g.y){if(a.x==g.x)return!0}else{var k=j*(a.x-g.x)-i*(a.y-g.y);if(0==k)return!0;if(k<0)continue;d=!d}}else{if(a.y!=g.y)continue;if(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x)return!0}}return d})(x.p,m[z].p)&&(t!=z&&s.push({froms:t,tos:z,hole:w}),y?(y=!1,l[z].push(x)):r=!0);y&&l[t].push(x)}s.length>0&&(r||(n=l))}var A,B,C;for(p=0,q=m.length;p<q;p++)for(h=m[p].s,i.push(h),A=n[p],B=0,C=A.length;B<C;B++)h.holes.push(A[B].h);return i},c.Shape=function(){c.Path.apply(this,arguments),this.holes=[]},c.Shape.prototype=Object.create(c.Path.prototype),c.Shape.prototype.constructor=c.Shape,c.Shape.prototype.extrude=function(a){return new c.ExtrudeGeometry(this,a)},c.Shape.prototype.makeGeometry=function(a){return new c.ShapeGeometry(this,a)},c.Shape.prototype.getPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++)d[b]=this.holes[b].getTransformedPoints(a,this.bends);return d},c.Shape.prototype.getSpacedPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++)d[b]=this.holes[b].getTransformedSpacedPoints(a,this.bends);return d},c.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}},c.Shape.prototype.extractPoints=function(a){return this.useSpacedPoints?this.extractAllSpacedPoints(a):this.extractAllPoints(a)},c.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}},c.Shape.Utils={triangulateShape:function(a,b){function d(a,b,c){return a.x!=b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function e(a,b,c,e,f){var g=b.x-a.x,h=b.y-a.y,i=e.x-c.x,j=e.y-c.y,k=a.x-c.x,l=a.y-c.y,m=h*i-g*j,n=h*k-g*l;if(Math.abs(m)>1e-10){var o;if(m>0){if(n<0||n>m)return[];if((o=j*k-i*l)<0||o>m)return[]}else{if(n>0||n<m)return[];if((o=j*k-i*l)>0||o<m)return[]}if(0==o)return!f||0!=n&&n!=m?[a]:[];if(o==m)return!f||0!=n&&n!=m?[b]:[];if(0==n)return[c];if(n==m)return[e];var p=o/m;return[{x:a.x+p*g,y:a.y+p*h}]}if(0!=n||j*k!=i*l)return[];var q=0==g&&0==h,r=0==i&&0==j;if(q&&r)return a.x!=c.x||a.y!=c.y?[]:[a];if(q)return d(c,e,a)?[a]:[];if(r)return d(a,b,c)?[c]:[];var s,t,u,v,w,x,y,z;return 0!=g?(a.x<b.x?(s=a,u=a.x,t=b,v=b.x):(s=b,u=b.x,t=a,v=a.x),c.x<e.x?(w=c,y=c.x,x=e,z=e.x):(w=e,y=e.x,x=c,z=c.x)):(a.y<b.y?(s=a,u=a.y,t=b,v=b.y):(s=b,u=b.y,t=a,v=a.y),c.y<e.y?(w=c,y=c.y,x=e,z=e.y):(w=e,y=e.y,x=c,z=c.y)),u<=y?v<y?[]:v==y?f?[]:[w]:v<=z?[w,t]:[w,x]:u>z?[]:u==z?f?[]:[s]:v<=z?[s,t]:[s,x]}function f(a,b,c,d){var e=b.x-a.x,f=b.y-a.y,g=c.x-a.x,h=c.y-a.y,i=d.x-a.x,j=d.y-a.y,k=e*h-f*g,l=e*j-f*i;if(Math.abs(k)>1e-10){var m=i*h-j*g;return k>0?l>=0&&m>=0:l>=0||m>=0}return l>0}for(var g,h,i,j,k,l,m={},n=a.concat(),o=0,p=b.length;o<p;o++)Array.prototype.push.apply(n,b[o]);for(g=0,h=n.length;g<h;g++)k=n[g].x+":"+n[g].y,void 0!==m[k]&&c.warn("THREE.Shape: Duplicate point",k),m[k]=g;var q=function(a,b){for(var c,d,g,h,i,j,k,l,m,n,o,p=a.concat(),q=[],r=[],s=0,t=b.length;s<t;s++)q.push(s);for(var u=0,v=2*q.length;q.length>0;){if(--v<0){console.log("Infinite Loop! Holes left:"+q.length+", Probably Hole outside Shape!");break}for(g=u;g<p.length;g++){h=p[g],d=-1;for(var s=0;s<q.length;s++)if(j=q[s],k=h.x+":"+h.y+":"+j,void 0===r[k]){c=b[j];for(var w=0;w<c.length;w++)if(i=c[w],function(a,b){var d=p.length-1,e=a-1;e<0&&(e=d);var g=a+1;g>d&&(g=0);var h=f(p[a],p[e],p[g],c[b]);if(!h)return!1;var i=c.length-1,j=b-1;j<0&&(j=i);var k=b+1;return k>i&&(k=0),!!(h=f(c[b],c[j],c[k],p[a]))}(g,w)&&!function(a,b){var c,d,f;for(c=0;c<p.length;c++)if(d=c+1,d%=p.length,f=e(a,b,p[c],p[d],!0),f.length>0)return!0;return!1}(h,i)&&!function(a,c){var d,f,g,h,i;for(d=0;d<q.length;d++)for(f=b[q[d]],g=0;g<f.length;g++)if(h=g+1,h%=f.length,i=e(a,c,f[g],f[h],!0),i.length>0)return!0;return!1}(h,i)){d=w,q.splice(s,1),l=p.slice(0,g+1),m=p.slice(g),n=c.slice(d),o=c.slice(0,d+1),p=l.concat(n).concat(o).concat(m),u=g;break}if(d>=0)break;r[k]=!0}if(d>=0)break}}return p}(a,b),r=c.FontUtils.Triangulate(q,!1);for(g=0,h=r.length;g<h;g++)for(j=r[g],i=0;i<3;i++)k=j[i].x+":"+j[i].y,void 0!==(l=m[k])&&(j[i]=l);return r.concat()},isClockWise:function(a){return c.FontUtils.Triangulate.area(a)<0},b2p0:function(a,b){var c=1-a;return c*c*b},b2p1:function(a,b){return 2*(1-a)*a*b},b2p2:function(a,b){return a*a*b},b2:function(a,b,c,d){return this.b2p0(a,b)+this.b2p1(a,c)+this.b2p2(a,d)},b3p0:function(a,b){var c=1-a;return c*c*c*b},b3p1:function(a,b){var c=1-a;return 3*c*c*a*b},b3p2:function(a,b){return 3*(1-a)*a*a*b},b3p3:function(a,b){return a*a*a*b},b3:function(a,b,c,d,e){return this.b3p0(a,b)+this.b3p1(a,c)+this.b3p2(a,d)+this.b3p3(a,e)}},c.LineCurve=function(a,b){this.v1=a,this.v2=b},c.LineCurve.prototype=Object.create(c.Curve.prototype),c.LineCurve.prototype.constructor=c.LineCurve,c.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().sub(this.v1);return b.multiplyScalar(a).add(this.v1),b},c.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)},c.LineCurve.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()},c.QuadraticBezierCurve=function(a,b,c){this.v0=a,this.v1=b,this.v2=c},c.QuadraticBezierCurve.prototype=Object.create(c.Curve.prototype),c.QuadraticBezierCurve.prototype.constructor=c.QuadraticBezierCurve,c.QuadraticBezierCurve.prototype.getPoint=function(a){var b=new c.Vector2;return b.x=c.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x),b.y=c.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y),b},c.QuadraticBezierCurve.prototype.getTangent=function(a){var b=new c.Vector2;return b.x=c.Curve.Utils.tangentQuadraticBezier(a,this.v0.x,this.v1.x,this.v2.x),b.y=c.Curve.Utils.tangentQuadraticBezier(a,this.v0.y,this.v1.y,this.v2.y),b.normalize()},c.CubicBezierCurve=function(a,b,c,d){this.v0=a,this.v1=b,this.v2=c,this.v3=d},c.CubicBezierCurve.prototype=Object.create(c.Curve.prototype),c.CubicBezierCurve.prototype.constructor=c.CubicBezierCurve,c.CubicBezierCurve.prototype.getPoint=function(a){var b,d;return b=c.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),d=c.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new c.Vector2(b,d)},c.CubicBezierCurve.prototype.getTangent=function(a){var b,d;b=c.Curve.Utils.tangentCubicBezier(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),d=c.Curve.Utils.tangentCubicBezier(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var e=new c.Vector2(b,d);return e.normalize(),e},c.SplineCurve=function(a){this.points=void 0==a?[]:a},c.SplineCurve.prototype=Object.create(c.Curve.prototype),c.SplineCurve.prototype.constructor=c.SplineCurve,c.SplineCurve.prototype.getPoint=function(a){var b=this.points,d=(b.length-1)*a,e=Math.floor(d),f=d-e,g=b[0==e?e:e-1],h=b[e],i=b[e>b.length-2?b.length-1:e+1],j=b[e>b.length-3?b.length-1:e+2],k=new c.Vector2;return k.x=c.Curve.Utils.interpolate(g.x,h.x,i.x,j.x,f),k.y=c.Curve.Utils.interpolate(g.y,h.y,i.y,j.y,f),k},c.EllipseCurve=function(a,b,c,d,e,f,g){this.aX=a,this.aY=b,this.xRadius=c,this.yRadius=d,this.aStartAngle=e,this.aEndAngle=f,this.aClockwise=g},c.EllipseCurve.prototype=Object.create(c.Curve.prototype),c.EllipseCurve.prototype.constructor=c.EllipseCurve,c.EllipseCurve.prototype.getPoint=function(a){var b=this.aEndAngle-this.aStartAngle;b<0&&(b+=2*Math.PI),b>2*Math.PI&&(b-=2*Math.PI);var d;d=!0===this.aClockwise?this.aEndAngle+(1-a)*(2*Math.PI-b):this.aStartAngle+a*b;var e=new c.Vector2;return e.x=this.aX+this.xRadius*Math.cos(d),e.y=this.aY+this.yRadius*Math.sin(d),e},c.ArcCurve=function(a,b,d,e,f,g){c.EllipseCurve.call(this,a,b,d,d,e,f,g)},c.ArcCurve.prototype=Object.create(c.EllipseCurve.prototype),c.ArcCurve.prototype.constructor=c.ArcCurve,c.LineCurve3=c.Curve.create(function(a,b){this.v1=a,this.v2=b},function(a){var b=new c.Vector3;return b.subVectors(this.v2,this.v1),b.multiplyScalar(a),b.add(this.v1),b}),c.QuadraticBezierCurve3=c.Curve.create(function(a,b,c){this.v0=a,this.v1=b,this.v2=c},function(a){var b=new c.Vector3;return b.x=c.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x),b.y=c.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y),b.z=c.Shape.Utils.b2(a,this.v0.z,this.v1.z,this.v2.z),b}),c.CubicBezierCurve3=c.Curve.create(function(a,b,c,d){this.v0=a,this.v1=b,this.v2=c,this.v3=d},function(a){var b=new c.Vector3;return b.x=c.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b.y=c.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b.z=c.Shape.Utils.b3(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z),b}),c.SplineCurve3=c.Curve.create(function(a){this.points=void 0==a?[]:a},function(a){var b=this.points,d=(b.length-1)*a,e=Math.floor(d),f=d-e,g=b[0==e?e:e-1],h=b[e],i=b[e>b.length-2?b.length-1:e+1],j=b[e>b.length-3?b.length-1:e+2],k=new c.Vector3;return k.x=c.Curve.Utils.interpolate(g.x,h.x,i.x,j.x,f),k.y=c.Curve.Utils.interpolate(g.y,h.y,i.y,j.y,f),k.z=c.Curve.Utils.interpolate(g.z,h.z,i.z,j.z,f),k}),c.ClosedSplineCurve3=c.Curve.create(function(a){this.points=void 0==a?[]:a},function(a){var b=this.points,d=(b.length-0)*a,e=Math.floor(d),f=d-e;e+=e>0?0:(Math.floor(Math.abs(e)/b.length)+1)*b.length;var g=b[(e-1)%b.length],h=b[e%b.length],i=b[(e+1)%b.length],j=b[(e+2)%b.length],k=new c.Vector3;return k.x=c.Curve.Utils.interpolate(g.x,h.x,i.x,j.x,f),k.y=c.Curve.Utils.interpolate(g.y,h.y,i.y,j.y,f),k.z=c.Curve.Utils.interpolate(g.z,h.z,i.z,j.z,f),k}),c.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){c.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){c.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){c.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(a){if(!0===a.initialized)return a;for(var b=0;b<a.hierarchy.length;b++){for(var d=0;d<a.hierarchy[b].keys.length;d++)if(a.hierarchy[b].keys[d].time<0&&(a.hierarchy[b].keys[d].time=0),void 0!==a.hierarchy[b].keys[d].rot&&!(a.hierarchy[b].keys[d].rot instanceof c.Quaternion)){var e=a.hierarchy[b].keys[d].rot;a.hierarchy[b].keys[d].rot=(new c.Quaternion).fromArray(e)}if(a.hierarchy[b].keys.length&&void 0!==a.hierarchy[b].keys[0].morphTargets){for(var f={},d=0;d<a.hierarchy[b].keys.length;d++)for(var g=0;g<a.hierarchy[b].keys[d].morphTargets.length;g++){var h=a.hierarchy[b].keys[d].morphTargets[g];f[h]=-1}a.hierarchy[b].usedMorphTargets=f;for(var d=0;d<a.hierarchy[b].keys.length;d++){var i={};for(var h in f){for(var g=0;g<a.hierarchy[b].keys[d].morphTargets.length;g++)if(a.hierarchy[b].keys[d].morphTargets[g]===h){i[h]=a.hierarchy[b].keys[d].morphTargetsInfluences[g];break}g===a.hierarchy[b].keys[d].morphTargets.length&&(i[h]=0)}a.hierarchy[b].keys[d].morphTargetsInfluences=i}}for(var d=1;d<a.hierarchy[b].keys.length;d++)a.hierarchy[b].keys[d].time===a.hierarchy[b].keys[d-1].time&&(a.hierarchy[b].keys.splice(d,1),d--);for(var d=0;d<a.hierarchy[b].keys.length;d++)a.hierarchy[b].keys[d].index=d}return a.initialized=!0,a},parse:function(a){var b=[];if(a instanceof c.SkinnedMesh)for(var d=0;d<a.skeleton.bones.length;d++)b.push(a.skeleton.bones[d]);else!function a(b,c){c.push(b);for(var d=0;d<b.children.length;d++)a(b.children[d],c)}(a,b);return b},play:function(a){-1===this.animations.indexOf(a)&&this.animations.push(a)},stop:function(a){var b=this.animations.indexOf(a);-1!==b&&this.animations.splice(b,1)},update:function(a){for(var b=0;b<this.animations.length;b++)this.animations[b].resetBlendWeights();for(var b=0;b<this.animations.length;b++)this.animations[b].update(a)}},c.Animation=function(a,b){this.root=a,this.data=c.AnimationHandler.init(b),this.hierarchy=c.AnimationHandler.parse(a),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=c.AnimationHandler.LINEAR},c.Animation.prototype={constructor:c.Animation,keyTypes:["pos","rot","scl"],play:function(a,b){this.currentTime=void 0!==a?a:0,this.weight=void 0!==b?b:1,this.isPlaying=!0,this.reset(),c.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,c.AnimationHandler.stop(this)},reset:function(){for(var a=0,b=this.hierarchy.length;a<b;a++){var c=this.hierarchy[a];void 0===c.animationCache&&(c.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});var d=this.data.name,e=c.animationCache.animations,f=e[d];void 0===f&&(f={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:c.matrix},e[d]=f);for(var g=0;g<3;g++){for(var h=this.keyTypes[g],i=this.data.hierarchy[a].keys[0],j=this.getNextKeyWith(h,a,1);j.time<this.currentTime&&j.index>i.index;)i=j,j=this.getNextKeyWith(h,a,j.index+1);f.prevKey[h]=i,f.nextKey[h]=j}}},resetBlendWeights:function(){for(var a=0,b=this.hierarchy.length;a<b;a++){var c=this.hierarchy[a],d=c.animationCache;if(void 0!==d){var e=d.blending;e.positionWeight=0,e.quaternionWeight=0,e.scaleWeight=0}}},update:function(){var a=[],b=new c.Vector3,d=new c.Vector3,e=new c.Quaternion,f=function(a,b){var c,d,e,f,h,i,j,k,l,m=[],n=[];return c=(a.length-1)*b,d=Math.floor(c),e=c-d,m[0]=0===d?d:d-1,m[1]=d,m[2]=d>a.length-2?d:d+1,m[3]=d>a.length-3?d:d+2,i=a[m[0]],j=a[m[1]],k=a[m[2]],l=a[m[3]],f=e*e,h=e*f,n[0]=g(i[0],j[0],k[0],l[0],e,f,h),n[1]=g(i[1],j[1],k[1],l[1],e,f,h),n[2]=g(i[2],j[2],k[2],l[2],e,f,h),n},g=function(a,b,c,d,e,f,g){var h=.5*(c-a),i=.5*(d-b);return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b};return function(g){if(!1!==this.isPlaying&&(this.currentTime+=g*this.timeScale,0!==this.weight)){var h=this.data.length;(this.currentTime>h||this.currentTime<0)&&(this.loop?(this.currentTime%=h,this.currentTime<0&&(this.currentTime+=h),this.reset()):this.stop());for(var i=0,j=this.hierarchy.length;i<j;i++)for(var k=this.hierarchy[i],l=k.animationCache.animations[this.data.name],m=k.animationCache.blending,n=0;n<3;n++){var o=this.keyTypes[n],p=l.prevKey[o],q=l.nextKey[o];if(this.timeScale>0&&q.time<=this.currentTime||this.timeScale<0&&p.time>=this.currentTime){for(p=this.data.hierarchy[i].keys[0],q=this.getNextKeyWith(o,i,1);q.time<this.currentTime&&q.index>p.index;)p=q,q=this.getNextKeyWith(o,i,q.index+1);l.prevKey[o]=p,l.nextKey[o]=q}var r=(this.currentTime-p.time)/(q.time-p.time),s=p[o],t=q[o];if(r<0&&(r=0),r>1&&(r=1),"pos"===o){if(this.interpolationType===c.AnimationHandler.LINEAR){d.x=s[0]+(t[0]-s[0])*r,d.y=s[1]+(t[1]-s[1])*r,d.z=s[2]+(t[2]-s[2])*r;var u=this.weight/(this.weight+m.positionWeight);k.position.lerp(d,u),m.positionWeight+=this.weight}else if(this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD){a[0]=this.getPrevKeyWith("pos",i,p.index-1).pos,a[1]=s,a[2]=t,a[3]=this.getNextKeyWith("pos",i,q.index+1).pos,r=.33*r+.33;var v=f(a,r),u=this.weight/(this.weight+m.positionWeight);m.positionWeight+=this.weight;var w=k.position;if(w.x=w.x+(v[0]-w.x)*u,w.y=w.y+(v[1]-w.y)*u,w.z=w.z+(v[2]-w.z)*u,this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD){var x=f(a,1.01*r);b.set(x[0],x[1],x[2]),b.sub(w),b.y=0,b.normalize();var y=Math.atan2(b.x,b.z);k.rotation.set(0,y,0)}}}else if("rot"===o)if(c.Quaternion.slerp(s,t,e,r),0===m.quaternionWeight)k.quaternion.copy(e),m.quaternionWeight=this.weight;else{var u=this.weight/(this.weight+m.quaternionWeight);c.Quaternion.slerp(k.quaternion,e,k.quaternion,u),m.quaternionWeight+=this.weight}else if("scl"===o){d.x=s[0]+(t[0]-s[0])*r,d.y=s[1]+(t[1]-s[1])*r,d.z=s[2]+(t[2]-s[2])*r;var u=this.weight/(this.weight+m.scaleWeight);k.scale.lerp(d,u),m.scaleWeight+=this.weight}}return!0}}}(),getNextKeyWith:function(a,b,d){var e=this.data.hierarchy[b].keys;for(this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD?d=d<e.length-1?d:e.length-1:d%=e.length;d<e.length;d++)if(void 0!==e[d][a])return e[d];return this.data.hierarchy[b].keys[0]},getPrevKeyWith:function(a,b,d){var e=this.data.hierarchy[b].keys;for(d=this.interpolationType===c.AnimationHandler.CATMULLROM||this.interpolationType===c.AnimationHandler.CATMULLROM_FORWARD?d>0?d:0:d>=0?d:d+e.length;d>=0;d--)if(void 0!==e[d][a])return e[d];return this.data.hierarchy[b].keys[e.length-1]}},c.KeyFrameAnimation=function(a){this.root=a.node,this.data=c.AnimationHandler.init(a),this.hierarchy=c.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var b=0,d=this.hierarchy.length;b<d;b++){var e=this.data.hierarchy[b].keys,f=this.data.hierarchy[b].sids,g=this.hierarchy[b];if(e.length&&f){for(var h=0;h<f.length;h++){var i=f[h],j=this.getNextKeyWith(i,b,0);j&&j.apply(i)}g.matrixAutoUpdate=!1,this.data.hierarchy[b].node.updateMatrix(),g.matrixWorldNeedsUpdate=!0}}},c.KeyFrameAnimation.prototype={constructor:c.KeyFrameAnimation,play:function(a){if(this.currentTime=void 0!==a?a:0,!1===this.isPlaying){this.isPlaying=!0;var b,d,e,f=this.hierarchy.length;for(b=0;b<f;b++){d=this.hierarchy[b],e=this.data.hierarchy[b],void 0===e.animationCache&&(e.animationCache={},e.animationCache.prevKey=null,e.animationCache.nextKey=null,e.animationCache.originalMatrix=d.matrix);var g=this.data.hierarchy[b].keys;g.length&&(e.animationCache.prevKey=g[0],e.animationCache.nextKey=g[1],this.startTime=Math.min(g[0].time,this.startTime),this.endTime=Math.max(g[g.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,c.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,this.isPaused=!1,c.AnimationHandler.stop(this);for(var a=0;a<this.data.hierarchy.length;a++){var b=this.hierarchy[a],d=this.data.hierarchy[a];if(void 0!==d.animationCache){var e=d.animationCache.originalMatrix;e.copy(b.matrix),b.matrix=e,delete d.animationCache}}},update:function(a){if(!1!==this.isPlaying){this.currentTime+=a*this.timeScale;var b=this.data.length;!0===this.loop&&this.currentTime>b&&(this.currentTime%=b),this.currentTime=Math.min(this.currentTime,b);for(var c=0,d=this.hierarchy.length;c<d;c++){var e=this.hierarchy[c],f=this.data.hierarchy[c],g=f.keys,h=f.animationCache;if(g.length){var i=h.prevKey,j=h.nextKey;if(j.time<=this.currentTime){for(;j.time<this.currentTime&&j.index>i.index;)i=j,j=g[i.index+1];h.prevKey=i,h.nextKey=j}j.time>=this.currentTime?i.interpolate(j,this.currentTime):i.interpolate(j,j.time),this.data.hierarchy[c].node.updateMatrix(),e.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(a,b,c){var d=this.data.hierarchy[b].keys;for(c%=d.length;c<d.length;c++)if(d[c].hasTarget(a))return d[c];return d[0]},getPrevKeyWith:function(a,b,c){var d=this.data.hierarchy[b].keys;for(c=c>=0?c:c+d.length;c>=0;c--)if(d[c].hasTarget(a))return d[c];return d[d.length-1]}},c.MorphAnimation=function(a){this.mesh=a,this.frames=a.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.lastFrame=0,this.currentFrame=0,this.isPlaying=!1},c.MorphAnimation.prototype={constructor:c.MorphAnimation,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(a){if(!1!==this.isPlaying){this.currentTime+=a,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var b=this.duration/this.frames,c=Math.floor(this.currentTime/b),d=this.mesh.morphTargetInfluences;c!=this.currentFrame&&(d[this.lastFrame]=0,d[this.currentFrame]=1,d[c]=0,this.lastFrame=this.currentFrame,this.currentFrame=c),d[c]=this.currentTime%b/b,d[this.lastFrame]=1-d[c]}}},c.BoxGeometry=function(a,b,d,e,f,g){function h(a,b,d,e,f,g,h,j){var k,l,m,n=i.widthSegments,o=i.heightSegments,p=f/2,q=g/2,r=i.vertices.length;"x"===a&&"y"===b||"y"===a&&"x"===b?k="z":"x"===a&&"z"===b||"z"===a&&"x"===b?(k="y",o=i.depthSegments):("z"===a&&"y"===b||"y"===a&&"z"===b)&&(k="x",n=i.depthSegments);var s=n+1,t=o+1,u=f/n,v=g/o,w=new c.Vector3;for(w[k]=h>0?1:-1,m=0;m<t;m++)for(l=0;l<s;l++){var x=new c.Vector3;x[a]=(l*u-p)*d,x[b]=(m*v-q)*e,x[k]=h,i.vertices.push(x)}for(m=0;m<o;m++)for(l=0;l<n;l++){var y=l+s*m,z=l+s*(m+1),A=l+1+s*(m+1),B=l+1+s*m,C=new c.Vector2(l/n,1-m/o),D=new c.Vector2(l/n,1-(m+1)/o),E=new c.Vector2((l+1)/n,1-(m+1)/o),F=new c.Vector2((l+1)/n,1-m/o),G=new c.Face3(y+r,z+r,B+r);G.normal.copy(w),G.vertexNormals.push(w.clone(),w.clone(),w.clone()),G.materialIndex=j,i.faces.push(G),i.faceVertexUvs[0].push([C,D,F]),G=new c.Face3(z+r,A+r,B+r),G.normal.copy(w),G.vertexNormals.push(w.clone(),w.clone(),w.clone()),G.materialIndex=j,i.faces.push(G),i.faceVertexUvs[0].push([D.clone(),E,F.clone()])}}c.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:a,height:b,depth:d,widthSegments:e,heightSegments:f,depthSegments:g},this.widthSegments=e||1,this.heightSegments=f||1,this.depthSegments=g||1;var i=this,j=a/2,k=b/2,l=d/2;h("z","y",-1,-1,d,b,j,0),h("z","y",1,-1,d,b,-j,1),h("x","z",1,1,a,d,k,2),h("x","z",1,-1,a,d,-k,3),h("x","y",1,-1,a,b,l,4),h("x","y",-1,-1,a,b,-l,5),this.mergeVertices()},c.BoxGeometry.prototype=Object.create(c.Geometry.prototype),c.BoxGeometry.prototype.constructor=c.BoxGeometry,c.CircleGeometry=function(a,b,d,e){c.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:a,segments:b,thetaStart:d,thetaLength:e},a=a||50,b=void 0!==b?Math.max(3,b):8,d=void 0!==d?d:0,e=void 0!==e?e:2*Math.PI;var f,g=[],h=new c.Vector3,i=new c.Vector2(.5,.5);for(this.vertices.push(h),g.push(i),f=0;f<=b;f++){var j=new c.Vector3,k=d+f/b*e;j.x=a*Math.cos(k),j.y=a*Math.sin(k),this.vertices.push(j),g.push(new c.Vector2((j.x/a+1)/2,(j.y/a+1)/2))}var l=new c.Vector3(0,0,1);for(f=1;f<=b;f++)this.faces.push(new c.Face3(f,f+1,0,[l.clone(),l.clone(),l.clone()])),this.faceVertexUvs[0].push([g[f].clone(),g[f+1].clone(),i.clone()]);this.computeFaceNormals(),this.boundingSphere=new c.Sphere(new c.Vector3,a)},c.CircleGeometry.prototype=Object.create(c.Geometry.prototype),c.CircleGeometry.prototype.constructor=c.CircleGeometry,c.CubeGeometry=function(a,b,d,e,f,g){return c.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry."),new c.BoxGeometry(a,b,d,e,f,g)},c.CylinderGeometry=function(a,b,d,e,f,g,h,i){c.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:a,radiusBottom:b,height:d,radialSegments:e,heightSegments:f,openEnded:g,thetaStart:h,thetaLength:i},a=void 0!==a?a:20,b=void 0!==b?b:20,d=void 0!==d?d:100,e=e||8,f=f||1,g=void 0!==g&&g,h=void 0!==h?h:0,i=void 0!==i?i:2*Math.PI;var j,k,l=d/2,m=[],n=[];for(k=0;k<=f;k++){var o=[],p=[],q=k/f,r=q*(b-a)+a;for(j=0;j<=e;j++){var s=j/e,t=new c.Vector3;t.x=r*Math.sin(s*i+h),t.y=-q*d+l,t.z=r*Math.cos(s*i+h),this.vertices.push(t),o.push(this.vertices.length-1),p.push(new c.Vector2(s,1-q))}m.push(o),n.push(p)}var u,v,w=(b-a)/d;for(j=0;j<e;j++)for(0!==a?(u=this.vertices[m[0][j]].clone(),v=this.vertices[m[0][j+1]].clone()):(u=this.vertices[m[1][j]].clone(),v=this.vertices[m[1][j+1]].clone()),u.setY(Math.sqrt(u.x*u.x+u.z*u.z)*w).normalize(),v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*w).normalize(),k=0;k<f;k++){var x=m[k][j],y=m[k+1][j],z=m[k+1][j+1],A=m[k][j+1],B=u.clone(),C=u.clone(),D=v.clone(),E=v.clone(),F=n[k][j].clone(),G=n[k+1][j].clone(),H=n[k+1][j+1].clone(),I=n[k][j+1].clone();this.faces.push(new c.Face3(x,y,A,[B,C,E])),this.faceVertexUvs[0].push([F,G,I]),this.faces.push(new c.Face3(y,z,A,[C.clone(),D,E.clone()])),this.faceVertexUvs[0].push([G.clone(),H,I.clone()])}if(!1===g&&a>0)for(this.vertices.push(new c.Vector3(0,l,0)),j=0;j<e;j++){var x=m[0][j],y=m[0][j+1],z=this.vertices.length-1,B=new c.Vector3(0,1,0),C=new c.Vector3(0,1,0),D=new c.Vector3(0,1,0),F=n[0][j].clone(),G=n[0][j+1].clone(),H=new c.Vector2(G.x,0);this.faces.push(new c.Face3(x,y,z,[B,C,D])),this.faceVertexUvs[0].push([F,G,H])}if(!1===g&&b>0)for(this.vertices.push(new c.Vector3(0,-l,0)),j=0;j<e;j++){var x=m[f][j+1],y=m[f][j],z=this.vertices.length-1,B=new c.Vector3(0,-1,0),C=new c.Vector3(0,-1,0),D=new c.Vector3(0,-1,0),F=n[f][j+1].clone(),G=n[f][j].clone(),H=new c.Vector2(G.x,1);this.faces.push(new c.Face3(x,y,z,[B,C,D])),this.faceVertexUvs[0].push([F,G,H])}this.computeFaceNormals()},c.CylinderGeometry.prototype=Object.create(c.Geometry.prototype),c.CylinderGeometry.prototype.constructor=c.CylinderGeometry,c.ExtrudeGeometry=function(a,b){if(void 0===a)return void(a=[]);c.Geometry.call(this),this.type="ExtrudeGeometry",a=a instanceof Array?a:[a],this.addShapeList(a,b),this.computeFaceNormals()},c.ExtrudeGeometry.prototype=Object.create(c.Geometry.prototype);c.ExtrudeGeometry.prototype.constructor=c.ExtrudeGeometry,c.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var c=a.length,d=0;d<c;d++){var e=a[d];this.addShape(e,b)}},c.ExtrudeGeometry.prototype.addShape=function(a,b){function d(a,b,d){return b||c.error("THREE.ExtrudeGeometry: vec does not exist"),b.clone().multiplyScalar(d).add(a)}function e(a,b,d){var e,f,g=1,h=a.x-b.x,i=a.y-b.y,j=d.x-a.x,k=d.y-a.y,l=h*h+i*i,m=h*k-i*j;if(Math.abs(m)>1e-10){var n=Math.sqrt(l),o=Math.sqrt(j*j+k*k),p=b.x-i/n,q=b.y+h/n,r=d.x-k/o,s=d.y+j/o,t=((r-p)*k-(s-q)*j)/(h*k-i*j);e=p+h*t-a.x,f=q+i*t-a.y;var u=e*e+f*f;if(u<=2)return new c.Vector2(e,f);g=Math.sqrt(u/2)}else{var v=!1;h>1e-10?j>1e-10&&(v=!0):h<-1e-10?j<-1e-10&&(v=!0):Math.sign(i)==Math.sign(k)&&(v=!0),v?(e=-i,f=h,g=Math.sqrt(l)):(e=h,f=i,g=Math.sqrt(l/2))}return new c.Vector2(e/g,f/g)}function f(a,b){var c,d;for(U=a.length;--U>=0;){c=U,d=U-1,d<0&&(d=a.length-1);var e=0,f=u+2*r;for(e=0;e<f;e++){var g=R*e,h=R*(e+1);i(b+c+g,b+d+g,b+d+h,b+c+h,a,e,f,c,d)}}}function g(a,b,d){D.vertices.push(new c.Vector3(a,b,d))}function h(a,b,d){a+=E,b+=E,d+=E,D.faces.push(new c.Face3(a,b,d,null,null,x));var e=z.generateTopUV(D,a,b,d);D.faceVertexUvs[0].push(e)}function i(a,b,d,e,f,g,h,i,j){a+=E,b+=E,d+=E,e+=E,D.faces.push(new c.Face3(a,b,e,null,null,y)),D.faces.push(new c.Face3(b,d,e,null,null,y));var k=z.generateSideWallUV(D,a,b,d,e);D.faceVertexUvs[0].push([k[0],k[1],k[3]]),D.faceVertexUvs[0].push([k[1],k[2],k[3]])}var j,k,l,m,n,o=void 0!==b.amount?b.amount:100,p=void 0!==b.bevelThickness?b.bevelThickness:6,q=void 0!==b.bevelSize?b.bevelSize:p-2,r=void 0!==b.bevelSegments?b.bevelSegments:3,s=void 0===b.bevelEnabled||b.bevelEnabled,t=void 0!==b.curveSegments?b.curveSegments:12,u=void 0!==b.steps?b.steps:1,v=b.extrudePath,w=!1,x=b.material,y=b.extrudeMaterial,z=void 0!==b.UVGenerator?b.UVGenerator:c.ExtrudeGeometry.WorldUVGenerator;v&&(j=v.getSpacedPoints(u),w=!0,s=!1,k=void 0!==b.frames?b.frames:new c.TubeGeometry.FrenetFrames(v,u,!1),l=new c.Vector3,m=new c.Vector3,n=new c.Vector3),s||(r=0,p=0,q=0);var A,B,C,D=this,E=this.vertices.length,F=a.extractPoints(t),G=F.shape,H=F.holes,I=!c.Shape.Utils.isClockWise(G);if(I){for(G=G.reverse(),B=0,C=H.length;B<C;B++)A=H[B],c.Shape.Utils.isClockWise(A)&&(H[B]=A.reverse());I=!1}var J=c.Shape.Utils.triangulateShape(G,H),K=G;for(B=0,C=H.length;B<C;B++)A=H[B],G=G.concat(A);for(var L,M,N,O,P,Q,R=G.length,S=J.length,T=[],U=0,V=K.length,W=V-1,X=U+1;U<V;U++,W++,X++)W===V&&(W=0),X===V&&(X=0),T[U]=e(K[U],K[W],K[X]);var Y,Z=[],$=T.concat();for(B=0,C=H.length;B<C;B++){for(A=H[B],Y=[],U=0,V=A.length,W=V-1,X=U+1;U<V;U++,W++,
X++)W===V&&(W=0),X===V&&(X=0),Y[U]=e(A[U],A[W],A[X]);Z.push(Y),$=$.concat(Y)}for(L=0;L<r;L++){for(N=L/r,O=p*(1-N),M=q*Math.sin(N*Math.PI/2),U=0,V=K.length;U<V;U++)P=d(K[U],T[U],M),g(P.x,P.y,-O);for(B=0,C=H.length;B<C;B++)for(A=H[B],Y=Z[B],U=0,V=A.length;U<V;U++)P=d(A[U],Y[U],M),g(P.x,P.y,-O)}for(M=q,U=0;U<R;U++)P=s?d(G[U],$[U],M):G[U],w?(m.copy(k.normals[0]).multiplyScalar(P.x),l.copy(k.binormals[0]).multiplyScalar(P.y),n.copy(j[0]).add(m).add(l),g(n.x,n.y,n.z)):g(P.x,P.y,0);var _;for(_=1;_<=u;_++)for(U=0;U<R;U++)P=s?d(G[U],$[U],M):G[U],w?(m.copy(k.normals[_]).multiplyScalar(P.x),l.copy(k.binormals[_]).multiplyScalar(P.y),n.copy(j[_]).add(m).add(l),g(n.x,n.y,n.z)):g(P.x,P.y,o/u*_);for(L=r-1;L>=0;L--){for(N=L/r,O=p*(1-N),M=q*Math.sin(N*Math.PI/2),U=0,V=K.length;U<V;U++)P=d(K[U],T[U],M),g(P.x,P.y,o+O);for(B=0,C=H.length;B<C;B++)for(A=H[B],Y=Z[B],U=0,V=A.length;U<V;U++)P=d(A[U],Y[U],M),w?g(P.x,P.y+j[u-1].y,j[u-1].x+O):g(P.x,P.y,o+O)}!function(){if(s){var a=0,b=R*a;for(U=0;U<S;U++)Q=J[U],h(Q[2]+b,Q[1]+b,Q[0]+b);for(a=u+2*r,b=R*a,U=0;U<S;U++)Q=J[U],h(Q[0]+b,Q[1]+b,Q[2]+b)}else{for(U=0;U<S;U++)Q=J[U],h(Q[2],Q[1],Q[0]);for(U=0;U<S;U++)Q=J[U],h(Q[0]+R*u,Q[1]+R*u,Q[2]+R*u)}}(),function(){var a=0;for(f(K,a),a+=K.length,B=0,C=H.length;B<C;B++)A=H[B],f(A,a),a+=A.length}()},c.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(a,b,d,e){var f=a.vertices,g=f[b],h=f[d],i=f[e];return[new c.Vector2(g.x,g.y),new c.Vector2(h.x,h.y),new c.Vector2(i.x,i.y)]},generateSideWallUV:function(a,b,d,e,f){var g=a.vertices,h=g[b],i=g[d],j=g[e],k=g[f];return Math.abs(h.y-i.y)<.01?[new c.Vector2(h.x,1-h.z),new c.Vector2(i.x,1-i.z),new c.Vector2(j.x,1-j.z),new c.Vector2(k.x,1-k.z)]:[new c.Vector2(h.y,1-h.z),new c.Vector2(i.y,1-i.z),new c.Vector2(j.y,1-j.z),new c.Vector2(k.y,1-k.z)]}},c.ShapeGeometry=function(a,b){c.Geometry.call(this),this.type="ShapeGeometry",a instanceof Array==!1&&(a=[a]),this.addShapeList(a,b),this.computeFaceNormals()},c.ShapeGeometry.prototype=Object.create(c.Geometry.prototype),c.ShapeGeometry.prototype.constructor=c.ShapeGeometry,c.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;c<d;c++)this.addShape(a[c],b);return this},c.ShapeGeometry.prototype.addShape=function(a,b){void 0===b&&(b={});var d,e,f,g=void 0!==b.curveSegments?b.curveSegments:12,h=b.material,i=void 0===b.UVGenerator?c.ExtrudeGeometry.WorldUVGenerator:b.UVGenerator,j=this.vertices.length,k=a.extractPoints(g),l=k.shape,m=k.holes,n=!c.Shape.Utils.isClockWise(l);if(n){for(l=l.reverse(),d=0,e=m.length;d<e;d++)f=m[d],c.Shape.Utils.isClockWise(f)&&(m[d]=f.reverse());n=!1}var o=c.Shape.Utils.triangulateShape(l,m);for(d=0,e=m.length;d<e;d++)f=m[d],l=l.concat(f);var p,q,r=l.length,s=o.length;for(d=0;d<r;d++)p=l[d],this.vertices.push(new c.Vector3(p.x,p.y,0));for(d=0;d<s;d++){q=o[d];var t=q[0]+j,u=q[1]+j,v=q[2]+j;this.faces.push(new c.Face3(t,u,v,null,null,h)),this.faceVertexUvs[0].push(i.generateTopUV(this,t,u,v))}},c.LatheGeometry=function(a,b,d,e){c.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:a,segments:b,phiStart:d,phiLength:e},b=b||12,d=d||0,e=e||2*Math.PI;for(var f=1/(a.length-1),g=1/b,h=0,i=b;h<=i;h++)for(var j=d+h*g*e,k=Math.cos(j),l=Math.sin(j),m=0,n=a.length;m<n;m++){var o=a[m],p=new c.Vector3;p.x=k*o.x-l*o.y,p.y=l*o.x+k*o.y,p.z=o.z,this.vertices.push(p)}for(var q=a.length,h=0,i=b;h<i;h++)for(var m=0,n=a.length-1;m<n;m++){var r=m+q*h,s=r,t=r+q,k=r+1+q,u=r+1,v=h*g,w=m*f,x=v+g,y=w+f;this.faces.push(new c.Face3(s,t,u)),this.faceVertexUvs[0].push([new c.Vector2(v,w),new c.Vector2(x,w),new c.Vector2(v,y)]),this.faces.push(new c.Face3(t,k,u)),this.faceVertexUvs[0].push([new c.Vector2(x,w),new c.Vector2(x,y),new c.Vector2(v,y)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},c.LatheGeometry.prototype=Object.create(c.Geometry.prototype),c.LatheGeometry.prototype.constructor=c.LatheGeometry,c.PlaneGeometry=function(a,b,d,e){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint."),c.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:a,height:b,widthSegments:d,heightSegments:e},this.fromBufferGeometry(new c.PlaneBufferGeometry(a,b,d,e))},c.PlaneGeometry.prototype=Object.create(c.Geometry.prototype),c.PlaneGeometry.prototype.constructor=c.PlaneGeometry,c.PlaneBufferGeometry=function(a,b,d,e){c.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:a,height:b,widthSegments:d,heightSegments:e};for(var f=a/2,g=b/2,h=d||1,i=e||1,j=h+1,k=i+1,l=a/h,m=b/i,n=new Float32Array(j*k*3),o=new Float32Array(j*k*3),p=new Float32Array(j*k*2),q=0,r=0,s=0;s<k;s++)for(var t=s*m-g,u=0;u<j;u++){var v=u*l-f;n[q]=v,n[q+1]=-t,o[q+2]=1,p[r]=u/h,p[r+1]=1-s/i,q+=3,r+=2}q=0;for(var w=new(n.length/3>65535?Uint32Array:Uint16Array)(h*i*6),s=0;s<i;s++)for(var u=0;u<h;u++){var x=u+j*s,y=u+j*(s+1),z=u+1+j*(s+1),A=u+1+j*s;w[q]=x,w[q+1]=y,w[q+2]=A,w[q+3]=y,w[q+4]=z,w[q+5]=A,q+=6}this.addAttribute("index",new c.BufferAttribute(w,1)),this.addAttribute("position",new c.BufferAttribute(n,3)),this.addAttribute("normal",new c.BufferAttribute(o,3)),this.addAttribute("uv",new c.BufferAttribute(p,2))},c.PlaneBufferGeometry.prototype=Object.create(c.BufferGeometry.prototype),c.PlaneBufferGeometry.prototype.constructor=c.PlaneBufferGeometry,c.RingGeometry=function(a,b,d,e,f,g){c.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:a,outerRadius:b,thetaSegments:d,phiSegments:e,thetaStart:f,thetaLength:g},a=a||0,b=b||50,f=void 0!==f?f:0,g=void 0!==g?g:2*Math.PI,d=void 0!==d?Math.max(3,d):8,e=void 0!==e?Math.max(1,e):8;var h,i,j=[],k=a,l=(b-a)/e;for(h=0;h<e+1;h++){for(i=0;i<d+1;i++){var m=new c.Vector3,n=f+i/d*g;m.x=k*Math.cos(n),m.y=k*Math.sin(n),this.vertices.push(m),j.push(new c.Vector2((m.x/b+1)/2,(m.y/b+1)/2))}k+=l}var o=new c.Vector3(0,0,1);for(h=0;h<e;h++){var p=h*(d+1);for(i=0;i<d;i++){var n=i+p,q=n,r=n+d+1,s=n+d+2;this.faces.push(new c.Face3(q,r,s,[o.clone(),o.clone(),o.clone()])),this.faceVertexUvs[0].push([j[q].clone(),j[r].clone(),j[s].clone()]),q=n,r=n+d+2,s=n+1,this.faces.push(new c.Face3(q,r,s,[o.clone(),o.clone(),o.clone()])),this.faceVertexUvs[0].push([j[q].clone(),j[r].clone(),j[s].clone()])}}this.computeFaceNormals(),this.boundingSphere=new c.Sphere(new c.Vector3,k)},c.RingGeometry.prototype=Object.create(c.Geometry.prototype),c.RingGeometry.prototype.constructor=c.RingGeometry,c.SphereGeometry=function(a,b,d,e,f,g,h){c.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:a,widthSegments:b,heightSegments:d,phiStart:e,phiLength:f,thetaStart:g,thetaLength:h},a=a||50,b=Math.max(3,Math.floor(b)||8),d=Math.max(2,Math.floor(d)||6),e=void 0!==e?e:0,f=void 0!==f?f:2*Math.PI,g=void 0!==g?g:0,h=void 0!==h?h:Math.PI;var i,j,k=[],l=[];for(j=0;j<=d;j++){var m=[],n=[];for(i=0;i<=b;i++){var o=i/b,p=j/d,q=new c.Vector3;q.x=-a*Math.cos(e+o*f)*Math.sin(g+p*h),q.y=a*Math.cos(g+p*h),q.z=a*Math.sin(e+o*f)*Math.sin(g+p*h),this.vertices.push(q),m.push(this.vertices.length-1),n.push(new c.Vector2(o,1-p))}k.push(m),l.push(n)}for(j=0;j<d;j++)for(i=0;i<b;i++){var r=k[j][i+1],s=k[j][i],t=k[j+1][i],u=k[j+1][i+1],v=this.vertices[r].clone().normalize(),w=this.vertices[s].clone().normalize(),x=this.vertices[t].clone().normalize(),y=this.vertices[u].clone().normalize(),z=l[j][i+1].clone(),A=l[j][i].clone(),B=l[j+1][i].clone(),C=l[j+1][i+1].clone();Math.abs(this.vertices[r].y)===a?(z.x=(z.x+A.x)/2,this.faces.push(new c.Face3(r,t,u,[v,x,y])),this.faceVertexUvs[0].push([z,B,C])):Math.abs(this.vertices[t].y)===a?(B.x=(B.x+C.x)/2,this.faces.push(new c.Face3(r,s,t,[v,w,x])),this.faceVertexUvs[0].push([z,A,B])):(this.faces.push(new c.Face3(r,s,u,[v,w,y])),this.faceVertexUvs[0].push([z,A,C]),this.faces.push(new c.Face3(s,t,u,[w.clone(),x,y.clone()])),this.faceVertexUvs[0].push([A.clone(),B,C.clone()]))}this.computeFaceNormals(),this.boundingSphere=new c.Sphere(new c.Vector3,a)},c.SphereGeometry.prototype=Object.create(c.Geometry.prototype),c.SphereGeometry.prototype.constructor=c.SphereGeometry,c.TextGeometry=function(a,b){b=b||{};var d=c.FontUtils.generateShapes(a,b);b.amount=void 0!==b.height?b.height:50,void 0===b.bevelThickness&&(b.bevelThickness=10),void 0===b.bevelSize&&(b.bevelSize=8),void 0===b.bevelEnabled&&(b.bevelEnabled=!1),c.ExtrudeGeometry.call(this,d,b),this.type="TextGeometry"},c.TextGeometry.prototype=Object.create(c.ExtrudeGeometry.prototype),c.TextGeometry.prototype.constructor=c.TextGeometry,c.TorusGeometry=function(a,b,d,e,f){c.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:a,tube:b,radialSegments:d,tubularSegments:e,arc:f},a=a||100,b=b||40,d=d||8,e=e||6,f=f||2*Math.PI;for(var g=new c.Vector3,h=[],i=[],j=0;j<=d;j++)for(var k=0;k<=e;k++){var l=k/e*f,m=j/d*Math.PI*2;g.x=a*Math.cos(l),g.y=a*Math.sin(l);var n=new c.Vector3;n.x=(a+b*Math.cos(m))*Math.cos(l),n.y=(a+b*Math.cos(m))*Math.sin(l),n.z=b*Math.sin(m),this.vertices.push(n),h.push(new c.Vector2(k/e,j/d)),i.push(n.clone().sub(g).normalize())}for(var j=1;j<=d;j++)for(var k=1;k<=e;k++){var o=(e+1)*j+k-1,p=(e+1)*(j-1)+k-1,q=(e+1)*(j-1)+k,r=(e+1)*j+k,s=new c.Face3(o,p,r,[i[o].clone(),i[p].clone(),i[r].clone()]);this.faces.push(s),this.faceVertexUvs[0].push([h[o].clone(),h[p].clone(),h[r].clone()]),s=new c.Face3(p,q,r,[i[p].clone(),i[q].clone(),i[r].clone()]),this.faces.push(s),this.faceVertexUvs[0].push([h[p].clone(),h[q].clone(),h[r].clone()])}this.computeFaceNormals()},c.TorusGeometry.prototype=Object.create(c.Geometry.prototype),c.TorusGeometry.prototype.constructor=c.TorusGeometry,c.TorusKnotGeometry=function(a,b,d,e,f,g,h){function i(a,b,d,e,f){var g=Math.cos(a),h=Math.sin(a),i=b/d*a,j=Math.cos(i),k=e*(2+j)*.5*g,l=e*(2+j)*h*.5,m=f*e*Math.sin(i)*.5;return new c.Vector3(k,l,m)}c.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:a,tube:b,radialSegments:d,tubularSegments:e,p:f,q:g,heightScale:h},a=a||100,b=b||40,d=d||64,e=e||8,f=f||2,g=g||3,h=h||1;for(var j=new Array(d),k=new c.Vector3,l=new c.Vector3,m=new c.Vector3,n=0;n<d;++n){j[n]=new Array(e);var o=n/d*2*f*Math.PI,p=i(o,g,f,a,h),q=i(o+.01,g,f,a,h);k.subVectors(q,p),l.addVectors(q,p),m.crossVectors(k,l),l.crossVectors(m,k),m.normalize(),l.normalize();for(var r=0;r<e;++r){var s=r/e*2*Math.PI,t=-b*Math.cos(s),u=b*Math.sin(s),v=new c.Vector3;v.x=p.x+t*l.x+u*m.x,v.y=p.y+t*l.y+u*m.y,v.z=p.z+t*l.z+u*m.z,j[n][r]=this.vertices.push(v)-1}}for(var n=0;n<d;++n)for(var r=0;r<e;++r){var w=(n+1)%d,x=(r+1)%e,y=j[n][r],z=j[w][r],A=j[w][x],B=j[n][x],C=new c.Vector2(n/d,r/e),D=new c.Vector2((n+1)/d,r/e),E=new c.Vector2((n+1)/d,(r+1)/e),F=new c.Vector2(n/d,(r+1)/e);this.faces.push(new c.Face3(y,z,B)),this.faceVertexUvs[0].push([C,D,F]),this.faces.push(new c.Face3(z,A,B)),this.faceVertexUvs[0].push([D.clone(),E,F.clone()])}this.computeFaceNormals(),this.computeVertexNormals()},c.TorusKnotGeometry.prototype=Object.create(c.Geometry.prototype),c.TorusKnotGeometry.prototype.constructor=c.TorusKnotGeometry,c.TubeGeometry=function(a,b,d,e,f,g){c.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:a,segments:b,radius:d,radialSegments:e,closed:f},b=b||64,d=d||1,e=e||8,f=f||!1,g=g||c.TubeGeometry.NoTaper;var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=[],C=this,D=b+1,E=new c.Vector3,F=new c.TubeGeometry.FrenetFrames(a,b,f),G=F.tangents,H=F.normals,I=F.binormals;for(this.tangents=G,this.normals=H,this.binormals=I,p=0;p<D;p++)for(B[p]=[],j=p/(D-1),o=a.getPointAt(j),G[p],h=H[p],i=I[p],l=d*g(j),q=0;q<e;q++)k=q/e*2*Math.PI,m=-l*Math.cos(k),n=l*Math.sin(k),E.copy(o),E.x+=m*h.x+n*i.x,E.y+=m*h.y+n*i.y,E.z+=m*h.z+n*i.z,B[p][q]=function(a,b,d){return C.vertices.push(new c.Vector3(a,b,d))-1}(E.x,E.y,E.z);for(p=0;p<b;p++)for(q=0;q<e;q++)r=f?(p+1)%b:p+1,s=(q+1)%e,t=B[p][q],u=B[r][q],v=B[r][s],w=B[p][s],x=new c.Vector2(p/b,q/e),y=new c.Vector2((p+1)/b,q/e),z=new c.Vector2((p+1)/b,(q+1)/e),A=new c.Vector2(p/b,(q+1)/e),this.faces.push(new c.Face3(t,u,w)),this.faceVertexUvs[0].push([x,y,A]),this.faces.push(new c.Face3(u,v,w)),this.faceVertexUvs[0].push([y.clone(),z,A.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},c.TubeGeometry.prototype=Object.create(c.Geometry.prototype),c.TubeGeometry.prototype.constructor=c.TubeGeometry,c.TubeGeometry.NoTaper=function(a){return 1},c.TubeGeometry.SinusoidalTaper=function(a){return Math.sin(Math.PI*a)},c.TubeGeometry.FrenetFrames=function(a,b,d){var e,f,g,h,i,j,k,l=new c.Vector3,m=[],n=[],o=[],p=new c.Vector3,q=new c.Matrix4,r=b+1;for(this.tangents=m,this.normals=n,this.binormals=o,j=0;j<r;j++)k=j/(r-1),m[j]=a.getTangentAt(k),m[j].normalize();for(function(){n[0]=new c.Vector3,o[0]=new c.Vector3,f=Number.MAX_VALUE,g=Math.abs(m[0].x),h=Math.abs(m[0].y),i=Math.abs(m[0].z),g<=f&&(f=g,l.set(1,0,0)),h<=f&&(f=h,l.set(0,1,0)),i<=f&&l.set(0,0,1),p.crossVectors(m[0],l).normalize(),n[0].crossVectors(m[0],p),o[0].crossVectors(m[0],n[0])}(),j=1;j<r;j++)n[j]=n[j-1].clone(),o[j]=o[j-1].clone(),p.crossVectors(m[j-1],m[j]),p.length()>1e-4&&(p.normalize(),e=Math.acos(c.Math.clamp(m[j-1].dot(m[j]),-1,1)),n[j].applyMatrix4(q.makeRotationAxis(p,e))),o[j].crossVectors(m[j],n[j]);if(d)for(e=Math.acos(c.Math.clamp(n[0].dot(n[r-1]),-1,1)),e/=r-1,m[0].dot(p.crossVectors(n[0],n[r-1]))>0&&(e=-e),j=1;j<r;j++)n[j].applyMatrix4(q.makeRotationAxis(m[j],e*j)),o[j].crossVectors(m[j],n[j])},c.PolyhedronGeometry=function(a,b,d,e){function f(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var d=h(a)/2/Math.PI+.5,e=i(a)/Math.PI+.5;return b.uv=new c.Vector2(d,1-e),b}function g(a,b,d){var e=new c.Face3(a.index,b.index,d.index,[a.clone(),b.clone(),d.clone()]);k.faces.push(e),t.copy(a).add(b).add(d).divideScalar(3);var f=h(t);k.faceVertexUvs[0].push([j(a.uv,a,f),j(b.uv,b,f),j(d.uv,d,f)])}function h(a){return Math.atan2(a.z,-a.x)}function i(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}function j(a,b,d){return d<0&&1===a.x&&(a=new c.Vector2(a.x-1,a.y)),0===b.x&&0===b.z&&(a=new c.Vector2(d/2/Math.PI+.5,a.y)),a.clone()}c.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:a,indices:b,radius:d,detail:e},d=d||1,e=e||0;for(var k=this,l=0,m=a.length;l<m;l+=3)f(new c.Vector3(a[l],a[l+1],a[l+2]));for(var n=this.vertices,o=[],l=0,p=0,m=b.length;l<m;l+=3,p++){var q=n[b[l]],r=n[b[l+1]],s=n[b[l+2]];o[p]=new c.Face3(q.index,r.index,s.index,[q.clone(),r.clone(),s.clone()])}for(var t=new c.Vector3,l=0,m=o.length;l<m;l++)!function(a,b){for(var c=Math.pow(2,b),d=f(k.vertices[a.a]),e=f(k.vertices[a.b]),h=f(k.vertices[a.c]),i=[],j=0;j<=c;j++){i[j]=[];for(var l=f(d.clone().lerp(h,j/c)),m=f(e.clone().lerp(h,j/c)),n=c-j,o=0;o<=n;o++)i[j][o]=0==o&&j==c?l:f(l.clone().lerp(m,o/n))}for(var j=0;j<c;j++)for(var o=0;o<2*(c-j)-1;o++){var p=Math.floor(o/2);o%2==0?g(i[j][p+1],i[j+1][p],i[j][p]):g(i[j][p+1],i[j+1][p+1],i[j+1][p])}}(o[l],e);for(var l=0,m=this.faceVertexUvs[0].length;l<m;l++){var u=this.faceVertexUvs[0][l],v=u[0].x,w=u[1].x,x=u[2].x,y=Math.max(v,Math.max(w,x)),z=Math.min(v,Math.min(w,x));y>.9&&z<.1&&(v<.2&&(u[0].x+=1),w<.2&&(u[1].x+=1),x<.2&&(u[2].x+=1))}for(var l=0,m=this.vertices.length;l<m;l++)this.vertices[l].multiplyScalar(d);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new c.Sphere(new c.Vector3,d)},c.PolyhedronGeometry.prototype=Object.create(c.Geometry.prototype),c.PolyhedronGeometry.prototype.constructor=c.PolyhedronGeometry,c.DodecahedronGeometry=function(a,b){this.parameters={radius:a,detail:b};var d=(1+Math.sqrt(5))/2,e=1/d,f=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-e,-d,0,-e,d,0,e,-d,0,e,d,-e,-d,0,-e,d,0,e,-d,0,e,d,0,-d,0,-e,d,0,-e,-d,0,e,d,0,e],g=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];c.PolyhedronGeometry.call(this,f,g,a,b)},c.DodecahedronGeometry.prototype=Object.create(c.Geometry.prototype),c.DodecahedronGeometry.prototype.constructor=c.DodecahedronGeometry,c.IcosahedronGeometry=function(a,b){var d=(1+Math.sqrt(5))/2,e=[-1,d,0,1,d,0,-1,-d,0,1,-d,0,0,-1,d,0,1,d,0,-1,-d,0,1,-d,d,0,-1,d,0,1,-d,0,-1,-d,0,1],f=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];c.PolyhedronGeometry.call(this,e,f,a,b),this.type="IcosahedronGeometry",this.parameters={radius:a,detail:b}},c.IcosahedronGeometry.prototype=Object.create(c.Geometry.prototype),c.IcosahedronGeometry.prototype.constructor=c.IcosahedronGeometry,c.OctahedronGeometry=function(a,b){this.parameters={radius:a,detail:b};var d=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],e=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];c.PolyhedronGeometry.call(this,d,e,a,b),this.type="OctahedronGeometry",this.parameters={radius:a,detail:b}},c.OctahedronGeometry.prototype=Object.create(c.Geometry.prototype),c.OctahedronGeometry.prototype.constructor=c.OctahedronGeometry,c.TetrahedronGeometry=function(a,b){var d=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],e=[2,1,0,0,3,2,1,3,0,2,3,1];c.PolyhedronGeometry.call(this,d,e,a,b),this.type="TetrahedronGeometry",this.parameters={radius:a,detail:b}},c.TetrahedronGeometry.prototype=Object.create(c.Geometry.prototype),c.TetrahedronGeometry.prototype.constructor=c.TetrahedronGeometry,c.ParametricGeometry=function(a,b,d){c.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:a,slices:b,stacks:d};var e,f,g,h,i,j=this.vertices,k=this.faces,l=this.faceVertexUvs[0],m=b+1;for(e=0;e<=d;e++)for(i=e/d,f=0;f<=b;f++)h=f/b,g=a(h,i),j.push(g);var n,o,p,q,r,s,t,u;for(e=0;e<d;e++)for(f=0;f<b;f++)n=e*m+f,o=e*m+f+1,p=(e+1)*m+f+1,q=(e+1)*m+f,r=new c.Vector2(f/b,e/d),s=new c.Vector2((f+1)/b,e/d),t=new c.Vector2((f+1)/b,(e+1)/d),u=new c.Vector2(f/b,(e+1)/d),k.push(new c.Face3(n,o,q)),l.push([r,s,u]),k.push(new c.Face3(o,p,q)),l.push([s.clone(),t,u.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},c.ParametricGeometry.prototype=Object.create(c.Geometry.prototype),c.ParametricGeometry.prototype.constructor=c.ParametricGeometry,c.AxisHelper=function(a){a=a||1;var b=new Float32Array([0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a]),d=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),e=new c.BufferGeometry;e.addAttribute("position",new c.BufferAttribute(b,3)),e.addAttribute("color",new c.BufferAttribute(d,3));var f=new c.LineBasicMaterial({vertexColors:c.VertexColors});c.Line.call(this,e,f,c.LinePieces)},c.AxisHelper.prototype=Object.create(c.Line.prototype),c.AxisHelper.prototype.constructor=c.AxisHelper,c.ArrowHelper=function(){var a=new c.Geometry;a.vertices.push(new c.Vector3(0,0,0),new c.Vector3(0,1,0));var b=new c.CylinderGeometry(0,.5,1,5,1);return b.applyMatrix((new c.Matrix4).makeTranslation(0,-.5,0)),function(d,e,f,g,h,i){c.Object3D.call(this),void 0===g&&(g=16776960),void 0===f&&(f=1),void 0===h&&(h=.2*f),void 0===i&&(i=.2*h),this.position.copy(e),this.line=new c.Line(a,new c.LineBasicMaterial({color:g})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new c.Mesh(b,new c.MeshBasicMaterial({color:g})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(d),this.setLength(f,h,i)}}(),c.ArrowHelper.prototype=Object.create(c.Object3D.prototype),c.ArrowHelper.prototype.constructor=c.ArrowHelper,c.ArrowHelper.prototype.setDirection=function(){var a,b=new c.Vector3;return function(c){c.y>.99999?this.quaternion.set(0,0,0,1):c.y<-.99999?this.quaternion.set(1,0,0,0):(b.set(c.z,0,-c.x).normalize(),a=Math.acos(c.y),this.quaternion.setFromAxisAngle(b,a))}}(),c.ArrowHelper.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a),void 0===c&&(c=.2*b),this.line.scale.set(1,a-b,1),this.line.updateMatrix(),this.cone.scale.set(c,b,c),this.cone.position.y=a,this.cone.updateMatrix()},c.ArrowHelper.prototype.setColor=function(a){this.line.material.color.set(a),this.cone.material.color.set(a)},c.BoxHelper=function(a){var b=new c.BufferGeometry;b.addAttribute("position",new c.BufferAttribute(new Float32Array(72),3)),c.Line.call(this,b,new c.LineBasicMaterial({color:16776960}),c.LinePieces),void 0!==a&&this.update(a)},c.BoxHelper.prototype=Object.create(c.Line.prototype),c.BoxHelper.prototype.constructor=c.BoxHelper,c.BoxHelper.prototype.update=function(a){var b=a.geometry;null===b.boundingBox&&b.computeBoundingBox();var c=b.boundingBox.min,d=b.boundingBox.max,e=this.geometry.attributes.position.array;e[0]=d.x,e[1]=d.y,e[2]=d.z,e[3]=c.x,e[4]=d.y,e[5]=d.z,e[6]=c.x,e[7]=d.y,e[8]=d.z,e[9]=c.x,e[10]=c.y,e[11]=d.z,e[12]=c.x,e[13]=c.y,e[14]=d.z,e[15]=d.x,e[16]=c.y,e[17]=d.z,e[18]=d.x,e[19]=c.y,e[20]=d.z,e[21]=d.x,e[22]=d.y,e[23]=d.z,e[24]=d.x,e[25]=d.y,e[26]=c.z,e[27]=c.x,e[28]=d.y,e[29]=c.z,e[30]=c.x,e[31]=d.y,e[32]=c.z,e[33]=c.x,e[34]=c.y,e[35]=c.z,e[36]=c.x,e[37]=c.y,e[38]=c.z,e[39]=d.x,e[40]=c.y,e[41]=c.z,e[42]=d.x,e[43]=c.y,e[44]=c.z,e[45]=d.x,e[46]=d.y,e[47]=c.z,e[48]=d.x,e[49]=d.y,e[50]=d.z,e[51]=d.x,e[52]=d.y,e[53]=c.z,e[54]=c.x,e[55]=d.y,e[56]=d.z,e[57]=c.x,e[58]=d.y,e[59]=c.z,e[60]=c.x,e[61]=c.y,e[62]=d.z,e[63]=c.x,e[64]=c.y,e[65]=c.z,e[66]=d.x,e[67]=c.y,e[68]=d.z,e[69]=d.x,e[70]=c.y,e[71]=c.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1},c.BoundingBoxHelper=function(a,b){var d=void 0!==b?b:8947848;this.object=a,this.box=new c.Box3,c.Mesh.call(this,new c.BoxGeometry(1,1,1),new c.MeshBasicMaterial({color:d,wireframe:!0}))},c.BoundingBoxHelper.prototype=Object.create(c.Mesh.prototype),c.BoundingBoxHelper.prototype.constructor=c.BoundingBoxHelper,c.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},c.CameraHelper=function(a){function b(a,b,c){d(a,c),d(b,c)}function d(a,b){e.vertices.push(new c.Vector3),e.colors.push(new c.Color(b)),void 0===g[a]&&(g[a]=[]),g[a].push(e.vertices.length-1)}var e=new c.Geometry,f=new c.LineBasicMaterial({color:16777215,vertexColors:c.FaceColors}),g={};b("n1","n2",16755200),b("n2","n4",16755200),b("n4","n3",16755200),b("n3","n1",16755200),b("f1","f2",16755200),b("f2","f4",16755200),b("f4","f3",16755200),b("f3","f1",16755200),b("n1","f1",16755200),b("n2","f2",16755200),b("n3","f3",16755200),b("n4","f4",16755200),b("p","n1",16711680),b("p","n2",16711680),b("p","n3",16711680),b("p","n4",16711680),b("u1","u2",43775),b("u2","u3",43775),b("u3","u1",43775),b("c","t",16777215),b("p","c",3355443),b("cn1","cn2",3355443),b("cn3","cn4",3355443),b("cf1","cf2",3355443),b("cf3","cf4",3355443),c.Line.call(this,e,f,c.LinePieces),this.camera=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=g,this.update()},c.CameraHelper.prototype=Object.create(c.Line.prototype),c.CameraHelper.prototype.constructor=c.CameraHelper,c.CameraHelper.prototype.update=function(){var a,b,d=new c.Vector3,e=new c.Camera,f=function(c,f,g,h){d.set(f,g,h).unproject(e);var i=b[c];if(void 0!==i)for(var j=0,k=i.length;j<k;j++)a.vertices[i[j]].copy(d)};return function(){a=this.geometry,b=this.pointMap;e.projectionMatrix.copy(this.camera.projectionMatrix),f("c",0,0,-1),f("t",0,0,1),f("n1",-1,-1,-1),f("n2",1,-1,-1),f("n3",-1,1,-1),f("n4",1,1,-1),f("f1",-1,-1,1),f("f2",1,-1,1),f("f3",-1,1,1),f("f4",1,1,1),f("u1",.7,1.1,-1),f("u2",-.7,1.1,-1),f("u3",0,2,-1),f("cf1",-1,0,1),f("cf2",1,0,1),f("cf3",0,-1,1),f("cf4",0,1,1),f("cn1",-1,0,-1),f("cn2",1,0,-1),f("cn3",0,-1,-1),f("cn4",0,1,-1),a.verticesNeedUpdate=!0}}(),c.DirectionalLightHelper=function(a,b){c.Object3D.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,b=b||1;var d=new c.Geometry;d.vertices.push(new c.Vector3(-b,b,0),new c.Vector3(b,b,0),new c.Vector3(b,-b,0),new c.Vector3(-b,-b,0),new c.Vector3(-b,b,0));var e=new c.LineBasicMaterial({fog:!1});e.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new c.Line(d,e),this.add(this.lightPlane),d=new c.Geometry,d.vertices.push(new c.Vector3,new c.Vector3),e=new c.LineBasicMaterial({fog:!1}),e.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new c.Line(d,e),this.add(this.targetLine),this.update()},c.DirectionalLightHelper.prototype=Object.create(c.Object3D.prototype),c.DirectionalLightHelper.prototype.constructor=c.DirectionalLightHelper,c.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},c.DirectionalLightHelper.prototype.update=function(){var a=new c.Vector3,b=new c.Vector3,d=new c.Vector3;return function(){a.setFromMatrixPosition(this.light.matrixWorld),b.setFromMatrixPosition(this.light.target.matrixWorld),d.subVectors(b,a),this.lightPlane.lookAt(d),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(d),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),c.EdgesHelper=function(a,b,d){var e=void 0!==b?b:16777215;d=void 0!==d?d:1;var f,g=Math.cos(c.Math.degToRad(d)),h=[0,0],i={},j=function(a,b){return a-b},k=["a","b","c"],l=new c.BufferGeometry;a.geometry instanceof c.BufferGeometry?(f=new c.Geometry,f.fromBufferGeometry(a.geometry)):f=a.geometry.clone(),f.mergeVertices(),f.computeFaceNormals();for(var m=f.vertices,n=f.faces,o=0,p=0,q=n.length;p<q;p++)for(var r=n[p],s=0;s<3;s++){h[0]=r[k[s]],h[1]=r[k[(s+1)%3]],h.sort(j);var t=h.toString();void 0===i[t]?(i[t]={vert1:h[0],vert2:h[1],face1:p,face2:void 0},o++):i[t].face2=p}var u=new Float32Array(2*o*3),v=0;for(var t in i){var w=i[t];if(void 0===w.face2||n[w.face1].normal.dot(n[w.face2].normal)<=g){var x=m[w.vert1];u[v++]=x.x,u[v++]=x.y,u[v++]=x.z,x=m[w.vert2],u[v++]=x.x,u[v++]=x.y,u[v++]=x.z}}l.addAttribute("position",new c.BufferAttribute(u,3)),c.Line.call(this,l,new c.LineBasicMaterial({color:e}),c.LinePieces),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1},c.EdgesHelper.prototype=Object.create(c.Line.prototype),c.EdgesHelper.prototype.constructor=c.EdgesHelper,c.FaceNormalsHelper=function(a,b,d,e){this.object=a,this.size=void 0!==b?b:1;for(var f=void 0!==d?d:16776960,g=void 0!==e?e:1,h=new c.Geometry,i=this.object.geometry.faces,j=0,k=i.length;j<k;j++)h.vertices.push(new c.Vector3,new c.Vector3);c.Line.call(this,h,new c.LineBasicMaterial({color:f,linewidth:g}),c.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new c.Matrix3,this.update()},c.FaceNormalsHelper.prototype=Object.create(c.Line.prototype),c.FaceNormalsHelper.prototype.constructor=c.FaceNormalsHelper,c.FaceNormalsHelper.prototype.update=function(){var a=this.geometry.vertices,b=this.object,c=b.geometry.vertices,d=b.geometry.faces,e=b.matrixWorld;b.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(e);for(var f=0,g=0,h=d.length;f<h;f++,g+=2){var i=d[f];a[g].copy(c[i.a]).add(c[i.b]).add(c[i.c]).divideScalar(3).applyMatrix4(e),a[g+1].copy(i.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(a[g])}return this.geometry.verticesNeedUpdate=!0,this},c.GridHelper=function(a,b){var d=new c.Geometry,e=new c.LineBasicMaterial({vertexColors:c.VertexColors});this.color1=new c.Color(4473924),this.color2=new c.Color(8947848);for(var f=-a;f<=a;f+=b){d.vertices.push(new c.Vector3(-a,0,f),new c.Vector3(a,0,f),new c.Vector3(f,0,-a),new c.Vector3(f,0,a));var g=0===f?this.color1:this.color2;d.colors.push(g,g,g,g)}c.Line.call(this,d,e,c.LinePieces)},c.GridHelper.prototype=Object.create(c.Line.prototype),c.GridHelper.prototype.constructor=c.GridHelper,c.GridHelper.prototype.setColors=function(a,b){this.color1.set(a),this.color2.set(b),this.geometry.colorsNeedUpdate=!0},c.HemisphereLightHelper=function(a,b){c.Object3D.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new c.Color,new c.Color];var d=new c.SphereGeometry(b,4,2);d.applyMatrix((new c.Matrix4).makeRotationX(-Math.PI/2));for(var e=0;e<8;e++)d.faces[e].color=this.colors[e<4?0:1];var f=new c.MeshBasicMaterial({vertexColors:c.FaceColors,wireframe:!0});this.lightSphere=new c.Mesh(d,f),this.add(this.lightSphere),this.update()},c.HemisphereLightHelper.prototype=Object.create(c.Object3D.prototype),c.HemisphereLightHelper.prototype.constructor=c.HemisphereLightHelper,c.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},c.HemisphereLightHelper.prototype.update=function(){var a=new c.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),c.PointLightHelper=function(a,b){this.light=a,this.light.updateMatrixWorld();var d=new c.SphereGeometry(b,4,2),e=new c.MeshBasicMaterial({wireframe:!0,fog:!1});e.color.copy(this.light.color).multiplyScalar(this.light.intensity),c.Mesh.call(this,d,e),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},c.PointLightHelper.prototype=Object.create(c.Mesh.prototype),c.PointLightHelper.prototype.constructor=c.PointLightHelper,c.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},c.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},c.SkeletonHelper=function(a){this.bones=this.getBoneList(a);for(var b=new c.Geometry,d=0;d<this.bones.length;d++){this.bones[d].parent instanceof c.Bone&&(b.vertices.push(new c.Vector3),b.vertices.push(new c.Vector3),b.colors.push(new c.Color(0,0,1)),b.colors.push(new c.Color(0,1,0)))}var e=new c.LineBasicMaterial({vertexColors:c.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});c.Line.call(this,b,e,c.LinePieces),this.root=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.update()},c.SkeletonHelper.prototype=Object.create(c.Line.prototype),c.SkeletonHelper.prototype.constructor=c.SkeletonHelper,c.SkeletonHelper.prototype.getBoneList=function(a){var b=[];a instanceof c.Bone&&b.push(a);for(var d=0;d<a.children.length;d++)b.push.apply(b,this.getBoneList(a.children[d]));return b},c.SkeletonHelper.prototype.update=function(){for(var a=this.geometry,b=(new c.Matrix4).getInverse(this.root.matrixWorld),d=new c.Matrix4,e=0,f=0;f<this.bones.length;f++){var g=this.bones[f];g.parent instanceof c.Bone&&(d.multiplyMatrices(b,g.matrixWorld),a.vertices[e].setFromMatrixPosition(d),d.multiplyMatrices(b,g.parent.matrixWorld),a.vertices[e+1].setFromMatrixPosition(d),e+=2)}a.verticesNeedUpdate=!0,a.computeBoundingSphere()},c.SpotLightHelper=function(a){c.Object3D.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1;var b=new c.CylinderGeometry(0,1,1,8,1,!0);b.applyMatrix((new c.Matrix4).makeTranslation(0,-.5,0)),b.applyMatrix((new c.Matrix4).makeRotationX(-Math.PI/2));var d=new c.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new c.Mesh(b,d),this.add(this.cone),this.update()},c.SpotLightHelper.prototype=Object.create(c.Object3D.prototype),c.SpotLightHelper.prototype.constructor=c.SpotLightHelper,c.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},c.SpotLightHelper.prototype.update=function(){var a=new c.Vector3,b=new c.Vector3;return function(){var c=this.light.distance?this.light.distance:1e4,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c),a.setFromMatrixPosition(this.light.matrixWorld),b.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(b.sub(a)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),c.VertexNormalsHelper=function(a,b,d,e){this.object=a,this.size=void 0!==b?b:1
;for(var f=void 0!==d?d:16711680,g=void 0!==e?e:1,h=new c.Geometry,i=a.geometry.faces,j=0,k=i.length;j<k;j++)for(var l=i[j],m=0,n=l.vertexNormals.length;m<n;m++)h.vertices.push(new c.Vector3,new c.Vector3);c.Line.call(this,h,new c.LineBasicMaterial({color:f,linewidth:g}),c.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new c.Matrix3,this.update()},c.VertexNormalsHelper.prototype=Object.create(c.Line.prototype),c.VertexNormalsHelper.prototype.constructor=c.VertexNormalsHelper,c.VertexNormalsHelper.prototype.update=function(a){var b=new c.Vector3;return function(a){var c=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var d=this.geometry.vertices,e=this.object.geometry.vertices,f=this.object.geometry.faces,g=this.object.matrixWorld,h=0,i=0,j=f.length;i<j;i++)for(var k=f[i],l=0,m=k.vertexNormals.length;l<m;l++){var n=k[c[l]],o=e[n],p=k.vertexNormals[l];d[h].copy(o).applyMatrix4(g),b.copy(p).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),b.add(d[h]),h+=1,d[h].copy(b),h+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),c.VertexTangentsHelper=function(a,b,d,e){this.object=a,this.size=void 0!==b?b:1;for(var f=void 0!==d?d:255,g=void 0!==e?e:1,h=new c.Geometry,i=a.geometry.faces,j=0,k=i.length;j<k;j++)for(var l=i[j],m=0,n=l.vertexTangents.length;m<n;m++)h.vertices.push(new c.Vector3),h.vertices.push(new c.Vector3);c.Line.call(this,h,new c.LineBasicMaterial({color:f,linewidth:g}),c.LinePieces),this.matrixAutoUpdate=!1,this.update()},c.VertexTangentsHelper.prototype=Object.create(c.Line.prototype),c.VertexTangentsHelper.prototype.constructor=c.VertexTangentsHelper,c.VertexTangentsHelper.prototype.update=function(a){var b=new c.Vector3;return function(a){var c=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var d=this.geometry.vertices,e=this.object.geometry.vertices,f=this.object.geometry.faces,g=this.object.matrixWorld,h=0,i=0,j=f.length;i<j;i++)for(var k=f[i],l=0,m=k.vertexTangents.length;l<m;l++){var n=k[c[l]],o=e[n],p=k.vertexTangents[l];d[h].copy(o).applyMatrix4(g),b.copy(p).transformDirection(g).multiplyScalar(this.size),b.add(d[h]),h+=1,d[h].copy(b),h+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),c.WireframeHelper=function(a,b){var d=void 0!==b?b:16777215,e=[0,0],f={},g=function(a,b){return a-b},h=["a","b","c"],i=new c.BufferGeometry;if(a.geometry instanceof c.Geometry){for(var j=a.geometry.vertices,k=a.geometry.faces,l=0,m=new Uint32Array(6*k.length),n=0,o=k.length;n<o;n++)for(var p=k[n],q=0;q<3;q++){e[0]=p[h[q]],e[1]=p[h[(q+1)%3]],e.sort(g);var r=e.toString();void 0===f[r]&&(m[2*l]=e[0],m[2*l+1]=e[1],f[r]=!0,l++)}for(var s=new Float32Array(2*l*3),n=0,o=l;n<o;n++)for(var q=0;q<2;q++){var t=j[m[2*n+q]],u=6*n+3*q;s[u+0]=t.x,s[u+1]=t.y,s[u+2]=t.z}i.addAttribute("position",new c.BufferAttribute(s,3))}else if(a.geometry instanceof c.BufferGeometry)if(void 0!==a.geometry.attributes.index){var j=a.geometry.attributes.position.array,v=a.geometry.attributes.index.array,w=a.geometry.drawcalls,l=0;0===w.length&&(w=[{count:v.length,index:0,start:0}]);for(var m=new Uint32Array(2*v.length),x=0,y=w.length;x<y;++x)for(var z=w[x].start,A=w[x].count,u=w[x].index,n=z,B=z+A;n<B;n+=3)for(var q=0;q<3;q++){e[0]=u+v[n+q],e[1]=u+v[n+(q+1)%3],e.sort(g);var r=e.toString();void 0===f[r]&&(m[2*l]=e[0],m[2*l+1]=e[1],f[r]=!0,l++)}for(var s=new Float32Array(2*l*3),n=0,o=l;n<o;n++)for(var q=0;q<2;q++){var u=6*n+3*q,C=3*m[2*n+q];s[u+0]=j[C],s[u+1]=j[C+1],s[u+2]=j[C+2]}i.addAttribute("position",new c.BufferAttribute(s,3))}else{for(var j=a.geometry.attributes.position.array,l=j.length/3,D=l/3,s=new Float32Array(2*l*3),n=0,o=D;n<o;n++)for(var q=0;q<3;q++){var u=18*n+6*q,E=9*n+3*q;s[u+0]=j[E],s[u+1]=j[E+1],s[u+2]=j[E+2];var C=9*n+(q+1)%3*3;s[u+3]=j[C],s[u+4]=j[C+1],s[u+5]=j[C+2]}i.addAttribute("position",new c.BufferAttribute(s,3))}c.Line.call(this,i,new c.LineBasicMaterial({color:d}),c.LinePieces),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1},c.WireframeHelper.prototype=Object.create(c.Line.prototype),c.WireframeHelper.prototype.constructor=c.WireframeHelper,c.ImmediateRenderObject=function(){c.Object3D.call(this),this.render=function(a){}},c.ImmediateRenderObject.prototype=Object.create(c.Object3D.prototype),c.ImmediateRenderObject.prototype.constructor=c.ImmediateRenderObject,c.MorphBlendMesh=function(a,b){c.Mesh.call(this,a,b),this.animationsMap={},this.animationsList=[];var d=this.geometry.morphTargets.length,e=d-1,f=d/1;this.createAnimation("__default",0,e,f),this.setAnimationWeight("__default",1)},c.MorphBlendMesh.prototype=Object.create(c.Mesh.prototype),c.MorphBlendMesh.prototype.constructor=c.MorphBlendMesh,c.MorphBlendMesh.prototype.createAnimation=function(a,b,c,d){var e={startFrame:b,endFrame:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=e,this.animationsList.push(e)},c.MorphBlendMesh.prototype.autoCreateAnimations=function(a){for(var b,c=/([a-z]+)_?(\d+)/,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f],i=h.name.match(c);if(i&&i.length>1){var j=i[1];d[j]||(d[j]={start:1/0,end:-1/0});var k=d[j];f<k.start&&(k.start=f),f>k.end&&(k.end=f),b||(b=j)}}for(var j in d){var k=d[j];this.createAnimation(j,k.start,k.end,a)}this.firstAnimation=b},c.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){var b=this.animationsMap[a];b&&(b.direction=1,b.directionBackwards=!1)},c.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){var b=this.animationsMap[a];b&&(b.direction=-1,b.directionBackwards=!0)},c.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)},c.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)},c.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)},c.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)},c.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0,c=this.animationsMap[a];return c&&(b=c.time),b},c.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1,c=this.animationsMap[a];return c&&(b=c.duration),b},c.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):c.warn("THREE.MorphBlendMesh: animation["+a+"] undefined in .playAnimation()")},c.MorphBlendMesh.prototype.stopAnimation=function(a){var b=this.animationsMap[a];b&&(b.active=!1)},c.MorphBlendMesh.prototype.update=function(a){for(var b=0,d=this.animationsList.length;b<d;b++){var e=this.animationsList[b];if(e.active){var f=e.duration/e.length;e.time+=e.direction*a,e.mirroredLoop?(e.time>e.duration||e.time<0)&&(e.direction*=-1,e.time>e.duration&&(e.time=e.duration,e.directionBackwards=!0),e.time<0&&(e.time=0,e.directionBackwards=!1)):(e.time=e.time%e.duration,e.time<0&&(e.time+=e.duration));var g=e.startFrame+c.Math.clamp(Math.floor(e.time/f),0,e.length-1),h=e.weight;g!==e.currentFrame&&(this.morphTargetInfluences[e.lastFrame]=0,this.morphTargetInfluences[e.currentFrame]=1*h,this.morphTargetInfluences[g]=0,e.lastFrame=e.currentFrame,e.currentFrame=g);var i=e.time%f/f;e.directionBackwards&&(i=1-i),this.morphTargetInfluences[e.currentFrame]=i*h,this.morphTargetInfluences[e.lastFrame]=(1-i)*h}}}}).call(b,c(3)(a))},function(a,b){a.exports=function(a){return a.webpackPolyfill||(a.deprecate=function(){},a.paths=[],a.children=[],a.webpackPolyfill=1),a}},function(a,b){(function(a){"use strict";function c(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:a}function d(a,b){a.requestFullscreen?a.requestFullscreen(b):a.mozRequestFullScreen?a.mozRequestFullScreen(b):a.webkitRequestFullscreen?a.webkitRequestFullscreen(b):a.msRequestFullscreen&&a.msRequestFullscreen(b)}function e(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function f(){return"webkitIsFullScreen"in document?!!document.webkitIsFullScreen:"fullscreenElement"in document?!!document.fullscreenElement:"mozFullScreenElement"in document?!!document.mozFullScreenElement:"msFullscreenElement"in document?!!document.msFullscreenElement:!!document.querySelector(".viewer-fill-browser")}function g(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function h(a){return a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||a.msRequestFullscreen}function i(a){a=a||navigator.userAgent;var b=a.match(/Android\s([0-9\.]*)/);return!!b&&b[1]}function j(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0)}function k(){return!!x&&/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())}function l(){return!!x&&-1!==navigator.userAgent.toLowerCase().indexOf("android")}function m(){return!!x&&(k()||l())}function n(){if(!x)return!1;var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("safari")&&-1===a.indexOf("chrome")}function o(){return!!x&&-1!==navigator.userAgent.toLowerCase().indexOf("firefox")}function p(){return!!x&&-1!==navigator.userAgent.toLowerCase().indexOf("chrome")}function q(){return!!x&&-1!==navigator.userAgent.toLowerCase().indexOf("mac os")}function r(){if(!x)return!1;var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("win32")||-1!==a.indexOf("windows")}function s(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function t(a){var b=window.hasOwnProperty("pageXOffset")?window.pageXOffset:document.documentElement.scrollLeft,c=window.hasOwnProperty("pageYOffset")?window.pageYOffset:document.documentElement.scrollTop,d=void 0===a.pageX?a.changedTouches[0].pageX:a.pageX,e=void 0===a.pageY?a.changedTouches[0].pageY:a.pageY,f=document.elementFromPoint(d-b,e-c);return!f||"CANVAS"!==f.nodeName||(!!f.getAttribute(!0)||(a.preventDefault(),!1))}function u(){m()&&n()&&(document.documentElement.addEventListener("touchstart",t,!0),document.documentElement.addEventListener("touchmove",t,!0),document.documentElement.addEventListener("touchcanceled",t,!0),document.documentElement.addEventListener("touchend",t,!0))}function v(){m()&&n()&&(document.documentElement.removeEventListener("touchstart",t,!0),document.documentElement.removeEventListener("touchmove",t,!0),document.documentElement.removeEventListener("touchcanceled",t,!0),document.documentElement.removeEventListener("touchend",t,!0))}function w(a){a.target.className.indexOf("fullscreen")>-1||a.target.className.indexOf("webvr")>-1||(a.preventDefault(),a.stopPropagation(),a.target.click())}Object.defineProperty(b,"__esModule",{value:!0}),b.getGlobal=c,b.launchFullscreen=d,b.exitFullscreen=e,b.inFullscreen=f,b.fullscreenElement=g,b.isFullscreenAvailable=h,b.getAndroidVersion=i,b.isTouchDevice=j,b.isIOSDevice=k,b.isAndroidDevice=l,b.isMobileDevice=m,b.isSafari=n,b.isFirefox=o,b.isChrome=p,b.isMac=q,b.isWindows=r,b.ObjectAssign=s,b.disableDocumentTouchSafari=u,b.enableDocumentTouchSafari=v,b.touchStartToClick=w;var x=(b.isNodeJS=function(){return"undefined"==typeof navigator},b.isBrowser="undefined"!=typeof navigator),y=b.isIE11=x&&!!navigator.userAgent.match(/Edge|Trident\/7\./);"undefined"!=typeof window&&y&&function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.CustomEvent.prototype,window.CustomEvent=a}(),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(a,b){if(!b||b>this.byteLength?b=this.byteLength:b<0&&(b=this.byteLength+b)<0&&(b=0),a<0&&(a=this.byteLength+a)<0&&(a=0),b<=a)return new ArrayBuffer;for(var c=b-a,d=new Uint8Array(this,a,c),e=new Uint8Array(c),f=0;f<c;f++)e[f]=d[f];return e.buffer}),function(){Math.log2=Math.log2||function(a){return Math.log(a)/Math.LN2}}(),"undefined"!=typeof window&&(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder),function(){var a=c();a.performance||(a.performance=Date)}(),Number.isInteger=Number.isInteger||function(a){return"number"==typeof a&&isFinite(a)&&Math.floor(a)===a},String.prototype.repeat=String.prototype.repeat||function(a){if(a<1)return"";for(var b="",c=this.valueOf();a>1;)1&a&&(b+=c),a>>=1,c+=c;return b+c},Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{enumerable:!1,value:function(a,b,c){b=void 0===b?0:b,c=void 0===c?this.length:c;for(var d=b;d<c;++d)this[d]=a}}),Int32Array.prototype.lastIndexOf=Int32Array.prototype.lastIndexOf||function(a,b){return Array.prototype.lastIndexOf.call(this,a,b)},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,value:function(a,b){for(var c=this.length,d=0;d<c;++d){var e=this[d];if(a.call(b,e,d,this))return e}}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(a,b){if(null==a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=1;d<arguments.length;d++){var e=arguments[d];if(null!=e)for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(c[f]=e[f])}return c},writable:!0,configurable:!0}),"undefined"==typeof window||!y&&!k()||HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(a,b,c){var d=this;setTimeout(function(){for(var e=atob(d.toDataURL(b,c).split(",")[1]),f=e.length,g=new Uint8Array(f),h=0;h<f;h++)g[h]=e.charCodeAt(h);a(new Blob([g],{type:b||"image/png"}))})}})}).call(b,function(){return this}())},function(a,b,c){var d,e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(f,g,h,i){"use strict";function j(a,b,c){return setTimeout(o(a,c),b)}function k(a,b,c){return!!Array.isArray(a)&&(l(a,c[b],c),!0)}function l(a,b,c){var d;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==i)for(d=0;d<a.length;)b.call(c,a[d],d,a),d++;else for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)}function m(a,b,c){var d="DEPRECATED METHOD: "+b+"\n"+c+" AT \n";return function(){var b=new Error("get-stack-trace"),c=b&&b.stack?b.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",e=f.console&&(f.console.warn||f.console.log);return e&&e.call(f.console,d,c),a.apply(this,arguments)}}function n(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&va(d,c)}function o(a,b){return function(){return a.apply(b,arguments)}}function p(a,b){return(void 0===a?"undefined":e(a))==ra?a.apply(b?b[0]||i:i,b):a}function q(a,b){return a===i?b:a}function r(a,b,c){l(v(b),function(b){a.addEventListener(b,c,!1)})}function s(a,b,c){l(v(b),function(b){a.removeEventListener(b,c,!1)})}function t(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function u(a,b){return a.indexOf(b)>-1}function v(a){return a.trim().split(/\s+/g)}function w(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function x(a){return Array.prototype.slice.call(a,0)}function y(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];w(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function z(a,b){for(var c,d,e=b[0].toUpperCase()+b.slice(1),f=0;f<pa.length;){if(c=pa[f],(d=c?c+e:b)in a)return d;f++}return i}function A(){return ya++}function B(a){var b=a.ownerDocument||a;return b.defaultView||b.parentWindow||f}function C(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){p(a.options.enable,[a])&&c.handler(b)},this.init()}function D(a){var b=a.options.inputClass;return new(b||(Ba?R:Ca?U:Aa?W:Q))(a,E)}function E(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&Ea&&d-e==0,g=b&(Ga|Ha)&&d-e==0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,F(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function F(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=I(b)),e>1&&!c.firstMultiple?c.firstMultiple=I(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=J(d);b.timeStamp=ua(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=N(h,i),b.distance=M(h,i),G(c,b),b.offsetDirection=L(b.deltaX,b.deltaY);var j=K(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=j.x,b.overallVelocityY=j.y,b.overallVelocity=ta(j.x)>ta(j.y)?j.x:j.y,b.scale=g?P(g.pointers,d):1,b.rotation=g?O(g.pointers,d):0,b.maxPointers=c.prevInput?b.pointers.length>c.prevInput.maxPointers?b.pointers.length:c.prevInput.maxPointers:b.pointers.length,H(c,b);var k=a.element;t(b.srcEvent.target,k)&&(k=b.srcEvent.target),b.target=k}function G(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};b.eventType!==Ea&&f.eventType!==Ga||(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function H(a,b){var c,d,e,f,g=a.lastInterval||b,h=b.timeStamp-g.timeStamp;if(b.eventType!=Ha&&(h>Da||g.velocity===i)){var j=b.deltaX-g.deltaX,k=b.deltaY-g.deltaY,l=K(h,j,k);d=l.x,e=l.y,c=ta(l.x)>ta(l.y)?l.x:l.y,f=L(j,k),a.lastInterval=b}else c=g.velocity,d=g.velocityX,e=g.velocityY,f=g.direction;b.velocity=c,b.velocityX=d,b.velocityY=e,b.direction=f}function I(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:sa(a.pointers[c].clientX),clientY:sa(a.pointers[c].clientY)},c++;return{timeStamp:ua(),pointers:b,center:J(b),deltaX:a.deltaX,deltaY:a.deltaY}}function J(a){var b=a.length;if(1===b)return{x:sa(a[0].clientX),y:sa(a[0].clientY)};for(var c=0,d=0,e=0;e<b;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:sa(c/b),y:sa(d/b)}}function K(a,b,c){return{x:b/a||0,y:c/a||0}}function L(a,b){return a===b?Ia:ta(a)>=ta(b)?a<0?Ja:Ka:b<0?La:Ma}function M(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function N(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function O(a,b){return N(b[1],b[0],Ra)-N(a[1],a[0],Ra)}function P(a,b){return M(b[0],b[1],Ra)/M(a[0],a[1],Ra)}function Q(){this.evEl=Ta,this.evWin=Ua,this.pressed=!1,C.apply(this,arguments)}function R(){this.evEl=Xa,this.evWin=Ya,C.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function S(){this.evTarget=$a,this.evWin=_a,this.started=!1,C.apply(this,arguments)}function T(a,b){var c=x(a.touches),d=x(a.changedTouches);return b&(Ga|Ha)&&(c=y(c.concat(d),"identifier",!0)),[c,d]}function U(){this.evTarget=bb,this.targetIds={},C.apply(this,arguments)}function V(a,b){var c=x(a.touches),d=this.targetIds;if(b&(Ea|Fa)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=x(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return t(a.target,i)}),b===Ea)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Ga|Ha)&&delete d[g[e].identifier],e++;return h.length?[y(f.concat(h),"identifier",!0),h]:void 0}function W(){C.apply(this,arguments);var a=o(this.handler,this);this.touch=new U(this.manager,a),this.mouse=new Q(this.manager,a),this.primaryTouch=null,this.lastTouches=[]}function X(a,b){a&Ea?(this.primaryTouch=b.changedPointers[0].identifier,Y.call(this,b)):a&(Ga|Ha)&&Y.call(this,b)}function Y(a){var b=a.changedPointers[0];if(b.identifier===this.primaryTouch){var c={x:b.clientX,y:b.clientY};this.lastTouches.push(c);var d=this.lastTouches,e=function(){var a=d.indexOf(c);a>-1&&d.splice(a,1)};setTimeout(e,cb)}}function Z(a){for(var b=a.srcEvent.clientX,c=a.srcEvent.clientY,d=0;d<this.lastTouches.length;d++){var e=this.lastTouches[d],f=Math.abs(b-e.x),g=Math.abs(c-e.y);if(f<=db&&g<=db)return!0}return!1}function $(a,b){this.manager=a,this.set(b)}function _(a){if(u(a,ib))return ib;var b=u(a,jb),c=u(a,kb);return b&&c?ib:b||c?b?jb:kb:u(a,hb)?hb:gb}function aa(a){this.options=va({},this.defaults,a||{}),this.id=A(),this.manager=null,this.options.enable=q(this.options.enable,!0),this.state=mb,this.simultaneous={},this.requireFail=[]}function ba(a){return a&rb?"cancel":a&pb?"end":a&ob?"move":a&nb?"start":""}function ca(a){return a==Ma?"down":a==La?"up":a==Ja?"left":a==Ka?"right":""}function da(a,b){var c=b.manager;return c?c.get(a):a}function ea(){aa.apply(this,arguments)}function fa(){ea.apply(this,arguments),this.pX=null,this.pY=null}function ga(){ea.apply(this,arguments)}function ha(){aa.apply(this,arguments),this._timer=null,this._input=null}function ia(){ea.apply(this,arguments)}function ja(){ea.apply(this,arguments)}function ka(){aa.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function la(a,b){return b=b||{},b.recognizers=q(b.recognizers,la.defaults.preset),new ma(a,b)}function ma(a,b){this.options=va({},la.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=a,this.input=D(this),this.touchAction=new $(this,this.options.touchAction),na(this,!0),l(this.options.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function na(a,b){var c=a.element;if(c.style){var d;l(a.options.cssProps,function(e,f){d=z(c.style,f),b?(a.oldCssProps[d]=c.style[d],c.style[d]=e):c.style[d]=a.oldCssProps[d]||""}),b||(a.oldCssProps={})}}function oa(a,b){var c=g.createEvent("Event");c.initEvent(a,!0,!0),c.gesture=b,b.target.dispatchEvent(c)}var pa=["","webkit","Moz","MS","ms","o"],qa=g.createElement("div"),ra="function",sa=Math.round,ta=Math.abs,ua=Date.now,va=function(a){if(a===i||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(d!==i&&null!==d)for(var e in d)d.hasOwnProperty(e)&&(b[e]=Array.isArray(d[e])?d[e].slice(0):d[e])}return b},wa=m(function(a,b,c){for(var d=Object.keys(b),e=0;e<d.length;)(!c||c&&a[d[e]]===i)&&(a[d[e]]=b[d[e]]),e++;return a},"extend","Use `assign`."),xa=m(function(a,b){return wa(a,b,!0)},"merge","Use `assign`."),ya=1,za=/mobile|tablet|ip(ad|hone|od)|android/i,Aa="ontouchstart"in f,Ba=z(f,"PointerEvent")!==i,Ca=Aa&&za.test(navigator.userAgent),Da=25,Ea=1,Fa=2,Ga=4,Ha=8,Ia=1,Ja=2,Ka=4,La=8,Ma=16,Na=Ja|Ka,Oa=La|Ma,Pa=Na|Oa,Qa=["x","y"],Ra=["clientX","clientY"];C.prototype={handler:function(){},init:function(){this.evEl&&r(this.element,this.evEl,this.domHandler),this.evTarget&&r(this.target,this.evTarget,this.domHandler),this.evWin&&r(B(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&s(this.element,this.evEl,this.domHandler),this.evTarget&&s(this.target,this.evTarget,this.domHandler),this.evWin&&s(B(this.element),this.evWin,this.domHandler)}};var Sa={mousedown:Ea,mousemove:Fa,mouseup:Ga},Ta="mousedown",Ua="mousemove mouseup";n(Q,C,{handler:function(a){var b=Sa[a.type];b&Ea&&0===a.button&&(this.pressed=!0),b&Fa&&1!==a.which&&(b=Ga),this.pressed&&(b&Ga&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:"mouse",srcEvent:a}))}});var Va={pointerdown:Ea,pointermove:Fa,pointerup:Ga,pointercancel:Ha,pointerout:Ha},Wa={2:"touch",3:"pen",4:"mouse",5:"kinect"},Xa="pointerdown",Ya="pointermove pointerup pointercancel";f.MSPointerEvent&&!f.PointerEvent&&(Xa="MSPointerDown",Ya="MSPointerMove MSPointerUp MSPointerCancel"),n(R,C,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Va[d],f=Wa[a.pointerType]||a.pointerType,g="touch"===f,h="mouse"===f,i=w(b,a.pointerId,"pointerId");e&Ea&&(0===a.button||g)?i<0&&(b.push(a),i=b.length-1):e&(Ga|Ha)&&(c=!0),i<0||(b[i]=a,h&&!this.manager.options.handlePointerEventMouse||this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(i,1))}});var Za={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},$a="touchstart",_a="touchstart touchmove touchend touchcancel";n(S,C,{handler:function(a){var b=Za[a.type];if(b===Ea&&(this.started=!0),this.started){var c=T.call(this,a,b);b&(Ga|Ha)&&c[0].length-c[1].length==0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:"touch",srcEvent:a})}}});var ab={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},bb="touchstart touchmove touchend touchcancel";n(U,C,{handler:function(a){var b=ab[a.type],c=V.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:"touch",srcEvent:a})}});var cb=2500,db=25;n(W,C,{handler:function(a,b,c){var d="touch"==c.pointerType,e="mouse"==c.pointerType;if(!(e&&c.sourceCapabilities&&c.sourceCapabilities.firesTouchEvents)){if(d)X.call(this,b,c);else if(e&&Z.call(this,c))return;this.callback(a,b,c)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var eb=z(qa.style,"touchAction"),fb=eb!==i,gb="auto",hb="manipulation",ib="none",jb="pan-x",kb="pan-y",lb=function(){if(!fb)return!1;var a={},b=f.CSS&&f.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(c){a[c]=!b||f.CSS.supports("touch-action",c)}),a}();$.prototype={set:function(a){"compute"==a&&(a=this.compute()),fb&&this.manager.element.style&&lb[a]&&(this.manager.element.style[eb]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return l(this.manager.recognizers,function(b){p(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),_(a.join(" "))},preventDefaults:function(a){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=u(d,ib)&&!lb[ib],f=u(d,kb)&&!lb[kb],g=u(d,jb)&&!lb[jb];if(e){var h=1===a.pointers.length,i=a.distance<2,j=a.deltaTime<250;if(h&&i&&j)return}return g&&f?void 0:e||f&&c&Na||g&&c&Oa?this.preventSrc(b):void 0},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var mb=1,nb=2,ob=4,pb=8,qb=pb,rb=16;aa.prototype={defaults:{},set:function(a){return va(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(k(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=da(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return k(a,"dropRecognizeWith",this)?this:(a=da(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(k(a,"requireFailure",this))return this;var b=this.requireFail;return a=da(a,this),-1===w(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(k(a,"dropRequireFailure",this))return this;a=da(a,this);var b=w(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(b,a)}var c=this,d=this.state;d<pb&&b(c.options.event+ba(d)),b(c.options.event),a.additionalEvent&&b(a.additionalEvent),d>=pb&&b(c.options.event+ba(d))},tryEmit:function(a){if(this.canEmit())return this.emit(a);this.state=32},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(32|mb)))return!1;a++}return!0},recognize:function(a){var b=va({},a);if(!p(this.options.enable,[this,b]))return this.reset(),void(this.state=32);this.state&(qb|rb|32)&&(this.state=mb),this.state=this.process(b),this.state&(nb|ob|pb|rb)&&this.tryEmit(b)},process:function(a){},getTouchAction:function(){},reset:function(){}},n(ea,aa,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(nb|ob),e=this.attrTest(a);return d&&(c&Ha||!e)?b|rb:d||e?c&Ga?b|pb:b&nb?b|ob:nb:32}}),n(fa,ea,{defaults:{event:"pan",threshold:10,pointers:1,direction:Pa},getTouchAction:function(){var a=this.options.direction,b=[];return a&Na&&b.push(kb),a&Oa&&b.push(jb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Na?(e=0===f?Ia:f<0?Ja:Ka,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ia:g<0?La:Ma,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return ea.prototype.attrTest.call(this,a)&&(this.state&nb||!(this.state&nb)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=ca(a.direction);b&&(a.additionalEvent=this.options.event+b),this._super.emit.call(this,a)}}),n(ga,ea,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ib]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&nb)},emit:function(a){if(1!==a.scale){var b=a.scale<1?"in":"out";a.additionalEvent=this.options.event+b}this._super.emit.call(this,a)}}),n(ha,aa,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[gb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,e=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Ga|Ha)&&!e)this.reset();else if(a.eventType&Ea)this.reset(),this._timer=j(function(){this.state=qb,this.tryEmit()},b.time,this);else if(a.eventType&Ga)return qb;return 32},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===qb&&(a&&a.eventType&Ga?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=ua(),this.manager.emit(this.options.event,this._input)))}}),n(ia,ea,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ib]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&nb)}}),n(ja,ea,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Na|Oa,pointers:1},getTouchAction:function(){return fa.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Na|Oa)?b=a.overallVelocity:c&Na?b=a.overallVelocityX:c&Oa&&(b=a.overallVelocityY),this._super.attrTest.call(this,a)&&c&a.offsetDirection&&a.distance>this.options.threshold&&a.maxPointers==this.options.pointers&&ta(b)>this.options.velocity&&a.eventType&Ga},emit:function(a){var b=ca(a.offsetDirection);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),n(ka,aa,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[hb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,e=a.deltaTime<b.time;if(this.reset(),a.eventType&Ea&&0===this.count)return this.failTimeout();if(d&&e&&c){if(a.eventType!=Ga)return this.failTimeout();var f=!this.pTime||a.timeStamp-this.pTime<b.interval,g=!this.pCenter||M(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,g&&f?this.count+=1:this.count=1,this._input=a;if(0===this.count%b.taps)return this.hasRequireFailures()?(this._timer=j(function(){this.state=qb,this.tryEmit()},b.interval,this),nb):qb}return 32},failTimeout:function(){return this._timer=j(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==qb&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),la.VERSION="2.0.8",la.defaults={domEvents:!1,touchAction:"compute",enable:!0,handlePointerEventMouse:!0,inputTarget:null,inputClass:null,preset:[[ia,{enable:!1}],[ga,{enable:!1
},["rotate"]],[ja,{direction:Na}],[fa,{direction:Na},["swipe"]],[ka],[ka,{event:"doubletap",taps:2},["tap"]],[ha]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};ma.prototype={set:function(a){return va(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?2:1},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&qb)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],2===b.stopped||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(nb|ob|pb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof aa)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(k(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(k(a,"remove",this))return this;if(a=this.get(a)){var b=this.recognizers,c=w(b,a);-1!==c&&(b.splice(c,1),this.touchAction.update())}return this},on:function(a,b){if(a!==i&&b!==i){var c=this.handlers;return l(v(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this}},off:function(a,b){if(a!==i){var c=this.handlers;return l(v(a),function(a){b?c[a]&&c[a].splice(w(c[a],b),1):delete c[a]}),this}},emit:function(a,b){this.options.domEvents&&oa(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()},b.stopPropagation=function(){b.srcEvent.stopPropagation()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&na(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},va(la,{INPUT_START:Ea,INPUT_MOVE:Fa,INPUT_END:Ga,INPUT_CANCEL:Ha,STATE_POSSIBLE:mb,STATE_BEGAN:nb,STATE_CHANGED:ob,STATE_ENDED:pb,STATE_RECOGNIZED:qb,STATE_CANCELLED:rb,STATE_FAILED:32,DIRECTION_NONE:Ia,DIRECTION_LEFT:Ja,DIRECTION_RIGHT:Ka,DIRECTION_UP:La,DIRECTION_DOWN:Ma,DIRECTION_HORIZONTAL:Na,DIRECTION_VERTICAL:Oa,DIRECTION_ALL:Pa,Manager:ma,Input:C,TouchAction:$,TouchInput:U,MouseInput:Q,PointerEventInput:R,TouchMouseInput:W,SingleTouchInput:S,Recognizer:aa,AttrRecognizer:ea,Tap:ka,Pan:fa,Swipe:ja,Pinch:ga,Rotate:ia,Press:ha,on:r,off:s,each:l,merge:xa,extend:wa,assign:va,inherit:n,bindFn:o,prefixed:z}),(void 0!==f?f:"undefined"!=typeof self?self:{}).Hammer=la,(d=function(){return la}.call(b,c,b,a))!==i&&(a.exports=d)}(window,document)},function(a,b,c){"use strict";function d(a){a=a.toLowerCase();var b=document.getElementsByTagName("SCRIPT");if(b&&b.length>0)for(var c=0;c<b.length;++c)if(b[c].src&&-1!==b[c].src.toLowerCase().indexOf(a))return b[c];return null}function e(a,b,c){for(var d=a.indexOf("://")>0?a:h(a),e=document.getElementsByTagName("link"),f=0,g=e.length;f<g;f++)if(e[f].href===d)return void(b&&b());var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",d),b&&(i.onload=b),c&&(i.onerror=c),document.head.appendChild(i)}function f(a,b){function c(a){b(a,null)}function d(a){var c=a.currentTarget.responseText;b(null,c)}var e=a.indexOf("://")>0?a:h(a),f=new XMLHttpRequest;f.onload=d,f.onerror=c,f.ontimeout=c,f.open("GET",e,!0),f.send()}function g(a,b){return!(!b||!Array.isArray(b.experimental))&&-1!==b.experimental.indexOf(a)}function h(a){return m.LMV_RESOURCE_ROOT+a}function i(a,b,c,d,e){if(void 0===window[a]){var f=document.createElement("SCRIPT");f.src=b.indexOf("://")>0?b:h(b);var g=function(){f.onerror=null,f.onload=null},i=function(){g(),d&&d()},j=function(){g(),c&&c()};f.onload=j,f.onerror=i,document.head.appendChild(f)}else c&&c()}function j(a){return"undefined"==typeof window?"":k(a,window.location.href)}function k(a,b){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))}Object.defineProperty(b,"__esModule",{value:!0}),b.getScript=d,b.injectCSS=e,b.getHtmlTemplate=f,b.isExperimentalFlagEnabled=g,b.getResourceUrl=h,b.loadDependency=i,b.getParameterByName=j,b.getParameterByNameFromPath=k;var l=c(4),m=(0,l.getGlobal)();m.LOCALIZATION_REL_PATH="",m.LMV_VIEWER_VERSION="6.1",m.LMV_VIEWER_PATCH="0",m.LMV_BUILD_TYPE="Production",m.LMV_RESOURCE_ROOT="",m.LMV_THIRD_PARTY_COOKIE=!(0,l.isNodeJS)()&&void 0,"v"===m.LMV_VIEWER_VERSION.charAt(0)&&(m.LMV_VIEWER_VERSION=m.LMV_VIEWER_VERSION.substr(1))},function(a,b,c){"use strict";function d(a){var b;if(a&&a.env&&(b=a.env),b||(b=(0,o.getParameterByName)("env")),a&&a.offlineResourcePrefix&&(0,q.setOfflineResourcePrefix)(a.offlineResourcePrefix),a&&a.offline&&"true"===a.offline&&(0,q.setOffline)(!0),!b)switch(window.location.hostname){case"developer-dev.api.autodesk.com":b="AutodeskDevelopment";break;case"developer-stg.api.autodesk.com":b="AutodeskStaging";break;case"developer.api.autodesk.com":b="AutodeskProduction";break;case"localhost.autodesk.com":case"":case"127.0.0.1":b="Local";break;default:b="AutodeskProduction"}(0,q.setEnv)(b),"undefined"!=typeof window&&p.logger.info("Host name : "+window.location.hostname),p.logger.info("Environment initialized as : "+b)}function e(a){var b=a.endpoint;if(!b){b=D[(0,q.getEnv)()].ROOT}var c=a.api||b.ENDPOINT_API_DERIVATIVE_SERVICE_V2;if(q.endpoint.setEndpointAndApi(b,c),!(0,r.isNodeJS)()){var d=["viewer3D.js","viewer3D.min.js"];a&&a.hasOwnProperty("libraryName")&&d.push(a.libraryName);for(var e,f,g=0;g<d.length;g++){var h=(0,o.getScript)(d[g]);f=h?h.src:"";var i=f.indexOf(d[g]);if(i>=0){e=f.substr(0,i);break}}w.LMV_RESOURCE_ROOT=e||w.LMV_RESOURCE_ROOT}}function f(a,b,c){b=b||function(){},t.ViewingService.rawGet(q.endpoint.getApiEndpoint(),null,"/auth/settoken",b,c,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0,postData:"access-token="+a})}function g(a){q.endpoint.HTTP_REQUEST_HEADERS.Authorization="Bearer "+a}function h(a,b,c){if(x.accessToken=a,x.useCookie){f(a,b,function(b){p.logger.warn("Failed to set token in cookie. Will use header instead."),x.useCookie=!1,g(a),c&&c(b)})}else g(a),b&&b()}function i(a,b){function c(d,f){e=d,x.tokenRefreshInterval?h(e):h(e,a,a),"number"!=typeof f&&(f=3599);var g=f-5;g<=0&&(g=f),x.tokenRefreshInterval=setTimeout(function(){b.getAccessToken(c)},1e3*g)}var d=b?b.shouldInitializeAuth:void 0;if(void 0===d){d="false"!==(0,o.getParameterByName)("auth").toLowerCase()}if("Local"==(0,q.getEnv)()||!d)return setTimeout(a,0),q.endpoint.setUseCredentials(void 0!==b.useCredentials&&b.useCredentials),q.endpoint.getUseCredentials();q.endpoint.setUseCredentials(void 0===b.useCredentials||b.useCredentials),x.useCookie=b.useCookie,x.tokenRefreshInterval&&(clearTimeout(x.tokenRefreshInterval),x.tokenRefreshInterval=null);var e;return b&&b.getAccessToken?(x.getAccessToken=b.getAccessToken,"string"==typeof(e=b.getAccessToken(c))&&e&&h(e,a)):b&&b.accessToken?(e=b.accessToken,h(e,a)):(e=(0,o.getParameterByName)("accessToken"),e||p.logger.error("No access token is provided, but authorization requested. This is a problem."),h(e,a)),q.endpoint.getUseCredentials()}function j(a){p.logger.initialize(a);var b=(0,o.getParameterByName)("logLevel");if(b&&p.logger.setLevel(parseInt(b)),!(a&&a.hasOwnProperty("useADP")&&0==a.useADP||(0,r.isNodeJS)())){var c=function(){if("undefined"==typeof Adp)return void p.logger.warn("Autodesk Data Platform SDK not found");var a;switch(w.LMV_BUILD_TYPE){case"Production":a=C.prod;break;default:a=C.stg}var b={product:{name:"LMV",line_name:"LMV",key:a.CLIENT_ID,id:a.CLIENT_KEY,id_provider:"appkey",build_id:w.LMV_VIEWER_VERSION+"."+w.LMV_VIEWER_PATCH,build_tag:w.LMV_BUILD_TYPE}},c={server:a.ENDPOINT,enable_geo_data:!1,enable_browser_data:!0,enable_session_messages:!0};p.logger.adp=new Adp(b,c)};(0,o.loadDependency)("Adp","https://ase-cdn.autodesk.com/adp/v1.0.3/js/adp-web-analytics-sdk.min.js",c)}}function k(){q.endpoint.getCdnRedirectUrl()&&t.ViewingService.rawGet(q.endpoint.getCdnRedirectUrl(),null,null,function(a){a&&a.length&&(q.endpoint.setCdnUrl(a),p.logger.info("CDN_ROOT is: "+a))},function(){},{withCredentials:!1,responseType:"text"})}function l(a){if(a){var b;if(a.memory){b=0|parseInt(a.memory.limit);(a.memory.debug&&a.memory.debug.force||!1)&&b<=0&&(a.memory.force=!1,p.logger.warn("config.memory.limit value is invalid: ("+a.memory.limit+")"))}var c=(0,o.getParameterByName)("viewermemory");if((b=parseInt(c))>=0){b|=0;var d=b>0&&"f"===c.charAt(c.length-1).toLowerCase();a.memory={limit:b,debug:{force:d}},d?p.logger.info("Forcing memory limit to URL param: ("+b+" MegaBytes)."):p.logger.info("Setting memory limit to URL param: ("+b+" MegaBytes).")}else""!==c&&p.logger.warn("Invalid viewermemory URL param value: ("+c+")")}}function m(a){a&&a.userInfo&&((0,u.setUserName)(a.userInfo.name),a.comment2Token&&(y.comment2Token=a.comment2Token))}function n(a,b){function c(){(0,s.initWorkerScript)(),i(b,a),(0,v.initializeLocalization)(a),m(a)}(0,r.isNodeJS)()?(d(a),e(a),j(a),k(),i(b,a)):(y.WEBGL_HELP_LINK=a?a.webGLHelpLink:null,d(a),e(a),j(a),k(),(0,r.disableDocumentTouchSafari)(),(0,o.loadDependency)("Promise","es6-promise.min.js",function(){c()},null,"es6-promise-polyfill"))}Object.defineProperty(b,"__esModule",{value:!0}),b.EnvironmentConfigurations=b.token=void 0,b.initializeEnvironmentVariable=d,b.initializeServiceEndPoints=e,b.refreshCookie=f,b.refreshRequestHeader=g,b.refreshToken=h,b.initializeAuth=i,b.initializeLogger=j,b.processMemoryOptions=l,b.initializeUserInfo=m,b.Initializer=n;var o=c(6),p=c(8),q=c(9),r=c(4),s=c(10),t=c(12),u=c(32),v=c(34),w=(0,r.getGlobal)(),x={accessToken:null,getAccessToken:null,tokenRefreshInterval:null},y=(b.token=x,Autodesk.Viewing.Private),z={local:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},dev:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},stg:{RTC:["https://rtc-stg.api.autodesk.com:443","https://lmv.autodesk.com:443"]},prod:{RTC:["https://rtc.api.autodesk.com:443","https://lmv.autodesk.com:443"]}},A={local:"",dev:"https://developer-dev.api.autodesk.com",stg:"https://developer-stg.api.autodesk.com",prod:"https://developer.api.autodesk.com"},B={dev:"https://otg-dev.autodesk.com",stg:"https://otg-stg.autodesk.com",prod:"https://otg.autodesk.com"},C={stg:{CLIENT_ID:"lmv-stag",CLIENT_KEY:"kjemi1rwAgsqIqyvDUtc9etPD6MsAzbV",ENDPOINT:"https://ase-stg.autodesk.com"},prod:{CLIENT_ID:"lmv-prod",CLIENT_KEY:"iaoUM2CRGydfn703yfPq4MAogZi8I5u4",ENDPOINT:"https://ase.autodesk.com"}},D=b.EnvironmentConfigurations={Local:{ROOT:"",LMV:z.local},Development:{ROOT:A.dev,LMV:z.dev,bubbleManifest:!0},Staging:{ROOT:A.stg,LMV:z.stg,bubbleManifest:!0},Production:{ROOT:A.prod,LMV:z.prod,bubbleManifest:!0},AutodeskDevelopment:{ROOT:A.dev,LMV:z.dev},AutodeskStaging:{ROOT:A.stg,LMV:z.stg},AutodeskProduction:{ROOT:A.prod,LMV:z.prod},FluentDev:{ROOT:B.dev,LMV:z.dev},FluentStaging:{ROOT:B.stg,LMV:z.stg},FluentProduction:{ROOT:B.prod,LMV:z.prod}}},function(a,b,c){"use strict";function d(){this.adp=null,this.runtimeStats={},this.level=-1,this.setLevel(j.ERROR)}function e(){return"undefined"!=typeof window?encodeURI(window.location.href):""}function f(a){b.logger=k=a}Object.defineProperty(b,"__esModule",{value:!0}),b.logger=b.LogLevels=void 0,b.Logger=d,b.setLogger=f;var g=c(4),h=c(9),i=(0,g.getGlobal)(),j=b.LogLevels={DEBUG:5,LOG:4,INFO:3,WARNING:2,ERROR:1,NONE:0};d.prototype.initialize=function(a){if(a.eventCallback&&(this.callback=a.eventCallback),this.sessionId=a.sessionId,!this.sessionId){var b=Date.now()+"";this.sessionId=parseFloat((1e4*Math.random()|0)+""+b.substring(4))}var c=a.logLevel||a.loglevel;"number"==typeof c&&this.level!==c&&this.setLevel(c),this.environmentInfo={touch:(0,g.isTouchDevice)(),env:(0,h.getEnv)(),referer:e(),version:i.LMV_VIEWER_VERSION,patch:i.LMV_VIEWER_PATCH,build_type:i.LMV_BUILD_TYPE};var d={category:"viewer_start",touch:this.environmentInfo.touch,env:this.environmentInfo.env,referer:this.environmentInfo.referer,version:this.environmentInfo.version,patch:this.environmentInfo.patch,build_type:this.environmentInfo.build_type};this.track(d);var f=this;this.interval=setInterval(function(){f.reportRuntimeStats()},6e4)},d.prototype.shutdown=function(){clearInterval(this.interval),this.interval=void 0},d.prototype.track=function(a){if(this.updateRuntimeStats(a),!(0,h.isOffline)()&&this.sessionId){a.timestamp=Date.now(),a.sessionId=this.sessionId;var b=this.logToADP(a);this.callback&&this.callback(a,{adp:b})}},d.prototype.logToADP=function(a){if(!this.adp)return!1;var b="",c="";switch(a.category){case"tool_changed":case"pref_changed":b="CLICK_OPERATION",c=a.category+"/"+a.name;break;case"screen_mode":b="CLICK_OPERATION",c="pref_changed/"+a.category;break;case"metadata_load_stats":b="DOCUMENT_START",c="stats",a.full_url=e();break;case"model_load_stats":b="DOCUMENT_FULL",c="stats";break;case"tool_used":b="BACKGROUND_CALL",c=a.category+"/"+a.name;break;case"settingOptionsStatus":b="BACKGROUND_CALL",c=a.category+"/"+a.list;break;case"node_selected":case"search_node":b="CLICK_OPERATION",c=a.category+"/"+a.name;break;case"loaded_extensions":b="BACKGROUND_CALL",c=a.category;break;case"error":b="BACKGROUND_CALL",c="error"}return!!b&&(this.adp.trackEvent(b,{operation:{id:a.sessionId,type:c,stage:"",status:"C",meta:a}}),!0)},d.prototype.updateRuntimeStats=function(a){if(a.hasOwnProperty("aggregate"))switch(a.aggregate){case"count":this.runtimeStats[a.name]>0?this.runtimeStats[a.name]++:this.runtimeStats[a.name]=1,this.runtimeStats._nonempty=!0;break;case"last":this.runtimeStats[a.name]=a.value,this.runtimeStats._nonempty=!0;break;default:this.warn("unknown log aggregate type")}},d.prototype.reportRuntimeStats=function(){this.runtimeStats._nonempty&&(delete this.runtimeStats._nonempty,this.adp&&this.adp.trackEvent("BACKGROUND_CALL",{operation:{id:this.sessionId,type:"stats",stage:"",status:"C",meta:this.runtimeStats}}),this.runtimeStats.category="misc_stats",this.track(this.runtimeStats),this.runtimeStats={})},d.prototype.setLevel=function(a){if(this.level!==a){this.level=a;var b=function(){},c=j,d=this,e=function(){if(d.callback){var a=Array.prototype.slice.call(arguments).join(" ");d.callback({category:"error",message:a},{adp:!1})}console.error.apply(console,arguments)};this.debug=a>=c.DEBUG?console.log.bind(console):b,this.log=a>=c.LOG?console.log.bind(console):b,this.info=a>=c.INFO?console.info.bind(console):b,this.warn=a>=c.WARNING?console.warn.bind(console):b,this.error=a>=c.ERROR?e:b}};var k=b.logger=new d},function(a,b,c){"use strict";function d(){return q}function e(a){q=a}function f(){return r}function g(a){r=a}function h(a){s=a}function i(){return s}Object.defineProperty(b,"__esModule",{value:!0}),b.initLoadContext=b.endpoint=void 0,b.getEnv=d,b.setEnv=e,b.isOffline=f,b.setOffline=g,b.setOfflineResourcePrefix=h,b.getOfflineResourcePrefix=i;var j=c(4),k={},l=null;k.ENDPOINT_API_DERIVATIVE_SERVICE_V2="derivativeV2",k.ENDPOINT_API_MODEL_DERIVATIVE_V2="modelDerivativeV2",k.ENDPOINT_API_FLUENT="fluent";var m={derivativeV2:{baseURL:"/derivativeservice/v2",itemURL:"/derivativeservice/v2/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn"},derivativeV2_EU:{baseURL:"/derivativeservice/v2/regions/eu",itemURL:"/derivativeservice/v2/regions/eu/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/regions/eu/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/eu/thumbnails/:urn"},modelDerivativeV2:{baseURL:"/modelderivative/v2/",itemURL:"/modelderivative/v2/designdata/:urn/manifest/:derivativeurn",manifestURL:"/modelderivative/v2/designdata/:urn/manifest",thumbnailsURL:"/modelderivative/v2/designdata/:urn/thumbnail"},fluent:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws",cdnRedirectURL:"/cdnurl"}},n="",o=k.ENDPOINT_API_DERIVATIVE_SERVICE_V2,p=!1;k.HTTP_REQUEST_HEADERS={},k.setEndpointAndApi=function(a,b){n=a,b&&(o=b)},k.getEndpointAndApi=function(){return n+m[o].baseURL},k.getApiEndpoint=function(){return n},k.getApiFlavor=function(){return o},k.getCdnUrl=function(){return l||(n?n+m[o].cdnURL:void 0)},k.getCdnWebSocketEndpoint=function(){return n+(m[o].cdnWS||"")},k.setCdnUrl=function(a){l=a},k.getCdnRedirectUrl=function(){var a=m[o].cdnRedirectURL;return a?n+a:null},k.getManifestApi=function(a,b,c){var d=a||n;return c=c||o,d+=m[c].manifestURL,b=b||"",d=d.replace(":urn",b)},k.getItemApi=function(a,b,c){var d=c||o,e=(a||n)+m[d].itemURL;b=b||"";var f=decodeURIComponent(b);if(-1!==e.indexOf(":urn")){var g=f.split("/"),h=g[0]||"";h=h.split(":"),h=h[h.length-1]||"",e=e.replace(":urn",h)}return d===k.ENDPOINT_API_MODEL_DERIVATIVE_V2&&(b=encodeURIComponent(f)),e=e.replace(":derivativeurn",b)},k.getThumbnailApi=function(a,b,c){return((a||n)+m[c||o].thumbnailsURL).replace(":urn",b||"")},k.getUseCredentials=function(){return p},k.pathRequiresCredentials=function(a){var b=-1===a.indexOf("://"),c=0===a.indexOf(this.getEndpointAndApi()),d=0===a.indexOf(n);return b||c||d},k.getDomainParam=function(){return this.getUseCredentials()&&!(0,j.isNodeJS)()?"domain="+encodeURIComponent(window.location.origin):""},k.setUseCredentials=function(a){p=a},k.initLoadContext=function(a){a=a||{},a.auth=this.getUseCredentials(),a.endpoint||(a.endpoint=this.getApiEndpoint()),a.api||(a.api=this.getApiFlavor()),a.headers||(a.headers={});for(var b in this.HTTP_REQUEST_HEADERS)a.headers[b]=this.HTTP_REQUEST_HEADERS[b];var c=this.getDomainParam();return c&&(a.queryParams?a.queryParams+="&"+c:a.queryParams=c),a.otg_cdn=l||this.getCdnUrl(),a.otg_ws=this.getCdnWebSocketEndpoint(),a};var q,r=!1,s="";b.endpoint=k,b.initLoadContext=k.initLoadContext.bind(k)},function(a,b,c){"use strict";var d=c(4).isNodeJS,e=c(6).getResourceUrl;d()?function(){function b(){return new f}function d(){return b()}function e(a,b){a&&a()}var f=c(11).MainWorker;a.exports={createWorker:b,initWorkerScript:e,createWorkerWithIntercept:d}}():function(){function b(){j=null}function c(a,b){if(i&&!j){if(l.push({successCB:a}),!k){var c=new XMLHttpRequest,d=h,f=e(h);f&&(d=f),c.open("GET",d,!0),c.withCredentials=!1,c.onload=function(){k=!1;var a=void 0;window.URL=window.URL||window.webkitURL;try{a=new Blob([c.responseText],{type:"application/javascript"})}catch(d){var b=new BlobBuilder;b.append(c.responseText),a=b.getBlob()}j=URL.createObjectURL(a);var d=l.concat();l=[];for(var e=0;e<d.length;++e)d[e].successCB&&d[e].successCB()},k=!0,c.send()}var g={};return g.cancel=function(){var b=-1;return!!l.some(function(c,d){return c.successCB==a&&(b=d,!0)})&&(l.splice(b,1),!0)},g}return a&&a(),null}function d(){var a=void 0;return a=i?new Worker(j):new Worker(e(h)),a.doOperation=a.postMessage,a}function f(){function a(a){if(!c)return null;for(var b=0;b<c.length;++b)if(c[b].arg===a){var d=c[b].callback;return c.splice(b,1),0===c.length&&(c=null),d}return null}var b=d();b.checkEvent=function(a){return!(!a.data||!a.data.assetRequest)};var c=[];return b.addEventListenerWithIntercept=function(a){var d=function(c){b.checkEvent(c)||a(c)};return c||(c=[]),c.push({arg:a,callback:d}),b.addEventListener("message",d,!1),d},b.removeEventListenerWithIntercept=function(c){var d=a(c);d&&b.removeEventListener("message",d,!1)},b.clearAllEventListenerWithIntercept=function(){if(c)for(var a=c.concat(),d=0;d<a.length;++d)b.removeEventListenerWithIntercept(a[d].arg)},b}var g=Autodesk.Viewing.Private,h=g.LMV_WORKER_URL||"src/file-loaders/workers/MainWorker-web.js",i=g.ENABLE_INLINE_WORKER||!1,j=null,k=!1,l=[];a.exports={createWorker:d,initWorkerScript:c,createWorkerWithIntercept:f,clearWorkerDataURL:b}}()},function(a,b){a.exports=DELETED_WORKERNODE},function(a,b,c){"use strict";function d(a){var b=a.split("/");if(0==b.length)return a;for(var c=[],d=0;d<b.length;++d){var e=b[d];"."!==e&&(".."===e&&c.length?c.pop():c.push(e))}return 0==c.length?"":c.join("/")}function e(a){if(-1!==a.indexOf("://")||0===a.indexOf("urn:"))return a;if("undefined"==typeof window)return a;var b=window.location.pathname,c=b.lastIndexOf("/");return b=b.substr(0,c+1),window.location.protocol+"//"+window.location.host+b+a}function f(a,b){for(var c=a.length-b,d=new ArrayBuffer(c),e=new Uint8Array(d,0),f=0,g=b;f<c;f++,g++)e[f]=255&a.charCodeAt(g);return e}function g(a,b){return-1===b.indexOf("file://")&&(-1!==b.indexOf("://")||(!!a||void 0))}function h(a,b){b.hasOwnProperty("asynchronous")?b.asynchronous||i.logger.warn("LMV: Sync XHR used. Performance warning."):b.asynchronous=!0,b.hasOwnProperty("responseType")||(b.responseType="arraybuffer"),b.hasOwnProperty("withCredentials")||(b.withCredentials=!!a.auth),b.headers=a.headers,b.queryParams=a.queryParams,b.endpoint=a.endpoint}Object.defineProperty(b,"__esModule",{value:!0}),b.ViewingService=void 0,b.pathToURL=e,b.textToArrayBuffer=f;var i=c(8),j=c(13),k=c(14),l=c(9),m=c(4),n=c(15),o=b.ViewingService={},p=!1;o.simplifyPath=d,o.OSS_PREFIX="urn:adsk.objects:os.object:",o.generateUrl=function(a,b,c){if(c=c||"",(0,m.isNodeJS)()&&!g(a,c))return c;c=d(c);var e=c.indexOf("urn:"),f=c.indexOf("?");if(c=-1!=e?-1!==f?c.slice(0,e)+encodeURIComponent(c.slice(e,f))+c.slice(f):c.slice(0,e)+encodeURIComponent(c.slice(e)):encodeURI(c),!b||0!==decodeURIComponent(c).indexOf("urn:"))return g(null,c)?c:a+c;switch("items"!==b&&(c=c.substr(6)),b){case"items":return l.endpoint.getItemApi(a,c);case"bubbles":return l.endpoint.getManifestApi(a,c);case"thumbnails":return l.endpoint.getThumbnailApi(a,c)}},(0,m.isNodeJS)()?function(){function a(a,b,c,f){function g(a){if("json"===f.responseType)try{return JSON.parse(a.toString("utf8"))}catch(a){c(a)}return a}0===a.indexOf("file://")&&(a=a.substr(7)),d.readFile(a,function(d,h){d?c(0,0,{httpStatusText:d,url:a}):31===h[0]&&139===h[1]?e.gunzip(h,null,function(d,e){d?c(0,0,{httpStatusText:d,url:a}):(e=g(e),f.ondata&&f.ondata(e),b(e))}):(h=g(h),f.ondata&&f.ondata(h),b(h))})}function b(a,b){return"gzip"===a.headers["content-encoding"]||(!!b.endsWith(".json.gz")||(!!b.endsWith("FragmentList.pack")||(!!b.endsWith("LightList.bin")||(!!b.endsWith("CameraList.bin")||(!!b.endsWith("CameraDefinitions.bin")||!!b.endsWith("LightDefinitions.bin"))))))}var d=c(31),e=c(31),f=c(31),h=c(31),k=c(31),l=new f.Agent({maxSockets:10});o.rawGet=function(c,d,m,n,p,q){if(q=q||{},m=o.generateUrl(c,d,m),!g(c,m))return void a(m,n,p,q);if(q.queryParams){var r=-1===m.indexOf("?")?"?":"&";m=m+r+q.queryParams}var s=k.parse(m),t={host:s.hostname,port:s.port,method:q.method||"GET",path:s.path,headers:{},retryCount:0};if(t.host.endsWith(".api.autodesk.com")&&(t.path.startsWith("/derivativeservice")||t.path.startsWith("/modelderivative"))&&(t.agent=l),q.headers)for(var u in q.headers)t.headers[u]=q.headers[u];t.headers["accept-encoding"]||(t.headers["accept-encoding"]="gzip, deflate"),q.range&&(t.headers.Range="bytes="+q.range.min+"-"+q.range.max),(q.ondata||q.onprogress)&&(q.responseType="arraybuffer");var v=("https:"===s.protocol?f:h).request(t,function(a){var c=!(a.statusCode>=200&&a.statusCode<400),d=a;c||!b(a,s.pathname)||q.skipDecompress||(d=a.pipe(e.createGunzip())),"json"!==q.responseType&&"text"!==q.responseType&&q.responseType||d.setEncoding("utf8");var f,g=[];d.on("data",function(a){if(q.onprogress)return f=f?Buffer.concat([f,a]):a,void q.onprogress(f);g.push(a),q.ondata&&q.ondata(a)}),d.on("end",function(){if(a.statusCode>=200&&a.statusCode<400){if("json"===q.responseType){var b=JSON.parse(g.join(""));return void n(b)}if("text"===q.responseType||""===q.responseType){var c=g.join("");return void n(c)}var d=q.onprogress?f:Buffer.concat(g);if(!q.skipDecompress&&31===d[0]&&139===d[1]){i.logger.warn("An LMV resource ("+m+") was double compressed, or Content-Encoding header missing");try{d=e.gunzipSync(d)}catch(a){p(j.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:m,exception:a.toString(),stack:a.stack})}}n(d)}else p&&p(a.statusCode,a.statusMessage,{url:m})})});v.on("error",function(a){p&&p(a.code,a.message,{url:m})}),q.postData&&v.write(q.postData),v.end()}}():o.rawGet=function(a,b,c,d,e,g){function h(a){e&&e(r.status,r.statusText,{url:c})}function l(a){if("json"===g.responseType)try{if(a instanceof Uint8Array)return(0,k.blobToJson)(a);if("string"==typeof a)return JSON.parse(a)}catch(a){}return a}function m(a){if(200===r.status||206===r.status)if(r.response&&r.response instanceof ArrayBuffer){var b=new Uint8Array(r.response);if(!g.skipDecompress&&31===b[0]&&139===b[1]){p||(p=!0,i.logger.warn("An LMV resource ("+c+") was not uncompressed by the browser. This hurts performance. Check the Content-Encoding header returned by the server and check whether you're getting double-compressed streams. The warning prints only once but it's likely the problem affects multiple resources."));try{b=n.ungzip(b)}catch(a){e(j.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:c,exception:a.toString(),stack:a.stack})}}d&&d(l(b))}else{var f=r.response;f||g.responseType&&"text"!==g.responseType||(f=r.responseText),d&&d(l(f))}else h(a)}if(g=g||{},c=o.generateUrl(a,b,c),g.queryParams){var q=-1===c.indexOf("?")?"?":"&";c=c+q+g.queryParams}var r=new XMLHttpRequest;try{var s=!g.hasOwnProperty("asynchronous")||g.asynchronous;if(r.open(g.method||(g.noBody?"HEAD":"GET"),c,s),g.hasOwnProperty("responseType")&&(r.responseType=g.responseType),r.withCredentials=!0,g.hasOwnProperty("withCredentials")&&(r.withCredentials=g.withCredentials),g.range&&r.setRequestHeader("Range","bytes="+g.range.min+"-"+g.range.max),g.headers)for(var t in g.headers)r.setRequestHeader(t,g.headers[t]),"authorization"===t.toLocaleLowerCase()&&(r.withCredentials=!1);s&&(r.onload=m,r.onerror=h,r.ontimeout=h,(g.ondata||g.onprogress)&&(r.overrideMimeType("text/plain; charset=x-user-defined"),g._dlProgress={streamOffset:0},r.onreadystatechange=function(){if(r.readyState>2&&200===r.status)if(g.ondata){var a=r.responseText;if(g._dlProgress.streamOffset>=a.length)return;var b=f(a,g._dlProgress.streamOffset);g._dlProgress.streamOffset=a.length,g.ondata(b)}else g.onprogress&&g.onprogress(r.responseText)})),r.send(g.postData),s||m()}catch(a){e(r.status,r.statusText,{url:c,exception:a})}},o.defaultFailureCallback=function(a,b,c){403==a?this.raiseError(j.ErrorCodes.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:c.url,httpStatus:a,httpStatusText:b}):404==a?this.raiseError(j.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:c.url,httpStatus:a,httpStatusText:b}):a>=500&&a<600?this.raiseError(j.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:c.url,httpStatus:a,httpStatusText:b}):c.exception?this.raiseError(j.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:c.url,exception:c.exception.toString(),stack:c.exception.stack}):this.raiseError(j.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:c.url,httpStatus:a,httpStatusText:b,data:c})},o.getItem=function(a,b,c,d,e){e=e||{},h(a,e),o.rawGet(a.endpoint,"items",b,c,d,e)},o.getManifest=function(a,b,c,d,e){e=e||{},e.hasOwnProperty("responseType")||(e.responseType="json"),h(a,e),o.rawGet(a.endpoint,"bubbles",b,c,d,e)},o.getThumbnail=function(a,b,c,d,e){e=e||{},h(a,e);var f=e.queryParams||"",g=[];if(-1===f.indexOf("guid=")&&g.push("guid="+encodeURIComponent(e.guid)),-1===f.indexOf("role=")){var i=e.role||"rendered";g.push("role="+i)}if(-1===f.indexOf("width=")){var j=e.size||400;g.push("width="+j)}if(-1===f.indexOf("height=")){var j=e.size||400;g.push("height="+j)}-1===f.indexOf("acmsession=")&&e.acmsession&&g.push("acmsession="+e.acmsession);var k=g.join("&");e.queryParams?e.queryParams=e.queryParams+"&"+k:e.queryParams=k,o.rawGet(a.endpoint,"thumbnails",b,c,d,e)},o.getACMSession=function(a,b,c,d){var e,f={};for(var g in b)"oauth2AccessToken"===g?e=b[g]:-1!==g.indexOf("x-ads-acm")&&(f[g]=b[g]);f.application="autodesk";var h=new XMLHttpRequest;h.open("POST",a+"/oss-ext/v2/acmsessions",!0),h.setRequestHeader("Content-Type","application/json"),h.setRequestHeader("Authorization","Bearer "+e),h.responseType="json",h.onload=function(){if(200===h.status&&h.response){var a="string"==typeof h.response?JSON.parse(h.response):h.response;a&&a.acmsession?c(a.acmsession):d(h.status,"Can't get acm session from response.")}else d(h.status)},h.onerror=d,h.ontimeout=d,h.send(JSON.stringify(f)),delete f.application}},function(a,b){"use strict";function c(a){return"ErrorCode:"+a+"."}function d(a){return 403===a||401===a?e.NETWORK_ACCESS_DENIED:404===a?e.NETWORK_FILE_NOT_FOUND:a>=500?e.NETWORK_SERVER_ERROR:e.NETWORK_UNHANDLED_RESPONSE_CODE}Object.defineProperty(b,"__esModule",{value:!0}),b.errorCodeString=c,b.getErrorCode=d;var e=b.ErrorCodes={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,BAD_DATA_MODEL_IS_EMPTY:11,RTC_ERROR:12,UNSUPORTED_FILE_EXTENSION:13,VIEWER_INTERNAL_ERROR:14,WEBGL_LOST_CONTEXT:15}},function(a,b){"use strict";function c(a,b,c){var d,e,f,g,h,i;for(d="",f=c,e=0;e<f;)switch((g=a[b+e++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(g);break;case 12:case 13:h=a[b+e++],d+=String.fromCharCode((31&g)<<6|63&h);break;case 14:h=a[b+e++],i=a[b+e++],d+=String.fromCharCode((15&g)<<12|(63&h)<<6|(63&i)<<0)}return d}function d(a,b,c){var d,e,f,g,h,i,j,k;for(d="",h=[],f=c,i=0,e=0;e<f;){switch((g=a[b+e++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:h.push(String.fromCharCode(g));break;case 12:case 13:j=a[b+e++],h.push(String.fromCharCode((31&g)<<6|63&j));break;case 14:j=a[b+e++],k=a[b+e++],h.push(String.fromCharCode((15&g)<<12|(63&j)<<6|(63&k)<<0))}(++i>=32768||e>=f)&&(d+=h.join(""),h.length=0,i=0)}return d}function e(a,b,c){var d,e,f,g=c||0;if(e=a.length,b)for(d=0;d<e;d++)f=a.charCodeAt(d),f>=1&&f<=127?b[g++]=f:f>2047?(b[g++]=224|f>>12&15,b[g++]=128|f>>6&63,b[g++]=128|f>>0&63):(b[g++]=192|f>>6&31,b[g++]=128|f>>0&63);else for(d=0;d<e;d++)f=a.charCodeAt(d),f>=1&&f<=127?g++:g+=f>2047?3:2;return g-(c||0)}function f(a,b,e){if(void 0===b&&(b=0),void 0===e&&(e=a.length),m)return e>n?d(a,b,e):c(a,b,e);for(var f="",g=b,h=b+e;g<h;g++)f+=String.fromCharCode(a[g]);return decodeURIComponent(escape(f))}function g(a){var b=f(a,0,a.length);return JSON.parse(b)}function h(a,b){if(void 0===b)return"";for(var c=b;c<a.length-1;){var d=a[c];if(44==d&&(10==a[c+1]||13==a[c+1]))break;if(10==d||13==d)break;c++}var e=f(a,b,c-b);try{return JSON.parse(e)}catch(a){return console.error("Error parsing property blob to JSON : "+e),e}}function i(a,b){var c=0,d=b;for(34==a[d]&&d++;d<a.length-1;){var e=a[d];if(44==e&&(10==a[d+1]||13==a[d+1]))break;if(10==e||13==e||34==e)break;e>=48&&e<=57&&(c=10*c+(e-48)),d++}return c}function j(a,b){for(var c=0,d=0,e=a.length;d<e;d++)44==a[d]&&c++;c++;var f=new Uint32Array(c+(b?1:0));d=0;for(var g=a.length;91!=a[d]&&d<g;)d++;if(d==a.length)return null;d++;var h=!1;c=0;for(var i=0;d<g;){var j=a[d];j>=48&&j<=57?(i=10*i+(j-48),h=!0):44==j||93==j?h&&(f[c++]=i,h=!1,i=0):(h=!1,i=0),d++}return f}function k(a){for(var b=0,c=a.length-1,d=0;d<c;d++)44!=a[d]||10!=a[d+1]&&13!=a[d+1]||b++;if(!b)return null;b++;var e=new Uint32Array(b);for(d=0,b=0;91!=a[d]&&d<c;)d++;d++,e[b++]=d;for(var f=!1;d<c;)10==a[d]||13==a[d]?f=!0:f&&(f=!1,e[b++]=d),d++;return e}function l(a,b,c){for(var d=[],e=0;e<c;e++){var f=a[b+e],g=o[f];d.push(g)}return d.join("")}Object.defineProperty(b,"__esModule",{value:!0}),b.utf8BlobToStr=c,b.safeUtf8BlobToStr=d,b.utf16to8=e,b.utf8ArrayToString=f,b.blobToJson=g,b.subBlobToJson=h,b.subBlobToJsonInt=i,b.parseIntArray=j,b.findValueOffsets=k,b.getHexString=l
;for(var m=!0,n=1048576,o=new Array(256),p=0;p<256;p++){var q=p.toString(16);1===q.length&&(q="0"+q),o[p]=q}},function(a,b,c){"use strict";var d=c(16).assign,e=c(17),f=c(25),g=c(29),h={};d(h,e,f,g),a.exports=h},function(a,b){"use strict";function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var d="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;b.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var d=b.shift();if(d){if("object"!=typeof d)throw new TypeError(d+"must be non-object");for(var e in d)c(d,e)&&(a[e]=d[e])}}return a},b.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var e={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;b<c;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;b<c;b++)f=a[b],g.set(f,e),e+=f.length;return g}},f={arraySet:function(a,b,c,d,e){for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};b.setTyped=function(a){a?(b.Buf8=Uint8Array,b.Buf16=Uint16Array,b.Buf32=Int32Array,b.assign(b,e)):(b.Buf8=Array,b.Buf16=Array,b.Buf32=Array,b.assign(b,f))},b.setTyped(d)},function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=i.assign({level:o,method:q,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},a||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=h.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(c!==n)throw new Error(k[c]);if(b.header&&h.deflateSetHeader(this.strm,b.header),b.dictionary){var e;if(e="string"==typeof b.dictionary?j.string2buf(b.dictionary):"[object ArrayBuffer]"===m.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,(c=h.deflateSetDictionary(this.strm,e))!==n)throw new Error(k[c]);this._dict_set=!0}}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}function g(a,b){return b=b||{},b.gzip=!0,e(a,b)}var h=c(18),i=c(16),j=c(23),k=c(22),l=c(24),m=Object.prototype.toString,n=0,o=-1,p=0,q=8;d.prototype.push=function(a,b){var c,d,e=this.strm,f=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:!0===b?4:0,"string"==typeof a?e.input=j.string2buf(a):"[object ArrayBuffer]"===m.call(a)?e.input=new Uint8Array(a):e.input=a,e.next_in=0,e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new i.Buf8(f),e.next_out=0,e.avail_out=f),1!==(c=h.deflate(e,d))&&c!==n)return this.onEnd(c),this.ended=!0,!1;0!==e.avail_out&&(0!==e.avail_in||4!==d&&2!==d)||("string"===this.options.to?this.onData(j.buf2binstring(i.shrinkBuf(e.output,e.next_out))):this.onData(i.shrinkBuf(e.output,e.next_out)))}while((e.avail_in>0||0===e.avail_out)&&1!==c);return 4===d?(c=h.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===n):2!==d||(this.onEnd(n),e.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===n&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},b.Deflate=d,b.deflate=e,b.deflateRaw=f,b.gzip=g},function(a,b,c){"use strict";function d(a,b){return a.msg=I[b],b}function e(a){return(a<<1)-(a>4?9:0)}function f(a){for(var b=a.length;--b>=0;)a[b]=0}function g(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(E.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function h(a,b){F._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,g(a.strm)}function i(a,b){a.pending_buf[a.pending++]=b}function j(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b}function k(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,E.arraySet(b,a.input,a.next_in,e,c),1===a.state.wrap?a.adler=G(a.adler,b,e,c):2===a.state.wrap&&(a.adler=H(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)}function l(a,b){var c,d,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-ja?a.strstart-(a.w_size-ja):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+ia,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do{if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do{}while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&f<m);if(d=ia-(m-f),f=m-ia,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}}while((b=l[b&k])>i&&0!=--e);return g<=a.lookahead?g:a.lookahead}function m(a){var b,c,d,e,f,g=a.w_size;do{if(e=a.window_size-a.lookahead-a.strstart,a.strstart>=g+(g-ja)){E.arraySet(a.window,a.window,g,g,0),a.match_start-=g,a.strstart-=g,a.block_start-=g,c=a.hash_size,b=c;do{d=a.head[--b],a.head[b]=d>=g?d-g:0}while(--c);c=g,b=c;do{d=a.prev[--b],a.prev[b]=d>=g?d-g:0}while(--c);e+=g}if(0===a.strm.avail_in)break;if(c=k(a.strm,a.window,a.strstart+a.lookahead,e),a.lookahead+=c,a.lookahead+a.insert>=ha)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+ha-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,!(a.lookahead+a.insert<ha)););}while(a.lookahead<ja&&0!==a.strm.avail_in)}function n(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(a.lookahead<=1){if(m(a),0===a.lookahead&&b===J)return sa;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,h(a,!1),0===a.strm.avail_out))return sa;if(a.strstart-a.block_start>=a.w_size-ja&&(h(a,!1),0===a.strm.avail_out))return sa}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?ua:va):(a.strstart>a.block_start&&(h(a,!1),a.strm.avail_out),sa)}function o(a,b){for(var c,d;;){if(a.lookahead<ja){if(m(a),a.lookahead<ja&&b===J)return sa;if(0===a.lookahead)break}if(c=0,a.lookahead>=ha&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ha-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-ja&&(a.match_length=l(a,c)),a.match_length>=ha)if(d=F._tr_tally(a,a.strstart-a.match_start,a.match_length-ha),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=ha){a.match_length--;do{a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ha-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart}while(0!=--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(h(a,!1),0===a.strm.avail_out))return sa}return a.insert=a.strstart<ha-1?a.strstart:ha-1,b===M?(h(a,!0),0===a.strm.avail_out?ua:va):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sa:ta}function p(a,b){for(var c,d,e;;){if(a.lookahead<ja){if(m(a),a.lookahead<ja&&b===J)return sa;if(0===a.lookahead)break}if(c=0,a.lookahead>=ha&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ha-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=ha-1,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-ja&&(a.match_length=l(a,c),a.match_length<=5&&(a.strategy===U||a.match_length===ha&&a.strstart-a.match_start>4096)&&(a.match_length=ha-1)),a.prev_length>=ha&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-ha,d=F._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-ha),a.lookahead-=a.prev_length-1,a.prev_length-=2;do{++a.strstart<=e&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ha-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart)}while(0!=--a.prev_length);if(a.match_available=0,a.match_length=ha-1,a.strstart++,d&&(h(a,!1),0===a.strm.avail_out))return sa}else if(a.match_available){if(d=F._tr_tally(a,0,a.window[a.strstart-1]),d&&h(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return sa}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=F._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<ha-1?a.strstart:ha-1,b===M?(h(a,!0),0===a.strm.avail_out?ua:va):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sa:ta}function q(a,b){for(var c,d,e,f,g=a.window;;){if(a.lookahead<=ia){if(m(a),a.lookahead<=ia&&b===J)return sa;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=ha&&a.strstart>0&&(e=a.strstart-1,(d=g[e])===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+ia;do{}while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&e<f);a.match_length=ia-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=ha?(c=F._tr_tally(a,1,a.match_length-ha),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(h(a,!1),0===a.strm.avail_out))return sa}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?ua:va):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sa:ta}function r(a,b){for(var c;;){if(0===a.lookahead&&(m(a),0===a.lookahead)){if(b===J)return sa;break}if(a.match_length=0,c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(h(a,!1),0===a.strm.avail_out))return sa}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?ua:va):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sa:ta}function s(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}function t(a){a.window_size=2*a.w_size,f(a.head),a.max_lazy_match=D[a.level].max_lazy,a.good_match=D[a.level].good_length,a.nice_match=D[a.level].nice_length,a.max_chain_length=D[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=ha-1,a.match_available=0,a.ins_h=0}function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*fa),this.dyn_dtree=new E.Buf16(2*(2*da+1)),this.bl_tree=new E.Buf16(2*(2*ea+1)),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(ga+1),this.heap=new E.Buf16(2*ca+1),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*ca+1),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(a){var b;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=Z,b=a.state,b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?la:qa,a.adler=2===b.wrap?0:1,b.last_flush=J,F._tr_init(b),O):d(a,Q)}function w(a){var b=v(a);return b===O&&t(a.state),b}function x(a,b){return a&&a.state?2!==a.state.wrap?Q:(a.state.gzhead=b,O):Q}function y(a,b,c,e,f,g){if(!a)return Q;var h=1;if(b===T&&(b=6),e<0?(h=0,e=-e):e>15&&(h=2,e-=16),f<1||f>_||c!==$||e<8||e>15||b<0||b>9||g<0||g>X)return d(a,Q);8===e&&(e=9);var i=new u;return a.state=i,i.strm=a,i.wrap=h,i.gzhead=null,i.w_bits=e,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=f+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+ha-1)/ha),i.window=new E.Buf8(2*i.w_size),i.head=new E.Buf16(i.hash_size),i.prev=new E.Buf16(i.w_size),i.lit_bufsize=1<<f+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new E.Buf8(i.pending_buf_size),i.d_buf=1*i.lit_bufsize,i.l_buf=3*i.lit_bufsize,i.level=b,i.strategy=g,i.method=c,w(a)}function z(a,b){return y(a,b,$,aa,ba,Y)}function A(a,b){var c,h,k,l;if(!a||!a.state||b>N||b<0)return a?d(a,Q):Q;if(h=a.state,!a.output||!a.input&&0!==a.avail_in||h.status===ra&&b!==M)return d(a,0===a.avail_out?S:Q);if(h.strm=a,c=h.last_flush,h.last_flush=b,h.status===la)if(2===h.wrap)a.adler=0,i(h,31),i(h,139),i(h,8),h.gzhead?(i(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),i(h,255&h.gzhead.time),i(h,h.gzhead.time>>8&255),i(h,h.gzhead.time>>16&255),i(h,h.gzhead.time>>24&255),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(i(h,255&h.gzhead.extra.length),i(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=H(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=ma):(i(h,0),i(h,0),i(h,0),i(h,0),i(h,0),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,wa),h.status=qa);else{var m=$+(h.w_bits-8<<4)<<8,n=-1;n=h.strategy>=V||h.level<2?0:h.level<6?1:6===h.level?2:3,m|=n<<6,0!==h.strstart&&(m|=ka),m+=31-m%31,h.status=qa,j(h,m),0!==h.strstart&&(j(h,a.adler>>>16),j(h,65535&a.adler)),a.adler=1}if(h.status===ma)if(h.gzhead.extra){for(k=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending!==h.pending_buf_size));)i(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=na)}else h.status=na;if(h.status===na)if(h.gzhead.name){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.gzindex=0,h.status=oa)}else h.status=oa;if(h.status===oa)if(h.gzhead.comment){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.status=pa)}else h.status=pa;if(h.status===pa&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&g(a),h.pending+2<=h.pending_buf_size&&(i(h,255&a.adler),i(h,a.adler>>8&255),a.adler=0,h.status=qa)):h.status=qa),0!==h.pending){if(g(a),0===a.avail_out)return h.last_flush=-1,O}else if(0===a.avail_in&&e(b)<=e(c)&&b!==M)return d(a,S);if(h.status===ra&&0!==a.avail_in)return d(a,S);if(0!==a.avail_in||0!==h.lookahead||b!==J&&h.status!==ra){var o=h.strategy===V?r(h,b):h.strategy===W?q(h,b):D[h.level].func(h,b);if(o!==ua&&o!==va||(h.status=ra),o===sa||o===ua)return 0===a.avail_out&&(h.last_flush=-1),O;if(o===ta&&(b===K?F._tr_align(h):b!==N&&(F._tr_stored_block(h,0,0,!1),b===L&&(f(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),g(a),0===a.avail_out))return h.last_flush=-1,O}return b!==M?O:h.wrap<=0?P:(2===h.wrap?(i(h,255&a.adler),i(h,a.adler>>8&255),i(h,a.adler>>16&255),i(h,a.adler>>24&255),i(h,255&a.total_in),i(h,a.total_in>>8&255),i(h,a.total_in>>16&255),i(h,a.total_in>>24&255)):(j(h,a.adler>>>16),j(h,65535&a.adler)),g(a),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?O:P)}function B(a){var b;return a&&a.state?(b=a.state.status)!==la&&b!==ma&&b!==na&&b!==oa&&b!==pa&&b!==qa&&b!==ra?d(a,Q):(a.state=null,b===qa?d(a,R):O):Q}function C(a,b){var c,d,e,g,h,i,j,k,l=b.length;if(!a||!a.state)return Q;if(c=a.state,2===(g=c.wrap)||1===g&&c.status!==la||c.lookahead)return Q;for(1===g&&(a.adler=G(a.adler,b,l,0)),c.wrap=0,l>=c.w_size&&(0===g&&(f(c.head),c.strstart=0,c.block_start=0,c.insert=0),k=new E.Buf8(c.w_size),E.arraySet(k,b,l-c.w_size,c.w_size,0),b=k,l=c.w_size),h=a.avail_in,i=a.next_in,j=a.input,a.avail_in=l,a.next_in=0,a.input=b,m(c);c.lookahead>=ha;){d=c.strstart,e=c.lookahead-(ha-1);do{c.ins_h=(c.ins_h<<c.hash_shift^c.window[d+ha-1])&c.hash_mask,c.prev[d&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=d,d++}while(--e);c.strstart=d,c.lookahead=ha-1,m(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=ha-1,c.match_available=0,a.next_in=i,a.input=j,a.avail_in=h,c.wrap=g,O}var D,E=c(16),F=c(19),G=c(20),H=c(21),I=c(22),J=0,K=1,L=3,M=4,N=5,O=0,P=1,Q=-2,R=-3,S=-5,T=-1,U=1,V=2,W=3,X=4,Y=0,Z=2,$=8,_=9,aa=15,ba=8,ca=286,da=30,ea=19,fa=2*ca+1,ga=15,ha=3,ia=258,ja=ia+ha+1,ka=32,la=42,ma=69,na=73,oa=91,pa=103,qa=113,ra=666,sa=1,ta=2,ua=3,va=4,wa=3;D=[new s(0,0,0,0,n),new s(4,4,8,4,o),new s(4,5,16,8,o),new s(4,6,32,32,o),new s(4,4,16,16,p),new s(8,16,32,32,p),new s(8,16,128,128,p),new s(8,32,128,256,p),new s(32,128,258,1024,p),new s(32,258,258,4096,p)],b.deflateInit=z,b.deflateInit2=y,b.deflateReset=w,b.deflateResetKeep=v,b.deflateSetHeader=x,b.deflate=A,b.deflateEnd=B,b.deflateSetDictionary=C,b.deflateInfo="pako deflate (from Nodeca project)"},function(a,b,c){"use strict";function d(a){for(var b=a.length;--b>=0;)a[b]=0}function e(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}function f(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function g(a){return a<256?fa[a]:fa[256+(a>>>7)]}function h(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255}function i(a,b,c){a.bi_valid>V-c?(a.bi_buf|=b<<a.bi_valid&65535,h(a,a.bi_buf),a.bi_buf=b>>V-a.bi_valid,a.bi_valid+=c-V):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function j(a,b,c){i(a,c[2*b],c[2*b+1])}function k(a,b){var c=0;do{c|=1&a,a>>>=1,c<<=1}while(--b>0);return c>>>1}function l(a){16===a.bi_valid?(h(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}function m(a,b){var c,d,e,f,g,h,i=b.dyn_tree,j=b.max_code,k=b.stat_desc.static_tree,l=b.stat_desc.has_stree,m=b.stat_desc.extra_bits,n=b.stat_desc.extra_base,o=b.stat_desc.max_length,p=0;for(f=0;f<=U;f++)a.bl_count[f]=0;for(i[2*a.heap[a.heap_max]+1]=0,c=a.heap_max+1;c<T;c++)d=a.heap[c],f=i[2*i[2*d+1]+1]+1,f>o&&(f=o,p++),i[2*d+1]=f,d>j||(a.bl_count[f]++,g=0,d>=n&&(g=m[d-n]),h=i[2*d],a.opt_len+=h*(f+g),l&&(a.static_len+=h*(k[2*d+1]+g)));if(0!==p){do{for(f=o-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[o]--,p-=2}while(p>0);for(f=o;0!==f;f--)for(d=a.bl_count[f];0!==d;)(e=a.heap[--c])>j||(i[2*e+1]!==f&&(a.opt_len+=(f-i[2*e+1])*i[2*e],i[2*e+1]=f),d--)}}function n(a,b,c){var d,e,f=new Array(U+1),g=0;for(d=1;d<=U;d++)f[d]=g=g+c[d-1]<<1;for(e=0;e<=b;e++){var h=a[2*e+1];0!==h&&(a[2*e]=k(f[h]++,h))}}function o(){var a,b,c,d,f,g=new Array(U+1);for(c=0,d=0;d<O-1;d++)for(ha[d]=c,a=0;a<1<<_[d];a++)ga[c++]=d;for(ga[c-1]=d,f=0,d=0;d<16;d++)for(ia[d]=f,a=0;a<1<<aa[d];a++)fa[f++]=d;for(f>>=7;d<R;d++)for(ia[d]=f<<7,a=0;a<1<<aa[d]-7;a++)fa[256+f++]=d;for(b=0;b<=U;b++)g[b]=0;for(a=0;a<=143;)da[2*a+1]=8,a++,g[8]++;for(;a<=255;)da[2*a+1]=9,a++,g[9]++;for(;a<=279;)da[2*a+1]=7,a++,g[7]++;for(;a<=287;)da[2*a+1]=8,a++,g[8]++;for(n(da,Q+1,g),a=0;a<R;a++)ea[2*a+1]=5,ea[2*a]=k(a,5);ja=new e(da,_,P+1,Q,U),ka=new e(ea,aa,0,R,U),la=new e(new Array(0),ba,0,S,W)}function p(a){var b;for(b=0;b<Q;b++)a.dyn_ltree[2*b]=0;for(b=0;b<R;b++)a.dyn_dtree[2*b]=0;for(b=0;b<S;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*X]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function q(a){a.bi_valid>8?h(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function r(a,b,c,d){q(a),d&&(h(a,c),h(a,~c)),G.arraySet(a.pending_buf,a.window,b,c,a.pending),a.pending+=c}function s(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function t(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&s(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!s(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function u(a,b,c){var d,e,f,h,k=0;if(0!==a.last_lit)do{d=a.pending_buf[a.d_buf+2*k]<<8|a.pending_buf[a.d_buf+2*k+1],e=a.pending_buf[a.l_buf+k],k++,0===d?j(a,e,b):(f=ga[e],j(a,f+P+1,b),h=_[f],0!==h&&(e-=ha[f],i(a,e,h)),d--,f=g(d),j(a,f,c),0!==(h=aa[f])&&(d-=ia[f],i(a,d,h)))}while(k<a.last_lit);j(a,X,b)}function v(a,b){var c,d,e,f=b.dyn_tree,g=b.stat_desc.static_tree,h=b.stat_desc.has_stree,i=b.stat_desc.elems,j=-1;for(a.heap_len=0,a.heap_max=T,c=0;c<i;c++)0!==f[2*c]?(a.heap[++a.heap_len]=j=c,a.depth[c]=0):f[2*c+1]=0;for(;a.heap_len<2;)e=a.heap[++a.heap_len]=j<2?++j:0,f[2*e]=1,a.depth[e]=0,a.opt_len--,h&&(a.static_len-=g[2*e+1]);for(b.max_code=j,c=a.heap_len>>1;c>=1;c--)t(a,f,c);e=i;do{c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],t(a,f,1),d=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=d,f[2*e]=f[2*c]+f[2*d],a.depth[e]=(a.depth[c]>=a.depth[d]?a.depth[c]:a.depth[d])+1,f[2*c+1]=f[2*d+1]=e,a.heap[1]=e++,t(a,f,1)}while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],m(a,b),n(f,j,a.bl_count)}function w(a,b,c){var d,e,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;d<=c;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(h<j?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[2*Y]++):h<=10?a.bl_tree[2*Z]++:a.bl_tree[2*$]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))}function x(a,b,c){var d,e,f=-1,g=b[1],h=0,k=7,l=4;for(0===g&&(k=138,l=3),d=0;d<=c;d++)if(e=g,g=b[2*(d+1)+1],!(++h<k&&e===g)){if(h<l)do{j(a,e,a.bl_tree)}while(0!=--h);else 0!==e?(e!==f&&(j(a,e,a.bl_tree),h--),j(a,Y,a.bl_tree),i(a,h-3,2)):h<=10?(j(a,Z,a.bl_tree),i(a,h-3,3)):(j(a,$,a.bl_tree),i(a,h-11,7));h=0,f=e,0===g?(k=138,l=3):e===g?(k=6,l=3):(k=7,l=4)}}function y(a){var b;for(w(a,a.dyn_ltree,a.l_desc.max_code),w(a,a.dyn_dtree,a.d_desc.max_code),v(a,a.bl_desc),b=S-1;b>=3&&0===a.bl_tree[2*ca[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}function z(a,b,c,d){var e;for(i(a,b-257,5),i(a,c-1,5),i(a,d-4,4),e=0;e<d;e++)i(a,a.bl_tree[2*ca[e]+1],3);x(a,a.dyn_ltree,b-1),x(a,a.dyn_dtree,c-1)}function A(a){var b,c=4093624447;for(b=0;b<=31;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return I;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return J;for(b=32;b<P;b++)if(0!==a.dyn_ltree[2*b])return J;return I}function B(a){ma||(o(),ma=!0),a.l_desc=new f(a.dyn_ltree,ja),a.d_desc=new f(a.dyn_dtree,ka),a.bl_desc=new f(a.bl_tree,la),a.bi_buf=0,a.bi_valid=0,p(a)}function C(a,b,c,d){i(a,(L<<1)+(d?1:0),3),r(a,b,c,!0)}function D(a){i(a,M<<1,3),j(a,X,da),l(a)}function E(a,b,c,d){var e,f,g=0;a.level>0?(a.strm.data_type===K&&(a.strm.data_type=A(a)),v(a,a.l_desc),v(a,a.d_desc),g=y(a),e=a.opt_len+3+7>>>3,(f=a.static_len+3+7>>>3)<=e&&(e=f)):e=f=c+5,c+4<=e&&-1!==b?C(a,b,c,d):a.strategy===H||f===e?(i(a,(M<<1)+(d?1:0),3),u(a,da,ea)):(i(a,(N<<1)+(d?1:0),3),z(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),u(a,a.dyn_ltree,a.dyn_dtree)),p(a),d&&q(a)}function F(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(ga[c]+P+1)]++,a.dyn_dtree[2*g(b)]++),a.last_lit===a.lit_bufsize-1}var G=c(16),H=4,I=0,J=1,K=2,L=0,M=1,N=2,O=29,P=256,Q=P+1+O,R=30,S=19,T=2*Q+1,U=15,V=16,W=7,X=256,Y=16,Z=17,$=18,_=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],aa=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ba=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],da=new Array(2*(Q+2));d(da);var ea=new Array(2*R);d(ea);var fa=new Array(512);d(fa);var ga=new Array(256);d(ga);var ha=new Array(O);d(ha);var ia=new Array(R);d(ia);var ja,ka,la,ma=!1;b._tr_init=B,b._tr_stored_block=C,b._tr_flush_block=E,b._tr_tally=F,b._tr_align=D},function(a,b){"use strict";function c(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do{e=e+b[d++]|0,f=f+e|0}while(--g);e%=65521,f%=65521}return e|f<<16|0}a.exports=c},function(a,b){"use strict";function c(a,b,c,e){var f=d,g=e+c;a^=-1;for(var h=e;h<g;h++)a=a>>>8^f[255&(a^b[h])];return-1^a}var d=function(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}();a.exports=c},function(a,b){"use strict";a.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(a,b,c){"use strict";function d(a,b){if(b<65537&&(a.subarray&&g||!a.subarray&&f))return String.fromCharCode.apply(null,e.shrinkBuf(a,b));for(var c="",d=0;d<b;d++)c+=String.fromCharCode(a[d]);return c}var e=c(16),f=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(a){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){g=!1}for(var h=new e.Buf8(256),i=0;i<256;i++)h[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;h[254]=h[254]=1,b.string2buf=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;f<h;f++)c=a.charCodeAt(f),55296==(64512&c)&&f+1<h&&56320==(64512&(d=a.charCodeAt(f+1)))&&(c=65536+(c-55296<<10)+(d-56320),f++),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=new e.Buf8(i),g=0,f=0;g<i;f++)c=a.charCodeAt(f),55296==(64512&c)&&f+1<h&&56320==(64512&(d=a.charCodeAt(f+1)))&&(c=65536+(c-55296<<10)+(d-56320),f++),c<128?b[g++]=c:c<2048?(b[g++]=192|c>>>6,b[g++]=128|63&c):c<65536?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},b.buf2binstring=function(a){return d(a,a.length)},b.binstring2buf=function(a){for(var b=new e.Buf8(a.length),c=0,d=b.length;c<d;c++)b[c]=a.charCodeAt(c);return b},b.buf2string=function(a,b){var c,e,f,g,i=b||a.length,j=new Array(2*i);for(e=0,c=0;c<i;)if((f=a[c++])<128)j[e++]=f;else if((g=h[f])>4)j[e++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;g>1&&c<i;)f=f<<6|63&a[c++],g--;g>1?j[e++]=65533:f<65536?j[e++]=f:(f-=65536,j[e++]=55296|f>>10&1023,j[e++]=56320|1023&f)}return d(j,e)},b.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128==(192&a[c]);)c--;return c<0?b:0===c?b:c+h[a[c]]>b?c:b}},function(a,b){"use strict";function c(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}a.exports=c},function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=h.assign({chunkSize:16384,windowBits:0,to:""},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0==(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=g.inflateInit2(this.strm,b.windowBits);if(c!==j.Z_OK)throw new Error(k[c]);this.header=new m,g.inflateGetHeader(this.strm,this.header)}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}var g=c(26),h=c(16),i=c(23),j=c(29),k=c(22),l=c(24),m=c(30),n=Object.prototype.toString;d.prototype.push=function(a,b){var c,d,e,f,k,l,m=this.strm,o=this.options.chunkSize,p=this.options.dictionary,q=!1;if(this.ended)return!1;d=b===~~b?b:!0===b?j.Z_FINISH:j.Z_NO_FLUSH,"string"==typeof a?m.input=i.binstring2buf(a):"[object ArrayBuffer]"===n.call(a)?m.input=new Uint8Array(a):m.input=a,m.next_in=0,m.avail_in=m.input.length;do{if(0===m.avail_out&&(m.output=new h.Buf8(o),m.next_out=0,m.avail_out=o),c=g.inflate(m,j.Z_NO_FLUSH),c===j.Z_NEED_DICT&&p&&(l="string"==typeof p?i.string2buf(p):"[object ArrayBuffer]"===n.call(p)?new Uint8Array(p):p,c=g.inflateSetDictionary(this.strm,l)),c===j.Z_BUF_ERROR&&!0===q&&(c=j.Z_OK,q=!1),c!==j.Z_STREAM_END&&c!==j.Z_OK)return this.onEnd(c),this.ended=!0,!1;m.next_out&&(0!==m.avail_out&&c!==j.Z_STREAM_END&&(0!==m.avail_in||d!==j.Z_FINISH&&d!==j.Z_SYNC_FLUSH)||("string"===this.options.to?(e=i.utf8border(m.output,m.next_out),f=m.next_out-e,k=i.buf2string(m.output,e),m.next_out=f,m.avail_out=o-f,f&&h.arraySet(m.output,m.output,e,f,0),this.onData(k)):this.onData(h.shrinkBuf(m.output,m.next_out)))),0===m.avail_in&&0===m.avail_out&&(q=!0)}while((m.avail_in>0||0===m.avail_out)&&c!==j.Z_STREAM_END);return c===j.Z_STREAM_END&&(d=j.Z_FINISH),d===j.Z_FINISH?(c=g.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===j.Z_OK):d!==j.Z_SYNC_FLUSH||(this.onEnd(j.Z_OK),m.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===j.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},b.Inflate=d,b.inflate=e,b.inflateRaw=f,b.ungzip=e},function(a,b,c){"use strict";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=L,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new s.Buf32(pa),b.distcode=b.distdyn=new s.Buf32(qa),b.sane=1,b.back=-1,D):G}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):G}function h(a,b){var c,d;return a&&a.state?(d=a.state,b<0?(c=0,b=-b):(c=1+(b>>4),b<48&&(b&=15)),b&&(b<8||b>15)?G:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):G}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==D&&(a.state=null),c):G}function j(a){return i(a,ra)}function k(a){if(sa){var b;for(q=new s.Buf32(512),r=new s.Buf32(32),b=0;b<144;)a.lens[b++]=8;for(;b<256;)a.lens[b++]=9;for(;b<280;)a.lens[b++]=7;for(;b<288;)a.lens[b++]=8;for(w(y,a.lens,0,288,q,0,a.work,{bits:9}),b=0;b<32;)a.lens[b++]=5;w(z,a.lens,0,32,r,0,a.work,{bits:5}),sa=!1}a.lencode=q,a.lenbits=9,a.distcode=r,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new s.Buf8(f.wsize)),d>=f.wsize?(s.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),s.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(s.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,r,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa=0,Ba=new s.Buf8(4),Ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return G;c=a.state,c.mode===W&&(c.mode=X),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,
m=c.hold,n=c.bits,o=i,p=j,xa=D;a:for(;;)switch(c.mode){case L:if(0===c.wrap){c.mode=X;break}for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0),m=0,n=0,c.mode=M;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg="incorrect header check",c.mode=ma;break}if((15&m)!==K){a.msg="unknown compression method",c.mode=ma;break}if(m>>>=4,n-=4,wa=8+(15&m),0===c.wbits)c.wbits=wa;else if(wa>c.wbits){a.msg="invalid window size",c.mode=ma;break}c.dmax=1<<wa,a.adler=c.check=1,c.mode=512&m?U:W,m=0,n=0;break;case M:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==K){a.msg="unknown compression method",c.mode=ma;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=ma;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=N;case N:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,Ba[2]=m>>>16&255,Ba[3]=m>>>24&255,c.check=u(c.check,Ba,4,0)),m=0,n=0,c.mode=O;case O:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=P;case P:if(1024&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=Q;case Q:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wa=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),s.arraySet(c.head.extra,e,g,q,wa)),512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=R;case R:if(2048&c.flags){if(0===i)break a;q=0;do{wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.name+=String.fromCharCode(wa))}while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=S;case S:if(4096&c.flags){if(0===i)break a;q=0;do{wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.comment+=String.fromCharCode(wa))}while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.comment=null);c.mode=T;case T:if(512&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg="header crc mismatch",c.mode=ma;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=W;break;case U:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=V;case V:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,F;a.adler=c.check=1,c.mode=W;case W:if(b===B||b===C)break a;case X:if(c.last){m>>>=7&n,n-=7&n,c.mode=ja;break}for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=Y;break;case 1:if(k(c),c.mode=ca,b===C){m>>>=2,n-=2;break a}break;case 2:c.mode=_;break;case 3:a.msg="invalid block type",c.mode=ma}m>>>=2,n-=2;break;case Y:for(m>>>=7&n,n-=7&n;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!=(m>>>16^65535)){a.msg="invalid stored block lengths",c.mode=ma;break}if(c.length=65535&m,m=0,n=0,c.mode=Z,b===C)break a;case Z:c.mode=$;case $:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;s.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=W;break;case _:for(;n<14;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=257+(31&m),m>>>=5,n-=5,c.ndist=1+(31&m),m>>>=5,n-=5,c.ncode=4+(15&m),m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=ma;break}c.have=0,c.mode=aa;case aa:for(;c.have<c.ncode;){for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Ca[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Ca[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ya={bits:c.lenbits},xa=w(x,c.lens,0,19,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid code lengths set",c.mode=ma;break}c.have=0,c.mode=ba;case ba:for(;c.have<c.nlen+c.ndist;){for(;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(sa<16)m>>>=qa,n-=qa,c.lens[c.have++]=sa;else{if(16===sa){for(za=qa+2;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qa,n-=qa,0===c.have){a.msg="invalid bit length repeat",c.mode=ma;break}wa=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sa){for(za=qa+3;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=3+(7&m),m>>>=3,n-=3}else{for(za=qa+7;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=ma;break}for(;q--;)c.lens[c.have++]=wa}}if(c.mode===ma)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=ma;break}if(c.lenbits=9,ya={bits:c.lenbits},xa=w(y,c.lens,0,c.nlen,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid literal/lengths set",c.mode=ma;break}if(c.distbits=6,c.distcode=c.distdyn,ya={bits:c.distbits},xa=w(z,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ya),c.distbits=ya.bits,xa){a.msg="invalid distances set",c.mode=ma;break}if(c.mode=ca,b===C)break a;case ca:c.mode=da;case da:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,v(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===W&&(c.back=-1);break}for(c.back=0;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(ra&&0==(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.lencode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,c.length=sa,0===ra){c.mode=ia;break}if(32&ra){c.back=-1,c.mode=W;break}if(64&ra){a.msg="invalid literal/length code",c.mode=ma;break}c.extra=15&ra,c.mode=ea;case ea:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=fa;case fa:for(;Aa=c.distcode[m&(1<<c.distbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0==(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.distcode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,64&ra){a.msg="invalid distance code",c.mode=ma;break}c.offset=sa,c.extra=15&ra,c.mode=ga;case ga:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=ma;break}c.mode=ha;case ha:if(0===j)break a;if(q=p-j,c.offset>q){if((q=c.offset-q)>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=ma;break}q>c.wnext?(q-=c.wnext,r=c.wsize-q):r=c.wnext-q,q>c.length&&(q=c.length),pa=c.window}else pa=f,r=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do{f[h++]=pa[r++]}while(--q);0===c.length&&(c.mode=da);break;case ia:if(0===j)break a;f[h++]=c.length,j--,c.mode=da;break;case ja:if(c.wrap){for(;n<32;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?u(c.check,f,p,h-p):t(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg="incorrect data check",c.mode=ma;break}m=0,n=0}c.mode=ka;case ka:if(c.wrap&&c.flags){for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=ma;break}m=0,n=0}c.mode=la;case la:xa=E;break a;case ma:xa=H;break a;case na:return I;case oa:default:return G}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<ma&&(c.mode<ja||b!==A))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=na,I):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?u(c.check,f,p,a.next_out-p):t(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===W?128:0)+(c.mode===ca||c.mode===Z?256:0),(0===o&&0===p||b===A)&&xa===D&&(xa=J),xa)}function n(a){if(!a||!a.state)return G;var b=a.state;return b.window&&(b.window=null),a.state=null,D}function o(a,b){var c;return a&&a.state?(c=a.state,0==(2&c.wrap)?G:(c.head=b,b.done=!1,D)):G}function p(a,b){var c,d,e=b.length;return a&&a.state?(c=a.state,0!==c.wrap&&c.mode!==V?G:c.mode===V&&(d=1,(d=t(d,b,e,0))!==c.check)?H:l(a,b,e,e)?(c.mode=na,I):(c.havedict=1,D)):G}var q,r,s=c(16),t=c(20),u=c(21),v=c(27),w=c(28),x=0,y=1,z=2,A=4,B=5,C=6,D=0,E=1,F=2,G=-2,H=-3,I=-4,J=-5,K=8,L=1,M=2,N=3,O=4,P=5,Q=6,R=7,S=8,T=9,U=10,V=11,W=12,X=13,Y=14,Z=15,$=16,_=17,aa=18,ba=19,ca=20,da=21,ea=22,fa=23,ga=24,ha=25,ia=26,ja=27,ka=28,la=29,ma=30,na=31,oa=32,pa=852,qa=592,ra=15,sa=!0;b.inflateReset=g,b.inflateReset2=h,b.inflateResetKeep=f,b.inflateInit=j,b.inflateInit2=i,b.inflate=m,b.inflateEnd=n,b.inflateGetHeader=o,b.inflateSetDictionary=p,b.inflateInfo="pako inflate (from Nodeca project)"},function(a,b){"use strict";a.exports=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;c=a.state,d=a.next_in,z=a.input,e=d+(a.avail_in-5),f=a.next_out,A=a.output,g=f-(b-a.avail_out),h=f+(a.avail_out-257),i=c.dmax,j=c.wsize,k=c.whave,l=c.wnext,m=c.window,n=c.hold,o=c.bits,p=c.lencode,q=c.distcode,r=(1<<c.lenbits)-1,s=(1<<c.distbits)-1;a:do{o<15&&(n+=z[d++]<<o,o+=8,n+=z[d++]<<o,o+=8),t=p[n&r];b:for(;;){if(u=t>>>24,n>>>=u,o-=u,0===(u=t>>>16&255))A[f++]=65535&t;else{if(!(16&u)){if(0==(64&u)){t=p[(65535&t)+(n&(1<<u)-1)];continue b}if(32&u){c.mode=12;break a}a.msg="invalid literal/length code",c.mode=30;break a}v=65535&t,u&=15,u&&(o<u&&(n+=z[d++]<<o,o+=8),v+=n&(1<<u)-1,n>>>=u,o-=u),o<15&&(n+=z[d++]<<o,o+=8,n+=z[d++]<<o,o+=8),t=q[n&s];c:for(;;){if(u=t>>>24,n>>>=u,o-=u,!(16&(u=t>>>16&255))){if(0==(64&u)){t=q[(65535&t)+(n&(1<<u)-1)];continue c}a.msg="invalid distance code",c.mode=30;break a}if(w=65535&t,u&=15,o<u&&(n+=z[d++]<<o,(o+=8)<u&&(n+=z[d++]<<o,o+=8)),(w+=n&(1<<u)-1)>i){a.msg="invalid distance too far back",c.mode=30;break a}if(n>>>=u,o-=u,u=f-g,w>u){if((u=w-u)>k&&c.sane){a.msg="invalid distance too far back",c.mode=30;break a}if(x=0,y=m,0===l){if(x+=j-u,u<v){v-=u;do{A[f++]=m[x++]}while(--u);x=f-w,y=A}}else if(l<u){if(x+=j+l-u,(u-=l)<v){v-=u;do{A[f++]=m[x++]}while(--u);if(x=0,l<v){u=l,v-=u;do{A[f++]=m[x++]}while(--u);x=f-w,y=A}}}else if(x+=l-u,u<v){v-=u;do{A[f++]=m[x++]}while(--u);x=f-w,y=A}for(;v>2;)A[f++]=y[x++],A[f++]=y[x++],A[f++]=y[x++],v-=3;v&&(A[f++]=y[x++],v>1&&(A[f++]=y[x++]))}else{x=f-w;do{A[f++]=A[x++],A[f++]=A[x++],A[f++]=A[x++],v-=3}while(v>2);v&&(A[f++]=A[x++],v>1&&(A[f++]=A[x++]))}break}}break}}while(d<e&&f<h);v=o>>3,d-=v,o-=v<<3,n&=(1<<o)-1,a.next_in=d,a.next_out=f,a.avail_in=d<e?e-d+5:5-(d-e),a.avail_out=f<h?h-f+257:257-(f-h),c.hold=n,c.bits=o}},function(a,b,c){"use strict";var d=c(16),e=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];a.exports=function(a,b,c,i,j,k,l,m){var n,o,p,q,r,s,t,u,v,w=m.bits,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0,H=null,I=0,J=new d.Buf16(16),K=new d.Buf16(16),L=null,M=0;for(x=0;x<=15;x++)J[x]=0;for(y=0;y<i;y++)J[b[c+y]]++;for(B=w,A=15;A>=1&&0===J[A];A--);if(B>A&&(B=A),0===A)return j[k++]=20971520,j[k++]=20971520,m.bits=1,0;for(z=1;z<A&&0===J[z];z++);for(B<z&&(B=z),E=1,x=1;x<=15;x++)if(E<<=1,(E-=J[x])<0)return-1;if(E>0&&(0===a||1!==A))return-1;for(K[1]=0,x=1;x<15;x++)K[x+1]=K[x]+J[x];for(y=0;y<i;y++)0!==b[c+y]&&(l[K[b[c+y]]++]=y);if(0===a?(H=L=l,s=19):1===a?(H=e,I-=257,L=f,M-=257,s=256):(H=g,L=h,s=-1),G=0,y=0,x=z,r=k,C=B,D=0,p=-1,F=1<<B,q=F-1,1===a&&F>852||2===a&&F>592)return 1;for(;;){t=x-D,l[y]<s?(u=0,v=l[y]):l[y]>s?(u=L[M+l[y]],v=H[I+l[y]]):(u=96,v=0),n=1<<x-D,o=1<<C,z=o;do{o-=n,j[r+(G>>D)+o]=t<<24|u<<16|v|0}while(0!==o);for(n=1<<x-1;G&n;)n>>=1;if(0!==n?(G&=n-1,G+=n):G=0,y++,0==--J[x]){if(x===A)break;x=b[c+l[y]]}if(x>B&&(G&q)!==p){for(0===D&&(D=B),r+=z,C=x-D,E=1<<C;C+D<A&&!((E-=J[C+D])<=0);)C++,E<<=1;if(F+=1<<C,1===a&&F>852||2===a&&F>592)return 1;p=G&q,j[p]=B<<24|C<<16|r-k|0}}return 0!==G&&(j[r+G]=x-D<<24|64<<16|0),m.bits=B,0}},function(a,b){"use strict";a.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(a,b){"use strict";function c(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}a.exports=c},function(a,b){},function(a,b,c){"use strict";function d(a){k.userName=a}function e(a,b){function c(){return k.userName&&k.userName.length?k.userName:q?q.slice(0,5):"Unknown"}function d(a){switch(a.type){case"txt":j(a);break;case"joinok":i(a);break;case"join_error":break;case"sessionId":g.logger.info("Connect successful, your id is: "+a.id),q=a.id;break;case"joined":a.userStatus="joined",e(a);break;case"left":a.userStatus="left",h(a);break;case"camera":case"pointer":break;default:g.logger.log(a)}var b=a.roomId,c={type:p[a.type],data:a,channelId:b};v.dispatchEvent(c)}function e(a){if(a.user.name&&a.user.name.length||(a.user.name=a.user.id.slice(0,5)),a.roomId){var b=u[a.roomId];b?(b.users.push(a.user),g.logger.info(a.user+" joined room "+a.roomId)):g.logger.warn("Channel "+a.roomId+" does not exist for socket "+q)}}function h(a){g.logger.info(a.user+" left room "+a.room);for(var b in u){for(var c=u[b].users,d=-1,e=0;e<c.length;e++)if(c[e].id==a.user){d=e;break}-1!=d&&c.splice(d,1),delete u[b].userSet[a.user]}}function i(a){var b=u[a.roomId];g.logger.info("joined channel "+a.roomId),a.users&&a.users.length?b.users=a.users:b.users=[];for(var d=0;d<b.users.length;d++)b.users[d].name&&b.users[d].name.length||(b.users[d].name=b.users[d].id.slice(0,5));var e=c(),f=Autodesk.Viewing.i18n.translate("you"),h={id:q,name:e+" ("+f+")",isSelf:!0,status:0};b.userSet[q]||(b.users.push(h),b.userSet[q]=h),0!=h.id.indexOf(e)&&v.sendChatMessage("/nick "+e,a.roomId)}function j(a){if(0==a.msg.indexOf("/nick ")){var b=v.getUserById(a.from,a.roomId),c=a.msg.slice(6);if(c.length&&(b.name=c,b.id==q)){var d=Autodesk.Viewing.i18n.translate("you");b.name+=" ("+d+")"}v.dispatchEvent({type:"userListChange",data:a,channelId:a.roomId})}}function l(a){s<r.length?(g.logger.info("Connect failed, trying another server..."),o.disconnect(),o=null,s++,v.connect(v.sessionID)):v.dispatchEvent({type:"socketError",data:a})}function m(a){v.dispatchEvent({type:"socketError",data:a})}function n(a){s=0;for(var b in t)v.join(b)}var o,p={camera:"cameraChange",pointer:"pointerMove",joystick:"joystick",state:"viewerState",txt:"chatReceived",joinok:"userListChange",sessionId:"connectSucceeded",joined:"userListChange",left:"userListChange",private:"privateMessage",join_error:"socketError"},q=null,r=Array.isArray(a)?a:[a],s=0,t={},u={},v=this;this.connect=function(a){if(!o)return void 0!==window.WebSocket&&(f||(f="undefined"!=typeof lmv_io?lmv_io:io),this.sessionID=a,o=f.connect(r[s]+"?sessionID="+a,{path:b,forceNew:!0}),o.on("connect",n),o.on("message",d),o.on("connect_error",l),o.on("error",m),!0)},this.join=function(a){if(!o||!o.connected)return void(t[a]=1);delete t[a],u[a]={id:a,users:[],userSet:{}},o.emit("join",{roomId:a,name:c()})},this.disconnect=function(){o&&(o.disconnect(),o=null,u={},q=null)},this.sendMessage=function(a,b,c){var d={type:a,from:q,msg:b,roomId:c};o.emit("message",d)},this.sendPrivateMessage=function(a,b){var c={type:"private",target:a,from:q,msg:b};o.emit("message",c)},this.sendChatMessage=function(a,b){var c={type:"txt",from:q,msg:a,roomId:b};o.emit("message",c),d(c)},this.getUserById=function(a,b){for(var c=u[b].users,d=0;d<c.length;d++)if(c[d].id==a)return c[d];return null},this.getLocalId=function(){return q},this.getChannelInfo=function(a){return u[a]},this.isConnected=function(){return o}}Object.defineProperty(b,"__esModule",{value:!0}),b.setUserName=d,b.MessageClient=e;var f,g=c(8),h=c(33),i=c(9),j=c(7),k={userName:""};e.prototype.constructor=e,h.EventDispatcher.prototype.apply(e.prototype);var l={};e.GetInstance=function(a,b){a||(a=j.EnvironmentConfigurations[(0,i.getEnv)()].LMV.RTC),Array.isArray(a)||(a=[a]);var c=l[a[0]];return c||(c=new e(a,b),l[a[0]]=c,c)}},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=b.EventDispatcher=function(){};c.prototype={constructor:c,apply:function(a){a.addEventListener=c.prototype.addEventListener,a.hasEventListener=c.prototype.hasEventListener,a.removeEventListener=c.prototype.removeEventListener,a.clearListeners=c.prototype.clearListeners,a.fireEvent=c.prototype.fireEvent,a.dispatchEvent=c.prototype.fireEvent,a.debugEvents=c.prototype.debugEvents},addEventListener:function(a,b,c){a&&(void 0===this.listeners&&(this.listeners={}),void 0===this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push({callbackFn:b,once:!!c&&!!c.once}))},hasEventListener:function(a,b){if(!a)return!1;if(void 0===this.listeners)return!1;var c=this.listeners[a];if(!c||0===c.length)return!1;for(var d=0,e=c.length;d<e;++d)if(c[d].callbackFn===b)return!0;return!1},removeEventListener:function(a,b){if(a){if(void 0===this.listeners)return void(this.listeners={});var c=this.listeners[a];if(c)for(var d=0,e=c.length;d<e;++d)if(c[d].callbackFn===b){c.splice(d,1);break}}},clearListeners:function(){this.listeners=null},dispatchEvent:function(a){if(void 0===this.listeners)return void(this.listeners={});if("string"==typeof a&&(a={type:a}),!a.target)try{a.target=this}catch(a){}if(!a.type)throw new Error("event type unknown.");if(this._doDebug&&console.log("Event: "+a.type),Array.isArray(this.listeners[a.type])){for(var b=this.listeners[a.type].slice(),c=[],d=0,e=b.length;d<e;++d)b[d].callbackFn.call(this,a),b[d].once&&c.push(b[d].callbackFn);for(var f=0;f<c.length;++f)this.removeEventListener(a.type,c[f])}},debugEvents:function(a){this._doDebug=a}},c.prototype.fireEvent=c.prototype.dispatchEvent,"undefined"!=typeof Autodesk&&(Autodesk.Viewing.EventDispatcher=c)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.initializeLocalization=b.setLanguage=b.extendLocalization=void 0;var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=c(4),f=c(35),g=c(36),h=(b.extendLocalization=function(a){return null!==a&&"object"===(void 0===a?"undefined":d(a))&&(Object.keys(a).forEach(function(b){f.i18n.addResourceBundle(b,"allstrings",a[b],!0,!0)}),!0)},b.setLanguage=function(a,b){var c={lng:a,resGetPath:"res/locales/__lng__/__ns__.json",ns:{namespaces:["allstrings"],defaultNs:"allstrings"},fallbackLng:"en",debug:!1};(0,e.getGlobal)().LOCALIZATION_REL_PATH="res/locales/"+a+"/",f.i18n.init(c,function(a){f.i18n.clearDebugLocString(),b&&b()})});b.initializeLocalization=function(a){var b=a&&a.language||navigator.language,c=g.Lang.getSupported(b);h(c)}},function(a,b,c){"use strict";function d(){H="aaaa",$()}function e(){H=null,$()}function f(a,b){if(!b||"function"==typeof b)return a;for(var c in b)a[c]=b[c];return a}function g(a,b,c){var d,e=0,f=a.length,g=void 0===f||"[object Array]"!==Object.prototype.toString.apply(a)||"function"==typeof a;if(c)if(g){for(d in a)if(!1===b.apply(a[d],c))break}else for(;e<f&&!1!==b.apply(a[e++],c););else if(g){for(d in a)if(!1===b.call(a[d],d,a[d]))break}else for(;e<f&&!1!==b.call(a[e],e,a[e++]););return a}function h(a){return"string"==typeof a?a.replace(/[&<>"'\/]/g,function(a){return Q[a]}):a}function i(a){var b=function(a){if(window.XMLHttpRequest)return a(null,new XMLHttpRequest);if(window.ActiveXObject)try{return a(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(b){return a(null,new ActiveXObject("Microsoft.XMLHTTP"))}return a(new Error)},c=function(a){if("string"==typeof a)return a;var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},d=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},e=function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a=d(a);var c,e,f,g,h,i,j,k="",l=0;do{c=a.charCodeAt(l++),e=a.charCodeAt(l++),f=a.charCodeAt(l++),g=c>>2,h=(3&c)<<4|e>>4,i=(15&e)<<2|f>>6,j=63&f,isNaN(e)?i=j=64:isNaN(f)&&(j=64),k+=b.charAt(g)+b.charAt(h)+b.charAt(i)+b.charAt(j),c=e=f="",g=h=i=j=""}while(l<a.length);return k},f=function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a},g=function a(d,e,g,h){"function"==typeof g&&(h=g,g={}),g.doNotCache=g.doNotCache||!1,g.data=g.data||{},g.headers=g.headers||{},g.jsonp=g.jsonp||!1,g.async=void 0===g.async||g.async;var i,j=f({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},a.headers,g.headers);if(i="application/json"===j["content-type"]?JSON.stringify(g.data):c(g.data),"GET"===d){var k=[];if(i&&(k.push(i),i=null),g.doNotCache&&k.push("_="+(new Date).getTime()),g.jsonp&&(k.push("callback="+g.jsonp),k.push("jsonp="+g.jsonp)),k=k.join("&"),k.length>1&&(e.indexOf("?")>-1?e+="&"+k:e+="?"+k),g.jsonp){var l=document.getElementsByTagName("head")[0],m=document.createElement("script");return m.type="text/javascript",m.src=e,void l.appendChild(m)}}b(function(a,b){if(a)return h(a);b.open(d,e,g.async);for(var c in j)j.hasOwnProperty(c)&&b.setRequestHeader(c,j[c]);b.onreadystatechange=function(){if(4===b.readyState){var a=b.responseText||"";if(!h)return;h(b.status,a)}},b.send(i)})};({authBasic:function(a,b){g.headers.Authorization="Basic "+e(a+":"+b)},connect:function(a,b,c){return g("CONNECT",a,b,c)},del:function(a,b,c){return g("DELETE",a,b,c)},get:function(a,b,c){return g("GET",a,b,c)},head:function(a,b,c){return g("HEAD",a,b,c)},headers:function(a){g.headers=a||{}},isAllowed:function(a,b,c){this.options(a,function(a,d){c(-1!==d.text().indexOf(b))})},options:function(a,b,c){return g("OPTIONS",a,b,c)},patch:function(a,b,c){return g("PATCH",a,b,c)},post:function(a,b,c){return g("POST",a,b,c)},put:function(a,b,c){return g("PUT",a,b,c)},trace:function(a,b,c){return g("TRACE",a,b,c)}})[a.type?a.type.toLowerCase():"get"](a.url,a,function(b,c){200===b?a.success(c,b,null):a.error(c,b,null)})}function j(a,b){"function"==typeof a&&(b=a,a={}),a=a||{},T.extend(P,a),delete P.fixLng,"string"==typeof P.ns&&(P.ns={namespaces:[P.ns],defaultNs:P.ns}),"string"==typeof P.fallbackNS&&(P.fallbackNS=[P.fallbackNS]),"string"!=typeof P.fallbackLng&&"boolean"!=typeof P.fallbackLng||(P.fallbackLng=[P.fallbackLng]),P.interpolationPrefixEscaped=T.regexEscape(P.interpolationPrefix),P.interpolationSuffixEscaped=T.regexEscape(P.interpolationSuffix),P.lng||(P.lng=T.detectLanguage()),P.lng?P.useCookie&&T.cookie.create(P.cookieName,P.lng,P.cookieExpirationTime,P.cookieDomain):(P.lng=P.fallbackLng[0],P.useCookie&&T.cookie.remove(P.cookieName)),N=T.toLanguages(P.lng),I=N[0],T.log("currentLng set to: "+I);var c=x;if(a.fixLng&&(c=function(a,b){return b=b||{},b.lng=b.lng||c.lng,x(a,b)},c.lng=I),V.setCurrentLng(I),P.resStore)return T.each(P.resStore,function(a,b){T.each(b,function(b,c){l(a,b,c)})}),O=!0,void(b&&b(c));var d=T.toLanguages(P.lng);"string"==typeof P.preload&&(P.preload=[P.preload]);for(var e=0,f=P.preload.length;e<f;e++)for(var g=T.toLanguages(P.preload[e]),h=0,i=g.length;h<i;h++)d.indexOf(g[h])<0&&d.push(g[h]);Autodesk.Viewing.i18n.sync.load(d,P,function(a,d){T.each(d,function(a,b){T.each(b,function(b,c){l(a,b,c)})}),O=!0,b&&b(c)})}function k(a,b){"string"==typeof a&&(a=[a]);for(var c=0,d=a.length;c<d;c++)P.preload.indexOf(a[c])<0&&P.preload.push(a[c]);return j(b)}function l(a,b,c){"string"!=typeof b?(c=b,b=P.ns.defaultNs):P.ns.namespaces.indexOf(b)<0&&P.ns.namespaces.push(b),L[a]=L[a]||{},L[a][b]=L[a][b]||{},T.extend(L[a][b],c)}function m(a,b){"string"!=typeof b&&(b=P.ns.defaultNs),L[a]=L[a]||{},L[a][b]={}}function n(a){P.ns.defaultNs=a}function o(a,b){p([a],b)}function p(a,b){var c={dynamicLoad:P.dynamicLoad,resGetPath:P.resGetPath,getAsync:P.getAsync,customLoad:P.customLoad,ns:{namespaces:a,defaultNs:""}},d=T.toLanguages(P.lng);"string"==typeof P.preload&&(P.preload=[P.preload]);for(var e=0,f=P.preload.length;e<f;e++)for(var g=T.toLanguages(P.preload[e]),h=0,i=g.length;h<i;h++)d.indexOf(g[h])<0&&d.push(g[h]);for(var j=[],k=0,l=d.length;k<l;k++){var m=!1,n=L[d[k]];if(n)for(var o=0,p=a.length;o<p;o++)n[a[o]]||(m=!0);else m=!0;m&&j.push(d[k])}j.length?U._fetch(j,c,function(c,d){var e=a.length*j.length;T.each(a,function(a,c){P.ns.namespaces.indexOf(c)<0&&P.ns.namespaces.push(c),T.each(j,function(a,f){L[f]=L[f]||{},L[f][c]=d[f][c],0===--e&&b&&(P.useLocalStorage&&U._storeLocal(L),b())})})}):b&&b()}function q(a,b,c){return"function"==typeof b?(c=b,b={}):b||(b={}),b.lng=a,j(b,c)}function r(){return I}function s(a,b,c,d){if(!a)return a;if(d=d||b,a.indexOf(d.interpolationPrefix||P.interpolationPrefix)<0)return a;var e=d.interpolationPrefix?T.regexEscape(d.interpolationPrefix):P.interpolationPrefixEscaped,f=d.interpolationSuffix?T.regexEscape(d.interpolationSuffix):P.interpolationSuffixEscaped,g="HTML"+f;return T.each(b,function(b,h){var i=c?c+P.keyseparator+b:b;"object"===(void 0===h?"undefined":D(h))&&null!==h?a=s(a,h,i,d):d.escapeInterpolation||P.escapeInterpolation?(a=a.replace(new RegExp([e,i,g].join(""),"g"),h),a=a.replace(new RegExp([e,i,f].join(""),"g"),T.escape(h))):a=a.replace(new RegExp([e,i,f].join(""),"g"),h)}),a}function t(a,b){var c=T.extend({},b);for(delete c.postProcess;-1!=a.indexOf(P.reusePrefix)&&!(++M>P.maxRecursion);){var d=a.lastIndexOf(P.reusePrefix),e=a.indexOf(P.reuseSuffix,d)+P.reuseSuffix.length,f=a.substring(d,e),g=f.replace(P.reusePrefix,"").replace(P.reuseSuffix,"");if(-1!=g.indexOf(",")){var h=g.indexOf(",");if(-1!=g.indexOf("{",h)&&-1!=g.indexOf("}",h)){var i=g.indexOf("{",h),j=g.indexOf("}",i)+"}".length;try{c=T.extend(c,JSON.parse(g.substring(i,j))),g=g.substring(0,h)}catch(a){}}}var k=A(g,c);a=a.replace(f,k)}return a}function u(a){return a.context&&("string"==typeof a.context||"number"==typeof a.context)}function v(a){return void 0!==a.count&&"string"!=typeof a.count&&1!==a.count}function w(a,b){b=b||{};var c=y(a,b),d=B(a,b);return void 0!==d||d===c}function x(a,b){if(b=b||{},!O){T.log("i18next not finished initialization. you might have called t function before loading resources finished.");var c=a.indexOf(":");c<0?c=0:c++;var d=b.defaultValue||a.substr(c);return d&&(d=s(d,b)),d}return M=0,A.apply(null,arguments)}function y(a,b){return void 0!==b.defaultValue?b.defaultValue:a}function z(){for(var a=[],b=1;b<arguments.length;b++)a.push(arguments[b]);return{postProcess:"sprintf",sprintf:a}}function A(a,b){if(b&&"object"!==(void 0===b?"undefined":D(b))?"sprintf"===P.shortcutFunction?b=z.apply(null,arguments):"defaultValue"===P.shortcutFunction&&(b={defaultValue:b}):b=b||{},void 0===a||null===a)return"";"string"==typeof a&&(a=[a]);var c=a[0];if(a.length>1)for(var d=0;d<a.length&&(c=a[d],!w(c,b));d++);var e,f=y(c,b),g=B(c,b),h=b.lng?T.toLanguages(b.lng):N,i=b.ns||P.ns.defaultNs;c.indexOf(P.nsseparator)>-1&&(e=c.split(P.nsseparator),i=e[0],c=e[1]),void 0===g&&P.sendMissing&&(b.lng?U.postMissing(h[0],i,c,f,h):U.postMissing(P.lng,i,c,f,h));var j=b.postProcess||P.postProcess;if(void 0!==g&&j&&W[j]&&(g=W[j](g,c,b)),H&&void 0!==g)return H;var k=f;if(f.indexOf(P.nsseparator)>-1&&(e=f.split(P.nsseparator),k=e[1]),k===c&&P.parseMissingKey&&(f=P.parseMissingKey(f)),void 0===g&&(f=s(f,b),f=t(f,b),j&&W[j])){var l=y(c,b);g=W[j](l,c,b)}return void 0!==g?g:f}function B(a,b){b=b||{};var c,d,e=y(a,b),f=N;if(!L)return e;if("cimode"===f[0].toLowerCase())return e;if(b.lng&&(f=T.toLanguages(b.lng),!L[f[0]])){var g=P.getAsync;P.getAsync=!1,U.load(f,P,function(a,b){T.extend(L,b),P.getAsync=g})}var h=b.ns||P.ns.defaultNs;if(a.indexOf(P.nsseparator)>-1){var i=a.split(P.nsseparator);h=i[0],a=i[1]}if(u(b)){c=T.extend({},b),delete c.context,c.defaultValue=P.contextNotFound;if((d=x(h+P.nsseparator+a+"_"+b.context,c))!=P.contextNotFound)return s(d,{context:b.context})}if(v(b)){c=T.extend({},b),delete c.count,c.defaultValue=P.pluralNotFound;var j=h+P.nsseparator+a+P.pluralSuffix,k=V.get(f[0],b.count);if(k>=0?j=j+"_"+k:1===k&&(j=h+P.nsseparator+a),(d=x(j,c))!=P.pluralNotFound)return s(d,{count:b.count,interpolationPrefix:b.interpolationPrefix,interpolationSuffix:b.interpolationSuffix})}for(var l,m=a.split(P.keyseparator),n=0,o=f.length;n<o&&void 0===l;n++){for(var p=f[n],q=0,r=L[p]&&L[p][h];m[q];)r=r&&r[m[q]],q++;if(void 0!==r){var w=Object.prototype.toString.apply(r);if("string"==typeof r)r=s(r,b),r=t(r,b);else if("[object Array]"!==w||P.returnObjectTrees||b.returnObjectTrees){if(null===r&&!0===P.fallbackOnNull)r=void 0;else if(null!==r)if(P.returnObjectTrees||b.returnObjectTrees){if("[object Number]"!==w&&"[object Function]"!==w&&"[object RegExp]"!==w){var z="[object Array]"===w?[]:{};T.each(r,function(c){z[c]=A(h+P.nsseparator+a+P.keyseparator+c,b)}),r=z}}else P.objectTreeKeyHandler&&"function"==typeof P.objectTreeKeyHandler?r=P.objectTreeKeyHandler(a,r,p,h,b):(r="key '"+h+":"+a+" ("+p+")' returned an object instead of string.",T.log(r))}else r=r.join("\n"),r=s(r,b),r=t(r,b);"string"==typeof r&&""===r.trim()&&!0===P.fallbackOnEmpty&&(r=void 0),l=r}}if(void 0===l&&!b.isFallbackLookup&&(!0===P.fallbackToDefaultNS||P.fallbackNS&&P.fallbackNS.length>0))if(b.isFallbackLookup=!0,P.fallbackNS.length){for(var C=0,D=P.fallbackNS.length;C<D;C++)if(l=B(P.fallbackNS[C]+P.nsseparator+a,b)){var E=l.indexOf(P.nsseparator)>-1?l.split(P.nsseparator)[1]:l,F=e.indexOf(P.nsseparator)>-1?e.split(P.nsseparator)[1]:e;if(E!==F)break}}else l=B(a,b);return l}function C(){var a,b=[];if("undefined"!=typeof window&&(!function(){for(var a=window.location.search.substring(1),c=a.split("&"),d=0;d<c.length;d++){var e=c[d].indexOf("=");if(e>0){var f=c[d].substring(0,e),g=c[d].substring(e+1);b[f]=g}}}(),b[P.detectLngQS]&&(a=b[P.detectLngQS])),!a&&"undefined"!=typeof document&&P.useCookie){var c=T.cookie.read(P.cookieName);c&&(a=c)}return a||"undefined"==typeof navigator||(a=navigator.language?navigator.language:navigator.userLanguage),a}Object.defineProperty(b,"__esModule",{value:!0}),b.i18n=void 0;var D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},E=c(6),F=c(4),G=(0,F.getGlobal)(),H=null;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&d!=1/0&&d!=-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);e<c;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=c;arguments.length>1&&(d=Number(arguments[1]),
d!=d?d=0:0!=d&&d!=1/0&&d!=-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d))));for(var e=d>=0?Math.min(d,c-1):c-Math.abs(d);e>=0;e--)if(e in b&&b[e]===a)return e;return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var I,J=G,K=J.jQuery||J.Zepto,L={},M=0,N=[],O=!1,P={lng:void 0,load:"current",preload:[],lowerCaseLng:!1,returnObjectTrees:!1,fallbackLng:["dev"],fallbackNS:[],detectLngQS:"setLng",ns:"translation",fallbackOnNull:!0,fallbackOnEmpty:!1,fallbackToDefaultNS:!1,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:!1,resGetPath:"res/locales/__lng__/__ns__.json",resPostPath:"res/locales/add/__lng__/__ns__",getAsync:!0,postAsync:!0,resStore:void 0,useLocalStorage:!1,localStorageExpirationTime:6048e5,dynamicLoad:!1,sendMissing:!1,sendMissingTo:"fallback",sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),escapeInterpolation:!1,defaultValueFromContent:!0,useDataAttrOptions:!1,cookieExpirationTime:void 0,useCookie:!0,cookieName:"i18next",cookieDomain:void 0,objectTreeKeyHandler:void 0,postProcess:void 0,parseMissingKey:void 0,shortcutFunction:"sprintf"},Q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},R={create:function(a,b,c,d){var e;if(c){var f=new Date;f.setTime(f.getTime()+60*c*1e3),e="; expires="+f.toGMTString()}else e="";d=d?"domain="+d+";":"",document.cookie=a+"="+b+e+";"+d+"path=/"},read:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},remove:function(a){this.create(a,"",-1)}},S={create:function(a,b,c,d){},read:function(a){return null},remove:function(a){}},T={extend:K?K.extend:f,each:K?K.each:g,ajax:K?K.ajax:"undefined"!=typeof document?i:function(){},cookie:"undefined"!=typeof document?R:S,detectLanguage:C,escape:h,log:function(a){P.debug&&"undefined"!=typeof console&&console.log(a)},toLanguages:function(a){var b=[];if("string"==typeof a&&a.indexOf("-")>-1){var c=a.split("-");a=P.lowerCaseLng?c[0].toLowerCase()+"-"+c[1].toLowerCase():c[0].toLowerCase()+"-"+c[1].toUpperCase(),"unspecific"!==P.load&&b.push(a),"current"!==P.load&&b.push(c[0])}else b.push(a);for(var d=0;d<P.fallbackLng.length;d++)-1===b.indexOf(P.fallbackLng[d])&&P.fallbackLng[d]&&b.push(P.fallbackLng[d]);return b},regexEscape:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};T.applyReplacement=s;var U={load:function(a,b,c){b.useLocalStorage?U._loadLocal(a,b,function(d,e){for(var f=[],g=0,h=a.length;g<h;g++)e[a[g]]||f.push(a[g]);f.length>0?U._fetch(f,b,function(a,b){T.extend(e,b),U._storeLocal(b),c(null,e)}):c(null,e)}):U._fetch(a,b,function(a,b){c(null,b)})},_loadLocal:function(a,b,c){var d={},e=(new Date).getTime();if(window.localStorage){var f=a.length;T.each(a,function(a,g){var h=window.localStorage.getItem("res_"+g);h&&(h=JSON.parse(h),h.i18nStamp&&h.i18nStamp+b.localStorageExpirationTime>e&&(d[g]=h)),0===--f&&c(null,d)})}},_storeLocal:function(a){if(window.localStorage)for(var b in a)a[b].i18nStamp=(new Date).getTime(),window.localStorage.setItem("res_"+b,JSON.stringify(a[b]))},_fetch:function(a,b,c){var d=b.ns,e={};if(b.dynamicLoad){var f=function(a,b){c(null,b)};if("function"==typeof b.customLoad)b.customLoad(a,d.namespaces,b,f);else{var g=s(b.resGetPath,{lng:a.join("+"),ns:d.namespaces.join("+")});g=(0,E.getResourceUrl)(g),T.ajax({url:g,success:function(a,b,c){T.log("loaded: "+g),f(0,a.json())},error:function(a,b,c){T.log("failed loading: "+g),f()},dataType:"text",async:b.getAsync})}}else{var h,i=d.namespaces.length*a.length;T.each(d.namespaces,function(d,f){T.each(a,function(a,d){var g=function(a,b){a&&(h=h||[],h.push(a)),e[d]=e[d]||{},e[d][f]=b,0===--i&&c(h,e)};"function"==typeof b.customLoad?b.customLoad(d,f,b,g):U._fetchOne(d,f,b,g)})})}},_fetchOne:function(a,b,c,d){var e=s(c.resGetPath,{lng:a,ns:b});e=(0,E.getResourceUrl)(e),T.ajax({url:e,success:function(a,b,c){T.log("loaded: "+e);var f=a;d(null,JSON.parse(f))},error:function(a,b,c){if(b&&200==b||a&&a.status&&200==a.status)T.log("There is a typo in: "+e);else if(b&&404==b||a&&a.status&&404==a.status)T.log("Does not exist: "+e);else{var f=b||(a&&a.status?a.status:null);T.log(f+" when loading "+e)}d(c,{})},dataType:"text",async:c.getAsync})},postMissing:function(a,b,c,d,e){var f={};f[c]=d;var g=[];if("fallback"===P.sendMissingTo&&!1!==P.fallbackLng[0])for(var h=0;h<P.fallbackLng.length;h++)g.push({lng:P.fallbackLng[h],url:s(P.resPostPath,{lng:P.fallbackLng[h],ns:b})});else if("current"===P.sendMissingTo||"fallback"===P.sendMissingTo&&!1===P.fallbackLng[0])g.push({lng:a,url:s(P.resPostPath,{lng:a,ns:b})});else if("all"===P.sendMissingTo)for(var h=0,i=e.length;h<i;h++)g.push({lng:e[h],url:s(P.resPostPath,{lng:e[h],ns:b})});for(var j=0,k=g.length;j<k;j++){var l=g[j];T.ajax({url:l.url,type:P.sendType,data:f,success:function(a,e,f){T.log("posted missing key '"+c+"' to: "+l.url);for(var g=c.split("."),h=0,i=L[l.lng][b];g[h];)i=h===g.length-1?i[g[h]]=d:i[g[h]]=i[g[h]]||{},h++},error:function(a,b,d){T.log("failed posting missing key '"+c+"' to: "+l.url)},dataType:"json",async:P.postAsync})}}},V={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(a){return Number(a>1)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ak:{name:"Akan",numbers:[1,2],plurals:function(a){return Number(a>1)}},am:{name:"Amharic",numbers:[1,2],plurals:function(a){return Number(a>1)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(a){return Number(0===a?0:1==a?1:2==a?2:a%100>=3&&a%100<=10?3:a%100>=11?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(a){return Number(a>1)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ay:{name:"Aymar",numbers:[1],plurals:function(a){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(a){return Number(1!=a)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},bo:{name:"Tibetan",numbers:[1],plurals:function(a){return 0}},br:{name:"Breton",numbers:[1,2],plurals:function(a){return Number(a>1)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(a){return Number(1!=a)}},cgg:{name:"Chiga",numbers:[1],plurals:function(a){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:a>=2&&a<=4?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(a){return Number(1==a?0:2==a?1:8!=a&&11!=a?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},de:{name:"German",numbers:[1,2],plurals:function(a){return Number(1!=a)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(a){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(a){return Number(1!=a)}},en:{name:"English",numbers:[1,2],plurals:function(a){return Number(1!=a)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(a){return Number(1!=a)}},es:{name:"Spanish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},et:{name:"Estonian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},eu:{name:"Basque",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fa:{name:"Persian",numbers:[1],plurals:function(a){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(a){return Number(a>1)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fr:{name:"French",numbers:[1,2],plurals:function(a){return Number(a>1)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(a){return Number(1==a?0:2==a?1:a<7?2:a<11?3:4)}},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:function(a){return Number(1==a||11==a?0:2==a||12==a?1:a>2&&a<20?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(a){return Number(1!=a)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(a){return Number(1!=a)}},gun:{name:"Gun",numbers:[1,2],plurals:function(a){return Number(a>1)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(a){return Number(1!=a)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(a){return Number(1!=a)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(a){return Number(1!=a)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(a){return Number(1!=a)}},id:{name:"Indonesian",numbers:[1],plurals:function(a){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(a){return Number(a%10!=1||a%100==11)}},it:{name:"Italian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ja:{name:"Japanese",numbers:[1],plurals:function(a){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(a){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(a){return Number(0!==a)}},ka:{name:"Georgian",numbers:[1],plurals:function(a){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(a){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(a){return 0}},kn:{name:"Kannada",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ko:{name:"Korean",numbers:[1],plurals:function(a){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(a){return Number(1==a?0:2==a?1:3==a?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(a){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(a){return Number(a>1)}},lo:{name:"Lao",numbers:[1],plurals:function(a){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&(a%100<10||a%100>=20)?1:2)}},lv:{name:"Latvian",numbers:[1,2,0],plurals:function(a){return Number(a%10==1&&a%100!=11?0:0!==a?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(a){return Number(a>1)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(a){return Number(a>1)}},mi:{name:"Maori",numbers:[1,2],plurals:function(a){return Number(a>1)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(a){return Number(1==a||a%10==1?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(a){return Number(1==a?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ms:{name:"Malay",numbers:[1],plurals:function(a){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(a){return Number(1==a?0:0===a||a%100>1&&a%100<11?1:a%100>10&&a%100<20?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nl:{name:"Dutch",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(a){return Number(1!=a)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(a){return Number(1!=a)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(a){return Number(a>1)}},or:{name:"Oriya",numbers:[2,1],plurals:function(a){return Number(1!=a)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(a){return Number(1==a?0:0===a||a%100>0&&a%100<20?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(a){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(a){return Number(1!=a)}},se:{name:"Northern Sami",numbers:[1,2],plurals:function(a){return Number(1!=a)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:a>=2&&a<=4?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(a){return Number(a%100==1?1:a%100==2?2:a%100==3||a%100==4?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},son:{name:"Songhay",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sq:{name:"Albanian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(a){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(a){return Number(1!=a)}},te:{name:"Telugu",numbers:[1,2],plurals:function(a){return Number(1!=a)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(a){return Number(a>1)}},th:{name:"Thai",numbers:[1],plurals:function(a){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(a){return Number(a>1)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(a){return Number(1!=a)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(a){return Number(a>1)}},tt:{name:"Tatar",numbers:[1],plurals:function(a){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(a){return 0}},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(a){return Number(1!=a)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(a){return Number(a>1)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(a){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(a){return Number(a>1)}},wo:{name:"Wolof",numbers:[1],plurals:function(a){return 0}},yo:{name:"Yoruba",numbers:[1,2],plurals:function(a){return Number(1!=a)}},zh:{name:"Chinese",numbers:[1],plurals:function(a){return 0}}},addRule:function(a,b){V.rules[a]=b},setCurrentLng:function(a){if(!V.currentRule||V.currentRule.lng!==a){var b=a.split("-");V.currentRule={lng:a,rule:V.rules[b[0]]}}},get:function(a,b){var c=a.split("-");return function(b,c){var d;if(d=V.currentRule&&V.currentRule.lng===a?V.currentRule.rule:V.rules[b]){var e=d.plurals(c),f=d.numbers[e];return 2===d.numbers.length&&1===d.numbers[0]&&(2===f?f=-1:1===f&&(f=1)),f}return 1===c?"1":"-1"}(c[0],b)}},W={},X=function(a,b){W[a]=b},Y=function(){function a(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}function b(a,b){for(var c=[];b>0;c[--b]=a);return c.join("")}var c=function a(){return a.cache.hasOwnProperty(arguments[0])||(a.cache[arguments[0]]=a.parse(arguments[0])),a.format.call(null,a.cache[arguments[0]],arguments)};return c.format=function(c,d){var e,f,g,h,i,j,k,l=1,m=c.length,n="",o=[];for(f=0;f<m;f++)if("string"===(n=a(c[f])))o.push(c[f]);else if("array"===n){if(h=c[f],h[2])for(e=d[l],g=0;g<h[2].length;g++){if(!e.hasOwnProperty(h[2][g]))throw Y('[sprintf] property "%s" does not exist',h[2][g]);e=e[h[2][g]]}else e=h[1]?d[h[1]]:d[l++];if(/[^s]/.test(h[8])&&"number"!=a(e))throw Y("[sprintf] expecting number but found %s",a(e));switch(h[8]){case"b":e=e.toString(2);break;case"c":e=String.fromCharCode(e);break;case"d":e=parseInt(e,10);break;case"e":e=h[7]?e.toExponential(h[7]):e.toExponential();break;case"f":e=h[7]?parseFloat(e).toFixed(h[7]):parseFloat(e);break;case"o":e=e.toString(8);break;case"s":e=(e=String(e))&&h[7]?e.substring(0,h[7]):e;break;case"u":e=Math.abs(e);break;case"x":e=e.toString(16);break;case"X":e=e.toString(16).toUpperCase()}e=/[def]/.test(h[8])&&h[3]&&e>=0?"+"+e:e,j=h[4]?"0"==h[4]?"0":h[4].charAt(1):" ",k=h[6]-String(e).length,i=h[6]?b(j,k):"",o.push(h[5]?e+i:i+e)}return o.join("")},c.cache={},c.parse=function(a){for(var b=a,c=[],d=[],e=0;b;){if(null!==(c=/^[^\x25]+/.exec(b)))d.push(c[0]);else if(null!==(c=/^\x25{2}/.exec(b)))d.push("%");else{if(null===(c=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(b)))throw"[sprintf] huh?";if(c[2]){e|=1;var f=[],g=c[2],h=[];if(null===(h=/^([a-z_][a-z_\d]*)/i.exec(g)))throw"[sprintf] huh?";for(f.push(h[1]);""!==(g=g.substring(h[0].length));)if(null!==(h=/^\.([a-z_][a-z_\d]*)/i.exec(g)))f.push(h[1]);else{if(null===(h=/^\[(\d+)\]/.exec(g)))throw"[sprintf] huh?";f.push(h[1])}c[2]=f}else e|=2;if(3===e)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";d.push(c)}b=b.substring(c[0].length)}return d},c}(),Z=function(a,b){return b.unshift(a),Y.apply(null,b)};X("sprintf",function(a,b,c){return c.sprintf?"[object Array]"===Object.prototype.toString.apply(c.sprintf)?Z(a,c.sprintf):"object"===D(c.sprintf)?Y(a,c.sprintf):a:a});var $=function(a){function b(a){return[null,a]}var c=a||document;Array.prototype.forEach.call(c.querySelectorAll("[data-i18n]"),function(a){var c=a.getAttribute("data-i18n"),d=b(c),e=d[0],f=d[1],g=x(f);g?e?a.setAttribute(e,g):a.placeholder?a.placeholder=g:a.textContent=g:e?a.setAttribute(e,f):a.textContent=f})};b.i18n={init:j,setLng:q,preload:k,addResourceBundle:l,removeResourceBundle:m,loadNamespace:o,loadNamespaces:p,localize:$,setDefaultNamespace:n,t:x,translate:x,exists:w,detectLanguage:T.detectLanguage,pluralExtensions:V,sync:U,functions:T,lng:r,addPostProcessor:X,options:P,setDebugLocString:d,clearDebugLocString:e}},function(a,b){"use strict";function c(){this.names=[{symbol:"en",label:"English"},{symbol:"zh-HANS",label:"Chinese Simplified"},{symbol:"zh-HANT",label:"Chinese Traditional"},{symbol:"ja",label:"Japanese"},{symbol:"cs",label:"Czech"},{symbol:"ko",label:"Korean"},{symbol:"pl",label:"Polish"},{symbol:"ru",label:"Russian"},{symbol:"fr",label:"French"},{symbol:"de",label:"German"},{symbol:"it",label:"Italian"},{symbol:"nl",label:"Dutch"},{symbol:"es",label:"Spanish"},{symbol:"pt-BR",label:"Portuguese Brazil"},{symbol:"tr",label:"Turkish"},{symbol:"sv",label:"Swedish"}],this.isSupported=function(a){for(var b=0;b<this.names.length;++b)if(this.names[b].symbol===a)return!0;return!1},this.getSupported=function(a){var b=a.split("-");return a=b.length>1?b[0].toLowerCase()+"-"+b[1].toUpperCase():b[0].toLowerCase(),this.isSupported(a)||(a=a.indexOf("zh-CN")>-1?"zh-HANS":a.indexOf("zh-TW")>-1?"zh-HANT":b.length>1&&this.isSupported(b[0].toLowerCase())?b[0]:"en"),a},this.getLanguages=function(){return this.names.slice()}}Object.defineProperty(b,"__esModule",{value:!0});b.Lang=new c},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.PAGEOUT_NONE=b.PAGEOUT_FAIL=b.PAGEOUT_SUCCESS=b.PIXEL_CULLING_THRESHOLD=b.GEOMETRY_OVERHEAD=b.USE_VAO=b.GPU_OBJECT_LIMIT=b.GPU_MEMORY_LIMIT=b.memoryOptimizedLoading=void 0;var d=c(4);b.memoryOptimizedLoading=!0,b.GPU_MEMORY_LIMIT=1024*((0,d.isMobileDevice)()?64:256)*1024,b.GPU_OBJECT_LIMIT=(0,d.isMobileDevice)()?2500:1e4,b.USE_VAO=!(0,d.isMobileDevice)(),b.GEOMETRY_OVERHEAD=336,b.PIXEL_CULLING_THRESHOLD=1,b.PAGEOUT_SUCCESS=0,b.PAGEOUT_FAIL=1,b.PAGEOUT_NONE=2},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.GroundReflection=void 0;var e=c(39),f=c(41),g=c(44),h=c(47),i=d(h),j=c(48),k=d(j),l=c(49),m=c(2),n=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(m),o={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:i.default,fragmentShader:k.default};b.GroundReflection=function(a,b,c,d){var h,i,j,k,m,p,q=a,r=q.getContext(),s=b||512,t=c||512,u=!1,v=new n.Color(0,0,0),w=!1,x=!1;this.inTarget=void 0,this.outTarget=void 0;var y=!0,z=l.GroundFlags.GROUND_UNFINISHED,A={color:new n.Color(1,1,1),alpha:.3,texScale:.5,blurRadius:2,blurTexScale:.5,fadeAngle:Math.PI/18},B=function(a){var b=a.normal,c=a.constant;return(new n.Matrix4).set(1-2*b.x*b.x,-2*b.y*b.x,-2*b.x*b.z,-2*c*b.x,-2*b.x*b.y,1-2*b.y*b.y,-2*b.y*b.z,-2*c*b.y,-2*b.x*b.z,-2*b.y*b.z,1-2*b.z*b.z,-2*c*b.z,0,0,0,1)};if(this.setTransform=function(a,b,c){k=a,j.normal=b,j.constant=-a.dot(b)},this.cleanup=function(){h&&h.cleanup(),this.inTarget&&this.inTarget.dispose(),this.outTarget&&this.outTarget.dispose()},this.setSize=function(a,b){s=a,t=b,this.cleanup(),this.inTarget=new n.WebGLRenderTarget(s*A.texScale,t*A.texScale,{magFilter:n.LinearFilter,minFilter:n.LinearFilter,format:n.RGBAFormat,stencilBuffer:!1}),this.inTarget.generateMipmaps=!1,this.outTarget=new n.WebGLRenderTarget(s*A.texScale,t*A.texScale,{magFilter:n.LinearFilter,minFilter:n.LinearFilter,format:n.RGBAFormat,stencilBuffer:!1}),this.outTarget.generateMipmaps=!1,h?h.setSize(s*A.texScale*A.blurTexScale,t*A.texScale*A.blurTexScale):h=new f.GaussianPass(s*A.texScale*A.blurTexScale,t*A.texScale*A.blurTexScale,A.blurRadius,1,{hasAlpha:!0,blending:!0,flipUV:!0})},this.updateCamera=function(a){var b;b=a.isPerspective?k.clone():a.target.clone();var c=a.position.clone().sub(b).normalize(),d=Math.PI/2-c.angleTo(j.normal);if(!(u=d<0)){if(A.fadeAngle>0){var e=Math.min(A.fadeAngle,d)/A.fadeAngle;h.setAlpha(e*A.alpha)}var f=B(j);m=a.clone(),m.applyMatrix(f),m.projectionMatrix.elements[5]*=-1,m.matrixWorldNeedsUpdate=!0,a.worldUpTransform?m.worldUpTransform=a.worldUpTransform.clone():m.worldUpTransform=new n.Matrix4}},this.renderIntoReflection=function(a){u||q.render(a,m,this.inTarget)},this.prepareGroundReflection=function(){var a,b=0,c=0,d=0;return function(e,f,g,h,i,j){var k=f.modelQueue();if(z!==l.GroundFlags.GROUND_UNFINISHED||k.isEmpty())return z=l.GroundFlags.GROUND_FINISHED,i;if(a!=k.getGeomScenes()&&(y=!0),y){if(y=!1,this.updateCamera(f.camera),this.isGroundCulled())return z=l.GroundFlags.GROUND_FINISHED,i;this.clear(),a=k.getGeomScenes(),b=a.length,c=0,d=h?Math.max(Math.ceil(b/100),h):b,z=l.GroundFlags.GROUND_UNFINISHED}else{if(z!==l.GroundFlags.GROUND_UNFINISHED)return z=l.GroundFlags.GROUND_FINISHED,i;0===h&&(d=b)}var m,n;i&&(m=performance.now(),j=void 0===j?1:j,n=j*i);for(var o,p=0;p<d&&c<b;){var q=a[c++];if(q&&(p++,q.forceVisible=!0,this.renderIntoReflection(q),q.forceVisible=!1,i)){var r=performance.now()-m;if(n<r&&c<b){z=l.GroundFlags.GROUND_UNFINISHED,o=i-r;break}}}return c<b&&(z=l.GroundFlags.GROUND_UNFINISHED,o=i?i-performance.now()+m:1),void 0===o||g?(this.postprocess(f.camera,f.matman()),e&&e.enabled&&f.renderGroundShadow(this.outTarget),this.renderReflection(f.camera,f.renderer().getColorTarget()),void 0===o&&(z=l.GroundFlags.GROUND_RENDERED),i?i-performance.now()+m:1):o}}(),this.renderReflection=function(a,b){u||(r.depthRange(.999999,1),i.render(q,b,this.outTarget),r.depthRange(0,1))},this.toggleEnvMapBackground=function(a){x=a,p.uniforms.envMapBackground.value=a},this.postprocess=function(a){u||(w||x?(p.uniforms.uCamDir.value=a.worldUpTransform?a.getWorldDirection().clone().applyMatrix4(a.worldUpTransform):a.getWorldDirection(),p.uniforms.uCamUp.value=a.worldUpTransform?a.up.clone().applyMatrix4(a.worldUpTransform):a.up,p.uniforms.uResolution.value.set(s,t),p.uniforms.uHalfFovTan.value=Math.tan(n.Math.degToRad(.5*a.fov)),p.render(q,this.outTarget),q.clearTarget(this.outTarget,!1,!0,!1)):(q.setClearColor(v,1),q.clearTarget(this.outTarget,!0,!0,!1)),h.render(q,this.outTarget,this.inTarget))},this.clear=function(){q.setClearColor(v,0),q.clearTarget(this.inTarget,!0,!0,!1),q.clearBlend()},this.setClearColors=function(a,b,c){b?(v.setRGB(.5*(a.x+b.x),.5*(a.y+b.y),.5*(a.z+b.z)),w=!a.equals(b)&&!c):(v.copy(a),w=!1),w&&(p.uniforms.color1.value.copy(a),p.uniforms.color2.value.copy(b))},this.setEnvRotation=function(a){p.material.envRotationSin=Math.sin(a),p.material.envRotationCos=Math.cos(a)},this.isGroundCulled=function(){return u},this.getStatus=function(){return z},this.setDirty=function(){y=!0,z=l.GroundFlags.GROUND_UNFINISHED},this.setColor=function(a){h.setColor(A.color),A.color.set(a)},this.setAlpha=function(a){h.setAlpha(A.alpha),A.alpha=a},d)for(var C in A)A[C]=void 0!==d[C]?d[C]:A[C];i=new e.ShaderPass(o),i.material.blending=n.NoBlending,i.material.depthTest=!0,i.material.depthWrite=!1,i.scene.position.z=-.999999,d.clearPass?p=d.clearPass:(p=new e.ShaderPass(g.BackgroundShader),p.material.blending=n.NoBlending,p.material.depthWrite=!1,p.material.depthTest=!1),this.setSize(s,t),h.setAlpha(A.color),h.setAlpha(A.alpha),j=new n.Plane(new n.Vector3(0,1,0),0),k=new n.Vector3(0,0,0)}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ShaderPass=void 0;var d=c(40),e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e);(b.ShaderPass=function(a,b){this.textureID=void 0!==b?b:"tDiffuse",this.material=(0,d.createShaderMaterial)(a),this.uniforms=this.material.uniforms,this.renderToScreen=!1,this.enabled=!0,this.clear=!1,this.camera=new f.OrthographicCamera(-1,1,1,-1,0,1);var c=new f.BufferGeometry,e=new Float32Array(9);e[0]=-1,e[1]=-1,e[2]=0,e[3]=3,e[4]=-1,e[5]=0,e[6]=-1,e[7]=3,e[8]=0;var g=new Float32Array(6);g[0]=0,g[1]=0,g[2]=2,g[3]=0,g[4]=0,g[5]=2;var h=new Float32Array(9);h[0]=0,h[1]=0,h[2]=1,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=1,c.addAttribute("position",new f.BufferAttribute(e,3)),c.addAttribute("normal",new f.BufferAttribute(h,3)),c.addAttribute("uv",new f.BufferAttribute(g,2)),this.quad=new f.Mesh(c,this.material),this.scene=new f.Scene,this.scene.add(this.quad)}).prototype={render:function(a,b,c,d){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=c.texture||c),this.renderToScreen||!b?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.removeMacro=b.setMacro=b.createShaderMaterial=void 0;var d=c(2),e=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(d);b.createShaderMaterial=function(a){var b={vertexShader:a.vertexShader,fragmentShader:a.fragmentShader};return a.uniforms&&(b.uniforms=e.UniformsUtils.clone(a.uniforms)),a.defines&&(b.defines=Object.assign({},a.defines)),a.extensions&&(b.extensions=Object.assign({},a.extensions)),a.attributes&&(b.attributes=a.attributes),new e.ShaderMaterial(b)},b.setMacro=function(a,b,c){c=c||"",a.defines||(a.defines={}),a.defines[b]!=c&&(a.defines[b]=c,a.needsUpdate=!0)},b.removeMacro=function(a,b){(a.defines||a.defines[b])&&(delete a.defines[b],a.needsUpdate=!0)}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.GaussianPass=void 0;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(42),h=d(g),i=c(43),j=d(i),k=c(39),l={uniforms:{tDiffuse:{type:"t",value:null},uColor:{type:"v4",value:new f.Vector4(1,1,1,1)}},vertexShader:h.default,fragmentShader:j.default};b.GaussianPass=function(a,b,c,d,e){var g,h,i,j=a,m=b,n=c||3,o=d||1,p={hasAlpha:e.hasAlpha||!1,blending:e.blending||!1,flipUV:e.flipUV||!1};this.render=function(a,b,c){g.render(a,i,c),h.render(a,b,i)},this.setSize=function(a,b){this.cleanup(),j=a,m=b,i=new f.WebGLRenderTarget(a,b,{minFilter:f.LinearFilter,magFilter:f.LinearFilter,format:void 0!==e.format?e.format:f.RGBAFormat,type:void 0!==e.type?e.type:f.UnsignedByteType,stencilBuffer:!1}),i.generateMipmaps=!1,g.material.defines.KERNEL_SCALE_H=h.material.defines.KERNEL_SCALE_H=(o/j).toFixed(4),g.material.defines.KERNEL_SCALE_V=h.material.defines.KERNEL_SCALE_V=(o/m).toFixed(4),g.material.needsUpdate=h.material.needsUpdate=!0},this.cleanup=function(){i&&i.dispose()},this.setColor=function(a){h.material.uniforms.uColor.value.x=a.r,h.material.uniforms.uColor.value.y=a.g,h.material.uniforms.uColor.value.z=a.b},this.setAlpha=function(a){h.material.uniforms.uColor.value.w=a},g=new k.ShaderPass(l),h=new k.ShaderPass(l),this.setSize(a,b),g.material.blending=h.material.blending=f.NoBlending,g.material.depthWrite=h.material.depthWrite=!1,g.material.depthTest=h.material.depthTest=!1,g.material.defines.HORIZONTAL=1,g.material.defines.KERNEL_RADIUS=h.material.defines.KERNEL_RADIUS=n.toFixed(1),p.blending&&(h.material.transparent=!0,h.material.blending=f.NormalBlending),p.hasAlpha&&(g.material.defines.HAS_ALPHA=h.material.defines.HAS_ALPHA=""),p.flipUV&&(g.material.defines.FLIP_UV="")}},function(a,b){a.exports="varying vec2 vUv;\nvoid main() {\n#if defined(HORIZONTAL) && defined(FLIP_UV)\n    vUv = vec2(uv.x, 1.0-uv.y);\n#else\n    vUv = vec2(uv.x, uv.y);\n#endif\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},function(a,b){a.exports="uniform sampler2D tDiffuse;\nuniform vec4 uColor;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE_H*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE_V*(Y))\n#endif\n#define PI 3.14159265358979\n#define SIGMA ((KERNEL_RADIUS+KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#define GAUSSIAN(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\nvoid main() {\n    vec4 texColSum = vec4(0.0);\n    float gaussSum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        float gauss = GAUSSIAN(x);\n        vec4 texCol = texture2D(tDiffuse, GET_UV(x));\n#ifdef HAS_ALPHA\n        texCol.rgb *= texCol.a;\n#endif\n        texColSum += texCol * gauss;\n        gaussSum += gauss;\n    }\n#ifdef HAS_ALPHA\n    texColSum.rgb /= (texColSum.a == 0.0 ? 0.0001 : texColSum.a);\n#endif\n#ifdef HORIZONTAL\n    gl_FragColor = texColSum/gaussSum;\n#else\n    gl_FragColor = texColSum/gaussSum * uColor;\n#endif\n}\n"},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.BackgroundShader=void 0;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(45),h=d(g),i=c(46),j=d(i);b.BackgroundShader={uniforms:{color1:{type:"v3",
value:new f.Vector3(41/255,76/255,120/255)},color2:{type:"v3",value:new f.Vector3(1/255,2/255,3/255)},envMap:{type:"t",value:null},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},uCamDir:{type:"v3",value:new f.Vector3},uCamUp:{type:"v3",value:new f.Vector3},uResolution:{type:"v2",value:new f.Vector2(600,400)},uHalfFovTan:{type:"f",value:.5},envMapBackground:{type:"i",value:0}},vertexShader:h.default,fragmentShader:j.default}},function(a,b){a.exports="uniform vec3 color1;\nuniform vec3 color2;\nvarying vec2 vUv;\nvarying vec3 vColor;\nvoid main() {\n    if (uv.y == 0.0)\n        vColor = color2;\n    else\n        vColor = color1;\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},function(a,b){a.exports="varying vec3 vColor;\nvarying vec2 vUv;\nuniform samplerCube envMap;\nuniform vec3 uCamDir;\nuniform vec3 uCamUp;\nuniform vec2 uResolution;\nuniform float uHalfFovTan;\nuniform bool envMapBackground;\n#include<env_sample>\nconst int bloomRange = 4;\n#include<ordered_dither>\nuniform float envMapExposure;\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\n#include<tonemap>\n#endif\nvec3 rayDir(in vec2 vUv) {\n    vec3 A = (uResolution.x/uResolution.y)*normalize(cross(uCamDir,uCamUp)) * (uHalfFovTan * 2.0);\n    vec3 B = normalize(uCamUp) * (uHalfFovTan * 2.0);\n    vec3 C = normalize(uCamDir);\n    vec3 ray = normalize( C + (2.0*vUv.x-1.0)*A + (2.0*vUv.y-1.0)*B );\n    return ray;\n}\nvec3 getColor(in vec3 rd) {\n    return RGBMDecode(textureCube(envMap, adjustLookupVector(rd)), envMapExposure);\n}\nvoid main() {\n    vec3 rd = rayDir(vUv);\n    vec3 outColor;\n    if (envMapBackground) {\n        outColor = getColor(rd);\n#if TONEMAP_OUTPUT == 1\n        outColor = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * outColor);\n#elif TONEMAP_OUTPUT == 2\n        outColor = toneMapCanonFilmic_WithGamma(exposureBias * outColor);\n#endif\n    }\n    else {\n        outColor = vColor;\n    }\n    gl_FragColor = vec4(orderedDithering(outColor), 1.0);\n}\n"},function(a,b){a.exports="varying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},function(a,b){a.exports="uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n    vec4 texel = texture2D( tDiffuse, vUv );\n    gl_FragColor = texel;\n}\n"},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.GroundFlags={GROUND_UNFINISHED:0,GROUND_FINISHED:1,GROUND_RENDERED:2}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){var b=new x.PlaneBufferGeometry(1,1);if(b.attributes.index.array.reverse)b.attributes.index.array.reverse();else for(var c,d=b.attributes.index.array,e=Math.floor(d.length/2),f=0,g=d.length;f<e;++f)c=d[f],d[f]=d[g-1-f],d[g-1-f]=c;return new x.Mesh(b,a)}function f(a,b,c,d,e){C||(C=new x.Matrix4),D||(D=new x.Vector3),E||(E=new x.Vector3),D.subVectors(b,d),C.lookAt(D,b,e),E.copy(d).multiplyScalar(-.5*c.y).add(b),a.position.copy(E),a.rotation.setFromRotationMatrix(C),a.scale.set(c.z,c.x,c.y)}function g(a,b){var c,d,g,j,k,l,m,n,o,p,q,r=a,s=!1,t=!0,u=v.GroundFlags.GROUND_FINISHED,w={texSize:64,pixScale:1,blurRadius:7,debug:!1};if(this.setTransform=function(){var a=new x.Vector3(0,0,0),b=new x.Vector3(0,0,0),d=new x.Vector3(0,0,0),e=new x.Vector3(0,0,0);return function(h,i,j,k){h.equals(a)&&i.equals(b)&&j.equals(d)&&k.equals(e)||(a.copy(h),b.copy(i),d.copy(j),e.copy(k),this.setDirty(),c.left=-i.z/2,c.right=i.z/2,c.top=i.x/2,c.bottom=-i.x/2,c.near=1,c.far=i.y+c.near,c.updateProjectionMatrix(),f(g,h,i,j,k),c.position.addVectors(h,j.clone().multiplyScalar(-i.y/2-c.near)),k&&c.up.set(k.x,k.y,k.z),c.lookAt(h),w.debug&&(q.position.set(h.x,h.y,h.z),q.rotation.set(c.rotation.x,c.rotation.y,c.rotation.z),q.scale.set(i.z,i.x,i.y)),p.uniforms.worldSize.value.copy(i))}}(),this.renderIntoShadow=function(a){if(!a.overrideMaterial||!a.overrideMaterial.transparent){var b=a.overrideMaterial;a.overrideMaterial=l,r.render(a,c,j,!1),a.overrideMaterial=b}},this.prepareGroundShadow=function(){var a,b=0,c=0,d=0;return function(e,f,g,h){if(!this.enabled||e.isEmpty())return u=v.GroundFlags.GROUND_FINISHED,g;if(a!=e.getGeomScenes()&&(t=!0),t)this.clear(),t=!1,a=e.getGeomScenes(),b=a.length,c=0,d=f?Math.max(Math.ceil(b/100),f):b;else{if(u===v.GroundFlags.GROUND_RENDERED||u===v.GroundFlags.GROUND_FINISHED)return u=v.GroundFlags.GROUND_FINISHED,g;0===f&&(d=b)}var i,j;g&&(i=performance.now(),h=void 0===h?1:h,j=h*g);for(var k,l=0;l<d&&c<b;){var m=a[c++];if(m&&(l++,m.forceVisible=!0,this.renderIntoShadow(m),m.forceVisible=!1,g)){var n=performance.now()-i;if(j<n){u=v.GroundFlags.GROUND_UNFINISHED,k=g-n;break}}}return c<b&&(u=v.GroundFlags.GROUND_UNFINISHED,k=g?g-performance.now()+i:1),void 0!==k?k:(this.postprocess(),u=v.GroundFlags.GROUND_RENDERED,g?g-performance.now()+i:1)}}(),this.renderShadow=function(a,b){s&&(b?r.render(d,a,b,!1):r.render(d,a))},this.postprocess=function(){o.render(r,k,j),n.render(r,j,k),s=!0},this.clear=function(){var a=r.getClearColor().getHex(),b=r.getClearAlpha();r.setClearColor(0,0),r.clearTarget(j,!0,!0,!1),r.setClearColor(a,b),r.clearBlend(),s=!1},this.setColor=function(a){m.uniforms.uShadowColor.value.x=a.r,m.uniforms.uShadowColor.value.y=a.g,m.uniforms.uShadowColor.value.z=a.b},this.getColor=function(){return new x.Color(m.uniforms.uShadowColor.value.x,m.uniforms.uShadowColor.value.y,m.uniforms.uShadowColor.value.z)},this.setAlpha=function(a){m.uniforms.uShadowColor.value.w=a},this.getAlpha=function(){return m.uniforms.uShadowColor.value.w},this.isValid=function(){return s},this.getStatus=function(){return u},this.setDirty=function(){t=!0,u=v.GroundFlags.GROUND_UNFINISHED},this.getDepthMaterial=function(){return l},b)for(var C in w)w[C]=b[C]||w[C];d=new x.Scene,c=new x.OrthographicCamera,j=new x.WebGLRenderTarget(w.texSize,w.texSize,{minFilter:x.LinearFilter,magFilter:x.LinearFilter,format:x.RGBAFormat,stencilBuffer:!1}),j.generateMipmaps=!1,k=new x.WebGLRenderTarget(w.texSize,w.texSize,{minFilter:x.LinearFilter,magFilter:x.LinearFilter,format:x.RGBAFormat,stencilBuffer:!1}),k.generateMipmaps=!1,l=(0,h.createShaderMaterial)(y),l.side=x.DoubleSide,l.blending=x.NoBlending,n=new i.ShaderPass(A,"tDepth"),o=new i.ShaderPass(A,"tDepth"),p=new i.ShaderPass(z,"tDepth"),n.material.defines.KERNEL_SCALE=o.material.defines.KERNEL_SCALE=(w.pixScale/w.texSize).toFixed(4),n.material.defines.KERNEL_RADIUS=o.material.defines.KERNEL_RADIUS=w.blurRadius.toFixed(2),p.material.blending=n.material.blending=o.material.blending=x.NoBlending,p.material.depthWrite=n.material.depthWrite=o.material.depthWrite=!1,p.material.depthTest=n.material.depthTest=o.material.depthTest=!1,n.material.defines.HORIZONTAL=1,m=(0,h.createShaderMaterial)(B),m.uniforms.tDepth.value=j,m.depthWrite=!1,m.transparent=!0,g=e(m),d.add(g),w.debug&&(q=new x.Mesh(new x.BoxGeometry(1,1,1),new x.MeshBasicMaterial({color:65280,wireframe:!0})),d.add(q)),this.setTransform(new x.Vector3(0,0,0),new x.Vector3(1,1,1),new x.Vector3(0,1,0),x.Object3D.DefaultUp)}Object.defineProperty(b,"__esModule",{value:!0}),b.createGroundShape=e,b.setGroundShapeTransform=f,b.GroundShadow=g;var h=c(40),i=c(39),j=c(51),k=d(j),l=c(52),m=d(l),n=c(47),o=d(n),p=c(53),q=d(p),r=c(54),s=d(r),t=c(55),u=d(t),v=c(49),w=c(2),x=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(w),y={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:k.default,fragmentShader:m.default},z={uniforms:{tDepth:{type:"t",value:null},worldSize:{type:"v3",value:new x.Vector3(1,1,1)}},defines:{},vertexShader:o.default,fragmentShader:q.default},A={uniforms:{tDepth:{type:"t",value:null}},defines:{},vertexShader:o.default,fragmentShader:s.default},B={uniforms:{tDepth:{type:"t",value:null},uShadowColor:{type:"v4",value:new x.Vector4(0,0,0,1)}},vertexShader:o.default,fragmentShader:u.default},C=void 0,D=void 0,E=void 0;g.prototype.constructor=g},function(a,b){a.exports="#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );;\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n    vFragDepth = 1.0 + gl_Position.w;\n#else\n    gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n#endif\n}\n"},function(a,b){a.exports="#ifdef USE_LOGDEPTHBUF\nuniform float logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n#extension GL_EXT_frag_depth : enable\nvarying float vFragDepth;\n#endif\n#endif\n#include<pack_depth>\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n    gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif\n#ifdef USE_LOGDEPTHBUF_EXT\n    float depth = gl_FragDepthEXT / gl_FragCoord.w;\n#else\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n#endif\n    depth = 1.0 - depth;\n    gl_FragColor = packDepth(depth);\n}\n"},function(a,b){a.exports="#define NUM_SAMPLES 29.0\n#define NUM_SPIRAL_TURNS 7.0\nuniform sampler2D tDepth;\nuniform vec3 worldSize;\nvarying vec2 vUv;\n#ifdef PRESET_2\n#define SAMPLE_RADIUS 0.3\n#define AO_GAMMA 1.0\n#define AO_INTENSITY 1.0\n#else\n#define SAMPLE_RADIUS 0.2\n#define AO_GAMMA 3.0\n#define AO_INTENSITY 0.8\n#endif\n#include<pack_depth>\n#define PI 3.14159265358979\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\nfloat getRandomAngle(vec2 pos) {\n    return rand(pos) * (2.0 * PI);\n}\nvec2 tapLocation(float sampleNumber, float spinAngle, out float ssR){\n    float alpha = float(sampleNumber + 0.5) * (1.0 / NUM_SAMPLES);\n    float angle = alpha * (NUM_SPIRAL_TURNS * PI * 2.0) + spinAngle;\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n}\nvec2 sampleAO(vec2 unitDirection, float radius) {\n    vec2 sampleOffset = unitDirection * radius;\n    float idepth = unpackDepth(texture2D(tDepth, vUv + sampleOffset));\n    float depth = 1.0 - idepth;\n    if (depth < 1e-6) {\n        if (radius == 0.0)\n            return vec2(1.0, 1.0);\n        else\n            return vec2(0.0, 1.0);\n    }\n    vec3 dir = vec3(sampleOffset.x, depth, sampleOffset.y) * worldSize;\n    float distance2 = dot(dir,dir);\n    float idistance = 1.0 / sqrt(distance2);\n    vec3 ndir = dir * idistance;\n#ifdef PRESET_2\n    float importance = ndir.y * idistance;\n#else\n    float importance = ndir.y / distance2;\n#endif\n    vec2 ret;\n    ret.x = (idepth == 0.0) ? 0.0 : importance;\n    ret.y = importance;\n    return ret;\n}\nvoid main() {\n    vec2 sum = vec2(0.0);\n    float angle = getRandomAngle(vUv);\n    for (float i = 0.0; i<NUM_SAMPLES; i+= 1.0) {\n        float ssR;\n        vec2 uv = tapLocation(i, angle, ssR);\n        sum += sampleAO(uv, ssR * SAMPLE_RADIUS);\n    }\n    float ao = sum.x / sum.y;\n    gl_FragColor = packDepth(AO_INTENSITY * clamp(pow(ao, AO_GAMMA), 0.0, 0.9999));\n}\n"},function(a,b){a.exports="uniform sampler2D tDepth;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE*(Y))\n#endif\n#include<pack_depth>\n#define PI 3.14159265358979\n#define SIGMA ((2.0 * KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#ifdef BOX\n#define KERNEL_VAL(X) 1.0\n#else\n#define KERNEL_VAL(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\n#endif\nvoid main() {\n    float depthVal = 0.0;\n    float sum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        depthVal += unpackDepth(texture2D(tDepth, GET_UV(x))) * KERNEL_VAL(x);\n        sum += KERNEL_VAL(x);\n    }\n    gl_FragColor = packDepth(depthVal/sum);\n}\n"},function(a,b){a.exports="uniform sampler2D tDepth;\nuniform vec4 uShadowColor;\nvarying vec2 vUv;\n#include<pack_depth>\nvoid main() {\n    float depthVal = unpackDepth(texture2D(tDepth, vUv));\n    gl_FragColor = vec4(uShadowColor.rgb, uShadowColor.a * depthVal);\n}\n"},function(a,b,c){"use strict";function d(a,b,c){var d=a.createShader(b);return a.shaderSource(d,c),a.compileShader(d),"undefined"!=typeof DEBUG_SHADERS&&DEBUG_SHADERS&&(!1===a.getShaderParameter(d,a.COMPILE_STATUS)&&f.error("THREE.WebGLShader: Shader couldn't compile."),""!==a.getShaderInfoLog(d)&&f.warn("THREE.WebGLShader: gl.getShaderInfoLog()",a.getShaderInfoLog(d),g(c))),d}Object.defineProperty(b,"__esModule",{value:!0}),b.WebGLShader=d;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=function(a){for(var b=a.split("\n"),c=0;c<b.length;c++)b[c]=c+1+": "+b[c];return b.join("\n")}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.PhongShader=void 0;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(58),h=c(90),i=d(h),j=c(91),k=d(j),l=b.PhongShader={uniforms:f.UniformsUtils.merge([f.UniformsLib.common,f.UniformsLib.bump,f.UniformsLib.normalmap,f.UniformsLib.lights,f.UniformsLib.fog,g.ShaderChunks.CutPlanesUniforms,g.ShaderChunks.IdUniforms,g.ShaderChunks.ThemingUniform,g.ShaderChunks.ShadowMapUniforms,g.ShaderChunks.WideLinesUniforms,{emissive:{type:"c",value:new f.Color(0)},specular:{type:"c",value:new f.Color(1118481)},shininess:{type:"f",value:30},reflMipIndex:{type:"f",value:0},texMatrix:{type:"m3",value:new f.Matrix3},texMatrixBump:{type:"m3",value:new f.Matrix3},texMatrixAlpha:{type:"m3",value:new f.Matrix3},irradianceMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1}}]),vertexShader:i.default,fragmentShader:k.default};f.ShaderLib.firefly_phong=l},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){return["#if defined( USE_SURFACE_ALBEDO_MAP ) || defined( USE_SURFACE_ROUGHNESS_MAP ) || defined( USE_SURFACE_CUTOUT_MAP ) || defined( USE_SURFACE_ANISOTROPY_MAP ) || defined( USE_SURFACE_ROTATION_MAP ) || defined( USE_OPAQUE_ALBEDO_MAP ) || defined( USE_OPAQUE_F0_MAP ) || defined( USE_OPAQUE_LUMINANCE_MODIFIER_MAP ) || defined( USE_LAYERED_BOTTOM_F0_MAP ) || defined( USE_LAYERED_F0_MAP ) || defined( USE_LAYERED_DIFFUSE_MAP ) || defined( USE_LAYERED_FRACTION_MAP ) || defined( USE_LAYERED_ROUGHNESS_MAP ) || defined( USE_LAYERED_ANISOTROPY_MAP ) || defined( USE_LAYERED_ROTATION_MAP ) || defined( USE_METAL_F0_MAP ) || defined( USE_SURFACE_NORMAL_MAP ) || defined( USE_LAYERED_NORMAL_MAP )","#define "+a,"#endif"].join("\n")}function f(a,b,c,d){var e=c?"_v3":"",f=c?"vec3 ":"",g=c?b+" = average("+b+e+");":"",h=d?b+e+" = SRGBToLinear("+b+e+");":"";return["#if defined( USE_"+a.toUpperCase()+"_MAP )","vec2 uv_"+a+"_map = ("+a+"_map_texMatrix * vec3(uv, 1.0)).xy;",a.toUpperCase()+"_CLAMP_TEST;",f+b+e+" = texture2D("+a+"_map, uv_"+a+"_map).xyz;",h,"if("+a+"_map_invert) "+b+e+" = vec3(1.0) - "+b+e+";",g,"#else",b+" = "+a+";","#endif"].join("\n")}function g(a){var b=a+"_texMatrix",c=a+"_invert";return["#if defined( "+("USE_"+a).toUpperCase()+" )","uniform sampler2D "+a+";","uniform mat3 "+b+";","uniform bool "+c+";","#endif"].join("\n")}function h(a){var b=a+"_texMatrix",c=a+"_bumpScale",d=a+"_bumpmapType";return["#if defined( "+("USE_"+a).toUpperCase()+" )","uniform sampler2D "+a+";","uniform mat3 "+b+";","uniform vec2 "+c+";","uniform int "+d+";","#endif"].join("\n")}Object.defineProperty(b,"__esModule",{value:!0}),b.ShaderChunks=b.PointSizeShaderChunk=b.PointSizeDeclaration=b.ShadowMapFragmentDeclaration=b.ShadowMapVertexShaderChunk=b.ShadowMapVertexDeclaration=b.ShadowMapDeclareCommonUniforms=b.InstancingVertexDeclaration=b.ThemingFragmentShaderChunk=b.ThemingFragmentDeclaration=b.FinalOutputShaderChunk=b.IdOutputShaderChunk=b.IdFragmentDeclaration=b.IdVertexShaderChunk=b.IdVertexDeclaration=b.EnvSamplingShaderChunk=b.HatchPatternShaderChunk=b.PackNormalsShaderChunk=b.CutPlanesShaderChunk=b.OrderedDitheringShaderChunk=b.TonemapShaderChunk=b.PackDepthShaderChunk=b.resolve=b.DepthTextureUniforms=b.WideLinesUniforms=b.PointSizeUniforms=b.ShadowMapUniforms=b.ShadowMapCommonUniforms=b.ThemingUniform=b.IdUniforms=b.CutPlanesUniforms=void 0,b.GetPrismMapSampleChunk=f,b.GetPrismMapUniformChunk=g;var i=c(2),j=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(i),k=c(59),l=d(k),m=c(60),n=d(m),o=c(61),p=d(o),q=c(62),r=d(q),s=c(63),t=d(s),u=c(64),v=d(u),w=c(65),x=d(w),y=c(66),z=d(y),A=c(67),B=d(A),C=c(68),D=d(C),E=c(69),F=d(E),G=c(70),H=d(G),I=c(71),J=d(I),K=c(72),L=d(K),M=c(73),N=d(M),O=c(74),P=d(O),Q=c(75),R=d(Q),S=c(76),T=d(S),U=c(77),V=d(U),W=c(78),X=d(W),Y=c(79),Z=d(Y),$=c(80),_=d($),aa=c(81),ba=d(aa),ca=c(82),da=d(ca),ea=c(83),fa=d(ea),ga=c(84),ha=d(ga),ia=c(85),ja=d(ia),ka=c(86),la=d(ka),ma=c(87),na=d(ma),oa=c(88),pa=d(oa),qa=c(89),ra=d(qa),sa=b.CutPlanesUniforms={cutplanes:{type:"v4v",value:[]},hatchParams:{type:"v2",value:new j.Vector2(1,10)},hatchTintColor:{type:"c",value:new j.Color(16777215)},hatchTintIntensity:{type:"f",value:1}},ta=b.IdUniforms={dbId:{type:"v3",value:new j.Vector3(0,0,0)},modelId:{type:"v3",value:new j.Vector3(0,0,0)}},ua=b.ThemingUniform={themingColor:{type:"v4",value:new j.Vector4(0,0,0,0)}},va=b.ShadowMapCommonUniforms={shadowESMConstant:{type:"f",value:0}},wa=b.ShadowMapUniforms=j.UniformsUtils.merge([{shadowMap:{type:"t",value:null},shadowMapSize:{type:"v2",value:new j.Vector2(0,0)},shadowBias:{type:"f",value:0},shadowDarkness:{type:"f",value:0},shadowMatrix:{type:"m4",value:new j.Matrix4},shadowLightDir:{type:"v3",value:new j.Vector3}},va]),xa=b.PointSizeUniforms={point_size:{type:"f",value:1}},ya=b.WideLinesUniforms={view_size:{type:"v2",value:new j.Vector2(640,480)}},za=b.DepthTextureUniforms={tDepth:{type:"t",value:null},projInfo:{type:"v4",value:new j.Vector4},isOrtho:{type:"f",value:0},worldMatrix_mainPass:{type:"m4",value:new j.Matrix4}},Aa={};for(var Ba in j.ShaderChunk)Aa[Ba]=j.ShaderChunk[Ba];Aa.pack_depth=l.default,Aa.depth_texture=n.default,Aa.tonemap=p.default,Aa.ordered_dither=r.default,Aa.cutplanes=t.default,Aa.pack_normals=v.default,Aa.hatch_pattern=x.default,Aa.env_sample=z.default,Aa.id_decl_vert=B.default,Aa.id_vert=D.default,Aa.id_decl_frag=F.default,Aa.id_frag=H.default,Aa.final_frag=J.default,Aa.theming_decl_frag=L.default,Aa.theming_frag=N.default,Aa.instancing_decl_vert=P.default,Aa.shadowmap_decl_common=R.default,Aa.shadowmap_decl_vert=T.default,Aa.shadowmap_vert=V.default,Aa.shadowmap_decl_frag=X.default,Aa.float3_average=Z.default,Aa.line_decl_common=_.default,Aa.prism_wood=ba.default,Aa.prism_glazing=da.default,Aa.prism_transparency=fa.default,Aa.normal_map=ha.default,Aa.decl_point_size=ja.default,Aa.point_size=la.default,Aa.wide_lines_decl=na.default,Aa.wide_lines_vert=pa.default,Aa.hsv=ra.default;var Ca={};Ca.prism_check=e,Ca.prism_sample_texture=function(a,b,c,d){return f(a,b,"true"===c,"true"===d)},Ca.prism_uniforms=g,Ca.prism_bump_uniforms=h;var Da={};for(Ba in Ca)Da[Ba]=new RegExp("#"+Ba+" *<([\\w\\d., ]*)>","g");var Ea=b.resolve=function a(b){for(var c in Ca){var d=Da[c];b=b.replace(d,function(a,b){var d=b.split(",").map(function(a){return a.trim()});return Ca[c].apply(null,d)})}var e=/#include *<([\w\d.]+)>/g,f=function(b,c){if(!Aa[c])throw new Error("Cannot resolve #include<"+c+">");return a(Aa[c])};return b.replace(e,f)},Fa=b.PackDepthShaderChunk=Aa.pack_depth,Ga=b.TonemapShaderChunk=Aa.tonemap,Ha=b.OrderedDitheringShaderChunk=Aa.ordered_dither,Ia=b.CutPlanesShaderChunk=Aa.cutplanes,Ja=b.PackNormalsShaderChunk=Aa.pack_normals,Ka=b.HatchPatternShaderChunk=Aa.hatch_pattern,La=b.EnvSamplingShaderChunk=Aa.env_sample,Ma=b.IdVertexDeclaration=Aa.id_decl_vert,Na=b.IdVertexShaderChunk=Aa.id_vert,Oa=b.IdFragmentDeclaration=Aa.id_decl_frag,Pa=b.IdOutputShaderChunk=Aa.id_frag,Qa=b.FinalOutputShaderChunk=Aa.final_frag,Ra=b.ThemingFragmentDeclaration=Aa.theming_decl_frag,Sa=b.ThemingFragmentShaderChunk=Aa.theming_frag,Ta=b.InstancingVertexDeclaration=Aa.instancing_decl_vert,Ua=b.ShadowMapDeclareCommonUniforms=Aa.shadowmap_decl_common,Va=b.ShadowMapVertexDeclaration=Aa.shadowmap_decl_vert,Wa=b.ShadowMapVertexShaderChunk=Aa.shadowmap_vert,Xa=b.ShadowMapFragmentDeclaration=Aa.shadowmap_decl_frag,Ya=b.PointSizeDeclaration=Aa.decl_point_size,Za=b.PointSizeShaderChunk=Aa.point_size;b.ShaderChunks={IdUniforms:ta,ThemingUniform:ua,CutPlanesUniforms:sa,ShadowMapCommonUniforms:va,ShadowMapUniforms:wa,PointSizeUniforms:xa,WideLinesUniforms:ya,DepthTextureUniforms:za,PackDepthShaderChunk:Fa,TonemapShaderChunk:Ga,OrderedDitheringShaderChunk:Ha,CutPlanesShaderChunk:Ia,PackNormalsShaderChunk:Ja,HatchPatternShaderChunk:Ka,EnvSamplingShaderChunk:La,IdVertexDeclaration:Ma,IdVertexShaderChunk:Na,IdFragmentDeclaration:Oa,IdOutputShaderChunk:Pa,FinalOutputShaderChunk:Qa,ThemingFragmentDeclaration:Ra,ThemingFragmentShaderChunk:Sa,InstancingVertexDeclaration:Ta,ShadowMapDeclareCommonUniforms:Ua,ShadowMapVertexDeclaration:Va,ShadowMapVertexShaderChunk:Wa,ShadowMapFragmentDeclaration:Xa,PointSizeDeclaration:Ya,PointSizeShaderChunk:Za,GetPrismMapSampleChunk:f,GetPrismMapUniformChunk:g,resolve:Ea}},function(a,b){a.exports="\nvec4 packDepth( const in float depth ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n}\nfloat unpackDepth( const in vec4 rgba_depth ) {\n    return dot( rgba_depth, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );\n}\n"},function(a,b){a.exports="\nuniform sampler2D tDepth;\nuniform vec4 projInfo;\nuniform float isOrtho;\nuniform mat4 worldMatrix_mainPass;\nvec3 reconstructCSPosition(vec2 fragCoords, float z) {\n    return vec3((fragCoords * projInfo.xy + projInfo.zw) * mix(z, -1.0, isOrtho), z);\n}\nvec3 reconstructWorldPosition(vec2 fragCoords, vec2 screenUv) {\n    float zCam = texture2D(tDepth, screenUv).z;\n    vec3 csPos = reconstructCSPosition(fragCoords, zCam);\n    return (worldMatrix_mainPass * vec4(csPos, 1.0)).xyz;\n}\n"},function(a,b){a.exports="\nfloat luminance_post(vec3 rgb) {\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nfloat luminance_pre(vec3 rgb) {\n    return dot(rgb, vec3(0.212671, 0.715160, 0.072169));\n}\nvec3 xyz2rgb(vec3 xyz) {\n    vec3 R = vec3( 3.240479, -1.537150, -0.498535);\n    vec3 G = vec3(-0.969256,  1.875992,  0.041556);\n    vec3 B = vec3( 0.055648, -0.204043,  1.057311);\n    vec3 rgb;\n    rgb.b = dot(xyz, B);\n    rgb.g = dot(xyz, G);\n    rgb.r = dot(xyz, R);\n    return rgb;\n}\nvec3 rgb2xyz(vec3 rgb) {\n    vec3 X = vec3(0.412453, 0.35758, 0.180423);\n    vec3 Y = vec3(0.212671, 0.71516, 0.0721688);\n    vec3 Z = vec3(0.0193338, 0.119194, 0.950227);\n    vec3 xyz;\n    xyz.x = dot(rgb, X);\n    xyz.y = dot(rgb, Y);\n    xyz.z = dot(rgb, Z);\n    return xyz;\n}\nvec3 xyz2xyY(vec3 xyz) {\n    float sum = xyz.x + xyz.y + xyz.z;\n    sum = 1.0 / sum;\n    vec3 xyY;\n    xyY.z = xyz.y;\n    xyY.x = xyz.x * sum;\n    xyY.y = xyz.y * sum;\n    return xyY;\n}\nvec3 xyY2xyz(vec3 xyY) {\n    float x = xyY.x;\n    float y = xyY.y;\n    float Y = xyY.z;\n    vec3 xyz;\n    xyz.y = Y;\n    xyz.x = x * (Y / y);\n    xyz.z = (1.0 - x - y) * (Y / y);\n    return xyz;\n}\nfloat toneMapCanon_T(float x)\n{\n    float xpow = pow(x, 1.60525727);\n    float tmp = ((1.05542877*4.68037409)*xpow) / (4.68037409*xpow + 1.0);\n    return clamp(tmp, 0.0, 1.0);\n}\nconst float Shift = 1.0 / 0.18;\nfloat toneMapCanonFilmic_NoGamma(float x) {\n    x *= Shift;\n    const float A = 0.2;\n    const float B = 0.34;\n    const float C = 0.002;\n    const float D = 1.68;\n    const float E = 0.0005;\n    const float F = 0.252;\n    const float scale = 1.0/0.833837;\n    return (((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F) * scale;\n}\nvec3 toneMapCanonFilmic_WithGamma(vec3 x) {\n    x *= Shift;\n    const float A = 0.27;\n    const float B = 0.29;\n    const float C = 0.052;\n    const float D = 0.2;\n    const float F = 0.18;\n    const float scale = 1.0/0.897105;\n    return (((x*(A*x+C*B))/(x*(A*x+B)+D*F))) * scale;\n}\nvec3 toneMapCanonOGS_WithGamma_WithColorPerserving(vec3 x) {\n    vec3 outColor = x.rgb;\n    outColor = min(outColor, vec3(3.0));\n    float inLum = luminance_pre(outColor);\n    if (inLum > 0.0) {\n        float outLum = toneMapCanon_T(inLum);\n        outColor = outColor * (outLum / inLum);\n        outColor = clamp(outColor, vec3(0.0), vec3(1.0));\n    }\n    float gamma = 1.0/2.2;\n    outColor = pow(outColor, vec3(gamma));\n    return outColor;\n}\n"},function(a,b){a.exports="vec3 orderedDithering(vec3 col) {\n    const vec4 m0 = vec4( 1.0, 13.0,  4.0, 16.0);\n    const vec4 m1 = vec4( 9.0,  5.0, 12.0,  8.0);\n    const vec4 m2 = vec4( 3.0, 15.0,  2.0, 14.0);\n    const vec4 m3 = vec4(11.0,  7.0, 10.0,  6.0);\n    int i = int(mod(float(gl_FragCoord.x), 4.0));\n    int j = int(mod(float(gl_FragCoord.y), 4.0));\n    vec4 biasRow;\n    if      (i==0) biasRow = m0;\n    else if (i==1) biasRow = m1;\n    else if (i==2) biasRow = m2;\n    else           biasRow = m3;\n    float bias;\n    if      (j==0) bias = biasRow.x;\n    else if (j==1) bias = biasRow.y;\n    else if (j==2) bias = biasRow.z;\n    else           bias = biasRow.w;\n    return col + bias / 17.0 / 256.0;\n}\n"},function(a,b){a.exports="#if NUM_CUTPLANES > 0\nuniform vec4 cutplanes[NUM_CUTPLANES];\nvoid checkCutPlanes(vec3 worldPosition) {\n    for (int i=0; i<NUM_CUTPLANES; i++) {\n        if (dot(vec4(worldPosition, 1.0), cutplanes[i]) > 0.0) {\n            discard;\n        }\n    }\n}\n#endif\n"},function(a,b){a.exports="\n#define kPI 3.14159265358979\nvec2 encodeNormal (vec3 n) {\n    return (vec2(atan(n.y,n.x)/kPI, n.z)+1.0)*0.5;\n}\nvec3 decodeNormal (vec2 enc) {\n    vec2 ang = enc * 2.0 - 1.0;\n    vec2 scth = vec2(sin(ang.x * kPI), cos(ang.x * kPI));\n    vec2 scphi = vec2(sqrt(1.0 - ang.y * ang.y), ang.y);\n    return vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y);\n}\n"},function(a,b){a.exports="#ifdef HATCH_PATTERN\nuniform vec2 hatchParams;\nuniform vec3 hatchTintColor;\nuniform float hatchTintIntensity;\nfloat curveGaussian(float r, float invWidth) {\n    float amt = clamp(r * invWidth, 0.0, 1.0);\n    float exponent = amt * 3.5;\n    return exp(-exponent*exponent);\n}\nvec4 calculateHatchPattern(vec2 hatchParams, vec2 coord, vec4 fragColor, vec3 hatchTintColor, float hatchTintIntensity ) {\n    float hatchSlope = hatchParams.x;\n    float hatchPeriod = hatchParams.y;\n    if (abs(hatchSlope) <= 1.0) {\n        float hatchPhase = coord.y - hatchSlope * coord.x;\n        float dist = abs(mod((hatchPhase), (hatchPeriod)));\n        if (dist < 1.0) {\n            fragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);\n        }\n    } else {\n        float hatchPhase = - coord.y / hatchSlope + coord.x;\n        float dist = abs(mod((hatchPhase), (hatchPeriod)));\n        if (dist < 1.0) {\n            fragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);\n        }\n    }\n    return fragColor;\n}\n#endif\n"},function(a,b){a.exports="\nuniform float envRotationSin;\nuniform float envRotationCos;\nvec3 adjustLookupVector(in vec3 lookup) {\n    return vec3(\n            envRotationCos * lookup.x - envRotationSin * lookup.z,\n            lookup.y,\n            envRotationSin * lookup.x + envRotationCos * lookup.z);\n}\nvec3 RGBMDecode(in vec4 vRGBM, in float exposure) {\n    vec3 ret = vRGBM.rgb * (vRGBM.a * 16.0);\n    ret *= ret;\n    ret *= exposure;\n    return ret;\n}\nvec3 GammaDecode(in vec4 vRGBA, in float exposure) {\n    return vRGBA.xyz * vRGBA.xyz * exposure;\n}\nvec3 sampleIrradianceMap(vec3 dirWorld, samplerCube irrMap, float exposure) {\n    vec4 cubeColor4 = textureCube(irrMap, adjustLookupVector(dirWorld));\n#ifdef IRR_GAMMA\n    vec3 indirectDiffuse = GammaDecode(cubeColor4, exposure);\n#elif defined(IRR_RGBM)\n    vec3 indirectDiffuse = RGBMDecode(cubeColor4, exposure);\n#else\n    vec3 indirectDiffuse = cubeColor4.xyz;\n#ifdef GAMMA_INPUT\n    indirectDiffuse.xyz *= indirectDiffuse.xyz;\n#endif\n#endif\n    return indirectDiffuse;\n}\n"},function(a,b){a.exports="#ifdef USE_VERTEX_ID\nattribute vec3 id;\nvarying   vec3 vId;\n#endif\n"},function(a,b){a.exports="\n#ifdef USE_VERTEX_ID\nvId = id;\n#endif\n"},function(a,b){a.exports="#if defined(MRT_NORMALS) || defined(MRT_ID_BUFFER)\nvarying highp float depth;\n#define gl_FragColor gl_FragData[0]\n#endif\n#if defined(MRT_ID_BUFFER) || defined(ID_COLOR)\n#ifdef USE_VERTEX_ID\nvarying vec3 vId;\n#else\nuniform vec3 dbId;\n#endif\n#endif\n#if defined(MRT_ID_BUFFER) || defined(MODEL_COLOR)\nuniform vec3 modelId;\n#endif\n"},function(a,b){a.exports="\n#if defined(USE_VERTEX_ID) && (defined(MRT_ID_BUFFER) || defined(ID_COLOR))\nvec3 dbId = vId;\n#endif\n#ifdef MRT_ID_BUFFER\n#ifdef MRT_NORMALS\nconst int index = 2;\n#else\nconst int index = 1;\n#endif\n#ifndef ENABLE_ID_DISCARD\nconst float writeId = 1.0;\n#endif\ngl_FragData[index] = vec4(dbId.rgb, writeId);\n#ifdef MODEL_COLOR\ngl_FragData[index+1] = vec4(modelId.rgb, writeId);\n#endif\n#elif defined(ID_COLOR)\n#ifdef ENABLE_ID_DISCARD\nif (writeId==0.0) {\n    discard;\n}\n#endif\ngl_FragColor = vec4(dbId.rgb, 1.0);\n#elif defined(MODEL_COLOR)\n#ifdef ENABLE_ID_DISCARD\nif (writeId==0.0) {\n    discard;\n}\n#endif\ngl_FragColor = vec4(modelId.rgb, 1.0);\n#endif\n"},function(a,b){a.exports="#ifdef HATCH_PATTERN\ngl_FragColor = calculateHatchPattern(hatchParams, gl_FragCoord.xy, gl_FragColor, hatchTintColor, hatchTintIntensity);\n#endif\n#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\ngl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif\n#ifdef MRT_NORMALS\ngl_FragData[1] = vec4(geomNormal.x, geomNormal.y, depth, gl_FragColor.a < 1.0 ? 0.0 : 1.0);\n#endif\n#include<id_frag>\n"},function(a,b){a.exports="uniform vec4 themingColor;\n"},function(a,b){a.exports="gl_FragColor.rgb = mix(gl_FragColor.rgb, themingColor.rgb, themingColor.a);\n"},function(a,b){a.exports="\n#ifdef USE_INSTANCING\nattribute vec3 instOffset;\nattribute vec4 instRotation;\nattribute vec3 instScaling;\nvec3 applyQuaternion(vec3 p, vec4 q) {\n    return p + 2.0 * cross(q.xyz, cross(q.xyz, p) + q.w * p);\n}\nvec3 getInstancePos(vec3 pos) {\n    return instOffset + applyQuaternion(instScaling * pos, instRotation);\n}\nvec3 getInstanceNormal(vec3 normal) {\n    return applyQuaternion(normal/instScaling, instRotation);\n}\n#else\nvec3 getInstancePos(vec3 pos)       { return pos;    }\nvec3 getInstanceNormal(vec3 normal) { return normal; }\n#endif\n"},function(a,b){a.exports="\nuniform float shadowESMConstant;\nuniform float shadowMapRangeMin;\nuniform float shadowMapRangeSize;\n"},function(a,b){a.exports="\n#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord;\nuniform mat4 shadowMatrix;\n#endif\n"},function(a,b){a.exports="\n#ifdef USE_SHADOWMAP\n{\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vShadowCoord = shadowMatrix * worldPosition;\n}\n#endif\n"},function(a,b){
a.exports="\n#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap;\nuniform vec2      shadowMapSize;\nuniform float     shadowDarkness;\nuniform float     shadowBias;\nuniform vec3      shadowLightDir;\nvarying vec4 vShadowCoord;\n#include<shadowmap_decl_common>\nfloat getShadowValue() {\n    float fDepth;\n    vec3 shadowColor = vec3( 1.0 );\n    vec3 shadowCoord = vShadowCoord.xyz / vShadowCoord.w;\n    shadowCoord.xyz = 0.5 * (shadowCoord.xyz + vec3(1.0, 1.0, 1.0));\n    bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n    bool inFrustum = all( inFrustumVec );\n    float shadowValue = 1.0;\n    if (inFrustum) {\n        shadowCoord.z = min(0.999, shadowCoord.z);\n        shadowCoord.z -= shadowBias;\n#ifdef USE_HARD_SHADOWS\n        vec4 rgbaDepth = texture2D( shadowMap, shadowCoord.xy );\n        float fDepth = rgbaDepth.r;\n        if ( fDepth < shadowCoord.z ) {\n            shadowValue = 1.0 - shadowDarkness;\n        }\n#else\n        vec4 rgbaDepth = texture2D( shadowMap, shadowCoord.xy );\n        float shadowMapValue = rgbaDepth.r;\n        shadowValue = exp(-shadowESMConstant * shadowCoord.z) * shadowMapValue;\n        shadowValue = min(shadowValue, 1.0);\n        shadowValue = mix(1.0 - shadowDarkness, 1.0, shadowValue);\n#endif\n    }\n    return shadowValue;\n}\n#else\nfloat getShadowValue() { return 1.0; }\n#endif\nvec3 applyEnvShadow(vec3 colorWithoutShadow, vec3 worldNormal) {\n#if defined(USE_SHADOWMAP)\n    float dp  = dot(shadowLightDir, worldNormal);\n    float dpValue = (dp + 1.0) / 2.0;\n    dpValue = min(1.0, dpValue * 1.5);\n    float sv = getShadowValue();\n    vec3 result = colorWithoutShadow * min(sv, dpValue);\n    return result;\n#else\n    return colorWithoutShadow;\n#endif\n}\n"},function(a,b){a.exports="float averageOfFloat3(in vec3 value) { \n    const float oneThird = 1.0 / 3.0; \n    return dot(value, vec3(oneThird, oneThird, oneThird)); \n} \n"},function(a,b){a.exports="\n#define TAU     6.28318530718\n#define PI      3.14159265358979\n#define HALF_PI 1.57079632679\n#define PI_0_5  HALF_PI\n#define PI_1_5  4.71238898038\n#define ENABLE_ID_DISCARD\n#define VBB_GT_TRIANGLE_INDEXED  0.0\n#define VBB_GT_LINE_SEGMENT      1.0\n#define VBB_GT_ARC_CIRCULAR      2.0\n#define VBB_GT_ARC_ELLIPTICAL    3.0\n#define VBB_GT_TEX_QUAD          4.0\n#define VBB_GT_ONE_TRIANGLE      5.0\n#define VBB_INSTANCED_FLAG   0.0\n#define VBB_SEG_START_RIGHT  0.0\n#define VBB_SEG_START_LEFT   1.0\n#define VBB_SEG_END_RIGHT    2.0\n#define VBB_SEG_END_LEFT     3.0\nvarying vec4 fsColor;\nvarying vec4 dbId;\nvarying vec2 fsOffsetDirection;\nvarying vec4 fsMultipurpose;\nvarying float fsHalfWidth;\nvarying vec2 fsVpTC;\nvarying float fsGhosting;\n"},function(a,b){a.exports="#if defined( PRISMWOOD )\n#define ONE 0.00390625\nfloat GetIndexedValue(vec4 array, int index)\n{\n    if (index == 0)\n        return array[0];\n    else if (index == 1)\n        return array[1];\n    else if (index == 2)\n        return array[2];\n    else if (index == 3)\n        return array[3];\n    else\n        return 0.0;\n}\nint GetIndexedValue(ivec2 array, int index)\n{\n    if (index == 0)\n        return array[0];\n    else if (index == 1)\n        return array[1];\n    else\n        return 0;\n}\n#if defined( USE_WOOD_CURLY_DISTORTION_MAP )\nfloat SampleCurlyPattern(vec2 uv)\n{\n    vec2 uv_wood_curly_distortion_map = (wood_curly_distortion_map_texMatrix * vec3(uv, 1.0)).xy;\n    WOOD_CURLY_DISTORTION_CLAMP_TEST;\n    vec3 curlyDistortion = texture2D(wood_curly_distortion_map, uv_wood_curly_distortion_map).xyz;\n    if(wood_curly_distortion_map_invert) curlyDistortion = vec3(1.0) - curlyDistortion;\n    return curlyDistortion.r;\n}\nvec3 DistortCurly(vec3 p)\n{\n    if (!wood_curly_distortion_enable) return p;\n    float r = length(p.xy);\n    if (r < 0.00001) return p;\n    const float INV_ANGLE_INTERVAL = 1.27323954;\n    const float NUM_INTERVAL = 8.0;\n    float theta = atan(p.y, p.x);\n    if (theta < 0.0)\n        theta += PI2;\n    float intIdx = theta * INV_ANGLE_INTERVAL;\n    int idx0 = int(mod(floor(intIdx), NUM_INTERVAL));\n    int idx1 = int(mod(ceil(intIdx), NUM_INTERVAL));\n    const vec4 HASH_TABLE1 = vec4(0.450572,0.114598, 0.886043, 0.315119);\n    const vec4 HASH_TABLE2 = vec4(0.216133,0.306264, 0.685616, 0.317907);\n    float offset0 = idx0 < 4 ? GetIndexedValue(HASH_TABLE1, idx0) : GetIndexedValue(HASH_TABLE2, idx0-4);\n    float offset1 = idx1 < 4 ? GetIndexedValue(HASH_TABLE1, idx1) : GetIndexedValue(HASH_TABLE2, idx1-4);\n    const float maxOffset = 100.0;\n    offset0 = (offset0 - 0.5) * maxOffset;\n    offset1 = (offset1 - 0.5) * maxOffset;\n    vec2 uv0 = vec2(p.z + offset0, r);\n    float shiftWeight0 =  SampleCurlyPattern(uv0);\n    vec2 uv1 = vec2(p.z + offset1, r);\n    float shiftWeight1 =  SampleCurlyPattern(uv1);\n    float interpWeight = fract(intIdx);\n    float shiftWeight = mix(shiftWeight0, shiftWeight1, interpWeight);\n    const float INV_MIN_RADIUS = 2.0;\n    float shiftWeightAdjust = smoothstep(0.0, 1.0, r * INV_MIN_RADIUS);\n    r -= wood_curly_distortion_scale * (shiftWeight * shiftWeightAdjust);\n    float thetaNew = atan(p.y, p.x);\n    vec3 pNew = p;\n    pNew.x = r * cos(thetaNew);\n    pNew.y = r * sin(thetaNew);\n    return pNew;\n}\n#endif\nvec3 un2sn(vec3 range)\n{\n    return range * 2.0 - 1.0;\n}\nfloat inoise(vec3 p)\n{\n    vec3 modp = mod(floor(p), 256.0);\n    modp.xy = modp.xy * ONE;\n    vec4 AA = texture2D(perm2DMap, vec2(modp.x, modp.y), 0.0) * 255.0;\n    AA = AA + modp.z;\n    AA = mod(floor(AA), 256.0);\n    AA *= ONE;\n    vec3 gradx1 = un2sn(texture2D(permGradMap,vec2(AA.x,0.0),0.0).xyz);\n    vec3 grady1 = un2sn(texture2D(permGradMap,vec2(AA.y,0.0),0.0).xyz);\n    vec3 gradz1 = un2sn(texture2D(permGradMap,vec2(AA.z,0.0),0.0).xyz);\n    vec3 gradw1 = un2sn(texture2D(permGradMap,vec2(AA.w,0.0),0.0).xyz);\n    vec3 gradx2 = un2sn(texture2D(permGradMap,vec2(AA.x + ONE,0.0),0.0).xyz);\n    vec3 grady2 = un2sn(texture2D(permGradMap,vec2(AA.y + ONE,0.0),0.0).xyz);\n    vec3 gradz2 = un2sn(texture2D(permGradMap,vec2(AA.z + ONE,0.0),0.0).xyz);\n    vec3 gradw2 = un2sn(texture2D(permGradMap,vec2(AA.w + ONE,0.0),0.0).xyz);\n    p -= floor(p);\n    vec3 fadep = p * p * p * (p * (p * 6.0 - 15.0) + 10.0);\n    return mix( mix( mix( dot(gradx1, p ),\n                          dot(gradz1, p + vec3(-1.0, 0.0, 0.0)), fadep.x),\n                     mix( dot(grady1, p + vec3(0.0, -1.0, 0.0)),\n                          dot(gradw1, p + vec3(-1.0, -1.0, 0.0)), fadep.x), fadep.y),\n                mix( mix( dot(gradx2, p + vec3(0.0, 0.0, -1.0)),\n                          dot(gradz2, p + vec3(-1.0, 0.0, -1.0)), fadep.x),\n                     mix( dot(grady2, p + vec3(0.0, -1.0, -1.0)),\n                          dot(gradw2, p + vec3(-1.0, -1.0, -1.0)), fadep.x), fadep.y), fadep.z);\n}\nfloat inoise(float p)\n{\n    float modp = mod(floor(p), 256.0);\n    modp = (modp + 256.0) * ONE;\n    float permx = texture2D(permutationMap, vec2(modp, 0.0), 0.0).r;\n    float gradx = texture2D(gradientMap, vec2(permx, 0.0), 0.0).r*2.0-1.0;\n    float permy = texture2D(permutationMap, vec2(modp + ONE, 0.0), 0.0).r;\n    float grady = texture2D(gradientMap, vec2(permy, 0.0), 0.0).r*2.0-1.0;\n    p -= floor(p);\n    float fadep = p * p * p * (p * (p * 6.0 - 15.0) + 10.0);\n    return mix(gradx * p, grady * (p - 1.0), fadep);\n}\nfloat multiband_inoise(vec3 p, int bands, vec4 w, vec4 f)\n{\n    float noise = 0.0;\n    for(int i = 0; i < 4; ++i)\n    {\n        if (i >= bands) break;\n        noise += GetIndexedValue(w, i) * inoise(p * GetIndexedValue(f, i));\n    }\n    return noise;\n}\nfloat multiband_inoise(float p, int bands, vec4 w, vec4 f)\n{\n    float noise = 0.0;\n    for(int i = 0; i < 4; ++i)\n    {\n        if (i >= bands) break;\n        noise += GetIndexedValue(w, i) * inoise(p * GetIndexedValue(f, i));\n    }\n    return noise;\n}\nvec3 Distort3DCosineRadialDir(vec3 p)\n{\n    float radius = length(p.xy);\n    if (radius < 0.00001) return p;\n    vec2 theta = p.xy / radius;\n    float radiusShift = 0.0;\n    for (int i = 0; i < 4; ++i)\n    {\n        if (i >= wood_fiber_cosine_bands) break;\n        radiusShift += GetIndexedValue(wood_fiber_cosine_weights, i) * cos(p.z * RECIPROCAL_PI2 * GetIndexedValue(wood_fiber_cosine_frequencies, i));\n    }\n    const float MIN_RADIUS = 1.5;\n    float weight = clamp(radius / MIN_RADIUS, 0.0, 1.0);\n    if(weight >= 0.5)\n        weight = weight * weight * (3.0 - (weight + weight));\n    p.xy += theta * radiusShift * weight;\n    return p;\n}\nvec3 Distort3DPerlin(vec3 p)\n{\n    vec3 pAniso = vec3(p.xy, p.z * wood_fiber_perlin_scale_z);\n    p.xy += multiband_inoise(pAniso, wood_fiber_perlin_bands, wood_fiber_perlin_weights, wood_fiber_perlin_frequencies);\n    return p;\n}\nvec3 Distort(vec3 p)\n{\n    if(wood_fiber_cosine_enable)\n        p = Distort3DCosineRadialDir(p);\n    if(wood_fiber_perlin_enable)\n        p = Distort3DPerlin(p);\n    return p;\n}\nfloat DistortRadiusLength(float radiusLength)\n{\n    radiusLength += multiband_inoise(radiusLength, wood_growth_perlin_bands, wood_growth_perlin_weights, wood_growth_perlin_frequencies);\n    if (radiusLength < 0.0) radiusLength = 0.0;\n    return radiusLength;\n}\nfloat ComputeEarlyWoodRatio(float radiusLength)\n{\n    float fraction = mod(radiusLength, wood_ring_thickness) / wood_ring_thickness;\n    if (fraction <= wood_ring_fraction.y)\n       return 1.0;\n    else if(fraction <= wood_ring_fraction.x)\n       return (1.0 - (fraction - wood_ring_fraction.y) / wood_fall_rise.x);\n    else if(fraction <= wood_ring_fraction.w)\n       return 0.0;\n    else\n       return ((fraction - wood_ring_fraction.w) / wood_fall_rise.y);\n}\nvec3 DistortEarlyColor(vec3 earlyColor, float radiusLength)\n{\n    float expValue = 1.0 + multiband_inoise(radiusLength,wood_earlycolor_perlin_bands,wood_earlycolor_perlin_weights,wood_earlycolor_perlin_frequencies);\n    earlyColor = pow(abs(earlyColor), vec3(expValue));\n    return earlyColor;\n}\nvec3 DistortLateColor(vec3 lateColor, float radiusLength)\n{\n    float expValue = 1.0 + multiband_inoise(radiusLength,wood_latecolor_perlin_bands,wood_latecolor_perlin_weights,wood_latecolor_perlin_frequencies);\n    lateColor = pow(abs(lateColor), vec3(expValue));\n    return lateColor;\n}\nvec3 DistortDiffuseColor(vec3 diffAlbedo, vec3 p)\n{\n    p.z *= wood_diffuse_perlin_scale_z;\n    float expValue = 1.0 + multiband_inoise(p, wood_diffuse_perlin_bands, wood_diffuse_perlin_weights, wood_diffuse_perlin_frequencies);\n    diffAlbedo = pow(abs(diffAlbedo), vec3(expValue));\n    return diffAlbedo;\n}\nfloat LayerRoughnessVar(float roughness, float earlyWoodRatio)\n{\n    return earlyWoodRatio * wood_groove_roughness + (1.0 - earlyWoodRatio) * roughness;\n}\nfloat hashword(vec2 k)\n{\n    k = mod(k, vec2(256.0)) * ONE;\n    float a = texture2D(permutationMap, vec2(k.x, 0.0)).x + k.y ;\n    a = texture2D(permutationMap, vec2(a, 0.0)).x ;\n    return a*255.0;\n}\nfloat wyvillsq(float rsq)\n{\n    if (rsq >= 1.0) return 0.0;\n    float tmp = 1.0 - rsq;\n    return tmp*tmp*tmp;\n}\nfloat Weight2DNeighborImpulses(vec3 p, float woodWeight)\n{\n    if(woodWeight <= 0.0) return 0.0;\n    float poreRadius = wood_pore_radius * woodWeight;\n    vec2 left = floor((p.xy - poreRadius) / wood_pore_cell_dim);\n    vec2 right = floor((p.xy + poreRadius) / wood_pore_cell_dim);\n    float weight = 0.0;\n    float invRsq = 1.0 / (poreRadius * poreRadius);\n    const float norm =  1.0 / 15.0;\n    for (int j = 0; j <= 4; j++)\n    {\n        if (j > int(right.y - left.y)) continue;\n        for (int i = 0; i <= 4; i++)\n        {\n            if (i > int(right.x - left.x)) continue;\n            vec2 pij = vec2(float(i) + left.x,float(j) + left.y);\n            float hRNum = hashword(pij);\n            float impPosX = mod(hRNum, 16.0) * norm;\n            float impPosY = floor(hRNum / 16.0) * norm;\n            impPosX = (pij.x + impPosX)* wood_pore_cell_dim;\n            impPosY = (pij.y + impPosY)* wood_pore_cell_dim;\n            float dsq = (p.x - impPosX) * (p.x - impPosX) + (p.y - impPosY) * (p.y - impPosY);\n            weight += wyvillsq(dsq * invRsq);\n        }\n    }\n    return weight;\n}\nfloat Weight3DRayImpulses(vec3 p)\n{\n    int segIdx = int(floor(p.z / wood_ray_seg_length_z));\n    float factor = p.z / wood_ray_seg_length_z - float(segIdx);\n    int segIdx1 = segIdx - 1;\n    if ( factor > 0.5 )\n        segIdx1 = segIdx + 1;\n    float theta = atan(p.y, p.x);\n    float sliceIdx = floor(((theta + PI) * RECIPROCAL_PI2) * wood_ray_num_slices);\n    if ( sliceIdx == wood_ray_num_slices)\n        sliceIdx-=1.0;\n    ivec2 arrSegs = ivec2(segIdx, segIdx1);\n    float weight = 0.0;\n    const float norm =  1.0 / 15.0;\n    float radialOffset = 5.0;\n    float radialLength = length(p.xy);\n    for (int seg = 0; seg < 2; seg++)\n    {\n        float hRNum = hashword(vec2(sliceIdx, GetIndexedValue(arrSegs, seg)));\n        float rn1 = mod(hRNum,16.0) * norm;\n        if (radialLength < radialOffset * rn1)\n            continue;\n        float rayTheta = rn1;\n        rayTheta = ( ( sliceIdx + rayTheta ) / wood_ray_num_slices ) * ( 2.0 * PI ) - PI;\n        float rayPosZ = (hRNum/16.0)* norm;\n        rayPosZ = ( float(GetIndexedValue(arrSegs, seg)) + rayPosZ ) * wood_ray_seg_length_z;\n        vec3 pt1 = vec3(0.0);\n        vec3 pt2 = vec3(cos(rayTheta), sin(rayTheta), 0.0);\n        vec3 p1 = p;\n        p1.z -= rayPosZ;\n        p1.z /=  wood_ray_ellipse_z2x;\n        vec3 v1 = pt2 - pt1;\n        vec3 v2 = pt1 - p1;\n        v2 = cross(v1, v2);\n        float dist = length(v2) / length(v1);\n        float invRsq = 1.0 / ( wood_ray_ellipse_radius_x * wood_ray_ellipse_radius_x);\n        weight += wyvillsq( (dist * dist) * invRsq );\n    }\n    return weight;\n}\nvec3 DarkenColorWithPores(vec3 p, vec3 diffColor, float woodWeight)\n{\n    float poresWeight = Weight2DNeighborImpulses(p, woodWeight);\n    float a = wood_pore_color_power - 1.0;\n    float b = 1.0;\n    float y = a * poresWeight + b;\n    return pow(abs(diffColor), vec3(y));\n}\nvec3 DarkenColorWithRays(vec3 p, vec3 diffColor)\n{\n    float raysWeight = Weight3DRayImpulses(p);\n    float a = wood_ray_color_power - 1.0;\n    float b = 1.0;\n    float y = a * raysWeight + b;\n    return pow(abs(diffColor), vec3(y));\n}\nfloat ComputeWoodWeight(float earlyWoodRatio)\n{\n    float woodWeight = 0.0;\n    if (wood_pore_type == 0)\n        woodWeight = 1.0;\n    else if (wood_pore_type == 1)\n        woodWeight = earlyWoodRatio;\n    else if (wood_pore_type == 2)\n        woodWeight = 1.0 - earlyWoodRatio;\n    else\n        woodWeight = -1.0;\n    return woodWeight;\n}\n#if defined( PRISMWOODBUMP )\nfloat ComputeEarlyWoodRatioAA(float radiusLength, float invUnitExt)\n{\n    float transPixels = min(wood_fall_rise.x, wood_fall_rise.y) * wood_ring_thickness * invUnitExt;\n    float samplesf = clamp(4.0 / transPixels, 1.0, 4.0);\n    int samples = int(samplesf);\n    float inverseSamples = 1.0 / float(samples);\n    vec2 rdelta = vec2(dFdx(radiusLength), dFdy(radiusLength)) * inverseSamples;\n    float earlywoodRatio = 0.0;\n    for (int i = 0; i < 4; ++i)\n    {\n        if (i >= samples) break;\n        for (int j = 0; j < 4; ++j)\n        {\n            if (j >= samples) break;\n            float r = radiusLength + dot(vec2(i, j), rdelta);\n            earlywoodRatio += ComputeEarlyWoodRatio(r);\n        }\n    }\n    return earlywoodRatio * (inverseSamples * inverseSamples);\n}\nfloat LatewoodDepthVariation(float invUnitExt)\n{\n    float transPixels = min(wood_fall_rise.x, wood_fall_rise.y) * wood_ring_thickness * invUnitExt;\n    return clamp(transPixels * 0.5, 0.0, 1.0);\n}\nfloat LatewoodHeightVariation(float earlyWoodRatio, float latewoodBumpDepth,\n                              float depthVar)\n{\n    return ( 1.0 - earlyWoodRatio ) * latewoodBumpDepth * depthVar;\n}\nfloat PoreDepthVariation(float woodWeight, float invUnitExt)\n{\n    float porePixels = woodWeight * wood_pore_radius * invUnitExt;\n    return clamp(porePixels, 0.0, 1.0);\n}\nfloat PoreHeightVariation(float earlyWoodRatio, float poresWeight, float poreDepth,\n                          float depthVar)\n{\n    return poresWeight * (-1.0 * poreDepth) * depthVar;\n}\nvoid ComputeTangents(vec3 normal, out vec3 u, out vec3 v)\n{\n    float scale = normal.z < 0.0 ? -1.0 : 1.0;\n    vec3 temp = scale * normal;\n    float e    = temp.z;\n    float h    = 1.0/(1.0 + e);\n    float hvx  = h   *  temp.y;\n    float hvxy = hvx * -temp.x;\n    u = vec3(e + hvx * temp.y, hvxy,                -temp.x);\n    v = vec3(hvxy,             e + h * temp.x * temp.x, -temp.y);\n    u *= scale;\n    v *= scale;\n}\nvec3 WoodBumpHeight(float heightLeft, float heightRight, float heightBack, float heightFront)\n{\n    const float epsilon = 0.001;\n    float heightDeltaX = heightRight - heightLeft;\n    vec3 Tu = vec3(2.0 * epsilon, 0.0, heightDeltaX);\n    float heightDeltaY = heightFront - heightBack;\n    vec3 Tv = vec3(0.0, 2.0 * epsilon, heightDeltaY);\n    return cross(Tu, Tv);\n}\nvec3 SelectNormal(vec3 N, vec3 bumpN, vec3 V)\n{\n    float bumpNdotV = dot(bumpN, V);\n    if(bumpNdotV > 0.0)\n        return bumpN;\n    else return N;\n}\nfloat MinInverseUnitExtent(vec3 p)\n{\n    return 1.0 / max(max(length(dFdx(p.xy)), length(dFdy(p.xy))), 0.000001);\n}\nfloat HeightVariation(vec3 pos)\n{\n    vec3 p = Distort(pos);\n    float radiusLength = length(p.xy);\n    if (wood_growth_perlin_enable)\n        radiusLength = DistortRadiusLength(radiusLength);\n    float invUnitExt = MinInverseUnitExtent(p);\n    float earlyWoodRatio = ComputeEarlyWoodRatioAA(radiusLength, invUnitExt);\n    float woodWeight = ComputeWoodWeight(earlyWoodRatio);\n    float poresWeight = Weight2DNeighborImpulses(p, woodWeight);\n    float depthVar = PoreDepthVariation(woodWeight, invUnitExt);\n    float poreHeightVariation = -1.0 * poresWeight * wood_pore_depth * depthVar;\n    float latewoodHeightVariation = 0.0;\n    if (wood_use_latewood_bump)\n    {\n        float latewoodDepthVar = LatewoodDepthVariation(invUnitExt);\n        latewoodHeightVariation = (1.0 - earlyWoodRatio) * wood_latewood_bump_depth * latewoodDepthVar;\n    }\n    float sumHeightVariation = poreHeightVariation + latewoodHeightVariation;\n    return sumHeightVariation;\n}\n#endif\nvec3 NoiseWood(vec3 p, inout float roughness)\n{\n    p = Distort(p);\n    float radiusLength = length(p.xy);\n    if(wood_growth_perlin_enable)\n        radiusLength = DistortRadiusLength(radiusLength);\n#if defined( PRISMWOODBUMP )\n    float invUnitExt = MinInverseUnitExtent( p );\n    float earlyWoodRatio = ComputeEarlyWoodRatioAA(radiusLength, invUnitExt);\n#else\n    float earlyWoodRatio = ComputeEarlyWoodRatio(radiusLength);\n#endif\n    vec3 earlyColor = wood_early_color;\n    if (wood_earlycolor_perlin_enable)\n        earlyColor = DistortEarlyColor(earlyColor, radiusLength);\n    vec3 lateColor;\n    if (wood_use_manual_late_color)\n        lateColor = wood_manual_late_color;\n    else\n        lateColor = pow(abs(earlyColor), vec3(wood_late_color_power));\n    if(wood_latecolor_perlin_enable)\n        lateColor = DistortLateColor(lateColor, radiusLength);\n    vec3 diffAlbedo = earlyWoodRatio * earlyColor + (1.0 - earlyWoodRatio) * lateColor;\n    if(wood_diffuse_perlin_enable)\n        diffAlbedo = DistortDiffuseColor(diffAlbedo, p);\n    if (wood_use_pores)\n    {\n        float woodWeight = ComputeWoodWeight(earlyWoodRatio);\n        diffAlbedo = DarkenColorWithPores(p, diffAlbedo, woodWeight);\n    }\n    if (wood_use_rays)\n        diffAlbedo = DarkenColorWithRays(p, diffAlbedo);\n    if(wood_use_groove_roughness)\n        roughness = LayerRoughnessVar(roughness, earlyWoodRatio);\n    return clamp(diffAlbedo, vec3(0.0), vec3(1.0));\n}\n#if defined(PRISMWOODBUMP)\nvoid getFinalWoodContext(\n    inout vec3 N, vec3 V, inout vec3 Tu, inout vec3 Tv, vec3 p,\n    vec3 geoNormal, vec3 tNormal, mat3 normalMatrix\n) {\n    vec3 offsetTuLeft = p - 0.001 * Tu;\n    vec3 offsetTuRight = p + 0.001 * Tu;\n    vec3 offsetTvLeft = p - 0.001 * Tv;\n    vec3 offsetTvRight = p + 0.001 * Tv;\n    float heightVariationTuLeft = HeightVariation(offsetTuLeft);\n    float heightVariationTuRight = HeightVariation(offsetTuRight);\n    float heightVariationTvLeft = HeightVariation(offsetTvLeft);\n    float heightVariationTvRight = HeightVariation(offsetTvRight);\n    vec3 bumpHeight = WoodBumpHeight(heightVariationTuLeft, heightVariationTuRight, heightVariationTvLeft, heightVariationTvRight);\n    vec3 newNormal = normalize(bumpHeight.x * Tu + bumpHeight.y * Tv + bumpHeight.z * vtNormal);\n    vec3 newNormalView = normalize(vNormalMatrix * newNormal);\n    vec3 selectedNormal = SelectNormal(geoNormal, newNormalView, V);\n    ComputeTangents(selectedNormal, Tu, Tv);\n    Tu = normalize(Tu);\n    Tv = normalize(Tv);\n    N = faceforward(selectedNormal, -V, selectedNormal);\n}\n#endif\n#endif\n"},function(a,b){a.exports="\nvec3 TransmitAdjust(vec3 transmission, vec3 f0) \n{ \n   vec3 limit = max(1.0 - f0, 0.00001); \n   return clamp(transmission, vec3(0.0, 0.0, 0.0), limit) / limit; \n} \nfloat ColorToIlluminance(in vec3 color) \n{ \n   const vec3 rgb2grey = vec3(0.299, 0.587, 0.114); \n   float illuminance = dot(rgb2grey, color); \n   return illuminance; \n} \nvoid applyPrismGlazingOpacity(\n    inout vec4 color,\n    vec3 transmissionF,\n    float transmissionAlpha,\n    float NdotV,\n    float glazingIlluminace) \n{\n    const float third = 1.0/3.0; \n    float transSurface = exp(-(transmissionAlpha + (transmissionAlpha < 0.0025 ? 0.0 : 0.25)) * NdotV * PI); \n    float opacity = 1.0- dot((1.0 - transmissionF), vec3(third,third,third)) * transSurface * glazingIlluminace; \n    opacity = clamp(opacity, 0.01, 0.99);\n    color.a *= opacity;\n} \n"},function(a,b){a.exports="void applyPrismTransparency(\n    inout vec4 color,\n    vec3 transparentColor,\n    float transparentIor\n) {\n    float fsLevel = max(max(color.r, color.g), color.b);\n    color = vec4(color.rgb/fsLevel, fsLevel);\n    float transLevel = min(min(transparentColor.r, transparentColor.g), transparentColor.b);\n    transLevel = min( (1.0 - surface_roughness), transLevel );\n    float transAlpha = (1.0 - transLevel) * 0.4 + surface_roughness * 0.55;\n    vec3 tr_g_color = sqrt(transparentColor);\n    vec4 transColor = vec4(0.5 * vec3(tr_g_color), transAlpha);\n    float strength = 1.0 - (1.0 - fsLevel) * (1.0 - fsLevel);\n    color = mix(transColor, color, strength);\n    color.a = max(color.a, 0.05);\n    if (transparentIor == 1.0 && tr_g_color == vec3(1.0)) {\n        color.a = 0.0;\n    }\n}"},function(a,b){a.exports="#if defined(USE_SURFACE_NORMAL_MAP) || defined( USE_LAYERED_NORMAL_MAP ) || defined( USE_TILING_NORMAL )\nvoid heightMapTransform(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    vec2 bumpScale,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (transform * vec3(uv, 1.0)).xy;\n    mat3 mtxTangent = mat3(T, B, N);\n    T = normalize(mtxTangent * (transform * vec3(1.0, 0.0, 0.0)));\n    B = normalize(mtxTangent * (transform * vec3(0.0, 1.0, 0.0)));\n    const float oneThird = 1.0 / 3.0;\n    vec3 avg = vec3(oneThird, oneThird, oneThird);\n    vec2 offset = fwidth(st);\n    float h0 = dot(texture2D(bumpTexture, st).xyz, avg);\n    float hx = dot(texture2D(bumpTexture, st + vec2(offset.x, 0.0)).xyz, avg);\n    float hy = dot(texture2D(bumpTexture, st + vec2(0.0, offset.y)).xyz, avg);\n    vec2 diff = vec2(h0 - hx, h0 - hy) / offset;\n    N = normalize(\n        N + (\n            diff.x * T * bumpScale.x +\n            diff.y * B * bumpScale.y\n        )\n    );\n}\nvoid normalMapTransform(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    vec2 bumpScale,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (transform * vec3(uv, 1.0)).xy;\n    vec3 mapN =  2.0 * texture2D(bumpTexture, st).xyz - 1.0;\n    mapN.xy *= bumpScale.x;\n    mapN.z *= bumpScale.y;\n    vec3 v = vec3(mapN.y, -mapN.x, 0.0);\n    float c = -mapN.z;\n    mat3 skewV = mat3(\n        0.0, v.z, -v.y,\n        -v.z, 0.0, v.x,\n        v.y, -v.x, 0.0\n    );\n    mat3 rot = mat3(1.0) + skewV + skewV*skewV * 1.0/(1.0-c);\n    N *= rot;\n    T *= rot;\n    B *= rot;\n}\n#endif\n"},function(a,b){a.exports="uniform float point_size;"},function(a,b){a.exports="gl_PointSize = point_size;"},function(a,b){a.exports="\n#ifdef WIDE_LINES\nattribute vec3 prev;\nattribute vec3 next;\nattribute float side;\nuniform vec2 view_size;\nvec2 to2d(vec4 i) {\n  return i.xy / i.w;\n}\n#endif\n"},function(a,b){a.exports="\n#ifdef WIDE_LINES\nvec4 mvpPosition = projectionMatrix * mvPosition; \nmat3 vectorMatrix = mat3(modelViewMatrix);\nvec2 _pos = to2d(mvpPosition) * view_size;\nvec2 _prev = to2d(projectionMatrix * vec4(mvPosition.xyz + vectorMatrix * (prev * 0.01), 1.0)) * view_size;\nvec2 _next = to2d(projectionMatrix * vec4(mvPosition.xyz - vectorMatrix * (next * 0.01), 1.0)) * view_size;\nvec2 dir1 = _pos - _next;\nvec2 dir2 = _prev - _pos;\ndir2 = (length(dir2) > 0.0000001) ? normalize(dir2) : vec2(0.0, 0.0);\ndir1 = (length(dir1) > 0.0000001) ? normalize(dir1) : dir2;\nvec2 dir_sharp = normalize(dir1 + dir2);\nvec2 dir = normalize(dir1 + dir_sharp);\nvec2 offset = vec2(-dir.y, dir.x);\nfloat len = 1.0 / cross(vec3(offset, 0), vec3(dir1, 0)).z;\noffset *= len;\noffset /= view_size;\noffset *= side;\noffset *= mvpPosition.w;\nmvpPosition.xy += offset;\ngl_Position = mvpPosition;\n#endif\n"},function(a,b){a.exports="vec3 rgb2hsv(vec3 color)\n{\n    float delta;\n    float colorMax, colorMin;\n    float h,s,v;\n    vec3 hsv;\n    colorMax = max(color.r,color.g);\n    colorMax = max(colorMax,color.b);\n    colorMin = min(color.r,color.g);\n    colorMin = min(colorMin,color.b);\n    v = colorMax;\n    if(colorMax != 0.0)\n    {\n        s = (colorMax - colorMin)/colorMax;\n    }\n    else\n    {\n        s = 0.0;\n    }\n    if(s != 0.0)\n    {\n        delta = colorMax-colorMin;\n        if (color.r == colorMax)\n        {\n            h = (color.g-color.b)/delta;\n        }\n        else if (color.g == colorMax)\n        {\n            h = 2.0 + (color.b-color.r) / delta;\n        }\n        else\n        {\n            h = 4.0 + (color.r-color.g)/delta;\n        }\n        h /= 6.0;\n        if( h < 0.0)\n        {\n            h +=1.0;\n        }\n    }\n    else\n    {\n        h = 0.0;\n    }\n    hsv = vec3(h,s,v);\n    return hsv;\n}\nvec3 hsv2rgb(vec3 hsv)\n{\n    vec3 color;\n    float f,p,q,t;\n    float h,s,v;\n    float i,hi;\n    {\n        h = hsv.x*6.0;\n        s = hsv.y;\n        v = hsv.z;\n        i = floor(h);\n        f = h-i;\n        p = v * (1.0 - s);\n        q = v * (1.0 - (s * f));\n        t = v * (1.0 - (s * (1.0 - f)));\n        float r,g,b;\n        if (i == 0.0)\n        {\n            r = v;\n            g = t;\n            b = p;\n        }\n        else if (i == 1.0)\n        {\n            r = q;\n            g = v;\n            b = p;\n        }\n        else if (i == 2.0)\n        {\n            r = p;\n            g = v;\n            b = t;\n        }\n        else if (i == 3.0)\n        {\n            r = p;\n            g = q;\n            b = v;\n        }\n        else if (i == 4.0)\n        {\n            r = t;\n            g = p;\n            b = v;\n        }\n        else\n        {\n            r = v;\n            g = p;\n            b = q;\n        }\n        color = vec3(r,g,b);\n    }\n    return color;\n}"},function(a,b){a.exports="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvarying vec2 vUvBump;\nuniform mat3 texMatrixBump;\n#endif\n#if defined( USE_ALPHAMAP )\nvarying vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#if defined( USE_ENVMAP )\n#if ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nuniform float refractionRatio;\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#ifdef MRT_NORMALS\nvarying float depth;\n#endif\n#include<pack_normals>\n#include<instancing_decl_vert>\n#include<id_decl_vert>\n#include<wide_lines_decl>\n#include<shadowmap_decl_vert>\nvoid main() {\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\n    vUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n    vUvBump = (texMatrixBump * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_ALPHAMAP )\n    vUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\n    vColor = color * color;\n#else\n    vColor = color;\n#endif\n#endif\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n    vec3 transformedNormal = normalMatrix * objectNormal;\n#ifndef FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n#include<wide_lines_vert>\n    vViewPosition = -mvPosition.xyz;\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    if (projectionMatrix[3][3] == 0.0) {\n        gl_Position.z = log2(max(1.0e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + gl_Position.w;\n#else\n        gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n    } else {\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + vViewPosition.z;\n#else\n#endif\n    }\n#endif\n#ifdef MRT_NORMALS\n    depth = mvPosition.z;\n#endif\n#include<shadowmap_vert>\n#include<id_vert>\n}\n"},function(a,b){
a.exports="uniform vec3 diffuse;\r\nuniform float opacity;\r\n\r\nuniform vec3 emissive;\r\nuniform vec3 specular;\r\nuniform float shininess;\r\n\r\n#include<env_sample>\r\n\r\n#ifdef USE_COLOR\r\nvarying vec3 vColor;\r\n#endif\r\n\r\n#ifdef GAMMA_INPUT\r\nvec3 InputToLinear(vec3 c) {\r\n    return c * c;\r\n}\r\nfloat InputToLinear(float c) {\r\n    return c * c;\r\n}\r\n#else\r\nvec3 InputToLinear(vec3 c) {\r\n    return c;\r\n}\r\nfloat InputToLinear(float c) {\r\n    return c;\r\n}\r\n#endif\r\n\r\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\r\nvarying vec2 vUv;\r\n#endif\r\n\r\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\nvarying vec2 vUvBump;\r\n#endif\r\n\r\n#if defined( USE_ALPHAMAP )\r\nvarying vec2 vUvAlpha;\r\n#endif\r\n\r\n#ifdef USE_MAP\r\nuniform sampler2D map;\r\n#endif\r\n\r\n#if TONEMAP_OUTPUT > 0\r\nuniform float exposureBias;\r\n#include<tonemap>\r\n#endif\r\n\r\n#if defined(IRR_RGBM) || defined(ENV_RGBM) || defined(ENV_GAMMA) || defined(IRR_GAMMA)\r\nuniform float envMapExposure;\r\n#endif\r\n\r\n#ifdef USE_FOG\r\nuniform vec3 fogColor;\r\nuniform float fogNear;\r\nuniform float fogFar;\r\n#endif\r\n#include<id_decl_frag>\r\n#include<theming_decl_frag>\r\n#include<shadowmap_decl_frag>\r\n\r\n#ifdef USE_ENVMAP\r\n\r\nuniform float reflMipIndex;\r\n\r\nuniform float reflectivity;\r\nuniform samplerCube envMap;\r\n\r\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\n\r\nuniform float refractionRatio;\r\n\r\n#endif\r\n\r\nvec3 sampleReflection(vec3 dir, float mipIndex) {\r\n\r\n    vec3 adjDir = adjustLookupVector(dir);\r\n\r\n#ifdef ENV_GAMMA\r\n\r\n#ifdef HAVE_TEXTURE_LOD\r\n    vec4 envTexColor = textureCubeLodEXT( envMap, adjDir, mipIndex );\r\n#else\r\n\r\n\r\n    vec4 envTexColor = textureCube( envMap, adjDir, mipIndex );\r\n#endif\r\n\r\n    return GammaDecode(envTexColor, envMapExposure);\r\n\r\n#elif defined(ENV_RGBM)\r\n\r\n#ifdef HAVE_TEXTURE_LOD\r\n    vec4 envTexColor = textureCubeLodEXT( envMap, adjDir, mipIndex );\r\n#else\r\n\r\n\r\n    vec4 envTexColor = textureCube( envMap, adjDir, mipIndex );\r\n#endif\r\n\r\n    return RGBMDecode(envTexColor, envMapExposure);\r\n\r\n#else\r\n\r\n\r\n\r\n    vec4 envTexColor = textureCube( envMap, adjDir );\r\n    vec3 cubeColor = envTexColor.xyz;\r\n\r\n#ifdef GAMMA_INPUT\r\n    cubeColor *= cubeColor;\r\n#endif\r\n\r\n    return cubeColor;\r\n\r\n#endif\r\n\r\n}\r\n\r\n#endif\r\n\r\n\r\nuniform vec3 ambientLightColor;\r\n\r\n#if MAX_DIR_LIGHTS > 0\r\n\r\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\r\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\r\n\r\n#endif\r\n\r\n#if MAX_POINT_LIGHTS > 0\r\n\r\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\r\n\r\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\r\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\r\n\r\n#endif\r\n\r\n#if MAX_SPOT_LIGHTS > 0\r\n\r\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\r\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\r\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\r\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\r\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\r\n\r\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\r\n\r\n#endif\r\n\r\n#ifdef USE_IRRADIANCEMAP\r\nuniform samplerCube irradianceMap;\r\n#endif\r\n\r\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\r\nvarying highp vec3 vWorldPosition;\r\n#endif\r\n\r\nvarying highp vec3 vViewPosition;\r\n#ifndef FLAT_SHADED\r\nvarying highp vec3 vNormal;\r\n#endif\r\n\r\n#ifdef USE_BUMPMAP\r\n\r\nuniform sampler2D bumpMap;\r\nuniform float bumpScale;\r\n\r\n\r\n\r\n\r\n\r\n\r\nvec2 dHdxy_fwd() {\r\n\r\n    vec2 dSTdx = dFdx( vUvBump );\r\n    vec2 dSTdy = dFdy( vUvBump );\r\n\r\n    float Hll = bumpScale * GET_BUMPMAP(vUvBump).x;\r\n    float dBx = bumpScale * GET_BUMPMAP(vUvBump + dSTdx).x - Hll;\r\n    float dBy = bumpScale * GET_BUMPMAP(vUvBump + dSTdy).x - Hll;\r\n\r\n    return vec2( dBx, dBy );\r\n\r\n}\r\n\r\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\r\n\r\n    vec3 vSigmaX = dFdx( surf_pos );\r\n    vec3 vSigmaY = dFdy( surf_pos );\r\n    vec3 vN = surf_norm;\r\n\r\n    vec3 R1 = cross( vSigmaY, vN );\r\n    vec3 R2 = cross( vN, vSigmaX );\r\n\r\n    float fDet = dot( vSigmaX, R1 );\r\n\r\n    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\r\n    return normalize( abs( fDet ) * surf_norm - vGrad );\r\n\r\n}\r\n\r\n#endif\r\n\r\n\r\n#ifdef USE_NORMALMAP\r\n\r\nuniform sampler2D normalMap;\r\nuniform vec2 normalScale;\r\n\r\n\r\n\r\n\r\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\r\n\r\n    vec3 q0 = dFdx( eye_pos.xyz );\r\n    vec3 q1 = dFdy( eye_pos.xyz );\r\n    vec2 st0 = dFdx( vUvBump.st );\r\n    vec2 st1 = dFdy( vUvBump.st );\r\n\r\n    vec3 S = normalize(  q0 * st1.t - q1 * st0.t );\r\n    vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\r\n    vec3 N = normalize( surf_norm );\r\n\r\n    vec3 mapN = GET_NORMALMAP(vUvBump).xyz * 2.0 - 1.0;\r\n    mapN.xy = normalScale * mapN.xy;\r\n    mat3 tsn = mat3( S, T, N );\r\n    return normalize( tsn * mapN );\r\n\r\n}\r\n\r\n#endif\r\n\r\n\r\n#ifdef USE_SPECULARMAP\r\nuniform sampler2D specularMap;\r\n#endif\r\n\r\n#ifdef USE_ALPHAMAP\r\nuniform sampler2D alphaMap;\r\n#endif\r\n\r\n#include<hatch_pattern>\r\n\r\n#ifdef USE_LOGDEPTHBUF\r\nuniform float logDepthBufFC;\r\n#ifdef USE_LOGDEPTHBUF_EXT\r\n#extension GL_EXT_frag_depth : enable\r\nvarying highp float vFragDepth;\r\n#endif\r\n#endif\r\n\r\nvec3 Schlick_v3(vec3 v, float cosHV) {\r\n    float facing = max(1.0 - cosHV, 0.0);\r\n    return v + (1.0 - v) * pow(facing, 5.0);\r\n}\r\n\r\nfloat Schlick_f(float v, float cosHV) {\r\n    float facing = max(1.0 - cosHV, 0.0);\r\n    return v + ( 1.0 - v ) * pow(facing, 5.0);\r\n}\r\n\r\n#include<cutplanes>\r\n\r\nvoid main() {\r\n\r\n#if NUM_CUTPLANES > 0\r\n    checkCutPlanes(vWorldPosition);\r\n#endif\r\n\r\n    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );\r\n\r\n#ifdef USE_MAP\r\n    vec4 texelColor = GET_MAP(vUv);\r\n#ifdef MAP_INVERT\r\n    texelColor.xyz = 1.0-texelColor.xyz;\r\n#endif\r\n#ifdef GAMMA_INPUT\r\n    texelColor.xyz *= texelColor.xyz;\r\n#endif\r\n    gl_FragColor = gl_FragColor * texelColor;\r\n#endif\r\n\r\n#ifdef USE_ALPHAMAP\r\n    vec4 texelAlpha = GET_ALPHAMAP(vUvAlpha);\r\n    gl_FragColor.a *= texelAlpha.r;\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n    if ( gl_FragColor.a < ALPHATEST ) discard;\r\n#endif\r\n\r\n    float specularStrength;\r\n\r\n#ifdef USE_SPECULARMAP\r\n    vec4 texelSpecular = GET_SPECULARMAP(vUv);\r\n    specularStrength = texelSpecular.r;\r\n#else\r\n    specularStrength = 1.0;\r\n#endif\r\n\r\n#ifndef FLAT_SHADED\r\n    vec3 normal = normalize( vNormal );\r\n#ifdef DOUBLE_SIDED\r\n    normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\r\n#endif\r\n#else\r\n    vec3 fdx = dFdx( vViewPosition );\r\n    vec3 fdy = dFdy( vViewPosition );\r\n    vec3 normal = normalize( cross( fdx, fdy ) );\r\n#endif\r\n\r\n    vec3 geomNormal = normal;\r\n\r\n#ifdef USE_NORMALMAP\r\n    normal = perturbNormal2Arb( -vViewPosition, normal );\r\n#elif defined( USE_BUMPMAP )\r\n    normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\r\n#endif\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    vec3 viewDirection;\r\n    if (projectionMatrix[3][3] == 0.0) {\r\n        viewDirection = normalize( vViewPosition );\r\n    } else {\r\n        viewDirection = vec3(0.0, 0.0, 1.0);\r\n    }\r\n\r\n    vec3 totalDiffuse = vec3( 0.0 );\r\n    vec3 totalSpecular = vec3( 0.0 );\r\n\r\n\r\n\r\n    float shininessB = shininess * 4.0;\r\n\r\n#if MAX_POINT_LIGHTS > 0\r\n\r\n    vec3 pointDiffuse  = vec3( 0.0 );\r\n    vec3 pointSpecular = vec3( 0.0 );\r\n\r\n    for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\r\n\r\n        vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\r\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\r\n\r\n        float lDistance = 1.0;\r\n        if ( pointLightDistance[ i ] > 0.0 )\r\n            lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\r\n\r\n        lVector = normalize( lVector );\r\n\r\n\r\n\r\n        float dotProduct = dot( normal, lVector );\r\n\r\n        float pointDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n\r\n        pointDiffuse  += InputToLinear(diffuse) * InputToLinear(pointLightColor[ i ]) * pointDiffuseWeight * lDistance;\r\n\r\n\r\n\r\n        vec3 pointHalfVector = normalize( lVector + viewDirection );\r\n        float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\r\n\r\n        float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininessB ), 0.0 );\r\n        float specularNormalization = shininessB * 0.125 + 0.25;\r\n        vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, pointHalfVector ) );\r\n        pointSpecular += schlick * InputToLinear(pointLightColor[ i ]) * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization ;\r\n\r\n    }\r\n\r\n    totalDiffuse += pointDiffuse;\r\n    totalSpecular += pointSpecular;\r\n\r\n#endif\r\n\r\n#if MAX_SPOT_LIGHTS > 0\r\n\r\n    vec3 spotDiffuse  = vec3( 0.0 );\r\n    vec3 spotSpecular = vec3( 0.0 );\r\n\r\n    for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\r\n\r\n        vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\r\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\r\n\r\n        float lDistance = 1.0;\r\n        if ( spotLightDistance[ i ] > 0.0 )\r\n            lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\r\n\r\n        lVector = normalize( lVector );\r\n\r\n        float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\r\n\r\n        if ( spotEffect > spotLightAngleCos[ i ] ) {\r\n\r\n            spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\r\n\r\n\r\n\r\n            float dotProduct = dot( normal, lVector );\r\n\r\n            float spotDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n            spotDiffuse += InputToLinear(diffuse) * InputToLinear(spotLightColor[ i ]) * spotDiffuseWeight * lDistance * spotEffect;\r\n\r\n\r\n\r\n            vec3 spotHalfVector = normalize( lVector + viewDirection );\r\n            float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\r\n            float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininessB ), 0.0 );\r\n\r\n            float specularNormalization = shininessB * 0.125 + 0.25;\r\n            vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, spotHalfVector ) );\r\n            spotSpecular += schlick * InputToLinear(spotLightColor[ i ]) * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\r\n        }\r\n\r\n    }\r\n\r\n    totalDiffuse += spotDiffuse;\r\n    totalSpecular += spotSpecular;\r\n\r\n#endif\r\n\r\n#if MAX_DIR_LIGHTS > 0\r\n\r\n    vec3 dirDiffuse  = vec3( 0.0 );\r\n    vec3 dirSpecular = vec3( 0.0 );\r\n\r\n    for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\r\n\r\n        vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\r\n        vec3 dirVector = normalize( lDirection.xyz );\r\n\r\n\r\n\r\n        float dotProduct = dot( normal, dirVector );\r\n\r\n        float dirDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n        dirDiffuse  += InputToLinear(diffuse) * InputToLinear(directionalLightColor[ i ]) * dirDiffuseWeight;\r\n\r\n\r\n\r\n        vec3 dirHalfVector = normalize( dirVector + viewDirection );\r\n        float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\r\n        float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininessB ), 0.0 );\r\n\r\n        float specularNormalization = shininessB * 0.125 + 0.25;\r\n        vec3 schlick = Schlick_v3(InputToLinear(specular), dot( dirVector, dirHalfVector ));\r\n\r\n        dirSpecular += schlick * InputToLinear(directionalLightColor[ i ]) * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\r\n\r\n    }\r\n\r\n    totalDiffuse += dirDiffuse;\r\n    totalSpecular += dirSpecular;\r\n\r\n#endif\r\n\r\n\r\n\r\n#ifdef USE_IRRADIANCEMAP\r\n    vec3 worldNormal = mat3(viewMatrixInverse) * normal;\r\n    vec3 indirectDiffuse = sampleIrradianceMap(worldNormal, irradianceMap, envMapExposure);\r\n\r\n    indirectDiffuse = applyEnvShadow(indirectDiffuse, worldNormal);\r\n\r\n    totalDiffuse += InputToLinear(diffuse) * indirectDiffuse;\r\n#endif\r\n\r\n\r\n#ifdef METAL\r\n    gl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) + totalSpecular );\r\n#else\r\n    gl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) ) + totalSpecular;\r\n#endif\r\n\r\n\r\n\r\n#ifdef USE_COLOR\r\n    gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\r\n#endif\r\n\r\n\r\n#if defined(USE_ENVMAP)\r\n\r\n    vec3 reflectVec;\r\n\r\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\n\r\n#ifdef ENVMAP_MODE_REFLECTION\r\n    reflectVec = reflect( -viewDirection, normal );\r\n#else \r\n    reflectVec = refract( -viewDirection, normal, refractionRatio );\r\n#endif\r\n\r\n#else\r\n\r\n    reflectVec = reflect( -viewDirection, normal );\r\n\r\n#endif\r\n\r\n    reflectVec = mat3(viewMatrixInverse) * reflectVec;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    float reflectScale = 1.0;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    vec3 cubeColor = sampleReflection(reflectVec, reflMipIndex);\r\n\r\n    cubeColor *= reflectScale;\r\n\r\n    float facing = dot( viewDirection, normal );\r\n\r\n\r\n\r\n\r\n\r\n    if (facing < -1e-2)\r\n        facing = 1.0;\r\n    else\r\n        facing = max(1e-6, facing);\r\n\r\n#ifdef USE_BUMPMAP\r\n\r\n\r\n\r\n    facing = min(1.0, facing + bumpScale * 7.0);\r\n\r\n#endif\r\n\r\n    vec3 schlickRefl;\r\n\r\n#ifdef METAL\r\n\r\n\r\n    schlickRefl = InputToLinear(specular);\r\n\r\n#else\r\n\r\n\r\n    schlickRefl = Schlick_v3(InputToLinear(specular), facing);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    gl_FragColor.a = mix(gl_FragColor.a, Schlick_f(gl_FragColor.a, facing), reflectivity);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    float invSchlick = pow(1.0 - facing * 0.5, 5.0);\r\n\r\n\r\n    float norm_factor = (28.0 / 23.0) * (1.0 - invSchlick) * (1.0 - invSchlick);\r\n\r\n    gl_FragColor.xyz *= norm_factor * (1.0 - InputToLinear(specular));\r\n\r\n#endif\r\n\r\n\r\n    gl_FragColor.xyz += cubeColor.xyz * specularStrength * schlickRefl.xyz;\r\n\r\n#ifdef CLEARCOAT\r\n\r\n    vec3 reflectVecClearcoat = reflect( -viewDirection, geomNormal );\r\n    reflectVecClearcoat = mat3(viewMatrixInverse) * reflectVecClearcoat;\r\n\r\n    vec3 cubeColorClearcoat = sampleReflection(reflectVecClearcoat, 0.0);\r\n\r\n\r\n    float schlickClearcoat = Schlick_f(InputToLinear(reflectivity), facing);\r\n\r\n\r\n\r\n    gl_FragColor.xyz = mix(gl_FragColor.xyz, cubeColorClearcoat * schlickClearcoat, 0.5);\r\n\r\n#endif\r\n\r\n\r\n\r\n\r\n#endif\r\n\r\n#if TONEMAP_OUTPUT == 1\r\n    gl_FragColor.xyz = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * gl_FragColor.xyz);\r\n#elif TONEMAP_OUTPUT == 2\r\n    gl_FragColor.xyz = toneMapCanonFilmic_WithGamma( exposureBias * gl_FragColor.xyz );\r\n#endif\r\n\r\n\r\n\r\n#ifdef USE_FOG\r\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\r\n    float fogFactor = smoothstep( fogNear, fogFar, depth );\r\n    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\r\n#endif\r\n#include<theming_frag>\r\n#include<final_frag>\r\n\r\n}\r\n"},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.BasicShader=void 0;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(58),h=c(93),i=d(h),j=c(94),k=d(j),l=b.BasicShader={uniforms:f.UniformsUtils.merge([f.UniformsLib.common,f.UniformsLib.fog,f.UniformsLib.shadowmap,g.ShaderChunks.CutPlanesUniforms,g.ShaderChunks.IdUniforms,g.ShaderChunks.ThemingUniform,g.ShaderChunks.PointSizeUniforms,g.ShaderChunks.WideLinesUniforms]),vertexShader:i.default,fragmentShader:k.default};f.ShaderLib.firefly_basic=l},function(a,b){a.exports="#include<id_decl_vert>\n#include<decl_point_size>\n#include<common>\n#include<map_pars_vertex>\n#include<lightmap_pars_vertex>\n#include<envmap_pars_vertex>\n#include<color_pars_vertex>\n#include<morphtarget_pars_vertex>\n#include<skinning_pars_vertex>\n#include<logdepthbuf_pars_vertex>\n#include<wide_lines_decl>\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvoid main() {\n#include<map_vertex>\n#include<lightmap_vertex>\n#include<color_vertex>\n#include<skinbase_vertex>\n#ifdef USE_ENVMAP\n#include<morphnormal_vertex>\n#include<skinnormal_vertex>\n#include<defaultnormal_vertex>\n#endif\n#include<morphtarget_vertex>\n#include<skinning_vertex>\n#include<default_vertex>\n#include<wide_lines_vert>\n#include<logdepthbuf_vertex>\n#include<worldpos_vertex>\n#if NUM_CUTPLANES > 0\n    vec4 _worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = _worldPosition.xyz;\n#endif\n#include<envmap_vertex>\n#include<id_vert>\n#include<point_size>\n}\n"},function(a,b){a.exports="uniform vec3 diffuse;\nuniform float opacity;\n#include<common>\n#include<color_pars_fragment>\n#include<map_pars_fragment>\n#include<alphamap_pars_fragment>\n#include<lightmap_pars_fragment>\n#include<envmap_pars_fragment>\n#include<fog_pars_fragment>\n#include<specularmap_pars_fragment>\n#include<logdepthbuf_pars_fragment>\n#if NUM_CUTPLANES > 0\nvarying highp vec3 vWorldPosition;\n#endif\n#include<cutplanes>\n#include<id_decl_frag>\n#include<theming_decl_frag>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 outgoingLight = vec3( 0.0 );\n    vec4 diffuseColor = vec4( diffuse, opacity );\n#include<logdepthbuf_fragment>\n#include<map_fragment>\n#include<color_fragment>\n#include<alphamap_fragment>\n#include<alphatest_fragment>\n#include<specularmap_fragment>\n    outgoingLight = diffuseColor.rgb;\n#include<lightmap_fragment>\n#include<envmap_fragment>\n#include<linear_to_gamma_fragment>\n#include<fog_fragment>\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include<theming_frag>\n#include<final_frag>\n}\n"},function(a,b,c){"use strict";function d(a,b){for(var c=255*a.x,d=255*a.y,e=255*a.z,f=255*b.x,g=255*b.y,h=255*b.z,i=new Uint8Array(16),k=new Uint8Array(16),l=new Uint8Array(16),m=0;m<4;m++)i[4*m]=c,i[4*m+1]=d,i[4*m+2]=e,i[4*m+3]=255,k[4*m]=f,k[4*m+1]=g,k[4*m+2]=h,k[4*m+3]=255,m>1?(l[4*m]=c,l[4*m+1]=d,l[4*m+2]=e,l[4*m+3]=255):(l[4*m]=f,l[4*m+1]=g,l[4*m+2]=h,l[4*m+3]=255);var n=new j.DataTexture(l,2,2,j.RGBAFormat),o=new j.DataTexture(l,2,2,j.RGBAFormat),p=new j.DataTexture(k,2,2,j.RGBAFormat),q=new j.DataTexture(i,2,2,j.RGBAFormat),r=new j.DataTexture(l,2,2,j.RGBAFormat),s=new j.DataTexture(l,2,2,j.RGBAFormat),t=new j.Texture(null,j.CubeReflectionMapping,j.RepeatWrapping,j.RepeatWrapping,j.LinearFilter,j.LinearFilter,j.RGBAFormat);return t.image=[o,n,q,p,s,r],t.needsUpdate=!0,t}function e(a,b){var c=255*b[2]+b[3],d=Math.pow(2,(c-127)/2),e=d/b[1],f=b[0]*e,g=m[0]*f+m[3]*d+m[6]*e,h=m[1]*f+m[4]*d+m[7]*e,i=m[2]*f+m[5]*d+m[8]*e;g<0&&(g=0),h<0&&(h=0),i<0&&(i=0),a[0]=g,a[1]=h,a[2]=i}function f(a,b,c){var d=.0625*Math.sqrt(b[0]*c),e=.0625*Math.sqrt(b[1]*c),f=.0625*Math.sqrt(b[2]*c),g=Math.max(Math.max(d,e),Math.max(f,1e-6));g>1&&(g=1);var h=Math.ceil(255*g)/255;d>1&&(d=1),e>1&&(e=1),f>1&&(f=1),a[3]=h;var i=1/h;a[0]=d*i,a[1]=e*i,a[2]=f*i}function g(a,b,c){var d=Math.sqrt(b[0]*c),e=Math.sqrt(b[1]*c),f=Math.sqrt(b[2]*c);d>65504&&(d=65504),e>65504&&(e=65504),f>65504&&(f=65504),a[0]=d,a[1]=e,a[2]=f}function h(a,b,c,d){if(!a.LogLuv)return void l.logger.warn("Environment map expected to be in LogLuv format.");for(var h=Math.pow(2,b),i=Array.isArray(a.image)?a.image:[a.image],m=0;m<i.length;m++)for(var p=i[m],q=0;q<p.mipmaps.length;q++){var r,s=p.mipmaps[q],t=s.data;c?(r=new Uint16Array(t.length/4*3),s.data=r):r=t.buffer;for(var u=0,v=0;v<t.length;v+=4)n[0]=t[v]/255,n[1]=t[v+1]/255,n[2]=t[v+2]/255,n[3]=t[v+3]/255,e(o,n),c?(g(n,o,h),r[u++]=(0,k.FloatToHalf)(n[0]),r[u++]=(0,k.FloatToHalf)(n[1]),r[u++]=(0,k.FloatToHalf)(n[2])):(f(n,o,h),t[v]=Math.round(255*n[0]),t[v+1]=Math.round(255*n[1]),t[v+2]=Math.round(255*n[2]),t[v+3]=Math.round(255*n[3]))}a.LogLuv=!1,c?(a.type=j.HalfFloatType,a.format=j.RGBFormat,a.RGBM=!1,a.GammaEncoded=!0):a.RGBM=!0,d&&d(a)}Object.defineProperty(b,"__esModule",{value:!0}),b.CreateCubeMapFromColors=d,b.DecodeEnvMap=h;var i=c(2),j=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(i),k=c(96),l=c(8),m=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268],n=new Float32Array(4),o=new Float32Array(4)},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=new Float32Array(1),d=new Uint32Array(c.buffer),e=new Uint16Array(1),f=new Uint16Array(1),g=b.FloatToHalf=function(a){c[0]=a;var b=d[0],g=0;if(0==(2147483647&b))f[g++]=b>>16;else{var h=2147483648&b,i=2139095040&b,j=8388607&b;if(0===i)f[g++]=h>>16;else if(2139095040==i)f[g++]=0===j?h>>16|31744:65024;else{var k,l,m=h>>16,n=(0|i>>23)-127+15;n>=31?f[g++]=h>>16|31744:n<=0?(14-n>24?k=0:(j|=8388608,k=j>>14-n,e[0]=k,k=e[0],j>>13-n&1&&(k+=1)),f[g++]=m|k):(l=n<<10,e[0]=l,l=e[0],k=j>>13,e[0]=k,k=e[0],f[g++]=4096&j?1+(m|l|k):m|l|k)}}return f[0]},h=b.HalfToFloat=function(a){var b,e=65535&a;if(0==(32767&e))b=e<<16;else{var f=32768&e,g=31744&e,h=1023&e;if(0===g){var i=-1;do{i++,h<<=1}while(0==(1024&h));var j=f<<16,k=(g<<16>>26)-15+127-i,l=k<<23,m=(1023&h)<<13;b=j|l|m}else 31744==g?b=0===h?f<<16|2139095040:4290772992:(j=f<<16,k=(g<<16>>26)-15+127,l=k<<23,m=h<<13,b=j|l|m)}return d[0]=b,c[0]},i=b.HALF_INT_MAX=59390,j=b.IntToHalf=function(a){if(a>i-1||a<0)return console.log("out of range"),g(NaN);if(0===a)return 0;var b=!1;a>i/2-1&&(b=!0,a-=i/2-1);var c=0|Math.abs(a/1024),d=Math.pow(2,c-13),e=d+(a-1024*c)*d/1024;return b&&(e=-e),g(e)},k=b.HalfToInt=function(a){if(0===a)return 0;var b=h(a),c=!1;b<0&&(c=!0,b=-b);var d=0|Math.floor(Math.log(b)/Math.log(2)),e=Math.pow(2,d),f=(b-e)/e*1024+1024*(d+13);return c&&(f+=i/2-1),f};b.HalfTest=function(){for(var a=[-1/255,-.17,-75,-1789,-.005],b=0;b<a.length;b++)console.log("input",a[b],"encoded",g(a[b]),"decoded",h(g(a[b])));for(var b=0;b<i;b++){var c=k(j(b));c!==b&&console.log("Roundtrip failed for",b,c)}}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.SAOShader=void 0;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(58),h=c(47),i=d(h),j=c(98),k=d(j);b.SAOShader={uniforms:f.UniformsUtils.merge([g.ShaderChunks.DepthTextureUniforms,{size:{type:"v2",value:new f.Vector2(512,512)},resolution:{type:"v2",value:new f.Vector2(1/512,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},radius:{type:"f",value:10},bias:{type:"f",value:.1},projScale:{type:"f",value:500},intensity:{type:"f",value:.4},tDepth_mip1:{type:"t",value:null},tDepth_mip2:{type:"t",value:null},tDepth_mip3:{type:"t",value:null},tDepth_mip4:{type:"t",value:null},tDepth_mip5:{type:"t",value:null}}]),vertexShader:i.default,fragmentShader:k.default}},function(a,b){a.exports="\n#include <depth_texture>\n#define USE_MIPMAP 1\nuniform float cameraNear;\nuniform float cameraFar;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform float lumInfluence;\nvarying vec2 vUv;\n#define NUM_SAMPLES (17)\n#define LOG_MAX_OFFSET (3)\n#define MAX_MIP_LEVEL (5)\n#define NUM_SPIRAL_TURNS (5)\n#define MIN_RADIUS (3.0)\nuniform float           projScale;\n#ifdef USE_MIPMAP\nuniform sampler2D tDepth_mip1;\nuniform sampler2D tDepth_mip2;\nuniform sampler2D tDepth_mip3;\nuniform sampler2D tDepth_mip4;\nuniform sampler2D tDepth_mip5;\n#endif\nuniform float radius;\nuniform float bias;\nuniform float intensity;\nvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\n    float alpha = float(float(sampleNumber) + 0.5) * (1.0 / float(NUM_SAMPLES));\n    float angle = alpha * (float(NUM_SPIRAL_TURNS) * 6.28) + spinAngle;\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n}\nfloat CSZToKey(float z) {\n    return clamp( (z+cameraNear) / (cameraNear-cameraFar), 0.0, 1.0);\n}\nvoid packKey(float key, out vec2 p) {\n    float temp = floor(key * 255.0);\n    p.x = temp * (1.0 / 255.0);\n    p.y = key * 255.0 - temp;\n}\n#include <pack_depth>\nfloat unpackDepthNearFar( const in vec4 rgba_depth ) {\n    float depth = unpackDepth( rgba_depth );\n    if (depth == 0.0)\n        return -cameraFar * 1.0e10;\n    return depth * (cameraNear - cameraFar) - cameraNear;\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\n    return normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 reconstructNonUnitCSFaceNormal(vec3 C) {\n    return cross(dFdy(C), dFdx(C));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\n    vec3 P;\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\n    return P;\n}\nvec3 getOffsetPosition(ivec2 ssC, vec2 unitOffset, float ssR) {\n    ivec2 ssP = ivec2(ssR * unitOffset) + ssC;\n    vec3 P;\n    vec2 screenUV = (vec2(ssP) + vec2(0.5)) * resolution;\n#ifdef USE_MIPMAP\n    int mipLevel = int(max(0.0, min(floor(log2(ssR)) - float(LOG_MAX_OFFSET), float(MAX_MIP_LEVEL))));\n    if (mipLevel == 0) {\n        P.z = texture2D(tDepth, screenUV).z;\n        if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n    }\n    else if (mipLevel == 1)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip1, screenUV));\n    else if (mipLevel == 2)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip2, screenUV));\n    else if (mipLevel == 3)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip3, screenUV));\n    else if (mipLevel == 4)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip4, screenUV));\n    else if (mipLevel == 5)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip5, screenUV));\n#else\n    P.z = texture2D(tDepth, screenUV).z;\n    if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n#endif\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), P.z);\n    return P;\n}\nfloat sampleAO(in ivec2 ssC, in vec3 C, in vec3 n_C, in float ssDiskRadius, in int tapIndex, in float randomPatternRotationAngle) {\n    float ssR;\n    vec2 unitOffset = tapLocation(tapIndex, randomPatternRotationAngle, ssR);\n    ssR = max(0.75, ssR * ssDiskRadius);\n    vec3 Q = getOffsetPosition(ssC, unitOffset, ssR);\n    vec3 v = Q - C;\n    float vv = dot(v, v);\n    float vn = dot(v, n_C);\n    const float epsilon = 0.001;\n    float angAdjust = mix(1.0, max(0.0, 1.5 * n_C.z), 0.35);\n#define HIGH_QUALITY\n#ifdef HIGH_QUALITY\n    float f = max(1.0 - vv / (radius * radius), 0.0); return angAdjust * f * max((vn - bias) / sqrt(epsilon + vv), 0.0);\n#else\n    float f = max(radius * radius - vv, 0.0); return angAdjust * f * f * f * max((vn - bias) / (epsilon + vv), 0.0);\n#endif\n}\nconst bool useNoise = true;\nfloat getRandomAngle(vec2 pos) {\n    float dt= dot(pos ,vec2(12.9898,78.233));\n    return 6.28318 * fract(sin(mod(dt,3.14)) * 43758.5453);\n}\nvoid main() {\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 nrmz = texture2D(tDepth, vUv);\n    if (nrmz.z == 0.0) {\n        gl_FragColor.r = 1.0;\n        gl_FragColor.a = 0.0;\n        packKey(1.0, gl_FragColor.gb);\n        return;\n    }\n    vec3 C = getPosition(ssC, nrmz.z);\n    packKey(CSZToKey(C.z), gl_FragColor.gb);\n    float ssDiskRadius = -projScale * radius / mix(C.z, -1.0, isOrtho);\n    float A;\n    if (ssDiskRadius <= MIN_RADIUS) {\n        A = 1.0;\n    } else {\n        float sum = 0.0;\n        float randomPatternRotationAngle = getRandomAngle(vUv);\n        vec3 n_C = vec3(nrmz.x, nrmz.y, sqrt(1.0 - dot(nrmz.xy, nrmz.xy)));\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 0, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 1, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 2, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 3, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 4, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 5, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 6, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 7, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 8, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 9, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 10, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 11, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 12, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 13, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 14, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 15, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 16, randomPatternRotationAngle);\n        float intensityDivR6 = intensity / pow(radius, 6.0);\n#ifdef HIGH_QUALITY\n        A = pow(max(0.0, 1.0 - sqrt(sum * (3.0 / float(NUM_SAMPLES)))), intensity);\n#else\n        A = max(0.0, 1.0 - sum * intensityDivR6 * (5.0 / float(NUM_SAMPLES)));\n        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n#endif\n        if (abs(dFdx(C.z)) < 0.02) {\n            A -= dFdx(A) * (mod(float(ssC.x), 2.0) - 0.5);\n        }\n        if (abs(dFdy(C.z)) < 0.02) {\n            A -= dFdy(A) * (mod(float(ssC.y), 2.0) - 0.5);\n        }\n        A = mix(1.0, A, clamp(ssDiskRadius - MIN_RADIUS,0.0,1.0));\n    }\n    gl_FragColor.r = A;\n    gl_FragColor.a = 1.0;\n}\n"},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createLinePatternTexture=b.LineStyleDefs=void 0;var d=c(2),e=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(d),f=b.LineStyleDefs=[{id:"SOLID",name:"Solid",ascii_art:"_______________________________________",def:[1]},{id:"BORDER",name:"Border",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.5,-.25,.5,-.25,0,-.25]},{id:"BORDER2",name:"Border (.5x)",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.25,-.125,.25,-.125,0,-.125]},{id:"BORDERX2",name:"Border (2x)",ascii_art:"____  ____  .  ____  ____  .  ___",def:[1,-.5,1,-.5,0,-.5]},{id:"CENTER",name:"Center",ascii_art:"____ _ ____ _ ____ _ ____ _ ____ _ ____",def:[1.25,-.25,.25,-.25]},{id:"CENTER2",name:"Center (.5x)",ascii_art:"___ _ ___ _ ___ _ ___ _ ___ _ ___",def:[.75,-.125,.125,-.125]},{id:"CENTERX2",name:"Center (2x)",ascii_art:"________  __  ________  __  _____",def:[2.5,-.5,.5,-.5]},{id:"DASHDOT",name:"Dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . __",def:[.5,-.25,0,-.25]},{id:"DASHDOT2",name:"Dash dot (.5x)",ascii_art:"_._._._._._._._._._._._._._._.",def:[.25,-.125,0,-.125]},{id:"DASHDOTX2",name:"Dash dot (2x)",ascii_art:"____  .  ____  .  ____  .  ___",def:[1,-.5,0,-.5]},{id:"DASHED",name:"Dashed",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ _",def:[.5,-.25]},{id:"DASHED2",name:"Dashed (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.25,-.125]},{id:"DASHEDX2",name:"Dashed (2x)",ascii_art:"____  ____  ____  ____  ____  ___",def:[1,-.5]},{id:"DIVIDE",name:"Divide",ascii_art:"____ . . ____ . . ____ . . ____ . . ____",def:[.5,-.25,0,-.25,0,-.25]},{id:"DIVIDE2",name:"Divide (.5x)",
ascii_art:"__..__..__..__..__..__..__..__.._",def:[.25,-.125,0,-.125,0,-.125]},{id:"DIVIDEX2",name:"Divide (2x)",ascii_art:"________  .  .  ________  .  .  _",def:[1,-.5,0,-.5,0,-.5]},{id:"DOT",name:"Dot",ascii_art:". . . . . . . . . . . . . . . . . . . . . . . .",def:[0,-.25]},{id:"DOT2",name:"Dot (.5x)",ascii_art:"........................................",def:[0,-.125]},{id:"DOTX2",name:"Dot (2x)",ascii_art:".  .  .  .  .  .  .  .  .  .  .  .  .  .",def:[0,-.5]},{id:"HIDDEN",name:"Hidden",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ __",def:[.25,-.125]},{id:"HIDDEN2",name:"Hidden (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.125,-.0625]},{id:"HIDDENX2",name:"Hidden (2x)",ascii_art:"____ ____ ____ ____ ____ ____ ____",def:[.5,-.25]},{id:"PHANTOM",name:"Phantom",ascii_art:"______  __  __  ______  __  __  ______",def:[1.25,-.25,.25,-.25,.25,-.25]},{id:"PHANTOM2",name:"Phantom (.5x)",ascii_art:"___ _ _ ___ _ _ ___ _ _ ___ _ _",def:[.625,-.125,.125,-.125,.125,-.125]},{id:"PHANTOMX2",name:"Phantom (2x)",ascii_art:"____________    ____    ____   _",def:[2.5,-.5,.5,-.5,.5,-.5]},{id:"ACAD_ISO02W100",name:"ISO dash",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __",def:[12,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO03W100",name:"ISO dash space",ascii_art:"__    __    __    __    __    __",def:[12,-18],pen_width:1,unit:"mm"},{id:"ACAD_ISO04W100",name:"ISO long-dash dot",ascii_art:"____ . ____ . ____ . ____ . _",def:[24,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO05W100",name:"ISO long-dash double-dot",ascii_art:"____ .. ____ .. ____ .",def:[24,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO06W100",name:"ISO long-dash triple-dot",ascii_art:"____ ... ____ ... ____",def:[24,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO07W100",name:"ISO dot",ascii_art:". . . . . . . . . . . . . . . . . . . .",def:[.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO08W100",name:"ISO long-dash short-dash",ascii_art:"____ __ ____ __ ____ _",def:[24,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO09W100",name:"ISO long-dash double-short-dash",ascii_art:"____ __ __ ____",def:[24,-3,6,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO10W100",name:"ISO dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . ",def:[12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO11W100",name:"ISO double-dash dot",ascii_art:"__ __ . __ __ . __ __ . __ _",def:[12,-3,12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO12W100",name:"ISO dash double-dot",ascii_art:"__ . . __ . . __ . . __ . .",def:[12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO13W100",name:"ISO double-dash double-dot",ascii_art:"__ __ . . __ __ . . _",def:[12,-3,12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO14W100",name:"ISO dash triple-dot",ascii_art:"__ . . . __ . . . __ . . . _",def:[12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO15W100",name:"ISO double-dash triple-dot",ascii_art:"__ __ . . . __ __ . .",def:[12,-3,12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"FENCELINE1",name:"Fenceline circle",ascii_art:"----0-----0----0-----0----0-----0--",def:[.25,-.1,["CIRC1","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"FENCELINE2",name:"Fenceline square",ascii_art:"----[]-----[]----[]-----[]----[]---",def:[.25,-.1,["BOX","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"TRACKS",name:"Tracks",ascii_art:"-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-",def:[.15,["TRACK1","ltypeshp.shx","s=.25"],.15]},{id:"BATTING",name:"Batting",ascii_art:"SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS",def:[1e-4,-.1,["BAT","ltypeshp.shx","x=-.1","s=.1"],-.2,["BAT","ltypeshp.shx","r=180","x=.1","s=.1"],-.1]},{id:"HOT_WATER_SUPPLY",name:"Hot water supply",ascii_art:"---- HW ---- HW ---- HW ----",def:[.5,-.2,["HW","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.2]},{id:"GAS_LINE",name:"Gas line",ascii_art:"----GAS----GAS----GAS----GAS----GAS----GAS--",def:[.5,-.2,["GAS","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.25]},{id:"ZIGZAG",name:"Zig zag",ascii_art:"/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/",def:[1e-4,-.2,["ZIG","ltypeshp.shx","x=-.2","s=.2"],-.4,["ZIG","ltypeshp.shx","r=180","x=.2","s=.2"],-.2]}];b.createLinePatternTexture=function(){for(var a=f.length,b=0,c=0;c<a;c++){var d=f[c];d.def.length>b&&(b=d.def.length)}for(var g=b+3,h=a,i=1;i<g;)i*=2;for(g=i,i=1;i<h;)i*=2;h=i;for(var j=new Uint8Array(g*h),k=0;k<a;k++){for(var l=k*g,d=f[k],m=d.unit&&"mm"==d.unit?1/25.4:1,n=d.pen_width||0,o=d.def,p=0,c=0;c<o.length;c++){var q=Math.abs(o[c]);q<=.5*n&&(q=0);var r=0|96*q*m;p+=r,j[l+c+2]=r||1}j[l]=p%256,j[l+1]=p/256,j[l+o.length+2]=0}var s=new e.DataTexture(j,g,h,e.LuminanceFormat,e.UnsignedByteType,e.UVMapping,e.ClampToEdgeWrapping,e.ClampToEdgeWrapping,e.NearestFilter,e.NearestFilter,0);return s.generateMipmaps=!1,s.flipY=!1,s.needsUpdate=!0,s}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.WebGLProgram=b.GetPrismMapChunk=b.PrismMaps=void 0;var d=c(56),e=c(58),f=c(2),g=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(f),h=c(4),i=b.PrismMaps=["opaque_luminance_modifier","surface_albedo","surface_roughness","surface_anisotropy","surface_rotation","opaque_f0","opaque_albedo","metal_f0","layered_f0","layered_diffuse","layered_roughness","layered_anisotropy","layered_rotation","layered_bottom_f0","layered_fraction","surface_cutout","glazing_transmission_color","glazing_f0","glazing_transmission_roughness","wood_curly_distortion"],j=b.GetPrismMapChunk=function(a,b,c){var d="uv_"+a+"_map",e="";return b&&c?e="if ("+d+".x < 0.0 || "+d+".x > 1.0 || "+d+".y < 0.0 || "+d+".y > 1.0) { discard; }":b?e="if ("+d+".x < 0.0 || "+d+".x > 1.0) { discard; }":c&&(e="if ("+d+".y < 0.0 || "+d+".y > 1.0) { discard; }"),"#define "+a.toUpperCase()+"_CLAMP_TEST "+e};b.WebGLProgram=function(){var a=0,b=function(a){var b,c,d=[];for(var e in a)!1!==(b=a[e])&&(c="#define "+e+" "+b,d.push(c));return d.join("\n")},c=function(a,b,c){for(var d={},e=0,f=c.length;e<f;e++){var g=c[e];d[g]=a.getUniformLocation(b,g)}return d},f=function(a,b,c){for(var d={},e=0,f=c.length;e<f;e++){var g=c[e];d[g]=a.getAttribLocation(b,g)}return d},k=function(a,b,c,d,e){var f=d?"1.0-":"",g="texture2D("+a+", (UV))",h="";return e=e||"vec4(0.0)",b&&c?h="((UV).x < 0.0 || (UV).x > 1.0 || (UV).y < 0.0 || (UV).y > 1.0) ? "+e+" : ":b?h="((UV).x < 0.0 || (UV).x > 1.0) ? "+e+" : ":c&&(h="((UV).y < 0.0 || (UV).y > 1.0) ? "+e+" : "),"#define GET_"+a.toUpperCase()+"(UV) ("+h+f+g+")"},l=function(a){for(var b="\n",c=0;c<i.length;c++){var d=a[i[c]];d&&(b+=j(i[c],d.S,d.T)+"\n")}return b};return function(i,j,m,n){var o=i,p=o.context,q=m.defines,r=m.__webglShader.uniforms,s=m.attributes,t=(0,e.resolve)(m.__webglShader.vertexShader),u=(0,e.resolve)(m.__webglShader.fragmentShader),v=m.index0AttributeName;void 0===v&&!0===n.morphTargets&&(v="position");n.envMap;var w,x,y=i.gammaFactor>0?i.gammaFactor:1,z=b(q),A=p.createProgram();m instanceof g.RawShaderMaterial?(w="",x=""):(w=["precision "+n.precision+" float;","precision "+n.precision+" int;",z,n.vertexPrefix,n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",o.gammaInput?"#define GAMMA_INPUT":"",o.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,n.mrtNormals?"#define MRT_NORMALS":"",n.mrtIdBuffer?"#define MRT_ID_BUFFER":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_BONES "+n.maxBones,"#define NUM_CUTPLANES "+n.numCutplanes,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define ENVMAP_MODE_REFLECTION":"",n.irradianceMap?"#define USE_IRRADIANCEMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.vertexIds?"#define USE_VERTEX_ID":"",n.useTiling?"#define USE_TILING":"",n.useInstancing?"#define USE_INSTANCING":"",n.wideLines?"#define WIDE_LINES":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals?"#define USE_MORPHNORMALS":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.useFragDepthExt?"#define USE_LOGDEPTHBUF_EXT":"",n.packedNormals?"#define UNPACK_NORMALS":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","#ifdef UNPACK_NORMALS","attribute vec2 normal;","#else","attribute vec3 normal;","#endif","attribute vec2 uv;","attribute vec2 uv2;","#ifdef PRISMWOOD","attribute vec3 uvw;","#endif","#ifdef USE_COLOR","   attribute vec3 color;","#endif",""].join("\n"),x=[n.bumpMap||n.normalMap?"#extension GL_OES_standard_derivatives : enable":"",!n.mrtIdBuffer&&!n.mrtNormals||h.isIE11?"":"#extension GL_EXT_draw_buffers : enable",n.mrtIdBuffer?"#define gl_FragColor gl_FragData[0]":"",n.haveTextureLod?"#define HAVE_TEXTURE_LOD":"",z,n.fragmentPrefix,"#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define NUM_CUTPLANES "+n.numCutplanes,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",o.gammaInput?"#define GAMMA_INPUT":"",o.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,n.mrtNormals?"#define MRT_NORMALS":"",n.mrtIdBuffer?"#define MRT_ID_BUFFER":"",n.mrtIdBuffer>1?"#define MODEL_COLOR":"","#define TONEMAP_OUTPUT "+(n.tonemapOutput||0),n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define ENVMAP_TYPE_CUBE":"",n.envMap?"#define ENVMAP_MODE_REFLECTION":"",n.envMap?"#define ENVMAP_BLENDING_MULTIPLY":"",n.irradianceMap?"#define USE_IRRADIANCEMAP":"",n.envGammaEncoded?"#define ENV_GAMMA":"",n.irrGammaEncoded?"#define IRR_GAMMA":"",n.envRGBM?"#define ENV_RGBM":"",n.irrRGBM?"#define IRR_RGBM":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.vertexIds?"#define USE_VERTEX_ID":"",n.metal?"#define METAL":"",n.clearcoat?"#define CLEARCOAT":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.hatchPattern?"#define HATCH_PATTERN":"",n.mapInvert?"#define MAP_INVERT":"",n.useTiling?"#define USE_TILING":"",n.useTiling?"#define TILE_RANGE_X_MIN "+n.tilingRepeatRange[0]:"",n.useTiling?"#define TILE_RANGE_Y_MIN "+n.tilingRepeatRange[1]:"",n.useTiling?"#define TILE_RANGE_X_MAX "+n.tilingRepeatRange[2]:"",n.useTiling?"#define TILE_RANGE_Y_MAX "+n.tilingRepeatRange[3]:"",n.hasRoundCorner?"#define USE_TILING_NORMAL":"",n.useRandomOffset?"#define USE_TILING_RANDOM":"",k("map",n.mapClampS,n.mapClampT),k("bumpMap",n.bumpMapClampS,n.bumpMapClampT),k("normalMap",n.normalMapClampS,n.normalMapClampT),k("specularMap",n.specularMapClampS,n.specularMapClampT),k("alphaMap",n.alphaMapClampS,n.alphaMapClampT,n.alphaMapInvert),"#ifdef USE_ENVMAP","#ifdef HAVE_TEXTURE_LOD","#extension GL_EXT_shader_texture_lod : enable","#endif","#endif","#extension GL_OES_standard_derivatives : enable","precision "+n.precisionFragment+" float;","precision "+n.precisionFragment+" int;","uniform highp mat4 viewMatrix;","uniform highp mat4 projectionMatrix;","uniform highp vec3 cameraPosition;","#if defined(USE_ENVMAP) || defined(USE_IRRADIANCEMAP)","uniform mat4 viewMatrixInverse;","#endif",""].join("\n"),n.isPrism&&(x+=l(n)));var B=new d.WebGLShader(p,p.VERTEX_SHADER,w+t),C=new d.WebGLShader(p,p.FRAGMENT_SHADER,x+u);p.attachShader(A,B),p.attachShader(A,C),void 0!==v&&p.bindAttribLocation(A,0,v),p.linkProgram(A),"undefined"!=typeof DEBUG_SHADERS&&DEBUG_SHADERS&&(!1===p.getProgramParameter(A,p.LINK_STATUS)&&(g.error("THREE.WebGLProgram: Could not initialise shader."),g.error("gl.VALIDATE_STATUS",p.getProgramParameter(A,p.VALIDATE_STATUS)),g.error("gl.getError()",p.getError())),""!==p.getProgramInfoLog(A)&&g.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",p.getProgramInfoLog(A))),p.deleteShader(B),p.deleteShader(C);var D=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","viewMatrixInverse","mvpMatrix","dbId"];n.logarithmicDepthBuffer&&D.push("logDepthBufFC");for(var E in r)D.push(E);this.uniforms=c(p,A,D),D=["position","normal","uv","uv2","tangent","color","lineDistance","uvw","id","instOffset","instScaling","instRotation","prev","next","side"];for(var F in s)D.push(F);return this.attributes=f(p,A,D),this.attributesKeys=Object.keys(this.attributes),this.id=a++,this.code=j,this.usedTimes=1,this.program=A,this.vertexShader=B,this.fragmentShader=C,this}}()},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){var b=a+"_texMatrix",c=a+"_invert",d={};return d[a]={type:"t",value:null},d[b]={type:"m3",value:new h.Matrix3},d[c]={type:"i",value:0},d}function f(a){var b=a+"_texMatrix",c=a+"_bumpScale",d=a+"_bumpmapType",e={};return e[a]={type:"t",value:null},e[b]={type:"m3",value:new h.Matrix3},e[c]={type:"v2",value:new h.Vector2(1,1)},e[d]={type:"i",value:0},e}Object.defineProperty(b,"__esModule",{value:!0}),b.clonePrismMaterial=b.createPrismMaterial=b.PrismShader=void 0,b.GetPrismMapUniforms=e;var g=c(2),h=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(g),i=c(58),j=c(40),k=c(102),l=d(k),m=c(103),n=d(m),o=b.PrismShader={uniforms:h.UniformsUtils.merge([h.UniformsLib.common,h.UniformsLib.lights,h.UniformsLib.fog,i.ShaderChunks.CutPlanesUniforms,i.ShaderChunks.IdUniforms,i.ShaderChunks.ThemingUniform,i.ShaderChunks.ShadowMapUniforms,e("surface_albedo_map"),e("surface_roughness_map"),e("surface_cutout_map"),e("surface_anisotropy_map"),e("surface_rotation_map"),e("opaque_albedo_map"),e("opaque_f0_map"),e("opaque_luminance_modifier_map"),e("layered_bottom_f0_map"),e("layered_f0_map"),e("layered_diffuse_map"),e("layered_fraction_map"),e("layered_roughness_map"),e("layered_anisotropy_map"),e("layered_rotation_map"),e("metal_f0_map"),e("wood_curly_distortion_map"),e("glazing_f0_map"),e("glazing_transmission_color_map"),e("glazing_transmission_roughness_map"),f("surface_normal_map"),f("layered_normal_map"),e("TilingMap"),e("TilingNormalMap"),e("TilingRandomMap"),{surface_albedo:{type:"c",value:new h.Color(1118481)},surface_roughness:{type:"f",value:1},surface_anisotropy:{type:"f",value:1},surface_rotation:{type:"f",value:1},opaque_albedo:{type:"c",value:new h.Color(1118481)},opaque_f0:{type:"f",value:1},opaque_luminance_modifier:{type:"c",value:new h.Color(1118481)},opaque_luminance:{type:"f",value:1},metal_f0:{type:"c",value:new h.Color(1118481)},layered_f0:{type:"f",value:1},layered_diffuse:{type:"c",value:new h.Color(0)},layered_fraction:{type:"f",value:1},layered_bottom_f0:{type:"c",value:new h.Color(1118481)},layered_roughness:{type:"f",value:1},layered_anisotropy:{type:"f",value:1},layered_rotation:{type:"f",value:1},transparent_ior:{type:"f",value:2},transparent_color:{type:"c",value:new h.Color(1118481)},transparent_distance:{type:"f",value:1},glazing_f0:{type:"c",value:new h.Color(16777215)},glazing_transmission_roughness:{type:"f",value:0},glazing_transmission_color:{type:"c",value:new h.Color(16777215)},wood_fiber_cosine_enable:{type:"i",value:1},wood_fiber_cosine_bands:{type:"i",value:2},wood_fiber_cosine_weights:{type:"v4",value:new h.Vector4(2.5,.5,1,1)},wood_fiber_cosine_frequencies:{type:"v4",value:new h.Vector4(15,4,1,1)},wood_fiber_perlin_enable:{type:"i",value:1},wood_fiber_perlin_bands:{type:"i",value:3},wood_fiber_perlin_weights:{type:"v4",value:new h.Vector4(3,1,.2,1)},wood_fiber_perlin_frequencies:{type:"v4",value:new h.Vector4(40,20,3.5,1)},wood_fiber_perlin_scale_z:{type:"f",value:.3},wood_growth_perlin_enable:{type:"i",value:1},wood_growth_perlin_bands:{type:"i",value:3},wood_growth_perlin_weights:{type:"v4",value:new h.Vector4(1,2,1,1)},wood_growth_perlin_frequencies:{type:"v4",value:new h.Vector4(1,5,13,1)},wood_latewood_ratio:{type:"f",value:.238},wood_earlywood_sharpness:{type:"f",value:.395},wood_latewood_sharpness:{type:"f",value:.109},wood_ring_thickness:{type:"f",value:.75},wood_earlycolor_perlin_enable:{type:"i",value:1},wood_earlycolor_perlin_bands:{type:"i",value:2},wood_earlycolor_perlin_weights:{type:"v4",value:new h.Vector4(.3,.5,.15,1)},wood_earlycolor_perlin_frequencies:{type:"v4",value:new h.Vector4(8,3,.35,1)},wood_early_color:{type:"c",value:new h.Color(.286,.157,.076)},wood_use_manual_late_color:{type:"i",value:0},wood_manual_late_color:{type:"c",value:new h.Color(.62,.35,.127)},wood_latecolor_perlin_enable:{type:"i",value:1},wood_latecolor_perlin_bands:{type:"i",value:1},wood_latecolor_perlin_weights:{type:"v4",value:new h.Vector4(.75,.55,1,1)},wood_latecolor_perlin_frequencies:{type:"v4",value:new h.Vector4(4.5,.05,1,1)},wood_late_color_power:{type:"f",value:1.25},wood_diffuse_perlin_enable:{type:"i",value:1},wood_diffuse_perlin_bands:{type:"i",value:3},wood_diffuse_perlin_weights:{type:"v4",value:new h.Vector4(.15,.2,.05,1)},wood_diffuse_perlin_frequencies:{type:"v4",value:new h.Vector4(.05,.1,3,1)},wood_diffuse_perlin_scale_z:{type:"f",value:.2},wood_use_pores:{type:"i",value:1},wood_pore_type:{type:"i",value:0},wood_pore_radius:{type:"f",value:.04},wood_pore_cell_dim:{type:"f",value:.15},wood_pore_color_power:{type:"f",value:1.45},wood_pore_depth:{type:"f",value:.02},wood_use_rays:{type:"i",value:1},wood_ray_color_power:{type:"f",value:1.1},wood_ray_seg_length_z:{type:"f",value:5},wood_ray_num_slices:{type:"f",value:160},wood_ray_ellipse_z2x:{type:"f",value:10},wood_ray_ellipse_radius_x:{type:"f",value:.2},wood_use_latewood_bump:{type:"i",value:1},wood_latewood_bump_depth:{type:"f",value:.01},wood_use_groove_roughness:{type:"i",value:1},wood_groove_roughness:{type:"f",value:.85},wood_diffuse_lobe_weight:{type:"f",value:.9},wood_curly_distortion_enable:{type:"i",value:0},wood_curly_distortion_scale:{type:"f",value:.25},wood_ring_fraction:{type:"v4",value:new h.Vector4(0,0,0,0)},wood_fall_rise:{type:"v2",value:new h.Vector2(0,0)},permutationMap:{type:"t",value:null},gradientMap:{type:"t",value:null},perm2DMap:{type:"t",value:null},permGradMap:{type:"t",value:null},importantSamplingRandomMap:{type:"t",value:null},importantSamplingSolidAngleMap:{type:"t",value:null},irradianceMap:{type:"t",value:null},envMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1},envExponentMin:{type:"f",value:1},envExponentMax:{type:"f",value:512},envExponentCount:{type:"f",value:10},tilingOverallTransform:{type:"m4",value:new h.Matrix4},uv2tile:{type:"v4",value:new h.Vector4(1,0,0,1)},tile2uv:{type:"v4",value:new h.Vector4(1,0,0,1)},tileAlignOffset:{type:"v2",value:new h.Vector2(0,0)},tilingUVTransform:{type:"m4",value:new h.Matrix4},tilingRandomAxisS:{type:"v2",value:new h.Vector2(0,0)},tilingRandomAxisT:{type:"v2",value:new h.Vector2(0,0)},tilingRandomAlignmentOffset:{type:"v2",value:new h.Vector2(0,0)}}]),vertexShader:l.default,fragmentShader:n.default};h.ShaderLib.prism=o;var p=b.createPrismMaterial=function(){var a=(0,j.createShaderMaterial)(o);return a.defaultAttributeValues.uvw=[0,0,0],a.enable3DWoodBump=!1,a.enableImportantSampling=!1,a.mapList={},a.isPrismMaterial=!0,a};b.clonePrismMaterial=function(a){var b=p();switch(b.name=a.name,b.side=a.side,b.opacity=a.opacity,b.transparent=a.transparent,b.blending=a.blending,b.blendSrc=a.blendSrc,b.blendDst=a.blendDst,b.blendEquation=a.blendEquation,b.blendSrcAlpha=a.blendSrcAlpha,b.blendDstAlpha=a.blendDstAlpha,b.blendEquationAlpha=a.blendEquationAlpha,b.depthTest=a.depthTest,b.depthWrite=a.depthWrite,b.polygonOffset=a.polygonOffset,b.polygonOffsetFactor=a.polygonOffsetFactor,b.polygonOffsetUnits=a.polygonOffsetUnits,b.alphaTest=a.alphaTest,b.overdraw=a.overdraw,b.visible=a.visible,b.mapList=a.mapList,b.prismType=a.prismType,b.surface_albedo=a.surface_albedo,void 0!==a.surface_albedo_map&&(b.surface_albedo_map=a.surface_albedo_map),b.surface_roughness=a.surface_roughness,void 0!==a.surface_roughness_map&&(b.surface_roughness_map=a.surface_roughness_map),b.surface_anisotropy=a.surface_anisotropy,void 0!==a.surface_anisotropy_map&&(b.surface_anisotropy_map=a.surface_anisotropy_map),b.surface_rotation=a.surface_rotation,void 0!==a.surface_rotation_map&&(b.surface_rotation_map=a.surface_rotation_map),void 0!==a.surface_cutout_map&&(b.surface_cutout_map=a.surface_cutout_map),void 0!==a.surface_normal_map&&(b.surface_normal_map=a.surface_normal_map),b.uniforms.importantSamplingRandomMap.value=a.uniforms.importantSamplingRandomMap.value,b.uniforms.importantSamplingSolidAngleMap.value=a.uniforms.importantSamplingSolidAngleMap.value,b.prismType){case"PrismOpaque":b.opaque_albedo=(new h.Color).copy(a.opaque_albedo),b.opaque_luminance_modifier=(new h.Color).copy(a.opaque_luminance_modifier),b.opaque_f0=a.opaque_f0,b.opaque_luminance=a.opaque_luminance,void 0!==a.opaque_albedo_map&&(b.opaque_albedo_map=a.opaque_albedo_map),void 0!==a.opaque_luminance_modifier_map&&(b.opaque_luminance_modifier_map=a.opaque_luminance_modifier_map),void 0!==a.opaque_f0_map&&(b.opaque_f0_map=a.opaque_f0_map);break;case"PrismMetal":b.metal_f0=(new h.Color).copy(a.metal_f0),void 0!==a.metal_f0_map&&(b.metal_f0_map=a.metal_f0_map);break;case"PrismLayered":b.layered_f0=a.layered_f0,b.layered_diffuse=(new h.Color).copy(a.layered_diffuse),b.layered_fraction=a.layered_fraction,b.layered_bottom_f0=(new h.Color).copy(a.layered_bottom_f0),b.layered_roughness=a.layered_roughness,b.layered_anisotropy=a.layered_anisotropy,b.layered_rotation=a.layered_rotation,void 0!==a.layered_bottom_f0_map&&(b.layered_bottom_f0_map=a.layered_bottom_f0_map),void 0!==a.layered_f0_map&&(b.layered_f0_map=a.layered_f0_map),void 0!==a.layered_diffuse_map&&(b.layered_diffuse_map=a.layered_diffuse_map),void 0!==a.layered_fraction_map&&(b.layered_fraction_map=a.layered_fraction_map),void 0!==a.layered_rotationlayered_roughness_map&&(b.layered_rotationlayered_roughness_map=a.layered_rotationlayered_roughness_map),void 0!==a.layered_anisotropy_map&&(b.layered_anisotropy_map=a.layered_anisotropy_map),void 0!==a.layered_rotation_map&&(b.layered_rotation_map=a.layered_rotation_map),void 0!==a.layered_normal_map&&(b.layered_normal_map=a.layered_normal_map);break;case"PrismTransparent":b.transparent_color=(new h.Color).copy(a.transparent_color),b.transparent_distance=a.transparent_distance,b.transparent_ior=a.transparent_ior,b.transparent=a.transparent,b.twoPassTransparency=a.twoPassTransparency;break;case"PrismGlazing":b.glazing_f0=(new h.Color).copy(a.glazing_f0),b.glazing_transmission_color=(new h.Color).copy(a.glazing_transmission_color),b.glazing_transmission_roughness=a.glazing_transmission_roughness,void 0!==a.glazing_f0_map&&(b.glazing_f0_map=a.glazing_f0_map),void 0!==a.glazing_transmission_color_map&&(b.glazing_transmission_color_map=a.glazing_transmission_color_map),void 0!==a.glazing_transmission_roughness_map&&(b.glazing_transmission_roughness_map=a.glazing_transmission_roughness_map);break;case"PrismWood":b.wood_fiber_cosine_enable=a.wood_fiber_cosine_enable,b.wood_fiber_cosine_bands=a.wood_fiber_cosine_bands,b.wood_fiber_cosine_weights=(new h.Vector4).copy(a.wood_fiber_cosine_weights),b.wood_fiber_cosine_frequencies=(new h.Vector4).copy(a.wood_fiber_cosine_frequencies),b.wood_fiber_perlin_enable=a.wood_fiber_perlin_enable,b.wood_fiber_perlin_bands=a.wood_fiber_perlin_bands,b.wood_fiber_perlin_weights=(new h.Vector4).copy(a.wood_fiber_perlin_weights),b.wood_fiber_perlin_frequencies=(new h.Vector4).copy(a.wood_fiber_perlin_frequencies),b.wood_fiber_perlin_scale_z=a.wood_fiber_perlin_scale_z,b.wood_growth_perlin_enable=a.wood_growth_perlin_enable,b.wood_growth_perlin_bands=a.wood_growth_perlin_bands,b.wood_growth_perlin_weights=(new h.Vector4).copy(a.wood_growth_perlin_weights),b.wood_growth_perlin_frequencies=(new h.Vector4).copy(a.wood_growth_perlin_frequencies),b.wood_latewood_ratio=a.wood_latewood_ratio,b.wood_earlywood_sharpness=a.wood_earlywood_sharpness,b.wood_latewood_sharpness=a.wood_latewood_sharpness,b.wood_ring_thickness=a.wood_ring_thickness,b.wood_earlycolor_perlin_enable=a.wood_earlycolor_perlin_enable,b.wood_earlycolor_perlin_bands=a.wood_earlycolor_perlin_bands,b.wood_earlycolor_perlin_weights=(new h.Vector4).copy(a.wood_earlycolor_perlin_weights),b.wood_earlycolor_perlin_frequencies=(new h.Vector4).copy(a.wood_earlycolor_perlin_frequencies),b.wood_early_color=(new h.Color).copy(a.wood_early_color),b.wood_use_manual_late_color=a.wood_use_manual_late_color,b.wood_manual_late_color=(new h.Color).copy(a.wood_manual_late_color),b.wood_latecolor_perlin_enable=a.wood_latecolor_perlin_enable,b.wood_latecolor_perlin_bands=a.wood_latecolor_perlin_bands,b.wood_latecolor_perlin_weights=(new h.Vector4).copy(a.wood_latecolor_perlin_weights),b.wood_latecolor_perlin_frequencies=(new h.Vector4).copy(a.wood_latecolor_perlin_frequencies),b.wood_late_color_power=a.wood_late_color_power,b.wood_diffuse_perlin_enable=a.wood_diffuse_perlin_enable,b.wood_diffuse_perlin_bands=a.wood_diffuse_perlin_bands,b.wood_diffuse_perlin_weights=(new h.Vector4).copy(a.wood_diffuse_perlin_weights),b.wood_diffuse_perlin_frequencies=(new h.Vector4).copy(a.wood_diffuse_perlin_frequencies),b.wood_diffuse_perlin_scale_z=a.wood_diffuse_perlin_scale_z,b.wood_use_pores=a.wood_use_pores,b.wood_pore_type=a.wood_pore_type,b.wood_pore_radius=a.wood_pore_radius,b.wood_pore_cell_dim=a.wood_pore_cell_dim,b.wood_pore_color_power=a.wood_pore_color_power,b.wood_pore_depth=a.wood_pore_depth,b.wood_use_rays=a.wood_use_rays,b.wood_ray_color_power=a.wood_ray_color_power,b.wood_ray_seg_length_z=a.wood_ray_seg_length_z,b.wood_ray_num_slices=a.wood_ray_num_slices,b.wood_ray_ellipse_z2x=a.wood_ray_ellipse_z2x,b.wood_ray_ellipse_radius_x=a.wood_ray_ellipse_radius_x,b.wood_use_latewood_bump=a.wood_use_latewood_bump,b.wood_latewood_bump_depth=a.wood_latewood_bump_depth,b.wood_use_groove_roughness=a.wood_use_groove_roughness,b.wood_groove_roughness=a.wood_groove_roughness,b.wood_diffuse_lobe_weight=a.wood_diffuse_lobe_weight,b.uniforms.permutationMap.value=a.uniforms.permutationMap.value,b.uniforms.gradientMap.value=a.uniforms.gradientMap.value,b.uniforms.perm2DMap.value=a.uniforms.perm2DMap.value,b.uniforms.permGradMap.value=a.uniforms.permGradMap.value,void 0!==a.wood_curly_distortion_map&&(b.wood_curly_distortion_map=a.wood_curly_distortion_map,b.wood_curly_distortion_enable=a.wood_curly_distortion_enable,b.wood_curly_distortion_scale=a.wood_curly_distortion_scale),b.wood_ring_fraction=a.wood_ring_fraction,b.wood_fall_rise=a.wood_fall_rise;break;default:h.warn("Unknown prism type: "+a.prismType)}return b.envExponentMin=a.envExponentMin,b.envExponentMax=a.envExponentMax,b.envExponentCount=a.envExponentCount,b.envMap=a.envMap,a.useTiling&&(b.useTiling=a.useTiling,b.tilingOverallTransform=(new h.Matrix4).copy(a.tilingOverallTransform),b.TilingMap=a.TilingMap,b.TilingMap_texMatrix=(new h.Matrix3).copy(a.TilingMap_texMatrix),b.hasRoundCorner=a.hasRoundCorner,b.hasRoundCorner&&(b.TilingNormalMap=a.TilingNormalMap,b.TilingNormalMap_texMatrix=(new h.Matrix3).copy(a.TilingNormalMap_texMatrix)),b.useRandomOffset=a.useRandomOffset,b.useRandomOffset&&(b.TilingRandomMap=a.TilingRandomMap,b.TilingRandomMap_texMatrix=(new h.Matrix3).copy(a.TilingRandomMap_texMatrix),b.tilingRandomAxisS=(new h.Vector2).copy(a.tilingRandomAxisS),b.tilingRandomAxisT=(new h.Vector2).copy(a.tilingRandomAxisT),b.tilingRandomAlignmentOffset=(new h.Vector2).copy(a.tilingRandomAlignmentOffset)),b.uv2tile=a.uv2tile,b.tile2uv=a.tile2uv,b.tilingRepeatRange=[a.tilingRepeatRange[0],a.tilingRepeatRange[1],a.tilingRepeatRange[2],a.tilingRepeatRange[3]],b.tileAlignOffset=(new h.Vector2).copy(a.tileAlignOffset),b.tilingUVTransform=(new h.Matrix4).copy(a.tilingUVTransform)),b.defines=a.defines,b}},function(a,b){a.exports="varying vec3 vViewPosition;\nvarying vec3 vNormal;\n#if defined(PRISMWOOD) && !defined(NO_UVW)\nvarying vec3 vUvw;\n#if defined(PRISMWOODBUMP)\nvarying vec3 vtNormal;\nvarying mat3 mNormalMatrix;\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#prism_check<USE_MAP>\n#if defined(USE_MAP) || defined(USE_TILING)\nvarying vec2 vUv;\n#endif\n#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#ifdef MRT_NORMALS\nvarying float depth;\n#endif\n#include<pack_normals>\n#include<instancing_decl_vert>\n#include<id_decl_vert>\n#include<shadowmap_decl_vert>\n#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0) || defined( PRISMWOODBUMP )\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\nvoid ComputeTangents(vec3 normal, out vec3 u, out vec3 v)\n{\n    float scale = normal.z < 0.0 ? -1.0 : 1.0;\n    vec3 temp = scale * normal;\n    float e    = temp.z;\n    float h    = 1.0/(1.0 + e);\n    float hvx  = h   *  temp.y;\n    float hvxy = hvx * -temp.x;\n    u = vec3(e + hvx * temp.y, hvxy,                -temp.x);\n    v = vec3(hvxy,             e + h * temp.x * temp.x, -temp.y);\n    u *= scale;\n    v *= scale;\n}\n#endif\nvoid main() {\n#if defined(USE_MAP) || defined(USE_TILING)\n    vUv = uv;\n#endif\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n#if defined(PRISMWOOD) && !defined(NO_UVW)\n#if defined(PRISMWOODBUMP)\n    vUvw = instPos;\n    vtNormal = normalize(objectNormal);\n    mNormalMatrix = normalMatrix;\n#else\n    vUvw = uvw;\n#endif\n#endif\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    vNormal = normalize( transformedNormal );\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n    vViewPosition = -mvPosition.xyz;\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0) || defined ( PRISMWOODBUMP )\n    vec3 Tu, Tv;\n#if defined(PRISMWOODBUMP)\n    ComputeTangents(vtNormal, Tu, Tv);\n#else\n    ComputeTangents(vNormal, Tu, Tv);\n#endif\n    vTangent = Tu;\n    vBitangent = Tv;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    if (projectionMatrix[3][3] == 0.0) {\n        gl_Position.z = log2(max(1.0e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + gl_Position.w;\n#else\n        gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n    } else {\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + vViewPosition.z;\n#else\n#endif\n    }\n#endif\n#ifdef MRT_NORMALS\n    depth = mvPosition.z;\n#endif\n#include<id_vert>\n#include<shadowmap_vert>\n}\n"},function(a,b){
a.exports="\n#include<common>\n#define RECIPROCAL_PI 0.318309886\n#define ONE 0.00390625\nuniform float opacity;\nuniform vec3 surface_albedo;\nuniform float surface_roughness;\nuniform float surface_anisotropy;\nuniform float surface_rotation;\nuniform sampler2D importantSamplingRandomMap;\nuniform sampler2D importantSamplingSolidAngleMap;\n#if defined( PRISMOPAQUE )\nuniform vec3 opaque_albedo;\nuniform float opaque_f0;\nuniform vec3 opaque_luminance_modifier;\nuniform float opaque_luminance;\n#elif defined( PRISMMETAL )\nuniform vec3 metal_f0;\n#elif defined( PRISMLAYERED )\nuniform float layered_f0;\nuniform vec3 layered_diffuse;\nuniform float layered_fraction;\nuniform vec3 layered_bottom_f0;\nuniform float layered_roughness;\nuniform float layered_anisotropy;\nuniform float layered_rotation;\n#elif defined( PRISMTRANSPARENT )\nuniform float transparent_ior;\nuniform vec3 transparent_color;\nuniform float transparent_distance;\n#elif defined( PRISMGLAZING )\nuniform vec3 glazing_f0;\nuniform vec3 glazing_transmission_color;\nuniform float glazing_transmission_roughness;\n#elif defined( PRISMWOOD )\nuniform bool wood_fiber_cosine_enable;\nuniform int wood_fiber_cosine_bands;\nuniform vec4 wood_fiber_cosine_weights;\nuniform vec4 wood_fiber_cosine_frequencies;\nuniform bool wood_fiber_perlin_enable;\nuniform int wood_fiber_perlin_bands;\nuniform vec4 wood_fiber_perlin_weights;\nuniform vec4 wood_fiber_perlin_frequencies;\nuniform float wood_fiber_perlin_scale_z;\nuniform bool wood_growth_perlin_enable;\nuniform int wood_growth_perlin_bands;\nuniform vec4 wood_growth_perlin_weights;\nuniform vec4 wood_growth_perlin_frequencies;\nuniform float wood_latewood_ratio;\nuniform float wood_earlywood_sharpness;\nuniform float wood_latewood_sharpness;\nuniform float wood_ring_thickness;\nuniform bool wood_earlycolor_perlin_enable;\nuniform int wood_earlycolor_perlin_bands;\nuniform vec4 wood_earlycolor_perlin_weights;\nuniform vec4 wood_earlycolor_perlin_frequencies;\nuniform vec3 wood_early_color;\nuniform bool wood_use_manual_late_color;\nuniform vec3 wood_manual_late_color;\nuniform bool wood_latecolor_perlin_enable;\nuniform int wood_latecolor_perlin_bands;\nuniform vec4 wood_latecolor_perlin_weights;\nuniform vec4 wood_latecolor_perlin_frequencies;\nuniform float wood_late_color_power;\nuniform bool wood_diffuse_perlin_enable;\nuniform int wood_diffuse_perlin_bands;\nuniform vec4 wood_diffuse_perlin_weights;\nuniform vec4 wood_diffuse_perlin_frequencies;\nuniform float wood_diffuse_perlin_scale_z;\nuniform bool wood_use_pores;\nuniform int wood_pore_type;\nuniform float wood_pore_radius;\nuniform float wood_pore_cell_dim;\nuniform float wood_pore_color_power;\nuniform float wood_pore_depth;\nuniform bool wood_use_rays;\nuniform float wood_ray_color_power;\nuniform float wood_ray_seg_length_z;\nuniform float wood_ray_num_slices;\nuniform float wood_ray_ellipse_z2x;\nuniform float wood_ray_ellipse_radius_x;\nuniform bool wood_use_latewood_bump;\nuniform float wood_latewood_bump_depth;\nuniform bool wood_use_groove_roughness;\nuniform float wood_groove_roughness;\nuniform float wood_diffuse_lobe_weight;\nuniform sampler2D permutationMap;\nuniform sampler2D gradientMap;\nuniform sampler2D perm2DMap;\nuniform sampler2D permGradMap;\nuniform vec4 wood_ring_fraction;\nuniform vec2 wood_fall_rise;\n#endif\n#ifdef USE_TILING\nuniform mat4 tilingOverallTransform;\nuniform sampler2D TilingMap;\nuniform mat3 TilingMap_texMatrix;\nuniform vec4 uv2tile;\nuniform vec4 tile2uv;\nuniform vec2 tileAlignOffset;\nuniform mat4 tilingUVTransform;\n#ifdef USE_TILING_NORMAL\nuniform sampler2D TilingNormalMap;\nuniform mat3 TilingNormalMap_texMatrix;\n#endif\n#ifdef USE_TILING_RANDOM\nuniform sampler2D TilingRandomMap;\nuniform mat3 TilingRandomMap_texMatrix;\nuniform vec2 tilingRandomAxisS;\nuniform vec2 tilingRandomAxisT;\nuniform vec2 tilingRandomAlignmentOffset;\n#endif\n#endif\nuniform float envExponentMin;\nuniform float envExponentMax;\nuniform float envExponentCount;\n#include<env_sample>\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\n#include<tonemap>\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#ifdef USE_LOGDEPTHBUF\nuniform float logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n#extension GL_EXT_frag_depth : enable\nvarying highp float vFragDepth;\n#endif\n#endif\n#include<id_decl_frag>\n#include<theming_decl_frag>\n#include<shadowmap_decl_frag>\n#ifdef USE_FOG\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#prism_check<USE_MAP>\n#if defined(USE_MAP) || defined(USE_TILING)\nvarying vec2 vUv;\n#endif\n#if defined(PRISMWOOD) && !defined(NO_UVW)\nvarying vec3 vUvw;\n#endif\n#prism_uniforms<surface_albedo_map>\n#prism_uniforms<surface_roughness_map>\n#prism_uniforms<surface_cutout_map>\n#prism_uniforms<surface_anisotropy_map>\n#prism_uniforms<surface_rotation_map>\n#prism_uniforms<opaque_albedo_map>\n#prism_uniforms<opaque_f0_map>\n#prism_uniforms<opaque_luminance_modifier_map>\n#prism_uniforms<layered_bottom_f0_map>\n#prism_uniforms<layered_f0_map>\n#prism_uniforms<layered_diffuse_map>\n#prism_uniforms<layered_fraction_map>\n#prism_uniforms<layered_roughness_map>\n#prism_uniforms<layered_anisotropy_map>\n#prism_uniforms<layered_rotation_map>\n#prism_uniforms<metal_f0_map>\n#prism_uniforms<glazing_f0_map>\n#prism_uniforms<glazing_transmission_roughness_map>\n#prism_uniforms<glazing_transmission_color_map>\n#prism_uniforms<wood_curly_distortion_map>\n#if defined( USE_WOOD_CURLY_DISTORTION_MAP )\nuniform bool wood_curly_distortion_enable;\nuniform float wood_curly_distortion_scale;\n#endif\n#prism_bump_uniforms<surface_normal_map>\n#prism_bump_uniforms<layered_normal_map>\nfloat SRGBToLinearComponent(float color) {\n    float result = color;\n    if (result<=0.04045)\n        result *= 0.07739938;\n    else\n        result = pow(abs((result+0.055)*0.947867298), 2.4);\n    return result;\n}\nvec3 SRGBToLinear(vec3 color) {\n    vec3 result = color;\n    result.x = SRGBToLinearComponent(result.x);\n    result.y = SRGBToLinearComponent(result.y);\n    result.z = SRGBToLinearComponent(result.z);\n    return result;\n}\n#if defined( USE_ENVMAP )\nuniform float envMapExposure;\nuniform samplerCube envMap;\n#endif\n#include<normal_map>\n#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0) || defined ( PRISMWOODBUMP )\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\n#if defined( PRISMWOODBUMP )\nvarying vec3 vtNormal;\nvarying mat3 mNormalMatrix;\n#endif\n#endif\n#if defined( USE_ENVMAP )\nvec3 sampleReflection(vec3 N, vec3 V, float mipIndex) {\n    vec3 dir = (2.0 * dot(V, N)) * N - V;\n    dir = adjustLookupVector(mat3(viewMatrixInverse) * dir);\n#ifdef ENV_GAMMA\n#ifdef HAVE_TEXTURE_LOD\n    vec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );\n#else\n    vec4 envTexColor = textureCube( envMap, dir, mipIndex );\n#endif\n    return GammaDecode(envTexColor, envMapExposure);\n#elif defined(ENV_RGBM)\n#ifdef HAVE_TEXTURE_LOD\n    vec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );\n#else\n    vec4 envTexColor = textureCube( envMap, dir, mipIndex );\n#endif\n    return RGBMDecode(envTexColor, envMapExposure);\n#else\n    vec4 envTexColor = textureCube( envMap, dir );\n    vec3 cubeColor = envTexColor.xyz;\n#ifdef GAMMA_INPUT\n    cubeColor *= cubeColor;\n#endif\n    return cubeColor;\n#endif\n}\n#endif\n#include<hatch_pattern>\n#if defined( USE_ENVMAP ) && defined( USE_IRRADIANCEMAP )\nuniform samplerCube irradianceMap;\nvec3 sampleNormal(vec3 normal) {\n    vec3 worldNormal = mat3(viewMatrixInverse) * normal;\n    vec3 irradiance = sampleIrradianceMap(worldNormal, irradianceMap, envMapExposure);\n    irradiance = applyEnvShadow(irradiance, worldNormal);\n    return irradiance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\nfloat sqr(float x) {return x*x;}\nfloat aSqrd(float maxAlphaSqr, float cosTheta)\n{\n    if (abs(cosTheta) < 1e-10)\n    {\n        return 1e10;\n    }\n    float tan2 = 1.0/sqr(cosTheta) - 1.0;\n    return maxAlphaSqr * tan2;\n}\nvec3 Fresnel_Schlick(vec3 f0, float cosAngle)\n{\n    float x = 1.0 - cosAngle;\n    float x2 = x * x;\n    float x5 = x * x2 * x2;\n    return f0 + (1.0 - f0) * x5;\n}\nvec3 Fresnel_Rough(vec3 f0, float cosAngle, float alpha)\n{\n    float x = 1.0 - cosAngle;\n    float x2 = x * x;\n    float x5 = x * x2 * x2;\n    vec3 maxReflectance = mix(vec3(1.0), f0, vec3(min(0.7, alpha)) / 0.7);\n    return f0 + (maxReflectance - f0) * x5;\n}\nfloat IORToReflectance(float ior)\n{\n    return sqr((1.0 - ior)/(1.0 + ior));\n}\nvec2 RoughnessToAlpha(float roughness, float anisotropy)\n{\n    vec2 alpha = roughness * vec2(1.0, 1.0 - anisotropy);\n    alpha = alpha * alpha;\n    alpha = clamp(alpha, 0.001, 1.0);\n    return alpha;\n}\nfloat AlphaToPhong(float alpha)\n{\n    return max(0.0, 2.56/alpha - 7.0);\n}\nfloat ExponentToReflMipIndex(float exponent)\n{\n    float targetLog = log2(exponent);\n    float minLog = log2(envExponentMin);\n    float maxLog = log2(envExponentMax);\n    float deltaLog = clamp(targetLog - minLog, 0.0, maxLog - minLog);\n    float level = clamp((1.0-(deltaLog + 0.5) / envExponentCount), 0.0, 1.0) * 6.0;\n    return level;\n}\n#include<prism_wood>\n#if defined( ENABLEIMPORTANTSAMPLING ) && (defined( USE_SURFACE_ROTATION_MAP ) || defined( USE_SURFACE_ANISOTROPY_MAP ) || defined( USE_LAYERED_ROTATION_MAP ) || defined( USE_LAYERED_ANISOTROPY_MAP ))\n#define IMPORTANTSAMPLING\n#endif\n#if defined( IMPORTANTSAMPLING )\n#define SAMPLECOUNT 32\nvec2 Hammersley(int index)\n{\n    float u = (float(index) + 0.5) / 32.0;\n    float v = 0.5;\n    float noise = texture2D(importantSamplingRandomMap, vec2(u, v), 0.0).r;\n   return vec2(2.0 * PI * float(index/SAMPLECOUNT), noise);\n}\nvec3 ImportanceSampleAnisotropicGGX(int index, vec2 alpha, vec3 N, vec3 Tu, vec3 Tv)\n{\n    vec2 uniformSample2D = Hammersley(index);\n    float coef = sqrt(uniformSample2D.y / (1.0 - uniformSample2D.y));\n    float sinSigma, cosSigma;\n    sinSigma = sin(uniformSample2D.x);\n    cosSigma = cos(uniformSample2D.x);\n    vec3 H = coef * ((alpha.x * cosSigma) * Tu + (alpha.y * sinSigma) * Tv) + N;\n    H = normalize(H);\n    return H;\n}\nfloat ComputePDF(vec2 alpha, float NdotH, float HdotTu, float HdotTv, float VdotH)\n{\n    float factor1 = HdotTu / alpha.x;\n    float factor2 = HdotTv / alpha.y;\n    float factor3 = factor1 * factor1 + factor2 * factor2 + NdotH * NdotH;\n    float factor = factor3 * factor3 * alpha.x * alpha.y * VdotH * 4.0 * PI;\n    if (factor > 0.0)\n    {\n        return (NdotH / factor);\n    }\n    else\n    {\n        return 0.0;\n    }\n}\n#define INVFACESIZE 0.0078125\nfloat DirectionToSolidAngle(vec3 dir)\n{\n    dir = abs(dir);\n    float first = min(dir.x, dir.y);\n    float temp = max(dir.x, dir.y);\n    float second = min(temp, dir.z);\n    float third = max(temp, dir.z);\n    first /= third;\n    second /= third;\n    float u = (first+1.0)/2.0;\n    float v = (second + 1.0) / 2.0;\n    float solidAngle = texture2D(importantSamplingSolidAngleMap, vec2(u, v), 0.0).r * 0.000255;\n    return solidAngle;\n}\nfloat Smith_GGX(float value)\n{\n    return 2.0 / (1.0 + sqrt(1.0 + value));\n}\nvec2 RoughnessAnisotropyToAlpha(float roughness, float anisotropy)\n{\n    float aspect = sqrt(1.0 - 0.9 * anisotropy);\n    vec2 alpha = vec2(roughness * roughness / aspect, roughness * roughness * aspect);\n    return alpha;\n}\nvec3 ImportanceSamplingSpecular(float angle, vec3 reflectance, float roughness, float anisotropy, vec3 V, vec3 N, vec3 Tu, vec3 Tv)\n{\n    vec3 specular = vec3(0.0);\n    float radAngle;\n    if (anisotropy < 1e-10)\n    {\n        radAngle = 0.0;\n    }\n    else\n    {\n        radAngle = -PI * angle;\n    }\n    vec2 alpha = RoughnessAnisotropyToAlpha(roughness, anisotropy);\n    float alpha2 = max(alpha.x * alpha.x, alpha.y * alpha.y);\n    float NdotV = dot(N, V);\n    float alpha2NV = aSqrd(alpha2, NdotV);\n    vec2 sincosTheta;\n    sincosTheta.x = sin(radAngle);\n    sincosTheta.y = cos(radAngle);\n    vec3 Tu1, Tv1;\n    Tu1 = sincosTheta.y * Tu - sincosTheta.x * Tv;\n    Tv1 = sincosTheta.x * Tu + sincosTheta.y * Tv;\n    vec3 H;\n    vec3 sampleLightIntensity;\n    vec3 L;\n    float effectiveSample = 0.0;\n    for (int i = 0; i < SAMPLECOUNT; i++)\n    {\n        H = ImportanceSampleAnisotropicGGX(i, alpha, N, Tu1, Tv1);\n        float VdotH = dot(V, H);\n        L = 2.0 * VdotH * H - V;\n        float NdotH = dot(N, H);\n        float NdotL = dot(N, L);\n        if (NdotL >= 0.0 && NdotV > 0.0 && NdotH > 0.0)\n        {\n            float alpha2NL = aSqrd(alpha2, NdotL);\n            float HdotTu = dot(H, Tu1);\n            float HdotTv = dot(H, Tv1);\n            float pdf = ComputePDF(alpha, NdotH, HdotTu, HdotTv, VdotH);\n            float mipmapLevel = 0.0;\n            if (pdf > 0.0)\n            {\n                mipmapLevel = 0.3 * log2(1.0 / (float(SAMPLECOUNT) * pdf * DirectionToSolidAngle(L)));\n            }\n            mipmapLevel = clamp(mipmapLevel, 0.0, 4.0);\n            L = normalize(L);\n            sampleLightIntensity = sampleReflection(L, L, mipmapLevel).rgb;\n            float G = Smith_GGX(alpha2NL) * Smith_GGX(alpha2NV);\n            vec3 F = Fresnel_Schlick(reflectance, VdotH);\n            float factor = G * VdotH / (NdotH * NdotV);\n            if (factor >= 0.0)\n            {\n                specular += abs(sampleLightIntensity * F * factor);\n                effectiveSample += 1.0;\n            }\n        }\n    }\n    if (effectiveSample > 0.0)\n    {\n        specular /= effectiveSample;\n    }\n    return specular;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0\nvec3 DiffuseLobe(vec3 diffuseColor)\n{\n    return diffuseColor * RECIPROCAL_PI;\n}\nvec3 Rotate(vec3 vec, float angle)\n{\n    float s = sin(angle);\n    float c = cos(angle);\n    return vec3(vec.x * c - vec.y * s, vec.x * s + vec.y * c, vec.z);\n}\nfloat NDF_GGX(float alphaU, float alphaV, vec3 normal)\n{\n    float nx2 = sqr(normal.x);\n    float ny2 = sqr(normal.y);\n    float nz2 = sqr(normal.z);\n    float scale = 1.0/(alphaU * alphaV * PI);\n    return scale/sqr(nx2/sqr(alphaU) + ny2/sqr(alphaV) + nz2);\n}\nfloat G1_GGX(float aSqrd)\n{\n    return 2.0 / (1.0 + sqrt(1.0 + aSqrd));\n}\nvec3 MicrofacetLobe(\n        vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        float roughness, float anisotropy, float rotation, vec3 reflectance)\n{\n    vec2 alpha = RoughnessToAlpha(roughness, anisotropy);\n    Hlocal = Rotate(Hlocal, rotation);\n    vec3 F = Fresnel_Schlick(reflectance, VdotH);\n    float D = NDF_GGX(alpha.x, alpha.y, Hlocal);\n    float alpha2 = max(sqr(alpha.x), sqr(alpha.y));\n    float alpha2NL = aSqrd(alpha2, NdotL);\n    float alpha2NV = aSqrd(alpha2, NdotV);\n    float G = G1_GGX(alpha2NL) * G1_GGX(alpha2NV);\n    return max(F * D * G / (4.0 * NdotL * NdotV), vec3(0.0));\n}\n#if defined( PRISMOPAQUE )\nvec3 BRDF_Opaque(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        float opaqueF0, vec3 opaqueAlbedo)\n{\n    vec3 diffuse = DiffuseLobe(opaqueAlbedo);\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, vec3(opaqueF0));\n    return (specular+diffuse)*NdotL;\n}\n#elif defined( PRISMMETAL )\nvec3 BRDF_Metal(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        vec3 metalF0)\n{\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, metalF0);\n    return specular*NdotL;\n}\n#elif defined( PRISMLAYERED )\nvec3 BRDF_Layered(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 Hlocal2, float N2dotL, float N2dotH, float N2dotV,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        float layeredF0, vec3 layeredDiffuse, float layeredRoughness, float layeredAnisotropy,\n        float layeredRotation, vec3 bottom_f0, float layeredFraction)\n{\n    vec3 Fl = Fresnel_Schlick(vec3(layeredF0), NdotL);\n    vec3 Fv = Fresnel_Schlick(vec3(layeredF0), NdotV);\n    vec3 amount = (1.0 - Fl) * (1.0 - Fv);\n    vec3 topSpecular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n            vec3(layeredF0));\n    vec3 topDiffuse = DiffuseLobe(layeredDiffuse);\n    vec3 botSpecular = MicrofacetLobe(\n            Hlocal2, N2dotL, N2dotH, N2dotV, VdotH,\n            layeredRoughness, layeredAnisotropy, layeredRotation,\n            bottom_f0);\n    return topSpecular*NdotL + amount * mix(topDiffuse*NdotL, botSpecular*N2dotL, layeredFraction);\n}\n#elif defined( PRISMTRANSPARENT )\nvec3 BRDF_Transparent(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation)\n{\n    vec3 reflectance = vec3(IORToReflectance(transparent_ior));\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, reflectance);\n    return specular*NdotL;\n}\n#elif defined( PRISMGLAZING )\nvec3 BRDF_Glazing(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        vec3 glazingF0, vec3 glazingTransmissionColor, float glazingIlluminance)\n{\n    vec3 diffuse = DiffuseLobe(glazingTransmissionColor - vec3(glazingIlluminance, glazingIlluminance, glazingIlluminance));\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, glazingF0);\n    return (specular+diffuse)*NdotL;\n}\n#elif defined( PRISMWOOD )\nvec3 BRDF_Wood(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, vec3 woodDiffuse)\n{\n    vec3 diffuse = DiffuseLobe(woodDiffuse);\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, 0.0, 0.0, vec3(0.04));\n    return (specular+diffuse)*NdotL;\n}\n#endif\n#endif\n#if defined( USE_ENVMAP )\n#if defined( PRISMOPAQUE )\nvec3 Environment_Opaque(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness,\n        float opaqueF0, vec3 opaqueAlbedo, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 T)\n{\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = Fresnel_Rough(vec3(opaqueF0), NdotV, alpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, vec3(opaqueF0), surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F* surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 diffuse = (1.0 - F) * opaqueAlbedo * envIrradiance;\n    return diffuse + specular;\n}\n#elif defined( PRISMMETAL )\nvec3 Environment_Metal(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, vec3 metalF0, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv)\n{\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, metalF0, surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 F = Fresnel_Rough(metalF0, NdotV, alpha);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n#endif\n    return specular;\n}\n#elif defined( PRISMLAYERED )\nvec3 Environment_Layered(vec3 N, vec3 V, float NdotV, vec3 N2, float N2dotV, vec3 surfaceAlbedo, float surfaceRoughness,\n        float layeredF0, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv, vec3 layeredDiffuse, float layeredRoughness,\n        float layeredAnisotropy, float layeredRotation, vec3 bottom_f0, float layeredFraction)\n{\n    vec3 F = Fresnel_Schlick(vec3(layeredF0), NdotV);\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n#if defined( IMPORTANTSAMPLING )\n    vec3 topSpecular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, vec3(layeredF0), surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 topSpecular = F * surfaceAlbedo * envSpecular;\n#endif\n    vec3 amount = (1.0 - F);\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 topDiffuse = layeredDiffuse * envIrradiance;\n#if defined( IMPORTANTSAMPLING )\n    vec3 botSpecular = ImportanceSamplingSpecular(layeredRotation, bottom_f0, layeredRoughness, layeredAnisotropy, V, N2, Tu, Tv);\n#else\n    alpha = RoughnessToAlpha(layeredRoughness, 0.0).x;\n    exponent = AlphaToPhong(alpha);\n    reflMipIndex = ExponentToReflMipIndex(exponent);\n    envSpecular = sampleReflection(N2, V, reflMipIndex);\n    F = Fresnel_Rough(bottom_f0, N2dotV, alpha);\n    vec3 botSpecular = F * envSpecular;\n#endif\n    return topSpecular + amount * mix(topDiffuse, botSpecular, layeredFraction);\n}\n#elif defined( PRISMTRANSPARENT )\nvec3 Environment_Transparent(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv)\n{\n    vec3 reflectance = vec3(IORToReflectance(transparent_ior));\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = Fresnel_Rough(reflectance, NdotV, alpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, reflectance, surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 color = F * surfaceRoughness * transparent_color * envIrradiance;\n    return specular + color;\n}\n#elif defined( PRISMGLAZING )\nvec3 Environment_Glazing(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv,\n                         vec3 glazing_f0, vec3 transmissionF, float transmissionAlpha, vec3 glazingAdjustedColor, float glazingIlluminace)\n{\n    float surfaceAlpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 surfaceF = Fresnel_Rough(glazing_f0, NdotV, surfaceAlpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, glazing_f0, surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(surfaceAlpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = surfaceF * surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 color = 0.5 * (1.0 - transmissionF) * (glazingAdjustedColor - vec3(glazingIlluminace, glazingIlluminace, glazingIlluminace)) * envIrradiance; \n    return specular + color;\n}\n#elif defined( PRISMWOOD )\nvec3 Environment_Wood(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, vec3 woodDiffuse, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv)\n{\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = Fresnel_Rough(vec3(0.04), NdotV, alpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, vec3(0.04), surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 diffuse = (1.0 - F) * woodDiffuse * envIrradiance;\n    return diffuse + specular;\n}\n#endif\n#endif\n#if defined( PRISMTRANSPARENT )\n#include <prism_transparency>\n#elif defined( PRISMGLAZING )\n#include <prism_glazing>\n#endif\n#ifdef USE_TILING\nvec3 tilingTransform(vec2 uv, mat4 transform)\n{\n\treturn (transform * vec4(uv, 0.0, 1.0)).xyz;\n}\nvec4 tilingMapTest(sampler2D tilingSampler, mat3 transf, vec3 uv, vec4 uv2tile, vec4 tile2uv)\n{\n\tvec2 tileCoord = vec2(dot(uv2tile.xz, uv.xy), dot(uv2tile.yw, uv.xy));\n\tvec2 ijBase = floor(tileCoord);\n    vec2 fracC = fract(tileCoord);\n\tvec2 st = vec2(dot(tile2uv.xz, fracC), dot(tile2uv.yw, fracC));\n\tvec4 tileInfo = vec4(0.0, 0.0, 2.0, 2.0);\n\tvec2 iOffset = float(TILE_RANGE_X_MIN) * tile2uv.xy;\n\tvec2 jBaseOffset = float(TILE_RANGE_Y_MIN) * tile2uv.zw;\n\tfor( int i = TILE_RANGE_X_MIN; i <= TILE_RANGE_X_MAX; i++)\n\t{\n\t\tvec2 jOffset = jBaseOffset;\n\t\tfor( int j = TILE_RANGE_Y_MIN; j <= TILE_RANGE_Y_MAX; j++)\n\t\t{\n\t\t\tvec2 sampleUV = st + iOffset + jOffset;\n\t\t\tjOffset += tile2uv.zw;\n\t\t\tsampleUV = (transf * vec3(sampleUV, 1.0)).xy;\n\t\t\tvec4 tex = texture2D(tilingSampler, sampleUV);\n\t\t\tfloat d = max( min(tex.r, tex.g), min( max(tex.r, tex.g), tex.b));\n            if (d < tileInfo.z) {\n\t\t\t\ttileInfo.xy = vec2(float(i),float(j));\n\t\t\t\ttileInfo.w = tileInfo.z;\n\t\t\t\ttileInfo.z = d;\n\t\t\t} else {\n\t\t\t\ttileInfo.w = min(tileInfo.w, d);\n\t\t\t}\n\t\t}\n\t\tiOffset += tile2uv.xy;\n\t}\n\ttileInfo.zw = tileInfo.zw - 0.5;\n\tfloat w = clamp(tileInfo.z/max(fwidth(tileInfo.z), 0.000001) + 0.5, 0.0, 1.0);\n\tif ( w == 1.0 )\n\t\tdiscard;\n \tif (abs(tileInfo.w)<=abs(tileInfo.z))\n\t\tw = 0.0;\n\ttileInfo.w = 1.0 - w;\n\ttileInfo.xy -= ijBase;\n\treturn tileInfo;\n}\nvec2 tilingSubMaterialRelocate(vec3 uv, vec4 tileInfo, vec4 tile2uv)\n{\n\tvec2 offset = vec2(dot(tile2uv.xz, tileInfo.xy), dot(tile2uv.yw, tileInfo.xy));\n\treturn (uv.xy + offset);\n}\n#ifdef USE_TILING_RANDOM\nvec2 tilingRandom(vec2 uv, vec4 tileInfo, sampler2D randomSampler, mat3 transf, vec2 tileTextureAxisS, vec2 tileTextureAxisT, vec2 tile2TextureOffset)\n{\n    vec2 xti = (vec3(tileInfo.xy, 1.0) * transf).xy;\n    vec4 random = texture2D(randomSampler, xti);\n    vec2 randomOffset = vec2(tileTextureAxisS.x*random.z + tileTextureAxisT.x*random.w,\n        tileTextureAxisS.y*random.z + tileTextureAxisT.y*random.w) + tile2TextureOffset;\n    return uv + randomOffset;\n}\n#endif\nvoid tilingNormalOffset(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (vec3(uv, 1.0) * transform).xy;\n    vec3 distort =  (2.0 * texture2D(bumpTexture, st).xyz - 1.0) - vec3(0.0,0.0,1.0);\n    mat3 mat = mat3(\n        T.x, B.x, N.x,\n        T.y, B.y, N.y,\n        T.z, B.z, N.z\n    );\n    N = normalize(N + (mat*distort));\n}\n#endif\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n#include<cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 N = normalize(vNormal);\n    vec3 Tu = vec3(0.0);\n    vec3 Tv = vec3(0.0);\n#if defined(USE_MAP) || defined(USE_TILING)\n    vec2 uv = vUv;\n#endif\n#ifdef USE_TILING\n    vec3 v_tilingOverallTransf = tilingTransform( vUv, tilingOverallTransform );\n    vec4 v_TilingMap = tilingMapTest( TilingMap, TilingMap_texMatrix, v_tilingOverallTransf, uv2tile, tile2uv );\n    uv = tilingSubMaterialRelocate( v_tilingOverallTransf, v_TilingMap, tile2uv ) + tileAlignOffset;\n#ifdef USE_TILING_NORMAL\n    vec2 uvNorm = uv;\n#endif\n#ifdef USE_TILING_RANDOM\n    uv = tilingRandom( uv, v_TilingMap, TilingRandomMap, TilingRandomMap_texMatrix, tilingRandomAxisS, tilingRandomAxisT, tilingRandomAlignmentOffset );\n#endif\n    uv = tilingTransform( uv, tilingUVTransform ).xy;\n#endif\n#if defined( USE_SURFACE_NORMAL_MAP ) || defined( USE_LAYERED_NORMAL_MAP ) || MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0 || defined( PRISMWOODBUMP ) || defined( IMPORTANTSAMPLING )\n#if !defined(USE_MAP) || defined( PRISMWOODBUMP )\n    Tu = normalize(vTangent);\n    Tv = normalize(vBitangent);\n#else\n    vec3 q0 = dFdx( -vViewPosition );\n    vec3 q1 = dFdy( -vViewPosition );\n    vec2 st0 = dFdx( uv );\n    vec2 st1 = dFdy( uv );\n    Tu = normalize(  q0 * st1.t - q1 * st0.t );\n    Tv = normalize( -q0 * st1.s + q1 * st0.s );\n#endif\n#endif\n    vec3 V;\n    if (projectionMatrix[3][3] == 0.0) {\n        V = normalize( vViewPosition );\n    } else {\n        V = vec3(0.0, 0.0, 1.0);\n    }\n    N = faceforward(N, -V, N);\n#if defined(PRISMLAYERED)\n    vec3 N2 = N;\n#endif\n#ifndef FLAT_SHADED\n    vec3 normal = normalize( vNormal );\n#ifdef DOUBLE_SIDED\n    normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#else\n    vec3 fdx = dFdx( vViewPosition );\n    vec3 fdy = dFdy( vViewPosition );\n    vec3 normal = normalize( cross( fdx, fdy ) );\n#endif\n    vec3 geomNormal = normal;\n#if defined( USE_SURFACE_NORMAL_MAP )\n    if (surface_normal_map_bumpmapType == 0)\n        heightMapTransform(surface_normal_map, uv, surface_normal_map_texMatrix, surface_normal_map_bumpScale, Tu, Tv, N);\n    else\n        normalMapTransform(surface_normal_map, uv, surface_normal_map_texMatrix, surface_normal_map_bumpScale, Tu, Tv, N);\n#endif\n#if defined( USE_LAYERED_NORMAL_MAP )\n    if (layered_normal_map_bumpmapType == 0)\n        heightMapTransform(layered_normal_map, uv, layered_normal_map_texMatrix, layered_normal_map_bumpScale, Tu, Tv, N2);\n    else\n        normalMapTransform(layered_normal_map, uv, layered_normal_map_texMatrix, layered_normal_map_bumpScale, Tu, Tv, N2);\n#endif\n#ifdef USE_TILING_NORMAL\n    tilingNormalOffset(TilingNormalMap, uvNorm, TilingNormalMap_texMatrix, Tu, Tv, N);\n#endif\n#if defined( PRISMWOOD )\n#ifdef NO_UVW\n    vec3 p = vec3(0.0);\n#elif defined( USE_WOOD_CURLY_DISTORTION_MAP )\n    vec3 p = DistortCurly(vUvw);\n#else\n    vec3 p = vUvw;\n#endif\n#if !defined( NO_UVW ) && defined( PRISMWOODBUMP )\n    getFinalWoodContext(\n        N, V, Tu, Tv, p,\n        normal, vtNormal, vNormalMatrix\n    );\n#endif\n#endif\n    float NdotV = clamp(dot(N, V), EPSILON, 1.0);\n#if defined(PRISMLAYERED)\n    float N2dotV = clamp(dot(N2, V), EPSILON, 1.0);\n#endif\n    vec3 surfaceAlbedo;\n#prism_sample_texture<surface_albedo, surfaceAlbedo, false, true>\n    float surfaceRoughness;\n#prism_sample_texture<surface_roughness, surfaceRoughness, true, false>\n    float surfaceAnisotropy;\n#prism_sample_texture<surface_anisotropy, surfaceAnisotropy, true, false>\n    float surfaceRotation;\n#prism_sample_texture<surface_rotation, surfaceRotation, true, false>\n#if defined(PRISMOPAQUE)\n    float opaqueF0;\n#prism_sample_texture<opaque_f0, opaqueF0, true, false>\n    vec3 opaqueAlbedo;\n#prism_sample_texture<opaque_albedo, opaqueAlbedo, false, true>\n#elif defined(PRISMMETAL)\n    vec3 metalF0;\n#prism_sample_texture<metal_f0, metalF0, false, true>\n#elif defined(PRISMLAYERED)\n    float layeredF0;\n#prism_sample_texture<layered_f0, layeredF0, true, false>\n    vec3 layeredDiffuse;\n#prism_sample_texture<layered_diffuse, layeredDiffuse, false, true>\n    float layeredRoughness;\n#prism_sample_texture<layered_roughness, layeredRoughness, true, false>\n    float layeredAnisotropy;\n#prism_sample_texture<layered_anisotropy, layeredAnisotropy, true, false>\n    float layeredRotation;\n#prism_sample_texture<layered_rotation, layeredRotation, true, false>\n    vec3 bottom_f0;\n#prism_sample_texture<layered_bottom_f0, bottom_f0, false, true>\n    float layeredFraction;\n#prism_sample_texture<layered_fraction, layeredFraction, true, false>\n#elif defined( PRISMGLAZING )\n    vec3 glazingTransmissionColor;\n#prism_sample_texture<glazing_transmission_color, glazingTransmissionColor, false, true>\n    vec3 glazingF0;\n#prism_sample_texture<glazing_f0, glazingF0, false, true>\n    float glazingTransmissionRoughness;\n#prism_sample_texture<glazing_transmission_roughness, glazingTransmissionRoughness, true, false>\n    vec3 glazingAdjustedColor = TransmitAdjust(glazingTransmissionColor, glazingF0);\n    float glazingIlluminace = ColorToIlluminance(glazingAdjustedColor);\n    float transmissionAlpha = RoughnessToAlpha(glazingTransmissionRoughness, 0.0).x;\n    vec3 transmissionF = Fresnel_Rough(glazingF0, NdotV, transmissionAlpha);\n#elif defined(PRISMWOOD)\n    vec3 woodDiffuse = NoiseWood(p, surfaceRoughness);\n#endif\n    vec3 outRadianceLight = vec3(0.0);\n#if MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0\n    vec3 lightDirection[ MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS ];\n    vec3 lightColor[ MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS ];\n#if MAX_DIR_LIGHTS > 0\n    for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n        vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n        lightDirection[i] = normalize( lDirection.xyz );\n        lightColor[i] = SRGBToLinear(directionalLightColor[ i ]);\n    }\n#endif\n#if MAX_POINT_LIGHTS > 0\n    for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n        vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n        lightDirection[MAX_DIR_LIGHTS + i] = normalize( lVector );\n        float lDistance = 1.0;\n        if ( pointLightDistance[ i ] > 0.0 )\n            lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n        lightColor[MAX_DIR_LIGHTS + i] = SRGBToLinear(pointLightColor[ i ]) * lDistance;\n    }\n#endif\n#if MAX_SPOT_LIGHTS > 0\n    for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n        vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n        lightDirection[MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + i] = normalize( lVector );\n        float lDistance = 1.0;\n        if ( spotLightDistance[ i ] > 0.0 )\n            lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n        float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n        if ( spotEffect > spotLightAngleCos[ i ] )\n            spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n        lightColor[MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + i] = SRGBToLinear(spotLightColor[ i ]) * lDistance * spotEffect;\n    }\n#endif\n    for( int i = 0; i < MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS; i ++ ) {\n        vec3 L = lightDirection[i];\n        float NdotL = max(EPSILON, dot(N, L));\n        vec3 H = normalize(L + V);\n        float NdotH = dot(N, H);\n        float VdotH = dot(V, H);\n        float Hu = dot(H, Tu);\n        float Hv = dot(H, Tv);\n        vec3 Hlocal = vec3(Hu, Hv, NdotH);\n#if defined(PRISMLAYERED)\n        float N2dotL = dot(N2, L);\n        float N2dotH = dot(N2, H);\n        vec3 Hlocal2 = vec3(Hu, Hv, N2dotH);\n#endif\n        vec3 brdf = lightColor[i] *\n#if defined(PRISMOPAQUE)\n            BRDF_Opaque(Hlocal, NdotL, NdotH, NdotV, VdotH,\n                    surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                    opaqueF0, opaqueAlbedo);\n#elif defined(PRISMMETAL)\n            BRDF_Metal(Hlocal, NdotL, NdotH, NdotV, VdotH,\n                surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                metalF0);\n#elif defined(PRISMLAYERED)\n            BRDF_Layered(Hlocal, NdotL, NdotH, NdotV, VdotH, Hlocal2, N2dotL, N2dotH, N2dotV,\n                surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                layeredF0, layeredDiffuse, layeredRoughness, layeredAnisotropy,\n                layeredRotation, bottom_f0, layeredFraction);\n#elif defined(PRISMTRANSPARENT)\n            BRDF_Transparent(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation);\n#elif defined(PRISMGLAZING)\n            BRDF_Glazing(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                         glazingF0, glazingTransmissionColor, glazingIlluminace);\n#elif defined(PRISMWOOD)\n            BRDF_Wood(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, woodDiffuse);\n#endif\n        outRadianceLight += max(vec3(0.0), brdf);\n    }\n#endif\n    vec3 outRadianceEnv = vec3(0.0);\n#if defined( USE_ENVMAP )\n    outRadianceEnv =\n#if defined(PRISMOPAQUE)\n        Environment_Opaque(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness,\n                opaqueF0, opaqueAlbedo, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#elif defined(PRISMMETAL)\n        Environment_Metal(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, metalF0, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#elif defined(PRISMLAYERED)\n        Environment_Layered(N, V, clamp(NdotV, 0.0, 1.0), N2, clamp(N2dotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness,\n            layeredF0, surfaceAnisotropy, surfaceRotation, Tu, Tv, layeredDiffuse, layeredRoughness, layeredAnisotropy,\n            layeredRotation, bottom_f0, layeredFraction);\n#elif defined(PRISMTRANSPARENT)\n        Environment_Transparent(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#elif defined(PRISMGLAZING)\n        Environment_Glazing(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation, Tu, Tv,\n            glazingF0, transmissionF, transmissionAlpha, glazingAdjustedColor, glazingIlluminace);\n#elif defined(PRISMWOOD)\n        Environment_Wood(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, woodDiffuse, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#endif\n#endif\n#if defined(PRISMOPAQUE)\n    vec3 luminanceModifier;\n#prism_sample_texture<opaque_luminance_modifier, luminanceModifier, false, true>\n    outRadianceEnv += luminanceModifier * opaque_luminance;\n#endif\n    float surface_cutout = 1.0;\n#prism_sample_texture<surface_cutout, surface_cutout, true, false>\n#if defined( USE_SURFACE_CUTOUT_MAP )\n    if(surface_cutout < 0.01) discard;\n#endif\n    gl_FragColor = vec4( outRadianceLight + outRadianceEnv, opacity*surface_cutout );\n#if TONEMAP_OUTPUT == 1\n    gl_FragColor.xyz = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * gl_FragColor.xyz);\n#elif TONEMAP_OUTPUT == 2\n    gl_FragColor.xyz = toneMapCanonFilmic_WithGamma(exposureBias * gl_FragColor.xyz);\n#endif\n#ifdef USE_FOG\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = smoothstep( fogNear, fogFar, depth );\n    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif\n#if defined(PRISMTRANSPARENT)\n    applyPrismTransparency(gl_FragColor, transparent_color, transparent_ior);\n    gl_FragColor.a *= surface_cutout;\n#ifdef USE_TILING\n    gl_FragColor.a *= v_TilingMap.a;\n#endif\n#elif defined( PRISMGLAZING )\n    applyPrismGlazingOpacity(gl_FragColor, transmissionF, transmissionAlpha, NdotV, glazingIlluminace);\n#ifdef USE_TILING\n    gl_FragColor.a *= v_TilingMap.a;\n#endif\n#endif\n#include<theming_frag>\n#include<final_frag>\n}\n"
},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(){function a(){this.init=function(){this.isPrism=!1,this.alphaMap=!1,this.alphaClampS=!1,this.alphaClampT=!1,this.alphaInvert=!1,this.rgbaMap=!1,this.rgbaClampS=!1,this.rgbaClampT=!1,this.rgbaInvert=!1,this.instanced=!1,this.decalIndex=-1},this.init(),this.getMaterialIndex=function(){return(this.isPrism?1:0)|(this.alphaMap?2:0)|(this.alphaClampS?4:0)|(this.alphaClampT?8:0)|(this.alphaInvert?16:0)|(this.rgbaMap?32:0)|(this.rgbaClampS?64:0)|(this.rgbaClampT?128:0)|(this.rgbaInvert?256:0)|(this.instanced?512:0)|1024*(this.decalIndex+1)}}function b(a,b){var c=a.getMaterialIndex();if(!e[c]){var d=f.clone();a.isPrism&&a.alphaMap&&((0,i.setMacro)(d,"USE_SURFACE_CUTOUT_MAP"),d.fragmentShader=(0,k.GetPrismMapChunk)("surface_cutout",a.alphaClampS,a.alphaClampT)+"\n"+d.fragmentShader),a.instanced&&(d.useInstancing=!0),e[c]=d}return e[c]}function c(a){return a instanceof o.MeshPhongMaterial?a.opacity<z.ShadowMinOpacity:a.isPrismMaterial?"PrismTransparent"===a.prismType||"PrismGlazing"===a.prismType:!a.visible}function d(a,d){if(c(a))return g;var e=a instanceof o.MeshPhongMaterial,f=a.isPrismMaterial;if(!e&&!f)return null;var h=e?a.alphaMap:a.surface_cutout_map,i=e&&a.alphaTest?a.map:null;if(!h&&!i&&!a.useInstancing)return null;var k=j;k.init(),k.isPrism=f,k.alphaMap=!!h,k.rgbaMap=!!i,k.instanced=a.useInstancing,k.decalIndex=void 0===d?-1:d,h&&(k.alphaClampS=h.clampS,k.alphaClampT=h.clampT,k.alphaInvert=h.invert),i&&(k.rgbaClampS=i.clampS,k.rgbaClampT=i.clampT,k.rgbaInvert=i.invert);var l=b(k,d);return h&&(e?(l.uniforms.alphaMap.value=h,l.uniforms.texMatrixAlpha.value=h.matrix,l.alphaMap=h,l.side=a.side):(l.uniforms.surface_cutout_map.value=h,l.uniforms.surface_cutout_map_texMatrix.value.copy(h.matrix),l.uniforms.surface_cutout_map_invert.value=h.invert,l.side=o.DoubleSide)),i&&(l.uniforms.map.value=i,l.uniforms.texMatrix.value=i.matrix,l.map=i),l}var e=[],f=(0,i.createShaderMaterial)(x),g=new o.Material;g.visible=!1;var h=[],j=new a;this.forEachMaterial=function(a){for(var b=0;b<e.length;b++){var c=e[b];c&&a(c)}a(f)},this.getCustomOverrideMaterial=function(a){var b=d(a);if(!b)return null;if(!a.decals)return b.decals=null,b;if(a.decals){h.length=0;for(var c=0;c<a.decals.length;c++){var e=a.decals[c],f=d(e.material,c);if(!f)return null;h.push({uv:e.uv,material:f})}}return b.decals=h,b},this.dispose=function(){this.forEachMaterial(function(a){a.dispose()})}}function f(){this.shadowMap=void 0,this.shadowMapSize=void 0,this.shadowMatrix=void 0,this.shadowLightDir=void 0,this.init=function(a){this.shadowMap=a,this.shadowMapSize=new o.Vector2(a.width,a.height),this.shadowMatrix=new o.Matrix4,this.shadowLightDir=new o.Vector3},this.apply=function(a){a.shadowMap=this.shadowMap,a.shadowMatrix=this.shadowMatrix,a.shadowLightDir=this.shadowLightDir,this.shadowMap?((0,i.setMacro)(a,"USE_SHADOWMAP"),z.UseHardShadows&&(0,i.setMacro)(a,"USE_HARD_SHADOWS")):((0,i.removeMacro)(a,"USE_SHADOWMAP"),(0,i.removeMacro)(a,"USE_HARD_SHADOWS"))}}function g(a){function b(a,b){a.forEach(function(a){b.apply(a)})}function c(a){var b=new o.WebGLRenderTarget(a,a,{minFilter:o.LinearFilter,magFilter:o.LinearFilter,format:o.RGBAFormat,type:o.FloatType,stencilBuffer:!1,generateMipmaps:!1});return b.generateMipmaps=!1,b}function d(a){s.setRenderTarget(a),s.setClearColor(r,1),s.clear()}function g(a){var c=k.shadowMap;k.shadowMap=F,b(a,k),k.apply(t),k.shadowMap=c}function h(a){a.uniforms.shadowMapRangeMin.value=p.near,a.uniforms.shadowMapRangeSize.value=p.far-p.near,a.uniforms.shadowESMConstant.value=z.ShadowESMConstant,a.uniforms.shadowMinOpacity.value=z.ShadowMinOpacity}function j(a,b,c){var d=c||new o.Vector3;return d.x=1&b?a.max.x:a.min.x,d.y=2&b?a.max.y:a.min.y,d.z=4&b?a.max.z:a.min.z,d}var k=null,n=null,p=new o.OrthographicCamera,q=Math.exp(z.ShadowESMConstant),r=z.UseHardShadows?new o.Color(1,1,1):new o.Color(q,1,1),s=a,t=null,u=null,v=null,w=(0,i.createShaderMaterial)(x),E=new e;w.getCustomOverrideMaterial=E.getCustomOverrideMaterial;var F=null,G=function(){var a=new o.Matrix4,b=new o.Matrix4,c=new o.Vector3(0,0,0),d=new o.Box3,e=new o.Vector3,f=new o.Vector3;return function(g,h,i){g.position.copy(i),g.lookAt(c),a.makeRotationFromQuaternion(g.quaternion),b.getInverse(a),d.copy(h).applyMatrix4(b),f=d.center(f),e.set(f.x,f.y,d.max.z),e.applyMatrix4(a),g.position.copy(e),f=d.size(f),g.left=-.5*f.x,g.right=.5*f.x,g.bottom=-.5*f.y,g.top=.5*f.y,g.near=0,g.far=f.z,g.updateMatrixWorld(),g.matrixWorldInverse.getInverse(g.matrixWorld),g.updateProjectionMatrix()}}();this.init=function(){k=new f,k.init(c(z.ShadowMapSize)),n=z.BlurShadowMap?new m.GaussianPass(z.ShadowMapSize,z.ShadowMapSize,z.ShadowMapBlurRadius,1,{type:k.shadowMap.type,format:k.shadowMap.format}):void 0,t=(0,i.createShaderMaterial)(y),t.depthWrite=!1,t.transparent=!0,u=(0,l.createGroundShape)(t),v=new o.Scene,v.add(u),this.groundShapeBox=new o.Box3,F=c(1),d(F)},this.init(),this.state=A,this.startUpdate=function(a,b,c,d,e){var f=a.getVisibleBounds(!0);return this.beginShadowMapUpdate(c,f,d),a.reset(p,3,!0),this.state=B,b=this.continueUpdate(a,b,e)},this.continueUpdate=function(a,b,c){return b=a.renderSome(this.renderSceneIntoShadowMap,b),a.isDone()?(this.state=C,this.finishShadowMapUpdate(c)):g(c),b},this.beginShadowMapUpdate=function(a,b,c){G(p,b,c),h(w),E.forEachMaterial(h),z.UseHardShadows&&((0,i.setMacro)(w,"USE_HARD_SHADOWS"),E.forEachMaterial(function(a){(0,i.setMacro)(a,"USE_HARD_SHADOWS")})),d(k.shadowMap),this.renderSceneIntoShadowMap(v)},this.renderSceneIntoShadowMap=function(a){a.overrideMaterial=w,s.render(a,p,k.shadowMap),a.overrideMaterial=null},this.finishShadowMapUpdate=function(a){n&&!z.UseHardShadows&&n.render(s,k.shadowMap,k.shadowMap),k.shadowMatrix.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse),k.shadowMapRangeMin=p.near,k.shadowMapRangeSize=p.far-p.near,k.shadowLightDir.copy(p.position).normalize(),b(a,k),k.apply(t),this.isValid=!0},this.cleanup=function(a){n&&n.cleanup(),k.shadowMap&&k.shadowMap.dispose(),b(a,D),w.dispose(),E.dispose(),t.dispose(),u.geometry.dispose()},this.setGroundShadowTransform=function(){return function(a,b,c,d){(0,l.setGroundShapeTransform)(u,a,b,c,d),this.groundShapeBox.setFromObject(u)}}(),this.renderGroundShadow=function(a,b){s.render(v,a,b,!1)},this.expandByGroundShadow=function(){var a=new o.Plane,b=new o.Ray,c=new o.Vector3,d=new o.Vector3,e=new o.Box3;return function(f,g){a.normal.set(0,1,0),a.constant=-f.min.y,b.direction.copy(g).negate().normalize();var h=f.center(c),i=100*h.distanceToSquared(f.min)*100;e.makeEmpty();for(var k=0;k<8;k++){b.origin=j(f,k);var l=b.intersectPlane(a,d);l&&(l.distanceToSquared(h)>=i||e.expandByPoint(l))}f.union(e)}}(),this.getShadowParams=function(){return k},this.getShadowCamera=function(){return p}}Object.defineProperty(b,"__esModule",{value:!0}),b.ShadowRender=b.SHADOWMAP_VALID=b.SHADOWMAP_INCOMPLETE=b.SHADOWMAP_NEEDS_UPDATE=b.ShadowConfig=b.GroundShadowShader=b.ShadowMapShader=void 0,b.ShadowMapOverrideMaterials=e,b.ShadowMaps=g;var h=c(58),i=c(40),j=c(101),k=c(100),l=c(50),m=c(41),n=c(2),o=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(n),p=c(105),q=d(p),r=c(106),s=d(r),t=c(107),u=d(t),v=c(108),w=d(v),x=b.ShadowMapShader={uniforms:o.UniformsUtils.merge([h.ShaderChunks.ShadowMapCommonUniforms,{shadowMapRangeMin:{type:"f",value:0},shadowMapRangeSize:{type:"f",value:0},shadowMinOpacity:{type:"f",value:0},map:{type:"t",value:null},alphaMap:{type:"t",value:null},texMatrix:{type:"m3",value:new o.Matrix3},texMatrixAlpha:{type:"m3",value:new o.Matrix3}},(0,j.GetPrismMapUniforms)("surface_cutout_map")]),vertexShader:q.default,fragmentShader:s.default},y=b.GroundShadowShader={uniforms:h.ShaderChunks.ShadowMapUniforms,vertexShader:u.default,fragmentShader:w.default},z=b.ShadowConfig={ShadowMapSize:1024,ShadowESMConstant:80,ShadowBias:.001,ShadowDarkness:.7,ShadowMapBlurRadius:4,ShadowMinOpacity:.9,UseHardShadows:!1,BlurShadowMap:!0},A=b.SHADOWMAP_NEEDS_UPDATE=0,B=b.SHADOWMAP_INCOMPLETE=1,C=b.SHADOWMAP_VALID=2,D=new f;(b.ShadowRender=function(){}).RefreshUniformsShadow=function(a,b){a.shadowMap&&(a.shadowMap.value=b.shadowMap),a.shadowMatrix&&(a.shadowMatrix.value=b.shadowMatrix),a.shadowLightDir&&(a.shadowLightDir.value=b.shadowLightDir),a.shadowESMConstant&&(a.shadowESMConstant.value=z.ShadowESMConstant),a.shadowBias&&(a.shadowBias.value=z.ShadowBias),a.shadowMapSize&&(a.shadowMapSize.value=z.ShadowMapSize),a.shadowDarkness&&(a.shadowDarkness.value=z.ShadowDarkness)}},function(a,b){a.exports="#include<shadowmap_decl_common>\nvarying float depth;\n#ifdef USE_SURFACE_CUTOUT_MAP\nvarying vec2 vUv;\n#else\n#ifdef USE_MAP\nvarying vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#ifdef USE_ALPHAMAP\nvarying vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#endif\nvoid passCutoutUVCoords() {\n#ifdef USE_SURFACE_CUTOUT_MAP\n    vUv = uv;\n#else\n#ifdef USE_MAP\n    vUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_ALPHAMAP\n    vUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#endif\n}\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n    depth = -mvPosition.z;\n    passCutoutUVCoords();\n}\n"},function(a,b){a.exports="#include<shadowmap_decl_common>\nvarying float depth;\n#ifdef USE_SURFACE_CUTOUT_MAP\n#include<float3_average>\n#prism_uniforms<surface_cutout_map>\nvarying vec2 vUv;\n#else\n#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\nvarying vec2 vUvAlpha;\nuniform sampler2D alphaMap;\n#endif\n#endif\nuniform float shadowMinOpacity;\nvoid applyCutoutMaps() {\n    float opacity = 1.0;\n#ifdef USE_SURFACE_CUTOUT_MAP\n#prism_sample_texture<surface_cutout, opacity, true, false>\n#else\n#ifdef USE_MAP\n    opacity *= GET_MAP(vUv).a;\n#endif\n#ifdef USE_ALPHAMAP\n    opacity *= GET_ALPHAMAP(vUvAlpha).r;\n#endif\n#endif\n#if defined(USE_SURFACE_CUTOUT_MAP) || defined(USE_MAP) || defined(USE_ALPHAMAP)\n    if (opacity < shadowMinOpacity) discard;\n#endif\n}\nvoid main() {\n    float normalizedLinearDepth = (depth - shadowMapRangeMin) / shadowMapRangeSize;\n    float val = exp(shadowESMConstant * normalizedLinearDepth);\n#ifdef USE_HARD_SHADOWS\n    val = normalizedLinearDepth;\n#endif\n    applyCutoutMaps();\n    gl_FragColor = vec4(val, 0, 0, 1);\n}\n"},function(a,b){a.exports="#include<shadowmap_decl_vert>\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n#include<shadowmap_vert>\n}\n"},function(a,b){a.exports="#include<shadowmap_decl_frag>\nvoid main() {\n    float shadowIntensity = 0.5 * (1.0 - getShadowValue());\n    gl_FragColor = vec4(0.0, 0.0, 0.0, shadowIntensity);\n}\n"},function(a,b,c){"use strict";function d(a,b,c){if(!a||!a.colors)return new da.Color(1,0,0);var d=a.colors[b];if(!d)return new da.Color(0,0,0);var e=d.values;if(!e||!e.length)return new da.Color(1,0,0);var f=e[0];return new da.Color(f.r,f.g,f.b)}function e(a,b,c){if(!a||!a.scalars)return c;var d=a.scalars[b];return d?d.values[0]:c}function f(a,b,c){if(!a||!a.booleans)return c;var d=a.booleans[b];return void 0===d?c:d}function g(a,b,c,d){if(!a||!a[b])return d;var e=a[b][c];return e?e.values[0]:d}function h(a,b,c){var d={bands:0,weights:new da.Vector4(1,1,1,1),frequencies:new da.Vector4(1,1,1,1)};if(!a||!a[b])return d;var e=a[b][c];if(!(e&&e.values&&e.values instanceof Array))return d;var f=e.values;d.bands=f.length/2;for(var g=0;g<d.bands;++g)d.frequencies.setComponent(g,1/f[2*g]),d.weights.setComponent(g,f[2*g+1]);return d}function i(a,b,c,d){if(!a||!a.scalars)return d;var e=a.scalars[b];return e?m(e.values[0],e.units,c):d}function j(a,b,c,d){if(!a||!a[b])return d;var e=a[b][c];return e&&e.connections?e.connections[0]:d}function k(a){var b=a;return b<=.04045?b/=12.92:b=Math.pow((b+.055)/1.055,2.4),b}function l(a){var b,c,d;return b=k(a.r),c=k(a.g),d=k(a.b),new da.Color(b,c,d)}function m(a,b,c){var d=ea[c];d||(d=1,da.warn("Unsupported unit: "+c));var e=ea[b];return e||(e=1,da.warn("Unsupported unit: "+b)),a*d/e}function n(a,b,c){if(0===b){var d=i(a,"bumpmap_Depth",c,0),e=1,f=1;return null!=g(a,"scalars","texture_RealWorldScale")?e=f=i(a,"texture_RealWorldScale",c,1):(e=i(a,"texture_RealWorldScaleX",c,1),f=i(a,"texture_RealWorldScaleY",c,1)),e=0===e?1:1/e,f=0===f?1:1/f,new da.Vector2(e*d,f*d)}var h=g(a,"scalars","bumpmap_NormalScale",1);return new da.Vector2(h,h)}function o(a,b){var c=i(a,"texture_RealWorldOffsetX",b,0),d=i(a,"texture_RealWorldOffsetY",b,0),e=g(a,"scalars","texture_UOffset",0),f=g(a,"scalars","texture_VOffset",0),h=1,j=1;null!=g(a,"scalars","texture_RealWorldScale")?h=j=i(a,"texture_RealWorldScale",b,1):(h=i(a,"texture_RealWorldScaleX",b,1),j=i(a,"texture_RealWorldScaleY",b,1)),h=0===h?1:h,j=0===j?1:j;var k=g(a,"scalars","texture_UScale",1),l=g(a,"scalars","texture_VScale",1),m=g(a,"scalars","texture_WAngle",1);m*=Math.PI/180;var n=Math.cos(m),o=Math.sin(m),p=k/h,q=l/j;return{elements:[n*p,o*p,0,-o*q,n*q,0,-n*p*c+o*q*d+e,-o*p*c-n*q*d+f,1]}}function p(){var a=[0,128,64,191,32,160,96,223,16,143,80,207,48,175,112,239,8,135,72,199,40,167,103,231,25,151,88,215,56,183,120,250],b=new Uint8Array(a),c=new da.DataTexture(b,32,1,da.LuminanceFormat,da.UnsignedByteType,da.UVMapping,da.RepeatWrapping,da.RepeatWrapping,da.NearestFilter,da.NearestFilter,0);c.generateMipmaps=!1,c.flipY=!1,c.needsUpdate=!0;for(var d,e,f=function(a,b){return Math.atan2(a*b,Math.sqrt(a*a+b*b+1))},g=new Uint8Array(16384),h=0;h<128;++h)for(var i=0;i<128;++i){d=h/128*2-1,e=i/128*2-1,d=Math.min(Math.max(1/128-1,d),1-1/128),e=Math.min(Math.max(1/128-1,e),1-1/128);var j=d-1/128,k=d+1/128,l=e-1/128,m=e+1/128,n=f(k,m)-f(j,m)-f(k,l)+f(j,l);g[128*h+i]=1e6*n}var o=new da.DataTexture(g,128,128,da.LuminanceFormat,da.UnsignedByteType,da.UVMapping,da.RepeatWrapping,da.RepeatWrapping,da.NearestFilter,da.NearestFilter,0);o.generateMipmaps=!1,o.flipY=!1,o.needsUpdate=!0,$={randomNum:c,solidAngle:o}}function q(){var a=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],b=new Uint8Array(a),c=new da.DataTexture(b,256,1,da.LuminanceFormat,da.UnsignedByteType,da.UVMapping,da.RepeatWrapping,da.RepeatWrapping,da.NearestFilter,da.NearestFilter,0);c.generateMipmaps=!1,c.flipY=!1,c.needsUpdate=!0;var d=[225,39,122,231,29,173,15,159,75,88,233,19,179,79,72,94,54,73,151,161,171,113,221,144,127,83,168,19,88,122,62,225,109,128,246,247,172,101,61,139,211,168,64,210,224,82,87,97,119,250,201,44,242,239,154,99,126,13,44,70,246,170,100,52,135,28,187,22,207,119,199,1,235,187,55,131,190,124,222,249,236,53,225,231,71,30,173,185,153,47,79,133,225,10,140,62,17,99,100,29,137,95,142,244,76,5,83,124,38,216,253,195,44,210,148,185,188,39,78,195,132,30,60,73,92,223,133,80,230,56,118,207,79,15,251,211,111,21,79,23,240,146,150,207,3,61,103,27,148,6,31,127,235,58,173,244,116,81,34,120,192,213,188,226,97,23,16,161,106,80,242,148,35,37,91,117,51,216,97,193,126,222,39,38,133,217,215,23,237,57,205,42,222,165,126,133,33,8,227,154,27,18,56,11,192,120,80,92,236,38,210,207,128,31,135,39,123,5,49,127,107,200,34,14,153,239,134,19,248,162,58,201,159,198,243,158,72,5,138,184,222,200,34,141,233,40,195,238,191,122,171,32,66,254,229,197],e=new Uint8Array(d),f=new da.DataTexture(e,256,1,da.LuminanceFormat,da.UnsignedByteType,da.UVMapping,da.RepeatWrapping,da.RepeatWrapping,da.NearestFilter,da.NearestFilter,0);f.generateMipmaps=!1,f.flipY=!1,f.needsUpdate=!0;for(var g,h,i,j,k,l,m,n,o=function(b){return a[b%256]},p=new Array(262144),q=0;q<256;++q)for(n=0;n<256;++n)g=o(n)+q,h=o(g),i=o(g+1),j=o(n+1)+q,k=o(j),l=o(j+1),m=4*(256*q+n),p[m]=h,p[m+1]=i,p[m+2]=k,p[m+3]=l;var r=new Uint8Array(p),s=new da.DataTexture(r,256,256,da.RGBAFormat,da.UnsignedByteType,da.UVMapping,da.RepeatWrapping,da.RepeatWrapping,da.NearestFilter,da.NearestFilter,0);s.generateMipmaps=!1,s.flipY=!1,s.needsUpdate=!0;var t=[1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1,1,1,0,0,-1,1,-1,1,0,0,-1,-1],u=new Array(1024);for(n=0;n<256;++n){var v=a[n]%16;u[4*n]=127*t[3*v]+128,u[4*n+1]=127*t[3*v+1]+128,u[4*n+2]=127*t[3*v+2]+128,u[4*n+3]=0}var w=new Uint8Array(u),x=new da.DataTexture(w,256,1,da.RGBAFormat,da.UnsignedByteType,da.UVMapping,da.RepeatWrapping,da.RepeatWrapping,da.NearestFilter,da.NearestFilter,0);x.generateMipmaps=!1,x.flipY=!1,x.needsUpdate=!0,_={permutation:c,gradient:f,perm2D:s,permGrad:x}}function r(a,b,c){a[c+"_enable"]=g(b,"booleans",c+"_enable",0);var d=h(b,"scalars",c+"_prof");a[c+"_bands"]=d.bands,a[c+"_weights"]=d.weights,a[c+"_frequencies"]=d.frequencies}function s(a,b,c,h){h=h||a.userassets;var i=a.materials,k=i[h];if(k){if("TilingPattern"===k.definition){k=i[k.properties.references.grout_material.connections[0]]}}var m=k.properties,n=U(a);if(c){if(!(n?c.isPrismMaterial:c instanceof da.MeshPhongMaterial))return null;c.needsUpdate=!0}else c=n?(0,aa.createPrismMaterial)():new da.MeshPhongMaterial;var o,s;if(c.proteinMat=a,c.proteinCategories=k.categories,c.packedNormals=!0,k&&n){c.tag=k.tag,c.prismType=k.definition,void 0===c.prismType&&(c.prismType=""),void 0!==a.IsSingleSided&&!1===a.IsSingleSided&&(c.side=da.DoubleSide);var t=c.mapList;switch(c.transparent=!1,c.envExponentMin=1,c.envExponentMax=512,c.envExponentCount=10,c.surface_albedo=l(d(m,"surface_albedo",new da.Color(1,0,0))),t.surface_albedo_map=j(m,"colors","surface_albedo",null),c.surface_anisotropy=g(m,"scalars","surface_anisotropy",0),t.surface_anisotropy_map=j(m,"scalars","surface_anisotropy",null),c.surface_rotation=g(m,"scalars","surface_rotation",0),t.surface_rotation_map=j(m,"scalars","surface_rotation",null),c.surface_roughness=g(m,"scalars","surface_roughness",0),t.surface_roughness_map=j(m,"scalars","surface_roughness",null),t.surface_cutout_map=j(m,"textures","surface_cutout",null),t.surface_normal_map=j(m,"textures","surface_normal",null),null!=t.surface_cutout_map&&(c.side=da.DoubleSide,c.transparent=!0),c.prismType){case"PrismOpaque":c.opaque_albedo=l(d(m,"opaque_albedo",new da.Color(1,0,0))),t.opaque_albedo_map=j(m,"colors","opaque_albedo",null),c.opaque_luminance_modifier=l(d(m,"opaque_luminance_modifier",new da.Color(0,0,0))),t.opaque_luminance_modifier_map=j(m,"colors","opaque_luminance_modifier",null),c.opaque_f0=g(m,"scalars","opaque_f0",0),t.opaque_f0_map=j(m,"scalars","opaque_f0",null),c.opaque_luminance=g(m,"scalars","opaque_luminance",0);break;case"PrismMetal":c.metal_f0=l(d(m,"metal_f0",new da.Color(1,0,0))),t.metal_f0_map=j(m,"colors","metal_f0",null);break;case"PrismLayered":c.layered_bottom_f0=l(d(m,"layered_bottom_f0",new da.Color(1,1,1))),t.layered_bottom_f0_map=j(m,"colors","layered_bottom_f0",null),c.layered_diffuse=l(d(m,"layered_diffuse",new da.Color(1,0,0))),t.layered_diffuse_map=j(m,"colors","layered_diffuse",null),c.layered_anisotropy=g(m,"scalars","layered_anisotropy",0),t.layered_anisotropy_map=j(m,"scalars","layered_anisotropy",null),c.layered_f0=g(m,"scalars","layered_f0",0),t.layered_f0_map=j(m,"scalars","layered_f0",null),c.layered_fraction=g(m,"scalars","layered_fraction",0),t.layered_fraction_map=j(m,"scalars","layered_fraction",null),c.layered_rotation=g(m,"scalars","layered_rotation",0),t.layered_rotation_map=j(m,"scalars","layered_rotation",null),c.layered_roughness=g(m,"scalars","layered_roughness",0),t.layered_roughness_map=j(m,"scalars","layered_roughness",null),t.layered_normal_map=j(m,"textures","layered_normal",null);break;case"PrismTransparent":c.transparent_color=l(d(m,"transparent_color",new da.Color(1,0,0))),c.transparent_distance=g(m,"scalars","transparent_distance",0),c.transparent_ior=g(m,"scalars","transparent_ior",0),c.transparent=!0;break;case"PrismGlazing":c.glazing_f0=l(d(m,"glazing_f0",new da.Color(1,1,1))),t.glazing_f0_map=j(m,"colors","glazing_f0",null),c.glazing_transmission_color=l(d(m,"glazing_transmission_color",new da.Color(1,1,1))),t.glazing_transmission_color_map=j(m,"colors","glazing_transmission_color",null),c.glazing_transmission_roughness=e(m,"glazing_transmission_roughness",0),t.glazing_transmission_roughness_map=j(m,"scalars","glazing_transmission_roughness",null),c.side=g(m,"booleans","glazing_backface_culling",!1)?da.FrontSide:da.DoubleSide,c.transparent=!0;break;case"PrismWood":r(c,m,"wood_fiber_cosine"),r(c,m,"wood_fiber_perlin"),c.wood_fiber_perlin_scale_z=g(m,"scalars","wood_fiber_perlin_scale_z",0),r(c,m,"wood_growth_perlin"),c.wood_latewood_ratio=g(m,"scalars","wood_latewood_ratio",0),c.wood_earlywood_sharpness=g(m,"scalars","wood_earlywood_sharpness",0),c.wood_latewood_sharpness=g(m,"scalars","wood_latewood_sharpness",0),c.wood_ring_thickness=g(m,"scalars","wood_ring_thickness",0),r(c,m,"wood_earlycolor_perlin"),c.wood_early_color=l(d(m,"wood_early_color",new da.Color(1,0,0))),c.wood_use_manual_late_color=g(m,"booleans","wood_use_manual_late_color",0),c.wood_manual_late_color=l(d(m,"wood_manual_late_color",new da.Color(1,0,0))),r(c,m,"wood_latecolor_perlin"),c.wood_late_color_power=g(m,"scalars","wood_late_color_power",0),r(c,m,"wood_diffuse_perlin"),c.wood_diffuse_perlin_scale_z=g(m,"scalars","wood_diffuse_perlin_scale_z",0),c.wood_use_pores=g(m,"booleans","wood_use_pores",0),c.wood_pore_type=g(m,"choicelists","wood_pore_type",0),c.wood_pore_radius=g(m,"scalars","wood_pore_radius",0),c.wood_pore_cell_dim=g(m,"scalars","wood_pore_cell_dim",0),c.wood_pore_color_power=g(m,"scalars","wood_pore_color_power",0),c.wood_pore_depth=g(m,"scalars","wood_pore_depth",0),c.wood_use_rays=g(m,"booleans","wood_use_rays",0),c.wood_ray_color_power=g(m,"scalars","wood_ray_color_power",0),c.wood_ray_seg_length_z=g(m,"scalars","wood_ray_seg_length_z",0),c.wood_ray_num_slices=g(m,"integers","wood_ray_num_slices",0),c.wood_ray_ellipse_z2x=g(m,"scalars","wood_ray_ellipse_z2x",0),c.wood_ray_ellipse_radius_x=g(m,"scalars","wood_ray_ellipse_radius_x",0),c.wood_use_latewood_bump=g(m,"booleans","wood_use_latewood_bump",0),c.wood_latewood_bump_depth=g(m,"scalars","wood_latewood_bump_depth",0),c.wood_use_groove_roughness=g(m,"booleans","wood_use_groove_roughness",0),c.wood_groove_roughness=g(m,"scalars","wood_groove_roughness",0),c.wood_diffuse_lobe_weight=g(m,"scalars","wood_diffuse_lobe_weight",0),c.wood_curly_distortion_enable=g(m,"booleans","wood_curly_distortion_enable",0),c.wood_curly_distortion_scale=g(m,"scalars","wood_curly_distortion_scale",0),t.wood_curly_distortion_map=j(m,"scalars","wood_curly_distortion_map",null),_||q(),c.uniforms.permutationMap.value=_.permutation,c.uniforms.gradientMap.value=_.gradient,c.uniforms.perm2DMap.value=_.perm2D,c.uniforms.permGradMap.value=_.permGrad;break;default:da.warn("Unknown prism type: "+c.prismType)}c.enableImportantSampling&&(c.surface_anisotropy||c.surface_rotation||c.layered_anisotropy||c.layered_rotation)&&($||p(),c.uniforms.importantSamplingRandomMap.value=$.randomNum,c.uniforms.importantSamplingSolidAngleMap.value=$.solidAngle),c.defines={},c.textureMaps={};for(var u in t)if(t[u]){var v=i[t[u]];s=v.properties,v.matrix=S(v,!0,b);var w="BumpMap"==v.definition?"bumpmap_Bitmap":"unifiedbitmap_Bitmap",x=s.uris[w].values,y=x[0];y&&(o={mapName:u,uri:y,uriPointer:x,textureObj:v,isPrism:!0},c.textureMaps[o.mapName]=o,c.defines["USE_"+u.toUpperCase()]="")}c.defines[c.prismType.toUpperCase()]="","PrismWood"==c.prismType&&c.enable3DWoodBump&&(c.defines.PRISMWOODBUMP=""),c.enableImportantSampling&&(c.defines.ENABLEIMPORTANTSAMPLING="")}else if(k&&!n&&"SimplePhong"==k.definition){c.tag=k.tag,c.proteinType=k.proteinType,void 0===c.proteinType&&(c.proteinType=null);var z=f(m,"generic_baked_lighting",!1);c.disableEnvMap=z;var A=c.ambient=d(m,"generic_ambient"),B=c.color=d(m,"generic_diffuse"),C=c.specular=d(m,"generic_specular"),D=c.emissive=d(m,"generic_emissive");c.shininess=e(m,"generic_glossiness",30),c.opacity=1-e(m,"generic_transparency",0),c.reflectivity=e(m,"generic_reflectivity_at_0deg",0);var E=f(m,"generic_bump_is_normal"),F=e(m,"generic_bump_amount",0);null==F&&(F=1),E?(F>1&&(F=1),c.normalScale=new da.Vector2(F,F)):(F>=1&&(F=.03),c.bumpScale=F);var G=f(m,"generic_is_metal");void 0!==G&&(c.metal=G);var H=f(m,"generic_backface_cull");void 0===H||H||(c.side=da.DoubleSide),c.transparent=k.transparent,c.textureMaps={};var I=k.textures;for(var J in I)if(o={},o.textureObj=i[I[J].connections[0]],s=o.textureObj.properties,o.textureObj.matrix=S(o.textureObj,!1,b),o.uriPointer=s.uris.unifiedbitmap_Bitmap.values,o.uri=o.uriPointer[0],o.uri){if("generic_diffuse"==J)o.mapName="map",(!c.color||0===c.color.r&&0===c.color.g&&0===c.color.b)&&c.color.setRGB(1,1,1);else if("generic_bump"==J)o.mapName=E?"normalMap":"bumpMap";else if("generic_specular"==J)o.mapName="specularMap";else{if("generic_alpha"!=J)continue;o.mapName="alphaMap",c.side=da.DoubleSide,c.transparent=!0}c.textureMaps[o.mapName]=o}0===B.r&&0===B.g&&0===B.b&&0===C.r&&0===C.g&&0===C.b&&0===A.r&&0===A.g&&0===A.b&&0===D.r&&0===D.g&&0===D.b&&(B.r=B.g=B.b=.4),c.extraDepthOffset=e(m,"generic_depth_offset"),c.extraDepthOffset&&(c.polygonOffset=!0,c.polygonOffsetFactor=c.extraDepthOffset,c.polygonOffsetUnits=0)}else c.ambient=new da.Color(197379),c.color=new da.Color(7829367),c.specular=new da.Color(3355443),c.shininess=30,c.shading=da.SmoothShading;return a.transparent=c.transparent,c}function t(a,b,c,d){a.scale(d);var e=new da.Vector3(Math.sin(c.x),Math.sin(c.y),Math.sin(c.z)),f=new da.Vector3(Math.cos(c.x),Math.cos(c.y),Math.cos(c.z)),g=e.y*e.x,h=e.y*f.x,i=new da.Matrix4;i.set(f.z*f.y,e.z*f.y,-e.y,0,f.z*g-e.z*f.x,e.z*g+f.z*f.x,f.y*e.x,0,f.z*h+e.z*e.x,e.z*h-f.z*e.x,f.y*f.x,0,0,0,0,1),i.multiply(a),a.makeTranslation(b.x,b.y,b.z),a.multiply(i)}function u(a){var b=Math.sin(a),c=Math.cos(a),d=new da.Matrix4;return d.set(c,-b,0,0,b,c,0,0,0,0,1,0,0,0,0,1),d}function v(a){var b=["opaque_albedo_map","opaque_f0_map","layered_diffuse_map","layered_bottom_f0_map","surface_roughness_map","surface_normal_map","surface_albedo_map","surface_anisotropy_map","surface_cutout_map"];if(void 0!==a.textureMaps)for(var c=0;c<b.length;++c)if(void 0!==a.textureMaps[b[c]]&&void 0!==a.textureMaps[b[c]].textureObj&&void 0!==a.textureMaps[b[c]].textureObj.matrix){var d=a.textureMaps[b[c]].textureObj.matrix.elements,e=new da.Matrix4;return e.set(d[0],d[1],0,d[2],d[3],d[4],0,d[5],0,0,1,0,d[6],d[7],0,d[8]),e}return new da.Matrix4}function w(a,b){var c=new da.Matrix4;c.makeScale(b.x,b.y,1);var d=new da.Matrix4;return d.makeTranslation(-a.x,-a.y,0),c.multiply(d),c}function x(a,b){if(0!==b.randomOffsetMode){a.tilingRandomAxisS=new da.Vector2,a.tilingRandomAxisT=new da.Vector2,a.tilingRandomAlignmentOffset=new da.Vector2;var c=a.tilingRandomAxisS;c.set(1,0);var d=a.tilingRandomAxisT;d.set(0,1);var e=a.tilingRandomAlignmentOffset;e.set(0,0);var f=new da.Matrix4,g=new da.Matrix4,h=v(a),i=w(new da.Vector2(0,1),new da.Vector2(1,-1));i.multiply(h),h.copy(i),f.multiplyMatrices(h,a.tilingUVTransform),g.getInverse(f);var j=new da.Vector4(1,0,0,0).applyMatrix4(g);c.set(j.x,j.y),j=new da.Vector4(0,1,0,0).applyMatrix4(g),d.set(j.x,j.y);for(var k=new da.Vector2,l=new da.Box2,m=b.alignedVertices,n=0;n<m.length;n++)j.set(m[n].x,m[n].y,0,1),j.applyMatrix4(f),k.set(j.x,j.y),l.expandByPoint(k);j.set(-l.min.x,-l.min.y,0,0),j.applyMatrix4(g),e.set(j.x,j.y);var o=l.size(),p=1===b.randomOffsetMode?new da.Vector2(o.x,o.y):new da.Vector2(0,0);c.multiplyScalar(1-p.x),d.multiplyScalar(1-p.y)}}function y(a,b,c,d,f){var h=b.properties,j={overallTransform:new da.Matrix4,insetSize:0,hasRoundCorner:!1,cornerRoundingAngle:0,cornerRoundingSize:0,offsetVectorA:new da.Vector2,offsetVectorB:new da.Vector2},k=new da.Vector2(i(h,"scale_factor_x",f,1),i(h,"scale_factor_y",f,1)),l=i(h,"overall_offset_vector_x",f,1),m=i(h,"overall_offset_vector_y",f,1),n=e(h,"overall_rotation_angle",0)*Math.PI/180;t(j.overallTransform,new da.Vector3(-l,-m,0),new da.Vector3(0,0,-n),new da.Vector3(1,1,1)),j.insetSize=i(h,"inset_size",f,1),j.cornerRoundingAngle=e(h,"overall_corner_rounding_angle",0)*Math.PI/180,j.cornerRoundingSize=i(h,"overall_corner_rounding_size",f,1),j.offsetVectorA.x=e(h,"offset_vector_a_x",0)*k.x,j.offsetVectorA.y=e(h,"offset_vector_a_y",0)*k.y,j.offsetVectorB.x=e(h,"offset_vector_b_x",0)*k.x,j.offsetVectorB.y=e(h,"offset_vector_b_y",0)*k.y,j.hasRoundCorner=j.cornerRoundingAngle>0&&j.cornerRoundingSize>0;var o=void 0,p=void 0,q=[];for(o=0,p=c.length;o<p;o++){var r=c[o].properties,s={material:d[o].material,randomOffsetMode:0,rotation:0,vertices:[]};q[o]=s,s.randomOffsetMode=g(r,"choicelists","random_offset_mode",0),s.rotation=e(r,"rotation_angle",0)*Math.PI/180;for(var v=r.scalars.vertices.values,w=0;w<v.length;w+=2)s.vertices[w/2]=new da.Vector2(v[w],v[w+1]);for(var y=0;y<s.vertices.length;y++)s.vertices[y].multiply(k);s.material.useRandomOffset=0!=s.randomOffsetMode}z(j,q);var A=[j.offsetVectorA.clone(),j.offsetVectorB.clone()],B=L(A);for(o=0,p=q.length;o<p;o++){var C=q[o],D=C.material;D.tilingOverallTransform=j.overallTransform,D.hasRoundCorner=j.hasRoundCorner,D.tilingUVTransform=u(C.rotation),D.useRandomOffset&&x(D,C),D.tile2uv=new da.Vector4(j.offsetVectorA.x,j.offsetVectorA.y,j.offsetVectorB.x,j.offsetVectorB.y),D.uv2tile=new da.Vector4(B[0].x,B[0].y,B[1].x,B[1].y)}}function z(a,b){var c=new da.Box2;c.expandByPoint(new da.Vector2(0,0)),c.expandByPoint(a.offsetVectorA),c.expandByPoint(a.offsetVectorB);var d=new da.Vector2(a.offsetVectorA.x,a.offsetVectorA.y);d.add(a.offsetVectorB),c.expandByPoint(d);var e=void 0,f=void 0;for(e=0,f=b.length;e<f;e++){var g=b[e];g.material.tilingRepeatRange=[],K(a,g,g.material.tilingRepeatRange),g.bbox=new da.Box2;for(var h=0;h<g.vertices.length;++h)g.bbox.expandByPoint(g.vertices[h]);O(a,g),a.hasRoundCorner&&E(a,g),g.material.useRandomOffset&&J(g,e),g.alignedVertices=[];for(var i=0;i<g.vertices.length;++i){var j=new da.Vector2(g.vertices[i].x,g.vertices[i].y);j.sub(g.bbox.min),g.alignedVertices.push(j)}g.material.tileAlignOffset=new da.Vector2(-g.bbox.min.x,-g.bbox.min.y)}}function A(a,b){a.normalToEdges=[];for(var c=a.vertices.length,d=Math.cos(b),e=Math.sin(b),f=0;f<c;++f){var g=f,h=f==c-1?0:f+1,i=new da.Vector2(a.vertices[h].x,a.vertices[h].y);i.sub(a.vertices[g]),i.normalize();var j=new da.Vector3(i.y*e,-i.x*e,d);a.normalToEdges.push(j)}a.cornerRoundingAngle=b}function B(a,b,c){var d=new da.Vector2(c.x,c.y).sub(b),e=new da.Vector2(a.x,a.y).sub(b),f=d.dot(e);if(f<=0)return e.length();var g=d.dot(d);if(f>=g){return new da.Vector2(a).sub(c).length()}return Math.sqrt(Math.max(e.dot(e)-f*f/g,0))}function C(a,b){for(var c=1e11,d=c,e=-1,f=0;f<a.vertices.length;f++){var g=f==a.vertices.length-1?0:f+1;d=B(b,a.vertices[f],a.vertices[g]),d<c&&(c=d,e=f)}return[c,e]}function D(a,b,c){for(var d=a.length,e=d-1,f=!1,g=0;g<d;++g)(a[g].y<c&&a[e].y>=c||a[e].y<c&&a[g].y>=c)&&a[g].x+(c-a[g].y)/(a[e].y-a[g].y)*(a[e].x-a[g].x)<b&&(f=!f),e=g;return f}function E(a,b){var c=b.bbox.size(),d=2*a.cornerRoundingSize*.7071/3,e=M(Math.ceil(c.x/d)+2,128,1024),f=M(Math.ceil(c.y/d)+2,128,1024);e-=2,f-=2,c.x<c.y?f=Math.floor(e*c.y/c.x):e=Math.floor(f*c.x/c.y),e+=2,f+=2,A(b,a.cornerRoundingAngle)
;for(var g=new Uint8Array(e*f*4),h=new da.Vector2(c.x/(e-2),c.y/(f-2)),i=new da.Vector2,j=new da.Vector3,k=new da.Vector3(0,0,1),l=0,m=0;m<f;m++){i.y=(f-m-1.5)*h.y+b.bbox.min.y;for(var n=0;n<e;n++){i.x=(n-.5)*h.x+b.bbox.min.x;var o=C(b,i),p=o[0],q=o[1];p<a.cornerRoundingSize+a.insetSize?(D(b.vertices,i.x,i.y)||(p=-p),j.copy(b.normalToEdges[q]),j.lerp(k,(p-a.insetSize)/a.cornerRoundingSize),j.normalize(),g[l++]=255*M(.5*(j.x+1),0,1),g[l++]=255*M(.5*(j.y+1),0,1),g[l++]=255*M(.5*(j.z+1),0,1),g[l++]=255):(g[l++]=127,g[l++]=127,g[l++]=255,g[l++]=255)}}b.material.TilingNormalMap=new da.DataTexture(g,e,f,da.RGBAFormat,da.UnsignedByteType,da.UVMapping,da.ClampToEdgeWrapping,da.ClampToEdgeWrapping,da.LinearFilter,da.LinearFilter),b.material.TilingNormalMap.needsUpdate=!0;var r=new da.Vector2(-b.bbox.min.x,-b.bbox.min.y);b.material.TilingNormalMap_texMatrix=new da.Matrix3,b.material.TilingNormalMap_texMatrix.set(1/c.x*(e-2)/e,0,0,0,1/c.y*(f-2)/f,0,r.x/c.x*(e-2)/e+1/e,r.y/c.y*(f-2)/f+1/f,1),b.material.TilingNormalMap_texMatrix.transpose()}function F(a,b){return a<<b|a>>>32-b}function G(a,b,c){var d=4294967296;return c^=b,c=(c-F(b,14)+d)%d,a^=c,a=(a-F(c,11)+d)%d,b^=a,b=(b-F(a,25)+d)%d,c^=b,c=(c-F(b,16)+d)%d,a^=c,a=(a-F(c,4)+d)%d,b^=a,b=(b-F(a,14)+d)%d,c^=b,c=(c-F(b,24)+d)%d}function H(a,b){var c=void 0,d=void 0,e=void 0;return c=d=e=3735928567+b,d+=a.y,c+=a.x,G(c,d,e)}function I(a,b){var c=H(a,33);b.x=(65535&c)>>>8,b.y=c>>>16>>>8}function J(a,b){for(var c=new Uint8Array(1048576),d=new da.Vector2,e=new da.Vector2(107021*b,b),f=new da.Vector2,g=new da.Vector2,h=0,i=0;i<512;i++){d.y=Math.floor(-(i+1-256));for(var j=0;j<512;j++)d.x=Math.floor(j-256),f.copy(d),f.add(e),I(f,g),c[h++]=0,c[h++]=0,c[h++]=g.x,c[h++]=g.y}a.material.TilingRandomMap=new da.DataTexture(c,512,512,da.RGBAFormat,da.UnsignedByteType,da.UVMapping,da.RepeatWrapping,da.RepeatWrapping,da.NearestFilter,da.NearestFilter),a.material.TilingRandomMap.needsUpdate=!0;new da.Vector2(-a.bbox.min.x,-a.bbox.min.y);a.material.TilingRandomMap_texMatrix=new da.Matrix3,a.material.TilingRandomMap_texMatrix.set(1/512,0,0,0,1/512,0,.5,.5,1),a.material.TilingRandomMap_texMatrix.transpose()}function K(a,b,c){var d=[];d[0]=new da.Vector2(a.offsetVectorA.x,a.offsetVectorB.x),d[1]=new da.Vector2(a.offsetVectorA.y,a.offsetVectorB.y);for(var e=L(d),f=new da.Box2,g=new da.Vector2,h=0;h<b.vertices.length;++h)g.x=b.vertices[h].dot(e[0]),g.y=b.vertices[h].dot(e[1]),f.expandByPoint(g);c[0]=Math.floor(f.min.x-1),c[2]=Math.ceil(f.max.x),c[1]=Math.floor(f.min.y-1),c[3]=Math.ceil(f.max.y)}function L(a){var b=a[0].x*a[1].y-a[0].y*a[1].x,c=[];return c[0]=new da.Vector2(a[1].y/b,-a[0].y/b),c[1]=new da.Vector2(-a[1].x/b,a[0].x/b),c}function M(a,b,c){return a>c?c:a<b?b:a}function N(a,b){for(var c=a.addBlankContour(),d=new da.Vector2,e=new da.Vector2,f=0;f<b.vertices.length;++f){var g=f,h=(f+1)%b.vertices.length;d=b.vertices[g],e=b.vertices[h],c.addEdge(new ba.MSDFLinearSegment(d,e,ba.MSDF_EDGE_COLOR_WHITE))}a.initialize(),a.edgeColoringSimple(3,0)}function O(a,b){var c=new ba.MSDFShape;N(c,b);for(var d=b.bbox.size(),e=.7071*c.minSameColoredEdgeDistance()*.5,f=M(Math.ceil(d.x/e)+2,16,512),g=M(Math.ceil(d.y/e)+2,16,512),h=new Uint8Array(f*g*4),i=new da.Vector2(d.x/(f-2),d.y/(g-2)),j=(new da.Vector2(i.x*f,i.y*g),.5/(i.x+i.y)),k=new da.Vector2,l=new da.Vector3,m=0,n=0;n<g;n++){k.y=(g-n-1.5)*i.y+b.bbox.min.y;for(var o=0;o<f;o++)k.x=(o-.5)*i.x+b.bbox.min.x,l=c.calculateMSDFValue(k),l=l.add(new da.Vector3(a.insetSize,a.insetSize,a.insetSize)),h[m++]=255*M(l.x*j+.5,0,1),h[m++]=255*M(l.y*j+.5,0,1),h[m++]=255*M(l.z*j+.5,0,1),h[m++]=0}b.material.TilingMap=new da.DataTexture(h,f,g,da.RGBAFormat,da.UnsignedByteType,da.UVMapping,da.ClampToEdgeWrapping,da.ClampToEdgeWrapping,da.LinearFilter,da.LinearFilter),b.material.TilingMap.needsUpdate=!0;var p=new da.Vector2(-b.bbox.min.x,-b.bbox.min.y);b.material.TilingMap_texMatrix=new da.Matrix3,b.material.TilingMap_texMatrix.set(1/d.x*(f-2)/f,0,0,0,1/d.y*(g-2)/g,0,p.x/d.x*(f-2)/f+1/f,p.y/d.y*(g-2)/g+1/g,1),b.material.TilingMap_texMatrix.transpose()}function P(a,b,c){var d=a.properties;b.clampS=!g(d,"booleans","texture_URepeat",!1),b.clampT=!g(d,"booleans","texture_VRepeat",!1),b.wrapS=b.clampS?da.ClampToEdgeWrapping:da.RepeatWrapping,b.wrapT=b.clampT?da.ClampToEdgeWrapping:da.RepeatWrapping,b.matrix=a.matrix||(a.matrix=o(d,c)),"UnifiedBitmap"==a.definition&&(b.invert=g(d,"booleans","unifiedbitmap_Invert",!1)),"BumpMap"==a.definition&&(b.bumpmapType=g(d,"choicelists","bumpmap_Type",0),b.bumpScale=n(d,b.bumpmapType,c))}function Q(a){var b=e(a,"texture_UScale",1),c=e(a,"texture_VScale",1),d=e(a,"texture_UOffset",0),f=e(a,"texture_VOffset",0),g=e(a,"texture_WAngle",0);return{elements:[Math.cos(g)*b,Math.sin(g)*c,0,-Math.sin(g)*b,Math.cos(g)*c,0,d,f,1]}}function R(a,b){if(a){var c=a.properties;b.invert=f(c,"unifiedbitmap_Invert"),b.clampS=!f(c,"texture_URepeat",!0),b.clampT=!f(c,"texture_VRepeat",!0),b.wrapS=b.clampS?da.ClampToEdgeWrapping:da.RepeatWrapping,b.wrapT=b.clampT?da.ClampToEdgeWrapping:da.RepeatWrapping,b.matrix=a.matrix||(a.matrix=Q(c))}}function S(a,b,c){return a.matrix||(a.matrix=b?o(a.properties,c):Q(a.properties)),a.matrix}function T(a,b,c,d){"bumpMap"==a.mapName||"normalMap"==a.mapName?b.anisotropy=0:b.anisotropy=d||0,b.flipY=void 0===a.flipY||a.flipY,b.invert=!1,b.wrapS=da.RepeatWrapping,b.wrapT=da.RepeatWrapping,a.isPrism?P(a.textureObj,b,c):R(a.textureObj,b)}function U(a){var b=a.materials,c=b[a.userassets[0]];if(c){var d=c.definition;if("TilingPattern"===d){c=b[c.properties.references.grout_material.connections[0]],c&&(d=c.definition)}return"PrismLayered"==d||"PrismMetal"==d||"PrismOpaque"==d||"PrismTransparent"==d||"PrismGlazing"==d||"PrismWood"==d}return!1}function V(a){var b=a.materials,c=b[a.userassets[0]];if(c){if("TilingPattern"===c.definition)return!0}return!1}function W(a,b){var c=new da.MeshPhongMaterial;c.packedNormals=!0,c.textureMaps={};var d=a.values,e=d.diffuse;if(e)if(Array.isArray(e))c.color=new da.Color(e[0],e[1],e[2]);else if("string"==typeof e){c.color=new da.Color(1,1,1);var f={};f.mapName="map";var g=b.gltf.textures[e];f.uri=g.source,f.flipY=!1,c.textureMaps[f.mapName]=f}var h=d.specular;return h&&(c.specular=new da.Color(h[0],h[1],h[2])),d.shininess&&(c.shininess=d.shininess),c.reflectivity=0,c.transparent=!1,c}function X(a){return.299*a.r+.587*a.g+.114*a.b}function Y(a,b,c){var d=a.proteinMat?a.proteinMat:null,e=a.prismType&&-1!==a.prismType.indexOf("Prism");e&&a.transparent&&(a.side===da.FrontSide&&"PrismGlazing"!=a.prismType&&(a.side=da.DoubleSide),a.side===da.DoubleSide&&a.depthTest&&(a.twoPassTransparency=!0));var f=a.textureMaps||{};if(!b){var g=a.proteinType&&-1!==a.proteinType.indexOf("Prism");if(a.metal)a.reflectivity||(a.reflectivity=X(a.specular)),d&&(1===a.reflectivity&&(a.reflectivity=X(a.specular)),0===a.color.r&&0===a.color.g&&0===a.color.b||(a.color.r*=.1,a.color.g*=.1,a.color.b*=.1));else if(g){var h=!1;if("PrismLayered"===a.proteinType){a.clearcoat=!0,a.reflectivity=.06;var i=a.proteinCategories;i&&i.length&&-1!=i[0].indexOf("Metal")&&(h=!0)}a.reflectivity=Math.sqrt(a.reflectivity),h?a.specular.copy(a.color):(a.specular.r=a.reflectivity,a.specular.g=a.reflectivity,a.specular.b=a.reflectivity)}else a.reflectivity?a.reflectivity>.3?(a.metal=!0,a.specular.r=a.color.r,a.specular.g=a.color.g,a.specular.b=a.color.b,a.color.r*=.1,a.color.g*=.1,a.color.b*=.1):(a.specular.r*=a.reflectivity,a.specular.g*=a.reflectivity,a.specular.b*=a.reflectivity):1!==a.color.r||1!==a.color.g||1!==a.color.b||1!==a.specular.r||1!==a.specular.g||1!==a.specular.b||f.map||f.specularMap?(a.reflectivity=.01+.06*X(a.specular),a.specular.r*=a.reflectivity,a.specular.g*=a.reflectivity,a.specular.b*=a.reflectivity):(a.metal=!0,a.reflectivity=.7,a.color.r*=.1,a.color.g*=.1,a.color.b*=.1),a.opacity<1&&(a.reflectivity=1);(a.transparent||f.map&&-1!==f.map.uri.toLowerCase().indexOf(".png")||f.alphaMap)&&(a.alphaTest=.01)}if(f.normalMap){var j=a.bumpScale;(void 0===j||j>=1)&&(j=1),a.normalScale=new da.Vector2(j,j)}else void 0===a.bumpScale&&(f.map||f.bumpMap)?a.bumpScale=.03:a.bumpScale>=1&&(a.bumpScale=.03);if((!b||e)&&a.transparent)if(e)a.lmv_depthWriteTransparent=!0,a.depthWrite=!!c;else if(a.opacity>=1){var k=f.alphaMap;k||(a.transparency=!1)}else a.lmv_depthWriteTransparent=!0,a.depthWrite=!!c;void 0!==a.shininess&&(a.shininess*=.25)}function Z(a,b){if(b.attributes.color&&(a.vertexColors=da.VertexColors,a.needsUpdate=!0),!a.proteinType&&b.attributes.uv&&b.attributes.uv.isPattern){var c=!1;a.map&&!a.bumpMap&&(a.bumpMap=a.map,a.needsUpdate=!0,c=!0),a.textureMaps&&a.textureMaps.map&&!a.textureMaps.bumpMap&&(a.textureMaps.bumpMap=a.textureMaps.map,a.needsUpdate=!0,c=!0),c&&void 0===a.bumpScale&&(a.bumpScale=.03)}}Object.defineProperty(b,"__esModule",{value:!0}),b.MaterialConverter=void 0;var $,_,aa=c(101),ba=c(110),ca=c(2),da=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(ca),ea={MilliMeter:1e3,mm:1e3,8206:1e3,DeciMeter:10,dm:10,8204:10,CentiMeter:100,cm:100,8205:100,Meter:1,m:1,8193:1,KiloMeter:.001,km:.001,8201:.001,Inch:39.37008,in:39.37008,8214:39.37008,Foot:3.28084,ft:3.28084,8215:3.28084,Mile:62137e-8,mi:62137e-8,8225:62137e-8,Yard:1.09361,yard:1.09361,8221:1.09361};b.MaterialConverter={convertMaterial:s,materialTilingPattern:y,convertTexture:T,get2DMapTransform:S,isPrismMaterial:U,hasTiling:V,convertMaterialGltf:W,applyAppearanceHeuristics:Y,applyGeometryFlagsToMaterial:Z}},function(a,b,c){"use strict";function d(){this.distance=t,this.dot=1}function e(a,b){return a.x*b.y-a.y*b.x}function f(a,b,c){b=b,c=c;var d=a.length();return 0===d?b?new s.Vector2(0,c?0:1):new s.Vector2(0,-(c?0:1)):b?new s.Vector2(-a.y/d,a.x/d):new s.Vector2(a.y/d,-a.x/d)}function g(a,b,c){this.p=[],this.p[0]=a.clone(),this.p[1]=b.clone(),this.color=c}function h(a,b){return(b.x-a.x)*(a.y+b.y)}function i(a){return a>0?1:a<0?-1:0}function j(){this.edges=[]}function k(a,b,c){return a.dot(b)<=0||Math.abs(e(a,b))>c}function l(a,b){return m(a,b,u)}function m(a,b,c){var d=a&c;if(d==v||d==w||d==y)return a=d^B,[a,b];if(a==u||a==B){return a=[A,z,x][b%3],b=Math.floor(b/3),[a,b]}var e=a<<1+(1&b);return a=(e|e>>3)&B,b>>=1,[a,b]}function n(){this.minDistance=new d,this.nearEdge=null,this.nearParam=0}function o(a,b,c){return Math.max(Math.min(a,b),Math.min(Math.max(a,b),c))}function p(a,b){var c=b.point(0),d=b.point(1),e=a,g=a.clone().sub(c),h=d.clone().sub(c),i=g.dot(h)/h.dot(h);return i<0?g.length():i>1?e.clone().sub(d).length():Math.abs(f(h,!1,!1).dot(g))}function q(){this.contours=[],this.windings=[],this.inverseYAxis=!1}Object.defineProperty(b,"__esModule",{value:!0}),b.MSDFLinearSegment=b.MSDFContour=b.MSDFShape=b.MSDF_EDGE_COLOR_WHITE=b.MSDF_EDGE_COLOR_CYAN=b.MSDF_EDGE_COLOR_MAGENTA=b.MSDF_EDGE_COLOR_BLUE=b.MSDF_EDGE_COLOR_YELLOW=b.MSDF_EDGE_COLOR_GREEN=b.MSDF_EDGE_COLOR_RED=b.MSDF_EDGE_COLOR_BLACK=void 0;var r=c(2),s=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(r),t=-1e240;d.prototype={constructor:d,set:function(a,b){return this.distance=a,this.dot=b,this},copy:function(a){this.distance=a.distance,this.dot=a.dot},lessThan:function(a){return Math.abs(this.distance)<Math.abs(a.distance)||Math.abs(this.distance)===Math.abs(a.distance)&&this.dot<a.dot},greaterThan:function(a){return Math.abs(this.distance)>Math.abs(a.distance)||Math.abs(this.distance)===Math.abs(a.distance)&&this.dot>a.dot},lessThanOrEquals:function(a){return Math.abs(this.distance)<Math.abs(a.distance)||Math.abs(this.distance)==Math.abs(a.distance)&&this.dot<=a.dot},greaterThanOrEquals:function(a){return Math.abs(this.distance)>Math.abs(a.distance)||Math.abs(this.distance)==Math.abs(a.distance)&&this.dot>=a.dot}};var u=b.MSDF_EDGE_COLOR_BLACK=0,v=b.MSDF_EDGE_COLOR_RED=1,w=b.MSDF_EDGE_COLOR_GREEN=2,x=b.MSDF_EDGE_COLOR_YELLOW=3,y=b.MSDF_EDGE_COLOR_BLUE=4,z=b.MSDF_EDGE_COLOR_MAGENTA=5,A=b.MSDF_EDGE_COLOR_CYAN=6,B=b.MSDF_EDGE_COLOR_WHITE=7;g.prototype={constructor:g,set:function(a){return this.color=a,this},clone:function(){return new this.constructor(this.p[0],this.p[1],this.color)},point:function(a){return this.p[0].clone().lerp(this.p[1],a)},direction:function(){return this.p[1].clone().sub(this.p[0])},signedDistance:function(a){var b=a.clone().sub(this.p[0]),c=this.direction(),g=b.dot(c)/c.dot(c),h=this.p[g>.5?1:0].clone().sub(a),i=h.length();if(g>0&&g<1){var j=f(c,!1,!1).dot(b);if(Math.abs(j)<i){var k=new d;return k.set(j,0),[k,g]}}var l=2*(e(b,c)>0?1:0)-1,m=new d;return m.set(l*i,Math.abs(c.normalize().dot(h.normalize(h)))),[m,g]},distanceToPseudoDistance:function(a,b,c){var d=void 0,f=void 0,g=void 0;if(c<0){f=this.direction().normalize();var h=b.clone().sub(this.p[0]);g=h.dot(f),g<0&&(d=e(h,f),Math.abs(d)<=Math.abs(a.distance)&&(a.distance=d,a.dot=0))}else if(c>1){f=this.direction().normalize();var i=b.clone().sub(this.p[1]);g=i.dot(f),g>0&&(d=e(i,f),Math.abs(d)<=Math.abs(a.distance)&&(a.distance=d,a.dot=0))}},moveStartPoint:function(a){this.p[0].copy(a)},moveEndPoint:function(a){this.p[1].copy(a)},splitInThirds:function(a,b,c){var d=this.point(1/3),e=this.point(2/3);new g(this.p[0],d,this.color),new g(d,e,this.color),new g(e,this.p[1],this.color)}},j.prototype={constructor:j,addEdge:function(a){this.edges.push(a)},winding:function(){if(0===this.edges.length)return 0;var a=0,b=void 0,c=void 0,d=void 0,e=void 0;if(1==this.edges.length)b=new s.Vector2,c=new s.Vector2,d=new s.Vector2,b.copy(this.edges[0].point(0)),c.copy(this.edges[0].point(1/3)),d.copy(this.edges[0].point(2/3)),a+=h(b,c),a+=h(c,d),a+=h(d,b);else if(2==this.edges.length)b=new s.Vector2,c=new s.Vector2,d=new s.Vector2,e=new s.Vector2,b.copy(this.edges[0].point(0)),c.copy(this.edges[0].point(.5)),d.copy(this.edges[1].point(0)),e.copy(this.edges[1].point(.5)),a+=h(b,c),a+=h(c,d),a+=h(d,e),a+=h(e,b);else{var f=new s.Vector2,g=new s.Vector2;f=this.edges[this.edges.length-1].point(0);for(var j=0;j<this.edges.length;j++)g=this.edges[j].point(0),a+=h(f,g),f=g}return i(a)}},n.prototype={constructor:n,clear:function(){this.nearEdge=null,this.nearParam=0},copy:function(a){this.minDistance.copy(a.minDistance),this.nearEdge=a.nearEdge,this.nearParam=a.nearParam}},q.prototype={constructor:q,addContour:function(a){this.contours.push(a)},addBlankContour:function(){var a=new j;return this.contours.push(a),a},initialize:function(){for(var a=(this.contours.length,0);a<this.contours.length;++a){var b=this.contours[a];this.windings.push(b.winding())}},edgeColoringSimple:function(a,b){for(var c=Math.sin(a),d=0;d<this.contours.length;++d){var e=this.contours[d],f=[];if(e.edges.length>0)for(var g=e.edges[e.edges.length-1].direction(1),h=0;h<e.edges.length;++h){var i=e.edges[h];k(g.normalize(),i.direction(0).normalize(),c)&&f.push(h),g=i.direction(1)}if(0===f.length)for(var j=0;j<e.edges.length;++j)e.edges[j].color=B;else if(1==f.length){var n=[B,B],o=l(n[0],b);n[0]=o[0],b=o[1],n[2]=n[0],o=l(n[0],b),n[0]=o[0],b=o[1];var p=f[0];if(e.edges.length>=3)for(var q=e.edges.length,r=0;r<q;++r)e.edges[(p+r)%q].color=n[Math.floor(2.875*r/(q-1)+.0625)];else if(e.edges.length>=1){var s=[];e.edges[0].splitInThirds(s[0+3*p],s[1+3*p],s[2+3*p]),e.edges.length>=2?(e.edges[1].splitInThirds(s[3-3*p],s[4-3*p],s[5-3*p]),s[0].color=s[1].color=n[0],s[2].color=s[3].color=n[1],s[4].color=s[5].color=n[2]):(s[0].color=n[0],s[1].color=n[1],s[2].color=n[2]),e.edges.clear();for(var t=0;t<s.length;++t)e.edges.push(s[t])}}else{var u=f.length,v=0,w=f[0],x=e.edges.length,y=B,z=l(y,b);y=z[0],b=z[1];for(var A=y,C=0;C<x;++C){var D=(w+C)%x;v+1<u&&f[v+1]==D&&(++v,z=m(y,b,(v===u-1?1:0)*A),y=z[0],b=z[1]),e.edges[D].color=y}}}},calculateMSDFValue:function(a){for(var b=this.contours.length,c=[],d=new n,e=new n,f=new n,g=Math.abs(t),h=-t,i=t,j=0,k=new n,l=new n,m=new n,p=0;p<this.contours.length;++p){c[p]={r:t,g:t,b:t,med:t};var q=this.contours[p];k.clear(),l.clear(),m.clear();for(var r=0;r<q.edges.length;++r){var u=q.edges[r],x=u.signedDistance(a),z=x[0],A=x[1];(u.color&v)>0&&z.lessThan(k.minDistance)&&(k.minDistance.copy(z),k.nearEdge=u,k.nearParam=A),(u.color&w)>0&&z.lessThan(l.minDistance)&&(l.minDistance.copy(z),l.nearEdge=u,l.nearParam=A),(u.color&y)>0&&z.lessThan(m.minDistance)&&(m.minDistance.copy(z),m.nearEdge=u,m.nearParam=A)}k.minDistance.lessThan(d.minDistance)&&d.copy(k),l.minDistance.lessThan(e.minDistance)&&e.copy(l),m.minDistance.lessThan(f.minDistance)&&f.copy(m);var B=Math.abs(o(k.minDistance.distance,l.minDistance.distance,m.minDistance.distance));B<g&&(g=B,j=-this.windings[p]),k.nearEdge&&k.nearEdge.distanceToPseudoDistance(k.minDistance,a,k.nearParam),l.nearEdge&&l.nearEdge.distanceToPseudoDistance(l.minDistance,a,l.nearParam),m.nearEdge&&m.nearEdge.distanceToPseudoDistance(m.minDistance,a,m.nearParam),B=o(k.minDistance.distance,l.minDistance.distance,m.minDistance.distance),c[p].r=k.minDistance.distance,c[p].g=l.minDistance.distance,c[p].b=m.minDistance.distance,c[p].med=B,this.windings[p]>0&&B>=0&&Math.abs(B)<Math.abs(i)&&(i=B),this.windings[p]<0&&B<=0&&Math.abs(B)<Math.abs(h)&&(h=B)}d.nearEdge&&d.nearEdge.distanceToPseudoDistance(d.minDistance,a,d.nearParam),e.nearEdge&&e.nearEdge.distanceToPseudoDistance(e.minDistance,a,e.nearParam),f.nearEdge&&f.nearEdge.distanceToPseudoDistance(f.minDistance,a,f.nearParam);var C={r:t,g:t,b:t,med:t};if(i>=0&&Math.abs(i)<=Math.abs(h)){C.med=t,j=1;for(var D=0;D<b;++D)this.windings[D]>0&&c[D].med>C.med&&Math.abs(c[D].med)<Math.abs(h)&&(C=c[D])}else if(h<=0&&Math.abs(h)<=Math.abs(i)){C.med=-t,j=-1;for(var E=0;E<b;++E)this.windings[E]<0&&c[E].med<C.med&&Math.abs(c[E].med)<Math.abs(i)&&(C=c[E])}for(var F=0;F<b;++F)this.windings[F]!=j&&Math.abs(c[F].med)<Math.abs(C.med)&&(C=c[F]);return o(d.minDistance.distance,e.minDistance.distance,f.minDistance.distance)==C.med&&(C.r=d.minDistance.distance,C.g=e.minDistance.distance,C.b=f.minDistance.distance),new s.Vector3(C.r,C.g,C.b)},minSameColoredEdgeDistance:function(){for(var a=[1e10,1e10,1e10],b=0;b<this.contours.length;++b)for(var c=this.contours[b],d=0;d<c.edges.length;++d)for(var e=c.edges[d],f=0;f+1<d;++f){var g=c.edges[f];if(e.color==g.color){var h=Math.min(Math.min(p(e.point(0),g),p(e.point(1),g)),Math.min(p(g.point(0),e),p(g.point(1),e))),i=e.color-z;a[i]=Math.min(a[i],h)}}return Math.min(Math.min(a[0],a[1]),a[2])}},b.MSDFShape=q,b.MSDFContour=j,b.MSDFLinearSegment=g},function(a,b,c){"use strict";function d(a,b){a.x=b.r,a.y=b.g,a.z=b.b,a.w=1}function e(a){this._renderer=a,this._textures={},this._texturesToUpdate=[],this._materials={},this._materialsNonHDR={},this._exposureBias=0,this._tonemapMethod=0,this._envMapExposure=1,this._envRotationSin=0,this._envRotationCos=1,this._reflectionMap=null,this._irradianceMap=null,this._cutplanes=[],this._mrtNormals=!1,this._mrtIdBuffer=void 0,this._polygonOffsetOn=!1,this._pixelsPerUnit=1,this._layerMaskTex=null,this._layersMap=null,this._lineStyleTex=null,this._selectionTex=null,this._swapBlackAndWhite=0,this._grayscaleLines=0,this._depthWriteTransparent=!0,this._needsTwoSided=!1,this._hasTransparentMaterial=!1,this.hasPrism=!1,this.defaultMaterial=new m.MeshPhongMaterial({ambient:197379,color:7829367,specular:3355443,shininess:30,shading:m.SmoothShading,reflectivity:0}),this.addMaterial("__defaultMaterial__",this.defaultMaterial)}function f(a,b,c){var d=a.slots[c];d?-1==d.indexOf(b)&&d.push(b):a.slots[c]=[b]}Object.defineProperty(b,"__esModule",{value:!0}),b.MATERIAL_VARIANT=void 0,b.MaterialManager=e;var g=c(99),h=c(101),i=c(8),j=c(109),k=(c(112),c(139)),l=c(2),m=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(l),n=c(40),o=c(142),p=c(145),q=new m.Color("#0000FF"),r=b.MATERIAL_VARIANT={INSTANCED:0,VERTEX_IDS:1};e.prototype.dtor=function(){this.cleanup(),m.Cache.clear()},e.prototype._getModelHash=function(a){return"model:"+(a?a.id:"")+"|"},e.prototype._getMaterialHash=function(a,b){return a&&a.isOTG()?b:this._getModelHash(a)+"mat:"+b},e.prototype._getTextureHash=function(a,b,c){return this._getModelHash(a)+"tex:"+b+"|map:"+c},e.prototype.addNonHDRMaterial=function(a,b){b.doNotCut||(b.cutplanes=this._cutplanes),this._materialsNonHDR[a]=b},e.prototype.removeNonHDRMaterial=function(a){delete this._materialsNonHDR[a]},e.prototype.addMaterialNonHDR=function(a,b){this.addNonHDRMaterial(a,b)},e.prototype.addHDRMaterial=function(a,b){this._reflectionMap&&!b.disableEnvMap&&(b.envMap=this._reflectionMap),this._irradianceMap&&(b.irradianceMap=this._irradianceMap),b.exposureBias=Math.pow(2,this._exposureBias),b.tonemapOutput=this._tonemapMethod,b.envMapExposure=this._envMapExposure,b.envRotationSin=this._envRotationSin,b.envRotationCos=this._envRotationCos,b.doNotCut||(b.cutplanes=this._cutplanes),this._applyMRTFlags(b),this._applyPolygonOffset(b,this._polygonOffsetOn),this._materials[a]=b},e.prototype.addMaterial=function(a,b,c){var d=b.prismType&&-1!==b.prismType.indexOf("Prism");this.hasPrism=d||this.hasPrism,j.MaterialConverter.applyAppearanceHeuristics(b,d||c,this.isDepthWriteTransparentEnabled()),this.addHDRMaterial(a,b)},e.prototype.addLineMaterial=function(a,b){this._layerMaskTex&&(b.defines.HAS_LAYERS=1,b.uniforms.tLayerMask.value=this._layerMaskTex),this._lineStyleTex&&(b.defines.HAS_LINESTYLES=1,b.defines.MAX_LINESTYLE_LENGTH=this._lineStyleTex.image.width,b.uniforms.tLineStyle.value=this._lineStyleTex,b.uniforms.vLineStyleTexSize.value.set(this._lineStyleTex.image.width,this._lineStyleTex.image.height)),b.uniforms.aaRange.value=.5/(this._pixelsPerUnit*b.modelScale),b.uniforms.pixelsPerUnit.value=this._pixelsPerUnit*b.modelScale,b.uniforms.swap.value=this._swapBlackAndWhite,b.uniforms.grayscale.value=this._grayscaleLines,this._materials[a]=b},e.prototype.addOverrideMaterial=function(a,b){if(this.addNonHDRMaterial(a,b),b.variants)for(var c=0;c<b.variants.length;c++){var d=b.variants[c];if(d){var e=a+"_variant_"+c;this.addNonHDRMaterial(e,d)}}},e.prototype.getMaterialVariant=function(a,b,c){var d=!!a.hash,e=d?a.hash:this._getModelHash(c)+a.id,f=e+"|"+b,g=this._materials[f];return g||(g=this.cloneMaterial(a,c),b===r.INSTANCED?(g.useInstancing=!0,g.vertexIds=!0):b===r.VERTEX_IDS&&(g.vertexIds=!0),this.addHDRMaterial(f,g)),d&&this._addMaterialRef(g,c.id),g},e.prototype.addInstancingSupport=function(a){var b=a.clone();b.useInstancing=!0;var c=a.clone();c.wideLines=!0,a.variants=[b,c],a.getCustomOverrideMaterial=function(a){return a.useInstancing?this.variants[0]:a.wideLines?this.variants[1]:null}},e.prototype.removeMaterial=function(a){delete this._materials[a]},e.prototype.findMaterial=function(a,b){var c=this._getMaterialHash(a,b);return this._materials[c]},e.prototype.convertSharedMaterial=function(a,b,c){var d=this.findMaterial(a,c);return d||(d=this.convertOneMaterial(a,b,c),d.hash=c),this._addMaterialRef(d,a.id),d},e.prototype.convertOneMaterial=function(a,b,c){var d=a.getData(),e=d&&d.materials?d.materials.scene.SceneUnit:"inch",f=j.MaterialConverter.convertMaterial(b,e);if(d.doubleSided&&(f.side=m.DoubleSide),this.addMaterial(c,f),this._hasTransparentMaterial=this._hasTransparentMaterial||f.transparent,j.MaterialConverter.hasTiling(b)){f.decals=[];for(var g=b.materials,h=g[b.userassets[0]],i=h.properties.references.base_materials.connections,k=h.properties.references.tiles.connections,l=[],n=0;n<k.length;n++){var o=g[k[n]];l.push(o);var p=j.MaterialConverter.convertMaterial(b,e,null,i[n]);p.useTiling=!0,p.transparent=!0,f.decals.push({uv:0,material:p}),this.addMaterial(c+"|tile|"+n,p)}j.MaterialConverter.materialTilingPattern(b,h,l,f.decals,e)}if(b.decals){f.decals||(f.decals=[]);for(var q=0,r=b.decals.length;q<r;q++){var s=b.decals[q],p=j.MaterialConverter.convertMaterial(s.material,e);f.decals.push({uv:s.uv||0,material:p}),this.addMaterial(c+"|decal|"+q,p)}}return f},e.prototype.forEach=function(a,b){var c=this._materials;for(var d in c){var e=c[d];b&&e.is2d||a(e)}},e.prototype.updateMaterials=function(){for(var a={needsClear:!1,needsRender:!1,overlayDirty:!1};this._texturesToUpdate.length;){var b=this._texturesToUpdate.pop();for(var c in b.slots)for(var d=b.slots[c],e=0;e<d.length;e++)d[e][c]=b.tex,d[e].needsUpdate=!0,a.needsClear=!0}return a},e.prototype.setTextureInCache=function(a,b,c){var d=this._getTextureHash(a,b.uri,b.mapName),e=this._textures[d];if(e){e.tex||(e.tex=c);for(var f in e.slots)for(var g=e.slots[f],h=0;h<g.length;h++)g[h][f]=c;this._texturesToUpdate.push(e)}},e.prototype.loadTextureFromCache=function(a,b,c,d){var e=this._getTextureHash(a,c.uri,c.mapName),f=this._textures[e];if(f)f.tex?(b[d]=f.tex,b.needsUpdate=!0):(f.slots[d]||(f.slots[d]=[]),f.slots[d].push(b));else{var g={};g[d]=[b],this._textures[e]={slots:g,tex:null}}return!!f},e.prototype.enumTextures=function(a,b){var c=a?this._getModelHash(a):"";for(var d in this._textures)0===d.indexOf(c)&&b(this._textures[d].tex)},e.prototype.exportModelMaterials=function(a,b){var c=this._getModelHash(a),d={};for(var e in this._materials)if(-1!==e.indexOf(c)){var f=this._materials[e],g=f.defines&&f.defines.hasOwnProperty("SELECTION_RENDERER");g||(d[e]=f)}var h={};for(var e in this._materialsNonHDR)-1!==e.indexOf(c)&&(h[e]=this._materialsNonHDR[e]);var i={};for(var j in this._textures)-1!==j.indexOf(c)&&(i[j]=this._textures[j]);return this.cleanup(a),{mats:d,matsNonHDR:h,textures:i}},e.prototype.importModelMaterials=function(a){for(var b in a.mats){var c=a.mats[b];c.is2d?this.addLineMaterial(b,c):this.addHDRMaterial(b,c)}for(var b in a.matsNonHDR)this.addMaterialNonHDR(b,a.matsNonHDR[b]);for(var d in a.textures)this._textures[d]=a.textures[d]},e.prototype.cloneMaterial=function(a,b){var c=a.isPrismMaterial?(0,h.clonePrismMaterial)(a):a.clone();if(a.defines&&(c.defines=Object.assign({},a.defines)),(c instanceof m.MeshPhongMaterial||c.isPrismMaterial)&&(c.packedNormals=a.packedNormals,c.exposureBias=a.exposureBias,c.irradianceMap=a.irradianceMap,c.envMapExposure=a.envMapExposure,c.envRotationSin=a.envRotationSin,c.envRotationCos=a.envRotationCos,c.proteinType=a.proteinType,c.proteinMat=a.proteinMat,c.proteinCategories=a.proteinCategories,c.tonemapOutput=a.tonemapOutput,c.cutplanes=a.cutplanes,c.textureMaps=a.textureMaps,c.texturesLoaded=a.texturesLoaded),a.doNotCut&&(c.doNotCut=!0),a.is2d&&(c.is2d=!0),a.disableEnvMap&&(c.disableEnvMap=!0),a.textureMaps)for(var d in a.textureMaps)if(a[d])c[d]=a[d];else if(b){var e=c.textureMaps[d],g=e.uri,j=e.mapName,k=this._getTextureHash(b,g,j),l=this._textures[k];l?f(l,c,d):i.logger.error("Missing texture receiver",k)}else i.logger.error("Cannot connect pending texture maps because cloneMaterial was called without a model");return this._applyMRTFlags(c),c},e.prototype.setupMaterial=function(a,b,c){var d=a.getData(),e=this.findMaterial(a,c);if(!e){e=this.cloneMaterial(this.defaultMaterial,a);var f=this._getMaterialHash(a,c);this._materials[f]=e,i.logger.warn("Material ("+c+") missing, using default material instead.")}if(b.isLines||b.isPoints){var g=!!b.attributes.color,h=e;h||(h=this.defaultMaterial.clone()),b.isPoints?e=new m.PointCloudMaterial({vertexColors:g,size:b.pointSize}):b.isWideLines?(e=new m.MeshBasicMaterial({vertexColors:g}),e.wideLines=!0,b.isLines=!1,e.polygonOffset=h.polygonOffset,e.polygonOffsetFactor=h.polygonOffsetFactor,e.polygonOffsetUnits=h.polygonOffsetUnits):g?(h.cachedLineMaterialVC||(h.cachedLineMaterialVC=new m.LineBasicMaterial({vertexColors:g})),e=h.cachedLineMaterialVC):(h.cachedLineMaterial||(h.cachedLineMaterial=new m.LineBasicMaterial({vertexColors:g})),e=h.cachedLineMaterial),g||(e.color=h.color),e.svfMatId=c,this.addMaterialNonHDR(d.basePath+c+"_line_"+e.id,e),d.hasLines=!0}else e.svfMatId=c,j.MaterialConverter.applyGeometryFlagsToMaterial(e,b);return e},e.prototype._addMaterialRef=function(a,b){a._sharedBy||(a._sharedBy=[]);var c=a._sharedBy;-1===c.indexOf(b)&&c.push(b)},e.prototype._removeMaterialRef=function(a,b){var c=a._sharedBy,d=c?c.indexOf(b):-1;-1!==d&&c.splice(d,1)},e.prototype.cleanup=function(a){var b=this._getModelHash(a),c={};for(var d in this._textures){var e=this._textures[d];-1===d.indexOf(b)?c[d]=e:e.tex&&(e.tex.dispose(),e.tex.needsUpdate=!0)}this._textures=c;var f={},g={type:"dispose"};for(var h in this._materials){var i=this._materials[h],j=!a||-1!==h.indexOf(b);if(i._sharedBy&&(j?i._sharedBy.length=0:(this._removeMaterialRef(i,a.id),0===i._sharedBy.length&&(j=!0))),j){var i=this._materials[h];if(i.dispatchEvent(g),i.needsUpdate=!0,i.envMap=null,i.is2d){i.uniforms.tLayerMask.value=null,i.uniforms.tLineStyle.value=null;var k=i.uniforms.tRaster;k&&k.value instanceof m.Texture&&(k.value.dispose(),k.value.needsUpdate=!0)}}else f[h]=this._materials[h]}this._materials=f;var l={};for(var h in this._materialsNonHDR)if(a&&-1===h.indexOf(b))l[h]=this._materialsNonHDR[h];else{var i=this._materialsNonHDR[h];i.dispatchEvent(g),i.needsUpdate=!0}this._materialsNonHDR=l},e.prototype.toggleDepthWriteTransparent=function(a){this._depthWriteTransparent!=a&&(this._depthWriteTransparent=a,this.forEach(function(b){b.lmv_depthWriteTransparent&&(b.depthWrite=a)}))},e.prototype.isDepthWriteTransparentEnabled=function(){return this._depthWriteTransparent},e.prototype.hasTwoSidedMaterials=function(){return this._needsTwoSided},e.prototype.hasTransparentMaterial=function(){return this._hasTransparentMaterial},e.prototype.texturesLoaded=function(){return 0===this._texturesToUpdate.length},e.prototype.renderer=function(){return this._renderer},e.prototype.setTonemapExposureBias=function(a){this._exposureBias=a;var b=Math.pow(2,a);this.forEach(function(a){a.exposureBias=b,a.needsUpdate=!0},!0)},e.prototype.setTonemapMethod=function(a){this._tonemapMethod=a,this.forEach(function(b){b.tonemapOutput=a,b.needsUpdate=!0},!0)},e.prototype.setEnvExposure=function(a){var b=Math.pow(2,a);this._envMapExposure=b,this.forEach(function(a){a.envMapExposure=b,a.needsUpdate=!0},!0)},e.prototype.setEnvRotation=function(a){var b=this._envRotationSin=Math.sin(a),c=this._envRotationCos=Math.cos(a);this.forEach(function(a){a.envRotationSin=b,a.envRotationCos=c,a.needsUpdate=!0},!0)},e.prototype.setReflectionMap=function(a){this._reflectionMap=a,this.forEach(function(b){b.disableEnvMap||(b.envMap=a,b.needsUpdate=!0)},!0)},e.prototype.setIrradianceMap=function(a){this._irradianceMap=a,this.forEach(function(b){b.irradianceMap=a,b.needsUpdate=!0},!0)},e.prototype.setCutPlanes=function(a){if(this._cutplanes.length!==(a?a.length||0:0)){this.forEach(function(b){b.doNotCut||(b.needsUpdate=!0,a&&a.length>0&&(b.side=m.DoubleSide))});for(var b in this._materialsNonHDR)this._materialsNonHDR[b].doNotCut||(this._materialsNonHDR[b].needsUpdate=!0)}for(;this._cutplanes.length>0;)this._cutplanes.pop();if(a)for(var c=0;c<a.length;c++)this._cutplanes.push(a[c].clone())},e.prototype.getCutPlanes=function(){return this._cutplanes.slice()},e.prototype.getCutPlanesRaw=function(){return this._cutplanes},e.prototype._applyPolygonOffset=function(a){(a instanceof m.MeshPhongMaterial||a.isPrismMaterial)&&(a.polygonOffset=this._polygonOffsetOn,a.polygonOffsetFactor=this._polygonOffsetFactor,a.polygonOffsetUnits=this._polygonOffsetUnits,a.extraDepthOffset&&(a.polygonOffsetFactor+=a.extraDepthOffset),a.needsUpdate=!0)},e.prototype.getPolygonOffsetOn=function(){return this._polygonOffsetOn},e.prototype.getPolygonOffsetFactor=function(){return this._polygonOffsetFactor},e.prototype.getPolygonOffsetUnits=function(){return this._polygonOffsetUnits},e.prototype.togglePolygonOffset=function(a,b,c){this._polygonOffsetOn=a,this._polygonOffsetFactor=a?b||1:0,this._polygonOffsetUnits=a?c||.1:0;var d=this;this.forEach(function(a){d._applyPolygonOffset(a)})},e.prototype._applyMRTFlags=function(a){var b=a.supportsMrtNormals||a instanceof m.MeshPhongMaterial||a.isPrismMaterial,c=a.mrtNormals,d=a.mrtIdBuffer,e=this._renderer&&this._renderer.supportsMRT();a.mrtNormals=b&&e&&this._mrtNormals,a.mrtIdBuffer=e?this._mrtIdBuffer:void 0,a.mrtNormals===c&&a.mrtIdBuffer===d||(a.needsUpdate=!0)
},e.prototype.toggleMRTSetting=function(a){this._mrtNormals=a.mrtNormals,this._mrtIdBuffer=a.mrtIdBuffer;var b=this;this.forEach(function(a){a.is2d||b._applyMRTFlags(a)})},e.prototype.initLineStyleTexture=function(){this._lineStyleTex=(0,g.createLinePatternTexture)()},e.prototype.initLayersTexture=function(a,b){for(var c=this._layerMaskTex?this._layerMaskTex.image.data:new Uint8Array(65536),d=0,e=a;d<e;d++)c[d]=255;var f=this._layerMaskTex||new m.DataTexture(c,256,256,m.LuminanceFormat,m.UnsignedByteType,m.UVMapping,m.ClampToEdgeWrapping,m.ClampToEdgeWrapping,m.NearestFilter,m.NearestFilter,0);f.generateMipmaps=!1,f.flipY=!1,f.needsUpdate=!0,this._layerMaskTex=f,this._layersMap=b},e.prototype.setLayerVisible=function(a,b){for(var c=this._layerMaskTex,d=c.image.data,e=this._layersMap,f=b?255:0,g=0;g<a.length;++g){d[e[a[g]]]=f}c.needsUpdate=!0,this.forEach(function(a){a.is2d&&(a.needsUpdate=!0)})},e.prototype.isLayerVisible=function(a){return!!this._layerMaskTex.image.data[this._layersMap[a]]},e.prototype.initSelectionTexture=function(a){for(var b=a||1,c=0|Math.ceil(b/4096),d=1;d<c;)d*=2;c=d;for(var e=new Uint8Array(4096*c),f=0;f<b;f++)e[f]=0;var g=new m.DataTexture(e,4096,c,m.LuminanceFormat,m.UnsignedByteType,m.UVMapping,m.ClampToEdgeWrapping,m.ClampToEdgeWrapping,m.NearestFilter,m.NearestFilter,0);return g.generateMipmaps=!1,g.flipY=!1,g.needsUpdate=!0,this._selectionTex=g,g},e.prototype.highlightObject2D=function(a,b){var c=this._selectionTex;if(c){c.image.data[a]=b?255:0,c.needsUpdate=!0}},e.prototype.updatePixelScale=function(a,b,c){var d=this._pixelsPerUnit=a;this.forEach(function(a){a.is2d&&(a.isScreenSpace?(a.uniforms.size.value.set(b,c),a.uniforms.aaRange.value=.5):a.uniforms.aaRange.value=.5/(d*a.modelScale),a.uniforms.pixelsPerUnit.value=d*a.modelScale)})},e.prototype.updateSwapBlackAndWhite=function(a){var b=this._swapBlackAndWhite=a?1:0;this.forEach(function(a){a.is2d&&(a.uniforms.swap.value=b)})},e.prototype.setGrayscale=function(a){var b=this._grayscaleLines=a?1:0;this.forEach(function(a){a.is2d&&(a.uniforms.grayscale.value=b)})},e.prototype.updateViewportId=function(a){this.forEach(function(b){b.is2d&&(b.uniforms.viewportId.value=a,b.needsUpdate=!0)})},e.prototype.create2DMaterial=function(a,b,c,d,e){var f=a?a.getData():null,g="__lineMaterial__";b.image&&(g+="|image:"+b.image.name),b.clip&&(g+="|clip:"+JSON.stringify(b.clip)),c&&(g+="|id"),d&&(g+="|selection"),b.skipEllipticals&&(g+="|skipEllipticals"),b.skipCircles&&(g+="|skipCircles"),b.skipTriangleGeoms&&(g+="|skipTriangleGeoms"),b.useInstancing&&(g+="|useInstancing"),b.isScreenSpace&&(g+="|isScreenSpace");var h=this._getMaterialHash(a,g);if(!this._materials.hasOwnProperty(h)){var i;if(b.isScreenSpace?(i=(0,n.createShaderMaterial)(p.LineShaderSS),i.isScreenSpace=!0):i=(0,n.createShaderMaterial)(o.LineShader),i.is2d=!0,i.transparent=!0,i.depthWrite=!1,i.depthTest=!1,i.side=m.DoubleSide,i.blending=m.NormalBlending,c?(i.defines.ID_COLOR=1,i.blending=m.NoBlending):d?(i.uniforms.tSelectionTexture.value=d,i.uniforms.vSelTexSize.value.set(d.image.width,d.image.height),i.defines.SELECTION_RENDERER=1,i.uniforms.selectionColor.value=new m.Vector4(0,0,1,1)):(this.get2dSelectionColor(i.uniforms.selectionColor),this.renderer()&&this.renderer().supportsMRT()&&(i.mrtIdBuffer=this._mrtIdBuffer)),b.skipEllipticals||(i.defines.HAS_ELLIPTICALS=1),b.skipCircles||(i.defines.HAS_CIRCLES=1),b.skipTriangleGeoms||(i.defines.HAS_TRIANGLE_GEOMS=1),b.useInstancing&&(i.defines.USE_INSTANCING=1),b.image){var j=function(c){if(!c)return void(e&&e(c,a,b));c.wrapS=m.ClampToEdgeWrapping,c.wrapT=m.ClampToEdgeWrapping,c.minFilter=m.LinearMipMapLinearFilter,c.magFilter=m.LinearFilter,c.anisotropy=1,c.flipY=!0,c.generateMipmaps=!0,c.needsUpdate=!0,i.defines.HAS_RASTER_QUADS=1,i.uniforms.tRaster.value=c,-1!==b.image.dataURI.indexOf("png")&&(i.transparent=!0),i.needsUpdate=!0,e&&e(c,a)};k.TextureLoader.loadTextureWithSecurity(b.image.dataURI,!1,m.UVMapping,j,f.acmSessionId)}i.modelScale=b.modelScale||1,i.textureMaps={},this.addLineMaterial(h,i)}return g},e.prototype.set2dSelectionColor=function(a){q=new m.Color(a),this.forEach(function(a){if(a.is2d&&a.uniforms){var b=a.uniforms.selectionColor;b&&(d(b.value,q),a.needsUpdate=!0)}})},e.prototype.get2dSelectionColor=function(a){return a&&d(a.value,q),q}},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b,c){if(a){if(a-3*b*2<=h.GPU_MEMORY_LIMIT&&c<h.GPU_OBJECT_LIMIT)return!1}return!0}function f(){function a(a){var b=r.fragments.packIds[a];r.pagingProxy.addGeomPackMissingLastFrame(b)}var b=new s.Box3,c=new s.Box3,d=new s.Box3;this.visibleBoundsDirty=!1,this.enforceBvh=!1,this.isvizCacheEnabled=!1;var f=0;this.id=y++;var g=null,r=null,A=null,B=null,C=null,D=null,E=null,F=null,G=null,H=0,I=null,J=u.RenderFlags.RENDER_NORMAL,K=z[u.RenderFlags.RENDER_NORMAL],L=!1,M=h.PAGEOUT_NONE;this.getGeometryList=function(){return g},this.getFragmentList=function(){return r},this.getModelId=function(){return this.id},this.initialize=function(a){var d=this.getData(),f=d.numGeoms||0,h=!e(d.packFileTotalSize,d.primitiveCount,f);g=new i.GeometryList(f,this.is2d(),h),r=new j.FragmentList(this,a);var k=this.getBoundingBox();k&&(b.copy(k),c.copy(k)),E=C=A=new n.ModelIteratorLinear(this),D=new n.HighlightIteratorLinear(this)},this.getIterator=function(){return C},this.initFromCustomIterator=function(a){E=C=a,this.visibleBoundsDirty=!0},this.dtor=function(a){r&&r.dispose(a),C&&C.dtor&&C.dtor(),F&&F.dispose()},this.activateFragment=function(a,e,f){r&&(r.setMesh(a,e,f),C.addFragment(a),r.getWorldBounds(a,d),b.union(d),c.union(d))},this.setFragment=function(a,e){return void 0===a&&(a=this.getFragmentList().getNextAvailableFragmentId()),r.setMesh(a,e,!0),A&&A.addFragment(a),B&&!r.fragmentsHaveBeenAdded()&&B.addFragment(a),r.getWorldBounds(a,d),b.union(d),c.union(d),a},this.setBVH=function(a,b,c){E=C=B=new o.ModelIteratorBVH,C.initialize(this,a,b,c)},this.resetIterator=function(a,b,c,d,e){return d=d||v.ResetFlags.RESET_NORMAL,r&&r.pagingProxy&&r.pagingProxy.resetIterator(a,d),d!=v.ResetFlags.RESET_NORMAL&&(d>=v.ResetFlags.RESET_REDRAW&&r&&r.onDemandLoadingEnabled()&&(r.setFlagGlobal(t.MeshFlags.MESH_TRAVERSED,!1),C.resetVisStatus(),D&&D.resetVisStatus()),d>=v.ResetFlags.RESET_RELOAD&&r&&r.pageOutGeometryEnabled()&&(M=h.PAGEOUT_NONE,r.pagingProxy&&r.pagingProxy.reset())),L=!1,B&&!r.fragmentsHaveBeenAdded()&&(L=!0),this.isvizCacheEnabled&&(L=!1),L?C=B:A&&(C=A),E=e&&D.getSceneCount()<x?D:C,H=0,J=c,K=c<z.length?z[c]:z[u.RenderFlags.RENDER_NORMAL],I=b,E.reset(b,a),r&&r.resetBoxRun(),F&&F.reset(),E},this.nextBatch=function(){for(;;){var b=E.nextBatch();if(H++,!b)return null;if(F&&b instanceof k.RenderBatch&&(b=F.consolidateNextBatch(b,I)),b.modelId=this.id,b instanceof s.Scene)return b;if(b.visibleStats&K)c=!(b.visibleStats&K<<16);else{var c=b.applyVisibility(J,I,r.pagingProxy?a:void 0);void 0!==b.visibleStats&&(b.visibleStats|=K,c||(b.visibleStats|=K<<16)),c||this.is2d()||(b.sortObjects&&!this.getFragmentList().useThreeMesh?b.sortByDepth(I):b.sortDone||b.sortByMaterial())}if(!c)return b}},this.getVisibleBounds=function(a){return this.visibleBoundsDirty&&(b.makeEmpty(),c.makeEmpty(),C.getVisibleBounds(b,c,a),this.visibleBoundsDirty=!1),a?c:b},this.rayIntersect=function(a,b,c,d){this.visibleBoundsDirty&&this.getVisibleBounds();var e,f=[];if(c&&c.length>0){var g=this.getFragmentMap(),h=[];if(g)for(e=0;e<c.length;e++)g.enumNodeFragments(c[e],function(a){h.push(a)},!0);else h=c;if(h.length>2)C.rayCast(a,f,c);else for(e=0;e<h.length;e++){var i=r.getVizmesh(h[e]);if(i){var j=q.VBIntersector.rayCast(i,a,f);j&&f.push(j)}}}else C.rayCast(a,f);if(!f.length)return null;f.sort(function(a,b){return a.distance-b.distance});var k=!!d;for(d=d||[],e=0;e<f.length;e++){var l=f[e].fragId;if(!this.is2d()){if(this.isFragVisible(l)){var m=r.getMaterial(l);if(b&&m.transparent)continue;var n=f[e],o=!1,p=n.point;if(m&&m.cutplanes)for(var t=0;t<m.cutplanes.length;t++)o=o||m.cutplanes[t].dot(new s.Vector4(p.x,p.y,p.z,1))>1e-6;if(o||d.push(n),n.model=this,!k&&d.length>0)break}}}var u=d[0]||null;return u&&(u.model=this),u},this.setHighlighted=function(a,b){if(!r)return!1;var c=r.setFlagFragment(a,t.MeshFlags.MESH_HIGHLIGHTED,b);return c&&(b?(D.addFragment(a),f++):(D.removeFragment(a),f--)),c},this.setVisibility=function(a,b){r&&(r.setVisibility(a,b),this.visibleBoundsDirty=!0)},this.setAllVisibility=function(a){r&&(r.setAllVisibility(a),this.visibleBoundsDirty=!0)},this.hideLines=function(a){r&&r.hideLines(a)},this.hidePoints=function(a){r&&r.hidePoints(a)},this.hasHighlighted=function(){return!!f},this.isFragVisible=function(a){return r.isFragVisible(a)},this.areAllVisible=function(){return!r||r.areAllVisible()},this.getGeomScenes=function(){return C.getGeomScenes()},this.getRenderProgress=function(){var a=H/E.getSceneCount();return a>1?1:a},this.pageOutIfNeeded=function(a,b,c){return r.pagingProxy?r.pagingProxy.pageOut(a,b,c):h.PAGEOUT_NONE},this.frameUpdatePaging=function(a,b){return r&&r.pageOutGeometryEnabled()?(M=this.pageOutIfNeeded(!1,!1,b),E.done()&&(M=this.pageOutIfNeeded(!0,!1,b))==h.PAGEOUT_FAIL&&(M=this.pageOutIfNeeded(!0,!0,b)),M):M},this.geomPacksMissingLastFrame=function(){return r&&r.pagingProxy?r.pagingProxy.geomPacksMissingLastFrame():[]},this.addGeomPackMissingLastFrame=function(a){return!r||!r.pagingProxy||r.pagingProxy.addGeomPackMissingLastFrame(a)},this.needResumeNextFrame=function(){return!(!r||!r.pagingProxy)&&r.pagingProxy.needResumeNextFrame()},this.update=function(a){return!(!C||!C.update)&&C.update(a)},this.setThemingColor=function(a,b){a=this.reverseMapDbId(a),r?r.setThemingColor(a,b):w.logger.warn("Theming colors are not supported by this model type.")},this.clearThemingColors=function(){r&&r.clearThemingColors()},this.getLeaflet=function(){return C instanceof p.ModelIteratorTexQuad?C:null},this.consolidate=function(a,b,c){var d=(0,l.consolidateFragmentList)(r,a,b,c,G);F=new m.ConsolidationIterator(r,d),G=d.consolidationMap},this.unconsolidate=function(){F&&(F.dispose(),F=null)},this.isConsolidated=function(){return!!F},this.getConsolidation=function(){return F?F.getConsolidation():null},this.setDbIdRemap=function(a){this.is2d&&(this.idRemap=a)},this.remapDbId=function(a){return this.idRemap&&a>0&&a<this.idRemap.length?this.idRemap[a]:a},this.reverseMapDbId=function(a){if(!this.idRemap||a<=0)return a;if(!this.reverseMap){this.reverseMap={};for(var b=0;b<this.idRemap.length;b++)this.reverseMap[this.idRemap[b]]=b}return this.reverseMap[a]},this.updateRenderProxy=function(a,b){F&&F.updateRenderProxy(a,b)},this.skipOpaqueShapes=function(){C&&C.skipOpaqueShapes&&C.skipOpaqueShapes()},this.getMemoryInfo=function(){return r&&r.getMemoryInfo()}}Object.defineProperty(b,"__esModule",{value:!0}),b.RenderModel=f;var g=c(37),h=d(g),i=c(113),j=c(114),k=c(116),l=c(123),m=c(130),n=c(131),o=c(133),p=c(134),q=c(117),r=c(2),s=d(r),t=c(115),u=c(121),v=c(138),w=c(8),x=10,y=1,z=[1,8,8,2,4]},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b,c){this.geoms=[null],this.numGeomsInMemory=0,this.geomMemory=0,this.gpuMeshMemory=0,this.gpuNumMeshes=0,this.geomPolyCount=0,this.instancePolyCount=0,this.is2d=b,this.geomBoxes=new Float32Array(6*Math.max(1,a+1)),this.disableStreaming=!!c}Object.defineProperty(b,"__esModule",{value:!0}),b.GeometryList=e;var f=c(37),g=d(f),h=c(4),i=c(2),j=d(i);e.prototype.getGeometry=function(a){return this.geoms[a]},e.prototype.chooseMemoryType=function(a,b,c,d){var e=g.GPU_MEMORY_LIMIT,f=2*e,h=g.GPU_OBJECT_LIMIT;if(0===e)return a.streamingDraw=!0,void(a.streamingIndex=!0);if(this.disableStreaming||d<e&&c<h)a.streamingDraw=!1,a.streamingIndex=!1;else if(d>=f)a.streamingDraw=!0,a.streamingIndex=!0;else{var i;i=this.is2d?100001:a.byteSize*(b||1),i<1e5&&(a.streamingDraw=!0,a.streamingIndex=!0)}},e.prototype.addGeometry=function(a,b,c){this.chooseMemoryType(a,b,this.gpuNumMeshes,this.gpuMeshMemory);var d=a.byteSize+g.GEOMETRY_OVERHEAD;a.streamingDraw||((0,h.isMobileDevice)()&&(d+=a.byteSize),this.gpuMeshMemory+=a.byteSize,this.gpuNumMeshes+=1),this.numGeomsInMemory++,(void 0===c||c<=0)&&(c=this.geoms.length),this.geoms[c]=a;var e=this.geomBoxes.length/6|0;if(e<this.geoms.length){var f=3*this.geoms.length/2|0,i=new Float32Array(6*f);i.set(this.geomBoxes);var k=new j.Box3;for(k.makeEmpty();e<f;)i[6*e]=k.min.x,i[6*e+1]=k.min.y,i[6*e+2]=k.min.z,i[6*e+3]=k.max.x,i[6*e+4]=k.max.y,i[6*e+++5]=k.max.z;this.geomBoxes=i}var l=a.boundingBox;l?(this.geomBoxes[6*c]=l.min.x,this.geomBoxes[6*c+1]=l.min.y,this.geomBoxes[6*c+2]=l.min.z,this.geomBoxes[6*c+3]=l.max.x,this.geomBoxes[6*c+4]=l.max.y,this.geomBoxes[6*c+5]=l.max.z):(a.hash||console.error("Mesh without bbox and without hash should not be."),this.geomBoxes[6*c]=-.5,this.geomBoxes[6*c+1]=-.5,this.geomBoxes[6*c+2]=-.5,this.geomBoxes[6*c+3]=.5,this.geomBoxes[6*c+4]=.5,this.geomBoxes[6*c+5]=.5),g.memoryOptimizedLoading&&!this.is2d&&(a.boundingBox=null,a.boundingSphere=null),this.geomMemory+=d;var m=a.attributes.index.array||a.ib,n=a.isLines?m.length/2:m.length/3;return this.geomPolyCount+=n,this.instancePolyCount+=n*(b||1),a.polyCount=n,a.instanceCount=b||1,a.svfid=c,a.lockCount=0,c},e.prototype.removeGeometry=function(a,b){var c=this.getGeometry(a);if(!c||c.lockCount>0)return 0;var d=c.byteSize+g.GEOMETRY_OVERHEAD;return b&&b.deallocateGeometry(c),c.streamingDraw||((0,h.isMobileDevice)()&&(d+=c.byteSize),this.gpuMeshMemory-=c.byteSize,this.gpuNumMeshes-=1),this.geoms[a]=null,this.geomMemory-=d,this.numGeomsInMemory--,this.geomPolyCount-=c.polyCount,this.instancePolyCount-=c.instanceCount*c.polyCount,d},e.prototype.lockGeometry=function(a){var b=this.getGeometry(a);return!!b&&(++b.lockCount,!0)},e.prototype.unlockGeometry=function(a){var b=this.getGeometry(a);return!(!b||b.lockCount<=0)&&(--b.lockCount,!0)},e.prototype.getLockCount=function(a){var b=this.getGeometry(a);return b?b.lockCount:-1},e.prototype.getModelBox=function(a,b){if(this.geomBoxes.length/6<=a)return void b.makeEmpty();var c=6*a,d=this.geomBoxes;b.min.x=d[c],b.min.y=d[c+1],b.min.z=d[c+2],b.max.x=d[c+3],b.max.y=d[c+4],b.max.z=d[c+5]},e.prototype.dispose=function(a){if(a)for(var b=0,c=this.geoms.length;b<c;b++)this.geoms[b]&&a.deallocateGeometry(this.geoms[b])},e.prototype.printStats=function(){j.log("Total geometry size: "+this.geomMemory/1048576+" MB"),j.log("Number of meshes: "+(this.geoms.length-1)),j.log("Num Meshes on GPU: "+this.gpuNumMeshes),j.log("Net GPU geom memory used: "+this.gpuMeshMemory)}},function(a,b,c){"use strict";function d(a,b){this.model=a,this.fragments=a.getData().fragments,this.geoms=a.getGeometryList(),this.pagingProxy=b,this.isFixedSize=this.fragments.length>0,this.isFixedSize?(this.boxes=this.fragments.boxes,this.transforms=this.fragments.transforms,this.useThreeMesh=!i.memoryOptimizedLoading):(this.boxes=null,this.transforms=null,this.useThreeMesh=!b||!b.onDemandLoadingEnabled());var c=this.fragments.length;this.vizflags=new Uint16Array(c),this.useThreeMesh&&(this.vizmeshes=new Array(c)),this.geomids=new Int32Array(c),this.materialids=new Int32Array(c),this.materialmap={},this.db2ThemingColor=[],this.originalColors=[],this.themingOrGhostingNeedsUpdate=[],this.dbIdIsHidden=[],this.dbIdIsGhosted=[],this.reachLimit=!1,this.animxforms=null;for(var d=0;d<c;d++)this.vizflags[d]=1,this.geomids[d]=-1;!a.isOTG()&&this.fragments.visibilityFlags&&(this.vizflags.set(this.fragments.visibilityFlags),delete this.fragments.visibilityFlags),this.allVisible=!0,this.allVisibleDirty=!0,this.nextAvailableFragID=c,this.boxTransform=[],this.boxCount=0,this.linesHidden=!1,this.pointsHidden=!1}function e(a){var b=a.r;return a.r=a.b,a.b=b,a}function f(a,b){var c=a.originalColors[b];if(a.themingOrGhostingNeedsUpdate[b]){var d=a.getGeometry(b),e=d?d.attributes:null,f=e?e.color4b:null,g=e?e.dbId4b:null,h=e?e.layerVp4b:null,i=e?e.flags4b:null;if(f&&g&&d.vb&&h&&i){for(var j=new Uint32Array(d.vb.buffer),k=d.vbstride,l=j.length/d.vbstride,m=!1,n=f.itemOffset,o=g.itemOffset,q=h.itemOffset,r=i.itemOffset,s=0;s<l;s++){var t=j[s*k+o],u=c?c[s]:j[s*k+n],v=j[s*k+q];t=t<<8>>8;var w=-1==t&&0==(v&parseInt("FFFF",16)),x=a.db2ThemingColor[t],y=a.dbIdIsHidden[t];if(x||y){if(!c){c=new Uint32Array(l);for(var z=0;z<l;z++)c[z]=j[z*k+n];a.originalColors[b]=c}u=y?0:p(u,x),m=!0}else c&&(u=c[s]);j[s*k+n]=u;var A=a.dbIdIsGhosted[t]&&!w,B=j[s*k+r];A?B|=255<<24:B&=16777215,j[s*k+r]=B}m||(a.originalColors[b]=null),d.vbNeedsUpdate=!0,a.themingOrGhostingNeedsUpdate[b]=!1}}}function g(a,b){if(a.model.is2d()){var c=a.fragments.dbId2fragId[b];if(Array.isArray(c))for(var d=0;d<c.length;d++)a.themingOrGhostingNeedsUpdate[c[d]]=!0;else"number"==typeof c&&(a.themingOrGhostingNeedsUpdate[c]=!0)}}function h(a,b){this.frags=a,this.fragId=b,this.scale=null,this.quaternion=null,this.position=null}Object.defineProperty(b,"__esModule",{value:!0}),b.FragmentList=d,b.FragmentPointer=h;var i=c(37),j=c(2),k=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(j),l=c(115),m=c(8),n=new k.Matrix4,o=new k.Box3;d.prototype.resetBoxRun=function(){this.boxCount=0},d.prototype.getNextAvailableFragmentId=function(){return this.nextAvailableFragID++},d.prototype.fragmentsHaveBeenAdded=function(){return this.vizflags.length>this.fragments.length},d.prototype.getSvfMaterialId=function(a){var b=this.getMaterial(a);return b?b.svfMatId:void 0},d.prototype.onDemandLoadingEnabled=function(){return this.pagingProxy&&this.pagingProxy.onDemandLoadingEnabled()},d.prototype.pageOutGeometryEnabled=function(){return this.pagingProxy&&this.pagingProxy.pageOutGeometryEnabled()},d.prototype.pixelCullingEnable=function(){return this.pagingProxy&&this.pagingProxy.pixelCullingEnable()},d.prototype.pixelCullingThreshold=function(){return this.pagingProxy?this.pagingProxy.pixelCullingThreshold():0},d.prototype.requireGeometry=function(a){var b=null,c=this.geomids[a];if(c>=0&&(b=this.geoms.getGeometry(c)),null==b){var d=this.fragments.packIds?this.fragments.packIds[a]:a;this.pagingProxy&&this.pagingProxy.loadPackFile(d)}return b},d.prototype.promiseGeometry=function(a){function b(a,b){var c;return c=a.then(function(){return c&&(delete c.lmv_loader_promise,c.lmv_geom_canceled)?Promise.reject({canceled:!0}):b},function(a){return c&&(delete c.lmv_loader_promise,c.lmv_geom_canceled)?Promise.reject({canceled:!0}):Promise.reject(a)}),c.lmv_loader_promise=a,c}if(this.getGeometry(a))return b(Promise.resolve(),{model:this.model,fragId:a});var c=this.fragments.packIds?this.fragments.packIds[a]:a;if(!this.pagingProxy||!this.pagingProxy.promisePackFile)return b(Promise.reject({reason:"Not supported"}));var d=this.pagingProxy.promisePackFile(c);return d.hasOwnProperty("lmv_promise_count")||(d.lmv_promise_count=0),++d.lmv_promise_count,this.pagingProxy.pageOut(!1,!1),b(d,{model:this.model,fragId:a})},d.prototype.cancelPromisedGeometry=function(a){if(!a)return!1;var b=a.lmv_loader_promise;return!!b&&(!!a.lmv_geom_canceled||(a.lmv_geom_canceled=!0,b.hasOwnProperty("lmv_promise_count")&&--b.lmv_promise_count<=0&&this.pagingProxy&&this.pagingProxy.promisePackFile&&this.pagingProxy.cancelPromisedPackFile(b),!0))},d.prototype.setMesh=function(a,b,c){if(this.vizmeshes){var d=this.vizmeshes[a];d&&d.parent&&d.parent.remove(d)}if(this.vizflags.length<=a){this.isFixedSize&&(m.logger.warn("Attempting to resize a fragments list that was initialized with fixed data. This will have a performance impact."),this.isFixedSize=!1);var e=Math.ceil(1.5*this.vizflags.length)||1;this.useThreeMesh&&e<this.vizmeshes.length&&(e=this.vizmeshes.length);var f=new Uint16Array(e);if(f.set(this.vizflags),this.vizflags=f,this.transforms){var g=new Float32Array(12*e);g.set(this.transforms),this.transforms=g}if(this.boxes){var h=new Float32Array(6*e);h.set(this.boxes),this.boxes=h}if(this.geomids){var i=new Int32Array(e);i.set(this.geomids),this.geomids=i}if(this.materialids){var j=new Int32Array(e);j.set(this.materialids),this.materialids=j}}if(this.useThreeMesh){var n=new k.Mesh(b.geometry,b.material);b.matrix&&(n.matrix&&n.matrix.copy(b.matrix),n.matrixWorld.copy(b.matrix)),n.is2d=b.is2d,n.isLine=b.isLine,n.isWideLine=b.isWideLine,n.isPoint=b.isPoint,n.matrixAutoUpdate=!1,n.frustumCulled=!1,n.fragId=a,n.dbId=0|this.fragments.fragId2dbId[a],n.modelId=this.model.getModelId(),this.vizmeshes[a]=n}else{var o=void 0;b.geometry.hash?(void 0===b.geomId&&console.error("meshInfo must provide geomId"),o=b.geomId):o=b.geometry.svfid,this.geomids[a]=o,this.materialids[a]=b.material.id,this.materialmap[b.material.id]||(this.materialmap[b.material.id]=b.material)}var p=0;if(b.isLine?p=l.MeshFlags.MESH_ISLINE:b.isWideLine?p=l.MeshFlags.MESH_ISWIDELINE:b.isPoint&&(p=l.MeshFlags.MESH_ISPOINT),this.isFixedSize?this.vizflags[a]|=p:this.vizflags[a]|=l.MeshFlags.MESH_VISIBLE|p,c){var q=b.matrix,r=12*a,s=q.elements,t=this.transforms;t[r]=s[0],t[r+1]=s[1],t[r+2]=s[2],t[r+3]=s[4],t[r+4]=s[5],t[r+5]=s[6],t[r+6]=s[8],t[r+7]=s[9],t[r+8]=s[10],t[r+9]=s[12],t[r+10]=s[13],t[r+11]=s[14];var u=new k.Box3;b.geometry&&b.geometry.boundingBox?u.copy(b.geometry.boundingBox):this.geoms.getModelBox(this.geomids[a],u),u.applyMatrix4(q);var v=6*a,w=this.boxes;w[v]=u.min.x,w[v+1]=u.min.y,w[v+2]=u.min.z,w[v+3]=u.max.x,w[v+4]=u.max.y,w[v+5]=u.max.z}},d.prototype.isFlagSet=function(a,b){return!!(this.vizflags[a]&b)},d.prototype.setFlagFragment=function(a,b,c){var d=this.vizflags[a];return!!(d&b)!=c&&(this.vizflags[a]=c?d|b:d&~b,!0)},d.prototype.setFlagGlobal=function(a,b){var c=this.vizflags,d=0,e=c.length;if(b)for(;d<e;d++)c[d]=c[d]|a;else for(var f=~a;d<e;d++)c[d]=c[d]&f},d.prototype.hideLines=function(a){this.linesHidden=a},d.prototype.hidePoints=function(a){this.pointsHidden=a},d.prototype.hideFragments=function(a,b){var c=l.MeshFlags.MESH_HIDE,d=this.vizflags,e=0,f=d.length;if(b)for(;e<f;e++)d[e]&a&&(d[e]=d[e]|c);else for(var g=~c;e<f;e++)d[e]&a&&(d[e]=d[e]&g);this.allVisibleDirty=!0},d.prototype.isFragVisible=function(a){var b=this.linesHidden&&(this.isLine(a)||this.isWideLine(a)),c=this.pointsHidden&&this.isPoint(a);return 1==(this.vizflags[a]&(l.MeshFlags.MESH_VISIBLE|l.MeshFlags.MESH_HIDE))&&!b&&!c},d.prototype.isFragOff=function(a){return!!(this.vizflags[a]&l.MeshFlags.MESH_HIDE)},d.prototype.isLine=function(a){return!!(this.vizflags[a]&l.MeshFlags.MESH_ISLINE)},d.prototype.isWideLine=function(a){return this.isFlagSet(a,l.MeshFlags.MESH_ISWIDELINE)},d.prototype.isPoint=function(a){return this.isFlagSet(a,l.MeshFlags.MESH_ISPOINT)},d.prototype.areAllVisible=function(){if(this.allVisibleDirty){for(var a=this.vizflags,b=!0,c=0,d=a.length;c<d;c++)if(0==(1&a[c])){b=!1;break}this.allVisible=b,this.allVisibleDirty=!1}return this.allVisible};var p=function(){var a=null,b=null,c=parseInt("00FFFFFF",16),d=parseInt("FF000000",16);return function(f,g){return a||(a=new k.Color,b=new k.Color),a.set(f&c),e(a),g&&(b.setRGB(g.x,g.y,g.z),a.lerp(b,g.w)),e(a).getHex()|f&d}}();d.prototype.getVizmesh=function(){function a(){d||(d=new k.Mesh(void 0,void 0,!0),d.isTemp=!0,d.dbId=0,d.modelId=0,d.fragId=-1,d.hide=!1,d.isLine=!1,d.isWideLine=!1,d.isPoint=!1,e=new k.MeshLambertMaterial({color:0,depthWrite:!1,emissive:13421772}),e.cutplanes=null,g=new k.Box3,h=new k.Vector3,i=new k.Vector3,j=new Float32Array([1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,1,1,-1,-1,-1,-1,-1,-1,1,1,-1,1,1,1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,1,-1,-1,-1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,-1,1,1,1,1,-1,-1]),l=new k.BufferGeometry,l.addAttribute("position",new k.BufferAttribute(j,3)))}function b(a,b,c,d){var e=a*b,f=d.boxes;c.min.x=f[e],c.min.y=f[e+1],c.min.z=f[e+2],c.max.x=f[e+3],c.max.y=f[e+4],c.max.z=f[e+5]}function c(a,c,d){if(!d.boxTransform[c]){b(c,6,g,d);var e=new k.Matrix4;i.subVectors(g.max,g.min),i.multiplyScalar(.5),e.makeScale(i.x,i.y,i.z),h.addVectors(g.max,g.min),h.multiplyScalar(.5);var f=e.elements;f[12]=h.x,f[13]=h.y,f[14]=h.z,d.boxTransform[c]=e}a.geometry_proxy=l,a.matrixWorld.copy(d.boxTransform[c])}var d,e,g,h,i,j,l;return function(b,g,h){if(this.model.is2d()&&f(this,b),this.useThreeMesh)return this.vizmeshes[b];a(),this.getWorldMatrix(b,d.matrixWorld),d.visible=!0,d.hide=this.isFragOff(b),d.fragId=b,d.dbId=this.getDbIds(b),d.themingColor=this.db2ThemingColor[d.dbId],d.modelId=this.model.getModelId(),d.geometry=this.getGeometry(b);var i=!1;if(!i){var j=this.pagingProxy?this.pagingProxy.options.debug.boxProxyMaxCount:0;if(!d.geometry&&this.boxCount<j){var k=this.pagingProxy?this.pagingProxy.options.debug.boxProxyMinScreen:.1;(void 0===g||0==g||void 0!==g&&g>k)&&(i=!0)}}return i?(c(d,b,this),h||(d.geometry=d.geometry_proxy),this.boxCount++,d.material=e,d.isLine=!1,d.isWideLine=!1,d.isPoint=!1):(d.material=this.getMaterial(b),d.isLine=this.isLine(b),d.isWideLine=this.isWideLine(b),d.isPoint=this.isPoint(b),d.geometry&&this.boxTransform[b]&&(this.boxTransform[b]=null)),d}}(),d.prototype.promiseVizmesh=function(a){return this.promiseGeometry(a)},d.prototype.cancelPromisedVizmesh=function(a){return this.cancelPromisedGeometry(a)},d.prototype.getMaterialId=function(a){return this.useThreeMesh?this.vizmeshes[a].material.id:this.materialids[a]},d.prototype.getMaterial=function(a){return this.useThreeMesh?this.vizmeshes[a].material:this.materialmap[this.materialids[a]]},d.prototype.getGeometry=function(a){var b;return this.useThreeMesh?(b=this.vizmeshes[a])?b.geometry:null:this.geoms.getGeometry(this.geomids[a])},d.prototype.lockGeometry=function(a){return!!this.useThreeMesh||this.geoms.lockGeometry(this.geomids[a])},d.prototype.unlockGeometry=function(a){return!!this.useThreeMesh||this.geoms.unlockGeometry(this.geomids[a])},d.prototype.getLockCount=function(a){return this.useThreeMesh?0:this.geoms.getLockCount(this.geomids[a])},d.prototype.getGeometryId=function(a){return this.useThreeMesh?a:this.geomids[a]},d.prototype.setMaterial=function(a,b){this.useThreeMesh?this.vizmeshes[a].material=b:(this.materialids[a]=b.id,this.materialmap[b.id]=b)},d.prototype.getCount=function(){return this.vizmeshes?this.vizmeshes.length:this.vizflags.length},d.prototype.getDbIds=function(a){return this.fragments.fragId2dbId[a]},d.prototype.dispose=function(a){if(this.useThreeMesh)for(var b={type:"dispose"},c={type:"removed"},d=0;d<this.vizmeshes.length;d++){var e=this.vizmeshes[d];e&&(e.dispatchEvent(c),e.geometry.dispatchEvent(b))}else this.geoms.dispose(a)},d.prototype.setVisibility=function(a,b){this.setFlagFragment(a,l.MeshFlags.MESH_VISIBLE,b),this.allVisibleDirty=!0},d.prototype.setFragOff=function(a,b){this.setFlagFragment(a,l.MeshFlags.MESH_HIDE,b),this.allVisibleDirty=!0},d.prototype.setAllVisibility=function(a){if(this.model.is2d()){var b=this.fragments;if(b&&b.dbId2fragId)for(var c in b.dbId2fragId)this.setObject2DGhosted(c,!a)}else this.setFlagGlobal(l.MeshFlags.MESH_VISIBLE,a),this.allVisible=a,this.allVisibleDirty=!1},d.prototype.updateAnimTransform=function(a,b,c,d){var e,f=this.animxforms;if(!f){var g=this.getCount();f=this.animxforms=new Float32Array(10*g);for(var h=0;h<g;h++)e=10*h,f[e]=1,f[e+1]=1,f[e+2]=1,f[e+3]=0,f[e+4]=0,f[e+5]=0,f[e+6]=1,f[e+7]=0,f[e+8]=0,f[e+9]=0}e=10*a;var i=!1;b&&(f[e]=b.x,f[e+1]=b.y,f[e+2]=b.z,i=!0),c&&(f[e+3]=c.x,f[e+4]=c.y,f[e+5]=c.z,f[e+6]=c.w,i=!0),d&&(f[e+7]=d.x,f[e+8]=d.y,f[e+9]=d.z,i=!0),this.setFlagFragment(a,l.MeshFlags.MESH_MOVED,i),i||(f[e]=1,f[e+1]=1,f[e+2]=1,f[e+3]=0,f[e+4]=0,f[e+5]=0,f[e+6]=1,f[e+7]=0,f[e+8]=0,f[e+9]=0)},d.prototype.getAnimTransform=function(a,b,c,d){if(!this.animxforms)return!1;if(!this.isFlagSet(a,l.MeshFlags.MESH_MOVED))return!1;var e=10*a,f=this.animxforms;return b&&(b.x=f[e],b.y=f[e+1],b.z=f[e+2]),c&&(c.x=f[e+3],c.y=f[e+4],c.z=f[e+5],c.w=f[e+6]),d&&(d.x=f[e+7],d.y=f[e+8],d.z=f[e+9]),!0},d.prototype.getOriginalWorldMatrix=function(a,b){var c=12*a,d=b.elements,e=this.transforms;if(e)d[0]=e[c],d[1]=e[c+1],d[2]=e[c+2],d[3]=0,d[4]=e[c+3],d[5]=e[c+4],d[6]=e[c+5],d[7]=0,d[8]=e[c+6],d[9]=e[c+7],d[10]=e[c+8],d[11]=0,d[12]=e[c+9],d[13]=e[c+10],d[14]=e[c+11],d[15]=1;else if(this.useThreeMesh){var f=this.getVizmesh(a);f?b.copy(f.matrixWorld):b.identity()}else b.identity()},d.prototype.getWorldMatrix=function(){function a(){b=new k.Matrix4,c=new k.Vector3,d=new k.Quaternion,e=new k.Vector3}var b,c,d,e;return function(f,g){b||a(),this.getOriginalWorldMatrix(f,g),this.isFlagSet(f,l.MeshFlags.MESH_MOVED)&&(this.getAnimTransform(f,e,d,c),b.compose(c,d,e),g.multiplyMatrices(b,g))}}(),d.prototype.getWorldBounds=function(a,b){if(this.boxes&&!this.isFlagSet(a,l.MeshFlags.MESH_MOVED)){var c=this.boxes,d=6*a;return b.min.x=c[d],b.min.y=c[d+1],b.min.z=c[d+2],b.max.x=c[d+3],b.max.y=c[d+4],void(b.max.z=c[d+5])}if(this.useThreeMesh){var e=this.getVizmesh(a);e&&e.geometry&&b.copy(e.geometry.boundingBox)}else this.geoms.getModelBox(this.geomids[a],b);b.empty()||(this.getWorldMatrix(a,n),b.applyMatrix4(n))},d.prototype.getOriginalWorldBounds=function(a,b){if(this.boxes){var c=this.boxes,d=6*a;return b[0]=c[d],b[1]=c[d+1],b[2]=c[d+2],b[3]=c[d+3],b[4]=c[d+4],void(b[5]=c[d+5])}if(this.useThreeMesh){var e=this.getVizmesh(a);e&&e.geometry&&o.copy(e.geometry.boundingBox)}else this.geoms.getModelBox(this.geomids[a],o);o.empty()||(this.getOriginalWorldMatrix(a,n),o.applyMatrix4(n)),b[0]=o.min.x,b[1]=o.min.y,b[2]=o.min.z,b[3]=o.max.x,b[4]=o.max.y,b[5]=o.max.z},d.prototype.setThemingColor=function(a,b){var c=this.db2ThemingColor[a];c===b||c&&b&&c.equals(b)||(this.db2ThemingColor[a]=b,g(this,a))},d.prototype.clearThemingColors=function(){if(this.model.is2d())for(var a=1,b=this.fragments.dbId2fragId.length;a<b;a++)g(this,a);this.db2ThemingColor.length=0},d.prototype.setObject2DGhosted=function(a,b){!!b!=!!this.dbIdIsGhosted[a]&&(this.dbIdIsGhosted[a]=b,g(this,a))},d.prototype.setObject2DVisible=function(a,b){b!==!this.dbIdIsHidden[a]&&(this.dbIdIsHidden[a]=!b,g(this,a))},d.prototype.getMemoryInfo=function(){return this.pagingProxy?this.pagingProxy.getMemoryInfo():null},h.prototype.getWorldMatrix=function(a){this.frags.getWorldMatrix(this.fragId,a)},h.prototype.getOriginalWorldMatrix=function(a){this.frags.getOriginalWorldMatrix(this.fragId,a)},h.prototype.getWorldBounds=function(a){return this.frags.getWorldBounds(this.fragId,a)},h.prototype.getAnimTransform=function(){return this.scale||(this.scale=new k.Vector3(1,1,1),this.quaternion=new k.Quaternion(0,0,0,1),this.position=new k.Vector3(0,0,0)),this.frags.getAnimTransform(this.fragId,this.scale,this.quaternion,this.position)},h.prototype.updateAnimTransform=function(){this.scale||(this.scale=new k.Vector3(1,1,1),this.quaternion=new k.Quaternion(0,0,0,1),this.position=new k.Vector3(0,0,0)),this.frags.updateAnimTransform(this.fragId,this.scale,this.quaternion,this.position)},h.prototype.getMaterial=function(){return this.frags.getMaterial(this.fragId)},h.prototype.setMaterial=function(a){return this.frags.setMaterial(this.fragId,a)}},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.MeshFlags={MESH_VISIBLE:1,MESH_HIGHLIGHTED:2,MESH_HIDE:4,MESH_ISLINE:8,MESH_MOVED:16,MESH_TRAVERSED:32,MESH_DRAWN:64,MESH_RENDERFLAG:128,MESH_ISPOINT:256,MESH_ISWIDELINE:512}},function(a,b,c){"use strict";function d(a,b,c,d){this.frags=a,this.indices=b,this.start=c,this.count=d,this.lastItem=c,this.overrideMaterial=null,this.sortDone=!1,this.numAdded=0,this.avgFrameTime=void 0,this.nodeIndex=void 0,this.bboxes=new Array(12),this.bboxes[0]=this.bboxes[1]=this.bboxes[2]=1/0,this.bboxes[3]=this.bboxes[4]=this.bboxes[5]=-1/0,this.bboxes[6]=this.bboxes[7]=this.bboxes[8]=1/0,this.bboxes[9]=this.bboxes[10]=this.bboxes[11]=-1/0,this.sortObjects=!1,this.sortDone=!1,this.sortByShaderDone=!1,this.depths=null,this.indicesView=null,this.frustumCulled=!0,this.forceVisible=!1,this.renderImmediate=!a.useThreeMesh,
this.renderImportance=0}function e(a,b,c,d,e){var f,g=b[c]&~i.MeshFlags.MESH_RENDERFLAG;switch(a){case j.RenderFlags.RENDER_HIDDEN:f=!(g&i.MeshFlags.MESH_VISIBLE);break;case j.RenderFlags.RENDER_HIGHLIGHTED1:case j.RenderFlags.RENDER_HIGHLIGHTED2:f=g&i.MeshFlags.MESH_HIGHLIGHTED;break;default:f=1==(g&(i.MeshFlags.MESH_VISIBLE|i.MeshFlags.MESH_HIGHLIGHTED|i.MeshFlags.MESH_HIDE))}if(d){var h=g&(i.MeshFlags.MESH_ISLINE|i.MeshFlags.MESH_ISWIDELINE);f=f&&!h}if(e){var k=g&i.MeshFlags.MESH_ISPOINT;f=f&&!k}return b[c]=g|(f?i.MeshFlags.MESH_RENDERFLAG:0),f}function f(a,b,c,d){var e=!1;return c.getWorldBounds(d,m),a&&!b.intersectsBox(m)&&(e=!0),!e&&b.boxOutsideCutPlanes(m)&&(e=!0),e}Object.defineProperty(b,"__esModule",{value:!0}),b.RenderBatch=d;var g=c(117),h=c(120),i=c(115),j=c(121),k=c(8),l=c(122),m=new l.LmvBox3;d.prototype.getIndices=function(){return Array.isArray(this.indices)?this.indices[0]:this.indices},d.prototype.sortByMaterial=function(){if(!(this.numAdded<this.count)){var a=this.frags,b=this.getIndices();if(!b)return void k.logger.warn("Only indexed RenderSubsets can be sorted.");var c=b.subarray(this.start,this.start+this.count);Array.prototype.sort.call(c,function(b,c){var d=a.getMaterialId(b),e=a.getMaterialId(c);return void 0===d?e?1:0:void 0===e?-1:d-e}),this.numAdded=0,this.sortDone=!0}},d.prototype.sortByShader=function(){if(this.sortDone&&!this.sortByShaderDone){var a=this.frags,b=this.getIndices(),c=b.subarray(this.start,this.start+this.count);Array.prototype.sort.call(c,function(b,c){var d=a.getMaterial(b),e=a.getMaterial(c),f=d.program.id-e.program.id;return f||d.id-e.id}),this.numAdded=0,this.sortByShaderDone=!0}},d.prototype.sortByDepth=function(){function a(a,c){b.getGeometry(a)?(b.getWorldBounds(a,e),f[c]=d.estimateDepth(e)):f[c]=-1/0}var b,c,d,e,f;return function(g){if(b=this.frags,c=this.getIndices(),d=g,e=m,!c)return void k.logger.warn("Only indexed RenderSubsets can be sorted.");(!this.indicesView||this.indicesView.length<this.count)&&(this.indicesView=c.subarray(this.start,this.start+this.count)),(!this.depths||this.depths.length<this.count)&&(this.depths=new Float32Array(this.count)),f=this.depths,this.forEachNoMesh(a);for(var h,i,j=1;j<f.length;j++)for(var l=j;l>0&&f[l-1]<f[l];)h=f[l-1],f[l-1]=f[l],f[l]=h,i=this.indicesView[l-1],this.indicesView[l-1]=this.indicesView[l],this.indicesView[l]=i,l--}}(),d.prototype.addToBox=function(a,b){var c=b?6:0,d=this.bboxes;d[0+c]=Math.min(d[0+c],a.min.x),d[1+c]=Math.min(d[1+c],a.min.y),d[2+c]=Math.min(d[2+c],a.min.z),d[3+c]=Math.max(d[3+c],a.max.x),d[4+c]=Math.max(d[4+c],a.max.y),d[5+c]=Math.max(d[5+c],a.max.z)},d.prototype.getBoundingBox=function(a){a=a||m;var b=this.bboxes;return a.min.x=b[0],a.min.y=b[1],a.min.z=b[2],a.max.x=b[3],a.max.y=b[4],a.max.z=b[5],a},d.prototype.getBoundingBoxHidden=function(a){a=a||m;var b=this.bboxes;return a.min.x=b[6],a.min.y=b[7],a.min.z=b[8],a.max.x=b[9],a.max.y=b[10],a.max.z=b[11],a},d.prototype.onFragmentAdded=function(){return function(a){this.frags.getWorldBounds(a,m),this.addToBox(m,!1),this.sortDone=!1,this.lastItem<=a&&(this.lastItem=a+1,void 0!==this.visibleStats&&(this.visibleStats=0),this.numAdded++)}}(),d.prototype.forEach=function(a,b,c){var d,e,f,g,h=this.getIndices(),j=this.frags,k=!this.sortByShaderDone;if(b||c||k)for(d=b===i.MeshFlags.MESH_RENDERFLAG&&this.hasOwnProperty("drawStart")?this.drawStart:this.start,e=this.lastItem;d<e;d++){f=h?h[d]:d;var g=j.getVizmesh(f,this.renderImportance);!k||g&&g.material&&g.material.program&&!g.geometry_proxy||(k=!1),!(c||g&&g.geometry)||b&&!j.isFlagSet(f,b)||a(g,f)}else for(d=this.start,e=this.lastItem;d<e;d++){f=h?h[d]:d;var g=j.getVizmesh(f,this.renderImportance);g&&g.geometry&&a(g,f)}k&&this.sortByShader()},d.prototype.forEachNoMesh=function(a,b,c){for(var d=this.getIndices(),e=this.frags,f=this.start,g=this.lastItem;f<g;f++){var h,i=d?d[f]:f;if(e.useThreeMesh){var j=e.getVizmesh(i);j&&(h=j.geometry)}else h=e.getGeometry(i);!c&&!h||b&&!e.isFlagSet(i,b)||a(i,f-this.start)}},d.prototype.raycast=function(){return function(a,b,c){if(!1!==a.ray.isIntersectionBox(this.getBoundingBox())){var d=this,e=m;this.forEach(function(f,h){if(!d.frags.isFlagSet(h,i.MeshFlags.MESH_HIDE)){if(c&&c.length){var j=0|d.frags.getDbIds(h);if(-1===c.indexOf(j))return}d.frags.getWorldBounds(h,e),e.expandByScalar(.5),a.ray.isIntersectionBox(e)&&g.VBIntersector.rayCast(f,a,b)}},i.MeshFlags.MESH_VISIBLE)}}}(),d.prototype.calculateBounds=function(){function a(a){c.getWorldBounds(a,d);var f=b[a];e.addToBox(d,!(1&f))}var b,c,d,e;return function(){this.bboxes[0]=this.bboxes[1]=this.bboxes[2]=1/0,this.bboxes[3]=this.bboxes[4]=this.bboxes[5]=-1/0,this.bboxes[6]=this.bboxes[7]=this.bboxes[8]=1/0,this.bboxes[9]=this.bboxes[10]=this.bboxes[11]=-1/0,b=this.frags.vizflags,c=this.frags,d=m,e=this,this.forEachNoMesh(a,0,this.frags.onDemandLoadingEnabled())}}(),d.prototype.applyVisibility=function(){function a(a,b){if((a||!c.useThreeMesh)&&a.geometry){if(f(m,g,c,b))return a?a.visible=!1:k.logger.warn("Unexpected null mesh"),void(d[b]=d[b]&~i.MeshFlags.MESH_RENDERFLAG);var h=e(l,d,b,c.linesHidden,c.pointsHidden);a&&(a.visible=!!h),n=n&&!h}}function b(a){if(c.getGeometryId(a)){if(f(m,g,c,a))return void(d[a]=d[a]&~i.MeshFlags.MESH_RENDERFLAG);var b=e(l,d,a,c.linesHidden,c.pointsHidden);n=n&&!b}}var c,d,g,l,m,n;return function(e,f){n=!0,g=f,l=e;var i=l===j.RenderFlags.RENDER_HIDDEN?this.getBoundingBoxHidden():this.getBoundingBox(),k=g.intersectsBox(i);return k===h.FrustumIntersector.OUTSIDE?n:f.boxOutsideCutPlanes(i)?n:(d=this.frags.vizflags,c=this.frags,m=k!==h.FrustumIntersector.CONTAINS,c.useThreeMesh?this.forEach(a,null):this.forEachNoMesh(b,0,!1),n)}}()},function(a,b,c){"use strict";function d(){k||(k=new r.Matrix4,l=new r.Ray,m=new r.Vector3,n=new r.Vector3,o=new r.Vector3)}function e(a,b,c){d();var e=a.geometry;if(e){var f=a.material,g=f?f.side:r.FrontSide;k.getInverse(a.matrixWorld),l.copy(b.ray).applyMatrix4(k);var h,i,j=b.precision;(0,p.enumMeshTriangles)(e,function(d,e,f,k,m,n){null!==(h=g===r.BackSide?l.intersectTriangle(f,e,d,!0):l.intersectTriangle(d,e,f,g!==r.DoubleSide))&&(h.applyMatrix4(a.matrixWorld),(i=b.ray.origin.distanceTo(h))<j||i<b.near||i>b.far||c.push({distance:i,point:h,face:new r.Face3(k,m,n,r.Triangle.normal(d,e,f)),faceIndex:null,fragId:a.fragId,dbId:a.dbId}))})}}function f(a,b,c){d();var e=a.geometry;if(e){var f=b.linePrecision;a.isWideLine&&a.geometry.lineWidth&&(f=a.geometry.lineWidth);var g=f*f;k.getInverse(a.matrixWorld),l.copy(b.ray).applyMatrix4(k);var h=new r.Vector3,i=new r.Vector3;e instanceof r.BufferGeometry&&(0,p.enumMeshLines)(e,function(d,e){var f,j;l.distanceSqToSegment(d,e,i,h),h.applyMatrix4(a.matrixWorld),i.applyMatrix4(a.matrixWorld),(j=h.distanceToSquared(i))>g||(f=b.ray.origin.distanceTo(h))<b.near||f>b.far||c.push({distance:f,point:h,face:null,faceIndex:null,fragId:a.fragId,dbId:a.dbId})})}}function g(a,b,c){d();var e=a.geometry;if(e){k.getInverse(a.matrixWorld),l.copy(b.ray).applyMatrix4(k);var f=b.precision,g=b.params.PointCloud.threshold;g||(g=1),g*=Math.max(3,e.pointSize),g/=4,e instanceof r.BufferGeometry&&(0,p.enumMeshVertices)(e,function(d){if(!(l.distanceToPoint(d)>g)){var e=l.closestPointToPoint(d);if(null!==e){e.applyMatrix4(a.matrixWorld);var h=b.ray.origin.distanceTo(e);h<f||h<b.near||h>b.far||c.push({distance:h,point:d,face:null,faceIndex:null,fragId:a.fragId,dbId:a.dbId})}}})}}function h(a,b,c){a.isLine||a.isWideLine?f(a,b,c):a.isPoint?g(a,b,c):e(a,b,c)}function i(a,b,c,d){if(a instanceof r.Mesh?h(a,b,c):a.raycast(b,c),!0===d)for(var e=a.children,f=0,g=e.length;f<g;f++)i(e[f],b,c,!0)}function j(a,b,c,d){i(a,b,c,d),c.sort(s)}Object.defineProperty(b,"__esModule",{value:!0}),b.VBIntersector=void 0;var k,l,m,n,o,p=c(118),q=c(2),r=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(q),s=function(a,b){return a.distance-b.distance};b.VBIntersector={meshRayCast:e,lineRayCast:f,rayCast:h,intersectObject:j}},function(a,b,c){"use strict";function d(a){return a.vb?a.vb.length/a.vbstride:a.attributes.positions?a.attributes.positions.count:0}function e(a,b,c){var d,e=a.attributes,f=a.vb||e.position.array,g=a.vb?a.vbstride:3;if(a.vblayout){if(!a.vblayout.position)return;d=a.vblayout.position.offset}else{if(!e.position)return;d=e.position.itemOffset||0}var h=f.length/g;i||(i=new r.LmvVector3);for(var j=d,k=0;k<h;k++,j+=g)i.set(f[j],f[j+1],f[j+2]),c&&i.applyMatrix4(c),b(i,k)}function f(a,b){var c,d,e,f=a.attributes;j||(j=new r.LmvVector3,k=new r.LmvVector3,l=new r.LmvVector3,m=new r.LmvVector3,n=new r.LmvVector3,o=new r.LmvVector3);var g,h=a.vb||f.position.array,i=a.vb||f.normal&&f.normal.array,p=a.vb?a.vbstride:3;if(a.vblayout){if(!a.vblayout.position)return;g=a.vblayout.position.offset}else{if(!f.position)return;g=f.position.itemOffset||0}var q=0,s=a.vblayout?a.vblayout.normal:f.normal||null;s?q=s.offset||s.itemOffset||0:i=null,!s||3===s.itemSize&&4===s.bytesPerItem||(i=null);var t=a.ib||a.indices||(f.index?f.index.array:null);if(t){var u=a.offsets;u&&0!==u.length||(u=[{start:0,count:t.length,index:0}]);for(var v=0,w=u.length;v<w;++v)for(var x=u[v].start,y=u[v].count,z=u[v].index,A=x,B=x+y;A<B;A+=3){c=z+t[A],d=z+t[A+1],e=z+t[A+2];var C=c*p+g,D=d*p+g,E=e*p+g;if(j.x=h[C],j.y=h[C+1],j.z=h[C+2],k.x=h[D],k.y=h[D+1],k.z=h[D+2],l.x=h[E],l.y=h[E+1],l.z=h[E+2],i){var F=c*p+q,G=d*p+q,H=e*p+q;m.x=i[F],m.y=i[F+1],m.z=i[F+2],n.x=i[G],n.y=i[G+1],n.z=i[G+2],o.x=i[H],o.y=i[H+1],o.z=i[H+2],b(j,k,l,c,d,e,m,n,o)}else b(j,k,l,c,d,e)}}else for(var I=a.vb?a.vb.length/a.vbstride:h.length/3,A=0;A<I;A++){c=3*A,d=3*A+1,e=3*A+2;var C=c*p+g,D=d*p+g,E=e*p+g;if(j.x=h[C],j.y=h[C+1],j.z=h[C+2],k.x=h[D],k.y=h[D+1],k.z=h[D+2],l.x=h[E],l.y=h[E+1],l.z=h[E+2],i){var F=c*p+q,G=d*p+q,H=e*p+q;m.x=i[F],m.y=i[F+1],m.z=i[F+2],n.x=i[G],n.y=i[G+1],n.z=i[G+2],o.x=i[H],o.y=i[H+1],o.z=i[H+2],b(j,k,l,c,d,e,m,n,o)}else b(j,k,l,c,d,e)}}function g(a,b){var c,d,e=a.attributes;p||(p=new r.LmvVector3,q=new r.LmvVector3);var f=2;a.lineWidth&&(f=6);var g=a.ib||a.indices||(e.index?e.index.array:null);if(g){var h=a.vb?a.vb:e.position.array,i=a.vb?a.vbstride:3,j=a.offsets;j&&0!==j.length||(j=[{start:0,count:g.length,index:0}]);for(var k=0,l=j.length;k<l;++k)for(var m=j[k].start,n=j[k].count,o=j[k].index,s=m,t=m+n;s<t;s+=f)c=o+g[s],d=o+g[s+1],p.x=h[c*i],p.y=h[c*i+1],p.z=h[c*i+2],q.x=h[d*i],q.y=h[d*i+1],q.z=h[d*i+2],b(p,q,c,d)}else for(var h=a.vb?a.vb:e.position.array,i=a.vb?a.vbstride:3,s=0,t=h.length;s<t;s+=f)c=s,d=s+1,p.x=h[c*i],p.y=h[c*i+1],p.z=h[c*i+2],q.x=h[d*i],q.y=h[d*i+1],q.z=h[d*i+2],b(p,q,c,d)}function h(a,b){var c,d,e=a.attributes;p||(p=new r.LmvVector3,q=new r.LmvVector3);var f=a.iblines;if(f){var g=a.vb?a.vb:e.position.array,h=a.vb?a.vbstride:3,i=a.offsets;i&&0!==i.length||(i=[{start:0,count:f.length,index:0}]);for(var j=0,k=i.length;j<k;++j)for(var l=i[j].start,m=i[j].count,n=i[j].index,o=l,s=l+m;o<s;o+=2)c=n+f[o],d=n+f[o+1],p.x=g[c*h],p.y=g[c*h+1],p.z=g[c*h+2],q.x=g[d*h],q.y=g[d*h+1],q.z=g[d*h+2],b(p,q,c,d)}}Object.defineProperty(b,"__esModule",{value:!0}),b.VertexEnumerator=void 0,b.getVertexCount=d,b.enumMeshVertices=e,b.enumMeshTriangles=f,b.enumMeshLines=g,b.enumMeshEdges=h;var i,j,k,l,m,n,o,p,q,r=c(119);b.VertexEnumerator={getVertexCount:d,enumMeshVertices:e,enumMeshTriangles:f,enumMeshLines:g,enumMeshEdges:h}},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=b.LmvVector3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0};c.prototype={constructor:c,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},addScaledVector:function(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this},sub:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this)},subScalar:function(a){return this.x-=a,this.y-=a,this.z-=a,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b)):(this.x*=a.x,this.y*=a.y,this.z*=a.z,this)},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this.x=i*h+l*-e+j*-g-k*-f,this.y=j*h+l*-f+k*-e-i*-g,this.z=k*h+l*-g+i*-f-j*-e,this},transformDirection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize(),this},divide:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){if(0!==a){var b=1/a;this.x*=b,this.y*=b,this.z*=b}else this.x=0,this.y=0,this.z=0;return this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this},clampScalar:function(){var a,b;return function(d,e){return void 0===a&&(a=new c,b=new c),a.set(d,d,d),b.set(e,e,e),this.clamp(a,b)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a),this},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;return this.x=d*a.z-e*a.y,this.y=e*a.x-c*a.z,this.z=c*a.y-d*a.x,this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this},projectOnVector:function(){var a,b;return function(d){return void 0===a&&(a=new c),a.copy(d).normalize(),b=this.dot(a),this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){return void 0===a&&(a=new c),a.copy(this).projectOnVector(b),this.sub(a)}}(),reflect:function(){var a;return function(b){return void 0===a&&(a=new c),this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},setEulerFromRotationMatrix:function(a,b){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(a,b){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();return this.x=b,this.y=c,this.z=d,this},setFromMatrixColumn:function(a,b){var c=4*a,d=b.elements;return this.x=d[c],this.y=d[c+1],this.z=d[c+2],this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){return void 0===b&&(b=0),this.x=a[b],this.y=a[b+1],this.z=a[b+2],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a},fromAttribute:function(a,b,c){return void 0===c&&(c=0),b=b*a.itemSize+c,this.x=a.array[b],this.y=a.array[b+1],this.z=a.array[b+2],this}}},function(a,b,c){"use strict";function d(){this.frustum=new h.Frustum,this.viewProj=new h.Matrix4,this.viewDir=[0,0,1],this.ar=1,this.viewport=new h.Vector3(1,1,1),this.areaConv=1,this.areaCullThreshold=1,this.eye=new h.Vector3,this.perspective=!1}function e(a,b,c){return c.x=1&b?a.max.x:a.min.x,c.y=2&b?a.max.y:a.min.y,c.z=4&b?a.max.z:a.min.z,c}function f(a,b){return a.x*b.x+a.y*b.y+a.z*b.z+b.w>1e-6}Object.defineProperty(b,"__esModule",{value:!0}),b.CONTAINMENT_UNKNOWN=b.CONTAINS=b.INTERSECTS=b.OUTSIDE=void 0,b.FrustumIntersector=d;var g=c(2),h=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(g),i=[[1,5,4,7,3,2,6],[0,3,2,1,5,4,6],[0,3,2,6,5,4,6],[0,4,7,3,2,1,6],[0,3,2,1,-1,-1,4],[0,3,2,6,5,1,6],[0,4,7,6,2,1,6],[0,3,7,6,2,1,6],[0,3,7,6,5,1,6],[0,1,5,4,7,3,6],[0,1,5,4,-1,-1,4],[0,1,2,6,5,4,6],[0,4,7,3,-1,-1,4],[-1,-1,-1,-1,-1,-1,0],[1,2,6,5,-1,-1,4],[0,4,7,6,2,3,6],[2,3,7,6,-1,-1,4],[1,2,3,7,6,5,6],[0,1,5,6,7,3,6],[0,1,5,6,7,4,6],[0,1,2,6,7,4,6],[0,4,5,6,7,3,6],[4,5,6,7,-1,-1,4],[1,2,6,7,4,5,6],[0,4,5,6,2,3,6],[2,3,7,4,5,6,6],[1,2,3,7,4,5,6]],j=b.OUTSIDE=0,k=b.INTERSECTS=1,l=b.CONTAINS=2,m=b.CONTAINMENT_UNKNOWN=-1;d.OUTSIDE=j,d.INTERSECTS=k,d.CONTAINS=l,d.CONTAINMENT_UNKNOWN=m,d.prototype.reset=function(a,b){this.viewProj.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),this.perspective=a.isPerspective,this.frustum.setFromMatrix(this.viewProj);var c=a.matrixWorldInverse.elements;this.ar=a.aspect,this.viewDir[0]=-c[2],this.viewDir[1]=-c[6],this.viewDir[2]=-c[10],this.eye.x=a.position.x,this.eye.y=a.position.y,this.eye.z=a.position.z,this.areaConv=a.clientWidth*a.clientHeight/4,this.cutPlanes=b},d.prototype.projectedArea=function(){function a(){c||(c=[new h.Vector3,new h.Vector3,new h.Vector3,new h.Vector3,new h.Vector3,new h.Vector3,new h.Vector3,new h.Vector3],d=new h.Box2)}function b(a,b){var c=a.x,d=a.y,e=a.z,f=b.elements,g=f[3]*c+f[7]*d+f[11]*e+f[15];g<0&&(g=-g);var h=1/g;a.x=(f[0]*c+f[4]*d+f[8]*e+f[12])*h,a.y=(f[1]*c+f[5]*d+f[9]*e+f[13])*h}var c,d;return function(e){if(e.empty())return 0;a();var f=this.viewProj;c[0].set(e.min.x,e.min.y,e.min.z),c[1].set(e.min.x,e.min.y,e.max.z),c[2].set(e.min.x,e.max.y,e.min.z),c[3].set(e.min.x,e.max.y,e.max.z),c[4].set(e.max.x,e.min.y,e.min.z),c[5].set(e.max.x,e.min.y,e.max.z),c[6].set(e.max.x,e.max.y,e.min.z),c[7].set(e.max.x,e.max.y,e.max.z);for(var g=0;g<8;g++)b(c[g],f);return d.makeEmpty(),d.setFromPoints(c),d.min.x<-1&&(d.min.x=-1),d.min.x>1&&(d.min.x=1),d.min.y<-1&&(d.min.y=-1),d.min.y>1&&(d.min.y=1),d.max.x>1&&(d.max.x=1),d.max.x<-1&&(d.max.x=-1),d.max.y>1&&(d.max.y=1),d.max.y<-1&&(d.max.y=-1),(d.max.x-d.min.x)*(d.max.y-d.min.y)}}(),d.prototype.projectedBoxArea=function(){function a(){if(!d){d=[],e=[];for(var a=0;a<10;a++)d.push(new h.Vector3),e.push(new h.Vector3)}}function b(a,b){var c=a.x,d=a.y,e=a.z,f=b.elements,g=f[3]*c+f[7]*d+f[11]*e+f[15];g<0&&(g=-g);var h=1/g;a.x=(f[0]*c+f[4]*d+f[8]*e+f[12])*h,a.y=(f[1]*c+f[5]*d+f[9]*e+f[13])*h}function c(a,b){var c,d,g,h,i,j,k,l,m=a,n=e,o=function(a){switch(k){case 0:return a.x>=-1;case 1:return a.x<=1;case 2:return a.y>=-1;case 3:return a.y<=1}},p=function(a){n[l].x=a.x,n[l++].y=a.y},q=function(){var a,b;switch(k){case 0:a=-1,b=d.y+(g.y-d.y)*(a-d.x)/(g.x-d.x);break;case 1:a=1,b=d.y+(g.y-d.y)*(a-d.x)/(g.x-d.x);break;case 2:b=-1,a=d.x+(g.x-d.x)*(b-d.y)/(g.y-d.y);break;case 3:b=1,a=d.x+(g.x-d.x)*(b-d.y)/(g.y-d.y)}n[l].x=a,n[l++].y=b};for(k=0;k<4&&b>2;k++){for(l=0,d=m[b-1],h=o(d),j=0;j<b;j++)g=m[j],i=o(g),h?i?p(g):q():i&&(q(),p(g)),d=g,h=i;b=l,c=m,m=n,n=c}return f=b,m}var d,e,f;return function(e,g){if(e.empty())return 0;a();var h,j=this.viewProj;if(this.perspective?(h=this.eye.x>=e.min.x?this.eye.x>e.max.x?2:1:0,this.eye.y>=e.min.y&&(h+=this.eye.y>e.max.y?6:3),this.eye.z>=e.min.z&&(h+=this.eye.z>e.max.z?18:9)):(h=this.viewDir[0]<=0?this.viewDir[0]<0?2:1:0,this.viewDir[1]<=0&&(h+=this.viewDir[1]<0?6:3),this.viewDir[2]<=0&&(h+=this.viewDir[2]<0?18:9)),13===h)return 4;var k,l=i[h][6];for(k=0;k<l;k++){var m=i[h][k];d[k].set((m+1)%4<2?e.min.x:e.max.x,m%4<2?e.min.y:e.max.y,m<4?e.min.z:e.max.z),b(d[k],j)}var n=0;if(g)for(n=(d[l-1].x-d[0].x)*(d[l-1].y+d[0].y),k=0;k<l-1;k++)n+=(d[k].x-d[k+1].x)*(d[k].y+d[k+1].y);else{var o=c(d,l);if(f>=3)for(n=(o[f-1].x-o[0].x)*(o[f-1].y+o[0].y),k=0;k<f-1;k++)n+=(o[k].x-o[k+1].x)*(o[k].y+o[k+1].y)}return Math.abs(.5*n)}}(),d.prototype.estimateDepth=function(a){var b=this.viewProj.elements,c=(a.min.x+a.max.x)/2,d=(a.min.y+a.max.y)/2,e=(a.min.z+a.max.z)/2,f=1/(b[3]*c+b[7]*d+b[11]*e+b[15]);return(b[2]*c+b[6]*d+b[10]*e+b[14])*f},d.prototype.intersectsBox=function(){function a(){b||(b=new h.Vector3,c=new h.Vector3)}var b,c;return function(e){a();for(var f=this.frustum.planes,g=0,h=0;h<6;h++){var i=f[h];b.x=i.normal.x>0?e.min.x:e.max.x,c.x=i.normal.x>0?e.max.x:e.min.x,b.y=i.normal.y>0?e.min.y:e.max.y,c.y=i.normal.y>0?e.max.y:e.min.y,b.z=i.normal.z>0?e.min.z:e.max.z,c.z=i.normal.z>0?e.max.z:e.min.z;var j=i.distanceToPoint(b),k=i.distanceToPoint(c);if(j<0&&k<0)return d.OUTSIDE;j>0&&k>0&&g++}return 6==g?d.CONTAINS:d.INTERSECTS}}();var n=function(){var a;return function(b,c){a||(a=new h.Vector3);for(var d=0;d<8;d++){if(!f(e(b,d,a),c))return!1}return!0}}();d.prototype.boxOutsideCutPlanes=function(a){if(!this.cutPlanes)return!1;for(var b=0;b<this.cutPlanes.length;b++){var c=this.cutPlanes[b];if(n(a,c))return!0}return!1}},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.RenderFlags={RENDER_NORMAL:0,RENDER_HIGHLIGHTED:1,RENDER_HIGHLIGHTED1:1,RENDER_HIGHLIGHTED2:2,RENDER_HIDDEN:3,RENDER_SHADOWMAP:4,RENDER_FINISHED:5}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.LmvBox3=void 0;var d=c(119),e=b.LmvBox3=function(a,b){this.min=void 0!==a?a:new d.LmvVector3(1/0,1/0,1/0),this.max=void 0!==b?b:new d.LmvVector3(-1/0,-1/0,-1/0)};e.prototype={constructor:e,set:function(a,b){return this.min.copy(a),this.max.copy(b),this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromArray:function(a,b){return this.min.x=a[b],this.min.y=a[b+1],this.min.z=a[b+2],this.max.x=a[b+3],this.max.y=a[b+4],this.max.z=a[b+5],this},copyToArray:function(a,b){a[b]=this.min.x,a[b+1]=this.min.y,a[b+2]=this.min.z,a[b+3]=this.max.x,a[b+4]=this.max.y,a[b+5]=this.max.z},setFromCenterAndSize:function(){var a=new d.LmvVector3;return function(b,c){var d=a.copy(c).multiplyScalar(.5);return this.min.copy(b).sub(d),this.max.copy(b).add(d),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||new d.LmvVector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new d.LmvVector3).subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},containsPoint:function(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z)},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z},getParameter:function(a,b){return(b||new d.LmvVector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)},clampPoint:function(a,b){return(b||new d.LmvVector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new d.LmvVector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},applyMatrix4:function(){var a=[new d.LmvVector3,new d.LmvVector3,new d.LmvVector3,new d.LmvVector3,new d.LmvVector3,new d.LmvVector3,new d.LmvVector3,new d.LmvVector3];return function(b){return a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b),a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b),a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b),a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b),a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b),a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b),a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b),a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b),this.makeEmpty(),this.setFromPoints(a),this}}(),translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}},function(a,b,c){"use strict";function d(a,b,c,d){for(var e=new n.Box3,f=new j.ConsolidationBuilder,g=0;g<c.length&&!(f.costs>=d);g++){var h=c[g];a.getWorldBounds(h,e);var i=a.getGeometry(h),k=a.getMaterial(h);f.addGeom(i,k,e,h)}return f.createConsolidationMap(c,g)}function e(a,b,c,d,e){if(!(d>=c.length)){for(var f=d,g=-1,h=-1,i=d;i<c.length;i++){var j=c[i],k=a.getGeometryId(j),l=a.getMaterialId(j);k==g&&l==h||(i!=d&&o(a,b,c,f,i,e),f=i,g=k,h=l)}o(a,b,c,f,c.length,e)}}function f(a){for(var b=a.getCount(),c=[],d=0;d<b;d++){var e=a.getGeometryId(d),f=0|c[e];c[e]=f+1}return c}function g(a,b){function c(c,d){var e=a.getGeometry(c),f=a.getGeometry(d),g=b[e.id],h=b[f.id],i=g*e.byteSize,j=h*f.byteSize;return i!=j?i-j:e.id!=f.id?e.id-f.id:a.getMaterialId(c)-a.getMaterialId(d)}for(var d=0,e=a.getCount(),f=new Int32Array(e),g=0;g<e;g++)a.getGeometry(g)&&(f[d]=g,d++);if(d<e&&(f=new Int32Array(f.buffer,f.byteOffset,d)),f.sort)f.sort(c);else{var h=new Array(e);for(g=0;g<e;g++)h[g]=f[g];for(h.sort(c),g=0;g<f.length;g++)f[g]=h[g]}return f}function h(a,b,c,d){for(var e=a.geoms,f=[],g=0,h=0,i=0;i<b.meshes.length;i++){var j=b.meshes[i],k=j.geometry;k.byteSize||(k.byteSize=(k.vb.byteLength||0)+(k.ib.byteLength||0));var l=Number.isInteger(j.fragId);e.chooseMemoryType(k,k.numInstances,g,h),k.streamingDraw||(h+=k.byteSize,g+=1,l||(k.discardAfterUpload=!0)),l&&(f[k.id]=!0)}for(i=1;i<e.geoms.length;i++)if((k=e.geoms[i])&&!f[i]){var m=c[i];e.chooseMemoryType(k,m,g,h),k.streamingDraw&&d.deallocateGeometry(k),k.streamingDraw||(h+=k.byteSize,g+=1)}}function i(a,b,c,i,j){var k=i.supportsInstancedArrays();c=c||100<<20;var l=f(a);if(!j){j=d(a,b,g(a,l),c)}var m=j.buildConsolidation(a,b,a.model),n=j.fragOrder,o=j.numConsolidated;if(k)e(a,b,n,o,m);else for(var p=o;p<n.length;p++){var q=n[p];m.addSingleFragment(a,q)}h(a,m,l,i);var r=a.model.getModelId();for(p=0;p<m.meshes.length;p++){m.meshes[p].modelId=r}return m}Object.defineProperty(b,"__esModule",{value:!0}),b.consolidateFragmentList=i;var j=c(124),k=c(129),l=c(111),m=c(2),n=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(m),o=function(){var a=null,b=[];return function(c,d,e,f,g,h){a||(a=new n.Matrix4);var i=e[f],j=c.getGeometry(i),m=c.getMaterial(i),o=g-f;if(1==o)return void h.addSingleFragment(c,i);b.length=0;for(var p=new k.InstanceBufferBuilder(j,o),q=f;q<g;q++){var r=e[q];c.getOriginalWorldMatrix(r,a);var s=c.fragments.fragId2dbId[r];p.addInstance(a,s)||b.push(r)}var t=p.finish();if(t){var u=d.getMaterialVariant(m,l.MATERIAL_VARIANT.INSTANCED,c.model);h.addContainerMesh(t,u,e,f,o)}for(q=0;q<b.length;q++)r=b[q],h.addSingleFragment(c,r)}}()},function(a,b,c){"use strict";function d(a){return a.isLines?x.LINES:a.isPoints?x.POINTS:a.isWideLines?x.WIDE_LINES:x.TRIANGLES}function e(a,b){switch(!0===a.isLines&&(a.isLines=void 0),!0===a.isWideLines&&(a.isWideLines=void 0),!0===a.isPoints&&(a.isPoints=void 0),b){case x.LINES:a.isLines=!0;break;case x.WIDE_LINES:a.isWideLines=!0;break;case x.POINTS:a.isPoints=!0}}function f(a){this.geoms=[],this.matrices=[],this.vertexCount=0,this.material=a,this.fragIds=[],this.worldBox=new r.Box3}function g(a,b){a.vb&&a.vbstride||v.logger.warn("copyVertexFormat() supports only interleaved buffers");for(var c in a.attributes)b.attributes[c]=a.attributes[c];b.attributesKeys=a.attributesKeys.slice(0),b.vbstride=a.vbstride}function h(a,b){e(b,d(a)),b.lineWidth=a.lineWidth,b.pointSize=a.pointSize}function i(a){for(var b=a[0].vbstride,c=0,f=0,i=0,j=0;j<a.length;j++){var k=a[j];c+=a[j].ib.length,f+=(0,s.getVertexCount)(k),a[j].iblines&&(i+=a[j].iblines.length)}var l=(0,t.createBufferGeometry)();l.vb=new Float32Array(f*b),l.ib=new Uint16Array(c),i&&(l.iblines=new Uint16Array(i)),l.byteSize=l.vb.byteLength+l.ib.byteLength,l.iblines&&(l.byteSize+=l.iblines.byteLength),h(a[0],l),g(a[0],l)
;var m=new r.BufferAttribute(null,3);m.normalize=!0,m.bytesPerItem=1,l.addAttribute("id",m);var n=a[0];return e(l,d(n)),n.isPoints&&(l=n.pointSize),n.isWideLines&&(l=n.lineWidth),l}function j(a,b){for(var c=0,d=0,e=0,f=0,g=0;g<a.length;g++){for(var h=a[g],i=(0,s.getVertexCount)(h),j=0;j<h.ib.length;j++)b.ib[e+j]=h.ib[j]+d;if(h.iblines){for(var j=0;j<h.iblines.length;j++)b.iblines[f+j]=h.iblines[j]+d;f+=h.iblines.length}b.vb.set(h.vb,c),c+=h.vb.length,d+=i,e+=h.ib.length}}function k(a,b,c,d,e){var f=i(a);return f.boundingBox=d.clone(),j(a,f),e?e.addMergeTask(a,f,b,c):(0,u.runMergeSingleThreaded)(a,f,b,c),f}function l(a,b){if(a.vbstride!=b.vbstride)return!1;if(d(a)!==d(b))return!1;if(a.isPoints&&a.pointSize!==b.pointSize)return!1;if(a.isWideLines&&a.lineWidth!==b.lineWidth)return!1;if(a.attributesKeys.length!=b.attributesKeys.length)return!1;for(var c=0,e=a.attributesKeys.length;c<e;c++){var f=a.attributesKeys[c],g=a.attributes[f],h=b.attributes[f];if(!h)return!1;if(g===h)return!0;if(g.itemOffset!==h.itemOffset||g.normalize!==h.normalize||g.itemSize!==h.itemSize||g.bytesPerItem!==h.bytesPerItem||g.isPattern!==h.isPattern)return!1}return!0}function m(a){this.meshes=[],this.fragId2MeshIndex=new Int32Array(a);for(var b=0;b<this.fragId2MeshIndex.length;b++)this.fragId2MeshIndex[b]=-1;this.byteSize=0,this.consolidationMap=null}function n(){this.buckets={},this.bucketCount=0,this.costs=0}function o(a,b){this.fragOrder=new Uint32Array(a),this.ranges=new Uint32Array(b),this.boxes=new Array(b),this.numConsolidated=-1}function p(){return!!u.ParallelGeomMerge.createWorker}Object.defineProperty(b,"__esModule",{value:!0}),b.copyVertexFormat=g,b.copyPrimitiveProps=h,b.mergeGeometries=k,b.Consolidation=m,b.ConsolidationBuilder=n;var q=c(2),r=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(q),s=c(118),t=c(125),u=c(126),v=c(8),w=c(111),x={UNKNOWN:0,TRIANGLES:1,LINES:2,WIDE_LINES:3,POINTS:4};f.prototype={constructor:f,addGeom:function(a,b,c){this.geoms.push(a),this.fragIds.push(c),this.worldBox.union(b),this.vertexCount+=(0,s.getVertexCount)(a);var d=this.geoms.length;return 1==d?0:(void 0===a.byteSize&&v.logger.warn("Error in consolidation: Geometry must contain byteSize."),a.byteSize+(2==d?this.geoms[0].byteSize:0))}},m.prototype={constructor:m,addContainerMesh:function(a,b,c,d,e){var f=new r.Mesh(a,b);this.meshes.push(f),this.byteSize+=a.byteSize;var g=d||0,h=e||c.length,i=g+h;f.frustumCulled=!1;for(var j=this.meshes.length-1,k=g;k<i;k++){var l=c[k];this.fragId2MeshIndex[l]=j}},addSingleMesh:function(a,b,c,d,e){var f=new r.Mesh(a,b);f.matrix.copy(d),f.matrixAutoUpdate=!1,f.dbId=e,f.fragId=c,this.meshes.push(f),f.frustumCulled=!1,this.fragId2MeshIndex[c]=this.meshes.length-1},addSingleFragment:function(a,b){var c=a.getVizmesh(b);this.addSingleMesh(c.geometry,c.material,b,c.matrixWorld,c.dbId)}},n.prototype={addGeom:function(a,b,c,d){var e=null,g=this.buckets[b.id];if(g)for(var h=0;h<g.length;h++){var i=g[h],j=i.geoms[0];if(l(j,a)){var k=(0,s.getVertexCount)(a);if(!(k+i.vertexCount>65535)){e=i;break}}}e||(e=new f(b),this.bucketCount++,this.buckets[b.id]?this.buckets[b.id].push(e):this.buckets[b.id]=[e]),this.costs+=e.addGeom(a,c,d)},createConsolidationMap:function(a,b){var c=a.length,d=new o(c,this.bucketCount),e=0,f=0;for(var g in this.buckets)for(var h=this.buckets[g],i=0;i<h.length;i++){var j=h[i];d.ranges[f]=e,d.boxes[f]=j.worldBox,d.fragOrder.set(j.fragIds,e),e+=j.fragIds.length,f++}d.numConsolidated=b;for(var k=b;k<a.length;k++)d.fragOrder[k]=a[k];return d}},o.prototype={buildConsolidation:function(a,b,c){var d=this.fragOrder,e=a.getCount(),f=this.ranges.length,g=new m(e),h=null;p()&&(h=new u.ParallelGeomMerge(g));for(var i=[],j=new r.Matrix4,l=0;l<f;l++){var n=this.ranges[l],o=l===f-1?this.numConsolidated:this.ranges[l+1],q=o-n;if(1===q){var s=d[n];g.addSingleFragment(a,s,g)}i.length=q;for(var t=new Float32Array(16*q),v=new Uint32Array(q),x=0;x<q;x++)s=d[n+x],i[x]=a.getGeometry(s),a.getOriginalWorldMatrix(s,j),t.set(j.elements,16*x),v[x]=a.getDbIds(s);var y=this.boxes[l],z=d[n],A=a.getMaterial(z),B=k(i,t,v,y,h),C=b.getMaterialVariant(A,w.MATERIAL_VARIANT.VERTEX_IDS,c);g.addContainerMesh(B,C,d,n,q)}return h&&h.runTasks(),g.consolidationMap=this,g}},m.applyBVHDefaults=function(a){a.frags_per_leaf_node=512,a.max_polys_per_node=1e5},m.getDefaultBVHOptions=function(){var a={};return m.applyBVHDefaults(a),a}},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b,c){var d;if(b.array)d=new q.BufferAttribute(b.array,b.itemSize);else{var e=a+"|"+b.bytesPerItem+"|"+b.normalize+"|"+b.isPattern+"|"+b.divisor+"|"+b.offset;if(d=s[e])return d;d=new q.BufferAttribute(void 0,b.itemSize),s[e]=d}return d.bytesPerItem=b.bytesPerItem,d.normalize=b.normalize,d.isPattern=b.isPattern,c&&(d.divisor=b.divisor),b.array||(b.hasOwnProperty("offset")?d.itemOffset=b.offset:r.logger.warn("VB attribute is neither interleaved nor separate. Something is wrong with the buffer specificaiton.")),d}function f(a){var b="";for(var c in a.attributes)b+=c+"|";var d=t[b];return d||(d=Object.keys(a.attributes),t[b]=d,d)}function g(){j=new q.BufferAttribute(void 0,1),j.bytesPerItem=2,k=new q.BufferAttribute(void 0,1),k.bytesPerItem=4,l=function(){this.id=u++,this.attributes={},this.__webglInit=void 0},l.prototype=Object.create(q.BufferGeometry.prototype),l.prototype.constructor=l}function h(){return l||g(),new l}function i(a){var b=a.mesh,c=h();(0,o.isNodeJS)()&&(c.packId=a.packId,c.meshIndex=a.meshIndex),c.byteSize=0,c.vb=b.vb,c.vbbuffer=void 0,c.vbNeedsUpdate=!0,c.byteSize+=b.vb.byteLength,c.hash=a.hash,c.vbstride=b.vbstride,b.isLines&&(c.isLines=b.isLines),b.isWideLines&&(c.isWideLines=!0,c.lineWidth=b.lineWidth),b.isPoints&&(c.isPoints=b.isPoints,c.pointSize=b.pointSize),a.is2d&&(c.is2d=!0),c.numInstances=b.numInstances;for(var d in b.vblayout){var g=b.vblayout[d];c.attributes[d]=e(d,g,c.numInstances)}if(n.memoryOptimizedLoading)c.attributes.index=b.indices instanceof Uint32Array?k:j,c.ib=b.indices,c.ibbuffer=void 0,b.iblines&&(c.attributes.indexlines=b.iblines instanceof Uint32Array?k:j,c.iblines=b.iblines,c.iblinesbuffer=void 0);else{var i=new q.BufferAttribute(b.indices,1);i.bytesPerItem=b.indices instanceof Uint32Array?4:2,c.addAttribute("index",i)}c.attributesKeys=f(c),c.byteSize+=b.indices.byteLength,c.boundingBox=(new q.Box3).copy(b.boundingBox),c.boundingSphere=(new q.Sphere).copy(b.boundingSphere),a.geometry=c,a.mesh=null}Object.defineProperty(b,"__esModule",{value:!0}),b.BufferGeometryUtils=void 0,b.createBufferGeometry=h,b.meshToGeometry=i;var j,k,l,m=c(37),n=d(m),o=c(4),p=c(2),q=d(p),r=c(8),s={},t={},u=1;b.BufferGeometryUtils={meshToGeometry:i,createBufferGeometry:h}},function(a,b,c){"use strict";function d(a){for(var b=new Uint16Array(a.length+1),c=0,d=0;d<a.length;d++)b[d]=c,c+=(0,j.getVertexCount)(a[d]);return b[d]=c,b}function e(a,b,c,e){var f=d(a),g=new i.GeomMergeTask;return g.vb=b.vb,g.vbstride=b.vbstride,g.posOffset=b.attributes.position.itemOffset,g.normalOffset=b.attributes.normal?b.attributes.normal.itemOffset:-1,g.matrices=c,g.ranges=f,g.dbIds=e,g}function f(a,b){b.vb=a.vb,b.attributes.id.array=a.vertexIds,b.needsUpdate=!0}function g(a){function b(a){for(var b=a.data,e=0;e<b.length;e++){var g=b[e],h=g.taskId;f(g,d[h]),delete d[h]}if(0===--c)for(i.inProgress=!1,e=0;e<j.length;e++)j[e].clearAllEventListenerWithIntercept(),j[e].terminate(),j[e]=null}var c=0,d={},h=[],i=a,j=new Array(2);this.addMergeTask=function(a,b,c,f){var g=e(a,b,c,f);h.push(g),d[g.id]=b},this.runTasks=function(){for(var a=0;a<2;a++)j[a]=g.createWorker(),j[a].addEventListenerWithIntercept(b);for(var d=h.length,e=Math.floor(d/2),f=0;f<2;f++){var k=1===f,l=f*e,m=k?d:l+e,n=m-l,o=[],p=new Array(4*n),q=0;for(a=l;a<m;a++){var r=h[a];p[q++]=r.vb.buffer,p[q++]=r.matrices.buffer,p[q++]=r.ranges.buffer,p[q++]=r.dbIds.buffer,o.push(r)}var s={operation:"MERGE_GEOMETRY",tasks:o};j[f].doOperation(s,p),c++}i.inProgress=!0}}function h(a,b,c,d){var g=e(a,b,c,d),h=new m.LmvVector3,i=new l.LmvMatrix4;f(g.run(i,h),b)}Object.defineProperty(b,"__esModule",{value:!0}),b.ParallelGeomMerge=g,b.runMergeSingleThreaded=h;var i=c(127),j=c(118),k=c(10),l=c(128),m=c(119);g.createWorker=k.createWorkerWithIntercept},function(a,b){"use strict";function c(){return j++}function d(){this.vb=null,this.vbstride=0,this.posOffset=0,this.normalOffset=0,this.matrices=null,this.ranges=null,this.dbIds=null,this.id=c()}function e(a){a.x=.5*(1+Math.atan2(a.y,a.x)/Math.PI),a.y=.5*(1+a.z),a.z=0}function f(a){var b=2*a.x-1,c=2*a.y-1,d=Math.sin(b*Math.PI),e=Math.cos(b*Math.PI),f=Math.sqrt(1-c*c),g=c;a.x=e*f,a.y=d*f,a.z=g}function g(a,b,c){b[c++]=255&a,b[c++]=a>>8&255,b[c++]=a>>16&255,b[c]=0}function h(a,b){return b.copy(a),b[12]=0,b[13]=0,b[14]=0,b.getInverse(b).transpose()}function i(a,b,c){for(var d=16*a,e=0;e<16;e++)c.elements[e]=b[e+d]}Object.defineProperty(b,"__esModule",{value:!0}),b.GeomMergeTask=d,b.writeIdToBuffer=g;var j=1,k=function(a,b,c,d,g,i,j){for(var k=a.posOffset,l=d;l<g;l++){var m=l*a.vbstride+k;j.set(a.vb[m],a.vb[m+1],a.vb[m+2]),j.applyMatrix4(c),a.vb[m]=j.x,a.vb[m+1]=j.y,a.vb[m+2]=j.z}if(-1!==a.normalOffset){var n=2*a.vbstride,o=2*a.normalOffset,p=h(c,i);for(l=d;l<g;l++){var q=l*n+o;j.set(b[q],b[q+1],0),j.divideScalar(65535),f(j),j.applyMatrix4(p),j.normalize(),e(j),j.multiplyScalar(65535),b[q]=j.x,b[q+1]=j.y}}};d.prototype.run=function(a,b){for(var c=this.vb,d=c.length/this.vbstride,e=a.clone(),f=new Uint8Array(3*d),h=-1!==this.normalOffset,j=h?new Uint16Array(c.buffer,c.byteOffset,2*c.length):null,l=this.ranges,m=this.matrices,n=l.length-1,o=0;o<n;o++){var p=l[o],q=l[o+1];i(o,m,a),k(this,j,a,p,q,e,b);for(var r=3*p,s=q-p,t=this.dbIds[o],u=0;u<s;u++)g(t,f,r),r+=3}return{taskId:this.id,vb:this.vb,vertexIds:f}}},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=b.LmvMatrix4=function(a){this.elements=a?new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]):new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};c.prototype={constructor:c,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(a){return this.elements.set(a.elements),this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},multiply:function(a){return this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},multiplyToArray:function(a,b,c){var d=this.elements;return this.multiplyMatrices(a,b),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14];return a[3]*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+a[7]*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+a[11]*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+a[15]*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a},setPosition:function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],i=d[1],j=d[5],k=d[9],l=d[13],m=d[2],n=d[6],o=d[10],p=d[14],q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t,c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t,c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t,c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p,c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t,c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t,c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t,c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p,c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t,c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t,c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t,c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p,c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s,c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s,c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s,c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=e*c[0]+i*c[4]+m*c[8]+q*c[12];if(0==u){var v="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(v);return console.warn(v),this.identity(),this}return this.multiplyScalar(1/u),this},scale:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},compose:function(a,b,c){return this.makeRotationFromQuaternion(b),this.scale(c),this.setPosition(a),this},transformPoint:function(a){var b=a.x,c=a.y,d=a.z,e=this.elements;return a.x=e[0]*b+e[4]*c+e[8]*d+e[12],a.y=e[1]*b+e[5]*c+e[9]*d+e[13],a.z=e[2]*b+e[6]*c+e[10]*d+e[14],a},transformDirection:function(a){var b=a.x,c=a.y,d=a.z,e=this.elements;a.x=e[0]*b+e[4]*c+e[8]*d,a.y=e[1]*b+e[5]*c+e[9]*d,a.z=e[2]*b+e[6]*c+e[10]*d;var f=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);if(f>0){var g=1/f;a.x*=g,a.y*=g,a.z*=g}return a},fromArray:function(a){return this.elements.set(a),this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return new c(this.elements instanceof Float64Array).fromArray(this.elements)}}},function(a,b,c){"use strict";function d(a,b){function c(a,b,c,d){m.compose(b,c,d);for(var e=a.elements,f=m.elements,g=0;g<16;g++){var h=e[g],i=f[g];if(Math.abs(i-h)>1e-5)return!1}return!0}var d=(0,g.createBufferGeometry)();d.ib=a.ib,d.vb=a.vb,d.iblines=a.iblines,(0,e.copyVertexFormat)(a,d),(0,e.copyPrimitiveProps)(a,d);this.offsets=new Float32Array(3*b),this.rotations=new Float32Array(4*b),this.scalings=new Float32Array(3*b),this.ids=new Uint8Array(3*b);var i=new j.Vector3,k=new j.Quaternion,l=new j.Vector3,m=new j.Matrix4,n=0,o=b;this.addInstance=function(a,b){return n>=o?(h.logger.warn("Instance buffer is already full."),!1):(a.decompose(i,k,l),!!c(a,i,k,l)&&(this.offsets[3*n]=i.x,this.offsets[3*n+1]=i.y,this.offsets[3*n+2]=i.z,this.rotations[4*n]=k.x,this.rotations[4*n+1]=k.y,this.rotations[4*n+2]=k.z,this.rotations[4*n+3]=k.w,this.scalings[3*n]=l.x,this.scalings[3*n+1]=l.y,this.scalings[3*n+2]=l.z,(0,f.writeIdToBuffer)(b,this.ids,3*n),n++,!0))},this.finish=function(){if(0==n)return null;n<o&&(this.offsets=new Float32Array(this.offsets.buffer,0,3*n),this.rotations=new Float32Array(this.rotations.buffer,0,4*n),this.scalings=new Float32Array(this.scalings.buffer,0,3*n),this.ids=new Uint8Array(this.ids.buffer,0,3*n));var a=new j.BufferAttribute(this.offsets,3),b=new j.BufferAttribute(this.rotations,4),c=new j.BufferAttribute(this.scalings,3),e=new j.BufferAttribute(this.ids,3);return e.normalize=!0,e.bytesPerItem=1,a.divisor=1,b.divisor=1,c.divisor=1,e.divisor=1,d.addAttribute("instOffset",a),d.addAttribute("instRotation",b),d.addAttribute("instScaling",c),d.addAttribute("id",e),d.numInstances=n,d.byteSize=d.vb.byteLength+d.ib.byteLength+this.offsets.byteLength+this.rotations.byteLength+this.scalings.byteLength,d}}Object.defineProperty(b,"__esModule",{value:!0}),b.InstanceBufferBuilder=d;var e=c(124),f=c(127),g=c(125),h=c(8),i=c(2),j=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(i)},function(a,b,c){"use strict";function d(a,b){function c(a){o[a]||(o[a]=new h.Scene);var b=o[a];return b.children.length=0,b}function d(a){return a.numInstances?r.Instanced:a.attributes.id?r.Merged:r.Original}function g(a){if(n)return r.Original;var b=l.fragId2MeshIndex[a];return d(l.meshes[b].geometry)}var k=a,l=b,m=[],n=!1,o=[],p=new h.Matrix4,q=new h.Box3;this.getConsolidation=function(){return l},this.reset=function(){m.length=null;var a=k.getCount();n=!1;for(var b=k.db2ThemingColor.length>0,c=0;c<a;c++){var d=k.vizflags[c],e=0==(d&i.MeshFlags.MESH_VISIBLE),f=0!=(d&i.MeshFlags.MESH_HIDE),g=0!=(d&i.MeshFlags.MESH_MOVED),h=!1;if(b){var j=k.fragments.fragId2dbId[c];h=!!k.db2ThemingColor[j]}if(e||f||h||g){n=!0;break}}},this.dispose=function(){for(var a=0;a<l.meshes.length;a++){var b=l.meshes[a],c=b.geometry;c&&(c.dispose(),c.needsUpdate=!0)}},this.consolidateNextBatch=function(a,b){var d=a.nodeIndex;if(n||void 0===d)return a;if(l.inProgress)return a;for(var e=c(d),f=a.start;f<a.lastItem;f++){var g=a.indices?a.indices[f]:f,i=l.fragId2MeshIndex[g],o=null;if(-1===i){if(!k.getGeometry(g))continue;return j.logger.warn("Warning: Missing fragment in consolidation. Consolidation disabled."),a}if(!m[i]&&(k.getWorldBounds(g,q),b.intersectsBox(q))){o=l.meshes[i],m[i]=!0;var p=o&&o.geometry,r=p&&(p.isLines||p.isWideLines),s=p&&p.isPoints;k.linesHidden&&r||k.pointsHidden&&s||e.children.push(o)}}return e.boundingBox||(e.boundingBox=new h.Box3),a.getBoundingBox(e.boundingBox),e.renderImportance=a.renderImportance,e.sortObjects=a.sortObjects,e};var r={Merged:1,Instanced:2,Original:3};this.updateRenderProxy=function(a,b){if(a.geometry&&a.geometry.attributes){var c=g(b);if(d(a.geometry)!=c){var h=k.getGeometry(b),i=l.fragId2MeshIndex[b],j=l.meshes[i];if(c===r.Original)a.geometry=h,a.material=k.getMaterial(b),k.getWorldMatrix(b,a.matrix);else if(c===r.Instanced){k.getWorldMatrix(b,p);var m=k.fragments.fragId2dbId[b],n=new f.InstanceBufferBuilder(h,1);n.addInstance(p,m),a.geometry=n.finish(),a.material=j.material,a.matrix.identity()}else k.getWorldMatrix(b,p),k.getWorldBounds(b,q),m=k.fragments.fragId2dbId[b],a.geometry=(0,e.mergeGeometries)([h],p.elements,[m],q),a.material=j.material,a.matrix.identity();a.dispatchEvent({type:"removed"})}}}}Object.defineProperty(b,"__esModule",{value:!0}),b.ConsolidationIterator=d;var e=c(124),f=c(129),g=c(2),h=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(g),i=c(115),j=c(8)},function(a,b,c){"use strict";function d(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a){return a.matrix.elements[2]+a.matrix.elements[12]}Object.defineProperty(b,"__esModule",{value:!0}),b.HighlightIteratorLinear=b.ModelIteratorLinear=b.IteratorLinear=void 0;var h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=c(116),k=c(132),l=c(4),m=function(a){var b=500;return a&&(b/=3),(0,l.isMobileDevice)()&&(b/=3,a&&(b/=2)),b=Math.floor(b),b>0?b:500},n=b.IteratorLinear=function(){function a(b,c,d){f(this,a),this._frags=b.getFragmentList(),this._model=b,this._fillLast=d,this._fragsPerScene=m(b.is2d()),this._fragOrder=[],this._geomScenes=[];for(var e=new Int32Array(c),g=0;g<this._fragCount;g++)e[g]=g;this.setFragmentOrder(e,c)}return i(a,[{key:"setFragmentOrder",value:function(a,b){this._fragCount=b,this._fragOrder[0]=a;var c=Math.ceil(this._fragCount/this._fragsPerScene),d=this._frags.onDemandLoadingEnabled(),e=this._RBClass=d?k.RenderBatchLess:j.RenderBatch,f=this._geomScenes.length;this._geomScenes.length=c;for(var g=this._geomScenes,h=this._fragsPerScene,i=0;i<c;i++){var l=i*h,m=i<f?g[i]:g[i]=new e(this._frags,this._fragOrder,l,this._fragsPerScene),n=l+this._fragsPerScene;n>this._fragCount&&(n=this._fragCount),m.lastItem=n,d&&m.calculateBounds()}}},{key:"addFragment",value:function(a){if(this._fragOrder[0].length<=a){var b=2*this._fragOrder[0].length;b<=a&&(b=a+1);var c=new Int32Array(b);c.set(this._fragOrder[0]),this._fragOrder[0]=c}this._fragOrder[0][a]=a;var d=Math.floor(a/this._fragsPerScene);if(this._geomScenes){var e=this._geomScenes[d];e||(this._geomScenes[d]=e=new this._RBClass(this._frags,this._fragOrder,d*this._fragsPerScene,this._fragsPerScene)),e&&e.onFragmentAdded(a,a)}}},{key:"getFragmentCount",value:function(){if(!this._geomScenes.length)return 0;for(var a=this._geomScenes[this._geomScenes.length-1].lastItem;--a>=0&&!(this._frags.geomids[a]>=0););return a+1}},{key:"reset",value:function(a,b){if(this._currentScene=0,this._fillLast&&this._geomScenes[0]&&(this._geomScenes[0].drawEnd=0),this._resetVisStatus){for(var c=this._geomScenes,d=c.length,e=0;e<d;++e){var f=c[e];f&&f.resetVisStatus&&f.resetVisStatus()}this._resetVisStatus=!1}}},{key:"getSceneCount",value:function(){return this._geomScenes.length}},{key:"getGeomScenes",value:function(){return this._geomScenes}},{key:"resetVisStatus",value:function(){this._resetVisStatus=!0}},{key:"done",value:function(){if(this._fillLast&&!this._model.isLoadDone())return!1;var a;return this._currentScene>=this._geomScenes.length-1&&(!(a=this._geomScenes[this._currentScene])||a.drawStart>=a.lastItem)}},{key:"nextBatch",value:function(){if(this._currentScene>=this.getSceneCount())return null;var a=this._geomScenes[this._currentScene];if(this._fillLast){if(a.lastItem>=a.start+a.count&&(++this._currentScene,this._geomScenes[this._currentScene]&&(this._geomScenes[this._currentScene].drawEnd=this._geomScenes[this._currentScene].start)),a.drawStart=a.drawEnd,a.drawEnd=a.lastItem,a.hasOwnProperty("drawStart")&&a.lastItem<=a.drawStart)return null}else++this._currentScene;return a.renderImportance=0,a}},{key:"getVisibleBounds",value:function(a,b){for(var c=this.getSceneCount(),d=0;d<c;d++){this._geomScenes[d].calculateBounds();var e=this._geomScenes[d].getBoundingBox();a.union(e),b.union(e),b.union(this._geomScenes[d].getBoundingBoxHidden())}}},{key:"rayCast",value:function(a,b,c){for(var d=this.getSceneCount(),e=0;e<d;e++)this._geomScenes[e].raycast(a,b,c)}}]),a}();b.ModelIteratorLinear=function(a){function b(a){f(this,b);var c=a.getFragmentList(),e=a.is2d()&&!c.onDemandLoadingEnabled(),g=d(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c.getCount(),e));return g._lastCameraHash=0,g._cameraChanged=!1,g}return e(b,a),i(b,[{key:"calculateFragOrder",value:function(a){if(this._model.isvizCacheEnabled){var b,c=this._model.readbackTargetIdCallback(),d={},e=c.width*c.height,f=c.buffer;for(b=0;b<e;b++){var g=f[4*b+2]<<16|f[4*b+1]<<8|f[4*b];16777215!=g&&(d[g]=1+(0|d[g]))}var h=Object.keys(d).sort(function(a,b){return d[b]-d[a]}).map(Number);this._model.setFastLoadList(h,this._lastCameraObj);var i=this._fragOrder[0];i.set(h);var j=h.length;for(b=0;b<this._fragCount;++b)d[b]||(i[j++]=b)}}},{key:"reset",value:function(a,c){h(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"reset",this).call(this,a,c),this._lastCameraHash!=g(c)&&(this._cameraChanged=!0),this._lastCameraHash=g(c),this._lastCameraObj=c}},{key:"nextBatch",value:function(){return this._model.isvizCacheEnabled&&this._cameraChanged&&(90==this._currentScene||400==this._currentScene||this._currentScene==this.getSceneCount()-1)&&(this._currentScene==this.getSceneCount()-1&&this._model.isLoadDone()&&(this._cameraChanged=!1),this.calculateFragOrder(this._currentScene>=this.getSceneCount()-1)),h(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"nextBatch",this).call(this)}}]),b}(n),b.HighlightIteratorLinear=function(a){function b(a){f(this,b);var c=(a.getFragmentList(),d(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,0,!1)));return c._ids={},c._curCount=0,c._dirty=!1,c}return e(b,a),i(b,[{key:"addFragment",value:function(a){this._ids[a]||(this._ids[a]=!0,++this._curCount,this._dirty=!0)}},{key:"removeFragment",value:function(a){this._ids[a]&&(delete this._ids[a],--this._curCount,this._dirty=!0)}},{key:"reset",value:function(a,c){if(this._dirty){for(var d=Object.keys(this._ids),e=new Int32Array(d.length),f=d.length;--f>=0;)e[f]=parseInt(d[f]);this.setFragmentOrder(e,d.length),this._dirty=!1}h(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"reset",this).call(this,a,c)}},{key:"getSceneCount",value:function(){return Math.ceil(this._curCount/this._fragsPerScene)}}]),b}(n)},function(a,b,c){"use strict";function d(a,b,c,d){g.RenderBatch.call(this,a,b,c,d),this.visibleStats=0}function e(a,b,c,d,e){var f,g=b[c]&~k.MeshFlags.MESH_RENDERFLAG;switch(a){case l.RenderFlags.RENDER_HIDDEN:f=!(g&k.MeshFlags.MESH_VISIBLE);break;case l.RenderFlags.RENDER_HIGHLIGHTED1:case l.RenderFlags.RENDER_HIGHLIGHTED2:f=g&k.MeshFlags.MESH_HIGHLIGHTED;break;default:f=1==(g&(k.MeshFlags.MESH_VISIBLE|k.MeshFlags.MESH_HIGHLIGHTED|k.MeshFlags.MESH_HIDE))}if(d){var h=g&(k.MeshFlags.MESH_ISLINE|k.MeshFlags.MESH_ISWIDELINE);f=f&&!h}if(e){var i=g&k.MeshFlags.MESH_ISPOINT;f=f&&!i}return b[c]=g|(f?k.MeshFlags.MESH_RENDERFLAG:0),f}function f(a,b,c,d){var e=!1;n||(n=new j.Box3),c.getWorldBounds(d,n);var f=b.intersectsBox(n);if(a&&f===h.FrustumIntersector.OUTSIDE)e=!0;else if(c.pixelCullingEnable()){var g=b.projectedBoxArea(n,f===h.FrustumIntersector.CONTAINS);g*=b.areaConv,g<c.pixelCullingThreshold()&&(e=!0)}return e}Object.defineProperty(b,"__esModule",{value:!0}),b.RenderBatchLess=d;var g=c(116),h=c(120),i=c(2),j=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(i),k=c(115),l=c(121),m=c(122),n=new m.LmvBox3;d.prototype=Object.create(g.RenderBatch.prototype),d.prototype.constructor=d,d.prototype.resetVisStatus=function(){this.visibleStats=0},d.prototype.forEach=function(a,b,c){for(var d=this.getIndices(),e=this.frags,f=!this.sortByShaderDone,g=e.pageOutGeometryEnabled(),h=e.onDemandLoadingEnabled(),i=this.start,j=this.lastItem;i<j;i++){var l=d?d[i]:i,m=e.getVizmesh(l,this.renderImportance,!0);if(!f||m&&m.material&&m.material.program&&!m.geometry_proxy||(f=!1),h){if(e.isFlagSet(l,k.MeshFlags.MESH_TRAVERSED)&&b==k.MeshFlags.MESH_RENDERFLAG)continue;if(!c&&b&&e.isFlagSet(l,b)&&(m.geometry||(m.geometry=e.requireGeometry(l),l<this.drawOrderRender&&(this.drawOrderRender=l),!m.geometry&&m.geometry_proxy&&(m.geometry=m.geometry_proxy)),m.geometry)){var n=b==k.MeshFlags.MESH_RENDERFLAG&&e.isFlagSet(l,k.MeshFlags.MESH_DRAWN);if(b==k.MeshFlags.MESH_RENDERFLAG){if(!(void 0==this.drawOrderRender||l<this.drawOrderRender))continue;e.setFlagFragment(l,k.MeshFlags.MESH_DRAWN,!0)}if(!n&&g&&e.pagingProxy){var o=e.getMaterial(l);o&&e.pagingProxy.onGeomTraversed(m.geometry,o.transparent)}}}!(c||m&&m.geometry)||b&&!e.isFlagSet(l,b)||a(m,l)}f&&this.sortByShader()},d.prototype.applyVisibility=function(){function a(a,h){if(!a&&b.useThreeMesh)return void(i&&i(h));if(o||f(m,d,b,h)){if(a?a.visible=!1:j.warn("Unexpected null mesh"),c[h]=c[h]&~k.MeshFlags.MESH_RENDERFLAG,b.pageOutGeometryEnabled()){var l=b.geomids[h],p=b.geoms.getGeometry(l);b.pagingProxy&&b.pagingProxy.onGeomCulled(p)}}else{var q=e(g,c,h);a&&(a.visible=!!q),n=n&&!q}}var b,c,d,g,i,m,n,o;return function(e,f,j){n=!0,o=!1,d=f,g=e,i=j,b=this.frags;var k=g===l.RenderFlags.RENDER_HIDDEN?this.getBoundingBoxHidden():this.getBoundingBox(),p=d.intersectsBox(k);if(p===h.FrustumIntersector.OUTSIDE&&(o=!0),m=p!==h.FrustumIntersector.CONTAINS,b.pixelCullingEnable()){var q=this.renderImportance;0==q&&(q=d.projectedBoxArea(k,!m)),q*=d.areaConv,q<b.pixelCullingThreshold()&&(o=!0)}return c=this.frags.vizflags,this.forEach(a,null,i),n}}()},function(a,b,c){"use strict";function d(){function a(a){var b=p[a],c=h;if(q)for(;c>d&&p[o[c-1]]>b;)o[c]=o[c-1],c--;else for(;c>d&&p[o[c-1]]<b;)o[c]=o[c-1],c--;o[c]=a,h++}function b(a){var c=k.getLeftChild(a);-1!==c&&(b(c),b(c+1)),u.makeEmpty(),-1!==c&&(k.getBoxThree(c,v),u.union(v),k.getBoxThree(c+1,v),u.union(v)),k.getPrimCount(a)&&(u.union(m[a].getBoundingBox()),u.union(m[a].getBoundingBoxHidden())),k.setBoxThree(a,u)}var c,d,h,j,k=null,l=null,m=null,n=null,o=null,p=null,q=1,r=!0,s=!1,t=!1,u=new i.Box3,v=new i.Box3,w=!1,x=!0;this.initialize=function(a,b,d,g){c=a.getFragmentList(),g&&g.hasOwnProperty("prioritize_screen_size")&&(r=g.prioritize_screen_size),l=d,m=new Array(b.nodeCount),n=new Int8Array(b.nodeCount),k=b,o=new Int32Array(b.nodeCount+1),p=new Float32Array(b.nodeCount);for(var h=c.onDemandLoadingEnabled()?f.RenderBatchLess:e.RenderBatch,i=0;i<b.nodeCount;i++){var j=b.getPrimCount(i);j&&(m[i]=new h(c,l,b.getPrimStart(i),j),m[i].lastItem=m[i].start+j,m[i].numAdded=j,m[i].nodeIndex=i,8&b.getFlags(i)&&(m[i].sortObjects=!0),b.getBoxArray(i,m[i].bboxes))}},this.addFragment=function(a,b){},this.reset=function(a){if(j=a,d=0,h=0,n[0]=n[1]=g.FrustumIntersector.CONTAINMENT_UNKNOWN,o[h++]=0,s=!1,t=!1,w=!1,x){for(var b=m,c=b.length,e=0;e<c;++e){var f=b[e];f&&f.resetVisStatus&&f.resetVisStatus()}x=!1}},this.nextBatch=function(){for(t||s||d!==h||(o[h++]=1,s=!0);d!==h;){var b=q||s?o[--h]:o[d++],c=n[b];if(c!==g.FrustumIntersector.CONTAINS&&(k.getBoxThree(b,u),c=j.intersectsBox(u)),c!==g.FrustumIntersector.OUTSIDE){var e,f,i=k.getLeftChild(b),l=-1!==i;if(l){var v=k.getFlags(b),x=j.viewDir[3&v]<0?1:0,y=v>>2&1,z=v>>3&1,A=q||s?1:0,B=0,C=0;r&&!s?(e=i+y,f=i+1-y,k.getBoxThree(e,u),p[e]=B=j.projectedBoxArea(u,c===g.FrustumIntersector.CONTAINS),k.getBoxThree(f,u),p[f]=C=j.projectedBoxArea(u,c===g.FrustumIntersector.CONTAINS),n[e]=n[f]=c,B>0&&a(e),C>0&&a(f)):(x^A^z&&(y=1-y),e=i+y,f=i+1-y,
o[h++]=e,p[e]=-1,o[h++]=f,p[f]=-1,n[e]=n[f]=c)}if(0!==k.getPrimCount(b)){var D=m[b];return D.renderImportance=j.projectedBoxArea(D.getBoundingBox(),c===g.FrustumIntersector.CONTAINS),D}}s||t||d!==h||(o[h++]=1,s=!0)}return w=!0,null},this.skipOpaqueShapes=function(){s||t||(d=0,h=0,o[h++]=1,t=!0)},this.getVisibleBounds=function(a,c){for(var d=0;d<m.length;d++){var e=m[d];if(e){e.calculateBounds();var f=e.getBoundingBox();a.union(f),c.union(f),c.union(e.getBoundingBoxHidden())}}b(0),b(1)},this.rayCast=function(a,b,c){for(var d=[1,0],e=new i.Vector3;d.length;){var f=d.pop();k.getBoxThree(f,u),u.expandByScalar(.5);if(null!==a.ray.intersectBox(u,e)){var g=k.getLeftChild(f);-1!==g&&(d.push(g),d.push(g+1));if(0!==k.getPrimCount(f)){m[f].raycast(a,b,c)}}}},this.getSceneCount=function(){return m.length},this.getGeomScenes=function(){return m},this.resetVisStatus=function(){x=!0},this.done=function(){return w}}Object.defineProperty(b,"__esModule",{value:!0}),b.ModelIteratorBVH=d;var e=c(116),f=c(132),g=c(120),h=c(2),i=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(h)},function(a,b,c){"use strict";function d(a,b,c){var d=a.clone();return d.max(b),d.min(c),d.distanceToSquared(a)}function e(a,b,c,d){var e=a.clone();return e.max(c),e.min(d),e.sub(a).dot(b)}function f(){function a(a,b,c){var d=Math.ceil(Math.log2(a)),e=Math.ceil(Math.log2(b));return Math.max(d,e)-Math.log2(c)}function b(a,b,c){var d=b-c;d>0&&(a.texWidth>>=d,a.texHeight>>=d,a.maxLevel=c)}this.urlPattern=null,this.tileSize=null,this.maxLevel=null,this.textureLoader=null,this.texWidth=0,this.texHeight=0,this.maxActiveTiles=(0,h.isMobileDevice)()?0:400,this.cacheSize=(0,h.isMobileDevice)()?0:150,this.onRootLoaded=null,this.levelOffset=0,this.pixelRatio=1,this.getRootTileSize=function(){return 1*(this.tileSize<<this.maxLevel)},this.getQuadWidth=function(){return 1*this.texWidth/this.getRootTileSize()},this.getQuadHeight=function(){return 1*this.texHeight/this.getRootTileSize()},this.getPageToModelTransform=function(a,b){var c=a/this.getQuadWidth(),d=b/this.getQuadHeight();return new k.LmvMatrix4(!0).set(c,0,0,0,0,d,0,0,0,0,1,0,0,0,0,1)},this.getBBox=function(){var a=this.getQuadWidth(),b=this.getQuadHeight(),c=1-b;return new n.Box3(new n.Vector3(0,c,0),new n.Vector3(a,1,0))},this.valid=function(){return"string"==typeof this.urlPattern&&this.urlPattern.length>0&&"number"==typeof this.tileSize&&this.tileSize>0&&"number"==typeof this.maxLevel&&this.maxLevel>0&&"number"==typeof this.texWidth&&this.texWidth>0&&"number"==typeof this.texHeight&&this.texHeight>0},this.initForSimpleImage=function(a,b){this.urlPattern=decodeURIComponent(a),this.maxLevel=0,this.levelOffset=0,this.tileSize=-1,this.texWidth=-1,this.texHeight=-1,this.onRootLoaded=b,this.isSimpleImage=!0},this.initFromLoadOptions=function(c,d,e){this.urlPattern=decodeURIComponent(c),this.textureLoader=e,d&&(this.tileSize=d.tileSize,this.maxLevel=a(d.texWidth,d.texHeight,d.tileSize),this.texWidth=d.texWidth,this.texHeight=d.texHeight,this.levelOffset=d.levelOffset,"number"==typeof d.maxLevel&&b(this,this.maxLevel,d.maxLevel),this.maxActiveTiles=d.maxActiveTiles||this.maxActiveTiles,this.cacheSize=d.cacheSize||this.cacheSize,this.zips=d.zips)}}function g(a,b){function c(a){var b=J.maxLevel-a;return J.texWidth>>b}function f(a){var b=J.maxLevel-a;return J.texHeight>>b}function g(a){var b=c(a.level),d=f(a.level),e=a.x*J.tileSize,g=a.y*J.tileSize;return e>=b||g>=d}function h(a){var b=c(a.level),d=f(a.level),e=a.x*J.tileSize,g=a.y*J.tileSize,h=Math.max(0,Math.min(J.tileSize,b-e)),i=Math.max(0,Math.min(J.tileSize,d-g)),j=1*J.tileSize;return new n.Vector2(h/j,i/j)}function k(a){return 1/(1<<a)}function m(a,b){var c=a.level-b.level,d=1<<c,e=1/d,f=e,g=h(b);e/=g.x,f/=g.y;var i=b.x*d,j=b.y*d,k=a.x-i,m=a.y-j,n=h(a);k*=e,m*=f,m=1-m-f*n.y;var o=new l.UVTransform;return o.offsetX=k,o.offsetY=m,o.scaleX=e*n.x,o.scaleY=f*n.y,o}function s(a){return k(a.level)*a.x}function t(a){return k(a.level)*((1<<a.level)-1-a.y)}function u(a){return O[(0,i.tile2Index)(a)]}function v(a){var b=u(a);return b instanceof r&&b.state==q}function w(a,b){for(var c=a.getParent();c;){var d=u(c),e=d&&d.state==q;if(e&&b&&d.mesh.material.map.needsUpdate&&c.level>0&&(e=!1),e)break;c=c.getParent()}return c}function x(a,b,c){var d;if(b)V||(V=X.createQuadGeom()),d=V;else{var e=w(a);b=A(e).material;var f=m(a,e);d=X.acquireQuadGeom(f)}var g=new n.Mesh(d,b);g.tile=a;var i=k(a.level),j=h(a),l=(1-j.y)*i,o=s(a),p=t(a);return g.position.set(o,p+l,0),g.scale.set(i*j.x,i*j.y,1),g}function y(a){var b=J.levelOffset?J.levelOffset:0;return J.urlPattern.replace("{x}",a.x).replace("{y}",a.y).replace("{z}",a.level+b)}function z(b){var c=(0,i.tile2Index)(b),d=O[c];if(!d||d.state==o){d||(d=new r(P),O[c]=d),d.state=p;var e=y(b),f=function(c){if(Y&&c){0==J.maxLevel&&(-1==J.texWidth&&(J.texWidth=c.image.width),-1==J.texHeight&&(J.texHeight=c.image.height),-1==J.tileSize&&(J.tileSize=Math.max(c.image.width,c.image.height)),K=a.getBBox()),c.minFilter=n.LinearFilter,c.magFilter=n.LinearFilter;var f=new n.MeshBasicMaterial({color:4294967295});f.map=c,f.name=e,f.tile=b,f.disableEnvMap=!0,-1!==e.toLowerCase().indexOf(".png")&&(f.transparent=!0,f.alphaTest=.01),M.addMaterial(f.name,f,!0);var g=x(b,f);d.mesh=g,d.state=q,S--,T=!0;var h=c&&c.image?c.image.src:null;h&&n.Cache&&n.Cache.get(h)&&n.Cache.remove(h),0==b.level&&J.onRootLoaded&&J.onRootLoaded()}};S++,J.textureLoader(e,function(a){f(a)},function(a){console.error(a)})}}function A(a){var b=(0,i.tile2Index)(a),c=O[b];return c&&c.state==q?c.mesh:null}function B(a,b){var c=s(a),d=t(a);b.set(c,d,0)}function C(a,b){var c=k(a.level),d=s(a)+c,e=t(a)+c;b.set(d,e,0)}function D(a,b){this.tile=a,this.prio=b}function E(a,b){return a.prio>b.prio}function F(a){var b=O[(0,i.tile2Index)(a)];b&&b.timeStamp!=P&&(b.timeStamp=P,Q++)}function G(a,b,c){a.sort(function(a,d){var e=$(a,b,c);return $(d,b,c)-e});for(var d=0,e=0;e<a.length;e++){var f=u(a[e]);if(!f||f.state!=p){if(S>=R)break;z(a[e]),d++}}return d}function H(a){if(a&&a.mesh&&a.mesh.material){var b=a.mesh.material;M.removeMaterial(b.name),b.map.dispose(),b.map.needsUpdate=!0;var c={type:"dispose"};b.dispatchEvent(c),b.needsUpdate=!0}}function I(a,b,c){var d=Object.keys(O),e=d.length,f=J.cacheSize-e,g=a-f;if(!(g<=0)){d.sort(function(a,d){var e=O[a].timeStamp,f=O[d].timeStamp;if(e!=f)return e-f;var g=(0,i.index2Tile)(a),h=(0,i.index2Tile)(d);return $(g,b,c)-$(h,b,c)});for(var h=Math.min(g,d.length),j=0;j<h;j++){var k=d[j];if(0!==(0,i.index2Tile)(k).level&&O[k].state==q){if(O[k].timeStamp==P)break;H(O[k]),delete O[k]}}}}var J=a,K=a.getBBox(),L=new n.Scene,M=b,N=!0,O=[],P=0,Q=0,R=5,S=0,T=!1,U=[],V=null,W=!1,X=new l.GeometryManager;this.setAggressivePrefetching=function(a){W=a},this.getScene=function(){return L},this.nextBatch=function(){return N?null:(N=!0,L)},this.getSceneCount=function(){return 1},this.done=function(){return N},this.rayCast=function(a,b){return null},this.getVisibleBounds=function(a,b){a&&a.copy(K),b&&b.copy(K)};var Y=this;z(new i.TileCoords(0,0,0));var Z=function(){var a=new n.Vector3,b=new n.Vector3,c=new n.Box3;return function(d,e){return B(d,a),C(d,b),c.set(a,b),e.intersectsBox(c)>0}}(),$=function(){var a=new n.Vector3,b=new n.Vector3;return function(c,e,f){var g=k(c.level);B(c,a),C(c,b);var h=d(f,a,b),i=Z(c,e),j=i?100:1;return h=Math.max(h,1e-4),j*(g*g)/h}}(),_=function(){var a=new n.Vector3,b=new n.Vector3;return function(c,d,f,g,h){B(c,a),C(c,b);var i=e(d,f,a,b);return(b.x-a.x)/(Math.tan(n.Math.degToRad(g/2))*i)*.5*h}}();this.dispose=function(){var a;for(a in O)H(O[a]);V&&(V.dispose(),V.needsUpdate=!0),X.dispose()},this.dtor=function(){this.dispose(),Y=null,M=null},this.reset=function(a,b){var c,d;for(c=0;c<L.children.length;c++){L.children[c].dispatchEvent({type:"removed"})}if(L.children.length=0,P++,Q=0,X.reset(),!v(new i.TileCoords(0,0,0)))return N=!0,!1;var e=new j.SortedList(E),f=new i.TileCoords(0,0,0),h=$(f,a,b.position);e.add(new D(f,h));for(var k=b.getWorldDirection(),l=0|b.clientHeight*J.pixelRatio,m=[],n=[],o=[];e.size()>0;){if(d=e.get(0).tile,e.removeAt(0),!g(d)){var p=!0;d.level==J.maxLevel&&(p=!1);_(d,b.position,k,b.fov,l)<J.tileSize&&(p=!1);var q=Z(d,a);if(q&&(v(d)||o.push(d),F(d)),!q&&m.length+n.length>J.maxActiveTiles&&(p=!1),p)for(var r=0;r<4;r++){var s=d.getChild(r);h=$(s,a,b.position),e.add(new D(s,h))}else q?m.push(d):n.push(d)}}var t=0;T=!1;var u=!0;for(c=0;c<m.length;++c){d=m[c];var w=A(d);w&&w.material.map.needsUpdate&&!W&&(t<5?t++:(w=x(d,null,!0),T=!0,u=!1)),w||(w=x(d,null),u=!1),L.add(w)}N=!1;var y=G(o,a,b.position);Q+=S;var z=[];for(c=0;c<n.length&&!(Q>=J.maxActiveTiles);c++)if(d=n[c],v(d))for(var B=0;B<=d.level;B++){var C=d.getParentAtLevel(B);if(F(C),Q>J.maxActiveTiles)break}else z.push(d),Q++;if(y+=G(z,a,b.position),W){for(z=[],c=0;c<m.length;++c)if(d=m[c],d.level!=J.maxLevel)for(var r=0;r<4;r++){var s=d.getChild(r);!g(s)&&Z(s,a)&&(v(s)||(z.push(s),Q++))}y+=G(z,a,b.position)}if(I(y,a,b.position),u&&U.length>0){var H=U.splice(0,U.length);setTimeout(function(){for(var a=0;a<H.length;a++)H[a]()},1)}return u},this.callWhenRefined=function(a){U.push(a)},this.update=function(){return T}}Object.defineProperty(b,"__esModule",{value:!0}),b.TexQuadConfig=f,b.ModelIteratorTexQuad=g;var h=c(4),i=c(135),j=c(136),k=c(128),l=c(137),m=c(2),n=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(m),o=0,p=1,q=2,r=function(a,b){this.timeStamp=a,this.mesh=b,this.state=o}},function(a,b){"use strict";function c(a,b,c){this.level=a,this.x=b,this.y=c}function d(a){var b=((1<<2*a.level)-1)/3,c=1<<a.level;return b+a.y*c+a.x}function e(a){for(var b=new c(0,0,0);d(b)<=a;)b.level++;b.level--;var e=a-d(b),f=1<<b.level;return b.y=Math.floor(e/f),b.x=e%f,b}Object.defineProperty(b,"__esModule",{value:!0}),b.TileCoords=c,b.tile2Index=d,b.index2Tile=e,c.prototype={constructor:c,copy:function(){return new c(this.level,this.x,this.y)},isValid:function(){return Number.isInteger(this.level)&&this.level>=0&&Number.isInteger(this.x)&&Number.isInteger(this.y)},getChild:function(a){var b=1&a?1:0,d=2&a?1:0;return new c(this.level+1,2*this.x+b,2*this.y+d)},getParent:function(){return 0==this.level?null:new c(this.level-1,Math.floor(this.x/2),Math.floor(this.y/2))},getParentAtLevel:function(a){if(a<0||a>this.level)return null;var b=this.level-a;return new c(a,Math.floor(this.x>>b),Math.floor(this.y>>b))},toString:function(){return"("+this.level+", "+this.x+", "+this.y+")"},equals:function(a,b,d){return a instanceof c?this.equals(a.level,a.x,a.y):this.level===a&&this.x===b&&this.y===d}}},function(a,b){"use strict";function c(a){function b(a,f,g){if(f||(f=0),g||(g=e.length),f>=g)return g;if(g===f+1){var h=d[e[f]];return c(h,a)?g:f}var i=parseInt(f+(g-f)/2),j=d[e[i-1]];return c(a,j)?b(a,f,i):c(j,a)?b(a,i,g):i-1}var c=a||function(a,b){return a<b},d=[],e=[];this.add=function(a){var c=b(a);if(c==e.length)return d.push(a),void e.push(d.length-1);d.push(a),e.splice(c,0,d.length-1)},this.size=function(){return e.length},this.get=function(a){return d[e[a]]},this.removeAt=function(a){var b=e[a];d[b]=void 0,e.splice(a,1)},this.toString=function(){for(var a="",b=0,c=this.size();b<c;++b)a+=this.get(b),b<c-1&&(a+=", ");return a}}Object.defineProperty(b,"__esModule",{value:!0}),b.SortedList=c},function(a,b,c){"use strict";function d(){this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1}function e(){function a(a,b){var c=b||e,d=[];d.push(new g.Vector2(c.offsetX,c.offsetY)),d.push(new g.Vector2(c.offsetX+c.scaleX,c.offsetY)),d.push(new g.Vector2(c.offsetX+c.scaleX,c.offsetY+c.scaleY)),d.push(new g.Vector2(c.offsetX,c.offsetY+c.scaleY)),a.faceVertexUvs[0].length=0,a.faceVertexUvs[0].push([d[0],d[1],d[2]]),a.faceVertexUvs[0].push([d[0],d[2],d[3]]),a.uvTransform=c,a.uvsNeedUpdate=!0}var b=[],c=0,e=new d;this.acquireQuadGeom=function(d){var e=b[c];return e?a(e,d):(e=this.createQuadGeom(d),b[c]=e),c++,e},this.createQuadGeom=function(b){var c=new g.Geometry;return c.vertices.push(new g.Vector3(0,0,0),new g.Vector3(1,0,0),new g.Vector3(1,1,0),new g.Vector3(0,1,0)),c.faces.push(new g.Face3(0,1,2)),c.faces.push(new g.Face3(0,2,3)),a(c,b),c.computeFaceNormals(),c},this.reset=function(){c=0},this.dispose=function(){for(var a=0;a<b.length;a++){var c=b[a];c&&(c.dispose(),c.needsUpdate=!0)}}}Object.defineProperty(b,"__esModule",{value:!0}),b.UVTransform=d,b.GeometryManager=e;var f=c(2),g=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(f);d.prototype.toVec4=function(){return new g.Vector4(this.offsetX,this.offsetY,this.scaleX,this.scaleY)},d.prototype.copyTo=function(a){a.offsetX=this.offsetX,a.offsetY=this.offsetY,a.scaleX=this.scaleX,a.scaleY=this.scaleY}},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.ResetFlags={RESET_NORMAL:0,RESET_REDRAW:1,RESET_RELOAD:2}},function(a,b,c){"use strict";function d(a){var b=a.width,c=a.height,d=void 0,e=void 0;if(0==(b&b-1)&&0==(c&c-1)){if(b*c<=N)return a;d=b,e=c}else{for(d=1;2*d<b;)d*=2;for(e=1;2*e<c;)e*=2}for(;d*e>N;)d=Math.max(d/2,1),e=Math.max(e/2,1);var f=document.createElement("canvas"),g=f.getContext("2d");return f.width=d,f.height=e,f.wasNPOT=!0,g.drawImage(a,0,0,d,e),f}function e(a){return a.format===F.AlphaFormat||a.format===F.RGBAFormat}function f(a){return a.clampS||a.clampT}function g(a){return a.minFilter!==F.NearestFilter&&a.minFilter!==F.LinearFilter}function h(a){!0===a.image.wasNPOT&&e(a)&&f(a)&&g(a)&&(0,z.isChrome)()&&(0,z.isWindows)()&&(a.minFilter=F.LinearFilter,a.generateMipmaps=!1,a.needsUpdate=!0)}function i(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;e<d;e++)b+=String.fromCharCode(c[e]);return"data:image/jpeg;base64,"+window.btoa(b)}function j(a,b,c,e,f,g,h){var i=!b&&H.endpoint.getUseCredentials()&&H.endpoint.pathRequiresCredentials(a);i?F.ImageUtils.crossOrigin="use-credentials":H.endpoint.getUseCredentials()?F.ImageUtils.crossOrigin="anonymous":F.ImageUtils.crossOrigin="";var j,m=a.indexOf("urn:");i&&-1!==m&&(j=H.endpoint.getDomainParam(),f&&(j=j?j+"&":"",j+="acmsession="+f)),h&&h.queryParams&&(j=j?j+"&":"",j+=h.queryParams);var n=H.endpoint.initLoadContext({queryParams:j});K++,J.go(function(b){var f=function(a){K--,e(a),b()},j=g?f:function(a){K--,a&&a.image&&(a.image=d(a.image)),e(a),b()},m=function(a){K--,D.logger.error("Texture load error",a),e(null),b()};if((0,z.isNodeJS)())return void l(a,n,c,f,h);if(".dds"===a.slice(a.length-4).toLocaleLowerCase())if((0,z.isIOSDevice)()){var o=a.slice(0,a.length-4)+".pvr";(new PVRLoader).load(o+"?"+n.queryParams,f,m)}else(new G.DDSLoader).load(a+"?"+n.queryParams,f,m);else i||h&&(h.rawData||h.extractImage)?k(a,n,c,j,h):F.ImageUtils.loadTexture(a+"?"+n.queryParams,c,j,m)})}function k(a,b,c,d,e){function f(a){e&&e.extractImage&&(a=e.extractImage(a));var b=new Image;j.image=b,h(j),b.onload=function(){j.needsUpdate=!0,d&&d(j)},b.onerror=function(a){D.logger.error(a,(0,A.errorCodeString)(A.ErrorCodes.UNKNOWN_FAILURE)),d&&d(null)},b.src=i(a)}function g(a,b){var c="Error: "+a+" ("+b+")";D.logger.error(c,(0,A.errorCodeString)(A.ErrorCodes.NETWORK_SERVER_ERROR)),d&&d(null)}var j=new F.Texture(void 0,c);return e&&e.rawData?f(e.rawData):y.ViewingService.getItem(b,a,f,g),j}function l(a,b,c,d,e){function f(a){e&&e.extractImage&&(a=e.extractImage(a)),h.image={data:a,width:void 0,height:void 0},h.needsUpdate=!0,d&&d(h)}function g(a,b){var c="Error: "+a+" ("+b+")";D.logger.error(c,(0,A.errorCodeString)(A.ErrorCodes.NETWORK_SERVER_ERROR)),d&&d(null)}var h=new F.DataTexture(void 0,c);return y.ViewingService.getItem(b,a,f,g),h}function m(a,b,c){var d=b.getData(),e=b.isOTG()?function(a){var b=H.endpoint.initLoadContext({});return{path:d.makeSharedResourcePath(b.otg_cdn,"textures",a),isShared:!!b.otg_cdn}}(a):function(a){for(var b=null,c=0;c<d.manifest.assets.length;++c){var e=d.manifest.assets[c];if(e.id.toLowerCase()==a.toLowerCase()){b=(0,y.pathToURL)(d.basePath+e.URI);break}}return b||(b=(0,y.pathToURL)(d.basePath+a)),{path:b,isShared:!1}}(a);return j(e.path,e.isShared,F.UVMapping,c,d.acmSessionId)}function n(a,b,c){if(b.textureMaps&&!b.texturesLoaded){b.texturesLoaded=!0;var d=a.getData(),e=b.textureMaps;for(var f in e){var g=e[f];if(!c.matman().loadTextureFromCache(a,b,g,f)){m(g.uri,a,function(b){return function(e){if(e){var f=d.materials.scene.SceneUnit,g=c.renderer()?c.renderer().getMaxAnisotropy():0;B.MaterialConverter.convertTexture(b,e,f,g)}var h=c.matman();h&&(h.setTextureInCache(a,b,e),d.loadOptions.onTextureReceived&&d.loadOptions.onTextureReceived(h,b,e,!q()),!q()&&c&&d.loadDone&&!d.texLoadDone&&(d.texLoadDone=!0,c.onTextureLoadComplete(a)))}}(g))}}}}function o(a,b){var c=b.matman(),d=c._getModelHash(a),e=0;for(var f in c._materials)if(-1!==f.indexOf(d)){var g=c._materials[f];g.textureMaps&&(e+=Object.keys(g.textureMaps).length)}v(e);for(var f in c._materials)if(-1!==f.indexOf(d)){var g=c._materials[f];n(a,g,b)}var h=a.getData();!q()&&b&&h.loadDone&&!h.texLoadDone&&(h.texLoadDone=!0,b.onTextureLoadComplete(a))}function p(a,b,c){var d,e=function(d){d?(d.mapping=F.CubeReflectionMapping,d.LogLuv=-1!==a.indexOf("logluv"),d.RGBM=-1!==a.indexOf("rgbm"),(0,C.DecodeEnvMap)(d,b,!1,c)):c&&c(d)};return F.ImageUtils.crossOrigin="",Array.isArray(a)?(d=F.ImageUtils.loadTextureCube(a,F.CubeReflectionMapping,e),d.format=F.RGBFormat):"string"==typeof a?-1!==a.toLowerCase().indexOf(".dds")?d=(new G.DDSLoader).load(a,e):(d=F.ImageUtils.loadTexture(a,F.SphericalReflectionMapping,c),d.format=F.RGBFormat):a?c&&c(a):c&&c(null),d}function q(){return K}function r(a){a>0&&(J.max=a)}function s(){return J.max}function t(a){a>0&&(L=a,v(M))}function u(){return L}function v(a){a>=0&&(M=a,N=Math.max(16384,L/(4*M)))}function w(){return M}function x(a){var b=4;switch(a.format){case F.AlphaFormat:b=1;break;case F.RGBFormat:b=3;break;case F.LuminanceFormat:b=1;break;case F.LuminanceAlphaFormat:b=2}switch(a.type){case F.ShortType:case F.UnsignedShortType:case F.HalfFloatType:b*=2;break;case F.IntType:case F.UnsignedIntType:case F.FloatType:b*=4;break;case F.UnsignedShort4444Type:case F.UnsignedShort5551Type:case F.UnsignedShort565Type:b=2}var c=b*a.image.width;return c+=a.unpackAlignment-1,c-=c%a.unpackAlignment,a.image.height*c}Object.defineProperty(b,"__esModule",{value:!0}),b.TextureLoader=void 0;var y=c(12),z=c(4),A=c(13),B=c(109),C=c(95),D=c(8),E=c(2),F=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(E),G=c(140),H=c(9),I=c(141),J=new I;J.max=(0,z.isMobileDevice)()?4:6;var K=0,L=(0,z.isMobileDevice)()?32:1/0;L*=1048576;var M=0,N=1/0;b.TextureLoader={setMaxRequest:r,getMaxRequest:s,setMemoryLimit:t,getMemoryLimit:u,setTextureCount:v,getTextureCount:w,loadTextureWithSecurity:j,loadMaterialTextures:n,loadModelTextures:o,loadCubeMap:p,requestsInProgress:q,calculateTextureSize:x}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.DDSLoader=void 0;var d=c(2),e=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(d),f=b.DDSLoader=function a(){this._parser=a.parse};f.prototype=Object.create(e.CompressedTextureLoader.prototype),f.prototype.constructor=f,f.parse=function(a,b){function c(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}var d={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},f=c("DXT1"),g=c("DXT3"),h=c("DXT5"),i=new Int32Array(a,0,31);if(542327876!==i[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),d;if(4&!i[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),d;var j,k=i[21],l=!1;switch(k){case f:j=8,d.format=e.RGB_S3TC_DXT1_Format;break;case g:j=16,d.format=e.RGBA_S3TC_DXT3_Format;break;case h:j=16,d.format=e.RGBA_S3TC_DXT5_Format;break;default:if(!(32==i[22]&&16711680&i[23]&&65280&i[24]&&255&i[25]&&4278190080&i[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",function(a){return String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)}(k)),d;l=!0,j=64,d.format=e.RGBAFormat}d.mipmapCount=1,i[7]>0&&!1!==b&&(d.mipmapCount=Math.max(1,i[7])),d.isCubemap=!!(512&i[28]),d.width=i[4],d.height=i[3];for(var m=i[1]+4,n=d.width,o=d.height,p=d.isCubemap?6:1,q=0;q<p;q++){for(var r=0;r<d.mipmapCount;r++){if(l)var s=function(a,b,c,d){for(var e=c*d*4,f=new Uint8Array(a,b,e),g=new Uint8Array(e),h=0,i=0,j=0;j<d;j++)for(var k=0;k<c;k++){var l=f[i];i++;var m=f[i];i++;var n=f[i];i++;var o=f[i];i++,g[h]=n,h++,g[h]=m,h++,g[h]=l,h++,g[h]=o,h++}return g}(a,m,n,o),t=s.length;else var t=Math.max(4,n)/4*Math.max(4,o)/4*j,s=new Uint8Array(a,m,t);var u={data:s,width:n,height:o};d.mipmaps.push(u),m+=t,n=Math.max(.5*n,1),o=Math.max(.5*o,1)}n=d.width,o=d.height}return d}},function(a,b){function c(){this.pending=0,this.max=1/0,this.listeners=[],this.waiting=[],this.error=null}function d(a){function b(b){if(d)throw new Error("callback called twice");if(d=!0,a.error=a.error||b,a.pending-=1,a.waiting.length>0&&a.pending<a.max)e(a,a.waiting.shift());else if(0===a.pending){var f=a.listeners;a.listeners=[],f.forEach(c)}}function c(b){b(a.error)}a.pending+=1;var d=!1;return b}function e(a,b){b(d(a))}a.exports=c,c.prototype.go=function(a){this.pending<this.max?e(this,a):this.waiting.push(a)},c.prototype.wait=function(a){0===this.pending?a(this.error):this.listeners.push(a)},c.prototype.hold=function(){return d(this)}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.LineShader=void 0;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(143),h=d(g),i=c(144),j=d(i),k=c(58);b.LineShader={uniforms:f.UniformsUtils.merge([k.ShaderChunks.CutPlanesUniforms,{pixelsPerUnit:{type:"f",value:1},aaRange:{type:"f",value:.5},tLayerMask:{type:"t",value:null},tLineStyle:{type:"t",value:null},vLineStyleTexSize:{type:"v2",value:new f.Vector2(13,70)},tRaster:{type:"t",value:null},tSelectionTexture:{type:"t",value:null},vSelTexSize:{type:"v2",value:new f.Vector2(4096,1)},displayPixelRatio:{type:"f",value:1},opacity:{type:"f",value:1},selectionColor:{type:"v4",value:new f.Vector4(0,0,1,1)},modelId:{type:"v3",value:new f.Vector3(0,0,0)},viewportId:{type:"f",value:0},swap:{type:"f",value:0},grayscale:{type:"f",value:0}}]),attributes:{fields1:0,fields2:0,color4b:0,dbId4b:0,flags4b:0,layerVp4b:0,extraParams:0,instFlags4b:0},defines:{},vertexShader:h.default,fragmentShader:j.default}},function(a,b){
a.exports="\r\n\r\n#include<line_decl_common>\r\n\r\nattribute vec3 fields1;\r\nattribute vec3 fields2;\r\nattribute vec4 color4b;\r\nattribute vec4 dbId4b;\r\nattribute vec4 flags4b;\r\nattribute vec4 layerVp4b;\r\n\r\n#ifdef HAS_ELLIPTICALS\r\nattribute vec3 extraParams;\r\n#endif\r\n\r\n#ifdef USE_INSTANCING\r\nattribute vec4 instFlags4b;\r\n#endif\r\n\r\nuniform mat4 mvpMatrix;\r\n\r\nuniform float pixelsPerUnit;\r\nuniform float aaRange;\r\nuniform float viewportId;\r\nuniform float swap;\r\n\r\n\r\n\r\n\r\n\r\n#ifdef HAS_LAYERS\r\nuniform sampler2D tLayerMask;\r\n#endif\r\n\r\n#ifdef SELECTION_RENDERER\r\nuniform sampler2D tSelectionTexture;\r\nuniform vec2 vSelTexSize;\r\n#endif\r\n\r\n#ifdef SELECTION_RENDERER\r\nuniform vec4 selectionColor;\r\n#endif\r\n\r\n#if NUM_CUTPLANES > 0\r\nvarying vec3 vWorldPosition;\r\n#endif\r\n\r\n\r\nvec2 centralVertex;\r\nvec2 offsetPosition;\r\n\r\nvec2 cos_sin(const float angle) { return vec2(cos(angle), sin(angle)); }\r\n\r\nvoid min_max(inout vec2 minPt, inout vec2 maxPt, const vec2 p) {\r\n    minPt = min(minPt, p);\r\n    maxPt = max(maxPt, p);\r\n}\r\n\r\n#if defined(USE_INSTANCING)\r\nfloat getVertexId() { return instFlags4b.x; }\r\n#else\r\nfloat getVertexId() { return flags4b.x; }\r\n#endif\r\n\r\nbool isStartVertex() { return (getVertexId() < VBB_SEG_END_RIGHT); }\r\nbool isLeftVertex()  { float id = getVertexId(); return ((id == VBB_SEG_END_LEFT || id == VBB_SEG_START_LEFT)); }\r\n\r\nstruct SegmentData { float angle, distAlong, distTotal, lineWidthHalf, lineType; };\r\nvoid decodeSegmentData(out SegmentData seg) {\r\n    seg.angle         = fields1.z;\r\n    seg.distAlong     = fields2.x;\r\n    seg.distTotal     = fields2.z;\r\n    seg.lineWidthHalf = fields2.y;\r\n    seg.lineType      = flags4b.z;\r\n}\r\n\r\nvoid strokeLineSegment() {\r\n    SegmentData seg; decodeSegmentData(seg);\r\n\r\n    float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;\r\n    float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;\r\n\r\n\r\n    float angleTransverse = seg.angle + isLeftSide * HALF_PI;\r\n    float lwAdjustment = fsHalfWidth + aaRange;\r\n    vec2 transverseOffset = cos_sin(angleTransverse) * lwAdjustment;\r\n    offsetPosition.xy += transverseOffset;\r\n\r\n\r\n\r\n\r\n    float distanceFromStart = max(isStartCapVertex, 0.0) * seg.distAlong;\r\n    vec2 along = distanceFromStart * cos_sin(seg.angle);\r\n    offsetPosition.xy += along;\r\n    centralVertex.xy  += along;\r\n\r\n\r\n    vec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseOffset.y, transverseOffset.x);\r\n    offsetPosition.xy -= moveOffset;\r\n    centralVertex.xy  -= moveOffset;\r\n\r\n\r\n\r\n\r\n    fsMultipurpose.x = (isStartCapVertex * lwAdjustment) + distanceFromStart;\r\n    fsMultipurpose.y = seg.distAlong;\r\n    fsMultipurpose.z = seg.distTotal;\r\n    fsMultipurpose.w = seg.lineType;\r\n\r\n    if (seg.lineWidthHalf < 0.0)\r\n        fsHalfWidth = -fsHalfWidth;\r\n}\r\n\r\n\r\n#ifdef HAS_TRIANGLE_GEOMS\r\nstruct TriangleData { vec2 p0, p1, p2; };\r\nvoid decodeTriangleData(out TriangleData tri) {\r\n\r\n    tri.p1 = vec2(fields1.z, fields2.x);\r\n    tri.p2 = fields2.yz;\r\n}\r\n\r\nvoid strokeOneTriangle() {\r\n    TriangleData tri; decodeTriangleData(tri);\r\n\r\n\r\n\r\n\r\n\r\n\r\n    fsHalfWidth = 0.0;\r\n    fsMultipurpose.z = 0.0;\r\n\r\n\r\n\r\n\r\n\r\n    float vertexId = getVertexId();\r\n    if (vertexId == VBB_SEG_END_RIGHT)\r\n        offsetPosition.xy = tri.p1;\r\n    else if (vertexId == VBB_SEG_END_LEFT)\r\n        offsetPosition.xy = tri.p2;\r\n}\r\n#endif\r\n\r\n\r\n\r\n\r\n#ifdef HAS_RASTER_QUADS\r\nstruct TexQuadData { float angle; vec2 size; };\r\nvoid decodeTexQuadData(out TexQuadData quad) {\r\n    quad.angle     = fields1.z;\r\n    quad.size   = fields2.xy;\r\n}\r\n\r\nvoid strokeTexQuad() {\r\n    TexQuadData quad; decodeTexQuadData(quad);\r\n\r\n    vec2 corner = vec2(isLeftVertex() ? -1.0 : 1.0, isStartVertex() ? -1.0 : 1.0);\r\n\r\n    vec2 p      = 0.5 * corner * quad.size;\r\n    vec2 rot    = cos_sin(quad.angle);\r\n    vec2 offset = vec2(p.x * rot.x - p.y * rot.y, p.x * rot.y + p.y * rot.x);\r\n\r\n    offsetPosition.xy += offset;\r\n\r\n    fsMultipurpose.xy = max(vec2(0.0), corner);\r\n\r\n\r\n    fsMultipurpose.z = 1.0;\r\n    fsHalfWidth = 0.0;\r\n}\r\n#endif\r\n\r\n#if defined(HAS_CIRCLES) || defined(HAS_ELLIPTICALS)\r\nstruct ArcData { vec2 c; float start, end, major, minor, tilt; };\r\nvoid decodeArcData(out ArcData arc) {\r\n    arc.c     = fields1.xy;\r\n    arc.start = fields1.z;\r\n    arc.end   = fields2.x;\r\n    arc.major = fields2.z;\r\n#if defined(HAS_ELLIPTICALS)\r\n    arc.minor = extraParams.x;\r\n    arc.tilt  = extraParams.y;\r\n#endif\r\n}\r\n\r\nvoid strokeArc(const ArcData arc) {\r\n\r\n\r\n    float isStart = isStartVertex() ? -1.0 : 1.0;\r\n    float isLeft  = isLeftVertex()  ? -1.0 : 1.0;\r\n\r\n\r\n\r\n\r\n    vec2 minPt;\r\n    vec2 maxPt;\r\n\r\n    vec2 angles = vec2(arc.start, arc.end);\r\n    vec2 endsX = vec2(arc.c.x) + arc.major * cos(angles);\r\n    vec2 endsY = vec2(arc.c.y) + arc.minor * sin(angles);\r\n    minPt = maxPt = vec2(endsX.x, endsY.x);\r\n    min_max(minPt, maxPt, vec2(endsX.y, endsY.y));\r\n\r\n    if (arc.end > arc.start) {\r\n        if (arc.start < PI_0_5 && arc.end > PI_0_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));\r\n        }\r\n        if (arc.start < PI && arc.end > PI) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));\r\n        }\r\n        if (arc.start < PI_1_5 && arc.end > PI_1_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));\r\n        }\r\n    } else {\r\n\r\n        min_max(minPt, maxPt, vec2(arc.c.x + arc.major, arc.c.y));\r\n\r\n\r\n\r\n        if (arc.start < PI_0_5 || arc.end > PI_0_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));\r\n        }\r\n        if (arc.start < PI || arc.end > PI) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));\r\n        }\r\n        if (arc.start < PI_1_5 || arc.end > PI_1_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));\r\n        }\r\n    }\r\n\r\n    minPt -= fsHalfWidth + aaRange;\r\n    maxPt += fsHalfWidth + aaRange;\r\n\r\n    offsetPosition.x = (isStart < 0.0) ? minPt.x : maxPt.x;\r\n    offsetPosition.y = (isLeft < 0.0)  ? minPt.y : maxPt.y;\r\n\r\n\r\n\r\n\r\n\r\n    fsMultipurpose.x = arc.start;\r\n    fsMultipurpose.y = -arc.major;\r\n    fsMultipurpose.z = arc.end;\r\n    fsMultipurpose.w = arc.minor;\r\n}\r\n#endif\r\n\r\n#if defined(HAS_CIRCLES)\r\n\r\nvoid strokeCircularArc() {\r\n    ArcData arc; decodeArcData(arc);\r\n\r\n    float r = arc.major;\r\n    if (r * pixelsPerUnit < 0.125)\r\n        r = 0.25 * aaRange;\r\n    arc.major = arc.minor = r;\r\n\r\n    strokeArc(arc);\r\n}\r\n\r\n#endif\r\n\r\n#if defined(HAS_ELLIPTICALS)\r\nvoid strokeEllipticalArc() {\r\n    ArcData arc; decodeArcData(arc);\r\n    strokeArc(arc);\r\n}\r\n#endif\r\n\r\nstruct CommonAttribs { vec2 pos; vec4 color; vec2 layerTC, vpTC; float lineWidthHalf, geomType, ghosting; };\r\nvoid decodeCommonAttribs(out CommonAttribs attribs) {\r\n    attribs.pos           = fields1.xy;\r\n    attribs.color         = color4b;\r\n    attribs.geomType      = flags4b.y;\r\n    attribs.layerTC       = layerVp4b.xy / 255.0;\r\n    attribs.vpTC          = layerVp4b.zw / 255.0;\r\n    attribs.lineWidthHalf = fields2.y;\r\n    attribs.ghosting      = flags4b.w;\r\n}\r\n\r\nvoid strokeIndexedTriangle() {\r\n\r\n    fsHalfWidth = 0.0;\r\n    fsMultipurpose.z = 0.0;\r\n}\r\n\r\n#ifdef SELECTION_RENDERER\r\nbool isSelected(const CommonAttribs attribs) {\r\n\r\n\r\n    vec3 oid = dbId4b.rgb;\r\n\r\n\r\n    float id01 = oid.r + oid.g * 256.0;\r\n    float t = (id01 + 0.5) * (1.0 / 4096.0);\r\n    float flrt = floor(t);\r\n    float texU = t - flrt;\r\n\r\n\r\n    float id23 = oid.b * (65536.0 / 4096.0) + flrt;\r\n    t = (id23 + 0.5) / vSelTexSize.y;\r\n    float texV = fract(t);\r\n\r\n    vec4 selBit = texture2D(tSelectionTexture, vec2(texU, texV));\r\n    return selBit.r == 1.0;\r\n}\r\n#endif\r\n\r\nbool isLayerOff(const CommonAttribs attribs) {\r\n#ifdef HAS_LAYERS\r\n    vec4 layerBit = texture2D(tLayerMask, attribs.layerTC);\r\n    return (layerBit.r == 0.0);\r\n#else\r\n    return false;\r\n#endif\r\n}\r\n\r\nvec4 getColor(const CommonAttribs attribs) {\r\n\r\n    if (isLayerOff(attribs)) { return vec4(0.0); }\r\n\r\n#ifdef SELECTION_RENDERER\r\n    if (isSelected(attribs)) { return selectionColor; }\r\n    return vec4(0.0);\r\n#else\r\n    return attribs.color;\r\n#endif\r\n}\r\n\r\nvoid main() {\r\n    CommonAttribs attribs; decodeCommonAttribs(attribs);\r\n\r\n    fsColor = getColor(attribs);\r\n\r\n    if (swap != 0.0 ) {\r\n\r\n        if ( fsColor.r == 0.0 && fsColor.g == 0.0 && fsColor.b == 0.0 )\r\n            fsColor.rgb = vec3(1.0,1.0,1.0);\r\n\r\n        else if ( fsColor.r == 1.0 && fsColor.g == 1.0 && fsColor.b == 1.0 )\r\n            fsColor.rgb = vec3(0.0,0.0,0.0);\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    centralVertex = offsetPosition = attribs.pos;\r\n\r\n    float lineWeight = attribs.lineWidthHalf;\r\n    if (lineWeight > 0.0) {\r\n\r\n\r\n        if(lineWeight < 0.5 / pixelsPerUnit) {\r\n            lineWeight = 0.5 / pixelsPerUnit;\r\n        }\r\n    }\r\n    else {\r\n\r\n\r\n        lineWeight = abs(lineWeight) / pixelsPerUnit;\r\n    }\r\n\r\n    fsHalfWidth = lineWeight;\r\n\r\n    dbId = dbId4b / 255.0;\r\n\r\n    fsVpTC     = attribs.vpTC;\r\n    fsGhosting = attribs.ghosting;\r\n\r\n    if      (attribs.geomType == VBB_GT_LINE_SEGMENT)     strokeLineSegment();\r\n#ifdef HAS_CIRCLES\r\n    else if (attribs.geomType == VBB_GT_ARC_CIRCULAR)     strokeCircularArc();\r\n#endif\r\n#ifdef HAS_ELLIPTICALS\r\n    else if (attribs.geomType == VBB_GT_ARC_ELLIPTICAL)   strokeEllipticalArc();\r\n#endif\r\n#ifdef HAS_RASTER_QUADS\r\n    else if (attribs.geomType == VBB_GT_TEX_QUAD)         strokeTexQuad();\r\n#endif\r\n#ifdef HAS_TRIANGLE_GEOMS\r\n    else if (attribs.geomType == VBB_GT_ONE_TRIANGLE)     strokeOneTriangle();\r\n#endif\r\n    else if (attribs.geomType == VBB_GT_TRIANGLE_INDEXED) strokeIndexedTriangle();\r\n\r\n\r\n\r\n    fsOffsetDirection = offsetPosition - centralVertex;\r\n\r\n\r\n    gl_Position = mvpMatrix * modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\r\n\r\n\r\n#if NUM_CUTPLANES > 0\r\n    vec4 worldPosition = modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\r\n    vWorldPosition = worldPosition.xyz;\r\n#endif\r\n}\r\n"},function(a,b){a.exports="\r\n\r\n\r\n#include<line_decl_common>\r\n\r\nuniform highp float pixelsPerUnit;\r\nuniform highp float aaRange;\r\n\r\nuniform float opacity;\r\nuniform highp float viewportId;\r\nuniform highp float swap;\r\nuniform highp float grayscale;\r\n\r\n#ifdef HAS_RASTER_QUADS\r\nuniform sampler2D tRaster;\r\n#endif\r\n\r\n#ifdef HAS_LINESTYLES\r\nuniform sampler2D tLineStyle;\r\nuniform vec2 vLineStyleTexSize;\r\n#endif\r\n\r\n#if defined(MRT_ID_BUFFER) || defined(MODEL_COLOR)\r\nuniform vec3 modelId;\r\n#endif\r\n\r\n\r\nfloat curveGaussian(float r, float invWidth) {\r\n    float amt = clamp(r * invWidth, 0.0, 1.0);\r\n\r\n    float exponent = amt * 2.0;\r\n\r\n    return exp(-exponent*exponent);\r\n\r\n\r\n\r\n}\r\n\r\n#ifdef HAS_LINESTYLES\r\nfloat getLinePatternPixel(int i, int j) {\r\n\r\n    return texture2D(tLineStyle, (vec2(i, j) + 0.5) / vLineStyleTexSize).x * 255.0;\r\n}\r\n\r\nfloat getPatternLength(int whichPattern) {\r\n    float p1 = getLinePatternPixel(0, whichPattern);\r\n    float p2 = getLinePatternPixel(1, whichPattern);\r\n    return (p2 * 256.0 + p1);\r\n}\r\n#endif\r\n\r\n\r\nvoid fillLineSegment() {\r\n\r\n    float radius = abs(fsHalfWidth);\r\n    float parametricDistance = fsMultipurpose.x;\r\n    float segmentLength      = fsMultipurpose.y;\r\n    float totalDistance      = fsMultipurpose.z;\r\n\r\n\r\n#ifdef HAS_LINESTYLES\r\n    int whichPattern         = int(fsMultipurpose.w);\r\n\r\n    if (whichPattern > 0) {\r\n        const float TEX_TO_UNIT = 1.0 / 96.0;\r\n\r\n\r\n\r\n\r\n        float LTSCALE = 1.0;\r\n        float patternScale;\r\n\r\n\r\n\r\n        if (fsHalfWidth < 0.0) {\r\n            patternScale = LTSCALE;\r\n        } else {\r\n            patternScale = LTSCALE * TEX_TO_UNIT * pixelsPerUnit;\r\n        }\r\n\r\n        float patLen = patternScale * getPatternLength(whichPattern);\r\n        float phase = mod((totalDistance + parametricDistance) * pixelsPerUnit, patLen);\r\n\r\n        bool onPixel = true;\r\n        float radiusPixels = radius * pixelsPerUnit;\r\n\r\n        for (int i=2; i<MAX_LINESTYLE_LENGTH; i+=2) {\r\n\r\n            float on = getLinePatternPixel(i, whichPattern);\r\n            if (on == 1.0) on = 0.0;\r\n            on *= patternScale;\r\n\r\n            onPixel = true;\r\n            phase -= on;\r\n            if (phase < 0.0) {\r\n                break;\r\n            }\r\n            else if (phase <= radiusPixels) {\r\n                onPixel = false;\r\n                break;\r\n            }\r\n\r\n            float off = getLinePatternPixel(i+1, whichPattern);\r\n            if (off <= 1.0) off = 0.0;\r\n            off *= patternScale;\r\n\r\n            onPixel = false;\r\n            phase -= off;\r\n            if (phase < -radiusPixels)\r\n                discard;\r\n            if (phase <= 0.0)\r\n                break;\r\n        }\r\n\r\n\r\n\r\n\r\n        if (!onPixel && (abs(phase) <= radiusPixels)) {\r\n            segmentLength = 0.0;\r\n            parametricDistance = phase / pixelsPerUnit;\r\n        }\r\n    }\r\n#endif\r\n\r\n\r\n\r\n\r\n    float dist;\r\n    float offsetLength2 = dot(fsOffsetDirection, fsOffsetDirection);\r\n\r\n\r\n\r\n\r\n    float ltz = max(0.0, sign(-parametricDistance));\r\n    float gtsl = max(0.0, sign(parametricDistance - segmentLength));\r\n    float d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\r\n    dist = sqrt(max(0.0, offsetLength2 + d*d));\r\n\r\n\r\n\r\n\r\n    float range =  dist - radius;\r\n\r\n    if (range > aaRange) {\r\n        discard;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n    gl_FragColor = fsColor;\r\n    gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\r\n}\r\n\r\n#ifdef HAS_CIRCLES\r\nvoid fillCircularArc() {\r\n\r\n    float dist   = length(fsOffsetDirection);\r\n    vec2 angles  = fsMultipurpose.xz;\r\n    float radius = abs(fsMultipurpose.y);\r\n    float range  =  abs(dist - radius);\r\n    range -= fsHalfWidth;\r\n\r\n\r\n\r\n    if (range > aaRange) {\r\n        discard;\r\n    }\r\n\r\n    vec2 direction = fsOffsetDirection;\r\n    float angle = atan(direction.y, direction.x);\r\n\r\n\r\n\r\n\r\n    if (angles.x > angles.y) {\r\n\r\n        if (angle > angles.x && angle < PI) {\r\n            angle -= TAU;\r\n        }\r\n        angles.x -= TAU;\r\n\r\n\r\n\r\n        if (angle < angles.x ) {\r\n            angle += TAU;\r\n        }\r\n    }\r\n    else if (angle < 0.0)\r\n        angle += TAU;\r\n\r\n\r\n    if (angle > angles.x && angle < angles.y) {\r\n        gl_FragColor = fsColor;\r\n        gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\r\n    }\r\n    else {\r\n        discard;\r\n    }\r\n\r\n}\r\n#endif\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n#ifdef HAS_ELLIPTICALS\r\n\r\n\r\n\r\n\r\n\r\n\r\nfloat EllipticalApprox(\r\n        const int iters,\r\n        inout float t0, inout float t1,\r\n        const vec2 y,   out   vec2 x,\r\n        const vec2 e,   const vec2 ey, const vec2 esqr\r\n        ) {\r\n    vec2 r;\r\n    for (int i = 0; i < 10; ++i) {\r\n        if(i >= iters) break;\r\n\r\n        float t = mix(t0, t1, 0.5);\r\n        r = ey / (vec2(t) + esqr);\r\n\r\n        vec2 rsq = r * r;\r\n        float f = rsq.x + rsq.y - 1.0;\r\n\r\n        if(f > 0.0) { t0 = t; } else { t1 = t; }\r\n    }\r\n\r\n    x = e * r;\r\n    return distance(x, y);\r\n}\r\n\r\nfloat DistancePointEllipseSpecial (vec2 e, vec2 y, out vec2 x, float width, float aaRange) {\r\n    float dist;\r\n\r\n\r\n    vec2 esqr = e * e;\r\n    vec2 ey   = e * y;\r\n    float t0 = -esqr[1] + ey[1];\r\n    float t1 = -esqr[1] + length(ey);\r\n\r\n\r\n\r\n    dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);\r\n\r\n\r\n    if (dist > max(2.0 * (width + aaRange), e[0] * 0.05))\r\n        return dist;\r\n\r\n\r\n    dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);\r\n\r\n\r\n\r\n\r\n    float ecc = 1.0 +  0.1 * e[0] / e[1];\r\n\r\n    if (dist > max(ecc * (width + aaRange), e[0] * 0.001))\r\n        return dist;\r\n    if (dist < (width - aaRange) / ecc)\r\n        return dist;\r\n\r\n\r\n\r\n\r\n    dist = EllipticalApprox(10, t0, t1, y, x, e, ey, esqr);\r\n    return dist;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nfloat DistancePointEllipse(vec2 e, vec2 y, out vec2 locX, float width, float aaRange) {\r\n    vec2 locE, locY;\r\n\r\n\r\n\r\n\r\n    float diff = sign(e[0] - e[1]);\r\n    vec2 swizzle = vec2(max(diff, 0.0), -min(diff, 0.0));\r\n    locE.x = dot(e, swizzle.xy);\r\n    locE.y = dot(e, swizzle.yx);\r\n    locY.x = dot(y, swizzle.xy);\r\n    locY.y = dot(y, swizzle.yx);\r\n\r\n\r\n    vec2 refl = sign(locY);\r\n    locY *= refl;\r\n\r\n    vec2 x;\r\n    float distance = DistancePointEllipseSpecial(locE, locY, x, width, aaRange);\r\n\r\n    x *= refl;\r\n\r\n    locX.x = dot(x, swizzle.xy);\r\n    locX.y = dot(x, swizzle.yx);\r\n\r\n    return distance;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nvoid fillEllipticalArc() {\r\n    vec2 angles = fsMultipurpose.xz;\r\n    vec2 radii  = abs(fsMultipurpose.yw);\r\n    vec2 dir    = fsOffsetDirection;\r\n\r\n\r\n\r\n\r\n    vec2 pos;\r\n    float range = DistancePointEllipse(radii, dir, pos, fsHalfWidth, aaRange);\r\n    range -= fsHalfWidth;\r\n\r\n    if (range > aaRange)\r\n        discard;\r\n\r\n    float ar = radii[0] / radii[1];\r\n\r\n\r\n\r\n\r\n    float angle = atan(ar * pos.y, pos.x);\r\n\r\n\r\n\r\n\r\n    if (angles.x > angles.y) {\r\n\r\n        if (angle > angles.x && angle < PI) {\r\n            angle -= TAU;\r\n        }\r\n        angles.x -= TAU;\r\n\r\n\r\n\r\n        if (angle < angles.x ) {\r\n            angle += TAU;\r\n        }\r\n    }\r\n    else if (angle < 0.0)\r\n        angle += TAU;\r\n\r\n\r\n    if (angle > angles.x && angle < angles.y) {\r\n        gl_FragColor = fsColor;\r\n        gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\r\n    }\r\n    else {\r\n        discard;\r\n    }\r\n}\r\n#endif\r\n\r\n#ifdef HAS_RASTER_QUADS\r\nvoid fillTexQuad() { gl_FragColor = texture2D(tRaster, fsMultipurpose.xy); }\r\n#endif\r\n\r\nvoid fillTriangle() { gl_FragColor = fsColor; }\r\n\r\n#if NUM_CUTPLANES > 0\r\nvarying highp vec3 vWorldPosition;\r\n#endif\r\n\r\n#include<cutplanes>\r\n\r\nvoid main() {\r\n\r\n\r\n\r\n\r\n\r\n    if (fsColor == vec4(0.0)) {\r\n        discard;\r\n    }\r\n\r\n\r\n    if (fsHalfWidth == 0.0) {\r\n#ifdef HAS_RASTER_QUADS\r\n        if (fsMultipurpose.z != 0.0)\r\n            fillTexQuad();\r\n        else\r\n#endif\r\n            fillTriangle();\r\n    }\r\n    else if (fsMultipurpose.y < 0.0) {\r\n#ifdef HAS_CIRCLES\r\n#ifdef HAS_ELLIPTICALS\r\n        if (abs(fsMultipurpose.y) == fsMultipurpose.w)\r\n#endif\r\n            fillCircularArc();\r\n#endif\r\n#ifdef HAS_ELLIPTICALS\r\n#ifdef HAS_CIRCLES\r\n        else\r\n#endif\r\n            fillEllipticalArc();\r\n#endif\r\n    }\r\n    else\r\n        fillLineSegment();\r\n\r\n\r\n#ifdef MRT_NORMALS\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    gl_FragData[1] = vec4(0.0);\r\n#endif\r\n\r\n\r\n\r\n\r\n\r\n\r\n    float writeId = 1.0;\r\n\r\n\r\n\r\n\r\n    if (fsGhosting != 0.0 || \r\n            ((viewportId != 0.0) && (abs(fsVpTC.x * 255.0 + fsVpTC.y) >= 0.5 && abs(fsVpTC.x * 255.0 + fsVpTC.y - viewportId) >= 0.5))) {\r\n\r\n        writeId = 0.0;\r\n\r\n\r\n\r\n        gl_FragColor.a *= opacity * ((swap == 1.0) ? 0.21 : 0.1);\r\n    } else {\r\n\r\n        gl_FragColor.a *= opacity;\r\n    }\r\n\r\n#ifndef SELECTION_RENDERER\r\n\r\n    if (grayscale != 0.0) {\r\n        const vec3 rgb2grey = vec3(0.299, 0.587, 0.114);\r\n        float gray = dot(gl_FragColor.rgb, rgb2grey);\r\n        gl_FragColor.rgb = vec3(gray);\r\n    }\r\n#endif\r\n\r\n#if NUM_CUTPLANES > 0\r\n    checkCutPlanes(vWorldPosition);\r\n#endif\r\n\r\n#include<id_frag>\r\n}\r\n"},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.LineShaderSS=void 0;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(146),h=d(g),i=c(147),j=d(i),k=c(58);b.LineShaderSS={uniforms:f.UniformsUtils.merge([k.ShaderChunks.CutPlanesUniforms,{pixelsPerUnit:{type:"f",value:1},aaRange:{type:"f",value:1},tLayerMask:{type:"t",value:null},tLineStyle:{type:"t",value:null},vLineStyleTexSize:{type:"v2",value:new f.Vector2(13,70)},tRaster:{type:"t",value:null},tSelectionTexture:{type:"t",value:null},vSelTexSize:{type:"v2",value:new f.Vector2(4096,1)},displayPixelRatio:{type:"f",value:1},size:{type:"v2",value:new f.Vector2(1024,768)},opacity:{type:"f",value:1},selectionColor:{type:"v4",value:new f.Vector4(0,0,1,1)},modelId:{type:"v3",value:new f.Vector3(0,0,0)},viewportId:{type:"f",value:0},swap:{type:"f",value:0}}]),attributes:{fields1:0,fields2:0,color4b:0,dbId4b:0,flags4b:0,layerVp4b:0,extraParams:0,instFlags4b:0},defines:{},vertexShader:h.default,fragmentShader:j.default}},function(a,b){a.exports="\n#include<line_decl_common>\nattribute vec3 fields1;\nattribute vec3 fields2;\nattribute vec4 color4b;\nattribute vec4 dbId4b;\nattribute vec4 flags4b;\nattribute vec4 layerVp4b;\n#ifdef USE_INSTANCING\nattribute vec4 instFlags4b;\n#endif\nuniform mat4 mvpMatrix;\nuniform float pixelsPerUnit;\nuniform float aaRange;\nuniform vec2 size;\nuniform float viewportId;\nuniform float swap;\n#ifdef HAS_LAYERS\nuniform sampler2D tLayerMask;\n#endif\n#ifdef SELECTION_RENDERER\nuniform sampler2D tSelectionTexture;\nuniform vec2 vSelTexSize;\n#endif\n#ifdef SELECTION_RENDERER\nuniform vec4 selectionColor;\n#endif\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvec2 centralVertex;\nvec2 offsetPosition;\nvec2 offsetPosDepth;\nvec2 cos_sin(const float angle) { return vec2(cos(angle), sin(angle)); }\nvoid min_max(inout vec2 minPt, inout vec2 maxPt, const vec2 p) {\n    minPt = min(minPt, p);\n    maxPt = max(maxPt, p);\n}\n#if defined(USE_INSTANCING)\nfloat getVertexId() { return instFlags4b.x; }\n#else\nfloat getVertexId() { return flags4b.x; }\n#endif\nbool isStartVertex() { return (getVertexId() < VBB_SEG_END_RIGHT); }\nbool isLeftVertex()  { float id = getVertexId(); return ((id == VBB_SEG_END_LEFT || id == VBB_SEG_START_LEFT)); }\nstruct SegmentData { float angle, distAlong, distTotal, lineWidthHalf, lineType; };\nvoid decodeSegmentData(out SegmentData seg) {\n    seg.angle         = fields1.z;\n    seg.distAlong     = fields2.x;\n    seg.distTotal     = fields2.z;\n    seg.lineWidthHalf = fields2.y;\n    seg.lineType      = flags4b.z;\n}\nvoid strokeLineSegment() {\n    SegmentData seg; decodeSegmentData(seg);\n    float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;\n    float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;\n    vec4 startPosition = (mvpMatrix * modelMatrix * vec4(centralVertex.xy, 0.0, 1.0));\n    float distanceAlong = seg.distAlong;\n    vec2 along = distanceAlong * cos_sin(seg.angle);\n    vec4 endPosition = (mvpMatrix * modelMatrix * vec4(centralVertex.xy + along, 0.0, 1.0));\n    vec2 screenStart = startPosition.xy * 0.5 * size / startPosition.w;\n    vec2 screenEnd = endPosition.xy * 0.5 * size / endPosition.w;\n    if (isStartCapVertex < 0.0) {\n        offsetPosition = centralVertex = screenStart;\n        offsetPosDepth = startPosition.zw;\n    } else {\n        offsetPosition = centralVertex = screenEnd;\n        offsetPosDepth = endPosition.zw;\n    }\n    vec2 screenDelta = screenEnd - screenStart;\n    float screenAngle = atan(screenDelta.y, screenDelta.x);\n    float angleTransverse = screenAngle - isLeftSide * HALF_PI;\n    float lwAdjustment = fsHalfWidth + aaRange;\n    vec2 transverseOffset = cos_sin(angleTransverse) * lwAdjustment;\n    offsetPosition += transverseOffset;\n    vec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseOffset.y, transverseOffset.x);\n    offsetPosition += moveOffset;\n    centralVertex += moveOffset;\n    float distanceFromStart = max(0.0, isStartCapVertex) * length(screenDelta);\n    fsMultipurpose.x = (isStartCapVertex * lwAdjustment) + distanceFromStart;\n    fsMultipurpose.y = length(screenDelta);\n    fsMultipurpose.z = seg.distTotal;\n    fsMultipurpose.w = seg.lineType;\n    if (seg.lineWidthHalf < 0.0)\n        fsHalfWidth = -fsHalfWidth;\n    fsOffsetDirection = offsetPosition - centralVertex;\n    gl_Position = vec4(2.0 * offsetPosition / size * offsetPosDepth.y, offsetPosDepth.xy);\n}\nstruct CommonAttribs { vec2 pos; vec4 color; vec2 layerTC, vpTC; float lineWidthHalf, geomType, ghosting; };\nvoid decodeCommonAttribs(out CommonAttribs attribs) {\n    attribs.pos           = fields1.xy;\n    attribs.color         = color4b;\n    attribs.geomType      = flags4b.y;\n    attribs.layerTC       = layerVp4b.xy / 255.0;\n    attribs.vpTC          = layerVp4b.zw / 255.0;\n    attribs.lineWidthHalf = fields2.y;\n    attribs.ghosting      = flags4b.w;\n}\nvoid strokeIndexedTriangle() {\n    fsHalfWidth = 0.0;\n    fsMultipurpose.z = 0.0;\n    gl_Position = (mvpMatrix * modelMatrix * vec4(centralVertex.xy, 0.0, 1.0));\n}\n#ifdef SELECTION_RENDERER\nbool isSelected(const CommonAttribs attribs) {\n    vec3 oid = dbId4b.rgb;\n    float id01 = oid.r + oid.g * 256.0;\n    float t = (id01 + 0.5) * (1.0 / 4096.0);\n    float flrt = floor(t);\n    float texU = t - flrt;\n    float id23 = oid.b * (65536.0 / 4096.0) + flrt;\n    t = (id23 + 0.5) / vSelTexSize.y;\n    float texV = fract(t);\n    vec4 selBit = texture2D(tSelectionTexture, vec2(texU, texV));\n    return selBit.r == 1.0;\n}\n#endif\nbool isLayerOff(const CommonAttribs attribs) {\n#ifdef HAS_LAYERS\n    vec4 layerBit = texture2D(tLayerMask, attribs.layerTC);\n    return (layerBit.r == 0.0);\n#else\n    return false;\n#endif\n}\nvec4 getColor(const CommonAttribs attribs) {\n    if (isLayerOff(attribs)) { return vec4(0.0); }\n#ifdef SELECTION_RENDERER\n    if (isSelected(attribs)) { return selectionColor; }\n    return vec4(0.0);\n#else\n    return attribs.color;\n#endif\n}\nvoid main() {\n    CommonAttribs attribs; decodeCommonAttribs(attribs);\n    fsColor = getColor(attribs);\n    if (swap != 0.0 ) {\n        if ( fsColor.r == 0.0 && fsColor.g == 0.0 && fsColor.b == 0.0 )\n            fsColor.rgb = vec3(1.0,1.0,1.0);\n        else if ( fsColor.r == 1.0 && fsColor.g == 1.0 && fsColor.b == 1.0 )\n            fsColor.rgb = vec3(0.0,0.0,0.0);\n    }\n    centralVertex = offsetPosition = attribs.pos;\n    float lineWeight = attribs.lineWidthHalf;\n    if (lineWeight > 0.0) {\n        lineWeight = max(0.5, lineWeight * pixelsPerUnit);\n    }\n    else {\n        lineWeight = max(0.5, abs(lineWeight));\n    }\n    fsHalfWidth = lineWeight;\n    dbId = dbId4b / 255.0;\n    fsVpTC     = attribs.vpTC;\n    fsGhosting = attribs.ghosting;\n    if      (attribs.geomType == VBB_GT_LINE_SEGMENT)     strokeLineSegment();\n    else strokeIndexedTriangle();\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n}\n"},function(a,b){a.exports="\n#include<line_decl_common>\nuniform highp float pixelsPerUnit;\nuniform highp float aaRange;\nuniform float opacity;\nuniform highp float viewportId;\nuniform highp float swap;\n#ifdef HAS_LINESTYLES\nuniform sampler2D tLineStyle;\nuniform vec2 vLineStyleTexSize;\n#endif\n#if defined(MRT_ID_BUFFER) || defined(MODEL_COLOR)\nuniform vec3 modelId;\n#endif\nfloat curveGaussian(float r, float width) {\n    float amt = clamp(abs(r / (width * 1.0)), 0.0, 1.0);\n    amt = max(amt - 0.0, 0.0);\n    float exponent = amt * 2.0;\n    return clamp(exp(-exponent*exponent), 0.0, 1.0);\n}\n#ifdef HAS_LINESTYLES\nfloat getLinePatternPixel(int i, int j) {\n    return texture2D(tLineStyle, (vec2(i, j) + 0.5) / vLineStyleTexSize).x * 255.0;\n}\nfloat getPatternLength(int whichPattern) {\n    float p1 = getLinePatternPixel(0, whichPattern);\n    float p2 = getLinePatternPixel(1, whichPattern);\n    return (p2 * 256.0 + p1);\n}\n#endif\nvoid fillLineSegment() {\n    float radius = abs(fsHalfWidth);\n    float parametricDistance = fsMultipurpose.x;\n    float segmentLength      = fsMultipurpose.y;\n    float totalDistance      = fsMultipurpose.z;\n#ifdef HAS_LINESTYLES\n    int whichPattern         = int(fsMultipurpose.w);\n    if (whichPattern > 0) {\n        const float TEX_TO_UNIT = 1.0 / 96.0;\n        float LTSCALE = 1.0;\n        float patternScale;\n        if (fsHalfWidth < 0.0) {\n            patternScale = LTSCALE;\n        } else {\n            patternScale = LTSCALE * TEX_TO_UNIT * pixelsPerUnit;\n        }\n        float patLen = patternScale * getPatternLength(whichPattern);\n        float phase = mod((totalDistance + parametricDistance), patLen);\n        bool onPixel = true;\n        float radiusPixels = radius + aaRange;\n        for (int i=2; i<MAX_LINESTYLE_LENGTH; i+=2) {\n            float on = getLinePatternPixel(i, whichPattern);\n            if (on == 1.0) on = 0.0;\n            on *= patternScale;\n            onPixel = true;\n            phase -= on;\n            if (phase < 0.0) {\n                break;\n            }\n            else if (phase <= radiusPixels) {\n                onPixel = false;\n                break;\n            }\n            float off = getLinePatternPixel(i+1, whichPattern);\n            if (off <= 1.0) off = 0.0;\n            off *= patternScale;\n            onPixel = false;\n            phase -= off;\n            if (phase < -radiusPixels)\n                discard;\n            if (phase <= 0.0)\n                break;\n        }\n        if (!onPixel && (abs(phase) <= radiusPixels)) {\n            segmentLength = 0.0;\n            parametricDistance = phase;\n        }\n    }\n#endif\n    float dist;\n    float offsetLength2 = dot(fsOffsetDirection, fsOffsetDirection);\n    float ltz = max(0.0, sign(-parametricDistance));\n    float gtsl = max(0.0, sign(parametricDistance - segmentLength));\n    float d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\n    dist = sqrt(max(0.0, offsetLength2 + d*d));\n    float range =  dist - radius;\n    if (range > aaRange) {\n        discard;\n    }\n    gl_FragColor = fsColor;\n    if (range > -aaRange)\n        gl_FragColor.a *= curveGaussian(range+aaRange, aaRange * 2.0);\n}\nvoid fillTriangle() { gl_FragColor = fsColor; }\n#if NUM_CUTPLANES > 0\nvarying highp vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nvoid main() {\n    if (fsColor == vec4(0.0)) {\n        discard;\n    }\n    if (fsHalfWidth == 0.0) {\n        fillTriangle();\n    }\n    else\n        fillLineSegment();\n#ifdef MRT_NORMALS\n    gl_FragData[1] = vec4(0.0);\n#endif\n    float writeId = 1.0;\n    if (fsGhosting != 0.0 || \n            ((viewportId != 0.0) && (abs(fsVpTC.x * 255.0 + fsVpTC.y) >= 0.5 && abs(fsVpTC.x * 255.0 + fsVpTC.y - viewportId) >= 0.5))) {\n        writeId = 0.0;\n        gl_FragColor.a *= opacity * ((swap == 1.0) ? 0.21 : 0.1);\n    } else {\n        gl_FragColor.a *= opacity;\n    }\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n#include<id_frag>\n}\n"},function(a,b,c){"use strict";function d(){function a(a,b,c,d,e){var f=new k.WebGLRenderTarget(a,b,{minFilter:k.NearestFilter,magFilter:k.NearestFilter,format:c,type:d,stencilBuffer:ya});return e&&(f.shareDepthFrom=e),f.name="depthTarget",f}function b(b){try{var c=a(2,2,b.format,b.type)
;Y.setRenderTarget(c);var d=Y.context,e=d.checkFramebufferStatus(d.FRAMEBUFFER);return Y.setRenderTarget(null),c.dispose(),e===d.FRAMEBUFFER_COMPLETE}catch(a){return!1}}function c(){var a=ib?[{format:k.RGBFormat,type:k.HalfFloatType},{format:k.RGBAFormat,type:k.HalfFloatType},{format:k.RGBFormat,type:k.FloatType},{format:k.RGBAFormat,type:k.FloatType}]:[{format:k.RGBFormat,type:k.FloatType},{format:k.RGBAFormat,type:k.FloatType},{format:k.RGBFormat,type:k.HalfFloatType},{format:k.RGBAFormat,type:k.HalfFloatType}],c=a.find(b);c?(qb=!0,ob=c.format,pb=c.type):(qb=!1,e.logger.warn("Depth target is unsupported for this device."))}function d(){var a=m.NormalsShader;Z=(0,l.createShaderMaterial)(a),Z.blending=k.NoBlending,Z.packedNormals=!0,Z.depthWrite=!1;var b={NoCutPlanes:1,Instancing:2,Count:4},c=[];c[0]=null;for(var d=1;d<b.Count;d++){var e=Z.clone();d&b.NoCutPlanes&&(e.cutPlanes=null,e.blending=k.NoBlending,e.packedNormals=!0,e.doNotCut=!0),d&b.Instancing&&(e.useInstancing=!0),c[d]=e}Z.variants=c,Z.getCustomOverrideMaterial=function(a){var c=!a||!a.cutplanes||0==a.cutplanes.length,d=a.useInstancing,e=(c?b.NoCutPlanes:0)|(d?b.Instancing:0);return this.variants[e]}}function j(){var a=o.EdgeShader;$=(0,l.createShaderMaterial)(a),$.depthWrite=!0,$.depthTest=!0,$.isEdgeMaterial=!0,$.transparent=!0,$.blending=k.NormalBlending;var b={Instancing:1,DoNotCut:2,Count:4},c=[];c[0]=null;for(var d=1;d<b.Count;d++){var e=$.clone();e.defines=(0,h.ObjectAssign)({},$.defines),e.isEdgeMaterial=!0,d&b.Instancing&&(e.useInstancing=!0),d&b.DoNotCut&&(e.doNotCut=!0,e.cutplanes=[]),c[d]=e}$.variants=c,$.getCustomOverrideMaterial=function(a){var c=a.useInstancing,d=c?b.Instancing:0;a.doNotCut&&(d|=b.DoNotCut);var e=this.variants[d]||$;return e.uniforms.color.value=lb?kb?gb:fb:eb,e.uniforms.color.needsUpdate=!0,e}}function H(a){a(Z);for(var b=1;b<Z.variants.length;b++)a(Z.variants[b])}function I(){function a(a){a.material.blending=k.NoBlending,a.material.depthWrite=!1,a.material.depthTest=!1}d(),j(),ha=new n.ShaderPass(p.SAOShader),a(ha),ga=new n.ShaderPass(q.SAOBlurShader),a(ga),ja=new n.ShaderPass(r.SAOMinifyFirstShader),a(ja),ia=new n.ShaderPass(r.SAOMinifyShader),a(ia),ka=new n.ShaderPass(s.FXAAShader),a(ka),la=new n.ShaderPass(t.CelShader),a(la),ma=new n.ShaderPass(u.BlendShader),a(ma),fa=new n.ShaderPass(v.BackgroundShader),a(fa),na=new n.ShaderPass(w.CopyShader),a(na),oa=new n.ShaderPass(x.ClearShader),a(oa),pa=new n.ShaderPass(y.HighlightShader),pa.material.depthWrite=!1,pa.material.depthTest=!1,pa.material.blending=k.CustomBlending,pa.material.blendDst=k.DstAlphaFactor,pa.material.blendDstAlpha=k.OneFactor,pa.material.blendSrc=k.OneMinusDstAlphaFactor,pa.material.blendSrcAlpha=k.OneMinusDstAlphaFactor,pa.material.blendEquation=k.AddEquation,pa.material.uniforms.edgeColor.value=fb.clone(),pa.material.transparent=!0}function J(a){switch(a){case B.Color:return!0;case B.Depth:return qb&&(xb.sao||xb.postProcShaded);case B.ModelId:return xb.idbuffer||xb.occlusionid;case B.Overlay:return!0;case B.SSAO:return xb.sao;case B.Post1:return xb.antialias||xb.sao||xb.customPresentPass||xb.postProcShaded;case B.Post2:return xb.postProcShaded||xb.customPresentPass;case B.PostDisplay:return xb.antialias&&xb.postProcShaded;case B.Highlight:return!0}}function K(a,b){var c=new k.WebGLRenderTarget(a,b,{minFilter:k.NearestFilter,magFilter:k.NearestFilter,format:k.RGBAFormat,type:k.UnsignedByteType,stencilBuffer:ya});return c.generateMipmaps=!1,c.shareDepthFrom=Ha,c.canReadPixels=!0,c}function L(a,b){var c=3*a[1],d=3*(a[3]-a[1])-c;return(((1-c-d)*b+d)*b+c)*b}function M(){Va=new k.WebGLRenderTarget(xb.deviceWidth,xb.deviceHeight,{minFilter:k.NearestFilter,magFilter:k.NearestFilter,format:k.RGBAFormat,stencilBuffer:ya}),Va.generateMipmaps=!1,Va.shareDepthFrom=Ha}function N(a,b,c,d){return a[b++]=c[d],a[b++]=c[d+1],a[b++]=c[d+2],a[b++]=c[d+3],a[b++]=c[d+1],a[b++]=c[d+2],a[b++]=c[d],a[b++]=c[d+4],a[b++]=c[d+2],a[b++]=c[d+3],a[b++]=c[d+4],a[b++]=c[d+2],a[b++]=c[d],a[b++]=c[d+1],a[b++]=c[d+5],a[b++]=c[d+3],a[b++]=c[d+1],a[b++]=c[d+5],a[b++]=c[d],a[b++]=c[d+4],a[b++]=c[d+5],a[b++]=c[d+3],a[b++]=c[d+4],a[b++]=c[d+5],b}function O(a,b,c){return a[b++]=c,a[b++]=c+1,a[b++]=c+5,a[b++]=c,a[b++]=c+5,a[b++]=c+4,a[b++]=c,a[b++]=c+2,a[b++]=c+3,a[b++]=c,a[b++]=c+3,a[b++]=c+1,a[b++]=c,a[b++]=c+4,a[b++]=c+6,a[b++]=c,a[b++]=c+6,a[b++]=c+2,a[b++]=c+7,a[b++]=c+6,a[b++]=c+4,a[b++]=c+7,a[b++]=c+4,a[b++]=c+5,a[b++]=c+7,a[b++]=c+5,a[b++]=c+1,a[b++]=c+7,a[b++]=c+1,a[b++]=c+3,a[b++]=c+7,a[b++]=c+3,a[b++]=c+2,a[b++]=c+7,a[b++]=c+2,a[b++]=c+6,b}function P(a,b,c,d){var e=new Float32Array(24*d),f=new Uint16Array(36*d),g=0,h=0,i=0;for(d+=c;c<d;++c,i+=8)h=O(f,h,i),g=N(e,g,a,6*b[c]);var j=new k.BufferGeometry;return j.addAttribute("position",new k.BufferAttribute(e,3)),j.addAttribute("index",new k.BufferAttribute(f,1)),j.streamingDraw=!0,j.streamingIndex=!0,j}function Q(a,b,c,d){for(var e=new Float32Array(3*d),f=new Float32Array(3*d),g=0,h=d+c;c<h;++c){var i=6*b[c];f[g]=a[i+3]-a[i],e[g++]=a[i++],f[g]=a[i+3]-a[i],e[g++]=a[i++],f[g]=a[i+3]-a[i],e[g++]=a[i++]}var j=new k.BufferGeometry;j.addAttribute("position",new k.BufferAttribute(Xa,3)),j.addAttribute("index",new k.BufferAttribute(Ya,1));var l=new k.BufferAttribute(e,3);l.divisor=1;var m=new k.BufferAttribute(f,3);return m.divisor=1,j.addAttribute("instOffset",l),j.addAttribute("instScaling",m),j.numInstances=d,j.streamingDraw=!0,j.streamingIndex=!0,j}function R(){Xa=new Float32Array(24),Ya=new Uint16Array(36),O(Ya,0,0),N(Xa,0,[0,0,0,1,1,1],0)}function S(a,b){for(var c=!!b,d=Ua[b].length;d<a;++d){var e=(0,l.createShaderMaterial)(z.OcclusionShader);e.useInstancing=c,e.depthWrite=!1,e.uniforms.color.value.set(Cb[d][0],Cb[d][1],Cb[d][2]),e.uniforms.opacity.value=Db[d],e.defaultAttributeValues.instRotate=[1,0,0,0],e.blending=k.CustomBlending,e.blendDst=k.SrcColorFactor,e.blendSrc=k.ZeroFactor,e.blendEquation=k.AddEquation,e.transparent=!0,Ua[b][d]=e}}function T(){var a=[ma.uniforms.useOverlay.value,ma.uniforms.highlightRange.value,ma.uniforms.objID.value];return ma.uniforms.useOverlay.value=0,ma.uniforms.highlightRange.value=0,ma.uniforms.objID.value=0,a}function U(a){ma.uniforms.useOverlay.value=a[0],ma.uniforms.highlightRange.value=a[1],ma.uniforms.objID.value=a[2]}function V(){var a=ma.uniforms.useAO.value;return ma.uniforms.useAO.value=0,a}function W(a){ma.uniforms.useAO.value=a}function X(){var a=Ja,b=Ha;if(ma.uniforms.useAO.value){var c=T();ma.render(Y,a,b),b=a,a=Ma,U(c)}if(la.render(Y,a,b),b=a,a=a===Ja?Ma:Ja,ma.uniforms.useOverlay.value||ma.uniforms.highlightRange.value||ma.uniforms.objID.value){var c=V();ma.render(Y,a,b),b=a,W(c)}return b}var Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa=[],ya=!1,za=!1,Aa=null,Ba=[],Ca=null,Da=!1,Ea=!1,Fa=!1,Ga=null,Ha=null,Ia=null,Ja=null,Ka=null,La=null,Ma=null,Na=[],Oa=[],Pa=0,Qa=0,Ra=0,Sa=0,Ta=1,Ua=[[],[]],Va=null,Wa=null,Xa=null,Ya=null,Za=null,$a=!1,_a=!1,ab=new Uint8Array(4),bb=[0,0],cb=(new k.Color).setRGB(1,1,1),db=(new k.Color).setRGB(0,0,0),eb=new k.Vector4(0,0,0,.3),fb=new k.Vector4(1,1,1,1),gb=new k.Vector4(1,1,1,.5),hb=null,ib=!1,jb=!0,kb=!1,lb=!1,mb=!1,nb=!1,ob=k.RGBFormat,pb=k.FloatType,qb=!1,rb=null,sb=!1,tb=0,ub=0,vb=0,wb=[.42,0,1,1],xb={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,useSSAA:!1,idbuffer:!0,occlusionid:!0,customPresentPass:!1,postProcShaded:!1,envMapBg:!1,swapBlackAndWhite:!1,numIdTargets:1,renderEdges:!1},yb={},zb=null,Ab=null,Bb=!1;this.settings=xb,this.init=function(a,b,d,f){if(I(),!a)return void((0,h.isNodeJS)()||e.logger.error("You need a gl context to make a renderer. Things will go downhill from here.",(0,g.errorCodeString)(g.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED)));ib=(0,h.isMobileDevice)(),xb.idbuffer=!ib,va=b,wa=d,Y=a,ya=!!Y.context.getContextAttributes().stencil,_a=!!f,c()},this.setDepthMaterialOffset=function(a,b,c){H(function(d){d.polygonOffset=a,d.polygonOffsetFactor=b,d.polygonOffsetUnits=c,d.extraDepthOffset&&(d.polygonOffsetFactor+=d.extraDepthOffset),d.needsUpdate=!0})},this.overlayUpdate=function(){if(0===ub||-1===ub)return!1;var a=ma.uniforms.highlightIntensity.value,b=.004*(performance.now()-tb);b=Math.min(b,1);var c=L(wb,b);return a!=c&&(ma.uniforms.highlightIntensity.value=c,!0)},this.clearHighlight=function(){if(Da=!1,J(B.Highlight)){Y.setClearColor(db,0);for(var a=0;a<Na.length;++a)Y.clearTarget(Na[a],!0,!1,!1)}},this.setHighlightLights=function(a){ca=a},this.beginScene=function(a,b,c,d){if(aa=b,ea=a.fog,ba=c,Ea=!1,Fa=!1,!Ha&&va)this.initPostPipeline(xb.sao,xb.antialias);else if(!Ha&&!va)return void($a||(0,h.isNodeJS)()||(e.logger.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance.",(0,g.errorCodeString)(g.ErrorCodes.VIEWER_INTERNAL_ERROR)),$a=!0));if(d){var f=xb.envMapBg&&!!fa.material.envMap;if(hb&&!f){if(xb.swapBlackAndWhite&&Bb){var i=new k.Color(1,1,1),j=new k.Color(0,0,0);hb.equals(i)?Y.setClearColor(j,1):hb.equals(j)?Y.setClearColor(i,1):Y.setClearColor(hb,1)}else Y.setClearColor(hb,1);Y.clearTarget(Ha,!0,!0,ya)}else fa.uniforms.uCamDir.value=aa.worldUpTransform?aa.getWorldDirection().clone().applyMatrix4(aa.worldUpTransform):aa.getWorldDirection(),fa.uniforms.uCamUp.value=aa.worldUpTransform?aa.up.clone().applyMatrix4(aa.worldUpTransform):aa.up,fa.uniforms.uResolution.value.set(va,wa),fa.uniforms.uHalfFovTan.value=Math.tan(k.Math.degToRad(.5*aa.fov)),Y.clearTarget(Ha,!1,!0,ya),fa.render(Y,Ha,null);zb&&zb.clearTarget(Y);for(var l=0;l<Oa.length;l++)Y.setClearColor(cb,1),Y.clearTarget(Oa[l],!0,!1,!1);this.clearHighlight(),sb=!1}if(J(B.Depth)){d&&(Y.setClearColor(db,0),Y.clearTarget(ua,!0,!1,!1));var m=b.near,n=b.far;ha.uniforms.cameraNear.value=m,ha.uniforms.cameraFar.value=n,la.uniforms.cameraNear.value=m,la.uniforms.cameraFar.value=n,ja.uniforms.cameraNear.value=m,ja.uniforms.cameraInvNearFar.value=1/(m-n);var o=b.projectionMatrix.elements;b.isPerspective?ha.uniforms.projInfo.value.set(-2/(Ha.width*o[0]),-2/(Ha.height*o[5]),(1-o[8])/o[0],(1+o[9])/o[5]):ha.uniforms.projInfo.value.set(-2/(Ha.width*o[0]),-2/(Ha.height*o[5]),(1-o[12])/o[0],(1-o[13])/o[5]),la.uniforms.projInfo.value.copy(ha.uniforms.projInfo.value);var p=b.isPerspective?0:1;ha.uniforms.isOrtho.value=p,la.uniforms.isOrtho.value=p;ha.uniforms.projScale.value=Ha.height*o[5]*.125}xb.sao||(ma.uniforms.useAO.value=0),this.renderScenePart(a,!0,!0,!1,0,!0)},this.copyOcclusionIds=function(){return xb.occlusionid&&Oa[0]&&rb?(sb||Y.readRenderTargetPixels(Oa[0],0,0,Oa[0].width,Oa[0].height,rb),rb):null},this.renderScenePart=function(a,b,c,d,e,g){d&&xb.occlusionid&&Oa[0]&&rb&&a instanceof f.RenderBatch&&(sb=!1);var h=Ha,i=ua;if(zb&&(h=zb.chooseColorTarget(a,h),i=zb.getRenderSao(a)?ua:null),Ea=!1,Fa=!1,a.fog=ea,za){var j=e?1:0;Y.state.buffers.stencil.setFunc(Y.context.ALWAYS,j,1)}var k,l;if(b){if(l=void 0,(g||ba!==da)&&(l=ba,da=l),mb&&nb)J(B.ModelId)&&d&&J(B.Depth)?Y.render(a,aa,[h,i].concat(Oa),!1,l):J(B.Depth)?Y.render(a,aa,[h,i],!1,l):J(B.ModelId)&&d?Y.render(a,aa,[h].concat(Oa)):Y.render(a,aa,h,!1,l);else if(nb)J(B.ModelId)&&d?Y.render(a,aa,[h].concat(Oa),!1,l):Y.render(a,aa,h,!1,l),J(B.Depth)&&c&&!a.sortObjects&&(k=a.overrideMaterial,a.overrideMaterial=Z,Z.depthWrite!==m&&(Z.depthWrite=m,Z.needsUpdate=!0),Y.render(a,aa,i,!1),a.overrideMaterial=k);else{var m=!1;b?Y.render(a,aa,h,!1,l):m=!0,J(B.ModelId)&&d&&(_?(k=a.overrideMaterial,a.overrideMaterial=_,Y.render(a,aa,Oa[0],!1),a.overrideMaterial=k):(Y.setProgramPrefix(1,"#define ID_COLOR","#define ID_COLOR"),Y.render(a,aa,Oa[0],!1),Y.setProgramPrefix(0,"","")),m=!1),J(B.Depth)&&c&&!a.sortObjects&&(k=a.overrideMaterial,Z.depthWrite!==m&&(Z.depthWrite=m,Z.needsUpdate=!0),a.overrideMaterial=Z,Y.render(a,aa,i,!1),a.overrideMaterial=k)}b&&xb.renderEdges&&(k=a.overrideMaterial,a.overrideMaterial=$,Y.context.depthFunc(Y.context.LESS),Y.render(a,aa,[h],!1),Y.context.depthFunc(Y.context.LEQUAL),a.overrideMaterial=k)}if(e){l=void 0,ca!==da&&(l=ca,da=l),k=a.overrideMaterial,lb=!0,$.depthWrite=!1;for(var n=0;n<xa.length;++n){var o=xa[n];e&1<<n&&(Da=!0,kb=o.renderHidden,$.depthTest=!kb,a.overrideMaterial=o.material,Y.render(a,aa,Na[o.target],!1,l),l=void 0)}lb=!1,kb=!1,$.depthWrite=!0,$.depthTest=!0,a.overrideMaterial=k}};var Cb=[[0,1,1],[1,0,1],[1,1,0],[1,1,1]],Db=[1,1,1,0],Eb={};this.occlusionTest=function(a,b,c,d,e){if(!c||c.length<=0||c.length>4)return Promise.reject({error:"fragIds invalid. Must be a nonempty array of fragment id arrays with length <= 4"});var f=[0,0,0,0],g=0;d=d&&Y.supportsInstancedArrays()?1:0,(!Ua[d]||Ua[d].length<c.length)&&S(c.length,d),d&&!Xa&&R(),Za||(Za=new k.Scene),Za.frustumCulled=!1;var h,i=d?32768:4096;for(h=0;h<c.length;++h){var j=c[h];if(j&&j.length>0){f[h]=b,++g;for(var l,m=Ua[d][h],n=j.length,o=0;o<n;o+=l){l=Math.min(i,n-o);var p=d?Q(a,j,o,l):P(a,j,o,l),q=new k.Mesh(p,m);q.frustumCulled=!1,Za.add(q)}}}switch(Va||M(),Y.setClearColor(cb,1),Y.setRenderTarget(Va),Y.clear(!0,!1,!1),Y.render(Za,aa,Va,!1,null),Y.clearBlend(),Za.children.forEach(function(a){a.geometry.dispose()}),Za.remove.apply(Za,Za.children),(Eb[e[0]]||Eb[e[1]]||Eb[e[2]]||Eb[e[3]])&&this.getRenderTargetPixels("occlusion"),Wa||(Wa=new Uint8Array(4*xb.deviceWidth*xb.deviceHeight)),Y.readRenderTargetPixels(Va,0,0,xb.deviceWidth,xb.deviceHeight,Wa),c.length){case 1:for(h=Wa.length;g>0&&(h-=4)>=0;)Wa[h]||(f[0]-=1,g-=!f[0]);return Promise.resolve([f[0]<=0]);case 2:for(h=Wa.length;g>0&&(h-=4)>=0;)Wa[h]||(f[0]-=1,g-=!f[0]),Wa[h+1]||(f[1]-=1,g-=!f[1]);return Promise.resolve([f[0]<=0,f[1]<=0]);case 3:for(h=Wa.length;g>0&&(h-=4)>=0;)Wa[h]||(f[0]-=1,g-=!f[0]),Wa[h+1]||(f[1]-=1,g-=!f[1]),Wa[h+2]||(f[2]-=1,g-=!f[2]);return Promise.resolve([f[0]<=0,f[1]<=0,f[2]<=0]);case 4:for(h=Wa.length;g>0&&(h-=4)>=0;)Wa[h]||(f[0]-=1,g-=!f[0]),Wa[h+1]||(f[1]-=1,g-=!f[1]),Wa[h+2]||(f[2]-=1,g-=!f[2]),Wa[h+3]||(f[3]-=1,g-=!f[3]);return Promise.resolve([f[0]<=0,f[1]<=0,f[2]<=0,f[3]<=0])}},this.setStencilEnabled=function(a){za=ya&&a,Y.state.buffers.stencil.setTest(a);var b=Y.context;Y.state.buffers.stencil.setOp(b.KEEP,b.KEEP,a?b.REPLACE:b.KEEP)},this.clearAllOverlays=function(){Y.clearTarget(Ia,!0,!1,!1)},this.renderOverlays=function(a,b,c){var d=0;lb=!0;for(var e in a){var f=a[e],g=f.scene,h=f.camera?f.camera:aa;g.children.length&&(d||(d=1,c||(Y.setClearColor(db,0),Y.clearTarget(Ia,!0,!1,!1))),f.materialPre&&(g.overrideMaterial=f.materialPre),Y.render(g,h,Ia,!1,b),f.materialPost&&(kb=!0,Y.context.depthFunc(Y.context.GREATER),xb.renderEdges&&($.depthWrite=!1,$.depthTest=!1,g.overrideMaterial=$,Y.render(g,h,Ia,!1)),g.overrideMaterial=f.materialPost,Y.render(g,h,Ia,!1,b),Y.context.depthFunc(Y.context.LEQUAL),kb=!1),xb.renderEdges&&f.materialPre&&($.depthWrite=!1,$.depthTest=!0,g.overrideMaterial=$,Y.render(g,h,Ia,!1)),g.overrideMaterial=null)}if(lb=!1,$.depthWrite=!0,$.depthTest=!0,Da){d||(d=1,Y.setClearColor(db,0),Y.clearTarget(Ia,!0,!1,!1));var i=Y.state.buffers.stencil;i.setFunc(Y.context.EQUAL,0,1),i.setTest(!0),oa.render(Y,Na[1],null),i.setTest(!1),pa.render(Y,Ia,null)}ma.uniforms.useOverlay.value=d},this.computeSSAO=function(a){if(!a&&xb.sao){if(!Ea){if(Ga&&Ga.length){var b=Ga[0];ja.uniforms.resolution.value.set(1/b.width,1/b.height),ja.render(Y,b,ua);for(var c=1;c<Ga.length;c++){var d=Ga[c];ia.uniforms.resolution.value.set(1/d.width,1/d.height),ia.render(Y,d,b),b=d}}ha.render(Y,La,Ha),ga.uniforms.axis.value.set(1,0),ga.render(Y,Ja,La),ga.uniforms.axis.value.set(0,1),ga.render(Y,La,Ja),Ea=!0}ma.uniforms.useAO.value=1}else ma.uniforms.useAO.value=0},this.presentBuffer=function(a){if(Y){var b=Ab||null;if(!(ma.uniforms.useAO.value||ma.uniforms.useOverlay.value||zb||0!==ub&&-1!==ub||0!==vb&&-1!==vb))xb.antialias?a?(ka.render(Y,Ja,Ha),a.render(Y,b,Ja)):xb.postProcShaded?(la.render(Y,Ja,Ha),na.render(Y,Ka,Ja),ka.render(Y,b,Ka)):ka.render(Y,b,Ha):a?a.render(Y,b,Ha):xb.postProcShaded?(la.render(Y,Ja,Ha),na.render(Y,b,Ja)):na.render(Y,b,Ha);else if(xb.antialias)if(a)ma.render(Y,Ja,Ha),ka.render(Y,Ma,Ja),a.render(Y,b,Ma);else if(xb.postProcShaded){var c=X();na.render(Y,Ka,c),ka.render(Y,b,Ka)}else ma.render(Y,Ja,Ha),ka.render(Y,b,Ja);else if(a)ma.render(Y,Ja,Ha),a.render(Y,b,Ja);else if(xb.postProcShaded){var c=X();na.render(Y,b,c)}else ma.render(Y,b,Ha)}},this.composeFinalFrame=function(a,b){this.computeSSAO(a),b||this.presentBuffer()},this.cleanup=function(){if(Y&&Y.setRenderTarget(null),Ha&&(Ha.dispose(),Ha=null),ua&&(ua.dispose(),ua=null),Ia&&(Ia.dispose(),Ia=null),zb&&zb.disposeTargets(),Ja&&(Ja.dispose(),Ja=null),La&&(La.dispose(),La=null),Ma&&(Ma.dispose(),Ma=null),Ga){for(var a=0;a<Ga.length;a++)Ga[a].dispose();Ga=[]}Va&&(Va.dispose(),Va=null),Wa=null},this.postProcessEdgesOn=function(){return 0!==la.uniforms.idEdges.value||0!==la.uniforms.normalEdges.value||0!==la.uniforms.depthEdges.value};var Fb=function(){var a=0;Ia&&xa.forEach(function(b){a=Math.max(a,1+(0|b.target))});for(var b=Na.length,c=Math.max(a,b),d=0;d<c;++d){var e=d<b?Na[d]:null;d>=b?(e=Ia.clone(),Na[d]=e,e.name="highlight "+d):d>=a?(e.dispose(),e=null):e.shareDepthFrom!==Ia.shareDepthFrom&&(e.dispose(),e=Ia.clone(),Na[d]=e,e.name="highlight "+d);var f=pa.uniforms["tHighlight"+d];f&&f.value!==e&&(f.value=e,ma.material.needsUpdate=!0)}Na.length=a};this.setSize=function(b,c,d,f){if(va=b,wa=c,xb.logicalWidth=b,xb.logicalHeight=c,0===b&&0===c||!Y)return void this.cleanup();var g=0|b*Y.getPixelRatio(),h=0|c*Y.getPixelRatio();xb.deviceWidth=g,xb.deviceHeight=h,f||(_a?Y.setViewport(0,0,b,c):Y.setSize(b,c));var i,j=g,l=h;(xb.useSSAA||xb.postProcShaded&&!ib&&Y.getPixelRatio()<=1&&this.postProcessEdgesOn())&&(g*=2,h*=2);var m=1/g,n=1/h;if(!d&&Ha&&Ha.width==g&&Ha.height==h||(e.logger.log("Reallocating render targets."),this.cleanup(),Ha=new k.WebGLRenderTarget(g,h,{minFilter:k.LinearFilter,magFilter:k.LinearFilter,format:k.RGBFormat,type:xb.useHdrTarget?k.FloatType:k.UnsignedByteType,stencilBuffer:ya}),Ha.generateMipmaps=!1,Ha.name="colorTarget",Ia=new k.WebGLRenderTarget(g,h,{minFilter:k.NearestFilter,magFilter:k.NearestFilter,format:k.RGBAFormat,stencilBuffer:ya}),Ia.generateMipmaps=!1,Ia.name="overlayTarget",Ia.shareDepthFrom=Ha,Fb(),ua=null,Ja=null,Ka=null,La=null,Ma=null,Ga=[]),zb&&zb.updateTargets(g,h,d,xb.useHdrTarget),J(B.Post1)&&(!d&&Ja&&Ja.width==g&&Ja.height==h||(Ja=new k.WebGLRenderTarget(g,h,{minFilter:k.LinearFilter,magFilter:k.LinearFilter,format:k.RGBAFormat,stencilBuffer:!1,depthBuffer:!1}),Ja.generateMipmaps=!1,Ja.name="postTarget1")),!La&&J(B.SSAO)&&(La=Ja.clone(),La.name="SSAO target"),!Ma&&J(B.Post2)&&(Ma=Ja.clone(),Ma.name="post target 2"),!Ka&&J(B.PostDisplay)&&(Ka=new k.WebGLRenderTarget(j,l,{minFilter:k.LinearFilter,magFilter:k.LinearFilter,format:k.RGBAFormat,stencilBuffer:!1,depthBuffer:!1}),Ka.generateMipmaps=!1,Ka.name="postTargetNormal"),J(B.Depth)){if(d||!ua||ua.width!=g||ua.height!=h){ua=a(g,h,ob,pb,Ha),Ga=[];for(var o=0;o<5;o++){var p=new k.WebGLRenderTarget(0|g/(2<<o),0|h/(2<<o),{minFilter:k.NearestFilter,magFilter:k.NearestFilter,format:k.RGBAFormat,depthBuffer:!1,stencilBuffer:!1});p.generateMipmaps=!1,Ga.push(p),ha.uniforms["tDepth_mip"+(o+1)].value=p}mb=Y.verifyMRTWorks([Ha,ua])}ha.uniforms.size.value.set(g,h),ha.uniforms.resolution.value.set(m,n),ha.uniforms.tDepth.value=ua,ga.uniforms.size.value.set(g,h),ga.uniforms.resolution.value.set(m,n),la.uniforms.tDepth.value=ua}if(J(B.ModelId)){if(d||!Oa[0]||Oa[0].width!=g||Oa[0].height!=h){for(i=0;i<Oa.length;i++)Oa[i]&&Oa[i].dispose();for(Oa=[],i=0;i<xb.numIdTargets;i++){var q=K(g,h);q.name="id "+i,Oa.push(q)}nb=Y.verifyMRTWorks([Ha].concat(Oa)),nb||e.logger.warn("ID buffer requested, but MRT is not supported. Some features will not work."),rb=new Uint8Array(4*Oa[0].width*Oa[0].height)}la.uniforms.tID.value=Oa[0],la.uniforms.tID.value=Oa[0]}else if(Oa[0]){for(rb=null,i=0;i<Oa.length;i++)Oa[i].dispose(),Oa[i]=null;Oa.length=0}ka.uniforms.uResolution.value.set(m,n),la.uniforms.resolution.value.set(m,n),ma.uniforms.tOverlay.value=Ia,ma.uniforms.tAO.value=La,ma.uniforms.useAO.value=xb.sao?1:0,ma.uniforms.resolution.value.set(m,n),ma.uniforms.tID.value=Oa[0]||null,ma.uniforms.tID2.value=Oa[1]||null,zb&&zb.updateBlendPass()},this.getMaxAnisotropy=function(){return Y?Y.getMaxAnisotropy():0},this.mrtFlags=function(){return{mrtNormals:mb&&J(B.Depth),mrtIdBuffer:nb&&J(B.ModelId)?xb.numIdTargets:void 0}},this.setIdTargetCount=function(a){if(!(a>2||a<1)&&a!==xb.numIdTargets&&(xb.numIdTargets=a,0!==Oa.length&&2===a&&1===Oa.length)){var b=Oa[0].width,c=Oa[0].height,d=K(b,c);return d.name="id "+Oa.length,Oa.push(d),ma.uniforms.tID2.value=d,ma.material.defines.USE_MODEL_ID="",ma.material.needsUpdate=!0,!0}},this.getAntialiasing=function(){return xb.antialias},this.initPostPipeline=function(a,b){xb.sao=a&&!h.isIE11&&qb,xb.antialias=b&&!h.isIE11,xb.haveTwoSided&&H(function(a){a.side=k.DoubleSide}),H(function(a){a.needsUpdate=!0}),ha.material.needsUpdate=!0,ga.material.needsUpdate=!0,ja.material.needsUpdate=!0,ia.material.needsUpdate=!0,ka.material.needsUpdate=!0,la.material.needsUpdate=!0,ma.material.needsUpdate=!0,fa.material.needsUpdate=!0,na.material.needsUpdate=!0,this.setSize(va,wa)},this.setClearColors=function(a,b){(hb=b?a.equals(b)||ib?new k.Color(.5*(a.x+b.x),.5*(a.y+b.y),.5*(a.z+b.z)):void 0:a.clone())||(fa.uniforms.color1.value.copy(a),fa.uniforms.color2.value.copy(b))},this.setAOEnabled=function(a){xb.sao=a&&qb,yb.sao=xb.sao,this.setSize(va,wa,!1,!0)},this.setAOOptions=function(a,b,c){void 0!==a&&(ha.uniforms.radius.value=a,ha.uniforms.bias.value=(0,h.isMobileDevice)()?.1:.01,ga.uniforms.radius.value=a),void 0!==b&&(ha.uniforms.intensity.value=b),ma.uniforms.aoOpacity.value=void 0!==c?c:1,Ea=!1},this.getAOEnabled=function(){return xb.sao},this.getAORadius=function(){return ha.uniforms.radius.value},this.getAOIntensity=function(){return ha.uniforms.intensity.value},this.setCubeMap=function(a){fa.material.envMap=a,a||this.toggleEnvMapBackground(!1),a&&xb.envMapBg&&(fa.uniforms.envMapBackground.value=!0)},this.getCubeMap=function(){return fa.material.envMap},this.setEnvRotation=function(a){Ra=a,fa.material.envRotationSin=Math.sin(a),fa.material.envRotationCos=Math.cos(a)},this.getEnvRotation=function(){return Ra},this.setEnvExposure=function(a){fa.uniforms.envMapExposure.value=Math.pow(2,a),fa.material.envMapExposure=Math.pow(2,a),fa.material.needsUpdate=!0,Pa=a},this.setTonemapExposureBias=function(a){Qa=a,fa.uniforms.exposureBias.value=Math.pow(2,a)},this.getExposureBias=function(){return Qa},this.setCamera=function(a){aa=a},this.setTonemapMethod=function(a){Sa=a,Y.gammaInput=0!==a,fa.material.tonemapOutput=Sa,fa.material.needsUpdate=!0},this.getToneMapMethod=function(){return Sa},this.toggleTwoSided=function(a){xb.haveTwoSided!=a&&Z&&H(function(b){b.side=a?k.DoubleSide:k.FrontSide,b.needsUpdate=!0}),xb.haveTwoSided=a},this.toggleEdges=function(a){xb.renderEdges=a,yb.renderEdges=a},this.preloadPostProcessStyle=function(a){if(void 0==a)return this.preloadPostProcessStyle("graphite"),void this.preloadPostProcessStyle("pencil");switch(a){case"graphite":if(void 0===Ba[0]){k.ImageUtils.crossOrigin="";for(var b=0;b<8;b++){var c=(0,i.getResourceUrl)("res/postprocess/Graphite"+(b+1)+".png");Ba[b]=k.ImageUtils.loadTexture(c),Ba[b].wrapS=Ba[b].wrapT=k.RepeatWrapping}la.uniforms.tGraphite1.value=Ba[0],la.uniforms.tGraphite2.value=Ba[1],la.uniforms.tGraphite3.value=Ba[2],la.uniforms.tGraphite4.value=Ba[3],la.uniforms.tGraphite5.value=Ba[4],la.uniforms.tGraphite6.value=Ba[5],la.uniforms.tGraphite7.value=Ba[6],la.uniforms.tGraphite8.value=Ba[7]}break;case"pencil":null===Aa&&(k.ImageUtils.crossOrigin="",Aa=k.ImageUtils.loadTexture((0,i.getResourceUrl)("res/postprocess/ColorPencil_02.png")),Aa.wrapS=Aa.wrapT=k.RepeatWrapping,Ca=k.ImageUtils.loadTexture((0,i.getResourceUrl)("res/postprocess/paper2.jpg")),Ca.wrapS=Ca.wrapT=k.RepeatWrapping,la.uniforms.tFill.value=Aa,la.uniforms.tPaper.value=Ca)}},this.setPostProcessParameter=function(a,b){switch(a){case"style":if(xb.postProcShaded=!1,la.uniforms.style.value=C,qb){switch(this.preloadPostProcessStyle(b),b){case"edging":xb.postProcShaded=!0,la.uniforms.style.value=D;break;case"cel":xb.postProcShaded=!0,la.uniforms.style.value=E;break;case"graphite":xb.postProcShaded=!0,la.uniforms.style.value=F;break;case"pencil":xb.postProcShaded=!0,la.uniforms.style.value=G}xb.postProcShaded?xb.idbuffer=!0:xb.idbuffer=jb&&!ib,this.initPostPipeline(xb.sao,xb.antialias)}break;case"edges":la.uniforms.idEdges.value=b?1:0,la.uniforms.normalEdges.value=b?1:0,la.uniforms.depthEdges.value=b?1:0,this.initPostPipeline(xb.sao,xb.antialias);break;case"idEdges":la.uniforms.idEdges.value=b?1:0,this.initPostPipeline(xb.sao,xb.antialias);break;case"normalEdges":la.uniforms.normalEdges.value=b?1:0,this.initPostPipeline(xb.sao,xb.antialias);break;case"depthEdges":la.uniforms.depthEdges.value=b?1:0,this.initPostPipeline(xb.sao,xb.antialias);break;case"brightness":la.uniforms.brightness.value=b;break;case"contrast":la.uniforms.contrast.value=b;break;case"grayscale":la.uniforms.grayscale.value=b?1:0;break;case"preserveColor":la.uniforms.preserveColor.value=b?1:0;break;case"levels":la.uniforms.levels.value=b;break;case"repeats":la.uniforms.repeats.value=b;break;case"rotation":la.uniforms.rotation.value=b;break;default:console.error("setPostProcessParameter: parameter '"+a+"' is not valid.")}return 0},this.queryPostProcessParameter=function(a,b){return"undefined"!==la.uniforms[a]?la.uniforms[a].value:(e.logger.warning("queryPostProcessParameter: parameter '"+a+"' is not valid"),b)},this.getRenderEdges=function(){return xb.renderEdges},this.toggleEnvMapBackground=function(a){xb.envMapBg=a,fa.uniforms.envMapBackground.value=a&&!!fa.material.envMap},this.toggleSwapBlackAndWhite=function(a){xb.swapBlackAndWhite=a},this.enter2DMode=function(a,b){Bb=!0,_=a,yb.sao=xb.sao,yb.postProcShaded=xb.postProcShaded,yb.antialias=xb.antialias,yb.idbuffer=xb.idbuffer,yb.renderEdges=xb.renderEdges,yb.occlusionid=xb.occlusionid,xb.idbuffer=!!b,xb.occlusionid=!1,xb.postProcShaded=!1,xb.renderEdges=!1,ma.material.defines.IS_2D="",this.initPostPipeline(!1,!1)},this.exit2DMode=function(){Bb=!1,_=null,xb.idbuffer=yb.idbuffer&&jb,xb.occlusionid=yb.occlusionid,xb.postProcShaded=yb.postProcShaded,xb.renderEdges=yb.renderEdges,delete ma.material.defines.IS_2D,this.initPostPipeline(yb.sao,yb.antialias)},this.idAtPixel=function(a,b,c){if(!Oa[0])return 0;var d=0|.5*(a+1)*Oa[0].width,e=0|.5*(b+1)*Oa[0].height;if(Fa&&d===qa&&e===ra)return c&&(c[0]=sa,c[1]=ta),sa;Y.readRenderTargetPixels(Oa[0],d,e,1,1,ab);var f=ab[2]<<16|ab[1]<<8|ab[0],g=0;return Oa[1]?(Y.readRenderTargetPixels(Oa[1],d,e,1,1,ab),g=ab[1]<<8|ab[0],g=g<<16>>16,f=f<<8>>8):f=f<<8>>8,qa=d,ra=e,sa=f,ta=g,Fa=!0,c&&(c[0]=f,c[1]=g),f},this.idAtPixels=function(a,b,c,d){if(!Oa[0])return 0;var e=.5*(a+1)*Oa[0].width-.5*(c-1),f=.5*(b+1)*Oa[0].height-.5*(c-1),g=new Uint8Array(4*c*c);Y.readRenderTargetPixels(Oa[0],e,f,c,c,g);var h=void 0;return d&&Oa[1]&&(h=new Uint8Array(4*c*c),Y.readRenderTargetPixels(Oa[1],e,f,c,c,h)),function(){for(var a,b=0,e=0,f=0,i=-1,j=0;j<c*c;j++){var k=b+(c-1)/2,l=e+(c-1)/2;if(k>=0&&k<=c&&l>=0&&l<=c){var m=k+l*c;if(a=g[4*m+2]<<16|g[4*m+1]<<8|g[4*m],(a=a<<8>>8)>=0){if(h){var n=h[4*m+1]<<8|h[4*m];n=n<<16>>16,d[0]=a,d[1]=n}break}}if(b==e||b<0&&b==-e||b>0&&b==1-e){var o=f;f=-i,i=o}b+=f,e+=i}return a}()},this.readbackTargetId=function(){if(!Oa[0])return null;var a=new Uint8Array(4*Oa[0].width*Oa[0].height);return Y.readRenderTargetPixels(Oa[0],0,0,Oa[0].width,Oa[0].height,a),{buffer:a,width:Oa[0].width,height:Oa[0].height}},this.rolloverObjectViewport=function(a,b){if(!jb)return!1;bb[1]=0;var c=this.idAtPixel(a,b,bb);return this.rolloverObjectId(c,null,bb[1])},this.rolloverObjectId=function(a,b,c){return c=c||0,a<=0&&(a=0),!(!jb||a===ub&&c===vb)&&(ma.uniforms.highlightIntensity.value=0,ma.uniforms.objID.value=a,tb=performance.now(),ub=a,vb=c,b?(b.length>1&&b.shift(),ma.uniforms.highlightRange.value=1,ma.uniforms.objIDStart.value=b[0],ma.uniforms.objIDEnd.value=b[b.length-1]):(ma.uniforms.highlightRange.value=0,ma.uniforms.objIDv4.value.set((255&a)/255,(a>>8&255)/255,(a>>16&255)/255,(a>>24&255)/255),ma.uniforms.modelIDv2.value.set((255&c)/255,(c>>8&255)/255)),!0)},this.setSpatialFilterForRollOver=function(a){if(a&&!this.spatialFilterForRollOverSupported())return void e.logger.warn("Spatial filter for mouse-over can only be used with depth target");ma.material.defines.SPATIAL_FILTER!==a&&(a&&""!==a?ma.material.defines.SPATIAL_FILTER=a:delete ma.material.defines.SPATIAL_FILTER,ma.material.needsUpdate=!0,ma.uniforms.highlightIntensity.value=0,tb=performance.now())},this.spatialFilterForRollOverSupported=function(){return J(B.Depth)},this.setEdgeColor=function(a){eb.copy(a)},this.setSelectionColor=function(a){var b=new k.Color(a);b.r=Math.pow(b.r,2),b.g=Math.pow(b.g,2),b.b=Math.pow(b.b,2),ma.uniforms.selectionColor.value.set(b),ma.material.needsUpdate=!0},this.setSelectionMaterials=function(a){xa.length=a.length;for(var b=0;b<a.length;b++)xa[b]=a[b];return Fb(),!0},this.setMemoryLimited=function(a){jb=!a,xb.idbuffer=xb.idbuffer&&jb,xb.occlusionid=a,this.setSize(va,wa)},this.isMemoryLimited=function(){return!jb},this.setUnitScale=function(a){Ta=a},this.getUnitScale=function(){return Ta},this.getBlendPass=function(){return ma},this.getClearPass=function(){return fa},this.getColorTarget=function(){return Ha},this.getIDTargets=function(){return Oa},this.getDepthTarget=function(){return ua},this.getIdTarget=function(){return Oa[0]},this.getDepthMaterial=function(){return Z},this.getPostTarget=function(){return Ja},this.getEdgeMaterial=function(){return $},this.setCrossFadeEnabled=function(a){!!zb!==a&&(a?zb=new A.TargetCrossFade(ma):zb.dtor(),Ha&&this.setSize(va,wa))},this.getCrossFade=function(){return zb||e.logger.error("crossFading must be enabled first"),zb},this.setOffscreenTarget=function(a){Ab=a},this.getNamedTarget=function(a){switch(a){case"color":return Ha;case"overlay":return Ia;case"id":return Oa[0];case"post1":return Ja;case"post2":return Ma;case"postdisplay":return Ka;case"ssao":return La;case"occlusion":return Va;case"depth":return ua;case"highlight0":return Na[0];case"highlight1":return Na[1];case"highlight2":return Na[2];case"highlight3":return Na[3]}return null},this.getCurrentFramebuffer=function(){return Y.getCurrentFramebuffer()},this.getConfig=function(){return{renderEdges:xb.renderEdges,envMapBackground:xb.envMapBg,envMap:fa.material.envMap,envExposure:Pa,toneMapExposureBias:Qa,envRotation:this.getEnvRotation(),tonemapMethod:Sa,clearColor:hb&&hb.clone(),clearColorTop:!hb&&fa.uniforms.color1.value.clone(),colorColorBottom:!hb&&fa.uniforms.color2.value.clone(),aoEnabled:this.getAOEnabled(),aoRadius:this.getAORadius(),aoIntensity:this.getAOIntensity(),twoSided:xb.haveTwoSided,edgeColor:eb.clone(),unitScale:this.getUnitScale(),is2D:!!ma.material.defines.IS_2D,antialias:this.getAntialiasing()}},this.applyConfig=function(a){this.toggleEdges(a.renderEdges),this.toggleEnvMapBackground(a.envMapBackground),this.setCubeMap(a.envMap),this.setEnvExposure(a.envExposure),this.setTonemapExposureBias(a.toneMapExposureBias),this.setEnvRotation(a.envRotation),this.setTonemapMethod(a.tonemapMethod),this.toggleTwoSided(a.twoSided),this.setEdgeColor(a.edgeColor),this.setUnitScale(a.unitScale),a.clearColor?this.setClearColors(a.clearColor):this.setClearColors(a.clearColorTop,a.clearColorBottom);var b=!!ma.material.defines.IS_2D;a.is2D&&!b?this.enter2DMode():!a.is2D&&b&&this.exit2DMode();var c=a.aoEnabled!=this.getAOEnabled(),d=a.antialias!=this.getAntialiasing();(c||d)&&this.initPostPipeline(a.aoEnabled,a.antialias)},this.targetToCanvas=function(a){var b=a.width,c=a.height,d=new Uint8Array(b*c*4);Y.readRenderTargetPixels(a,0,0,b,c,d);var e=document.createElement("canvas");e.width=b,e.height=c;var f,g=e.getContext("2d"),i=new Uint8ClampedArray(d);return h.isIE11?(f=g.createImageData(b,c),f.data.set(i)):f=new ImageData(i,b,c),g.putImageData(f,0,0),g.translate(0,c),g.scale(1,-1),g.drawImage(e,0,0,b,c),{canvas:e,ctx:g}}}Object.defineProperty(b,"__esModule",{value:!0}),b.RenderContext=d
;var e=c(8),f=c(116),g=c(13),h=c(4),i=c(6),j=c(2),k=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(j),l=c(40),m=c(149),n=c(39),o=c(152),p=c(97),q=c(155),r=c(157),s=c(161),t=c(164),u=c(166),v=c(44),w=c(168),x=c(170),y=c(172),z=c(174),A=c(177),B={Color:1,Depth:2,ModelId:3,Overlay:4,Post1:5,Post2:6,SSAO:7,PostDisplay:8,Highlight:9},C=0,D=1,E=2,F=3,G=4},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.NormalsShader=void 0;var e=c(150),f=d(e),g=c(151),h=d(g);b.NormalsShader={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:f.default,fragmentShader:h.default}},function(a,b){a.exports="varying vec3 vNormal;\nvarying float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<pack_normals>\n#include<instancing_decl_vert>\nvoid main() {\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    vNormal = normalize( transformedNormal );\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    depth = mvPosition.z;\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n}\n"},function(a,b){a.exports="varying highp vec3 vNormal;\nvarying highp float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 n = vNormal;\n    n = n * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n    n = normalize( n );\n    gl_FragColor = vec4(n.x, n.y, depth, 1.0);\n}\n"},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.EdgeShader=void 0;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(153),h=d(g),i=c(154),j=d(i);b.EdgeShader={uniforms:{color:{type:"v4",value:new f.Vector4(0,0,0,.3)},cutplanes:{type:"v4v",value:[]}},vertexShader:h.default,fragmentShader:j.default}},function(a,b){a.exports="\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<instancing_decl_vert>\nvoid main() {\n    vec3 instPos = getInstancePos(position);\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n}"},function(a,b){a.exports="\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nuniform vec4 color;\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    gl_FragColor = color;\n}"},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.SAOBlurShader=void 0;var e=c(2),f=c(47),g=d(f),h=c(156),i=d(h);b.SAOBlurShader={uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new e.Vector2(512,512)},resolution:{type:"v2",value:new e.Vector2(1/512,1/512)},axis:{type:"v2",value:new e.Vector2(1,0)},radius:{type:"f",value:50}},vertexShader:g.default,fragmentShader:i.default}},function(a,b){a.exports="\n#define EDGE_SHARPNESS     (3.0)\n#define SCALE               (2)\n#define R                   (4)\n#define VALUE_TYPE        float\n#define VALUE_COMPONENTS   r\n#define VALUE_IS_KEY       0\n#define KEY_COMPONENTS     gb\n#if __VERSION__ >= 330\nconst float gaussian[R + 1] =\nfloat[](0.153170, 0.144893, 0.122649, 0.092902, 0.062970);\n#endif\nuniform sampler2D   tDiffuse;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform vec2       axis;\nuniform float radius;\n#define  result         gl_FragColor.VALUE_COMPONENTS\n#define  keyPassThrough gl_FragColor.KEY_COMPONENTS\nfloat unpackKey(vec2 p) {\n    return p.x + p.y * (1.0 / 255.0);\n}\nvarying vec2 vUv;\nvoid main() {\n#   if __VERSION__ < 330\n    float gaussian[R + 1];\n#       if R == 3\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902;\n#       elif R == 4\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902; gaussian[4] = 0.062970;\n#       elif R == 6\n    gaussian[0] = 0.111220; gaussian[1] = 0.107798; gaussian[2] = 0.098151; gaussian[3] = 0.083953; gaussian[4] = 0.067458; gaussian[5] = 0.050920; gaussian[6] = 0.036108;\n#       endif\n#   endif\n    ivec2 axisi = ivec2(axis);\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 temp = texture2D(tDiffuse, vUv);\n    gl_FragColor.gb = temp.KEY_COMPONENTS;\n    gl_FragColor.a = temp.a;\n    VALUE_TYPE sum = temp.VALUE_COMPONENTS;\n    if (temp.a == 0.0) {\n        result = sum;\n        return;\n    }\n    float key = unpackKey(keyPassThrough);\n    float BASE = gaussian[0];\n    float totalWeight = BASE;\n    sum *= totalWeight;\n    float scale = 1.5 / radius;\n    int r = -4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r=-1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    const float epsilon = 0.0001;\n    result = sum / (totalWeight + epsilon);\n}\n"},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.SAOMinifyShader=b.SAOMinifyFirstShader=void 0;var e=c(2),f=c(158),g=d(f),h=c(159),i=d(h),j=c(160),k=d(j);b.SAOMinifyFirstShader={uniforms:{tDiffuse:{type:"t",value:null},cameraNear:{type:"f",value:1},cameraInvNearFar:{type:"f",value:100},resolution:{type:"v2",value:new e.Vector2(1/512,1/512)}},vertexShader:g.default,fragmentShader:i.default},b.SAOMinifyShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new e.Vector2(1/512,1/512)}},vertexShader:g.default,fragmentShader:k.default}},function(a,b){a.exports="\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},function(a,b){a.exports="uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraInvNearFar;\n#include <pack_depth>\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    float depth = texture2D(tDiffuse, ssP).z;\n    if (depth != 0.0)\n        depth = (depth + cameraNear) * cameraInvNearFar;\n    gl_FragColor = packDepth(depth);\n}\n"},function(a,b){a.exports="uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    gl_FragColor = texture2D(tDiffuse, ssP);\n}\n"},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.FXAAShader=void 0;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(162),h=d(g),i=c(163),j=d(i);b.FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},uResolution:{type:"v2",value:new f.Vector2(1/1024,1/512)}},vertexShader:h.default,fragmentShader:j.default}},function(a,b){a.exports="uniform vec2 uResolution;\nvarying vec2 vPos;\nvarying vec4 vPosPos;\nvoid main() {\n    vPos = uv;\n    vPosPos.xy = uv + vec2(-0.5, -0.5) * uResolution;\n    vPosPos.zw = uv + vec2( 0.5,  0.5) * uResolution;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},function(a,b){a.exports="#define FXAA_EDGE_SHARPNESS (8.0)\n#define FXAA_EDGE_THRESHOLD (0.125)\n#define FXAA_EDGE_THRESHOLD_MIN (0.05)\n#define FXAA_RCP_FRAME_OPT (0.50)\n#define FXAA_RCP_FRAME_OPT2 (2.0)\nuniform sampler2D tDiffuse;\nuniform highp vec2 uResolution;\nvarying vec2 vPos;\nvarying vec4 vPosPos;\nfloat FxaaLuma(vec3 rgb) {\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nvoid main() {\n    float lumaNw = FxaaLuma(texture2D(tDiffuse, vPosPos.xy).rgb);\n    float lumaSw = FxaaLuma(texture2D(tDiffuse, vPosPos.xw).rgb);\n    float lumaNe = FxaaLuma(texture2D(tDiffuse, vPosPos.zy).rgb) + 1.0/384.0;\n    float lumaSe = FxaaLuma(texture2D(tDiffuse, vPosPos.zw).rgb);\n    vec3 rgbM = texture2D(tDiffuse, vPos.xy).rgb;\n    float lumaM = FxaaLuma(rgbM.rgb);\n    float lumaMax = max(max(lumaNe, lumaSe), max(lumaNw, lumaSw));\n    float lumaMin = min(min(lumaNe, lumaSe), min(lumaNw, lumaSw));\n    float lumaMaxSubMinM = max(lumaMax, lumaM) - min(lumaMin, lumaM);\n    float lumaMaxScaledClamped = max(FXAA_EDGE_THRESHOLD_MIN, lumaMax * FXAA_EDGE_THRESHOLD);\n    if (lumaMaxSubMinM < lumaMaxScaledClamped) {\n        gl_FragColor = vec4(rgbM, 1.0);\n        return;\n    }\n    float dirSwMinusNe = lumaSw - lumaNe;\n    float dirSeMinusNw = lumaSe - lumaNw;\n    vec2 dir1 = normalize(vec2(dirSwMinusNe + dirSeMinusNw, dirSwMinusNe - dirSeMinusNw));\n    vec3 rgbN1 = texture2D(tDiffuse, vPos.xy - dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;\n    vec3 rgbP1 = texture2D(tDiffuse, vPos.xy + dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;\n    float dirAbsMinTimesC = min(abs(dir1.x), abs(dir1.y)) * FXAA_EDGE_SHARPNESS;\n    vec2 dir2 = clamp(dir1.xy / dirAbsMinTimesC, -2.0, 2.0);\n    vec3 rgbN2 = texture2D(tDiffuse, vPos.xy - dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;\n    vec3 rgbP2 = texture2D(tDiffuse, vPos.xy + dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;\n    vec3 rgbA = rgbN1 + rgbP1;\n    vec3 rgbB = ((rgbN2 + rgbP2) * 0.25) + (rgbA * 0.25);\n    float lumaB = FxaaLuma(rgbB);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        gl_FragColor = vec4(rgbA * 0.5, 1.0);\n    else\n        gl_FragColor = vec4(rgbB, 1.0);\n}\n"},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.CelShader=void 0;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(58),h=c(47),i=d(h),j=c(165),k=d(j);b.CelShader={uniforms:f.UniformsUtils.merge([g.ShaderChunks.DepthTextureUniforms,{tDiffuse:{type:"t",value:null},tID:{type:"t",value:null},resolution:{type:"v2",value:new f.Vector2(1/1024,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},tFill:{type:"t",value:null},tPaper:{type:"t",value:null},style:{type:"i",value:0},idEdges:{type:"i",value:1},normalEdges:{type:"i",value:1},depthEdges:{type:"i",value:1},brightness:{type:"f",value:0},contrast:{type:"f",value:0},grayscale:{type:"i",value:0},preserveColor:{type:"i",value:0},levels:{type:"f",value:6},repeats:{type:"f",value:3},rotation:{type:"f",value:0},tGraphite1:{type:"t",value:null},tGraphite2:{type:"t",value:null},tGraphite3:{type:"t",value:null},tGraphite4:{type:"t",value:null},tGraphite5:{type:"t",value:null},tGraphite6:{type:"t",value:null},tGraphite7:{type:"t",value:null},tGraphite8:{type:"t",value:null}}]),vertexShader:i.default,fragmentShader:k.default}},function(a,b){a.exports="#extension GL_OES_standard_derivatives : enable\n#include<depth_texture>\nuniform sampler2D tDiffuse;\nuniform sampler2D tID;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform sampler2D tFill;\nuniform sampler2D tPaper;\nuniform int style;\nuniform int idEdges;\nuniform int normalEdges;\nuniform int depthEdges;\nuniform float brightness;\nuniform float contrast;\nuniform int grayscale;\nuniform int preserveColor;\nuniform float levels;\nuniform float repeats;\nuniform float rotation;\nuniform sampler2D tGraphite1;\nuniform sampler2D tGraphite2;\nuniform sampler2D tGraphite3;\nuniform sampler2D tGraphite4;\nuniform sampler2D tGraphite5;\nuniform sampler2D tGraphite6;\nuniform sampler2D tGraphite7;\nuniform sampler2D tGraphite8;\nvarying vec2 vUv;\nvec4 recoverNZ(vec4 nrmz) {\n    float z = sqrt(1.0 - dot(nrmz.xy, nrmz.xy));\n    nrmz.w = -(nrmz.z + cameraNear) / (cameraFar - cameraNear);\n    nrmz.z = z;\n    return nrmz;\n}\n#include<tonemap>\n#include<hsv>\nvec3 quantize(vec3 c) {\n    float L = max(c.r, max(c.g, c.b));\n    c *= floor(L * (levels-1.0) + 0.5) / (L * (levels-1.0));\n    return c;\n}\nvec3 quantizeRGB(vec3 c) {\n    c *= c;\n    c *= floor(c * levels * 0.9999) / (levels-1.0);\n    return sqrt(c);\n}\nvec3 clampHue(vec3 c, float hues, float sats, float vals) {\n    vec3 hsv = rgb2hsv(c);\n    hsv.x = floor(hsv.x * hues + 0.5) / hues;\n    hsv.y = floor(hsv.y * sats + 0.5) / sats;\n    hsv.z = floor(hsv.z * vals + 0.5) / vals;\n    vec3 col = hsv2rgb(hsv);\n    return col;\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\n    return normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\n    vec3 P;\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\n    return P;\n}\nint isObjectEdge() {\n    vec4 MM = texture2D(tID, vUv);\n    vec4 LL = texture2D(tID, vUv + vec2(-1.0, -1.0) * resolution);\n    if (MM != LL) return 1;\n    vec4 LM = texture2D(tID, vUv + vec2( 0.0, -1.0) * resolution);\n    if (MM != LM) return 1;\n    vec4 LR = texture2D(tID, vUv + vec2( 1.0, -1.0) * resolution);\n    if (MM != LR) return 1;\n    vec4 ML = texture2D(tID, vUv + vec2(-1.0,  0.0) * resolution);\n    if (MM != ML) return 1;\n    vec4 MR = texture2D(tID, vUv + vec2( 1.0,  0.0) * resolution);\n    if (MM != MR) return 1;\n    vec4 UL = texture2D(tID, vUv + vec2(-1.0,  1.0) * resolution);\n    if (MM != UL) return 1;\n    vec4 UM = texture2D(tID, vUv + vec2( 0.0,  1.0) * resolution);\n    if (MM != UM) return 1;\n    vec4 UR = texture2D(tID, vUv + vec2( 1.0,  1.0) * resolution);\n    if (MM != UR) return 1;\n    return (MM.x + MM.y + MM.z + MM.w) >= 4.0 ? 0 : -1;\n}\nconst float r = 1.0;\nfloat normalDiff(vec3 n1, vec3 n2) {\n    float d = dot(n1.xyz, n2.xyz);\n    return acos(clamp(d, -1.0, 1.0));\n}\nint isNormalDepthEdge() {\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 MM = texture2D(tDepth, vUv);\n    vec4 LL = texture2D(tDepth, vUv + vec2(-r, -r) * resolution);\n    vec4 LM = texture2D(tDepth, vUv + vec2( 0.0, -r) * resolution);\n    vec4 LR = texture2D(tDepth, vUv + vec2( r, -r) * resolution);\n    vec4 ML = texture2D(tDepth, vUv + vec2(-r,  0.0) * resolution);\n    vec4 MR = texture2D(tDepth, vUv + vec2( r,  0.0) * resolution);\n    vec4 UL = texture2D(tDepth, vUv + vec2(-r, r) * resolution);\n    vec4 UM = texture2D(tDepth, vUv + vec2( 0.0,  r) * resolution);\n    vec4 UR = texture2D(tDepth, vUv + vec2( r,  r) * resolution);\n    LL = recoverNZ(LL);\n    LM = recoverNZ(LM);\n    LR = recoverNZ(LR);\n    ML = recoverNZ(ML);\n    MM = recoverNZ(MM);\n    MR = recoverNZ(MR);\n    UL = recoverNZ(UL);\n    UM = recoverNZ(UM);\n    UR = recoverNZ(UR);\n    float dd = 0.0;\n    if ( depthEdges == 1 ) {\n        float G = (abs(UL.w - MM.w) + 2.0 * abs(UM.w - MM.w) + abs(UR.w - MM.w) + 2.0 * abs(ML.w - MM.w) + 2.0 * abs(MR.w - MM.w) + abs(LL.w - MM.w) + 2.0 * abs(LM.w - MM.w) + abs(LR.w - MM.w));\n        dd = abs(dFdx(G)) + abs(dFdy(G));\n    }\n    float Gn = 0.0;\n    if ( normalEdges == 1 ) {\n        float pLL = normalDiff(LL.xyz, MM.xyz);\n        float pLM = normalDiff(LM.xyz, MM.xyz);\n        float pLR = normalDiff(LR.xyz, MM.xyz);\n        float pML = normalDiff(ML.xyz, MM.xyz);\n        float pMM = normalDiff(MM.xyz, MM.xyz);\n        float pMR = normalDiff(MR.xyz, MM.xyz);\n        float pUL = normalDiff(UL.xyz, MM.xyz);\n        float pUM = normalDiff(UM.xyz, MM.xyz);\n        float pUR = normalDiff(UR.xyz, MM.xyz);\n        Gn = (abs(pUL - pMM) + 2.0 * abs(pUM - pMM) + abs(pUR - pMM) + 2.0 * abs(pML - pMM) + 2.0 * abs(pMR - pMM) + abs(pLL - pMM) + 2.0 * abs(pLM - pMM) + abs(pLR - pMM));\n    }\n    \n    return (dd > 0.004 || Gn > 2.0) ? 1 : 0;\n}\nvec3 computeGraphite( vec3 color, vec2 loc ) {\n    float lum = 0.299 * color.r + 0.587 * color.g + 0.114 * color.b;\n    float offset;\n    vec3 col1, col2;\n    if ( lum > 6.0/7.0 ) {\n        col1 = texture2D(tGraphite1, loc ).xyz;\n        col2 = texture2D(tGraphite2, loc ).xyz;\n        offset = 6.0/7.0;\n    } else if ( lum > 5.0/7.0 ) {\n        col1 = texture2D(tGraphite2, loc ).xyz;\n        col2 = texture2D(tGraphite3, loc ).xyz;\n        offset = 5.0/7.0;\n    } else if ( lum > 4.0/7.0 ) {\n        col1 = texture2D(tGraphite3, loc ).xyz;\n        col2 = texture2D(tGraphite4, loc ).xyz;\n        offset = 4.0/7.0;\n    } else if ( lum > 3.0/7.0 ) {\n        col1 = texture2D(tGraphite4, loc ).xyz;\n        col2 = texture2D(tGraphite5, loc ).xyz;\n        offset = 3.0/7.0;\n    } else if ( lum > 2.0/7.0 ) {\n        col1 = texture2D(tGraphite5, loc ).xyz;\n        col2 = texture2D(tGraphite6, loc ).xyz;\n        offset = 2.0/7.0;\n    } else if ( lum > 1.0/7.0 ) {\n        col1 = texture2D(tGraphite6, loc ).xyz;\n        col2 = texture2D(tGraphite7, loc ).xyz;\n        offset = 1.0/7.0;\n    } else {\n        col1 = texture2D(tGraphite7, loc ).xyz;\n        col2 = texture2D(tGraphite8, loc ).xyz;\n        offset = 0.0;\n    }\n    if ( col1.r == 0.0 && col2.r == 0.0 ) {\n        return vec3(lum,lum,lum);\n    }\n    float t = (lum-offset)*7.0;\n    return (col1 * t + col2 * (1.0 - t));\n}\nvec3 colorWithAdjustments() {\n    vec3 sceneRGB = texture2D(tDiffuse, vUv).xyz;\n    if ( brightness != 0.0 || contrast != 0.0) {\n        if ( brightness < 0.0 )\n        {\n            sceneRGB = sceneRGB * (1.0 + brightness);\n        }\n        else\n        {\n            sceneRGB = sceneRGB + ((1.0 - sceneRGB) * brightness);\n        }\n        float slant = tan(( clamp(contrast,-1.0,1.0) + 1.0) * 3.141592/4.001);\n        sceneRGB = (sceneRGB - 0.5) * slant + 0.5;\n        if ( preserveColor == 1 )\n        {\n            float maxval = max( sceneRGB.r, sceneRGB.g );\n            maxval = max( maxval, sceneRGB.b );\n            if ( maxval > 1.0 )\n            {\n                sceneRGB /= maxval;\n            }\n        }\n        sceneRGB = clamp(sceneRGB,0.0,1.0);\n    }\n    if ( grayscale == 1 ) {\n        sceneRGB.rgb = vec3(luminance_post(sceneRGB.rgb));\n    }\n    return sceneRGB;\n}\nvoid main() {\n    int foundEdge = 0;\n    foundEdge = ( idEdges == 1 && isObjectEdge() == 1 ) ? 1 : 0;\n    if ( foundEdge == 0 && (normalEdges == 1 || depthEdges == 1) ) {\n        foundEdge = isNormalDepthEdge();\n    }\n    vec2 loc = vec2((vUv.x-0.5)*(resolution.y/resolution.x),vUv.y-0.5)*repeats;\n    if ( style > 2 && rotation != 0.0 ) {\n        float rot = 3.14159*rotation;\n        float sinr = sin(rot);\n        float cosr = cos(rot);\n        loc = vec2(loc.x*cosr + -loc.y*sinr, loc.x*sinr + loc.y*cosr);\n    }\n    loc += vec2(0.5,0.5);\n    vec3 color;\n    if ( style == 2 ) {\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            gl_FragColor = vec4(quantize(colorWithAdjustments()),1.0);\n        }\n    } else if ( style == 3 ) {\n        color = colorWithAdjustments();\n        vec3 graphColor = computeGraphite( color, loc );\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.16,0.16,0.16,1.0) + vec4(0.18 * graphColor,0.0);\n        } else {\n            gl_FragColor = vec4(graphColor,1.0);\n        }\n        return;\n    } else if ( style == 4 ) {\n        float fill = texture2D(tFill, loc ).r;\n        float paperStrength = 0.3;\n        vec3 paper = texture2D(tPaper, loc ).rgb;\n        paper = paperStrength * paper + (1.0-paperStrength)*vec3(1.0,1.0,1.0);\n        if ( foundEdge == 1 ) {\n            gl_FragColor = 0.75 * vec4(paper * fill, 1.0);\n        } else {\n            fill = pow(fill,1.6);\n            gl_FragColor = vec4(colorWithAdjustments() * (1.0 - fill) + paper * fill, 1.0);\n        }\n    } else {\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            gl_FragColor = vec4(colorWithAdjustments(),1.0);\n        }\n        return;        \n    }\n}\n"},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.BlendShader=void 0;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(58),h=c(47),i=d(h),j=c(167),k=d(j);b.BlendShader={uniforms:f.UniformsUtils.merge([g.ShaderChunks.DepthTextureUniforms,{tDiffuse:{type:"t",value:null},tAO:{type:"t",value:null},useAO:{type:"i",value:0},aoOpacity:{type:"f",value:1},tOverlay:{type:"t",value:null},useOverlay:{type:"i",value:0},tID:{type:"t",value:null},tID2:{type:"t",value:null},objID:{type:"i",value:0},objIDv4:{type:"v4",value:new f.Vector4(0,0,0,0)},modelIDv2:{type:"v2",value:new f.Vector2(0,0)},highlightIntensity:{type:"f",value:1},resolution:{type:"v2",value:new f.Vector2(1/1024,1/512)},selectionColor:{type:"c",value:new f.Color(0,0,0)},expand2dSelection:{type:"f",value:.5},tCrossFadeTex0:{type:"t",value:null},tCrossFadeTex1:{type:"t",value:null},crossFadeOpacity0:{type:"f",value:0},crossFadeOpacity1:{type:"f",value:0},highlightRange:{type:"i",value:0},objIDStart:{type:"i",value:0},objIDEnd:{type:"i",value:0}}]),vertexShader:i.default,fragmentShader:k.default}},function(a,b){
a.exports="uniform sampler2D tDiffuse;\nuniform sampler2D tAO;\nuniform int useAO;\nuniform float aoOpacity;\nuniform sampler2D tOverlay;\nuniform int useOverlay;\nuniform vec2 resolution;\nuniform int objID;\nuniform vec4 objIDv4;\nuniform sampler2D tID;\n#if defined(USE_MODEL_ID)\nuniform vec2 modelIDv2;\nuniform sampler2D tID2;\n#endif\nuniform float highlightIntensity;\nuniform vec3 selectionColor;\nuniform int highlightRange;\nuniform int objIDStart;\nuniform int objIDEnd;\n#ifdef IS_2D\nuniform float expand2dSelection;\n#endif\nuniform sampler2D tCrossFadeTex0;\nuniform sampler2D tCrossFadeTex1;\nuniform float     crossFadeOpacity0;\nuniform float     crossFadeOpacity1;\nvarying vec2 vUv;\n#ifdef SPATIAL_FILTER\n#include<depth_texture>\n#endif\n#include<tonemap>\nbool isSelected(vec3 C) {\n    float minS = min(selectionColor.r, min(selectionColor.g, selectionColor.b));\n    float maxS = max(selectionColor.r, max(selectionColor.g, selectionColor.b));\n    float satS = maxS - minS;\n    float minC = min(C.r, min(C.g, C.b));\n    float maxC = max(C.r, max(C.g, C.b));\n    float satC = maxC - minC;\n    if (satC < .01 || satS < .01)\n        return false;\n    vec3 S = (selectionColor - minS) / satS;\n    vec3 H = (C - minC) / satC;\n    vec3 D = H - S;\n    float eps = .15;\n    return (abs(D.r) + abs(D.g) + abs(D.b) < eps)\n        || (maxC >= (1.0 - eps) && D.r >= -eps && D.g >= -eps && D.b >= -eps);\n}\nvec4 overlayEdgeDetect(vec2 vUv) {\n#define IS_SELECTION(C) isSelected((C).rgb)\n#ifdef IS_2D\n#define MAX_ALPHA(c)\n#define SUM_ALPHA(c, w) sumAlpha += c.a * w; sumWeight += w;\n#else\n#define MAX_ALPHA(c) maxAlpha = max(maxAlpha, c.a);\n#define SUM_ALPHA(c, w) \n#endif\n#define CHECK_EDGE_ALPHA(I, J, W)     { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); MAX_ALPHA(c) if (c.a > 0.0 && IS_SELECTION(c)) { hasEdge++; SUM_ALPHA(c, W) selectionPixel = c; } }\n#ifndef IS_2D\n#define CHECK_EDGE_SELECTION(I, J) { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); MAX_ALPHA(c) if (c.a <= 0.0) hasEdge++; }\n#endif\n    int hasEdge = 0;\n    vec4 center = texture2D(tOverlay, vUv);\n    vec4 selectionPixel = vec4(0.0);\n#ifdef IS_2D\n    float sumAlpha = 0.0, sumWeight = 0.0;\n#else\n    float maxAlpha = 0.0;\n    bool paintOutline = false;\n#endif\n    if (center.a <= 0.0) {\n        CHECK_EDGE_ALPHA(-1.0,-1.0, 1.0);\n        CHECK_EDGE_ALPHA( 0.0,-1.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0,-1.0, 1.0);\n        CHECK_EDGE_ALPHA(-1.0, 0.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0, 0.0, 2.0);\n        CHECK_EDGE_ALPHA(-1.0, 1.0, 1.0);\n        CHECK_EDGE_ALPHA( 0.0, 1.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0, 1.0, 1.0);\n        if (hasEdge != 0) {\n#ifdef IS_2D\n            center.a = -clamp(expand2dSelection - 1.0 + sumAlpha / sumWeight, 0.0, 1.0);\n            center.rgb = center.a < 0.0 ? selectionPixel.rgb : center.rgb;\n#else\n            center = selectionPixel;\n            paintOutline = true;\n#endif\n        }\n    }\n    else if (center.a > 0.0 && IS_SELECTION(center)) {\n#ifdef IS_2D\n        center.a = -clamp(center.a + expand2dSelection, 0.0, 1.0);\n#else\n        CHECK_EDGE_SELECTION(-1.0,-1.0);\n        CHECK_EDGE_SELECTION( 0.0,-1.0);\n        CHECK_EDGE_SELECTION( 1.0,-1.0);\n        CHECK_EDGE_SELECTION(-1.0, 0.0);\n        CHECK_EDGE_SELECTION( 1.0, 0.0);\n        CHECK_EDGE_SELECTION(-1.0, 1.0);\n        CHECK_EDGE_SELECTION( 0.0, 1.0);\n        CHECK_EDGE_SELECTION( 1.0, 1.0);\n        if (hasEdge != 0)\n            paintOutline = true;\n        else\n            center.a = -center.a;\n#endif\n    }\n#ifndef IS_2D\n    if (paintOutline) {\n        float maxComponent = max(center.r, max(center.g, center.b));\n        center.rgb /= maxComponent;\n        center.rgb = sqrt(center.rgb);\n        center.a = 0.5 + 0.5 * maxAlpha * 0.125 * float(hasEdge);\n    }\n#endif\n    return center;\n}\n#ifdef SPATIAL_FILTER\nSPATIAL_FILTER\n#endif\nvec4 sampleColor() {\n    return texture2D( tDiffuse, vUv );\n}\nfloat sampleAO() {\n    return (useAO != 0) ? sqrt(texture2D(tAO, vUv).r) : 1.0;\n}\nvec3 applyCrossFade(vec3 srcColor, sampler2D fadeTex, float opacity, vec2 vUv) {\n    vec4 blendCol = texture2D(fadeTex, vUv);\n    return mix(srcColor.rgb, blendCol.rgb, blendCol.a * opacity);\n}\nvoid applyHighlighting(inout vec3 rgb, float filterValue) {\n#ifdef IS_2D\n    rgb = mix(rgb, vec3(1.0,1.0,0.0), filterValue * highlightIntensity * 0.25);\n#else\n    rgb += filterValue * highlightIntensity * 0.20;\n#endif\n}\nvoid main() {\n    vec4 texel = sampleColor();\n    float ao = sampleAO();\n    #ifdef NUM_CROSSFADE_TARGETS\n        #if (NUM_CROSSFADE_TARGETS > 1)\n            #if (TARGET_FADE_MODE == 0)\n                texel.rgb = applyCrossFade(texel.rgb, tCrossFadeTex0, crossFadeOpacity0, vUv);\n                texel.rgb = applyCrossFade(texel.rgb, tCrossFadeTex1, crossFadeOpacity1, vUv);\n            #else\n                vec4 t0 = texture2D(tCrossFadeTex0, vUv);\n                vec4 t1 = texture2D(tCrossFadeTex1, vUv);\n                vec4 mixed = mix(t0, t1, crossFadeOpacity1);\n                texel.rgb = mix(texel.rgb, mixed.rgb, mixed.a);\n                float aoGamma = 1.0 + 3.0 * (1.0 - 2.0 * abs(crossFadeOpacity1 - 0.5));\n                if (aoGamma == 0.0)\n                    aoGamma = 1.0;\n                ao = pow(ao, 1.0 / aoGamma);\n            #endif\n        #else\n            vec4 mixed = texture2D(tCrossFadeTex0, vUv);\n            texel.rgb = mix(texel.rgb, mixed.rgb, mixed.a);\n        #endif\n    #else\n    #endif\n    ao = 1.0 - (1.0 - ao) * aoOpacity;\n    texel.rgb *= ao;\n    if (useOverlay != 0) {\n        vec4 overlay = overlayEdgeDetect(vUv);\n        if (overlay.a < 0.0) {\n            overlay.a = -overlay.a;\n#ifdef IS_2D\n            overlay.a *= 0.75;\n#else\n            if (overlay.a >= 0.99) {\n                overlay.a = 0.75;\n                texel.rgb = vec3(luminance_post(texel.rgb));\n            }\n#endif\n        }\n        texel.rgb = mix(texel.rgb, sqrt(overlay.rgb), overlay.a);\n    }\n    if (highlightRange == 0) {\n        if (objID != 0) {\n        vec4 idAtPixel = texture2D(tID, vUv);\n        #ifdef SPATIAL_FILTER\n            vec3 worldPos = reconstructWorldPosition(gl_FragCoord.xy, vUv);\n            float filterValue = (spatialFilter(worldPos) ? 1.0 : 0.0);\n            if (idAtPixel != vec4(1,1,1,1)) {\n                applyHighlighting(texel.rgb, filterValue);\n            }\n        #else\n#if defined(USE_MODEL_ID)\n            vec4 modelAtPixel = texture2D(tID2, vUv);\n            idAtPixel.a = modelAtPixel.b;\n            vec4 idDelta = abs(idAtPixel.rgba - objIDv4.rgba);\n            vec2 modelDelta = abs(modelAtPixel.rg - modelIDv2.rg);\n#else\n            vec4 idDelta = vec4(abs(idAtPixel.rgb - objIDv4.rgb), 0.0);\n            vec2 modelDelta = vec2(0.0, 0.0);\n#endif\n            if (max(max(modelDelta.r, modelDelta.g), max(max(idDelta.r, idDelta.g), max(idDelta.b, idDelta.a))) < 1e-3) {\n                applyHighlighting(texel.rgb, 1.0);\n            }\n        #endif\n        }\n    } else {\n        vec4 idAtPixel = texture2D(tID, vUv);\n        int dbId = int(idAtPixel.r * 255.0 + idAtPixel.g * 255.0 * 256.0 + idAtPixel.b * 255.0 * 256.0 * 256.0);\n        if (dbId >= objIDStart && dbId <= objIDEnd) {\n            applyHighlighting(texel.rgb, 1.0);\n        }\n    }\n    gl_FragColor = texel;\n}\n"},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.CopyShader=void 0;var e=c(47),f=d(e),g=c(169),h=d(g);b.CopyShader={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:f.default,fragmentShader:h.default}},function(a,b){a.exports="uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n    gl_FragColor = texture2D(tDiffuse, vUv);\n}\n"},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.ClearShader=void 0;var e=c(2),f=c(47),g=d(f),h=c(171),i=d(h);b.ClearShader={uniforms:{color:{type:"v4",value:new e.Vector4(0,0,0,0)}},vertexShader:g.default,fragmentShader:i.default}},function(a,b){a.exports="uniform vec4 color;\nvoid main() {\n    gl_FragColor = color;\n}\n"},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.HighlightShader=void 0;var e=c(47),f=d(e),g=c(173),h=d(g),i=c(2);b.HighlightShader={uniforms:{tHighlight0:{type:"t",value:null},tHighlight1:{type:"t",value:null},edgeColor:{type:"v4",value:new i.Vector4(1,1,1,1)}},vertexShader:f.default,fragmentShader:h.default}},function(a,b){a.exports="\nuniform sampler2D tHighlight1;\nuniform sampler2D tHighlight0;\nuniform vec4 edgeColor;\nvarying vec2 vUv;\nvoid main() {\n    vec4 top = texture2D(tHighlight0, vUv);\n    vec4 base = texture2D(tHighlight1, vUv);\n    gl_FragColor = all(lessThan(abs(base - edgeColor), vec4(1.0e-2))) ?  base : (base * (1.0 - top.a) + top);\n}\n"},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.OcclusionShader=void 0;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(175),h=d(g),i=c(176),j=d(i);b.OcclusionShader={uniforms:{color:{type:"v3",value:new f.Vector3(0,0,0)},opacity:{type:"f",value:1}},rawShader:!0,vertexShader:h.default,fragmentShader:j.default}},function(a,b){a.exports="\n#include<instancing_decl_vert>\nvarying vec4 finalColor;\nuniform vec3 color;\nuniform float opacity;\nvoid main() {\n    gl_Position = projectionMatrix * (viewMatrix * vec4(getInstancePos(position), 1.0));\n    finalColor = vec4(color, opacity);\n}\n"},function(a,b){a.exports="precision lowp float;\nvarying vec4 finalColor;\nvoid main() {\n    gl_FragColor = finalColor;\n}\n"},function(a,b,c){"use strict";function d(a){var b=[],c=[!0,!0],d=a,e=new f.Color,h=[],i=g.DECAL,j=!0;this.setModelTargetIndex=function(a,b){h[a]=b},this.setSaoHeuristicEnabled=function(a){j=a},this.getRenderSao=function(a){if(!j)return!0;var b=a.modelId&&h[a.modelId];if(void 0===b)return!0;for(var c=b,d=this.getCrossFadeOpacity(b),e=0;e<2;e++){var f=this.getCrossFadeOpacity(e);f>d&&(c=e,d=f)}return c==b},this.setCrossFadeOpacity=function(a,b){var c="crossFadeOpacity"+a;d.uniforms[c].value=b},this.getCrossFadeOpacity=function(a){var b="crossFadeOpacity"+a;return d.uniforms[b].value},this.updateBlendPass=function(a){void 0===a&&(a=b.length);var c="NUM_CROSSFADE_TARGETS",e=d.material.defines[c],f=a||void 0;e!==f&&(a?d.material.defines[c]=f:delete d.material.defines[c],d.material.needsUpdate=!0);for(var g=0;g<a;g++){var h="tCrossFadeTex"+g;d.uniforms[h].value=b[g]}d.material.defines.TARGET_FADE_MODE!==i&&(d.material.defines.TARGET_FADE_MODE=i,d.material.needsUpdate=!0)},this.setFadeMode=function(a){if(a!==g.DECAL&&a!==g.CROSSFADE)return void console.error("Unexpected fade mode enum");i=a,this.updateBlendPass()},this.clearTarget=function(a){a.setClearColor(e,0);for(var d=0;d<b.length;d++)c[d]&&a.clearTarget(b[d],!0,!0)},this.setClearEnabled=function(a,b){c[a]=b},this.disposeTargets=function(){for(var a=0;a<b.length;a++){var c=b[a];c&&c.dispose(),b[a]=null}},this.dtor=function(){this.disposeTargets(),this.updateBlendPass()},this.chooseColorTarget=function(a,c){var d=a.modelId&&h[a.modelId];return void 0===d?c:b[d]},this.updateTargets=function(a,c,d,e){for(var g=0;g<2;g++){var h=b[g];!d&&h&&h.width===a&&h.height===c||(h&&h.dispose(),h=new f.WebGLRenderTarget(a,c,{minFilter:f.LinearFilter,magFilter:f.LinearFilter,format:f.RGBAFormat,type:e?f.FloatType:f.UnsignedByteType,stencilBuffer:!1}),h.generateMipmaps=!1,b[g]=h)}},this.beginRenderToFadeTarget=function(a,c){this.updateBlendPass(0);var d=b[a];c.setOffscreenTarget(d),this.setClearEnabled(a,!1)},this.endRenderFadeTarget=function(a){a.setOffscreenTarget(null),this.updateBlendPass()}}Object.defineProperty(b,"__esModule",{value:!0}),b.FadeMode=void 0,b.TargetCrossFade=d;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=b.FadeMode={DECAL:0,CROSSFADE:1};d.FadeMode=g},function(a,b){"use strict";function c(){this.entries={},this.add=function(a,b){this.entries[a]={callback:b}},this.remove=function(a){this.entries[a]&&delete this.entries[a]},this.render=function(){for(var a in this.entries)this.entries[a].callback()}}Object.defineProperty(b,"__esModule",{value:!0}),b.RenderCallbacks=c},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}Object.defineProperty(b,"__esModule",{value:!0}),b.WebGLRenderer=b.DEBUG_TEXTURE_LOAD=void 0;var e=c(100),f=c(104),g=d(f),h=c(116),i=c(180),j=c(2),k=d(j),l=c(37),m=b.DEBUG_TEXTURE_LOAD=!1;b.WebGLRenderer=function(a){function b(a){a.__webglVertexBuffer=Ua.createBuffer(),a.__webglColorBuffer=Ua.createBuffer(),a.__webglLineDistanceBuffer=Ua.createBuffer(),Ya.info.memory.geometries++}function c(a){a.__webglVertexBuffer=Ua.createBuffer(),a.__webglColorBuffer=Ua.createBuffer(),Ya.info.memory.geometries++}function d(a){a.__webglVertexBuffer=Ua.createBuffer(),a.__webglNormalBuffer=Ua.createBuffer(),a.__webglTangentBuffer=Ua.createBuffer(),a.__webglColorBuffer=Ua.createBuffer(),a.__webglUVBuffer=Ua.createBuffer(),a.__webglUV2Buffer=Ua.createBuffer(),a.__webglSkinIndicesBuffer=Ua.createBuffer(),a.__webglSkinWeightsBuffer=Ua.createBuffer(),a.__webglFaceBuffer=Ua.createBuffer(),a.__webglLineBuffer=Ua.createBuffer(),Ya.info.memory.geometries++}function f(a,b){var c=a.vertices.length,d=b.material;if(d.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var e in d.attributes){var f=d.attributes[e];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=!0;var g=1;"v2"===f.type?g=2:"v3"===f.type?g=3:"v4"===f.type?g=4:"c"===f.type&&(g=3),f.size=g,f.array=new Float32Array(c*g),f.buffer=Ua.createBuffer(),f.buffer.belongsToAttribute=e,f.needsUpdate=!0}a.__webglCustomAttributesList.push(f)}}}function j(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(3*c),a.__colorArray=new Float32Array(3*c),a.__lineDistanceArray=new Float32Array(1*c),a.__webglLineCount=c,f(a,b)}function n(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(3*c),a.__colorArray=new Float32Array(3*c),a.__webglPointCount=c,f(a,b)}function o(a,b){var c=b.geometry,d=a.faces3,e=3*d.length,f=1*d.length,g=3*d.length,h=p(b,a),i=t(h),j=r(h),k=s(h);a.__vertexArray=new Float32Array(3*e),j&&(a.__normalArray=new Float32Array(3*e)),c.hasTangents&&(a.__tangentArray=new Float32Array(4*e)),k&&(a.__colorArray=new Float32Array(3*e)),i&&(c.faceVertexUvs.length>0&&(a.__uvArray=new Float32Array(2*e)),c.faceVertexUvs.length>1&&(a.__uv2Array=new Float32Array(2*e))),b.geometry.skinWeights.length&&b.geometry.skinIndices.length&&(a.__skinIndexArray=new Float32Array(4*e),a.__skinWeightArray=new Float32Array(4*e));var l=null!==vb.get("OES_element_index_uint")&&f>21845?Uint32Array:Uint16Array;if(a.__typeArray=l,a.__faceArray=new l(3*f),a.__lineArray=new l(2*g),a.__webglFaceCount=3*f,a.__webglLineCount=2*g,h.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var m in h.attributes){var n=h.attributes[m],o={};for(var q in n)o[q]=n[q];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var u=1;"v2"===o.type?u=2:"v3"===o.type?u=3:"v4"===o.type?u=4:"c"===o.type&&(u=3),o.size=u,o.array=new Float32Array(e*u),o.buffer=Ua.createBuffer(),o.buffer.belongsToAttribute=m,n.needsUpdate=!0,o.__original=n}a.__webglCustomAttributesList.push(o)}}a.__inittedArrays=!0}function p(a,b){return a.material instanceof k.MeshFaceMaterial?a.material.materials[b.materialIndex]:a.material}function q(a){return a&&void 0!==a.shading&&a.shading===k.SmoothShading}function r(a){return!(a instanceof k.MeshBasicMaterial&&!a.envMap||a instanceof k.MeshDepthMaterial)&&(q(a)?k.SmoothShading:k.FlatShading)}function s(a){return!!a.vertexColors&&a.vertexColors}function t(a){return!!(a.map||a.lightMap||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a instanceof k.ShaderMaterial)}function u(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=a.vertices,p=a.colors,q=a.lineDistances,r=o.length,s=p.length,t=q.length,u=a.__vertexArray,v=a.__colorArray,w=a.__lineDistanceArray,x=a.verticesNeedUpdate,y=a.colorsNeedUpdate,z=a.lineDistancesNeedUpdate,A=a.__webglCustomAttributesList;if(x){for(c=0;c<r;c++)f=o[c],g=3*c,u[g]=f.x,u[g+1]=f.y,u[g+2]=f.z;Ua.bindBuffer(Ua.ARRAY_BUFFER,a.__webglVertexBuffer),Ua.bufferData(Ua.ARRAY_BUFFER,u,b)}if(y){for(d=0;d<s;d++)h=p[d],g=3*d,v[g]=h.r,v[g+1]=h.g,v[g+2]=h.b;Ua.bindBuffer(Ua.ARRAY_BUFFER,a.__webglColorBuffer),Ua.bufferData(Ua.ARRAY_BUFFER,v,b)}if(z){for(e=0;e<t;e++)w[e]=q[e];Ua.bindBuffer(Ua.ARRAY_BUFFER,a.__webglLineDistanceBuffer),Ua.bufferData(Ua.ARRAY_BUFFER,w,b)}if(A)for(i=0,j=A.length;i<j;i++)if(n=A[i],n.needsUpdate&&(void 0===n.boundTo||"vertices"===n.boundTo)){if(g=0,l=n.value.length,1===n.size)for(k=0;k<l;k++)n.array[k]=n.value[k];else if(2===n.size)for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,g+=2;else if(3===n.size)if("c"===n.type)for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.r,n.array[g+1]=m.g,n.array[g+2]=m.b,g+=3;else for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,n.array[g+2]=m.z,g+=3;else if(4===n.size)for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,n.array[g+2]=m.z,n.array[g+3]=m.w,g+=4;Ua.bindBuffer(Ua.ARRAY_BUFFER,n.buffer),Ua.bufferData(Ua.ARRAY_BUFFER,n.array,b)}}function v(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=a.vertices,o=a.colors,p=n.length,q=o.length,r=a.__vertexArray,s=a.__colorArray,t=a.verticesNeedUpdate,u=a.colorsNeedUpdate,v=a.__webglCustomAttributesList;if(t){for(c=0;c<p;c++)e=n[c],f=3*c,r[f]=e.x,r[f+1]=e.y,r[f+2]=e.z;Ua.bindBuffer(Ua.ARRAY_BUFFER,a.__webglVertexBuffer),Ua.bufferData(Ua.ARRAY_BUFFER,r,b)}if(u){for(d=0;d<q;d++)g=o[d],f=3*d,s[f]=g.r,s[f+1]=g.g,s[f+2]=g.b;Ua.bindBuffer(Ua.ARRAY_BUFFER,a.__webglColorBuffer),Ua.bufferData(Ua.ARRAY_BUFFER,s,b)}if(v)for(h=0,i=v.length;h<i;h++)if(m=v[h],m.needsUpdate&&(void 0===m.boundTo||"vertices"===m.boundTo)){if(f=0,k=m.value.length,1===m.size)for(j=0;j<k;j++)m.array[j]=m.value[j];else if(2===m.size)for(j=0;j<k;j++)l=m.value[j],m.array[f]=l.x,m.array[f+1]=l.y,f+=2;else if(3===m.size)if("c"===m.type)for(j=0;j<k;j++)l=m.value[j],m.array[f]=l.r,m.array[f+1]=l.g,m.array[f+2]=l.b,f+=3;else for(j=0;j<k;j++)l=m.value[j],m.array[f]=l.x,m.array[f+1]=l.y,m.array[f+2]=l.z,f+=3;else if(4===m.size)for(j=0;j<k;j++)l=m.value[j],m.array[f]=l.x,m.array[f+1]=l.y,m.array[f+2]=l.z,m.array[f+3]=l.w,f+=4;Ua.bindBuffer(Ua.ARRAY_BUFFER,m.buffer),Ua.bufferData(Ua.ARRAY_BUFFER,m.array,b)}}function w(a,b,c,d,e){if(a.__inittedArrays){var f,g,h,i,j,l,m,n,o,p,q,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=r(e),L=s(e),M=t(e),N=K===k.SmoothShading,O=0,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=a.__vertexArray,Z=a.__uvArray,$=a.__uv2Array,_=a.__normalArray,aa=a.__tangentArray,ba=a.__colorArray,ca=a.__webglCustomAttributesList,da=a.__faceArray,ea=a.__lineArray,fa=b.geometry,ga=fa.verticesNeedUpdate,ha=fa.elementsNeedUpdate,ia=fa.uvsNeedUpdate,ja=fa.normalsNeedUpdate,ka=fa.tangentsNeedUpdate,la=fa.colorsNeedUpdate,ma=fa.vertices,na=a.faces3,oa=fa.faces,pa=fa.faceVertexUvs[0],qa=fa.faceVertexUvs[1];if(ga){for(f=0,g=na.length;f<g;f++)i=oa[na[f]],u=ma[i.a],v=ma[i.b],w=ma[i.c],Y[P]=u.x,Y[P+1]=u.y,Y[P+2]=u.z,Y[P+3]=v.x,Y[P+4]=v.y,Y[P+5]=v.z,Y[P+6]=w.x,Y[P+7]=w.y,Y[P+8]=w.z,P+=9;Ua.bindBuffer(Ua.ARRAY_BUFFER,a.__webglVertexBuffer),Ua.bufferData(Ua.ARRAY_BUFFER,Y,c)}if(la&&L){for(f=0,g=na.length;f<g;f++)i=oa[na[f]],m=i.vertexColors,n=i.color,3===m.length&&L===k.VertexColors?(A=m[0],B=m[1],C=m[2]):(A=n,B=n,C=n),ba[W]=A.r,ba[W+1]=A.g,ba[W+2]=A.b,ba[W+3]=B.r,ba[W+4]=B.g,ba[W+5]=B.b,ba[W+6]=C.r,ba[W+7]=C.g,ba[W+8]=C.b,W+=9;W>0&&(Ua.bindBuffer(Ua.ARRAY_BUFFER,a.__webglColorBuffer),Ua.bufferData(Ua.ARRAY_BUFFER,ba,c))}if(ka&&fa.hasTangents){for(f=0,g=na.length;f<g;f++)i=oa[na[f]],o=i.vertexTangents,x=o[0],y=o[1],z=o[2],aa[U]=x.x,aa[U+1]=x.y,aa[U+2]=x.z,aa[U+3]=x.w,aa[U+4]=y.x,aa[U+5]=y.y,aa[U+6]=y.z,aa[U+7]=y.w,aa[U+8]=z.x,aa[U+9]=z.y,aa[U+10]=z.z,aa[U+11]=z.w,U+=12;Ua.bindBuffer(Ua.ARRAY_BUFFER,a.__webglTangentBuffer),Ua.bufferData(Ua.ARRAY_BUFFER,aa,c)}if(ja&&K){for(f=0,g=na.length;f<g;f++)if(i=oa[na[f]],j=i.vertexNormals,l=i.normal,3===j.length&&N)for(D=0;D<3;D++)F=j[D],_[T]=F.x,_[T+1]=F.y,_[T+2]=F.z,T+=3;else for(D=0;D<3;D++)_[T]=l.x,_[T+1]=l.y,_[T+2]=l.z,T+=3;Ua.bindBuffer(Ua.ARRAY_BUFFER,a.__webglNormalBuffer),Ua.bufferData(Ua.ARRAY_BUFFER,_,c)}if(ia&&pa&&M){for(f=0,g=na.length;f<g;f++)if(h=na[f],void 0!==(p=pa[h]))for(D=0;D<3;D++)G=p[D],Z[Q]=G.x,Z[Q+1]=G.y,Q+=2;Q>0&&(Ua.bindBuffer(Ua.ARRAY_BUFFER,a.__webglUVBuffer),Ua.bufferData(Ua.ARRAY_BUFFER,Z,c))}if(ia&&qa&&M){for(f=0,g=na.length;f<g;f++)if(h=na[f],void 0!==(q=qa[h]))for(D=0;D<3;D++)H=q[D],$[R]=H.x,$[R+1]=H.y,R+=2;R>0&&(Ua.bindBuffer(Ua.ARRAY_BUFFER,a.__webglUV2Buffer),Ua.bufferData(Ua.ARRAY_BUFFER,$,c))}if(ha){for(f=0,g=na.length;f<g;f++)da[S]=O,da[S+1]=O+1,da[S+2]=O+2,S+=3,ea[V]=O,ea[V+1]=O+1,ea[V+2]=O,ea[V+3]=O+2,ea[V+4]=O+1,ea[V+5]=O+2,V+=6,O+=3;Ua.bindBuffer(Ua.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer),Ua.bufferData(Ua.ELEMENT_ARRAY_BUFFER,da,c),Ua.bindBuffer(Ua.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer),Ua.bufferData(Ua.ELEMENT_ARRAY_BUFFER,ea,c)}if(ca)for(D=0,E=ca.length;D<E;D++)if(J=ca[D],J.__original.needsUpdate){if(X=0,1===J.size){if(void 0===J.boundTo||"vertices"===J.boundTo)for(f=0,g=na.length;f<g;f++)i=oa[na[f]],J.array[X]=J.value[i.a],J.array[X+1]=J.value[i.b],J.array[X+2]=J.value[i.c],X+=3;else if("faces"===J.boundTo)for(f=0,g=na.length;f<g;f++)I=J.value[na[f]],J.array[X]=I,J.array[X+1]=I,J.array[X+2]=I,X+=3}else if(2===J.size){if(void 0===J.boundTo||"vertices"===J.boundTo)for(f=0,g=na.length;f<g;f++)i=oa[na[f]],u=J.value[i.a],v=J.value[i.b],w=J.value[i.c],J.array[X]=u.x,J.array[X+1]=u.y,J.array[X+2]=v.x,J.array[X+3]=v.y,J.array[X+4]=w.x,J.array[X+5]=w.y,X+=6;else if("faces"===J.boundTo)for(f=0,g=na.length;f<g;f++)I=J.value[na[f]],u=I,v=I,w=I,J.array[X]=u.x,J.array[X+1]=u.y,J.array[X+2]=v.x,J.array[X+3]=v.y,J.array[X+4]=w.x,J.array[X+5]=w.y,X+=6}else if(3===J.size){var ra;if(ra="c"===J.type?["r","g","b"]:["x","y","z"],void 0===J.boundTo||"vertices"===J.boundTo)for(f=0,g=na.length;f<g;f++)i=oa[na[f]],u=J.value[i.a],v=J.value[i.b],w=J.value[i.c],J.array[X]=u[ra[0]],J.array[X+1]=u[ra[1]],J.array[X+2]=u[ra[2]],J.array[X+3]=v[ra[0]],J.array[X+4]=v[ra[1]],J.array[X+5]=v[ra[2]],J.array[X+6]=w[ra[0]],J.array[X+7]=w[ra[1]],J.array[X+8]=w[ra[2]],X+=9;else if("faces"===J.boundTo)for(f=0,g=na.length;f<g;f++)I=J.value[na[f]],u=I,v=I,w=I,J.array[X]=u[ra[0]],J.array[X+1]=u[ra[1]],J.array[X+2]=u[ra[2]],J.array[X+3]=v[ra[0]],J.array[X+4]=v[ra[1]],J.array[X+5]=v[ra[2]],J.array[X+6]=w[ra[0]],J.array[X+7]=w[ra[1]],J.array[X+8]=w[ra[2]],X+=9;else if("faceVertices"===J.boundTo)for(f=0,g=na.length;f<g;f++)I=J.value[na[f]],u=I[0],v=I[1],w=I[2],J.array[X]=u[ra[0]],J.array[X+1]=u[ra[1]],J.array[X+2]=u[ra[2]],J.array[X+3]=v[ra[0]],J.array[X+4]=v[ra[1]],J.array[X+5]=v[ra[2]],J.array[X+6]=w[ra[0]],J.array[X+7]=w[ra[1]],J.array[X+8]=w[ra[2]],X+=9}else if(4===J.size)if(void 0===J.boundTo||"vertices"===J.boundTo)for(f=0,g=na.length;f<g;f++)i=oa[na[f]],u=J.value[i.a],v=J.value[i.b],w=J.value[i.c],J.array[X]=u.x,J.array[X+1]=u.y,J.array[X+2]=u.z,J.array[X+3]=u.w,J.array[X+4]=v.x,J.array[X+5]=v.y,J.array[X+6]=v.z,J.array[X+7]=v.w,J.array[X+8]=w.x,J.array[X+9]=w.y,J.array[X+10]=w.z,J.array[X+11]=w.w,X+=12;else if("faces"===J.boundTo)for(f=0,g=na.length;f<g;f++)I=J.value[na[f]],u=I,v=I,w=I,J.array[X]=u.x,J.array[X+1]=u.y,J.array[X+2]=u.z,J.array[X+3]=u.w,J.array[X+4]=v.x,J.array[X+5]=v.y,J.array[X+6]=v.z,J.array[X+7]=v.w,J.array[X+8]=w.x,J.array[X+9]=w.y,J.array[X+10]=w.z,J.array[X+11]=w.w,X+=12;else if("faceVertices"===J.boundTo)for(f=0,g=na.length;f<g;f++)I=J.value[na[f]],u=I[0],v=I[1],w=I[2],J.array[X]=u.x,J.array[X+1]=u.y,J.array[X+2]=u.z,J.array[X+3]=u.w,J.array[X+4]=v.x,J.array[X+5]=v.y,J.array[X+6]=v.z,J.array[X+7]=v.w,J.array[X+8]=w.x,J.array[X+9]=w.y,J.array[X+10]=w.z,J.array[X+11]=w.w,X+=12;Ua.bindBuffer(Ua.ARRAY_BUFFER,J.buffer),Ua.bufferData(Ua.ARRAY_BUFFER,J.array,c)}d&&(delete a.__inittedArrays,delete a.__colorArray,delete a.__normalArray,delete a.__tangentArray,delete a.__uvArray,delete a.__uv2Array,delete a.__faceArray,delete a.__vertexArray,delete a.__lineArray,delete a.__skinIndexArray,delete a.__skinWeightArray)}}function x(a){if(a.streamingDraw){if(!a.streamingIndex){var b=a.attributes.index;b&&(b.buffer=Ua.createBuffer(),Ua.bindBuffer(Ua.ELEMENT_ARRAY_BUFFER,b.buffer),Ua.bufferData(Ua.ELEMENT_ARRAY_BUFFER,b.array||a.ib,Ua.STATIC_DRAW))}}else{a.vb&&void 0===a.vbbuffer&&(a.vbbuffer=Ua.createBuffer(),a.vbNeedsUpdate=!0),a.ib&&void 0===a.ibbuffer&&(a.ibbuffer=Ua.createBuffer(),Ua.bindBuffer(Ua.ELEMENT_ARRAY_BUFFER,a.ibbuffer),Ua.bufferData(Ua.ELEMENT_ARRAY_BUFFER,a.ib,Ua.STATIC_DRAW)),a.iblines&&void 0===a.iblinesbuffer&&(a.iblinesbuffer=Ua.createBuffer(),Ua.bindBuffer(Ua.ELEMENT_ARRAY_BUFFER,a.iblinesbuffer),Ua.bufferData(Ua.ELEMENT_ARRAY_BUFFER,a.iblines,Ua.STATIC_DRAW));for(var c=a.attributes,d=a.attributesKeys,e=0,f=d.length;e<f;e++){var g=d[e],h=c[g],i="index"===g;if(h.array&&void 0===h.buffer&&(h.buffer=Ua.createBuffer(),h.needsUpdate=!0),!0===h.needsUpdate){var j=i?Ua.ELEMENT_ARRAY_BUFFER:Ua.ARRAY_BUFFER;Ua.bindBuffer(j,h.buffer),Ua.bufferData(j,h.array,Ua.STATIC_DRAW),h.needsUpdate=!1}}a.vbNeedsUpdate&&(Ua.bindBuffer(Ua.ARRAY_BUFFER,a.vbbuffer),Ua.bufferData(Ua.ARRAY_BUFFER,a.vb,Ua.STATIC_DRAW),a.vbNeedsUpdate=!1,a.discardAfterUpload&&(a.vb=null))}}function y(a,b,c,d){var e;if(!Xa||!l.USE_VAO||c.streamingDraw)return c.vaos=null,!1;if(c.offsets&&c.offsets.length>1)return c.vaos=null,!1;if(void 0===c.vaos&&(c.vaos=[]),e=Xa.createVertexArrayOES(),c.vaos.push({geomhash:b.id,uv:d,vao:e}),Xa.bindVertexArrayOES(e),a.isEdgeMaterial)Ua.bindBuffer(Ua.ELEMENT_ARRAY_BUFFER,c.iblinesbuffer);else{var f=c.attributes.index;f&&Ua.bindBuffer(Ua.ELEMENT_ARRAY_BUFFER,c.ibbuffer||f.buffer)}for(var g=null,h=b.attributes,i=b.attributesKeys,j=c.vbstride,k=c.offsets&&c.offsets.length?c.offsets[0].index:0,m=0,n=i.length;m<n;m++){var o=i[m],p=h[o];if(p>=0){var q=c.attributes[o];if("uv"===o&&d&&(q=c.attributes["uv"+(d+1)]),!q){Xa.bindVertexArrayOES(null);for(var r=0;r<c.vaos.length;r++)Xa.deleteVertexArrayOES(c.vaos[r].vao);return c.vaos=null,!1}var s=Ua.FLOAT,t=q.bytesPerItem||4;1===t?s=Ua.UNSIGNED_BYTE:2===t&&(s=Ua.UNSIGNED_SHORT),Ua.enableVertexAttribArray(p),void 0!==q.itemOffset?(g!=c.vbbuffer&&(Ua.bindBuffer(Ua.ARRAY_BUFFER,c.vbbuffer),g=c.vbbuffer),Ua.vertexAttribPointer(p,q.itemSize,s,!!q.normalize,4*j,4*(q.itemOffset+k*j))):(Ua.bindBuffer(Ua.ARRAY_BUFFER,q.buffer),g=q.buffer,Ua.vertexAttribPointer(p,q.itemSize,s,!!q.normalize,0,k*q.itemSize*t)),Wa&&Wa.vertexAttribDivisorANGLE(p,c.numInstances?q.divisor||0:0)}}return!0}function z(a,b,c,d){var e=c.vaos;if(e)for(var f=0,g=e.length;f<g;f++){var h=e[f];if(h.geomhash===b.id&&h.uv===d)return Xa.bindVertexArrayOES(h.vao),!0}else if(null===e)return!1;return y(a,b,c,d)}function A(a,b){var c=lb[a];return c||(c=Ua.createBuffer(),lb[a]=c),Ua.bindBuffer(Ua.ARRAY_BUFFER,c),Ua.bufferData(Ua.ARRAY_BUFFER,b,Ua.DYNAMIC_DRAW),c}function B(a,b,c,d,e,f){var g,h=b.attributes,i=b.attributesKeys,j=0;if(e)if(!e.buffer&&c.streamingDraw){var k=lb.index;k||(k=Ua.createBuffer(),lb.index=k),Ua.bindBuffer(Ua.ELEMENT_ARRAY_BUFFER,k),a.isEdgeMaterial?Ua.bufferData(Ua.ELEMENT_ARRAY_BUFFER,c.iblines,Ua.DYNAMIC_DRAW):Ua.bufferData(Ua.ELEMENT_ARRAY_BUFFER,e.array||c.ib,Ua.DYNAMIC_DRAW)}else a.isEdgeMaterial?Ua.bindBuffer(Ua.ELEMENT_ARRAY_BUFFER,c.iblinesbuffer):Ua.bindBuffer(Ua.ELEMENT_ARRAY_BUFFER,c.ibbuffer||e.buffer);for(var l=0,m=i.length;l<m;l++){var n=i[l],o=h[n];if(o>=0){var p=c.attributes[n];if("uv"===n&&f&&(p=c.attributes["uv"+(f+1)]),p){var q,r,s=void 0!==p.itemOffset;s?(q=c.vbstride,r=p.itemOffset,j!==g&&(c.streamingDraw?j=A("interleavedVB",c.vb):(j=c.vbbuffer,Ua.bindBuffer(Ua.ARRAY_BUFFER,j)),g=j)):(q=p.itemSize,r=0,c.streamingDraw?j=A(n,p.array):(j=p.buffer,Ua.bindBuffer(Ua.ARRAY_BUFFER,j)));var t=Ua.FLOAT,u=p.bytesPerItem||4;1===u?t=Ua.UNSIGNED_BYTE:2===u&&(t=Ua.UNSIGNED_SHORT),s&&(u=4),ub.enableAttribute(o),Ua.vertexAttribPointer(o,p.itemSize,t,p.normalize,q*u,(r+d*q)*u),Wa&&Wa.vertexAttribDivisorANGLE(o,c.numInstances?p.divisor||0:0)}else if(a.defaultAttributeValues){var v=a.defaultAttributeValues[n];v&&2===v.length?Ua.vertexAttrib2fv(o,a.defaultAttributeValues[n]):v&&3===v.length?Ua.vertexAttrib3fv(o,a.defaultAttributeValues[n]):v&&4===v.length&&Ua.vertexAttrib4fv(o,a.defaultAttributeValues[n])}}}ub.disableUnusedAttributes()}function C(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?a.z-b.z:a.id-b.id}function D(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?b.z-a.z:a.id-b.id}function E(a){G(a,!0)}function F(a){G(a,!1)}function G(a,b,c){var d,e;if(c||!1!==a.visible){if(a instanceof k.Scene||a instanceof k.Group);else if(a instanceof h.RenderBatch)a.forEach(b?E:F);else if(O(a),a instanceof k.Light)Na.push(a);else{var f=Oa[a.id];if(f&&(!1===a.frustumCulled||!0===mb.intersectsObject(a)))for(d=0,e=f.length;d<e;d++){var g=f[d];N(g),g.render=!0,!0===b&&(pb.setFromMatrixPosition(a.matrixWorld),pb.applyProjection(nb),g.z=pb.z)}}if(a.children)for(d=0,e=a.children.length;d<e;d++)G(a.children[d],b,c)}}function H(a,b){if(!b.getCustomOverrideMaterial)return b;var c=b.getCustomOverrideMaterial(a);return c||b}function I(a,b,c,d,e){for(var f,g=0,h=a.length;g<h;g++){var i=a[g],j=i.object,l=i.buffer;if(e)f=H(i.material,e);else{if(!(f=i.material))continue;$(f)}if(f.twoPassTransparency){var m=f.side;f.side=k.BackSide,J(f,b,c,d,l,e,j),f.side=k.FrontSide,J(f,b,c,d,l,e,j),f.side=m}else J(f,b,c,d,l,e,j)}}function J(a,b,c,d,e,f,g){if(Ya.setMaterialFaces(a),e instanceof k.BufferGeometry?Ya.renderBufferDirect(b,c,d,a,e,g):Ya.renderBuffer(b,c,d,a,e,g),a.decals)for(var h=a.decals,i=0,j=h.length;i<j;i++){var l=h[i];a=l.material,$(a),Ya.setMaterialFaces(a),e instanceof k.BufferGeometry&&Ya.renderBufferDirect(b,c,d,a,e,g,l.uv)}}function K(a,b){if(a.visible&&!a.hide){var c;if(bc)c=H(a.material,bc);else{if(!(c=a.material))return;$(c)}if(c.twoPassTransparency){var d=c.side;c.side=k.BackSide,L(a,c),c.side=k.FrontSide,L(a,c),c.side=d}else L(a,c)}}function L(a,b){if(Ya.setMaterialFaces(b),Ya.renderBufferDirect($b,_b,ac,b,a.geometry,a),b.decals)for(var c=b.decals,d=0,e=c.length;d<e;d++){var f=c[d];b=f.material,$(b),Ya.setMaterialFaces(b),Ya.renderBufferDirect($b,_b,ac,b,a.geometry,a,f.uv)}}function M(a,b,c,d,e,f){$b=c,_b=d,ac=e,bc=f||null,a.forEach(K,a.forceVisible?1:128,!1)}function N(a){var b=a.object,c=a.buffer,d=b.geometry,e=b.material;if(e instanceof k.MeshFaceMaterial){var f=d instanceof k.BufferGeometry?0:c.materialIndex;e=e.materials[f],a.material=e,e.transparent?Ta.push(a):Sa.push(a)}else e&&(a.material=e,e.transparent?Ta.push(a):Sa.push(a))}function O(a){void 0===a.__webglInit&&(a.__webglInit=!0,a.addEventListener("removed",Qb));var d=a.geometry;if(void 0===d||void 0===d.__webglInit&&(d.__webglInit=!0,d.addEventListener("dispose",Rb),d instanceof k.BufferGeometry||(a instanceof k.Mesh?Q(a,d):a instanceof k.Line?void 0===d.__webglVertexBuffer&&(b(d),j(d,a),d.verticesNeedUpdate=!0,d.colorsNeedUpdate=!0,d.lineDistancesNeedUpdate=!0):a instanceof k.PointCloud&&void 0===d.__webglVertexBuffer&&(c(d),n(d,a),d.verticesNeedUpdate=!0,d.colorsNeedUpdate=!0))),void 0===a.__webglActive)if(a.__webglActive=!0,a instanceof k.Mesh){
if(d instanceof k.BufferGeometry)R(Oa,d,a);else if(d instanceof k.Geometry)for(var e=cc[d.id],f=0,g=e.length;f<g;f++)R(Oa,e[f],a)}else a instanceof k.Line||a instanceof k.PointCloud?R(Oa,d,a):(a instanceof k.ImmediateRenderObject||a.immediateRenderCallback)&&S(Pa,a)}function P(a,b){for(var c,d,e=vb.get("OES_element_index_uint")?4294967296:65535,f={},g=a.morphTargets?a.morphTargets.length:0,h=a.morphNormals?a.morphNormals.length:0,i={},j=[],k=0,l=a.faces.length;k<l;k++){var m=a.faces[k],n=b?m.materialIndex:0;n in f||(f[n]={hash:n,counter:0}),c=f[n].hash+"_"+f[n].counter,c in i||(d={id:dc++,faces3:[],materialIndex:n,vertices:0,numMorphTargets:g,numMorphNormals:h},i[c]=d,j.push(d)),i[c].vertices+3>e&&(f[n].counter+=1,(c=f[n].hash+"_"+f[n].counter)in i||(d={id:dc++,faces3:[],materialIndex:n,vertices:0,numMorphTargets:g,numMorphNormals:h},i[c]=d,j.push(d))),i[c].faces3.push(k),i[c].vertices+=3}return j}function Q(a,b){var c=a.material,e=!1;void 0!==cc[b.id]&&!0!==b.groupsNeedUpdate||(delete Oa[a.id],cc[b.id]=P(b,c instanceof k.MeshFaceMaterial),b.groupsNeedUpdate=!1);for(var f=cc[b.id],g=0,h=f.length;g<h;g++){var i=f[g];void 0===i.__webglVertexBuffer?(d(i),o(i,a),b.verticesNeedUpdate=!0,b.morphTargetsNeedUpdate=!0,b.elementsNeedUpdate=!0,b.uvsNeedUpdate=!0,b.normalsNeedUpdate=!0,b.tangentsNeedUpdate=!0,b.colorsNeedUpdate=!0,e=!0):e=!1,(e||void 0===a.__webglActive)&&R(Oa,i,a)}a.__webglActive=!0}function R(a,b,c){var d=c.id;a[d]=a[d]||[],a[d].push({id:d,buffer:b,object:c,material:null,z:0})}function S(a,b){a.push({id:null,object:b,opaque:null,transparent:null,z:0})}function T(a){var b,c,d=a.geometry;if(d instanceof k.BufferGeometry)x(d);else if(a instanceof k.Mesh){!0===d.groupsNeedUpdate&&Q(a,d);for(var e=cc[d.id],f=0,g=e.length;f<g;f++){var h=e[f];c=p(a,h),b=c.attributes&&U(c),(d.verticesNeedUpdate||d.morphTargetsNeedUpdate||d.elementsNeedUpdate||d.uvsNeedUpdate||d.normalsNeedUpdate||d.colorsNeedUpdate||d.tangentsNeedUpdate||b)&&w(h,a,Ua.DYNAMIC_DRAW,!d.dynamic,c)}d.verticesNeedUpdate=!1,d.morphTargetsNeedUpdate=!1,d.elementsNeedUpdate=!1,d.uvsNeedUpdate=!1,d.normalsNeedUpdate=!1,d.colorsNeedUpdate=!1,d.tangentsNeedUpdate=!1,c.attributes&&V(c)}else a instanceof k.Line?(c=p(a,d),b=c.attributes&&U(c),(d.verticesNeedUpdate||d.colorsNeedUpdate||d.lineDistancesNeedUpdate||b)&&u(d,Ua.DYNAMIC_DRAW),d.verticesNeedUpdate=!1,d.colorsNeedUpdate=!1,d.lineDistancesNeedUpdate=!1,c.attributes&&V(c)):a instanceof k.PointCloud&&(c=p(a,d),b=c.attributes&&U(c),(d.verticesNeedUpdate||d.colorsNeedUpdate||b)&&v(d,Ua.DYNAMIC_DRAW),d.verticesNeedUpdate=!1,d.colorsNeedUpdate=!1,c.attributes&&V(c))}function U(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return!0;return!1}function V(a){for(var b in a.attributes)a.attributes[b].needsUpdate=!1}function W(a){a instanceof k.Mesh||a instanceof k.PointCloud||a instanceof k.Line?delete Oa[a.id]:(a instanceof k.ImmediateRenderObject||a.immediateRenderCallback)&&X(Pa,a),delete a.__webglInit,delete a.__webglActive}function X(a,b){for(var c=a.length-1;c>=0;c--)a[c].object===b&&a.splice(c,1)}function Y(a,b){if(b.textureMaps)for(var c=0;c<e.PrismMaps.length;c++){var d=e.PrismMaps[c],f=b.textureMaps[d+"_map"];if(f){var g=f.textureObj.properties.booleans;a[d]={S:!g.texture_URepeat.values[0],T:!g.texture_VRepeat.values[0]}}}}function Z(a,b,c,d){a.addEventListener("dispose",Ub);var f=ec[a.type];if(f){var g=k.ShaderLib[f];a.__webglShader={uniforms:k.UniformsUtils.clone(g.uniforms),vertexShader:g.vertexShader,fragmentShader:g.fragmentShader}}else a.__webglShader={uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader};var h=ya(b),i={precision:Ba,precisionFragment:Ca,supportsVertexTextures:Db,haveTextureLod:!!vb.get("EXT_shader_texture_lod"),map:!!a.map,envMap:!!a.envMap,irradianceMap:!!a.irradianceMap,envIsSpherical:a.envMap&&a.envMap.mapping==k.SphericalReflectionMapping,envGammaEncoded:a.envMap&&a.envMap.GammaEncoded,irrGammaEncoded:a.irradianceMap&&a.irradianceMap.GammaEncoded,envRGBM:a.envMap&&a.envMap.RGBM,irrRGBM:a.irradianceMap&&a.irradianceMap.RGBM,lightMap:!!a.lightMap,bumpMap:vb.get("OES_standard_derivatives")&&!!a.bumpMap,normalMap:vb.get("OES_standard_derivatives")&&!!a.normalMap,specularMap:!!a.specularMap,alphaMap:!!a.alphaMap,vertexColors:a.vertexColors,vertexIds:a.vertexIds,useInstancing:a.useInstancing,wideLines:a.wideLines,fog:c,useFog:a.fog,fogExp:c instanceof k.FogExp2,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:Ia,maxDirLights:h.directional,maxPointLights:h.point,maxSpotLights:h.spot,maxHemiLights:h.hemi,alphaTest:a.alphaTest,metal:a.metal,clearcoat:a.clearcoat,wrapAround:a.wrapAround,doubleSided:a.side===k.DoubleSide,flipSided:a.side===k.BackSide,mrtNormals:a.mrtNormals,mrtIdBuffer:a.mrtIdBuffer,vertexPrefix:eb,fragmentPrefix:fb,tonemapOutput:a.tonemapOutput,packedNormals:a.packedNormals,hatchPattern:!!a.hatchParams,numCutplanes:a.cutplanes?a.cutplanes.length:0,useTiling:a.useTiling,tilingRepeatRange:a.useTiling&&a.tilingRepeatRange,hasRoundCorner:a.hasRoundCorner,useRandomOffset:a.useRandomOffset,mapInvert:a.map&&a.map.invert,mapClampS:a.map&&a.map.clampS,mapClampT:a.map&&a.map.clampT,bumpMapClampS:a.bumpMap&&a.bumpMap.clampS,bumpMapClampT:a.bumpMap&&a.bumpMap.clampT,normalMapClampS:a.normalMap&&a.normalMap.clampS,normalMapClampT:a.normalMap&&a.normalMap.clampT,specularMapClampS:a.specularMap&&a.specularMap.clampS,specularMapClampT:a.specularMap&&a.specularMap.clampT,alphaMapInvert:a.alphaMap&&a.alphaMap.invert,alphaMapClampS:a.alphaMap&&a.alphaMap.clampS,alphaMapClampT:a.alphaMap&&a.alphaMap.clampT};a.isPrismMaterial&&(Y(i,a),i.isPrism=!0);var j=[];f?j.push(f):(j.push(a.fragmentShader),j.push(a.vertexShader));for(var l in a.defines)j.push(l),j.push(a.defines[l]);var m,n;for(m in i)j.push(m),j.push(i[m]);var o,p=j.join();for(m=0,n=Za.length;m<n;m++){var q=Za[m];if(q.code===p){o=q,o.usedTimes++;break}}void 0===o&&(o=new e.WebGLProgram(Ya,p,a,i),Za.push(o),Ya.info.memory.programs=Za.length),a.programs||(a.programs=[]),a.programs[db]=o,a.uniformsLists||(a.uniformsLists=[]),a.uniformsList=a.uniformsLists[db]=[];for(var r in a.__webglShader.uniforms){var s=o.uniforms[r];s&&a.uniformsList.push([a.__webglShader.uniforms[r],s])}}function $(a){!0===a.transparent?ub.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha):ub.setBlending(k.NoBlending),ub.setDepthTest(a.depthTest),ub.setDepthWrite(a.depthWrite),ub.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function _(a,b,c,d,e){gb=0,d.needsUpdate?(d.program&&Zb(d),Z(d,b,c,e),d.needsUpdate=!1):d.programs[db]||Z(d,b,c,e);var f=!1,h=!1,i=!1;d.uniformsList=d.uniformsLists[db];var j=d.program=d.programs[db],l=j.uniforms,m=d.__webglShader.uniforms;if(j.id!==$a&&(Ua.useProgram(j.program),$a=j.id,f=!0,h=!0,i=!0),d.id!==ab&&(-1===ab&&(i=!0),ab=d.id,h=!0),(f||a!==bb)&&(Ua.uniformMatrix4fv(l.projectionMatrix,!1,a.projectionMatrix.elements),Ia&&Ua.uniform1f(l.logDepthBufFC,2/(Math.log(a.far+1)/Math.LN2)),a!==bb&&(bb=a),(d instanceof k.ShaderMaterial||d instanceof k.MeshPhongMaterial||d.isPrismMaterial||d.envMap)&&null!==l.cameraPosition&&(pb.setFromMatrixPosition(a.matrixWorld),Ua.uniform3f(l.cameraPosition,pb.x,pb.y,pb.z)),(d instanceof k.MeshPhongMaterial||d instanceof k.MeshLambertMaterial||d instanceof k.ShaderMaterial||d.isPrismMaterial||d.skinning)&&(null!==l.viewMatrix&&Ua.uniformMatrix4fv(l.viewMatrix,!1,a.matrixWorldInverse.elements),null!==l.viewMatrixInverse&&Ua.uniformMatrix4fv(l.viewMatrixInverse,!1,ob.elements),l.mvpMatrix&&Ua.uniformMatrix4fv(l.mvpMatrix,!1,nb.elements),i?(fa(m,d),ga(m,!0)):ga(m,!1))),h){c&&d.fog&&ea(m,c),(d instanceof k.MeshPhongMaterial||d instanceof k.MeshLambertMaterial||d.isPrismMaterial||d.lights)&&(rb&&(i=!0,qa(b),rb=!1),i?(ka(m,sb),la(m,!0)):la(m,!1)),(d instanceof k.MeshBasicMaterial||d instanceof k.MeshLambertMaterial||d instanceof k.MeshPhongMaterial)&&(aa(m,d),fa(m,d)),d instanceof k.PointCloudMaterial?ba(m,d):d instanceof k.LineBasicMaterial?ca(m,d):d instanceof k.LineDashedMaterial?(ca(m,d),da(m,d)):d instanceof k.MeshPhongMaterial?ha(m,d):d instanceof k.MeshLambertMaterial?ja(m,d):d instanceof k.MeshDepthMaterial?(m.mNear.value=a.near,m.mFar.value=a.far,m.opacity.value=d.opacity):d instanceof k.MeshNormalMaterial?m.opacity.value=d.opacity:d.isPrismMaterial&&(ia(m,d),fa(m,d)),d.wideLines&&(m.view_size.value=new k.Vector2(window.innerWidth,window.innerHeight)),g.ShadowRender&&d.shadowMap&&g.ShadowRender.RefreshUniformsShadow(m,d);var n=m.cutplanes;d.cutplanes&&d.cutplanes.length>0&&n&&(n.value=d.cutplanes,n._array&&n._array.length!=4*d.cutplanes&&(n._array=void 0)),d.hatchParams&&m.hatchParams&&(m.hatchParams.value.copy(d.hatchParams),m.hatchTintColor.value.copy(d.hatchTintColor),m.hatchTintIntensity.value=d.hatchTintIntensity),oa(d.uniformsList)}ma(l,e,a),null!==l.modelMatrix&&Ua.uniformMatrix4fv(l.modelMatrix,!1,e.matrixWorld.elements);var o;if(l.modelId){l.dbId&&(o=e.dbId||e.fragId||0,Ua.uniform3f(l.dbId,(255&o)/255,(o>>8&255)/255,(o>>16&255)/255));var p=e.modelId;Ua.uniform3f(l.modelId,(255&p)/255,(p>>8&255)/255,(o>>24&255)/255)}else null!==l.dbId&&(o=!Ja&&e.dbId||e.fragId||0,Ua.uniform3f(l.dbId,(255&o)/255,(o>>8&255)/255,(o>>16&255)/255));if(l.themingColor){var q=e.themingColor;q instanceof k.Vector4?Ua.uniform4f(l.themingColor,q.x,q.y,q.z,q.w):Ua.uniform4f(l.themingColor,0,0,0,0)}return j}function aa(a,b){function c(a,b,c){var d=c.offset,e=c.repeat;if(b){var f=b.value;c.matrix?f.copy(c.matrix):f.identity(),f.elements[6]+=d.x,f.elements[7]+=d.y,f.elements[0]*=e.x,f.elements[3]*=e.x,f.elements[1]*=e.y,f.elements[4]*=e.y}else a.offsetRepeat.value.set(d.x,d.y,e.x,e.y)}a.opacity.value=b.opacity,a.diffuse.value.copy(b.color),a.map.value=b.map,a.lightMap.value=b.lightMap,a.specularMap.value=b.specularMap,a.alphaMap.value=b.alphaMap,b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale),b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale)),b.alphaMap&&c(a,a.texMatrixAlpha,b.alphaMap);var d;b.normalMap?d=b.normalMap:b.bumpMap&&(d=b.bumpMap),void 0!==d&&c(a,a.texMatrixBump,d);var e;b.map?e=b.map:b.specularMap&&(e=b.specularMap),void 0!==e&&c(a,a.texMatrix,e),a.envMap.value=b.envMap,a.irradianceMap&&(a.irradianceMap.value=b.irradianceMap),a.reflectivity.value=b.reflectivity,a.refractionRatio.value=b.refractionRatio}function ba(a,b){ca(a,b),a.point_size.value=b.size}function ca(a,b){a.diffuse.value=b.color,a.opacity.value=b.opacity}function da(a,b){a.dashSize.value=b.dashSize,a.totalSize.value=b.dashSize+b.gapSize,a.scale.value=b.scale}function ea(a,b){a.fogColor.value=b.color,b instanceof k.Fog?(a.fogNear.value=b.near,a.fogFar.value=b.far):b instanceof k.FogExp2&&(a.fogDensity.value=b.density)}function fa(a,b){a.envMap&&(a.envMap.value=b.envMap),a.irradianceMap&&(a.irradianceMap.value=b.irradianceMap),a.envMapExposure&&(a.envMapExposure.value=b.envMapExposure),a.envRotationSin&&a.envRotationCos&&(a.envRotationSin.value=b.envRotationSin,a.envRotationCos.value=b.envRotationCos)}function ga(a,b){a.envMap&&(a.envMap.needsUpdate=b),a.irradianceMap&&(a.irradianceMap.needsUpdate=b),a.envMapExposure&&(a.envMapExposure.needsUpdate=b)}function ha(a,b){if(a.shininess.value=b.shininess,a.reflMipIndex){var c=Math.log(Math.max(1+1e-10,b.shininess));a.reflMipIndex.value=Math.max(0,-.72134752*c+5.5)}a.emissive&&a.emissive.value.copy(b.emissive),a.specular.value.copy(b.specular),a.exposureBias&&(a.exposureBias.value=b.exposureBias)}function ia(a,b){function c(a,b,c){a[c].value=b[c],null!=b[c]&&(a[c+"_texMatrix"].value=b[c].matrix,a[c+"_invert"].value=b[c].invert)}function d(a,b,c){a[c].value=b[c],null!=b[c]&&(a[c+"_texMatrix"].value=b[c].matrix,a[c+"_bumpScale"].value=b[c].bumpScale,a[c+"_bumpmapType"].value=b[c].bumpmapType)}switch(a.exposureBias.value=b.exposureBias,a.opacity.value=b.opacity,a.surface_albedo.value=b.surface_albedo,a.surface_roughness.value=b.surface_roughness,a.surface_anisotropy.value=b.surface_anisotropy,a.surface_rotation.value=b.surface_rotation,c(a,b,"surface_albedo_map"),c(a,b,"surface_roughness_map"),c(a,b,"surface_cutout_map"),c(a,b,"surface_anisotropy_map"),c(a,b,"surface_rotation_map"),d(a,b,"surface_normal_map"),b.prismType){case"PrismOpaque":a.opaque_albedo.value=b.opaque_albedo,a.opaque_luminance_modifier.value=b.opaque_luminance_modifier,a.opaque_f0.value=b.opaque_f0,a.opaque_luminance.value=b.opaque_luminance,c(a,b,"opaque_albedo_map"),c(a,b,"opaque_luminance_modifier_map"),c(a,b,"opaque_f0_map");break;case"PrismMetal":a.metal_f0.value=b.metal_f0,c(a,b,"metal_f0_map");break;case"PrismLayered":a.layered_f0.value=b.layered_f0,a.layered_diffuse.value=b.layered_diffuse,a.layered_fraction.value=b.layered_fraction,a.layered_bottom_f0.value=b.layered_bottom_f0,a.layered_roughness.value=b.layered_roughness,a.layered_anisotropy.value=b.layered_anisotropy,a.layered_rotation.value=b.layered_rotation,c(a,b,"layered_bottom_f0_map"),c(a,b,"layered_f0_map"),c(a,b,"layered_diffuse_map"),c(a,b,"layered_fraction_map"),c(a,b,"layered_roughness_map"),c(a,b,"layered_anisotropy_map"),c(a,b,"layered_rotation_map"),d(a,b,"layered_normal_map");break;case"PrismTransparent":a.transparent_color.value=b.transparent_color,a.transparent_distance.value=b.transparent_distance,a.transparent_ior.value=b.transparent_ior;break;case"PrismGlazing":a.glazing_f0.value=b.glazing_f0,a.glazing_transmission_color.value=b.glazing_transmission_color,a.glazing_transmission_roughness.value=b.glazing_transmission_roughness,c(a,b,"glazing_f0_map"),c(a,b,"glazing_transmission_color_map"),c(a,b,"glazing_transmission_roughness_map");break;case"PrismWood":a.wood_fiber_cosine_enable.value=b.wood_fiber_cosine_enable,a.wood_fiber_cosine_bands.value=b.wood_fiber_cosine_bands,a.wood_fiber_cosine_weights.value=b.wood_fiber_cosine_weights,a.wood_fiber_cosine_frequencies.value=b.wood_fiber_cosine_frequencies,a.wood_fiber_perlin_enable.value=b.wood_fiber_perlin_enable,a.wood_fiber_perlin_bands.value=b.wood_fiber_perlin_bands,a.wood_fiber_perlin_weights.value=b.wood_fiber_perlin_weights,a.wood_fiber_perlin_frequencies.value=b.wood_fiber_perlin_frequencies,a.wood_fiber_perlin_scale_z.value=b.wood_fiber_perlin_scale_z,a.wood_growth_perlin_enable.value=b.wood_growth_perlin_enable,a.wood_growth_perlin_bands.value=b.wood_growth_perlin_bands,a.wood_growth_perlin_weights.value=b.wood_growth_perlin_weights,a.wood_growth_perlin_frequencies.value=b.wood_growth_perlin_frequencies,a.wood_latewood_ratio.value=b.wood_latewood_ratio,a.wood_earlywood_sharpness.value=b.wood_earlywood_sharpness,a.wood_latewood_sharpness.value=b.wood_latewood_sharpness,a.wood_ring_thickness.value=b.wood_ring_thickness,a.wood_earlycolor_perlin_enable.value=b.wood_earlycolor_perlin_enable,a.wood_earlycolor_perlin_bands.value=b.wood_earlycolor_perlin_bands,a.wood_earlycolor_perlin_weights.value=b.wood_earlycolor_perlin_weights,a.wood_earlycolor_perlin_frequencies.value=b.wood_earlycolor_perlin_frequencies,a.wood_early_color.value=b.wood_early_color,a.wood_use_manual_late_color.value=b.wood_use_manual_late_color,a.wood_manual_late_color.value=b.wood_manual_late_color,a.wood_latecolor_perlin_enable.value=b.wood_latecolor_perlin_enable,a.wood_latecolor_perlin_bands.value=b.wood_latecolor_perlin_bands,a.wood_latecolor_perlin_weights.value=b.wood_latecolor_perlin_weights,a.wood_latecolor_perlin_frequencies.value=b.wood_latecolor_perlin_frequencies,a.wood_late_color_power.value=b.wood_late_color_power,a.wood_diffuse_perlin_enable.value=b.wood_diffuse_perlin_enable,a.wood_diffuse_perlin_bands.value=b.wood_diffuse_perlin_bands,a.wood_diffuse_perlin_weights.value=b.wood_diffuse_perlin_weights,a.wood_diffuse_perlin_frequencies.value=b.wood_diffuse_perlin_frequencies,a.wood_diffuse_perlin_scale_z.value=b.wood_diffuse_perlin_scale_z,a.wood_use_pores.value=b.wood_use_pores,a.wood_pore_type.value=b.wood_pore_type,a.wood_pore_radius.value=b.wood_pore_radius,a.wood_pore_cell_dim.value=b.wood_pore_cell_dim,a.wood_pore_color_power.value=b.wood_pore_color_power,a.wood_pore_depth.value=b.wood_pore_depth,a.wood_use_rays.value=b.wood_use_rays,a.wood_ray_color_power.value=b.wood_ray_color_power,a.wood_ray_seg_length_z.value=b.wood_ray_seg_length_z,a.wood_ray_num_slices.value=b.wood_ray_num_slices,a.wood_ray_ellipse_z2x.value=b.wood_ray_ellipse_z2x,a.wood_ray_ellipse_radius_x.value=b.wood_ray_ellipse_radius_x,a.wood_use_latewood_bump.value=b.wood_use_latewood_bump,a.wood_latewood_bump_depth.value=b.wood_latewood_bump_depth,a.wood_use_groove_roughness.value=b.wood_use_groove_roughness,a.wood_groove_roughness.value=b.wood_groove_roughness,a.wood_diffuse_lobe_weight.value=b.wood_diffuse_lobe_weight,c(a,b,"wood_curly_distortion_map"),null!=a.wood_curly_distortion_map.value&&(a.wood_curly_distortion_map.value.minFilter=k.NearestFilter,a.wood_curly_distortion_map.value.magFilter=k.NearestFilter,a.wood_curly_distortion_enable.value=b.wood_curly_distortion_enable,a.wood_curly_distortion_scale.value=b.wood_curly_distortion_scale);var e=1-b.wood_latewood_ratio,f=b.wood_earlywood_sharpness*e,g=b.wood_latewood_sharpness*b.wood_latewood_ratio,h=e+g;a.wood_ring_fraction.value=new k.Vector4(e,f,g,h),a.wood_fall_rise.value=new k.Vector2(e-f,b.wood_latewood_ratio-g);break;default:k.warn("Unknown prism type: "+b.prismType)}b.useTiling&&(a.tilingOverallTransform.value=b.tilingOverallTransform,a.TilingMap.value=b.TilingMap,a.TilingMap_texMatrix.value=b.TilingMap_texMatrix,b.hasRoundCorner&&(a.TilingNormalMap.value=b.TilingNormalMap,a.TilingNormalMap_texMatrix.value=b.TilingNormalMap_texMatrix),b.useRandomOffset&&(a.TilingRandomMap.value=b.TilingRandomMap,a.TilingRandomMap_texMatrix.value=b.TilingRandomMap_texMatrix,a.tilingRandomAxisS.value=b.tilingRandomAxisS,a.tilingRandomAxisT.value=b.tilingRandomAxisT,a.tilingRandomAlignmentOffset.value=b.tilingRandomAlignmentOffset),a.uv2tile.value=b.uv2tile,a.tile2uv.value=b.tile2uv,a.tileAlignOffset.value=b.tileAlignOffset,a.tilingUVTransform.value=b.tilingUVTransform),a.envExponentMin.value=b.envExponentMin,a.envExponentMax.value=b.envExponentMax,a.envExponentCount.value=b.envExponentCount}function ja(a,b){a.emissive.value.copy(b.emissive),b.wrapAround&&a.wrapRGB.value.copy(b.wrapRGB)}function ka(a,b){a.ambientLightColor.value=b.ambient,a.directionalLightColor.value=b.directional.colors,a.directionalLightDirection.value=b.directional.positions,a.pointLightColor.value=b.point.colors,a.pointLightPosition.value=b.point.positions,a.pointLightDistance.value=b.point.distances,a.spotLightColor.value=b.spot.colors,a.spotLightPosition.value=b.spot.positions,a.spotLightDistance.value=b.spot.distances,a.spotLightDirection.value=b.spot.directions,a.spotLightAngleCos.value=b.spot.anglesCos,a.spotLightExponent.value=b.spot.exponents,a.hemisphereLightSkyColor.value=b.hemi.skyColors,a.hemisphereLightGroundColor.value=b.hemi.groundColors,a.hemisphereLightDirection.value=b.hemi.positions}function la(a,b){a.ambientLightColor.needsUpdate=b,a.directionalLightColor.needsUpdate=b,a.directionalLightDirection.needsUpdate=b,a.pointLightColor.needsUpdate=b,a.pointLightPosition.needsUpdate=b,a.pointLightDistance.needsUpdate=b,a.spotLightColor.needsUpdate=b,a.spotLightPosition.needsUpdate=b,a.spotLightDistance.needsUpdate=b,a.spotLightDirection.needsUpdate=b,a.spotLightAngleCos.needsUpdate=b,a.spotLightExponent.needsUpdate=b,a.hemisphereLightSkyColor.needsUpdate=b,a.hemisphereLightGroundColor.needsUpdate=b,a.hemisphereLightDirection.needsUpdate=b}function ma(a,b,c){Qa.multiplyMatrices(c.matrixWorldInverse,b.matrixWorld),Ua.uniformMatrix4fv(a.modelViewMatrix,!1,Qa.elements),a.normalMatrix&&(Ra.getNormalMatrix(Qa),Ua.uniformMatrix3fv(a.normalMatrix,!1,Ra.elements))}function na(){var a=gb;return a>=zb&&k.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+zb),gb+=1,a}function oa(a){for(var b,c,d,e=0,f=a.length;e<f;e++){var g=a[e][0];if(!1!==g.needsUpdate){var h,i,j=g.type,l=g.value,m=a[e][1];switch(j){case"1i":Ua.uniform1i(m,l);break;case"1f":Ua.uniform1f(m,l);break;case"2f":Ua.uniform2f(m,l[0],l[1]);break;case"3f":Ua.uniform3f(m,l[0],l[1],l[2]);break;case"4f":Ua.uniform4f(m,l[0],l[1],l[2],l[3]);break;case"1iv":Ua.uniform1iv(m,l);break;case"3iv":Ua.uniform3iv(m,l);break;case"1fv":Ua.uniform1fv(m,l);break;case"2fv":Ua.uniform2fv(m,l);break;case"3fv":Ua.uniform3fv(m,l);break;case"4fv":Ua.uniform4fv(m,l);break;case"Matrix3fv":Ua.uniformMatrix3fv(m,!1,l);break;case"Matrix4fv":Ua.uniformMatrix4fv(m,!1,l);break;case"i":Ua.uniform1i(m,l);break;case"f":Ua.uniform1f(m,l);break;case"v2":Ua.uniform2f(m,l.x,l.y);break;case"v3":Ua.uniform3f(m,l.x,l.y,l.z);break;case"v4":Ua.uniform4f(m,l.x,l.y,l.z,l.w);break;case"c":Ua.uniform3f(m,l.r,l.g,l.b);break;case"iv1":Ua.uniform1iv(m,l);break;case"iv":Ua.uniform3iv(m,l);break;case"fv1":Ua.uniform1fv(m,l);break;case"fv":Ua.uniform3fv(m,l);break;case"v2v":for(void 0===g._array&&(g._array=new Float32Array(2*l.length)),h=0,i=l.length;h<i;h++)d=2*h,g._array[d]=l[h].x,g._array[d+1]=l[h].y;Ua.uniform2fv(m,g._array);break;case"v3v":for(void 0===g._array&&(g._array=new Float32Array(3*l.length)),h=0,i=l.length;h<i;h++)d=3*h,g._array[d]=l[h].x,g._array[d+1]=l[h].y,g._array[d+2]=l[h].z;Ua.uniform3fv(m,g._array);break;case"v4v":for(void 0===g._array&&(g._array=new Float32Array(4*l.length)),h=0,i=l.length;h<i;h++)d=4*h,g._array[d]=l[h].x,g._array[d+1]=l[h].y,g._array[d+2]=l[h].z,g._array[d+3]=l[h].w;Ua.uniform4fv(m,g._array);break;case"m3":Ua.uniformMatrix3fv(m,!1,l.elements);break;case"m3v":for(void 0===g._array&&(g._array=new Float32Array(9*l.length)),h=0,i=l.length;h<i;h++)l[h].flattenToArrayOffset(g._array,9*h);Ua.uniformMatrix3fv(m,!1,g._array);break;case"m4":Ua.uniformMatrix4fv(m,!1,l.elements);break;case"m4v":for(void 0===g._array&&(g._array=new Float32Array(16*l.length)),h=0,i=l.length;h<i;h++)l[h].flattenToArrayOffset(g._array,16*h);Ua.uniformMatrix4fv(m,!1,g._array);break;case"t":if(b=l,c=na(),Ua.uniform1i(m,c),!b){Ua.activeTexture(Ua.TEXTURE0+c),Ua.bindTexture(Ua.TEXTURE_2D,Kb.__webglTexture);continue}Array.isArray(b.image)&&6===b.image.length||b instanceof k.CubeTexture?b.needsUpdate?ta(b,c):(Ua.activeTexture(Ua.TEXTURE0+c),Ua.bindTexture(Ua.TEXTURE_CUBE_MAP,b.__webglTextureCube)):b instanceof k.WebGLRenderTargetCube?ua(b,c):Ya.setTexture(b,c);break;case"tv":for(void 0===g._array&&(g._array=[]),h=0,i=g.value.length;h<i;h++)g._array[h]=na();for(Ua.uniform1iv(m,g._array),h=0,i=g.value.length;h<i;h++)b=g.value[h],c=g._array[h],b&&Ya.setTexture(b,c);break;default:k.warn("THREE.WebGLRenderer: Unknown uniform type: "+j)}}}}function pa(a,b,c,d){a[b]=c.r*d,a[b+1]=c.g*d,a[b+2]=c.b*d}function qa(a){var b,c,d,e,f,g,h,i,j=0,l=0,m=0,n=sb,o=n.directional.colors,p=n.directional.positions,q=n.point.colors,r=n.point.positions,s=n.point.distances,t=n.spot.colors,u=n.spot.positions,v=n.spot.distances,w=n.spot.directions,x=n.spot.anglesCos,y=n.spot.exponents,z=n.hemi.skyColors,A=n.hemi.groundColors,B=n.hemi.positions,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0;for(b=0,c=a.length;b<c;b++)if(d=a[b],!d.onlyShadow)if(e=d.color,h=d.intensity,i=d.distance,d instanceof k.AmbientLight){if(!d.visible)continue;j+=e.r,l+=e.g,m+=e.b}else if(d instanceof k.DirectionalLight){if(G+=1,!d.visible)continue;qb.setFromMatrixPosition(d.matrixWorld),pb.setFromMatrixPosition(d.target.matrixWorld),qb.sub(pb),qb.normalize(),K=3*C,p[K]=qb.x,p[K+1]=qb.y,p[K+2]=qb.z,pa(o,K,e,h),C+=1}else if(d instanceof k.PointLight){if(H+=1,!d.visible)continue;L=3*D,pa(q,L,e,h),pb.setFromMatrixPosition(d.matrixWorld),r[L]=pb.x,r[L+1]=pb.y,r[L+2]=pb.z,s[D]=i,D+=1}else if(d instanceof k.SpotLight){if(I+=1,!d.visible)continue;M=3*E,pa(t,M,e,h),pb.setFromMatrixPosition(d.matrixWorld),u[M]=pb.x,u[M+1]=pb.y,u[M+2]=pb.z,v[E]=i,qb.copy(pb),pb.setFromMatrixPosition(d.target.matrixWorld),qb.sub(pb),qb.normalize(),w[M]=qb.x,w[M+1]=qb.y,w[M+2]=qb.z,x[E]=Math.cos(d.angle),y[E]=d.exponent,E+=1}else if(d instanceof k.HemisphereLight){if(J+=1,!d.visible)continue;qb.setFromMatrixPosition(d.matrixWorld),qb.normalize(),N=3*F,B[N]=qb.x,B[N+1]=qb.y,B[N+2]=qb.z,f=d.color,g=d.groundColor,pa(z,N,f,h),pa(A,N,g,h),F+=1}for(b=3*C,c=Math.max(o.length,3*G);b<c;b++)o[b]=0;for(b=3*D,c=Math.max(q.length,3*H);b<c;b++)q[b]=0;for(b=3*E,c=Math.max(t.length,3*I);b<c;b++)t[b]=0;for(b=3*F,c=Math.max(z.length,3*J);b<c;b++)z[b]=0;for(b=3*F,c=Math.max(A.length,3*J);b<c;b++)A[b]=0;n.directional.length=C,n.point.length=D,n.spot.length=E,n.hemi.length=F,n.ambient[0]=j,n.ambient[1]=l,n.ambient[2]=m}function ra(a,b,c){var d;c?(Ua.texParameteri(a,Ua.TEXTURE_WRAP_S,xa(b.wrapS)),Ua.texParameteri(a,Ua.TEXTURE_WRAP_T,xa(b.wrapT)),Ua.texParameteri(a,Ua.TEXTURE_MAG_FILTER,xa(b.magFilter)),Ua.texParameteri(a,Ua.TEXTURE_MIN_FILTER,xa(b.minFilter))):(Ua.texParameteri(a,Ua.TEXTURE_WRAP_S,Ua.CLAMP_TO_EDGE),Ua.texParameteri(a,Ua.TEXTURE_WRAP_T,Ua.CLAMP_TO_EDGE),b.wrapS===k.ClampToEdgeWrapping&&b.wrapT===k.ClampToEdgeWrapping||k.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+b.sourceFile+" )"),Ua.texParameteri(a,Ua.TEXTURE_MAG_FILTER,wa(b.magFilter)),Ua.texParameteri(a,Ua.TEXTURE_MIN_FILTER,wa(b.minFilter)),b.minFilter!==k.NearestFilter&&b.minFilter!==k.LinearFilter&&k.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+b.sourceFile+" )")),(d=vb.get("EXT_texture_filter_anisotropic"))&&b.type!==k.FloatType&&b.type!==k.HalfFloatType&&(b.anisotropy>1||b.__oldAnisotropy)&&(Ua.texParameterf(a,d.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,Ya.getMaxAnisotropy())),b.__oldAnisotropy=b.anisotropy)}function sa(a,b){if(a.width<=b&&a.height<=b)return a;var c=Math.max(a.width,a.height),d=Math.floor(a.width*b/c),e=Math.floor(a.height*b/c),f=document.createElement("canvas");return f.width=d,f.height=e,f.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d,e),f}function ta(a,b){if(6===a.image.length)if(a.needsUpdate){a.__webglTextureCube||(a.addEventListener("dispose",Sb),a.__webglTextureCube=Ua.createTexture(),Ya.info.memory.textures++),Ua.activeTexture(Ua.TEXTURE0+b),Ua.bindTexture(Ua.TEXTURE_CUBE_MAP,a.__webglTextureCube),Ua.pixelStorei(Ua.UNPACK_FLIP_Y_WEBGL,a.flipY);var c,d=a instanceof k.CompressedTexture,e=a.image[0]instanceof k.DataTexture,f=[];for(c=0;c<6;c++)!Ya.autoScaleCubemaps||d||e?f[c]=e?a.image[c].image:a.image[c]:f[c]=sa(a.image[c],Cb);var g=f[0],h=k.Math.isPowerOfTwo(g.width)&&k.Math.isPowerOfTwo(g.height),i=xa(a.format),j=xa(a.type);for(ra(Ua.TEXTURE_CUBE_MAP,a,h),c=0;c<6;c++)if(d)for(var l,m=f[c].mipmaps,n=0,o=m.length;n<o;n++)l=m[n],a.format!==k.RGBAFormat&&a.format!==k.RGBFormat?Lb().indexOf(i)>-1?Ua.compressedTexImage2D(Ua.TEXTURE_CUBE_MAP_POSITIVE_X+c,n,i,l.width,l.height,0,l.data):k.warn("Attempt to load unsupported compressed texture format"):Ua.texImage2D(Ua.TEXTURE_CUBE_MAP_POSITIVE_X+c,n,i,l.width,l.height,0,i,j,l.data);else e?Ua.texImage2D(Ua.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,i,f[c].width,f[c].height,0,i,j,f[c].data):Ua.texImage2D(Ua.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,i,i,j,f[c]);a.generateMipmaps&&h&&Ua.generateMipmap(Ua.TEXTURE_CUBE_MAP),a.needsUpdate=!1,a.onUpdate&&a.onUpdate()}else Ua.activeTexture(Ua.TEXTURE0+b),Ua.bindTexture(Ua.TEXTURE_CUBE_MAP,a.__webglTextureCube)}function ua(a,b){Ua.activeTexture(Ua.TEXTURE0+b),Ua.bindTexture(Ua.TEXTURE_CUBE_MAP,a.__webglTexture)}function va(a){Ua.bindTexture(Ua.TEXTURE_2D,a.__webglTexture),Ua.generateMipmap(Ua.TEXTURE_2D),Ua.bindTexture(Ua.TEXTURE_2D,null)}function wa(a){return a===k.NearestFilter||a===k.NearestMipMapNearestFilter||a===k.NearestMipMapLinearFilter?Ua.NEAREST:Ua.LINEAR}function xa(a){var b;if(a===k.RepeatWrapping)return Ua.REPEAT;if(a===k.ClampToEdgeWrapping)return Ua.CLAMP_TO_EDGE;if(a===k.MirroredRepeatWrapping)return Ua.MIRRORED_REPEAT;if(a===k.NearestFilter)return Ua.NEAREST;if(a===k.NearestMipMapNearestFilter)return Ua.NEAREST_MIPMAP_NEAREST;if(a===k.NearestMipMapLinearFilter)return Ua.NEAREST_MIPMAP_LINEAR;if(a===k.LinearFilter)return Ua.LINEAR;if(a===k.LinearMipMapNearestFilter)return Ua.LINEAR_MIPMAP_NEAREST;if(a===k.LinearMipMapLinearFilter)return Ua.LINEAR_MIPMAP_LINEAR;if(a===k.UnsignedByteType)return Ua.UNSIGNED_BYTE;if(a===k.UnsignedShort4444Type)return Ua.UNSIGNED_SHORT_4_4_4_4;if(a===k.UnsignedShort5551Type)return Ua.UNSIGNED_SHORT_5_5_5_1;if(a===k.UnsignedShort565Type)return Ua.UNSIGNED_SHORT_5_6_5;if(a===k.ByteType)return Ua.BYTE;if(a===k.ShortType)return Ua.SHORT;if(a===k.UnsignedShortType)return Ua.UNSIGNED_SHORT;if(a===k.IntType)return Ua.INT;if(a===k.UnsignedIntType)return Ua.UNSIGNED_INT;if(a===k.FloatType)return Ua.FLOAT;if(a===k.HalfFloatType)return 36193;if(a===k.AlphaFormat)return Ua.ALPHA;if(a===k.RGBFormat)return Ua.RGB;if(a===k.RGBAFormat)return Ua.RGBA;if(a===k.LuminanceFormat)return Ua.LUMINANCE;if(a===k.LuminanceAlphaFormat)return Ua.LUMINANCE_ALPHA;if(a===k.AddEquation)return Ua.FUNC_ADD;if(a===k.SubtractEquation)return Ua.FUNC_SUBTRACT;if(a===k.ReverseSubtractEquation)return Ua.FUNC_REVERSE_SUBTRACT;if(a===k.ZeroFactor)return Ua.ZERO;if(a===k.OneFactor)return Ua.ONE;if(a===k.SrcColorFactor)return Ua.SRC_COLOR;if(a===k.OneMinusSrcColorFactor)return Ua.ONE_MINUS_SRC_COLOR;if(a===k.SrcAlphaFactor)return Ua.SRC_ALPHA;if(a===k.OneMinusSrcAlphaFactor)return Ua.ONE_MINUS_SRC_ALPHA;if(a===k.DstAlphaFactor)return Ua.DST_ALPHA;if(a===k.OneMinusDstAlphaFactor)return Ua.ONE_MINUS_DST_ALPHA;if(a===k.DstColorFactor)return Ua.DST_COLOR;if(a===k.OneMinusDstColorFactor)return Ua.ONE_MINUS_DST_COLOR;if(a===k.SrcAlphaSaturateFactor)return Ua.SRC_ALPHA_SATURATE;if(null!==(b=vb.get("WEBGL_compressed_texture_s3tc"))){if(a===k.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===k.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===k.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===k.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(b=vb.get("WEBGL_compressed_texture_pvrtc"))){if(a===k.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===k.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===k.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===k.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(b=vb.get("EXT_blend_minmax"))){if(a===k.MinEquation)return b.MIN_EXT;if(a===k.MaxEquation)return b.MAX_EXT}return 0}function ya(a){for(var b=0,c=0,d=0,e=0,f=0,g=a.length;f<g;f++){var h=a[f];h.onlyShadow||(h instanceof k.DirectionalLight&&b++,h instanceof k.PointLight&&c++,h instanceof k.SpotLight&&d++,h instanceof k.HemisphereLight&&e++)}return{directional:b,point:c,spot:d,hemi:e}}k.log("THREE.WebGLRenderer",k.REVISION),a=a||{};var za=void 0!==a.canvas?a.canvas:document.createElement("canvas"),Aa=window.devicePixelRatio||1,Ba=void 0!==a.precision?a.precision:"highp",Ca=Ba,Da=void 0!==a.alpha&&a.alpha,Ea=void 0===a.premultipliedAlpha||a.premultipliedAlpha,Fa=void 0!==a.antialias&&a.antialias,Ga=void 0===a.stencil||a.stencil,Ha=void 0===a.preserveDrawingBuffer||a.preserveDrawingBuffer,Ia=void 0!==a.logarithmicDepthBuffer&&a.logarithmicDepthBuffer,Ja=!1,Ka=new k.Color(0),La=0,Ma=-1!=window.navigator.userAgent.indexOf("Firefox")&&-1!=window.navigator.userAgent.indexOf("Mac OS"),Na=[],Oa={},Pa=[],Qa=new k.Matrix4,Ra=new k.Matrix3,Sa=[],Ta=[];this.domElement=za,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Ua,Va,Wa,Xa,Ya=this,Za=[],$a=null,_a=null,ab=-1,bb=null,cb="",db=0,eb="",fb="",gb=0,hb=0,ib=0,jb=za.width,kb=za.height,lb={},mb=new k.Frustum,nb=new k.Matrix4,ob=new k.Matrix4,pb=new k.Vector3,qb=new k.Vector3,rb=!0,sb={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{
length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var tb={alpha:Da,premultipliedAlpha:Ea,antialias:Fa,stencil:Ga,preserveDrawingBuffer:Ha};if(null===(Ua=za.getContext("webgl",tb)||za.getContext("experimental-webgl",tb)))throw null!==za.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";0==Ua.getShaderPrecisionFormat(Ua.FRAGMENT_SHADER,Ua.HIGH_FLOAT).precision&&(Ca="mediump"),za.addEventListener("webglcontextlost",function(a){a.preventDefault(),yb(),xb(),Oa={},Ya.webglcontextlost&&Ya.webglcontextlost(a)},!1)}catch(a){return void k.error(a)}var ub=new i.WebGLState(Ua,xa);void 0===Ua.getShaderPrecisionFormat&&(Ua.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var vb=new k.WebGLExtensions(Ua);vb.get("OES_texture_float"),vb.get("OES_texture_float_linear"),vb.get("OES_texture_half_float"),vb.get("OES_texture_half_float_linear"),vb.get("OES_standard_derivatives"),vb.get("EXT_shader_texture_lod"),vb.get("EXT_texture_filter_anisotropic"),vb.get("WEBGL_compressed_texture_s3tc"),Va=vb.get("WEBGL_draw_buffers"),Wa=vb.get("ANGLE_instanced_arrays"),Xa=vb.get("OES_vertex_array_object"),Ia&&vb.get("EXT_frag_depth");var wb=function(a,b,c,d){!0===Ea&&(a*=d,b*=d,c*=d),Ua.clearColor(a,b,c,d)},xb=function(){Ua.clearColor(0,0,0,1),Ua.clearDepth(1),Ua.clearStencil(0),Ua.enable(Ua.DEPTH_TEST),Ua.depthFunc(Ua.LEQUAL),Ua.frontFace(Ua.CCW),Ua.cullFace(Ua.BACK),Ua.enable(Ua.CULL_FACE),Ua.enable(Ua.BLEND),Ua.blendEquation(Ua.FUNC_ADD),Ua.blendFunc(Ua.SRC_ALPHA,Ua.ONE_MINUS_SRC_ALPHA),Ua.viewport(hb,ib,jb,kb),wb(Ka.r,Ka.g,Ka.b,La)},yb=function(){$a=null,bb=null,cb="",ab=-1,rb=!0,ub.reset(),ub.disableUnusedAttributes()};xb(),this.context=Ua,this.state=ub;for(var zb=Ua.getParameter(Ua.MAX_TEXTURE_IMAGE_UNITS),Ab=Ua.getParameter(Ua.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Bb=Ua.getParameter(Ua.MAX_TEXTURE_SIZE),Cb=Ua.getParameter(Ua.MAX_CUBE_MAP_TEXTURE_SIZE),Db=Ab>0,Eb=Ua.getShaderPrecisionFormat(Ua.VERTEX_SHADER,Ua.HIGH_FLOAT),Fb=Ua.getShaderPrecisionFormat(Ua.VERTEX_SHADER,Ua.MEDIUM_FLOAT),Gb=Ua.getShaderPrecisionFormat(Ua.FRAGMENT_SHADER,Ua.HIGH_FLOAT),Hb=Ua.getShaderPrecisionFormat(Ua.FRAGMENT_SHADER,Ua.MEDIUM_FLOAT),Ib=new Uint8Array(16),Jb=0;Jb<4;Jb++)m?1===Jb||2===Jb?(Ib[4*Jb]=246,Ib[4*Jb+1]=140,Ib[4*Jb+2]=220):(Ib[4*Jb]=48,Ib[4*Jb+1]=195,Ib[4*Jb+2]=3):Ib[4*Jb]=Ib[4*Jb+1]=Ib[4*Jb+2]=0,Ib[4*Jb+3]=255;var Kb=new k.DataTexture(Ib,2,2,k.RGBAFormat,k.UnsignedByteType,k.UVMapping,k.RepeatWrapping,k.RepeatWrapping,k.NearestFilter,k.NearestFilter);Kb.needsUpdate=!0;var Lb=function(){var a;return function(){if(void 0!==a)return a;if(a=[],vb.get("WEBGL_compressed_texture_pvrtc")||vb.get("WEBGL_compressed_texture_s3tc"))for(var b=Ua.getParameter(Ua.COMPRESSED_TEXTURE_FORMATS),c=0;c<b.length;c++)a.push(b[c]);return a}}(),Mb=Eb.precision>0,Nb=Fb.precision>0;"highp"!==Ba||Mb||(Nb?(Ba="mediump",k.warn("WebGLRenderer: highp not supported, using mediump")):(Ba="lowp",k.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==Ba||Nb||(Ba="lowp",k.warn("WebGLRenderer: mediump not supported, using lowp")),Mb=Gb.precision>0,Nb=Hb.precision>0,"highp"!==Ca||Mb||(Nb?(Ca="mediump",k.warn("WebGLRenderer: highp not supported, using mediump")):(Ca="lowp",k.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==Ca||Nb||(Ca="lowp",k.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Ua},this.forceContextLoss=function(){vb.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return Db},this.supportsFloatTextures=function(){return vb.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return vb.get("OES_texture_half_float_linear")},this.supportsStandardDerivatives=function(){return vb.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return vb.get("WEBGL_compressed_texture_s3tc")},this.supportsMRT=function(){return!Ma&&Va},this.supportsInstancedArrays=function(){return!!Wa},this.supportsBlendMinMax=function(){return vb.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){var a;return function(){if(void 0!==a)return a;var b=vb.get("EXT_texture_filter_anisotropic");return a=null!==b?Ua.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPixelRatio=function(){return Aa},this.setPixelRatio=function(a){Aa=a},this.getCurrentFramebuffer=function(){return _a},this.setUseFragmentIdsInBuffer=function(a){Ja=a},this.setSize=function(a,b,c){za.width=a*Aa,za.height=b*Aa,!1!==c&&(za.style.width=a+"px",za.style.height=b+"px"),this.setViewport(0,0,a,b)},this.setViewport=function(a,b,c,d){hb=a*Aa,ib=b*Aa,jb=c*Aa,kb=d*Aa,Ua.viewport(hb,ib,jb,kb)};var Ob=!1;this.enableViewportOnOffscreenTargets=function(a){Ob=a};var Pb=[];this.pushViewport=function(){Pb.push(hb),Pb.push(ib),Pb.push(jb),Pb.push(kb)},this.popViewport=function(){var a=Pb.length-4;hb=Pb[a],ib=Pb[a+1],jb=Pb[a+2],kb=Pb[a+3],Ua.viewport(hb,ib,jb,kb),Pb.length=a},this.setScissor=function(a,b,c,d){Ua.scissor(a*Aa,b*Aa,c*Aa,d*Aa)},this.enableScissorTest=function(a){a?Ua.enable(Ua.SCISSOR_TEST):Ua.disable(Ua.SCISSOR_TEST)},this.getClearColor=function(){return Ka},this.setClearColor=function(a,b){Ka.set(a),La=void 0!==b?b:1,wb(Ka.r,Ka.g,Ka.b,La)},this.getClearAlpha=function(){return La},this.setClearAlpha=function(a){La=a,wb(Ka.r,Ka.g,Ka.b,La)},this.clear=function(a,b,c){var d=0;(void 0===a||a)&&(d|=Ua.COLOR_BUFFER_BIT),(void 0===b||b)&&(d|=Ua.DEPTH_BUFFER_BIT),(void 0===c||c)&&(d|=Ua.STENCIL_BUFFER_BIT),Ua.clear(d)},this.clearColor=function(){Ua.clear(Ua.COLOR_BUFFER_BIT)},this.clearDepth=function(){Ua.clear(Ua.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Ua.clear(Ua.STENCIL_BUFFER_BIT)},this.clearTarget=function(a,b,c,d){this.setRenderTarget(a),this.clear(b,c,d)},this.resetGLState=yb;var Qb=function a(b){b.target.traverse(function(b){b.removeEventListener("remove",a),W(b)})},Rb=function a(b){var c=b.target;c.removeEventListener("dispose",a),Wb(c)},Sb=function a(b){var c=b.target;c.removeEventListener("dispose",a),Xb(c),Ya.info.memory.textures--},Tb=function a(b){var c=b.target;c.removeEventListener("dispose",a),Yb(c),Ya.info.memory.textures--},Ub=function a(b){var c=b.target;c.removeEventListener("dispose",a),Zb(c)},Vb=function(a){if(void 0!==a.__webglVertexBuffer&&(Ua.deleteBuffer(a.__webglVertexBuffer),a.__webglVertexBuffer=void 0),void 0!==a.__webglNormalBuffer&&(Ua.deleteBuffer(a.__webglNormalBuffer),a.__webglNormalBuffer=void 0),void 0!==a.__webglTangentBuffer&&(Ua.deleteBuffer(a.__webglTangentBuffer),a.__webglTangentBuffer=void 0),void 0!==a.__webglColorBuffer&&(Ua.deleteBuffer(a.__webglColorBuffer),a.__webglColorBuffer=void 0),void 0!==a.__webglUVBuffer&&(Ua.deleteBuffer(a.__webglUVBuffer),a.__webglUVBuffer=void 0),void 0!==a.__webglUV2Buffer&&(Ua.deleteBuffer(a.__webglUV2Buffer),a.__webglUV2Buffer=void 0),void 0!==a.__webglSkinIndicesBuffer&&(Ua.deleteBuffer(a.__webglSkinIndicesBuffer),a.__webglSkinIndicesBuffer=void 0),void 0!==a.__webglSkinWeightsBuffer&&(Ua.deleteBuffer(a.__webglSkinWeightsBuffer),a.__webglSkinWeightsBuffer=void 0),void 0!==a.__webglFaceBuffer&&(Ua.deleteBuffer(a.__webglFaceBuffer),a.__webglFaceBuffer=void 0),void 0!==a.__webglLineBuffer&&(Ua.deleteBuffer(a.__webglLineBuffer),a.__webglLineBuffer=void 0),void 0!==a.__webglLineDistanceBuffer&&(Ua.deleteBuffer(a.__webglLineDistanceBuffer),a.__webglLineDistanceBuffer=void 0),void 0!==a.__webglCustomAttributesList){for(var b in a.__webglCustomAttributesList)Ua.deleteBuffer(a.__webglCustomAttributesList[b].buffer);a.__webglCustomAttributesList=void 0}Ya.info.memory.geometries--},Wb=function(a){a.__webglInit=void 0;var b,c,d,e;if(a instanceof k.BufferGeometry){if(void 0!==a.vbbuffer&&(Ua.deleteBuffer(a.vbbuffer),a.vbbuffer=void 0),void 0!==a.ibbuffer&&(Ua.deleteBuffer(a.ibbuffer),a.ibbuffer=void 0),void 0!==a.iblinesbuffer&&(Ua.deleteBuffer(a.iblinesbuffer),a.iblinesbuffer=void 0),a.vaos){for(b=0;b<a.vaos.length;b++)Xa.deleteVertexArrayOES(a.vaos[b].vao);a.vaos=void 0}var f=a.attributes;for(var g in f)void 0!==f[g].buffer&&(Ua.deleteBuffer(f[g].buffer),f[g].buffer=void 0);Ya.info.memory.geometries--}else{var h=cc[a.id];if(void 0!==h){for(b=0,c=h.length;b<c;b++){var i=h[b];if(void 0!==i.numMorphTargets){for(d=0,e=i.numMorphTargets;d<e;d++)Ua.deleteBuffer(i.__webglMorphTargetsBuffers[d]);delete i.__webglMorphTargetsBuffers}if(void 0!==i.numMorphNormals){for(d=0,e=i.numMorphNormals;d<e;d++)Ua.deleteBuffer(i.__webglMorphNormalsBuffers[d]);delete i.__webglMorphNormalsBuffers}Vb(i)}delete cc[a.id]}else Vb(a)}};this.deallocateGeometry=Wb;var Xb=function(a){if(a.__webglTextureCube)Ua.deleteTexture(a.__webglTextureCube),a.__webglTextureCube=void 0;else{if(!a.__webglInit)return;Ua.deleteTexture(a.__webglTexture),a.__webglInit=void 0,a.__webglTexture=void 0}},Yb=function(a){a&&a.__webglTexture&&(Ua.deleteTexture(a.__webglTexture),Ua.deleteFramebuffer(a.__webglFramebuffer),void 0!==a.__webglRenderbuffer&&Ua.deleteRenderbuffer(a.__webglRenderbuffer))},Zb=function(a){var b=!1;a.program=void 0,a.programs.forEach(function(a){var c;if(void 0!==a&&void 0!=(c=a.program)){var d,e,f;for(d=0,e=Za.length;d<e;d++)if((f=Za[d])&&f.program===c){f.usedTimes--,0===f.usedTimes&&(Za[d]=void 0,Ua.deleteProgram(c),Ya.info.memory.programs--,b=!0);break}}},!1),a.programs.length=0,b&&(Za=Za.filter(function(a){return void 0!==a}))};this.renderBufferDirect=function(a,b,c,d,e,f,g){if(!1!==d.visible&&(!d.isEdgeMaterial||e.iblines)){x(f.geometry);var h=_(a,b,c,d,f),i=e.attributes,j=!1,l=d.wireframe?1:0,m="direct_"+e.id+(g?"/"+g:"")+"_"+h.id+"_"+l;m!==cb&&(cb=m,j=!0);var n=z(d,h,e,g||0);if(j=j&&!n,j&&ub.initAttributes(),f instanceof k.Mesh){var o,p=i.index;if(p){var q,r,s=p.array?p.array:e.ib;d.isEdgeMaterial&&(p=i.indexlines,s=e.iblines),p.bytesPerItem?4===(r=p.bytesPerItem)&&vb.get("OES_element_index_uint"):r=s instanceof Uint32Array&&vb.get("OES_element_index_uint")?4:2,q=4===r?Ua.UNSIGNED_INT:Ua.UNSIGNED_SHORT;var t=d.isEdgeMaterial?null:e.offsets;t&&t.length>1&&(j=!0);var u=0;do{var v,w,y;t&&t.length?(v=t[u].index,w=t[u].start,y=t[u].count):(v=0,w=0,y=s.length),j&&B(d,h,e,v,p,g),o=Ua.TRIANGLES,e.isPoints?o=Ua.POINTS:(e.isLines||d.isEdgeMaterial)&&(o=Ua.LINES),e.numInstances?Wa.drawElementsInstancedANGLE(o,y,q,w*r,e.numInstances):Ua.drawElements(o,y,q,w*r)}while(t&&++u<t.length)}else{j&&B(d,h,e,0,void 0,g);var A=e.attributes.position;o=Ua.TRIANGLES,e.isPoints?o=Ua.POINTS:(e.isLines||d.isEdgeMaterial)&&(o=Ua.LINES),e.numInstances?Wa.drawArraysInstancedANGLE(o,0,A.array.length/3,e.numInstances):Ua.drawArrays(o,0,A.array.length/A.itemSize)}}else k.log("Only THREE.Mesh can be rendered by the Firefly renderer. Use THREE.Mesh to draw lines.");n&&Xa.bindVertexArrayOES(null)}},this.renderBuffer=function(a,b,c,d,e,f){function g(a,b,c,d,e,f){Ua.vertexAttribPointer(a,b,c,d,e,f),Wa&&Wa.vertexAttribDivisorANGLE(a,0)}if(!1!==d.visible){T(f);var h=_(a,b,c,d,f),i=h.attributes,j=!1,l=d.wireframe?1:0,m=e.id+"_"+h.id+"_"+l;if(m!==cb&&(cb=m,j=!0),j&&ub.initAttributes(),!d.morphTargets&&i.position>=0&&j&&(Ua.bindBuffer(Ua.ARRAY_BUFFER,e.__webglVertexBuffer),ub.enableAttribute(i.position),g(i.position,3,Ua.FLOAT,!1,0,0)),j){if(e.__webglCustomAttributesList)for(var n=0,o=e.__webglCustomAttributesList.length;n<o;n++){var p=e.__webglCustomAttributesList[n];i[p.buffer.belongsToAttribute]>=0&&(Ua.bindBuffer(Ua.ARRAY_BUFFER,p.buffer),ub.enableAttribute(i[p.buffer.belongsToAttribute]),g(i[p.buffer.belongsToAttribute],p.size,Ua.FLOAT,!1,0,0))}i.color>=0&&(f.geometry.colors.length>0||f.geometry.faces.length>0?(Ua.bindBuffer(Ua.ARRAY_BUFFER,e.__webglColorBuffer),ub.enableAttribute(i.color),g(i.color,3,Ua.FLOAT,!1,0,0)):d.defaultAttributeValues&&Ua.vertexAttrib3fv(i.color,d.defaultAttributeValues.color)),i.normal>=0&&(Ua.bindBuffer(Ua.ARRAY_BUFFER,e.__webglNormalBuffer),ub.enableAttribute(i.normal),g(i.normal,3,Ua.FLOAT,!1,0,0)),i.tangent>=0&&(Ua.bindBuffer(Ua.ARRAY_BUFFER,e.__webglTangentBuffer),ub.enableAttribute(i.tangent),g(i.tangent,4,Ua.FLOAT,!1,0,0)),i.uv>=0&&(f.geometry.faceVertexUvs[0]?(Ua.bindBuffer(Ua.ARRAY_BUFFER,e.__webglUVBuffer),ub.enableAttribute(i.uv),g(i.uv,2,Ua.FLOAT,!1,0,0)):d.defaultAttributeValues&&Ua.vertexAttrib2fv(i.uv,d.defaultAttributeValues.uv)),i.uv2>=0&&(f.geometry.faceVertexUvs[1]?(Ua.bindBuffer(Ua.ARRAY_BUFFER,e.__webglUV2Buffer),ub.enableAttribute(i.uv2),g(i.uv2,2,Ua.FLOAT,!1,0,0)):d.defaultAttributeValues&&Ua.vertexAttrib2fv(i.uv2,d.defaultAttributeValues.uv2)),i.lineDistance>=0&&(Ua.bindBuffer(Ua.ARRAY_BUFFER,e.__webglLineDistanceBuffer),ub.enableAttribute(i.lineDistance),g(i.lineDistance,1,Ua.FLOAT,!1,0,0))}if(ub.disableUnusedAttributes(),f instanceof k.Mesh){var q=e.__typeArray===Uint32Array?Ua.UNSIGNED_INT:Ua.UNSIGNED_SHORT;d.wireframe?(ub.setLineWidth(d.wireframeLinewidth*Aa),j&&Ua.bindBuffer(Ua.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),Ua.drawElements(Ua.LINES,e.__webglLineCount,q,0)):(j&&Ua.bindBuffer(Ua.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),Ua.drawElements(Ua.TRIANGLES,e.__webglFaceCount,q,0))}else if(f instanceof k.Line){var r=f.mode===k.LineStrip?Ua.LINE_STRIP:Ua.LINES;ub.setLineWidth(d.linewidth*Aa),Ua.drawArrays(r,0,e.__webglLineCount)}else f instanceof k.PointCloud&&Ua.drawArrays(Ua.POINTS,0,e.__webglPointCount)}},this.render=function(a,b,c,d,e){if(b instanceof k.Camera==!1)return void k.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");cb="",ab=-1,bb=null,void 0!==e&&(Na.length=0,rb=!0);var f=a.fog;!0===a.autoUpdate&&a.updateMatrixWorld(),void 0===b.parent&&b.updateMatrixWorld(),b.matrixWorldInverse.getInverse(b.matrixWorld),b.worldUpTransform?ob.multiplyMatrices(b.worldUpTransform,b.matrixWorld):ob.copy(b.matrixWorld),nb.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),mb.setFromMatrix(nb);var g=a instanceof h.RenderBatch&&a.renderImmediate;if(g||(Sa.length=0,Ta.length=0,G(a,!0===Ya.sortObjects,!0===a.forceVisible),!0===Ya.sortObjects&&(Sa.sort(D),Ta.sort(C))),rb&&(e&&e.length&&(Na=e.slice()),qa(Na)),this.setRenderTarget(c),this.resetGLState(),(this.autoClear||d)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),a.overrideMaterial){var i=a.overrideMaterial;$(i),g?M(a,"",b,Na,f,i):(I(Sa,b,Na,f,i),I(Ta,b,Na,f,i))}else g?M(a,"",b,Na,f,null):(ub.setBlending(k.NoBlending),I(Sa,b,Na,f,null),I(Ta,b,Na,f,null));c&&c.generateMipmaps&&c.minFilter!==k.NearestFilter&&c.minFilter!==k.LinearFilter&&va(c),this.resetGLState(),ub.setDepthTest(!0),ub.setDepthWrite(!0)},this.clearBlend=function(){ub.setBlending(k.NoBlending)},this.setProgramPrefix=function(a,b,c){db=a,eb=b,fb=c},this.getProgramPrefix=function(){return{programPrefix:db,vertexPrefix:eb,fragmentPrefix:fb}};var $b,_b,ac,bc,cc={},dc=0,ec={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"firefly_basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"firefly_phong",LineBasicMaterial:"firefly_basic",LineDashedMaterial:"dashed",PointCloudMaterial:"firefly_basic"};this.setFaceCulling=function(a,b){a===k.CullFaceNone?Ua.disable(Ua.CULL_FACE):(b===k.FrontFaceDirectionCW?Ua.frontFace(Ua.CW):Ua.frontFace(Ua.CCW),a===k.CullFaceBack?Ua.cullFace(Ua.BACK):a===k.CullFaceFront?Ua.cullFace(Ua.FRONT):Ua.cullFace(Ua.FRONT_AND_BACK),Ua.enable(Ua.CULL_FACE))},this.setMaterialFaces=function(a){ub.setDoubleSided(a.side===k.DoubleSide),ub.setFlipSided(a.side===k.BackSide)},this.uploadTexture=function(a){void 0===a.__webglInit&&(a.__webglInit=!0,a.addEventListener("dispose",Sb),a.__webglTexture=Ua.createTexture(),Ya.info.memory.textures++),Ua.bindTexture(Ua.TEXTURE_2D,a.__webglTexture),Ua.pixelStorei(Ua.UNPACK_FLIP_Y_WEBGL,a.flipY),Ua.pixelStorei(Ua.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),Ua.pixelStorei(Ua.UNPACK_ALIGNMENT,a.unpackAlignment),a.image=sa(a.image,Bb);var b=a.image,c=k.Math.isPowerOfTwo(b.width)&&k.Math.isPowerOfTwo(b.height),d=xa(a.format),e=xa(a.type);ra(Ua.TEXTURE_2D,a,c);var f,g,h,i=a.mipmaps;if(a instanceof k.DataTexture)if(i.length>0&&c){for(g=0,h=i.length;g<h;g++)f=i[g],Ua.texImage2D(Ua.TEXTURE_2D,g,d,f.width,f.height,0,d,e,f.data);a.generateMipmaps=!1}else Ua.texImage2D(Ua.TEXTURE_2D,0,d,b.width,b.height,0,d,e,b.data);else if(a instanceof k.CompressedTexture){for(g=0,h=i.length;g<h;g++)f=i[g],a.format!==k.RGBAFormat&&a.format!==k.RGBFormat?Lb().indexOf(d)>-1?Ua.compressedTexImage2D(Ua.TEXTURE_2D,g,d,f.width,f.height,0,f.data):k.warn("Attempt to load unsupported compressed texture format"):Ua.texImage2D(Ua.TEXTURE_2D,g,d,f.width,f.height,0,d,e,f.data);if(i.length>1&&Lb().indexOf(d)>-1)for(var j,l=f.width>>1,m=f.height>>1,n=i.length;l>=1||m>=1;)j=4==f.width&&4==f.height?f.data:new DataView(f.data.buffer,f.data.byteOffset,f.data.byteLength*(Math.max(l,4)*Math.max(m,4))/(f.width*f.height)),Ua.compressedTexImage2D(Ua.TEXTURE_2D,n,d,Math.max(l,1),Math.max(m,1),0,j),l>>=1,m>>=1,++n}else if(i.length>0&&c){for(g=0,h=i.length;g<h;g++)Ua.texImage2D(Ua.TEXTURE_2D,g,d,d,e,i[g]);a.generateMipmaps=!1}else Ua.texImage2D(Ua.TEXTURE_2D,0,d,d,e,a.image);a.generateMipmaps&&c&&Ua.generateMipmap(Ua.TEXTURE_2D),a.needsUpdate=!1,a.onUpdate&&a.onUpdate()},this.setTexture=function(a,b){Ua.activeTexture(Ua.TEXTURE0+b),a.needsUpdate?Ya.uploadTexture(a):a.__webglTexture?Ua.bindTexture(Ua.TEXTURE_2D,a.__webglTexture):Ua.bindTexture(Ua.TEXTURE_2D,Kb.__webglTexture)},Ya.uploadTexture(Kb),this.initFrameBufferMRT=function(a,b){var c=a[0],d=!1;if(c&&!c.__webglFramebuffer){void 0===c.depthBuffer&&(c.depthBuffer=!0),void 0===c.stencilBuffer&&(c.stencilBuffer=!0),c.__webglFramebuffer=Ua.createFramebuffer(),Ua.bindFramebuffer(Ua.FRAMEBUFFER,c.__webglFramebuffer);var e;c.shareDepthFrom?e=c.__webglRenderbuffer=c.shareDepthFrom.__webglRenderbuffer:(e=c.__webglRenderbuffer,c.depthBuffer&&!c.stencilBuffer?(e||(e=c.__webglRenderbuffer=Ua.createRenderbuffer()),Ua.bindRenderbuffer(Ua.RENDERBUFFER,e),Ua.renderbufferStorage(Ua.RENDERBUFFER,Ua.DEPTH_COMPONENT16,c.width,c.height)):c.depthBuffer&&c.stencilBuffer&&(e||(e=c.__webglRenderbuffer=Ua.createRenderbuffer()),Ua.bindRenderbuffer(Ua.RENDERBUFFER,e),Ua.renderbufferStorage(Ua.RENDERBUFFER,Ua.DEPTH_STENCIL,c.width,c.height))),c.depthBuffer&&!c.stencilBuffer?Ua.framebufferRenderbuffer(Ua.FRAMEBUFFER,Ua.DEPTH_ATTACHMENT,Ua.RENDERBUFFER,e):c.depthBuffer&&c.stencilBuffer&&Ua.framebufferRenderbuffer(Ua.FRAMEBUFFER,Ua.DEPTH_STENCIL_ATTACHMENT,Ua.RENDERBUFFER,e),d=!0}var f=_a;Ua.bindFramebuffer(Ua.FRAMEBUFFER,c.__webglFramebuffer);var g;for(g=0;g<a.length;g++){var h=a[g];if(h&&!h.__webglTexture){var i=k.Math.isPowerOfTwo(h.width)&&k.Math.isPowerOfTwo(h.height),j=xa(h.format),l=xa(h.type);h.addEventListener("dispose",Tb),h.__webglTexture=Ua.createTexture(),Ya.info.memory.textures++,Ua.bindTexture(Ua.TEXTURE_2D,h.__webglTexture),ra(Ua.TEXTURE_2D,h,i),Ua.texImage2D(Ua.TEXTURE_2D,0,j,h.width,h.height,0,j,l,null),i&&h.generateMipmaps&&Ua.generateMipmap(Ua.TEXTURE_2D)}Ua.framebufferTexture2D(Ua.FRAMEBUFFER,Ua.COLOR_ATTACHMENT0+g,Ua.TEXTURE_2D,h&&h.__webglTexture,0)}if(this.supportsMRT()){for(var m=Ua.getParameter(Va.MAX_COLOR_ATTACHMENTS_WEBGL);g<m;)Ua.framebufferTexture2D(Ua.FRAMEBUFFER,Ua.COLOR_ATTACHMENT0+g,Ua.TEXTURE_2D,null,0),g++;var n=[Va.COLOR_ATTACHMENT0_WEBGL];for(g=1;g<a.length;g++)n.push(Va.COLOR_ATTACHMENT0_WEBGL+g);Va.drawBuffersWEBGL(n)}if(b){var o=Ua.checkFramebufferStatus(Ua.FRAMEBUFFER);o!==Ua.FRAMEBUFFER_COMPLETE&&(k.log("Can't use multiple render targets. Falling back to two passes. "+o),f===c.__webglFramebuffer&&(f=_a=null),Ua.bindFramebuffer(Ua.FRAMEBUFFER,f),Ua.deleteFramebuffer(c.__webglFramebuffer),delete c.__webglFramebuffer,b=!1)}return Ua.bindFramebuffer(Ua.FRAMEBUFFER,f),d&&(Ua.bindTexture(Ua.TEXTURE_2D,null),Ua.bindRenderbuffer(Ua.RENDERBUFFER,null),Ua.bindFramebuffer(Ua.FRAMEBUFFER,null)),b},this.setRenderTarget=function(a){var b;if(Array.isArray(a))this.initFrameBufferMRT(a),b=a[0];else if(a){var c=a.__webglFramebuffer;c&&_a===c||this.initFrameBufferMRT([a]),b=a}var d,e,f,g,h;!b||Ob?(e=jb,f=kb,g=hb,h=ib):(e=b.width,f=b.height,g=0,h=0),(d=b?b.__webglFramebuffer:null)!==_a&&(Ua.bindFramebuffer(Ua.FRAMEBUFFER,d),Ua.viewport(g,h,e,f),_a=d)},this.verifyMRTWorks=function(a){return!!this.supportsMRT()&&this.initFrameBufferMRT(a,!0)},this.readRenderTargetPixels=function(a,b,c,d,e,f){if(!(a instanceof k.WebGLRenderTarget))return void k.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");if(a.__webglFramebuffer){if(a.format!==k.RGBAFormat&&a.format!==k.RGBFormat||a.type!==k.UnsignedByteType)return void k.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not a readable format.");var g=!1;a.__webglFramebuffer!==_a&&(Ua.bindFramebuffer(Ua.FRAMEBUFFER,a.__webglFramebuffer),g=!0),a.canReadPixels||Ua.checkFramebufferStatus(Ua.FRAMEBUFFER)===Ua.FRAMEBUFFER_COMPLETE?Ua.readPixels(b,c,d,e,Ua.RGBA,Ua.UNSIGNED_BYTE,f):k.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),g&&Ua.bindFramebuffer(Ua.FRAMEBUFFER,_a)}}}},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0}),b.WebGLState=void 0;var g=c(2);b.WebGLState=function(a){function b(a,c){function f(b){!0!==h[b]&&(a.enable(b),h[b]=!0)}function g(b){!1!==h[b]&&(a.disable(b),h[b]=!1)}d(this,b);var h={},i=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));i.buffers={stencil:function(){var b=!1,c=null,d=null,e=null,h=null,i=null,j=null,k=null,l=null;return{setTest:function(b){b?f(a.STENCIL_TEST):g(a.STENCIL_TEST)},setMask:function(d){c===d||b||(a.stencilMask(d),c=d)},setFunc:function(b,c,f){d===b&&e===c&&h===f||(a.stencilFunc(b,c,f),d=b,e=c,h=f)},setOp:function(b,c,d){i===b&&j===c&&k===d||(a.stencilOp(b,c,d),i=b,j=c,k=d)},setLocked:function(a){b=a},setClear:function(b){l!==b&&(a.clearStencil(b),l=b)},reset:function(){b=!1,c=null,d=null,e=null,h=null,i=null,j=null,k=null,l=null}}}()};var j=i.reset.bind(i);return i.reset=function(){this.buffers.stencil.reset(),j()},i}return f(b,a),b}(g.WebGLState)},function(a,b,c){"use strict";function d(a,b){this.vb=a.vb.buffer,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.ib=a.ib,this.stride=a.vbstride,this.vcount=this.vbf.length/this.stride,this.useInstancing=!!b}function e(a){this.bounds=a,this.point=new g.Vector4,this.point.z=0,this.point.w=1}Object.defineProperty(b,"__esModule",{value:!0}),b.VertexBufferReader=d,b.BoundsCallback=e;var f=c(2),g=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(f);Math.PI;d.prototype.getDbIdAt=function(a){return this.vbi[a*this.stride+7]},d.prototype.getVertexFlagsAt=function(a){return this.vbi[a*this.stride+8]},d.prototype.getLayerIndexAt=function(a){return 65535&this.vbi[a*this.stride+9]},d.prototype.getViewportIndexAt=function(a){return this.vbi[a*this.stride+9]>>16&65535},d.prototype.decodeLineAt=function(a,b,c,d){if(d.onLineSegment){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1],h=this.vbf[e+2],i=this.vbf[e+3],j=2*this.vbf[e+4],k=f+i*Math.cos(h),l=g+i*Math.sin(h);d.onLineSegment(f,g,k,l,c,j)}},d.prototype.decodeCircularArcAt=function(a,b,c,d){if(d.onCircularArc){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1],h=this.vbf[e+2],i=this.vbf[e+3],j=this.vbf[e+5];d.onCircularArc(f,g,h,i,j,c)}},d.prototype.decodeEllipticalArcAt=function(a,b,c,d){if(d.onEllipticalArc){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1],h=this.vbf[e+2],i=this.vbf[e+3],j=this.vbf[e+5],k=this.vbf[e+10],l=this.vbf[e+11];d.onEllipticalArc(f,g,h,i,j,k,l,c)}},d.prototype.decodeTexQuadAt=function(a,b,c,d){if(d.onTexQuad){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1],h=this.vbf[e+2],i=this.vbf[e+3],j=this.vbf[e+4];d.onTexQuad(f,g,i,j,h,c)}},d.prototype.decodeOneTriangleAt=function(a,b,c,d){if(d.onOneTriangle){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1],h=this.vbf[e+2],i=this.vbf[e+3],j=this.vbf[e+4],k=this.vbf[e+5];d.onOneTriangle(f,g,h,i,j,k,c)}},d.prototype.decodeTriangleIndexed=function(a,b,c,d,e,f){if(f.onOneTriangle){var g=this.stride*a,h=this.vbf[g],i=this.vbf[g+1];g=this.stride*b;var j=this.vbf[g],k=this.vbf[g+1];g=this.stride*c;var l=this.vbf[g],m=this.vbf[g+1];f.onOneTriangle(h,i,j,k,l,m,e)}},d.prototype.enumGeomsForObject=function(a,b){if(this.useInstancing)for(var c=0;c<this.vcount;){var d=this.getVertexFlagsAt(c),e=d>>8&255,f=this.getLayerIndexAt(c),g=this.getViewportIndexAt(c),h=this.getDbIdAt(c)===a;if(h)switch(e){case 1:this.decodeLineAt(c,f,g,b);break;case 2:this.decodeCircularArcAt(c,f,g,b);break;case 3:this.decodeEllipticalArcAt(c,f,g,b);break;case 4:this.decodeTexQuadAt(c,f,g,b);break;case 5:this.decodeOneTriangleAt(c,f,g,b)}c+=1}else for(var c=0;c<this.ib.length;){var i=this.ib[c],d=this.getVertexFlagsAt(i),e=d>>8&255,f=this.getLayerIndexAt(i),g=this.getViewportIndexAt(i),h=this.getDbIdAt(i)===a;if(0===e)h&&this.decodeTriangleIndexed(this.ib[c],this.ib[c+1],this.ib[c+2],f,g,b),c+=3;else{if(h)switch(e){case 1:this.decodeLineAt(i,f,g,b);break;case 2:this.decodeCircularArcAt(i,f,g,b);break;case 3:this.decodeEllipticalArcAt(i,f,g,b);break;case 4:this.decodeTexQuadAt(i,f,g,b);break;case 5:this.decodeOneTriangleAt(i,f,g,b)}c+=6}}},d.prototype.enumGeomsForVisibleLayer=function(a,b){if(this.useInstancing)for(var c=0;c<this.vcount;){var d=this.getVertexFlagsAt(c),e=d>>8&255,f=this.getLayerIndexAt(c),g=this.getViewportIndexAt(c),h=!a||0!==f&&-1!==a.indexOf(f);if(h)switch(e){case 1:this.decodeLineAt(c,f,g,b);break;case 2:this.decodeCircularArcAt(c,f,g,b);break;case 3:this.decodeEllipticalArcAt(c,f,g,b);break;case 4:this.decodeTexQuadAt(c,f,g,b);break;case 5:this.decodeOneTriangleAt(c,f,g,b)}c+=1}else for(var c=0;c<this.ib.length;){var i=this.ib[c],d=this.getVertexFlagsAt(i),e=d>>8&255,f=this.getLayerIndexAt(i),g=this.getViewportIndexAt(i),h=!a||0!==f&&-1!==a.indexOf(f);if(0===e)h&&this.decodeTriangleIndexed(this.ib[c],this.ib[c+1],this.ib[c+2],f,g,b),c+=3;else{if(h)switch(e){case 1:this.decodeLineAt(i,f,g,b);break;case 2:this.decodeCircularArcAt(i,f,g,b);break;case 3:this.decodeEllipticalArcAt(i,f,g,b);break;case 4:this.decodeTexQuadAt(i,f,g,b);break;case 5:this.decodeOneTriangleAt(i,f,g,b)}c+=6}}},e.prototype.onVertex=function(a,b,c){this.point.x=a,this.point.y=b,this.bounds.expandByPoint(this.point)},e.prototype.onLineSegment=function(a,b,c,d,e){this.onVertex(a,b),this.onVertex(c,d)},e.prototype.onCircularArc=function(a,b,c,d,e,f){this.onEllipticalArc(a,b,c,d,e,e,0,f)},e.prototype.onEllipticalArc=function(a,b,c,d,e,f,g,h){0==g?c<=0&&d>=2*Math.PI-1e-5?this.onTexQuad(a,b,2*e,2*f,g,h):(this.point.x=a+Math.cos(c)*e,this.point.y=b+Math.sin(c)*f,this.bounds.expandByPoint(this.point),this.point.x=a+Math.cos(d)*e,this.point.y=b+Math.sin(d)*f,this.bounds.expandByPoint(this.point),c>d&&(this.point.x=a+e,this.point.y=b,this.bounds.expandByPoint(this.point),c-=2*Math.PI),c<.5*Math.PI&&d>.5*Math.PI&&(this.point.x=a,this.point.y=b+f,this.bounds.expandByPoint(this.point)),c<Math.PI&&d>Math.PI&&(this.point.x=a-e,this.point.y=b,this.bounds.expandByPoint(this.point)),c<1.5*Math.PI&&d>1.5*Math.PI&&(this.point.x=a,this.point.y=b-f,this.bounds.expandByPoint(this.point))):this.onTexQuad(a,b,2*e,2*f,g,h)},e.prototype.onTexQuad=function(a,b,c,d,e,f){var h=.5*c,i=.5*c;if(0==e)this.onVertex(a-h,b-i),this.onVertex(a+h,b+i);else{var j=new g.Matrix4,k=new g.Matrix4;j.makeRotationZ(e),k.makeTranslation(a,b,0),k.multiply(j);for(var l=0;l<4;l++)this.point.x=l%2==1?h:-h,this.point.y=l>=2?i:-i,this.point.applyMatrix4(k),this.bounds.expandByPoint(this.point)}},e.prototype.onOneTriangle=function(a,b,c,d,e,f,g){this.onVertex(a,b),this.onVertex(c,d),this.onVertex(e,f)}},function(a,b,c){"use strict";function d(a,b){function c(a,b){var c=0|a.x*l,d=0|a.y*l,e=0|a.z*l,g=f[c];g||(f[c]=g={});var h=g[d];h||(g[d]=h={});var i=h[e];return void 0===i&&(h[e]=i=b),i}function d(a,b){var d=c(a,b);e[b]=d}var e=[],f={},h=1;if(a.boundingBox||b){var j=(new i.LmvBox3).copy(a.boundingBox||b),k=j.size();h=Math.max(k.x,Math.max(k.y,k.z))}var l=65536/h;return(0,g.enumMeshVertices)(a,d),e}function e(a,b){function c(a,b){d[3*b]=a.x,d[3*b+1]=a.y,d[3*b+2]=a.z}var d=new Float32Array(3*(0,g.getVertexCount)(a));return(0,g.enumMeshVertices)(a,c,b),d}function f(a,b,c,f){function i(a,b){b.x=n[3*a],b.y=n[3*a+1],b.z=n[3*a+2]}function j(a,b,c,d){i(a,q),i(b,r),i(c,s),r.sub(q),s.sub(q),r.cross(s),d.copy(r).normalize()}function k(a,b,c){var d=m[a],e=m[b],g=m[c];if(d!==e&&d!==g&&e!==g){var h=!1;if(d>e){var i=d;d=e,e=i,h=!0}var k=o[d];if(k){var l=k[e];if(void 0===l)k[e]=h?-c-1:c;else{if(f)p.push(a),p.push(b);else{j(a,b,c,t),l<0?j(e,d,m[-l-1],u):j(d,e,m[l],u);var n=t.dot(u);Math.abs(n)<.25&&(p.push(a),p.push(b))}delete k[e]}}else o[d]={},o[d][e]=c}}function l(a,b,c,d,e,f){k(d,e,f),k(e,f,d),k(f,d,e)}if(!a.isLines&&!a.iblines){var m=d(a,c),n=e(a,b),o={},p=[],q=new h.LmvVector3,r=new h.LmvVector3,s=new h.LmvVector3,t=new h.LmvVector3,u=new h.LmvVector3;(0,g.enumMeshTriangles)(a,l);for(var v in o)for(var w in o[v])p.push(parseInt(v)),p.push(parseInt(w));p.length>1&&(a.iblines=new Uint16Array(p.length),a.iblines.set(p))}}Object.defineProperty(b,"__esModule",{value:!0}),b.createWireframe=f;var g=c(118),h=c(119),i=c(122)},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(){function a(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d&&d.id===b)return d}return null}function b(a,b){void 0===a.avgFrameTime?a.avgFrameTime=b:a.avgFrameTime=.8*a.avgFrameTime+.2*b}function c(a,c,d){var e,f;for(e=0;e<a.length;e++){f=a[e];var g=f.boundingBox||f.getBoundingBox();f.cameraDistance=g.distanceToPoint(c.position)}var h=function(a,b){return b.cameraDistance-a.cameraDistance};a.sort(h);var i=performance.now();for(e=0;e<a.length;e++){f=a[e],d(f);var j=performance.now(),k=j-i;i=j,b(f,k)}}var d=!1,e=!1,f=0,i=[],n=[],o=[],p=new j.Box3,q=[],r=new h.FrustumIntersector,s=new j.Raycaster,t=performance,u=g.PAGEOUT_NONE;this.enableNonResumableFrames=!1,this.budgetForTransparent=.1;var v=!1,w=[],x=null;this.frustum=function(){return r},this.findModel=function(b){return a(i,b)},this.findHiddenModel=function(b){return a(q,b)},this.addModel=function(a){i.push(a),n.length=i.length,o.length=i.length,this.recomputeLinePrecision()},this.removeModel=function(a){var b=i.indexOf(a);return b>=0&&i.splice(b,1),n.length=i.length,o.length=i.length,this.recomputeLinePrecision(),b>=0},this.addHiddenModel=function(a){var b=q.indexOf(a);return b<0&&q.push(a),b<0},this.removeHiddenModel=function(a){var b=q.indexOf(a);return b>=0&&q.splice(b,1),b>=0},this.isEmpty=function(){return 0===i.length},this.needsRender=function(){return d},this.resetNeedsRender=function(){d=!1},this.recomputeLinePrecision=function(){for(var a=1,b=0,c=i.length;b<c;++b){var d=i[b].getData().bbox,e=j.Box3.prototype.getBoundingSphere.call(d).radius/1e3;a=Math.min(a,e)}s.linePrecision=a},this.frameResumePossible=function(){return!v},this.renderSome=function(a,g,h){for(var j,l,m=t.now(),p=0===f,q=this.budgetForTransparent*g;;){for(var r=0,s=null,y=0;y<n.length;y++){var z=n[y];l=i[y],z||(n[y]=z=l.nextBatch());if(v&&g<q){z&&!z.sortObjects&&(l.skipOpaqueShapes(),z=l.nextBatch())}null!==z&&(s||(r=y,s=z),z.renderImportance>s.renderImportance&&(r=y,s=z))}if(!s){e=!0
;for(var A=0;A<i.length;++A)if((l=i[A])&&l.is2d()&&!l.isLoadDone()&&!l.getFragmentList().onDemandLoadingEnabled()){e=!1;break}break}if(i[r].is2d()&&i[r].getFragmentList()&&i[r].getFragmentList().onDemandLoadingEnabled()){var B=o[r];s.drawOrderRender=B&&B.drawOrderRender<B.lastItem?s.start:s.lastItem,o[r]=s}if(n[r]=i[r].nextBatch(),f++,s.sortObjects&&v)w.push(s),g-=void 0===s.avgFrameTime?.05:s.avgFrameTime;else{a(s),s.hasOwnProperty("drawEnd")&&(s.drawEnd=s.lastItem),j=t.now();var C=j-m;m=j,b(s,C),g-=s.avgFrameTime}if(i[r].getFragmentList()&&i[r].getFragmentList().onDemandLoadingEnabled())for(var D,E=s.start,F=s.lastItem,G=i[r].getFragmentList().vizflags,H=s.getIndices();E<F;)D=H?H[E]:E,G[D]&k.MeshFlags.MESH_DRAWN&&(G[D]=(G[D]|k.MeshFlags.MESH_TRAVERSED)&~k.MeshFlags.MESH_DRAWN),++E;if(g<=0)break}var I=i[0].frameUpdatePaging(p,h);return(u!=I||i[0].needResumeNextFrame())&&(d=!0,u=I),w.length>0&&(c(w,x,a),w.length=0),g},this.reset=function(a,b,c,d,h){if(e=!1,f=0,this.resetNeedsRender(),r.reset(a,d),r.areaCullThreshold=g.PIXEL_CULLING_THRESHOLD,i.length){v=this.enableNonResumableFrames&&c==m.ResetFlags.RESET_RELOAD&&b===l.RenderFlags.RENDER_NORMAL,x=a;for(var j=0;j<i.length;j++)i[j].resetIterator(a,r,b,c,h),n[j]=i[j].nextBatch(),o[j]=null}},this.isDone=function(){return e||this.isEmpty()},this.setAllVisibility=function(a){for(var b=0;b<i.length;b++)i[b].setAllVisibility(a)},this.hideLines=function(a){for(var b=0;b<i.length;b++)i[b].hideLines(a)},this.hidePoints=function(a){for(var b=0;b<i.length;b++)i[b].hidePoints(a)},this.hasHighlighted=function(){for(var a=0;a<i.length;a++)if(i[a].hasHighlighted())return!0;return!1},this.areAllVisible=function(){for(var a=0;a<i.length;a++)if(!i[a].areAllVisible())return!1;return!0},this.areAll2D=function(){for(var a=0;a<i.length;a++)if(!i[a].is2d())return!1;return!0},this.areAll3D=function(){for(var a=0;a<i.length;a++)if(!i[a].is3d())return!1;return!0},this.invalidateVisibleBounds=function(){for(var a=0;a<i.length;a++)i[a].visibleBoundsDirty=!0},this.getVisibleBounds=function(a){if(1===i.length)return i[0].getVisibleBounds(a);p.makeEmpty();for(var b=0;b<i.length;b++)p.union(i[b].getVisibleBounds(a));return p},this.rayIntersect=function(a,b,c,d,e,f){s.set(a,b);var g;if(i.length>1){var h=[];if(e)for(g=0;g<e.length;g++){var j=this.findModel(e[g]);if(j){var k=d&&d[g],l=j.rayIntersect(s,c,k);l&&h.push(l)}}else for(g=0;g<i.length;g++)if(!i[g].is2d()){var l=i[g].rayIntersect(s,c,d,f);l&&h.push(l)}return h.length?(h.sort(function(a,b){return a.distance-b.distance}),h[0]):null}if(!i.length||i[0].is2d())return null;var j=i[0];return e&&-1===e.indexOf(j.id)?null:j.rayIntersect(s,c,d,f)},this.getRenderProgress=function(){return i[0].getRenderProgress()},this.getModels=function(){return i},this.getHiddenModels=function(){return q},this.getFragmentList=function(){return i[0].getFragmentList()},this.getGeometryList=function(){return i[0].getGeometryList()},this.getSceneCount=function(){return i[0].getSceneCount()},this.getGeomScenes=function(){return i[0].getGeomScenes()},this.geomPacksMissingLastFrame=function(){return i[0].geomPacksMissingLastFrame()},this.explode=function(a){if(i.length){for(var b=new j.Vector3,c=0;c<i.length;c++){var d=i[c],e=d.getData().instanceTree,f=d.getFragmentList(),g=d.getVisibleBounds(!0).center();if(a*=2,e&&e.nodeAccess.nodeBoxes&&0!==a){var h=a*(e.maxDepth-1)+1,k=0|h,l=h-k,m=new Float32Array(6);!function c(d,g,h,i,j,n,o,p){var q=2*a;g==k&&(q*=l),e.getNodeBox(d,m);var r=.5*(m[0]+m[3]),s=.5*(m[1]+m[4]),t=.5*(m[2]+m[5]);if(g>0&&g<=k){var u=(r-h)*q,v=(s-i)*q,w=(t-j)*q;n+=u,o+=v,p+=w}e.enumNodeChildren(d,function(a){c(a,g+1,r,s,t,n,o,p)},!1),b.x=n,b.y=o,b.z=p,e.enumNodeFragments(d,function(a){f.updateAnimTransform(a,null,null,b)},!1)}(e.getRootId(),0,g.x,g.y,g.x,0,0,0)}else for(var n=f.fragments.boxes,o=0,p=f.getCount();o<p;o++)if(0==a)f.updateAnimTransform(o);else{var q=6*o,r=.5*(n[q]+n[q+3]),s=.5*(n[q+1]+n[q+4]),t=.5*(n[q+2]+n[q+5]);b.x=a*(r-g.x),b.y=a*(s-g.y),b.z=a*(t-g.z),f.updateAnimTransform(o,null,null,b)}}this.invalidateVisibleBounds()}},this.update=function(a){for(var b=!1,c=0;c<i.length;c++){var d=i[c];b=b||d.update(a)}return b},this.hideModel=function(a){for(var b=0;b<i.length;b++){var c=i[b];if(c&&c.id===a)return this.removeModel(c),q.push(c),!0}return!1},this.showModel=function(a){for(var b=0;b<q.length;++b){var c=q[b];if(c&&c.id===a)return this.addModel(c),q.splice(b,1),!0}return!1},this.getMemoryInfo=function(){function a(a){for(var d=0;d<a.length;++d){var e=a[d].getMemoryInfo();e&&(b=e,c.limit+=e.limit,c.effectiveLimit+=e.effectiveLimit,c.loaded+=e.loaded)}}var b,c={limit:0,effectiveLimit:0,loaded:0};return a(i),a(q),b?c:null}}Object.defineProperty(b,"__esModule",{value:!0}),b.RenderScene=e;var f=c(6),g=d(f),h=c(120),i=c(2),j=d(i),k=c(115),l=c(121),m=c(138)},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1/0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0;this.l=a,this.b=b,this.r=c,this.t=d}function f(){function a(a){c[a]=[],d[a]=0}function b(a){a&&(a.dispose(),a.needsUpdate=!0)}var c={},d={};this.acquireShaderMaterial=function(b,e){c[e]||a(e);var f=c[e][d[e]];if(f){f.defines={};for(var g in b)f.uniforms[g].value=b[g].value}else f=new n.ShaderMaterial({uniforms:b,vertexShader:k.default,fragmentShader:i.default}),c[e][d[e]]=f;return d[e]++,f},this.reset=function(){for(var a in d)d[a]=0},this.dispose=function(){for(var a in c)for(var d=0;d<c[a].length;d++)b(c[a][d])}}function g(a,b){function c(){return 0!==A.x||0!==A.y}function d(a,b,c){c.position[a](A),c.target[a](A),c.updateMatrixWorld(!0),c.matrixWorldInverse.getInverse(c.matrixWorld),b.reset(c)}function g(a,b,c){var d=a.clone();d.position.z=b;var e={texture1:{type:"t",value:a.material.map},model:{type:"i",value:c},splitPosition:{type:"f",value:B*C*G}},f=I===o.SPLIT_VIEW,g=z.acquireShaderMaterial(e,"nonintersect"+(f?"split":""));return g.defines.SINGLE_MODEL=1,f&&(g.defines.SPLIT_VIEW=1),d.material=g,u.add(d),d}function h(a,b,c,d){a.offsetX=b.offsetX+(d.l-c.l)/c.width()*b.scaleX,a.offsetY=b.offsetY+(d.b-c.b)/c.height()*b.scaleY,a.scaleX=b.scaleX*d.width()/c.width(),a.scaleY=b.scaleY*d.height()/c.height()}function i(a,b,c,d,e){var f=a.rect,g=c.getIntersection(f);if(g){a.intersecStatus=K,a.intersec.union(g);var i=a.material.map,j=b.clone(),k=new l.UVTransform,m=j.geometry.uvTransform;g.equals(c)?(m.copyTo(k),g.equals(f)&&(a.intersecStatus=L)):(h(k,m,c,g),j.geometry=y.acquireQuadGeom(k));var p=new l.UVTransform;h(p,a.geometry.uvTransform,f,g),j.position.set(g.l,g.b,0),j.scale.set(g.width(),g.height(),1);var q=new n.Vector2,r=new n.Vector2;D&&(q.x=1/(1|d.image.width*G),q.y=1/(1|d.image.height*G),r.x=1/(1|i.image.width*G),r.y=1/(1|i.image.height*G));var s={texture1:{type:"t",value:d},texture2:{type:"t",value:i},uvTFa:{type:"v4",value:k.toVec4()},uvTFb:{type:"v4",value:p.toVec4()},highlight:{type:"i",value:e?E:F},splitPosition:{type:"f",value:B*C*G},resolution1:{type:"v2",value:q},resolution2:{type:"v2",value:r}},t=I===o.SPLIT_VIEW,v=z.acquireShaderMaterial(s,"intersection"+(t?"split":""));return t&&(v.defines.SPLIT_VIEW=1),D&&(v.defines.ADD_THICKENING=1),j.material=v,u.add(j),g}return null}function j(a){for(var b=0;b<a.children.length;b++){var c=a.children[b];c.intersecStatus=J,c.intersec=new e;var d=new n.Vector3;d.addVectors(c.position,A);var f=c.scale;c.rect=new e(d.x,d.y,d.x+f.x,d.y+f.y)}}function k(a,b){var e=c();H=.5*(b.far-b.near);var f=s.reset(a,b);e&&d("sub",a,b);var g=t.reset(a,b);return e&&d("add",a,b),m(!f||!g),f&&g}function m(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=s.getScene(),c=t.getScene();j(c);for(var d=0;d<b.children.length;d++){for(var f=J,h=b.children[d],k=h.tile,l=h.material.map,m=h.material.tile,n=h.position,o=h.scale,p=new e(n.x,n.y,n.x+o.x,n.y+o.y),q=new e,r=d<c.children.length?d:0,u=c.children.length,v=r;v<u;v++){var w=c.children[v],x=w.tile,y=w.material.tile,z=a&&(y.level!==m.level||k.level!==x.level||m.level<k.level||y.level<x.level),B=i(w,h,p,l,z);if(B&&(f=w.intersecStatus,q.union(B),f===L))break;r>0&&v===u-1&&(u=r,r=0,v=-1)}(f===J||f===K&&!p.equals(q))&&g(h,-.2*H,1)}for(var C=0;C<c.children.length;C++){var w=c.children[C];if(w.intersecStatus===J||w.intersecStatus===K&&!w.rect.equals(w.intersec)){g(w,-.1*H,2).position.add(A)}}}function p(a,b){s.reset(a,b),u=s.getScene().clone()}function q(a,b){var e=c();e&&d("sub",a,b),t.reset(a,b),u=t.getScene().clone(),u.position.copy(A),e&&d("add",a,b)}function r(a,b){k(a,b)}var s=a,t=b,u=new n.Scene,v=!0,w=!1,x=!0,y=new l.GeometryManager,z=new f,A=new n.Vector3,B=.5,C=0,D=!1,E=0,F=3,G=window.devicePixelRatio||1,H=0,I=o.NORMAL_DIFF,J=0,K=1,L=2;this.setDiffMode=function(a){I=a,w=!0},this.getDiffMode=function(){return I},this.getOffset=function(){return A},this.setOffset=function(a){A=a},this.setSplitPosition=function(a){B=a},this.rayCast=function(a,b){return null},this.getVisibleBounds=function(a,b){var c=new n.Box3,d=new n.Box3;s.getVisibleBounds(c,d),t.getVisibleBounds(a,b),a.union(c),b.union(d)};var M=0,N=0,O=!0;this.updateProgress=function(a){if(a)this.onProgress(100),M=0,O=!0;else{if(O)N=Date.now(),M=10,O=!1;else{var b=Date.now();M+=(M>60?10:5)*(b-N)/250,M=Math.min(95,M),N=b}this.onProgress(M)}},this.reset=function(a,b){v=!1;for(var c=0;c<u.children.length;c++){u.children[c].dispatchEvent({type:"removed"})}u.children.length=0,u.position.set(0,0,0),C=b.clientWidth,y.reset(),z.reset();var d=!0;switch(I){case o.NORMAL_DIFF:F=3,d=k(a,b);break;case o.MODEL_A_ONLY:p(a,b);break;case o.MODEL_B_ONLY:q(a,b);break;case o.SPLIT_VIEW:r(a,b);break;case o.HIGHLIGHT_A:F=1,d=k(a,b);break;case o.HIGHLIGHT_B:F=2,d=k(a,b)}x?d&&(this.onFirstSceneComplete&&this.onFirstSceneComplete(),x=!1):this.onProgress&&this.updateProgress(d)},this.nextBatch=function(){return v?null:(v=!0,u)},this.getScene=function(){return u},this.getSceneCount=function(){return 1},this.done=function(){return v},this.update=function(){return w?(w=!1,!0):s.update()||t.update()},this.dispose=function(){z.dispose(),y.dispose()},this.dtor=function(){this.dispose()}}Object.defineProperty(b,"__esModule",{value:!0}),b.LeafletDiffModes=void 0,b.LeafletDiffIterator=g;var h=c(185),i=d(h),j=c(186),k=d(j),l=c(137),m=c(2),n=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(m),o=b.LeafletDiffModes={NORMAL_DIFF:0,MODEL_A_ONLY:1,MODEL_B_ONLY:2,SPLIT_VIEW:3,HIGHLIGHT_A:4,HIGHLIGHT_B:5};e.prototype.width=function(){return this.r-this.l},e.prototype.height=function(){return this.t-this.b},e.prototype.getIntersection=function(a){var b=Math.max(this.l,a.l),c=Math.min(this.r,a.r),d=Math.max(this.b,a.b),f=Math.min(this.t,a.t);return c>b&&f>d?new e(b,d,c,f):null},e.prototype.equals=function(a){return this.l==a.l&&this.r==a.r&&this.t==a.t&&this.b==a.b},e.prototype.union=function(a){return this.l=Math.min(this.l,a.l),this.r=Math.max(this.r,a.r),this.b=Math.min(this.b,a.b),this.t=Math.max(this.t,a.t),this}},function(a,b){a.exports="#define HIGHLIGHT_NONE 0\n#define HIGHLIGHT_A 1\n#define HIGHLIGHT_B 2\n#define MIN_DIFF_VAL 0.5\n#define DIFF_THRESHOLD 0.1\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform float splitPosition;\nuniform int model;\nuniform int highlight;\nuniform vec2 resolution1;\nuniform vec2 resolution2;\nvarying vec2 vUvA;\nvarying vec2 vUvB;\nconst int BIT_COUNT = 2;\nint modi(int x, int y) {\n    return x - y * (x / y);\n}\nint and(int a, int b) {\n    int result = 0;\n    int n = 1;\n    for(int i = 0; i < BIT_COUNT; i++) {\n        if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\n            result += n;\n        }\n        a = a / 2;\n        b = b / 2;\n        n = n * 2;\n        if(!(a > 0 && b > 0)) {\n            break;\n        }\n    }\n    return result;\n}\nfloat toGrayscale(vec4 v) {\n    return dot(v.rgb, vec3(0.299, 0.587, 0.114));\n}\nvoid main() {\n#ifdef SINGLE_MODEL\n    vec4 tex = texture2D(texture1, vUvA);\n    #ifdef SPLIT_VIEW\n    if (model == 1 && gl_FragCoord.x < splitPosition ||\n        model == 2 && gl_FragCoord.x >= splitPosition) {\n        gl_FragColor = tex;\n    } else {\n        discard;\n    }\n    #else\n    float gray = toGrayscale(tex);\n    gl_FragColor.rgb = vec3(gray);\n    #endif\n#else\n    vec4 tex1 = texture2D(texture1, vUvA);\n    vec4 tex2 = texture2D(texture2, vUvB);\n    #ifdef SPLIT_VIEW\n    gl_FragColor = gl_FragCoord.x < splitPosition ? tex1 : tex2;\n    #else\n    float gray1 = toGrayscale(tex1);\n    float gray2 = toGrayscale(tex2);\n    float maxGray = min(gray1, gray2);\n    float delta = gray1 - gray2;\n    gl_FragColor.rgb = vec3(maxGray);\n    if (abs(delta) > DIFF_THRESHOLD) {\n        if (delta < 0.0 && and(highlight, HIGHLIGHT_A) == HIGHLIGHT_A) {\n            gl_FragColor = vec4(max(gray2, MIN_DIFF_VAL), 0.0, 0.0, 1.0);\n        } else if (delta > 0.0 && and(highlight, HIGHLIGHT_B) == HIGHLIGHT_B) {\n            gl_FragColor = vec4(0.0, 0.0, max(gray1, MIN_DIFF_VAL), 1.0);\n        }\n    }\n        #ifdef ADD_THICKENING\n    else {\n        bool found = false;\n        for (int i = 0; i < 3; i++) {\n            for (int j = 0; j < 3; j++) {\n                if (i != 1 && j != 1) {\n                    vec4 nTex1 = texture2D(texture1, vUvA + resolution1*vec2(i - 1, j - 1));\n                    vec4 nTex2 = texture2D(texture2, vUvB + resolution2*vec2(i - 1, j - 1));\n                    float nGray1 = toGrayscale(nTex1);\n                    float nGray2 = toGrayscale(nTex2);\n                    delta = nGray1 - nGray2;\n                    if (abs(delta) > DIFF_THRESHOLD) {\n                        if (delta < 0.0 && and(highlight, HIGHLIGHT_A) == HIGHLIGHT_A) {\n                            gl_FragColor = vec4(1.25*max(nGray2, MIN_DIFF_VAL), 0.25, 0.25, 1.0);\n                        } else if (delta > 0.0 && and(highlight, HIGHLIGHT_B) == HIGHLIGHT_B) {\n                            gl_FragColor = vec4(0.25, 0.25, 1.25*max(nGray1, MIN_DIFF_VAL), 1.0);\n                        }\n                        found = true;\n                        break;\n                    }\n                }\n            }\n            if (found) break;\n        }\n    }\n        #endif\n    #endif\n#endif\n}"},function(a,b){a.exports="varying vec2 vUvA;\nvarying vec2 vUvB;\nuniform vec4 uvTFa;\nuniform vec4 uvTFb;\nvoid main() {\n    vUvA = uv;\n#ifndef SINGLE_MODEL\n    float x = (uv.x - uvTFa.x) / uvTFa.z;\n    float y = (uv.y - uvTFa.y) / uvTFa.w;\n    vUvB.x = uvTFb.x + x*uvTFb.z;\n    vUvB.y = uvTFb.y + y*uvTFb.w;\n#endif\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.SelectionMode={LEAF_OBJECT:0,FIRST_OBJECT:1,LAST_OBJECT:2}},function(a,b,c){"use strict";function d(a,b,c){this.nodeAccess=a,this.maxDepth=c,this.objectCount=b,this.numHidden=0,this.numOff=0,this.fragList=null}Object.defineProperty(b,"__esModule",{value:!0}),b.InstanceTree=d;var e=c(187),f=c(8);d.prototype.setFlagNode=function(a,b,c){var d=this.nodeAccess.getNodeFlags(a);return!!(d&b)!=c&&(c?this.nodeAccess.setNodeFlags(a,d|b):this.nodeAccess.setNodeFlags(a,d&~b),!0)},d.prototype.setFlagGlobal=function(a,b){var c=this.nodeAccess,d=0,e=c.numNodes;if(b)for(;d<e;d++)c.setNodeFlags(d,c.getNodeFlags(d)|a);else for(var f=~a;d<e;d++)c.setNodeFlags(d,c.getNodeFlags(d)&f)},d.prototype.setNodeOff=function(a,b){var c=this.setFlagNode(a,1073741824,b);return c&&(b?this.numOff++:this.numOff--),c},d.prototype.isNodeOff=function(a){return!!(1073741824&this.nodeAccess.getNodeFlags(a))},d.prototype.setNodeHidden=function(a,b){var c=this.setFlagNode(a,2147483648,b);return c&&(b?this.numHidden++:this.numHidden--),c},d.prototype.isNodeHidden=function(a){return!!(2147483648&this.nodeAccess.getNodeFlags(a))},d.prototype.getNodeType=function(a){return 7&this.nodeAccess.getNodeFlags(a)},d.prototype.isNodeSelectable=function(a){return!(536870912&this.nodeAccess.getNodeFlags(a))},d.prototype.getNodeParentId=function(a){return this.nodeAccess.getParentId(a)},d.prototype.getRootId=function(){return this.nodeAccess.rootId},d.prototype.getNodeName=function(a){return this.nodeAccess.name(a)},d.prototype.getChildCount=function(a){return this.nodeAccess.getNumChildren(a)};var g=new Array(6);d.prototype.getNodeBox=function(a,b){if(this.nodeAccess.nodeBoxes)return void this.nodeAccess.getNodeBox(a,b);var c=this.fragList;if(c)return b[0]=b[1]=b[2]=1/0,b[3]=b[4]=b[5]=-1/0,void this.enumNodeFragments(a,function(a){c.getOriginalWorldBounds(a,g),b[0]=Math.min(b[0],g[0]),b[1]=Math.min(b[1],g[1]),b[2]=Math.min(b[2],g[2]),b[3]=Math.max(b[3],g[3]),b[4]=Math.max(b[4],g[4]),b[5]=Math.max(b[5],g[5])},!0);f.logger.error("getNodeBox() requires fragBoxes or nodeBoxes")},d.prototype.getNodeIndex=function(a){return this.nodeAccess.getIndex(a)},d.prototype.enumNodeFragments=function(a,b,c){function d(a){var e=f.nodeAccess.enumNodeFragments(a,b);return e||(c&&(e=f.enumNodeChildren(a,function(a){return d(a)}))?e:void 0)}var e;"number"==typeof a?e=a:a&&(e=a.dbId);var f=this;return d(e)},d.prototype.enumNodeChildren=function(a,b,c){function d(a){var e=f.nodeAccess.enumNodeChildren(a,function(a){return b(a)?a:c?d(a):void 0});if(e)return e}var e;"number"==typeof a?e=a:a&&(e=a.dbId);var f=this;return c&&b(e)?e:d(e)},d.prototype.findNodeForSelection=function(a,b){if(b===e.SelectionMode.LEAF_OBJECT)return a;var c,d,f=a;if(b===e.SelectionMode.FIRST_OBJECT){var g=[];for(c=a;c;)g.push(c),c=this.getNodeParentId(c);for(var h=g.length-1;h>=0;h--)if(5!==(d=this.getNodeType(g[h]))&&2!==d&&3!==d){f=g[h];break}}else if(b===e.SelectionMode.LAST_OBJECT)for(c=a;c;){if(4===(d=this.getNodeType(c))){f=c;break}c=this.getNodeParentId(c)}return f},d.prototype.setFragmentList=function(a){this.fragList=a}},function(a,b){"use strict";function c(a){this.numOffs=0,this.numHidden=0;var b,c={};!function(a){function d(b){for(var c=0,d=a.length;c<d;c++){var e=a[c];Array.isArray(e)||(g[0]=e,e=g);for(var f=0;f<e.length;f++)b(c,e[f])}}var e=0,f=[],g=[0];d(function(a,b){var d=c[b];void 0===d&&(c[b]=d=f.length,f.push(0),f.push(0)),++f[d],++e}),b=new Uint32Array(e+f.length/2),b.fill(0);var h,i,j=0;for(h in c){i=c[h];var k=f[i],l=j+k+1;b[j]=k,f[i]=f[i+1]=j,j=l}var m=!1;d(function(a,d){var e=c[d],g=f[e+1]+1;g>b.length||b[g]?m||(console.error("DbidFragmentMap.buildMap: Internal error fragment overlap"),m=!0):(b[g]=a,f[e+1]=g)}),m=!1;for(h in c){i=c[h];var n=f[i+1]+1;n<b.length&&!b[n]&&(m||(console.error("DbidFragmentMap.buildMap: Internal error fragment underfilled"),m=!0))}for(h in c)i=c[h],c[h]=f[i]}(a),this.setFlagNode=function(a,d,e){if(!c.hasOwnProperty(a))return!1;var f=c[a];return!!(b[f]&d)!=e&&(e?b[f]|=d:b[f]&=~d,!0)},this.setNodeOff=function(a,b){var c=this.setFlagNode(a,d,b);return c&&(b?this.numOff++:this.numOff--),c},this.isNodeOff=function(a){var e=c[a];return!!(b[e]&d)},this.setNodeHidden=function(a,b){var c=this.setFlagNode(a,e,b);return c&&(b?this.numHidden++:this.numHidden--),c},this.isNodeHidden=function(a){var d=c[a];return!!(b[d]&e)},this.getRootId=function(){return g},this.enumNodeFragments=function(a,d){var e;"number"==typeof a?e=a:a&&(e=a.dbId);for(var g=c[e],h=(b[g]&f)+g+1;++g<h;)d(b[g],e)},this.enumNodeChildren=function(a,b,d){if(d&&b(a),a==g)for(var e in c)b(Number(e))}}Object.defineProperty(b,"__esModule",{value:!0}),b.DbidFragmentMap=c;var d=16777216,e=33554432,f=16777215,g=-1<<30},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){this.nodes=[],this.nextNode=0,this.children=[],this.nextChild=0,this.dbIdToIndex={},this.names=[],this.s2i={},this.strings=new j,this.nameSuffixes=[],this.getIndex(0)}function f(a){var b=new Int32Array(a.length);return b.set(a),b}function g(a,b,c){this.nodes=a.nodes,this.children=a.children,this.dbIdToIndex=a.dbIdToIndex,this.names=a.names,this.nameSuffixes=a.nameSuffixes,this.strings=new j(a.strings),this.rootId=b,this.numNodes=this.nodes.length/k,this.visibleIds=null,this.nodeBoxes=c}Object.defineProperty(b,"__esModule",{value:!0}),b.FlatStringStorage=void 0;var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();b.InstanceTreeStorage=e,b.InstanceTreeAccess=g;var i=c(14),j=b.FlatStringStorage=function(){function a(b){d(this,a),b?(this.buf=b.buf,this.idx=b.idx,this.next=b.next):(this.buf=new Uint8Array(256),this.next=0,this.idx=[0])}return h(a,[{key:"allocate",value:function(a){if(this.buf.length-this.next<a){var b=Math.max(3*this.buf.length/2,this.buf.length+a),c=new Uint8Array(b);c.set(this.buf),this.buf=c}}},{key:"add",value:function(a){if(null===a||void 0===a)return 0;if(!a.length)return this.idx.push(this.next),this.idx.length-1;var b=(0,i.utf16to8)(a,null);return this.allocate(b),this.next+=(0,i.utf16to8)(a,this.buf,this.next),this.idx.push(this.next),this.idx.length-1}},{key:"get",value:function(a){if(a){var b=this.idx[a-1],c=this.idx[a];return b===c?"":(0,i.utf8BlobToStr)(this.buf,b,c-b)}}},{key:"flatten",value:function(){this.idx=f(this.idx)}}]),a}(),k=5;e.prototype.getIndex=function(a){var b=this.dbIdToIndex[a];if(b)return b;b=this.nextNode++,this.nodes.push(a);for(var c=1;c<k;c++)this.nodes.push(0);return this.dbIdToIndex[a]=b,b},e.prototype.setNode=function(a,b,c,d,e,f){var g=this.getIndex(a),h=g*k,i=e.length,j=f&&f.length;j&&(i+=f.length),this.nodes[h+1]=b,this.nodes[h+2]=this.nextChild,this.nodes[h+3]=j?-i:i,this.nodes[h+4]=d;var l;for(l=0;l<e.length;l++)this.children[this.nextChild++]=this.getIndex(e[l]);if(j)for(l=0;l<f.length;l++)this.children[this.nextChild++]=-f[l]-1;this.nextChild>this.children.length&&console.error("Child index out of bounds -- should not happen"),this.processName(g,c)},e.prototype.processName=function(a,b){var c,d,e=-1,f=-1;if(b&&(f=b.lastIndexOf("]"),-1!==(e=b.lastIndexOf("["))&&-1!==f||(e=b.lastIndexOf(":"),f=b.length)),e>=0&&f>e){c=b.slice(0,e+1);var g=b.slice(e+1,f);d=parseInt(g,10),d&&d+""===g||(c=b,d=0)}else c=b,d=0;var h=this.s2i[c];void 0===h&&(h=this.strings.add(c),this.s2i[c]=h),this.names[a]=h,this.nameSuffixes[a]=d},e.prototype.flatten=function(a,b,c,d,e,g){this.nodes=f(this.nodes),this.children=f(this.children),this.names=f(this.names),this.nameSuffixes=f(this.nameSuffixes),this.strings.flatten(),this.s2i=null},g.prototype.getNumNodes=function(){return this.numNodes},g.prototype.getIndex=function(a){return this.dbIdToIndex[a]},g.prototype.name=function(a){var b=this.dbIdToIndex[a],c=this.strings.get(this.names[b]),d=this.nameSuffixes[b];if(d){return"["===c.charAt(c.length-1)?c+d+"]":c+d}return c},g.prototype.getParentId=function(a){var b=this.dbIdToIndex[a];return this.nodes[b*k+1]},g.prototype.getNodeFlags=function(a){var b=this.dbIdToIndex[a];return this.nodes[b*k+4]},g.prototype.setNodeFlags=function(a,b){var c=this.dbIdToIndex[a];c&&(this.nodes[c*k+4]=b)},g.prototype.getNumChildren=function(a){var b=this.dbIdToIndex[a],c=this.nodes[b*k+3];if(c>=0)return c;var d=this.nodes[b*k+2];c=Math.abs(c);for(var e=0,f=0;f<c;f++){if(this.children[d+f]<0)break;e++}return e},g.prototype.getNumFragments=function(a){var b=this.dbIdToIndex[a],c=this.nodes[b*k+3];if(c>=0)return 0;var d=this.nodes[b*k+2];c=Math.abs(c);for(var e=0,f=c-1;f>=0;f--){if(this.children[d+f]>=0)break;e++}return e},g.prototype.getNodeBox=function(a,b){for(var c=this.getIndex(a),d=6*c,e=0;e<6;e++)b[e]=this.nodeBoxes[d+e]},g.prototype.getVisibleIds=function(){return this.visibleIds||(this.visibleIds=Object.keys(this.dbIdToIndex).map(function(a){return parseInt(a)})),this.visibleIds},g.prototype.enumNodeChildren=function(a,b){var c=this.dbIdToIndex[a],d=this.nodes[c*k+2],e=this.nodes[c*k+3];e=Math.abs(e);for(var f=0;f<e;f++){var g=this.children[d+f];if(g<0)break;if(b(this.nodes[g*k+0],a,c))return a}},g.prototype.enumNodeFragments=function(a,b){var c=this.dbIdToIndex[a],d=this.nodes[c*k+2],e=this.nodes[c*k+3];if(e<0){e=-e;for(var f=0;f<e;f++){var g=this.children[d+f];if(!(g>0)&&b(-g-1,a,c))return a}}},g.prototype.computeBoxes=function(a){function b(a,b,c){var f=e.getIndex(a);d(a,f);for(var h=6*c,i=6*f,j=0;j<3;j++)g[h+j]>g[i+j]&&(g[h+j]=g[i+j]),g[h+j+3]<g[i+j+3]&&(g[h+j+3]=g[i+j+3])}function c(b,c,d){for(var e=6*b,f=6*d,h=0;h<3;h++)g[f+h]>a[e+h]&&(g[f+h]=a[e+h]),g[f+h+3]<a[e+h+3]&&(g[f+h+3]=a[e+h+3])}function d(a,d){var f=6*d;g[f]=g[f+1]=g[f+2]=1/0,g[f+3]=g[f+4]=g[f+5]=-1/0,e.getNumChildren(a)&&e.enumNodeChildren(a,b,!0),e.getNumFragments(a)&&e.enumNodeFragments(a,c)}this.nodeBoxes||(this.nodeBoxes=new Float32Array(6*this.numNodes));var e=this,f=e.getIndex(e.rootId),g=e.nodeBoxes;d(e.rootId,f)}},function(a,b){"use strict";function c(a,b){this.bytes_per_node=b?32:36;var c,d;a instanceof ArrayBuffer?(c=a.byteLength/this.bytes_per_node,d=a,this.nodeCount=c):(c=0|a,d=new ArrayBuffer(this.bytes_per_node*c),this.nodeCount=0),this.nodeCapacity=c,this.nodesRaw=d,this.is_lean_node=b,this.node_stride=this.bytes_per_node/4,this.node_stride_short=this.bytes_per_node/2,this.nodesF=new Float32Array(this.nodesRaw),this.nodesI=new Int32Array(this.nodesRaw),this.nodesS=new Uint16Array(this.nodesRaw)}function d(a,b){this.boxes=a.boxes,this.polygonCounts=a.polygonCounts,this.hasPolygonCounts=!!this.polygonCounts,this.materials=a.materials,this.materialDefs=b,this.count=a.length,this.boxStride=6,this.wantSort=!0}function e(a,b,c){this.finfo=c||new d(a,b),this.prim_count=this.finfo.getCount(),this.frags_per_leaf_node=-1,this.frags_per_inner_node=-1,this.nodes=null,this.work_buf=new ArrayBuffer(4*this.prim_count),this.sort_prims=new Int32Array(this.work_buf),this.primitives=new Int32Array(this.prim_count),this.centroids=new Float32Array(f*this.prim_count),this.boxv_o=new Float32Array(6),this.boxc_o=new Float32Array(6),this.boxv_t=new Float32Array(6),this.boxc_t=new Float32Array(6),this.recursion_stack=[]}Object.defineProperty(b,"__esModule",{value:!0}),b.NodeArray=c,b.BVHBuilder=e,c.prototype.setLeftChild=function(a,b){this.nodesI[a*this.node_stride+6]=b},c.prototype.getLeftChild=function(a){return this.nodesI[a*this.node_stride+6]},c.prototype.setPrimStart=function(a,b){this.is_lean_node?this.nodesI[a*this.node_stride+6]=b:this.nodesI[a*this.node_stride+8]=b},c.prototype.getPrimStart=function(a){return this.is_lean_node?this.nodesI[a*this.node_stride+6]:this.nodesI[a*this.node_stride+8]},c.prototype.setPrimCount=function(a,b){this.nodesS[a*this.node_stride_short+14]=b},c.prototype.getPrimCount=function(a){return this.nodesS[a*this.node_stride_short+14]},c.prototype.setFlags=function(a,b,c,d){this.nodesS[a*this.node_stride_short+15]=d<<3|c<<2|3&b},c.prototype.getFlags=function(a){return this.nodesS[a*this.node_stride_short+15]},c.prototype.setBox0=function(a,b){var c=a*this.node_stride,d=this.nodesF;d[c]=b[0],d[c+1]=b[1],d[c+2]=b[2],d[c+3]=b[3],d[c+4]=b[4],d[c+5]=b[5]},c.prototype.getBoxThree=function(a,b){var c=a*this.node_stride,d=this.nodesF;b.min.x=d[c],b.min.y=d[c+1],b.min.z=d[c+2],b.max.x=d[c+3],b.max.y=d[c+4],b.max.z=d[c+5]},c.prototype.getBoxArray=function(a,b,c){var d=a*this.node_stride,e=this.nodesF;c=c||0,b[0+c]=e[d],b[1+c]=e[d+1],b[2+c]=e[d+2],b[3+c]=e[d+3],b[4+c]=e[d+4],b[5+c]=e[d+5]},c.prototype.setBoxThree=function(a,b){var c=a*this.node_stride,d=this.nodesF;d[c]=b.min.x,d[c+1]=b.min.y,d[c+2]=b.min.z,d[c+3]=b.max.x,d[c+4]=b.max.y,d[c+5]=b.max.z},c.prototype.makeEmpty=function(a){var b=a*this.node_stride,c=this.nodesI;c[b+6]=-1,c[b+7]=0,this.is_lean_node||(c[b+8]=-1)},c.prototype.realloc=function(a){if(this.nodeCount+a>this.nodeCapacity){var b=0|3*this.nodeCapacity/2;b<this.nodeCount+a&&(b=this.nodeCount+a);var c=new ArrayBuffer(b*this.bytes_per_node),d=new Int32Array(c);d.set(this.nodesI),this.nodeCapacity=b,this.nodesRaw=c,this.nodesF=new Float32Array(c),this.nodesI=d,this.nodesS=new Uint16Array(c)}},c.prototype.nextNodes=function(a){this.realloc(a);var b=this.nodeCount;this.nodeCount+=a;for(var c=0;c<a;c++)this.makeEmpty(b+c);return b},c.prototype.getRawData=function(){return this.nodesRaw.slice(0,this.nodeCount*this.bytes_per_node)};var f=3,g=1e-5,h=1e-5,i=15,j=16,k=function(){function a(a,b,c,d){a[b]=.5*(c[d]+c[d+3]),a[b+1]=.5*(c[d+1]+c[d+4]),a[b+2]=.5*(c[d+2]+c[d+5])}function b(a,b,c){a[0]>b[c]&&(a[0]=b[c]),a[3]<b[c]&&(a[3]=b[c]),a[1]>b[c+1]&&(a[1]=b[c+1]),a[4]<b[c+1]&&(a[4]=b[c+1]),a[2]>b[c+2]&&(a[2]=b[c+2]),a[5]<b[c+2]&&(a[5]=b[c+2])}function c(a,b,c){a[0]>b[c]&&(a[0]=b[c]),a[1]>b[c+1]&&(a[1]=b[c+1]),a[2]>b[c+2]&&(a[2]=b[c+2]),a[3]<b[c+3]&&(a[3]=b[c+3]),a[4]<b[c+4]&&(a[4]=b[c+4]),a[5]<b[c+5]&&(a[5]=b[c+5])}function d(a,b){a[0]>b[0]&&(a[0]=b[0]),a[1]>b[1]&&(a[1]=b[1]),a[2]>b[2]&&(a[2]=b[2]),a[3]<b[3]&&(a[3]=b[3]),a[4]<b[4]&&(a[4]=b[4]),a[5]<b[5]&&(a[5]=b[5])}function e(a,b,c,d){for(var e=0;e<3;e++)a[b+e]=c[d+3+e]-c[d+e]}function f(a,b){a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5]}function k(a){a[0]=w,a[1]=w,a[2]=w,a[3]=-w,a[4]=-w,a[5]=-w}function l(a,b){var c=a[b+3]-a[b],d=a[b+4]-a[b+1],e=a[b+5]-a[b+2];return c<0||d<0||e<0?0:2*(c*d+d*e+e*c)}function m(a){var b=a[3]-a[0],c=a[4]-a[1],d=a[5]-a[2];return b<0||c<0||d<0?0:2*(b*c+c*d+d*b)}function n(){this.vb_left=new Float32Array(6),this.vb_right=new Float32Array(6),this.cb_left=new Float32Array(6),this.cb_right=new Float32Array(6),this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1}function o(){this.box_bbox=new Float32Array(6),this.box_centroid=new Float32Array(6),this.num_prims=0}function p(){this.BL=new Float32Array(6),this.CL=new Float32Array(6),this.NL=0,this.AL=0}function q(a,d,e,f,g,i,j){for(var k=a.centroids,l=a.primitives,m=a.finfo.boxes,n=a.finfo.boxStride,o=j*(1-h)/i[f],p=g[f],q=a.sort_prims,r=d;r<=e;r++){var s=0|l[r],t=o*(k[3*s+f]-p),u=0|t;u<0?u=0:u>=j&&(u=j-1),q[r]=u,y[u].num_prims++,c(y[u].box_bbox,m,s*n),b(y[u].box_centroid,k,3*s)}}function r(a,b,c,e,g,h,i){if(h[e]<a.scene_epsilon)return void(i.best_cost=1/0);var k=j;k>c-b+1&&(k=c-b+1);var l;for(l=0;l<k;l++)y[l].reset();for(l=0;l<k-1;l++)z[l].reset();i.num_bins=k,q(a,b,c,e,g,h,k),f(z[0].BL,y[0].box_bbox),f(z[0].CL,y[0].box_centroid),z[0].AL=m(z[0].BL),z[0].NL=y[0].num_prims;var n;for(l=1;l<k-1;l++){n=y[l];var o=z[l];f(o.BL,z[l-1].BL),d(o.BL,n.box_bbox),o.AL=m(o.BL),f(o.CL,z[l-1].CL),d(o.CL,n.box_centroid),o.NL=z[l-1].NL+n.num_prims}l=k-1,f(A,y[l].box_bbox),f(B,y[l].box_centroid);var p=m(A),r=y[l].num_prims,s=l,t=p*r+z[l-1].AL*z[l-1].NL;for(f(i.vb_right,A),f(i.cb_right,y[l].box_centroid),f(i.vb_left,z[l-1].BL),f(i.cb_left,z[l-1].CL),i.num_left=z[l-1].NL,l-=1;l>=1;l--){n=y[l],d(A,n.box_bbox),d(B,n.box_centroid),p=m(A),r+=n.num_prims;var u=p*r+z[l-1].AL*z[l-1].NL;u<=t&&(t=u,s=l,f(i.vb_right,A),f(i.cb_right,B),f(i.vb_left,z[l-1].BL),f(i.cb_left,z[l-1].CL),i.num_left=z[l-1].NL)}i.best_split=s,i.best_cost=t}function s(a,b,c,d,e,f,g){var h,i,j=a.primitives,k=a.sort_prims,l=0,m=0|b,n=0|g.best_split;for(h=b;h<=c;h++){var o=0|j[h];k[h]<n?j[m++]=o:k[l++]=o}for(i=0;i<l;i++)j[m+i]=k[i]}function t(a,c,d,f,g,h,i,j){var l=a.primitives,m=a.centroids,n=g-f+1;n>a.frags_per_inner_node&&(n=a.frags_per_inner_node),n>j&&(n=j),c.setPrimStart(d,f),c.setPrimCount(d,n),f+=n,k(h);for(var o=f;o<=g;o++)b(h,m,3*l[o]);e(i,0,h,0);var p=0;return i[1]>i[0]&&(p=1),i[2]>i[p]&&(p=2),p}function u(a,b,c,d,f,g,h,j){e(C,0,g,0);var k=a.nodes,l=h?a.frags_per_leaf_node_transparent:a.frags_per_leaf_node,m=h?a.frags_per_inner_node_transparent:a.frags_per_inner_node,o=a.max_polys_per_node,p=0;C[1]>C[0]&&(p=1),C[2]>C[p]&&(p=2),k.setBox0(b,f);var q=0,u=0,v=d-c+1;if(a.finfo.hasPolygonCounts&&a.frags_per_inner_node)for(var w=v<=a.frags_per_inner_node?d:c+a.frags_per_inner_node-1,x=c;x<=w&&(q+=a.finfo.getPolygonCount(a.primitives[x]),u++,!(q>o));x++);if(v<=l&&q<o||1===v||j>i||C[p]<a.scene_epsilon)return k.setLeftChild(b,-1),
k.setPrimStart(b,c),k.setPrimCount(b,d-c+1),void k.setFlags(b,0,0,h?1:0);m&&(p=t(a,k,b,c,d,g,C,u),c+=k.getPrimCount(b));var y=new n;if(r(a,c,d,p,g,C,y),y.num_bins<0)return void k.setPrimCount(b,k.getPrimCount(b)+d-c+1);s(a,c,d,p,g,C,y);var z=k.nextNodes(2),A=.5*(y.vb_left[3+p]+y.vb_left[p]),B=.5*(y.vb_right[3+p]+y.vb_right[p]);k.setFlags(b,p,A<B?0:1,h?1:0),k.setLeftChild(b,z),a.recursion_stack.push([a,z+1,c+y.num_left,d,y.vb_right,y.cb_right,h,j+1]),a.recursion_stack.push([a,z,c,c+y.num_left-1,y.vb_left,y.cb_left,h,j+1])}function v(d){var f=d.boxv_o,h=d.boxc_o,i=d.boxv_t,j=d.boxc_t;k(f),k(h),k(i),k(j);for(var l=d.centroids,m=d.finfo.boxes,n=d.finfo.boxStride,o=0,p=d.prim_count;o<p;o++){var q=d.primitives[o];a(l,3*q,m,n*q),o>=d.first_transparent?(b(j,l,3*q),c(i,m,n*q)):(b(h,l,3*q),c(f,m,n*q))}e(C,0,d.boxv_o,0);var r=Math.max(C[0],C[1],C[2]);d.scene_epsilon=g*r}var w=1/0;n.prototype.reset=function(){this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1},o.prototype.reset=function(){this.num_prims=0,k(this.box_bbox),k(this.box_centroid)},p.prototype.reset=function(){this.NL=0,this.AL=0,k(this.BL),k(this.CL)};var x,y=[];for(x=0;x<j;x++)y.push(new o);var z=[];for(x=0;x<j-1;x++)z.push(new p);var A=new Float32Array(6),B=new Float32Array(6),C=new Float32Array(3);return{bvh_subdivide:u,compute_boxes:v,box_area:l}}();d.prototype.getCount=function(){return this.count},d.prototype.isTransparent=function(a){return!(!this.materialDefs||!this.materialDefs[this.materials[a]])&&this.materialDefs[this.materials[a]].transparent},d.prototype.getPolygonCount=function(a){return this.polygonCounts[a]},e.prototype.sortPrimitives=function(a){var b,c,d=new Float32Array(this.work_buf),e=this.primitives,f=0,g=a;for(b=0,c=this.prim_count;b<c;b++){e[b]=b;var h=this.finfo.isTransparent(b);h&&f++,g?(d[b]=k.box_area(this.finfo.boxes,this.finfo.boxStride*b),h&&(d[b]=-d[b])):d[b]=h?-1:1}if(g)Array.prototype.sort.call(this.primitives,function(a,b){return d[b]-d[a]});else if(f&&f<this.prim_count){var i=new Int32Array(f),j=0,l=0;for(b=0,c=this.prim_count;b<c;b++)d[b]>=0?e[j++]=e[b]:i[l++]=e[b];e.set(i,this.prim_count-f)}this.first_transparent=this.prim_count-f},e.prototype.build=function(a){function b(b,c){a.hasOwnProperty(b)?e[b]=a[b]:e[b]=c}var d=a&&!!a.useSlimNodes,e=this;if(d)b("frags_per_leaf_node",1),b("frags_per_inner_node",0),b("frags_per_leaf_node_transparent",1),b("frags_per_inner_node_transparent",0),b("max_polys_per_node",1/0);else{var f=a.isWeakDevice?.5:1;b("frags_per_leaf_node",0|32*f),b("frags_per_inner_node",0|this.frags_per_leaf_node),b("frags_per_leaf_node_transparent",this.frags_per_leaf_node),b("frags_per_inner_node_transparent",0),b("max_polys_per_node",0|1e4*f)}if(this.nodes&&this.nodes.is_lean_node==d)this.nodes.nodeCount=0;else{for(var g=this.prim_count/this.frags_per_leaf_node,h=1;h<g;)h*=2;this.nodes=new c(h,!!a&&a.useSlimNodes)}this.sortPrimitives(this.finfo.wantSort),k.compute_boxes(this);var i=this.nodes.nextNodes(2);k.bvh_subdivide(this,i,0,this.first_transparent-1,this.boxv_o,this.boxc_o,!1,0);for(var j;this.recursion_stack.length;)j=this.recursion_stack.pop(),k.bvh_subdivide(j[0],j[1],j[2],j[3],j[4],j[5],j[6],j[7]);for(k.bvh_subdivide(this,i+1,this.first_transparent,this.prim_count-1,this.boxv_t,this.boxc_t,!0,0);this.recursion_stack.length;)j=this.recursion_stack.pop(),k.bvh_subdivide(j[0],j[1],j[2],j[3],j[4],j[5],j[6],j[7])}},function(a,b){"use strict";function c(a,b,c){var d=b||65536;this.FULL_COUNT=0|(c||32767),this.useInstancing=a,this.stride=12,this.vb=new ArrayBuffer(4*this.stride*(this.useInstancing?d/4:d)),this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.ib=this.useInstancing?null:new Uint16Array(d),this.reset(0)}Object.defineProperty(b,"__esModule",{value:!0}),b.VertexBufferBuilder=c;var d=2*Math.PI,e=[0,1,3,0,3,2];c.prototype.reset=function(a){this.vcount=a,this.icount=0,this.minx=this.miny=1/0,this.maxx=this.maxy=-1/0,this.dbIds={},this.numEllipticals=0,this.numCirculars=0,this.numTriangleGeoms=0},c.prototype.expandStride=function(){},c.prototype.addToBounds=function(a,b){a<this.minx&&(this.minx=a),a>this.maxx&&(this.maxx=a),b<this.miny&&(this.miny=b),b>this.maxy&&(this.maxy=b)},c.prototype.setCommonVertexAttribs=function(a,b,c,d,e,f,g,h){b&=255,c&=255,h&=255,f&=65535,g&=65535,this.vbi[a+8]=b|c<<8|h<<16,this.vbi[a+6]=d,this.vbi[a+7]=e,this.vbi[a+9]=f|g<<16,this.dbIds[e]=1},c.prototype.addVertexTriangleGeom=function(a,b,c,d,e,f,g,h,i,j){for(var k=this.vcount,l=this.vbf,m=this.useInstancing?1:4,n=0;n<m;n++){var o=(k+n)*this.stride;l[o]=a,l[o+1]=b,l[o+2]=c,l[o+3]=d,l[o+4]=e,l[o+5]=f,this.setCommonVertexAttribs(o,0+n,5,g,h,i,j,0),this.vcount++}return k},c.prototype.addVertexLine=function(a,b,c,d,e,f,g,h,i,j,k){for(var l=this.vcount,m=this.vbf,n=this.useInstancing?1:4,o=0;o<n;o++){var p=(l+o)*this.stride;m[p]=a,m[p+1]=b,m[p+2]=c,m[p+3]=d,m[p+4]=.5*f,m[p+5]=e,this.setCommonVertexAttribs(p,0+o,1,g,h,i,j,k),this.vcount++}return l},c.prototype.addVertexTexQuad=function(a,b,c,d,e,f,g,h,i){for(var j=this.vcount,k=this.vbf,l=this.useInstancing?1:4,m=0;m<l;m++){var n=(j+m)*this.stride;k[n]=a,k[n+1]=b,k[n+2]=e,k[n+3]=c,k[n+4]=d,this.setCommonVertexAttribs(n,0+m,4,f,g,h,i,0),this.vcount++}return j},c.prototype.addVertexArc=function(a,b,c,d,e,f,g,h,i,j,k,l){for(var m=this.vcount,n=this.vbf,o=e==f?2:3,p=this.useInstancing?1:4,q=0;q<p;q++){var r=(m+q)*this.stride;n[r]=a,n[r+1]=b,n[r+2]=c,n[r+3]=d,n[r+4]=.5*h,n[r+5]=e,3===o&&(n[r+10]=f,n[r+11]=g),this.setCommonVertexAttribs(r,0+q,o,i,j,k,l,0),this.vcount++}return m},c.prototype.addVertex=function(a,b,c,d,e,f){if(!this.useInstancing){var g=this.vcount,h=this.stride*g,i=this.vbf;return i[h]=a,i[h+1]=b,this.setCommonVertexAttribs(h,0,0,c,d,e,f,0),this.vcount++,g}},c.prototype.addVertexPolytriangle=function(a,b,c,d,e,f){this.useInstancing||(this.addVertex(a,b,c,d,e,f),this.addToBounds(a,b))},c.prototype.addIndices=function(a,b){if(!this.useInstancing){var c=this.ib,d=this.icount;if(d+a.length>=c.length){for(var e=new Uint16Array(2*Math.max(a.length,c.length)),f=0;f<d;++f)e[f]=c[f];this.ib=c=e}for(var f=0;f<a.length;++f)c[d+f]=b+a[f];this.icount+=a.length}},c.prototype.finalizeQuad=function(a){this.useInstancing||this.addIndices(e,a)},c.prototype.addSegment=function(a,b,c,d,e,f,g,h,i,j,k){var l=c-a,m=d-b,n=l||m?Math.atan2(m,l):0,o=l||m?Math.sqrt(l*l+m*m):0,p=this.addVertexLine(a,b,n,o,e,f,g,h,i,j,k);this.finalizeQuad(p),this.addToBounds(a,b),this.addToBounds(c,d)},c.prototype.addTriangleGeom=function(a,b,c,d,e,f,g,h,i,j){this.numTriangleGeoms++;var k=this.addVertexTriangleGeom(a,b,c,d,e,f,g,h,i,j);this.finalizeQuad(k),this.addToBounds(a,b),this.addToBounds(c,d),this.addToBounds(e,f)},c.prototype.addArc=function(a,b,c,e,g,h,i,j,k,l,m,n){g==h?this.numCirculars++:this.numEllipticals++;var o=f(c,e);c=o.start,e=o.end,0==c&&0==e&&(e=d);var p=Math.abs(c-e);if(p>1e-4&&Math.abs(p-d)>1e-4){var q=a+g*Math.cos(c),r=b+h*Math.sin(c);this.addSegment(q,r,q,r,0,j,k,l,m,n);var s=a+g*Math.cos(e),t=b+h*Math.sin(e);this.addSegment(s,t,s,t,0,j,k,l,m,n)}else this.addToBounds(a-g,b-h),this.addToBounds(a+g,b+h);var u=this.addVertexLine(a,b,0,1e-4,0,0,1,l,m,n);this.finalizeQuad(u);var v=this.addVertexArc(a,b,c,e,g,h,i,j,k,l,m,n);this.finalizeQuad(v);var p,q,r,s,t},c.prototype.addTexturedQuad=function(a,b,c,d,e,f,g,h,i){var j=this.addVertexTexQuad(a,b,c,d,e,f,g,h,i);this.finalizeQuad(j);var k=.5*Math.cos(e),l=.5*Math.sin(e),m=Math.abs(c*k)+Math.abs(d*l),n=Math.abs(c*l)+Math.abs(d*k);this.addToBounds(a-m,b-n),this.addToBounds(a+m,b+n)},c.prototype.isFull=function(a){a=a||3;var b=this.useInstancing?4:1;return this.vcount*b+a>this.FULL_COUNT},c.prototype.toMesh=function(){var a={};a.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4)),a.vbstride=this.stride;var b=this.useInstancing?1:0;if(a.vblayout={fields1:{offset:0,itemSize:3,bytesPerItem:4,divisor:b,normalize:!1},fields2:{offset:3,itemSize:3,bytesPerItem:4,divisor:b,normalize:!1},color4b:{offset:6,itemSize:4,bytesPerItem:1,divisor:b,normalize:!0},dbId4b:{offset:7,itemSize:4,bytesPerItem:1,divisor:b,normalize:!1},flags4b:{offset:8,itemSize:4,bytesPerItem:1,divisor:b,normalize:!1},layerVp4b:{offset:9,itemSize:4,bytesPerItem:1,divisor:b,normalize:!1}},this.stride>10&&(a.vblayout.extraParams={offset:10,itemSize:2,bytesPerItem:4,divisor:b,normalize:!1}),this.useInstancing){a.numInstances=this.vcount;var c=new Int32Array([0,1,2,3]);a.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,divisor:0,normalize:!1},a.vblayout.instFlags4b.array=c.buffer;a.indices=new Uint16Array(e)}else a.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount));a.dbIds=this.dbIds;var d=this.maxx-this.minx,f=this.maxy-this.miny,g=Math.max(d,f);a.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-g},max:{x:this.maxx,y:this.maxy,z:.001*g}};a.boundingSphere={center:{x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0},radius:.5*Math.sqrt(d*d+f*f)};return a};var f=function(a,b){function c(){function c(a,b){return Math.abs(a-b)<.001}c(a,0)&&(a=0),c(b,0)&&(b=0),c(a,d)&&(a=d),c(b,d)&&(b=d)}if(c(),a>b)for(;a>d;)a-=d,b-=d;else for(;b>d;)a-=d,b-=d;return c(),a<0&&b>0&&(a+=d),{start:a,end:b}}},function(a,b,c){"use strict";function d(a){var b=a[0];a[0]=a[1],a[1]=a[2],a[2]=b}function e(a){for(var b=[],c=0;c<a.length;c+=3)b.push([a[c],a[c+1],a[c+2]]);for(var c=0;c<b.length;c++)for(var e=b[c];e[0]>e[1]||e[0]>e[2];)d(e);b.sort(function(a,b){return a[0]-b[0]});var e=b[0],f=0;a[f]=e[0],a[f+1]=e[1]-e[0],a[f+2]=e[2]-e[0],f+=3;for(var c=1;c<b.length;c++,f+=3)e=b[c],a[f]=e[0]-b[c-1][0],a[f+1]=e[1]-e[0],a[f+2]=e[2]-e[0]}function f(a){for(var b=[],c=0;c<a.length;c+=2)b.push([a[c],a[c+1]]);for(var c=0;c<b.length;c++){var d=b[c];if(d[0]>d[1]){var e=d[0];d[0]=d[1],d[1]=e}}b.sort(function(a,b){return a[0]-b[0]});var d=b[0],f=0;a[f]=d[0],a[f+1]=d[1]-d[0],f+=2;for(var c=1;c<b.length;c++,f+=2)d=b[c],a[f]=d[0]-b[c-1][0],a[f+1]=d[1]-d[0]}function g(a){if(a.length){a[1]+=a[0],a[2]+=a[0];for(var b=3;b<a.length;b+=3)a[b]+=a[b-3],a[b+1]+=a[b],a[b+2]+=a[b]}}function h(a){if(a.length){a[1]+=a[0];for(var b=2;b<a.length;b+=2)a[b]+=a[b-2],a[b+1]+=a[b]}}function i(a){var b=w[a];return void 0!==b?b:0===a.indexOf("uv")?t.TextureUV:(console.warn("Unknown attribute name"),t.TextureUV)}function j(a){var b=x[a];return b||(console.error("Unknown vertex attribute"),t.TextureUV)}function k(a){var b=u.FLOAT,c=a.bytesPerItem||4;return 1===c?b=a.normalize?u.UBYTE_NORM:u.UBYTE:2===c&&(b=a.normalize?u.USHORT_NORM:u.USHORT),b<<4|15&a.itemSize}function l(a){var b=u.USHORT,c=a.bytesPerItem||2;return 1===c?b=u.UBYTE:2===c?b=u.USHORT:4===c&&(b=u.UINT),b<<4|15&a.itemSize}function m(){}function n(a){this.buffer=a,this.readOffset=0,this.meshFlag=0,this.numBuffers=0,this.numAttributes=0,this.bufferOffsets=[],this.attributes=[],this.buffers=[]}function o(a){var b=new m,c=[];if(!a.vb)return console.error("Unexpected non-interleaved vertex buffer"),null;c=[a.vb.byteLength,a.ib.byteLength],a.iblines&&c.push(a.iblines.byteLength);var d=Object.keys(a.attributes),g=0;a.isLines&&(g|=v.LINES),a.isWideLines&&(g|=v.WIDE_LINES),a.isPoints&&(g|=v.POINTS),b.beginHeader(g,d.length,c);for(var h=0;h<d.length;h++){var j=a.attributes[d[h]],k=i(d[h]);"index"===d[h]?b.addAttribute(k,j,0,1):"indexlines"===d[h]?b.addAttribute(k,j,0,2):b.addAttribute(k,j,a.vbstride,0)}b.endHeader();var l=Buffer.from(a.vb.buffer,a.vb.byteOffset,a.vb.byteLength);return b.addBuffer(l),a.isLines?f(a.ib):e(a.ib),l=Buffer.from(a.ib.buffer,a.ib.byteOffset,a.ib.byteLength),b.addBuffer(l),a.iblines&&(f(a.iblines),l=Buffer.from(a.iblines.buffer,a.iblines.byteOffset,a.iblines.byteLength),b.addBuffer(l)),b.end()}function p(a,b){var c=new n(a);if(!c.read())return console.error("Failed to parse OTG geometry"),null;for(var d={vblayout:{},vb:new Float32Array(c.buffers[0].buffer,c.buffers[0].byteOffset,c.buffers[0].byteLength/4),isLines:(3&c.meshFlag)===v.LINES,isWideLines:(3&c.meshFlag)===v.WIDE_LINES,isPoints:(3&c.meshFlag)===v.POINTS,boundingBox:z,boundingSphere:A},e=0;e<c.attributes.length;e++){var f=c.attributes[e];if(f.name===t.Index){var i=c.buffers[1];1===f.bytesPerItem?d.indices=i:2===f.bytesPerItem?d.indices=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/f.bytesPerItem):4===f.bytesPerItem&&(d.indices=new Uint32Array(i.buffer,i.byteOffset,i.byteLength/f.bytesPerItem)),d.isLines?h(d.indices):g(d.indices)}else if(f.name===t.IndexEdges){if(!b){var k=c.buffers[2];1===f.bytesPerItem?d.iblines=k:2===f.bytesPerItem?d.iblines=new Uint16Array(k.buffer,k.byteOffset,k.byteLength/f.bytesPerItem):4===f.bytesPerItem&&(d.iblines=new Uint32Array(k.buffer,k.byteOffset,k.byteLength/f.bytesPerItem)),h(d.iblines)}}else{var l=j(f.name);d.vbstride?d.vbstride!==f.itemStride&&console.error("Unexpected vertex buffer stride mismatch."):d.vbstride=f.itemStride,d.vblayout[l]={bytesPerItem:f.bytesPerItem,offset:f.itemOffset,normalize:f.normalize,itemSize:f.itemSize}}}return{mesh:d,packId:0,meshIndex:0}}Object.defineProperty(b,"__esModule",{value:!0}),b.serializeLmvBufferGeom=o,b.readLmvBufferGeom=p;var q=c(4),r=c(194),s=c(122),t={Index:0,IndexEdges:1,Position:2,Normal:3,TextureUV:4,Color:5},u={BYTE:0,SHORT:1,UBYTE:2,USHORT:3,BYTE_NORM:4,SHORT_NORM:5,UBYTE_NORM:6,USHORT_NORM:7,FLOAT:8,INT:9,UINT:10},v={TRIANGLES:0,LINES:1,POINTS:2,WIDE_LINES:3},w={position:t.Position,normal:t.Normal,index:t.Index,indexlines:t.IndexEdges,color:t.Color},x={};x[t.Position]="position",x[t.Normal]="normal",x[t.Index]="index",x[t.IndexEdges]="indexlines",x[t.Color]="color",x[t.TextureUV]="uv";var y={};y[u.BYTE]=1,y[u.SHORT]=2,y[u.UBYTE]=1,y[u.USHORT]=2,y[u.BYTE_NORM]=1,y[u.SHORT_NORM]=2,y[u.UBYTE_NORM]=1,y[u.USHORT_NORM]=2,y[u.FLOAT]=4,y[u.INT]=4,y[u.UINT]=4,m.prototype.beginHeader=function(a,b,c){var d=8,e=c.length;for(d+=4*(e-1),d+=5*b;d%4!=0;)d++;for(var f=0,g=0;g<c.length;g++)f+=c[g];this.buffer=new Buffer(d+f),this.writeOffset=0;for(var h="OTG0",g=0;g<4;g++)this.writeOffset=this.buffer.writeUInt8(h.charCodeAt(g),this.writeOffset);this.writeOffset=this.buffer.writeUInt16LE(a,this.writeOffset),this.writeOffset=this.buffer.writeUInt8(e,this.writeOffset),this.writeOffset=this.buffer.writeUInt8(b,this.writeOffset);for(var i=c[0],g=1;g<c.length;g++)this.writeOffset=this.buffer.writeUInt32LE(i,this.writeOffset),i+=c[g]},m.prototype.addAttribute=function(a,b,c,d){this.writeOffset=this.buffer.writeUInt8(a,this.writeOffset),a===t.Index||a===t.IndexEdges?(this.writeOffset=this.buffer.writeUInt8(l(b),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(b.itemOffset||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(c||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(d,this.writeOffset)):(this.writeOffset=this.buffer.writeUInt8(k(b),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(b.itemOffset||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(c||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(d,this.writeOffset))},m.prototype.endHeader=function(){for(;this.writeOffset%4!=0;)this.writeOffset=this.buffer.writeUInt8(0,this.writeOffset)},m.prototype.addBuffer=function(a){a.copy(this.buffer,this.writeOffset),this.writeOffset+=a.length},m.prototype.end=function(){return this.writeOffset!==this.buffer.length&&console.error("Incorrect encoding buffer size"),this.buffer},n.prototype.readNodeJS=function(){if("OTG0"!==this.buffer.toString("ascii",0,4))return console.error("Invalid OTG header"),!1;if(this.readOffset=4,this.meshFlag=this.buffer.readUInt16LE(this.readOffset),this.readOffset+=2,this.numBuffers=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.numAttributes=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.numBuffers){this.bufferOffsets.push(0);for(var a=1;a<this.numBuffers;a++){var b=this.buffer.readUInt32LE(this.readOffset);this.readOffset+=4,this.bufferOffsets.push(b)}}for(var a=0;a<this.numAttributes;a++){var c={};c.name=this.buffer.readUInt8(this.readOffset),this.readOffset++;var d=this.buffer.readUInt8(this.readOffset);this.readOffset++,c.itemSize=15&d,c.type=d>>4,c.bytesPerItem=y[c.type],c.normalize=c.type===u.BYTE_NORM||c.type===u.SHORT_NORM||c.type===u.UBYTE_NORM||c.type===u.USHORT_NORM,c.itemOffset=this.buffer.readUInt8(this.readOffset)/4,this.readOffset++,c.itemStride=this.buffer.readUInt8(this.readOffset)/4,this.readOffset++,c.bufferIndex=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.attributes.push(c)}for(;this.readOffset%4!=0;)this.readOffset++;for(var a=0;a<this.bufferOffsets.length;a++){var e,f=this.readOffset+this.bufferOffsets[a];e=a<this.bufferOffsets.length-1?this.readOffset+this.bufferOffsets[a+1]:this.buffer.length,this.buffers.push(this.buffer.slice(f,e))}return!0},n.prototype.readWeb=function(){var a=new r.InputStream(this.buffer);if("OTG0"!==a.getString(4))return console.error("Invalid OTG header"),!1;if(this.meshFlag=a.getUint16(),this.numBuffers=a.getUint8(),this.numAttributes=a.getUint8(),this.numBuffers){this.bufferOffsets.push(0);for(var b=1;b<this.numBuffers;b++){var c=a.getUint32();this.bufferOffsets.push(c)}}for(var b=0;b<this.numAttributes;b++){var d={};d.name=a.getUint8();var e=a.getUint8();d.itemSize=15&e,d.type=e>>4,d.bytesPerItem=y[d.type],d.normalize=d.type===u.BYTE_NORM||d.type===u.SHORT_NORM||d.type===u.UBYTE_NORM||d.type===u.USHORT_NORM,d.itemOffset=a.getUint8()/4,d.itemStride=a.getUint8()/4,d.bufferIndex=a.getUint8(),this.attributes.push(d)}for(;a.offset%4!=0;)a.offset++;for(var b=0;b<this.bufferOffsets.length;b++){var f,g=a.offset+this.bufferOffsets[b];f=b<this.bufferOffsets.length-1?a.offset+this.bufferOffsets[b+1]:a.byteLength,this.buffers.push(this.buffer.subarray(g,f))}return!0},n.prototype.read=function(){return(0,q.isNodeJS)()?this.readNodeJS():this.readWeb()};var z=new s.LmvBox3;z.min.x=-.5,z.min.y=-.5,z.min.z=-.5,z.max.x=.5,z.max.y=.5,z.max.z=.5;var A={center:{x:0,y:0,z:0},radius:Math.sqrt(.75)}},function(a,b,c){"use strict";function d(a){this.buffer=a,this.offset=0,this.byteLength=a.length}Object.defineProperty(b,"__esModule",{value:!0}),b.InputStream=d;var e=c(14),f=new ArrayBuffer(8),g=new Uint8Array(f),h=new Uint16Array(f),i=new Int32Array(f),j=new Uint32Array(f),k=new Float32Array(f),l=new Float64Array(f);d.prototype.seek=function(a){this.offset=a},d.prototype.getBytes=function(a){var b=new Uint8Array(this.buffer.buffer,this.offset,a);return this.offset+=a,b},d.prototype.getVarints=function(){var a,b=0,c=0;do{a=this.buffer[this.offset++],b|=(127&a)<<c,c+=7}while(128&a);return b},d.prototype.getUint8=function(){return this.buffer[this.offset++]},d.prototype.getUint16=function(){return g[0]=this.buffer[this.offset++],g[1]=this.buffer[this.offset++],h[0]},d.prototype.getInt16=function(){var a=this.getUint16();return a>32767&&(a|=4294901760),a},d.prototype.getInt32=function(){var a=this.buffer,b=g,c=this.offset;return b[0]=a[c],b[1]=a[c+1],b[2]=a[c+2],b[3]=a[c+3],this.offset+=4,i[0]},d.prototype.getUint32=function(){var a=this.buffer,b=g,c=this.offset;return b[0]=a[c],b[1]=a[c+1],b[2]=a[c+2],b[3]=a[c+3],this.offset+=4,j[0]},d.prototype.getFloat32=function(){var a=this.buffer,b=g,c=this.offset;return b[0]=a[c],b[1]=a[c+1],b[2]=a[c+2],b[3]=a[c+3],this.offset+=4,k[0]},d.prototype.getIndicesArray=function(a,b,c){for(var d=this.buffer,e=new Uint8Array(a,b,2*c),f=this.offset,g=0,h=2*c;g<h;g+=2)e[g]=d[f],e[g+1]=d[f+1],f+=4;this.offset=f},d.prototype.getVector3Array=function(a,b,c,d){var e=this.buffer,f=this.offset,g=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);if(3===d&&0===c){var h=12*b;g.set(e.subarray(f,f+h)),this.offset+=h}else{d*=4;for(var i=4*c,j=0;j<b;j++){for(var k=0;k<12;k++)g[i+k]=e[f++];i+=d}this.offset=f}},d.prototype.getVector2Array=function(a,b,c,d){var e=this.buffer,f=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),g=this.offset;d*=4;for(var h=4*c,i=0;i<b;i++){for(var j=0;j<8;j++)f[h+j]=e[g++];h+=d}this.offset=g},d.prototype.getVector4=function(a,b){for(var c=this.buffer,d=g,e=this.offset,f=k,h=0;h<4;h++)d[0]=c[e],d[1]=c[e+1],d[2]=c[e+2],d[3]=c[e+3],a[b+h]=f[0],e+=4;this.offset=e},d.prototype.getFloat64=function(){for(var a=this.buffer,b=g,c=this.offset,d=0;d<8;d++)b[d]=a[c+d];return this.offset+=8,l[0]},d.prototype.getString=function(a){var b=(0,e.utf8ArrayToString)(this.buffer,this.offset,a);return this.offset+=a,b},d.prototype.reset=function(a){this.buffer=a,this.offset=0,this.byteLength=a.length}},function(a,b,c){"use strict";function d(a){this.viewer=a,this.messageClient=null,this.presenceChannelId=null,this.viewtx=null,this.interceptor=null}function e(a){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(a){},this.deactivate=function(a){},this.update=function(a){return!1},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a,b){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(b){return a.takeControl(),!1},this.handleButtonDown=function(b,c){return a.takeControl(),!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(b){return a.updatePointer(b),!1},this.handleGesture=function(b){return a.takeControl(),!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}}function f(a){function b(a){p=!0;var b=JSON.parse(a.data.msg);w.restoreState(b),o.impl.invalidate(!0,!1,!0),p=!1}function c(a){return Math.round(1e3*a)/1e3}function d(a){for(var b=0;b<a.length;b++)a[b]=c(a[b])}function e(a){var b=a.data.msg;!0===b[1]||r||(b[0]!=m&&(m=b[0],a.data.lastInControl=b[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:a.data})),q=!1,o.navigation.setView((new THREE.Vector3).set(b[2],b[3],b[4]),(new THREE.Vector3).set(b[5],b[6],b[7])),o.navigation.setCameraUpVector((new THREE.Vector3).set(b[8],b[9],b[10])))}function f(b){if(q||r){var c=b.camera,e=[c.position.x,c.position.y,c.position.z,c.target.x,c.target.y,c.target.z,c.up.x,c.up.y,c.up.z];d(e),e.unshift(r),e.unshift(a.getLocalId()),s.sendMessage("camera",e,n.channelId),m!=e[0]&&(m=e[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:{lastInControl:m}}))}}function g(a,b,c){a&&!u&&(u=document.createElement("div"),u.classList.add("collabPointer")),a&&!v?(o.container.appendChild(u),v=!0):!a&&v&&(o.container.removeChild(u),v=!1),a&&(u.style.left=b-6+"px",u.style.top=c-6+"px")}function h(a){if(!q&&!r){var b=a.data.msg;t.origin.set(b[1],b[2],b[3]),t.direction.set(b[4],b[5],b[6]);var c=t.at(o.getCamera().near);c.project(o.getCamera()),c=o.impl.viewportToClient(c.x,c.y),g(!0,c.x,c.y)}}function j(b){if(q){var c=o.impl.clientToViewport(b.canvasX,b.canvasY);o.impl.viewportToRay(c,t);var e=[t.origin.x,t.origin.y,t.origin.z,t.direction.x,t.direction.y,t.direction.z];d(e),e.unshift(a.getLocalId()),s.sendMessage("pointer",e,n.channelId)}}function l(b){if(!p){var c=w.getState(x);a.sendMessage("state",JSON.stringify(c),n.channelId)}}var m,n=this,o=this.viewer=null,p=!1,q=!1,r=!1,s=this.client=a,t=new THREE.Ray,u=null,v=!1;this.channelId=null;var w,x={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};this.takeControl=function(){q=!0,g(!1)},this.updatePointer=function(a){j(a)},this.connectCamera=function(a){r=!a},this.attach=function(a,c){o&&this.detach(),this.viewer=o=a,w=new i.ViewerState(o),s.addEventListener("cameraChange",e),s.addEventListener("pointerMove",h),o.hasEventListener(k.CAMERA_CHANGE_EVENT,f)||o.addEventListener(k.CAMERA_CHANGE_EVENT,f),c||(s.addEventListener("viewerState",b),o.hasEventListener(k.SELECTION_CHANGED_EVENT,l)||(o.addEventListener(k.SELECTION_CHANGED_EVENT,l),o.addEventListener(k.ISOLATE_EVENT,l),o.addEventListener(k.HIDE_EVENT,l),o.addEventListener(k.SHOW_EVENT,l),o.addEventListener(k.EXPLODE_CHANGE_EVENT,l),o.addEventListener(k.LAYER_VISIBILITY_CHANGED_EVENT,l),o.addEventListener(k.CUTPLANES_CHANGE_EVENT,l)))},this.detach=function(){g(!1),s&&(s.removeEventListener("cameraChange",e),s.removeEventListener("viewerState",b)),o&&(o.removeEventListener(k.CAMERA_CHANGE_EVENT,f),o.removeEventListener(k.SELECTION_CHANGED_EVENT,l),o.removeEventListener(k.ISOLATE_EVENT,l),o.removeEventListener(k.HIDE_EVENT,l),o.removeEventListener(k.SHOW_EVENT,l),o.removeEventListener(k.EXPLODE_CHANGE_EVENT,l),o.removeEventListener(k.LAYER_VISIBILITY_CHANGED_EVENT,l),o.removeEventListener(k.CUTPLANES_CHANGE_EVENT,l),this.viewer=o=null,w=null)}}Object.defineProperty(b,"__esModule",{value:!0}),b.LiveReviewClient=d,b.InteractionInterceptor=e,b.ViewTransceiver=f;var g=c(33),h=c(32),i=c(196),j=c(198),k=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(j);d.prototype.destroy=function(){this.leaveLiveReviewSession()},d.prototype.joinLiveReviewSession=function(a){this.messageClient||(this.messageClient=h.MessageClient.GetInstance()),this.presenceChannelId||(this.presenceChannelId=window.location.host),this.messageClient.isConnected()||this.messageClient.connect(a),this.viewtx||(this.viewtx=new f(this.messageClient)),this.viewtx.channelId=a,this.viewtx.attach(this.viewer),this.messageClient.join(this.viewtx.channelId),this.interceptor||(this.interceptor=new e(this.viewtx)),this.viewer.toolController.registerTool(this.interceptor),this.viewer.toolController.activateTool(this.interceptor.getName())},d.prototype.leaveLiveReviewSession=function(){this.viewtx&&this.viewtx.detach(this.viewer),this.messageClient&&this.messageClient.disconnect(),this.interceptor&&this.viewer.toolController.deactivateTool(this.interceptor.getName()),this.viewtx=null,this.messageClient=null,this.interceptor=null},f.prototype.constructor=f,g.EventDispatcher.prototype.apply(f.prototype)},function(a,b,c){"use strict";function d(a){this.getState=function(b){var c=a.navigation,d={};d.seedURN=this.getSeedUrn();var e=d.objectSet;Array.isArray(e)||(d.objectSet=e=[]),a.model&&!a.model.is2d()&&(e[0]={id:this.getSelectedNodes(),isolated:a.getIsolatedNodes(),hidden:a.getHiddenNodes(),explodeScale:a.getExplodeScale(),idType:"lmv"}),a.model&&a.model.is2d()&&(e[0]={id:this.getSelectedNodes(),isolated:this.getVisibleLayers2d(),allLayers:this.areAllLayersVisible(),hidden:[],idType:"lmv"});var f=d.viewport;f||(f=d.viewport={});var g=c.getCamera().isPerspective;f.name="",f.eye=c.getPosition().toArray(),f.target=c.getTarget().toArray(),f.up=c.getCameraUpVector().toArray(),f.worldUpVector=c.getWorldUpVector().toArray(),f.pivotPoint=c.getPivotPoint().toArray(),f.distanceToOrbit=c.getPivotPlaneDistance(),f.aspectRatio=this.getAspectRatio(),f.projection=g?"perspective":"orthographic",f.isOrthographic=!g,g?f.fieldOfView=c.getVerticalFov():f.orthographicHeight=this.getOrthographicHeight();var h=d.renderOptions;if(h||(h=d.renderOptions={}),h.environment=this.getEnvironmentName(),h.ambientOcclusion={enabled:a.impl.renderer().getAOEnabled(),radius:a.impl.renderer().getAORadius(),intensity:a.impl.renderer().getAOIntensity()},h.toneMap={method:a.impl.renderer().getToneMapMethod(),exposure:a.impl.renderer().getExposureBias(),lightMultiplier:this.getToneMapIntensity()},h.appearance={ghostHidden:a.impl.showGhosting,ambientShadow:a.prefs.ambientShadows,antiAliasing:a.impl.renderer().settings.antialias,progressiveDisplay:a.prefs.progressiveRendering,swapBlackAndWhite:a.prefs.swapBlackAndWhite,displayLines:a.prefs.lineRendering,displayPoints:a.prefs.pointRendering},a.model&&!a.model.is2d())for(var i=d.cutplanes=[],j=a.getCutPlanes(),k=0;k<j.length;k++)i.push(j[k].toArray());for(var l in a.loadedExtensions){var m=a.loadedExtensions[l];m.getState&&m.getState(d)}return b&&!0!==b&&this.applyFilter(d,b),d},this.restoreState=function(b,c,d){if(!b)return f.logger.warn("restoreState has no viewer state to restore from."),!1;if(!a||!a.model)return f.logger.warn("restoreState has no viewer or model to restore."),!1;c&&!0!==c&&(b=JSON.parse(JSON.stringify(b)),this.applyFilter(b,c));var e=a.navigation,g=a.model.is2d(),h=!g;if(Array.isArray(b.objectSet)&&b.objectSet.length>0){var i=b.objectSet[0],j=i.id;if(j&&(j=this.toIntArray(j),a.select(j)),g){var k=i.isolated;Array.isArray(k)&&k.length>0?(a.setLayerVisible(null,!1),a.impl.setLayerVisible(k,!0)):a.setLayerVisible(null,!0)}else{var l=i.isolated||[];if(l=this.toIntArray(l),a.isolate(l),0===l.length){var m=i.hidden||null;m&&m.length>0&&(m=this.toIntArray(m),a.hide(m))}}if("explodeScale"in i){var n=parseFloat(i.explodeScale);a.explode&&a.explode(n)}}var o=b.viewport;if(o){var p=this.getVector3FromArray(o.eye,e.getPosition()),q=this.getVector3FromArray(o.up,e.getCameraUpVector()),r=this.getVector3FromArray(o.target,e.getTarget()),s="fieldOfView"in o?parseFloat(o.fieldOfView):e.getVerticalFov(),t=this.getVector3FromArray(o.worldUpVector,null);if(!t){var u=a.model?a.model.getUpVector():null;t=u?(new THREE.Vector3).fromArray(u):new THREE.Vector3(0,1,0)}var v=this.getVector3FromArray(o.pivotPoint,e.getPivotPoint()),w=e.getCamera().isPerspective;"isOrthographic"in o&&(w=!o.isOrthographic);var x=this.getOrthographicHeight();"orthographicHeight"in o&&(x=Number(o.orthographicHeight));var y={position:p,target:r,up:q,worldup:t,aspect:a.impl.camera.aspect,fov:s,orthoScale:x,isPerspective:w,pivot:v};this.restoreCameraState(y,d)}var z=b.renderOptions;if(z){var A=a.impl.renderer(),B=a.prefs,C=B.ambientShadows,D=B.antialiasing,E=z.ambientOcclusion;if(E){"enabled"in E&&(C=E.enabled);var F="radius"in E?E.radius:null,G="intensity"in E?E.intensity:null;null!==F&&null!==G&&(F===A.getAORadius()&&G===A.getAOIntensity()||(A.setAOOptions(F,G),A.composeFinalFrame()))}if("environment"in z){var H=this.getLightPresetIndex(z.environment);-1!==H&&H!==B.get("lightPreset")&&h&&a.setLightPreset(H)}var I=z.toneMap;if(I){var J=!1,K="exposure"in I?I.exposure:null,L="lightMultiplier"in I?I.lightMultiplier:null;null!==K&&K!==A.getExposureBias()&&(A.setTonemapExposureBias(K),J=!0),null!==L&&a.impl.dir_light1&&L!==this.getToneMapIntensity()&&(a.impl.dir_light1.intensity=Math.pow(2,L),J=!0),J&&a.impl.invalidate(!0)}var M=z.appearance;M&&("antiAliasing"in M&&(D=M.antiAliasing),"progressiveDisplay"in M&&M.progressiveDisplay!==B.get("progressiveRendering")&&a.setProgressiveRendering(M.progressiveDisplay),"swapBlackAndWhite"in M&&M.swapBlackAndWhite!==B.get("swapBlackAndWhite")&&a.setSwapBlackAndWhite(M.swapBlackAndWhite),"ghostHidden"in M&&M.ghostHidden!==B.get("ghosting")&&h&&a.setGhosting(M.ghostHidden),"displayLines"in M&&M.displayLines!==B.get("lineRendering")&&a.hideLines(!M.displayLines),"displayPoints"in M&&M.displayPoints!==B.get("pointRendering")&&a.hidePoints(!M.displayPoints)),h&&C!==B.ambientShadows&&D!==B.antialiasing&&a.setQualityLevel(C,D)}if(Array.isArray(b.cutplanes)&&a.model&&h){for(var N=[],O=0;O<b.cutplanes.length;O++){var P=b.cutplanes[O];Array.isArray(P)&&P.length>=4&&N.push(new THREE.Vector4(P[0],P[1],P[2],P[3]))}a.setCutPlanes(N)}for(var Q in a.loadedExtensions){var R=a.loadedExtensions[Q];R.restoreState&&R.restoreState(b,d)}return!0},this.getEnvironmentName=function(){var b=g.LightPresets[a.impl.currentLightPreset()];return b?b.name:"none"},this.restoreCameraState=function(b,c){a.impl.adjustOrthoCamera(b);var d=a.navigation;c?(b.isPerspective?d.toPerspective():d.toOrthographic(),d.setCameraUpVector(b.up),d.setWorldUpVector(b.worldup),d.setView(b.position,b.target),d.setPivotPoint(b.pivot),d.setVerticalFov(b.fov,!1),a.impl.syncCamera(!0)):(a.impl.camera.isPerspective=b.isPerspective,d.setRequestTransitionWithUp(!0,b.position,b.target,b.fov,b.up,b.worldup,b.pivot))},this.areEqual=function(a,b,c){function d(a,b){if(a=a||[],b=b||[],a.length!==b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}function f(a,b,c){return a=a||[],b=b||[],a.length===b.length&&(0!==a.length&&(g(a[0],b[0],c)||g(a[1],b[1],c)||g(a[2],b[2],c)))}function g(a,b,c){var d=a?parseFloat(a):null,f=a?parseFloat(b):null,g=void 0===d?"undefined":e(d),h=void 0===f?"undefined":e(f)
;return"number"===g&&"number"===h?Math.abs(a-b)<c:(a=a||null,b=b||null,a===b)}var h=a,i=b;if(c&&!0!==c&&(h=this.applyFilter(h,c),i=this.applyFilter(i,c)),h.seedURN!==i.seedURN)return!1;var j=h.objectSet||[],k=i.objectSet||[];if(j.length!==k.length)return!1;var l=j[0]||{},m=k[0]||{};if(!(l.idType===m.idType&&g(l.explodeScale,m.explodeScale,1e-9)&&d(l.id,m.id)&&d(l.isolated,m.isolated)&&d(l.hidden,m.hidden)))return!1;var n=h.viewport||{},o=i.viewport||{};return!!(n.name===o.name&&n.projection===o.projection&&n.isOrthographic===o.isOrthographic&&g(n.distanceToOrbit,o.distanceToOrbit,1e-9)&&g(n.fieldOfView,o.fieldOfView,1e-9)&&g(n.orthographicHeight,o.orthographicHeight,1e-9)&&f(n.eye,o.eye,1e-9)&&f(n.target,o.target,1e-9)&&f(n.up,o.up,1e-9)&&f(n.worldUpVector,o.worldUpVector,1e-9)&&f(n.pivotPoint,o.pivotPoint,1e-9))},this.toIntArray=function(a){var b=[];if(Array.isArray(a))for(var c=0,d=a.length;c<d;++c)b.push(parseInt(a[c]));return b},this.extractSelectedNodeIds=function(a){if(a&&Array.isArray(a.objectSet)&&a.objectSet.length>0){var b=a.objectSet[0];return this.toIntArray(b.id)}return[]},this.extractIsolatedNodeIds=function(a){if(a&&Array.isArray(a.objectSet)&&a.objectSet.length>0){var b=a.objectSet[0];return this.toIntArray(b.isolated)}return[]},this.getVector3FromArray=function(a,b){return a instanceof Array&&a.length>2?(a[0]=parseFloat(a[0]),a[1]=parseFloat(a[1]),a[2]=parseFloat(a[2]),(new THREE.Vector3).fromArray(a)):b},this.getSelectedNodes=function(){return a.impl&&a.impl.selector?a.impl.selector.getSelection():[]},this.getVisibleLayers2d=function(){var b=[],c=a.impl.matman(),d=c._layersMap;for(var e in d)d.hasOwnProperty(e)&&c.isLayerVisible(e)&&b.push(e);return b},this.areAllLayersVisible=function(){var b=a.impl.matman(),c=b._layersMap;for(var d in c)if(c.hasOwnProperty(d)&&!b.isLayerVisible(d))return!1;return!0},this.getAspectRatio=function(){var b=a.navigation.getScreenViewport();return b.width/b.height},this.getOrthographicHeight=function(){var b=a.navigation.getCamera();return b.isPerspective?0:Math.abs(2*b.orthographicCamera.top)},this.getSeedUrn=function(){return a.model&&a.model.loader?a.model.loader.svfUrn||"":""},this.getToneMapIntensity=function(){var b=0;return a.impl.dir_light1&&(b=0!=a.impl.dir_light1.intensity?Math.log(a.impl.dir_light1.intensity)/Math.log(2):-1e-20),b},this.getLightPresetIndex=function(a){for(var b=0;b<g.LightPresets.length;b++)if(g.LightPresets[b].name===a)return b;return-1},this.applyFilter=function(a,b){if(!0!==b)for(var c in a)if(a.hasOwnProperty(c)){var d=b[c];void 0===d?(delete a[c],f.logger.log("[applyFilter] C - skipping key ["+c+"] from viewerState; unspecified in filter.")):"boolean"==typeof d?!1===d&&(delete a[c],f.logger.log("[applyFilter] D - skipping key ["+c+"] from viewerState; explicit filtering.")):d instanceof Object?a[c]instanceof Object?this.applyFilter(a[c],b[c]):f.logger.warn("[applyFilter] A - Invalid filter Object for key ["+c+"]"):f.logger.warn("[applyFilter] B - Invalid filter value for key ["+c+"]")}}}Object.defineProperty(b,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};b.ViewerState=d;var f=c(8),g=c(197);d.prototype.constructor=d},function(a,b,c){"use strict";function d(a,b){(0,e.ObjectAssign)(b,a),b.name=a.name+" (copy)"}Object.defineProperty(b,"__esModule",{value:!0}),b.LightPresets=b.BackgroundPresets=b.DefaultLightPreset2d=b.DefaultLightPreset=void 0,b.copyLightPreset=d;var e=c(4),f=(b.DefaultLightPreset=1,b.DefaultLightPreset2d=0,b.BackgroundPresets={"Fusion Grey":[230,230,230,150,150,150],"Sky Blue":[226,244,255,156,172,180],Snow:[181,186,199,181,186,199],Midnight:[41,76,120,1,2,3],White:[255,255,255,255,255,255],AutoCADModel:[30,40,48,30,40,48],"Dark Grey":[51,51,51,51,51,51],"Dark Sky":[51,51,51,51,51,51],"Infinity Pool":[255,255,255,255,255,255],Tranquility:[0,84,166,0,84,166],"Grey Room":[129,129,129,129,129,129],"Photo Booth":[237,237,237,237,237,237],"RaaS SBS":[1,1,1,90,90,90],Plaza:[79,102,130,79,102,130],Field:[202,226,252,202,201,190],Boardwalk:[216,230,248,230,228,220],Custom:[230,230,230,150,150,150]}),g=f,h=b.LightPresets=[{name:"Simple Grey",path:null,tonemap:0,E_bias:0,directLightColor:[1,.84,.67],ambientColor:[.2,.225,.25],lightMultiplier:1,bgColorGradient:g["Fusion Grey"],darkerFade:!1,rotation:0},{name:"Sharp Highlights",path:"SharpHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.5,-.2,-.06],bgColorGradient:g["Photo Booth"],darkerFade:!0,rotation:0},{name:"Dark Sky",path:"DarkSky",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:1,lightDirection:[.1,-.55,-1],bgColorGradient:g["Dark Sky"],darkerFade:!1,rotation:0},{name:"Grey Room",path:"GreyRoom",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:g["Grey Room"],darkerFade:!0,rotation:0},{name:"Photo Booth",path:"PhotoBooth",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:g["Photo Booth"],darkerFade:!0,rotation:0},{name:"Tranquility",path:"TranquilityBlue",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:g.Tranquility,darkerFade:!1,rotation:0},{name:"Infinity Pool",path:"InfinityPool",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,.84,.67],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:g["Infinity Pool"],darkerFade:!1,rotation:0},{name:"Simple White",path:null,tonemap:0,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25,.25,.25],lightMultiplier:1,bgColorGradient:g.White,saoRadius:.06,saoIntensity:.15,darkerFade:!0,rotation:0},{name:"Riverbank",path:"riverbank",type:"logluv",tonemap:1,E_bias:-5.7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g["Sky Blue"],darkerFade:!1,rotation:0},{name:"Contrast",path:"IDViz",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g.Midnight,darkerFade:!1,rotation:0},{name:"Rim Highlights",path:"RimHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.35,-.35,-.5],bgColorGradient:g["Photo Booth"],darkerFade:!0,rotation:0},{name:"Cool Light",path:"CoolLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:g["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Warm Light",path:"WarmLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:g["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Soft Light",path:"SoftLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.5,0],bgColorGradient:g["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Grid Light",path:"GridLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.6,0],bgColorGradient:g["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Plaza",path:"Plaza",type:"logluv",tonemap:1,E_bias:-14,directLightColor:[.9,.9,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.2,-.18,.72],bgColorGradient:g.Plaza,darkerFade:!1,rotation:0},{name:"Snow Field",path:"SnowField",type:"logluv",tonemap:1,E_bias:-10.461343,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[0,-1,0],bgColorGradient:g.Snow,darkerFade:!1,rotation:0},{name:"Field",path:"field",type:"logluv",tonemap:1,E_bias:-2.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g.Field,useIrradianceAsBackground:!0,darkerFade:!0,rotation:0},{name:"Boardwalk",path:"boardwalk",type:"logluv",tonemap:1,E_bias:-7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g.Boardwalk,useIrradianceAsBackground:!0,darkerFade:!1,rotation:0},{name:"Flat Shading",path:null,tonemap:0,E_bias:0,directLightColor:[0,0,0],ambientColor:[0,0,0],lightMultiplier:0,bgColorGradient:g["Fusion Grey"],darkerFade:!1,rotation:0}],i=[{name:"Harbor",path:"Harbor",type:"logluv",tonemap:1,E_bias:1.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g["Sky Blue"],useIrradianceAsBackground:!0,saoIntensity:.5,darkerFade:!1,rotation:0},{name:"Night",path:"Night",type:"logluv",tonemap:1,E_bias:4,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g.Midnight,useIrradianceAsBackground:!1,darkerFade:!1,rotation:0},{name:"Parking",path:"Parking",type:"logluv",tonemap:1,E_bias:2.8,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g["Sky Blue"],useIrradianceAsBackground:!1,saoIntensity:.5,darkerFade:!1,rotation:0},{name:"River Road",path:"RiverRoad",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g["Fusion Grey"],useIrradianceAsBackground:!1,saoIntensity:.7,darkerFade:!1,rotation:0},{name:"Crossroads",path:"crossroads",type:"logluv",tonemap:1,E_bias:-5.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g["Sky Blue"],useIrradianceAsBackground:!0,darkerFade:!0,rotation:0},{name:"Seaport",path:"seaport",type:"logluv",tonemap:1,E_bias:-6.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g["Sky Blue"],useIrradianceAsBackground:!0,darkerFade:!1,rotation:0},{name:"Glacier",path:"glacier",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g.Midnight,darkerFade:!1,rotation:0},{name:"RaaS Test Env",path:"Reflection",type:"logluv",tonemap:2,E_bias:-1.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:g["RaaS SBS"],darkerFade:!1,rotation:0},{name:"City Night",path:"CityNight",type:"logluv",tonemap:1,E_bias:1.6,directLightColor:[1,1,1],lightMultiplier:.2,bgColorGradient:g.Midnight,useIrradianceAsBackground:!1,darkerFade:!1,rotation:0}];(0,e.getGlobal)().ENABLE_DEBUG&&Array.prototype.push.apply(h,i)},function(a,b){"use strict";var c=a.exports;c.ESCAPE_EVENT="escape",c.PROGRESS_UPDATE_EVENT="progress",c.FULLSCREEN_MODE_EVENT="fullScreenMode",c.NAVIGATION_MODE_CHANGED_EVENT="navmode",c.VIEWER_STATE_RESTORED_EVENT="viewerStateRestored",c.VIEWER_RESIZE_EVENT="viewerResize",c.VIEWER_INITIALIZED="viewerInitialized",c.VIEWER_UNINITIALIZED="viewerUninitialized",c.MODEL_ROOT_LOADED_EVENT="svfLoaded",c.GEOMETRY_LOADED_EVENT="geometryLoaded",c.TEXTURES_LOADED_EVENT="texturesLoaded",c.OBJECT_TREE_CREATED_EVENT="propertyDbLoaded",c.OBJECT_TREE_UNAVAILABLE_EVENT="propertyDbUnavailable",c.MODEL_UNLOADED_EVENT="modelUnloaded",c.MODEL_ADDED_EVENT="modelAdded",c.MODEL_REMOVED_EVENT="modelRemoved",c.MODEL_LAYERS_LOADED_EVENT="modelLayersLoaded",c.EXTENSION_LOADED_EVENT="extensionLoaded",c.EXTENSION_UNLOADED_EVENT="extensionUnloaded",c.SELECTION_CHANGED_EVENT="selection",c.AGGREGATE_SELECTION_CHANGED_EVENT="aggregateSelection",c.ISOLATE_EVENT="isolate",c.AGGREGATE_ISOLATION_CHANGED_EVENT="aggregateIsolation",c.HIDE_EVENT="hide",c.SHOW_EVENT="show",c.CAMERA_CHANGE_EVENT="cameraChanged",c.EXPLODE_CHANGE_EVENT="explodeChanged",c.FIT_TO_VIEW_EVENT="fitToView",c.AGGREGATE_FIT_TO_VIEW_EVENT="aggregateFitToView",c.CUTPLANES_CHANGE_EVENT="cutplanesChanged",c.TOOL_CHANGE_EVENT="toolChanged",c.RENDER_OPTION_CHANGED_EVENT="renderOptionChanged",c.FINAL_FRAME_RENDERED_CHANGED_EVENT="finalFrameRenderedChanged",c.RENDER_PRESENTED_EVENT="renderPresented",c.LAYER_VISIBILITY_CHANGED_EVENT="layerVisibility",c.RESET_EVENT="reset",c.PREF_CHANGED_EVENT="PrefChanged",c.PREF_RESET_EVENT="PrefReset",c.RESTORE_DEFAULT_SETTINGS_EVENT="restoreDefaultSettings",c.ANIMATION_READY_EVENT="animationReady",c.CAMERA_TRANSITION_COMPLETED="cameraTransitionCompleted",c.HYPERLINK_EVENT="hyperlink",c.LOAD_GEOMETRY_EVENT="load_geometry",c.LOAD_MISSING_GEOMETRY="loadMissingGeometry",c.FRAGMENTS_LOADED_EVENT="fragmentLoaded",c.GEOMETRY_DOWNLOAD_COMPLETE="geometryDownloadComplete",c.GEOMETRY_DOWNLOAD_COMPLETE_EVENT="geometryDownloadComplete",c.WEBGL_CONTEXT_LOST_EVENT="webglcontextlost",c.CANCEL_LEAFLET_SCREENSHOT="cancelLeafletScreenshot"},function(a,b){"use strict";function c(a,b,c){return!g[a]&&(g[a]={loader:c,extensions:b},!0)}function d(a){return g[a]?g[a].loader:null}function e(a){return!!g[a]&&(delete g[a],!0)}function f(a){a=a?a.toLowerCase():"";for(var b in g){var c=g[b];if(c)for(var d=0;d<c.extensions.length;d++)if(c.extensions[d].toLowerCase()===a)return c.loader}return null}Object.defineProperty(b,"__esModule",{value:!0});var g={};b.FileLoaderManager={registerFileLoader:c,getFileLoader:d,getFileLoaderForExtension:f,unregisterFileLoader:e}},function(a,b){"use strict";function c(a){return"application/autodesk-db"==a.mime&&a.urn?0===a.urn.indexOf("urn:adsk.objects:os.object")?a.urn.substr(0,a.urn.lastIndexOf("%2F")+3):a.urn.substr(0,a.urn.lastIndexOf("/")+1):null}Object.defineProperty(b,"__esModule",{value:!0});var d=1,e=b.BubbleNode=function a(b,e){if(this.parent=e,this.id=d++,this.data=b,this.isLeaf="geometry"===b.type&&("3d"===b.role||"2d"===b.role||"lod"===b.role),this.extractRevitMetadata(),Array.isArray(b.children)||Array.isArray(b.derivatives)){this.children=[];for(var f=b.children||b.derivatives,g=f.length,h=0;h<g;h++)this.children[h]=new a(f[h],this);for(var h=0;h<g;h++){var i=c(f[h]);i&&(this.sharedPropertyDbPath=i),"lod"===f[h].role&&(this.lodNode=this.children[h])}}};e.prototype.constructor=e,e.prototype.isOtg=function(){return!!this._getOtgManifest()},e.prototype._getOtgManifest=function(){if("undefined"!=typeof DISABLE_OTG&&DISABLE_OTG)return null;var a=this.findViewableParent();return a?a.data.otg_manifest:null},e.prototype.getOtgGraphicsNode=function(){var a=this._getOtgManifest();return a&&a.views&&a.views[this.guid()]},e.prototype.getPropertyDbManifest=function(){var a,b=this._getOtgManifest();if(b&&b.pdb_manifest){var c=b.pdb_manifest;a={};for(var d=0;d<c.assets.length;d++){var e,f=c.assets[d];e=f.isShared?b.paths.shared_root+c.pdb_shared_rel_path:b.paths.version_root+c.pdb_version_rel_path,a[f.tag]=[e+f.uri]}}else{var e=this.findPropertyDbPath();null===e&&(console.warn("Missing property database entry in manifest."),e=""),0===e.indexOf("$file$")&&(console.warn("Bubble local path given for shared property DB files. Assuming that sharedPropertyDbPath is specified correctly by loadDocumentNode()."),e=""),a={attrs:[e+"objects_attrs.json.gz"],values:[e+"objects_vals.json.gz"],avs:[e+"objects_avs.json.gz"],offsets:[e+"objects_offs.json.gz"],ids:[e+"objects_ids.json.gz"]}}return a},e.prototype.getRootNode=function(){return this.parent?this.parent.getRootNode():this},e.prototype.isForgeManifest=function(){return"manifest"===this.getRootNode().data.type},e.prototype.findPropertyDbPath=function(){var a=this._getOtgManifest(),b=a&&a.views&&a.views[this.guid()];if(b&&!b.error){return a.paths.version_root}return this.sharedPropertyDbPath?this.sharedPropertyDbPath:this.parent?this.parent.findPropertyDbPath():null},e.prototype._raw=function(){return this.data},e.prototype.name=function(){return this.data.name||""},e.prototype.guid=function(){return this.data.guid},e.prototype.type=function(){return this.data.type},e.prototype.extensions=function(){if(this.data.extensions)return Array.isArray(this.data.extensions)?this.data.extensions:[this.data.extensions]},e.prototype.urn=function(a){var b=this.data.urn;if(!a)return b;for(var c=this.parent;!b&&c;)b=c.data.urn,c=c.parent;return b},e.prototype.isGeomLeaf=function(){return this.isLeaf},e.prototype.isViewable=function(){return"viewable"===this.data.role||"svf"===this.data.outputType},e.prototype.getLodNode=function(){return this.lodNode},e.prototype.isGeometry=function(){return"geometry"===this.data.type},e.prototype.isViewPreset=function(){return"view"===this.data.type},e.prototype.is2D=function(){return"2d"===this.data.role},e.prototype.is3D=function(){return"3d"===this.data.role},e.prototype.is2DGeom=function(){return this.isGeometry()&&this.is2D()},e.prototype.is3DGeom=function(){return this.isGeometry()&&this.is3D()},e.prototype.getPlacementTransform=function(){if(!this.is2DGeom())return this.findViewableParent().getTag("placement");var a=this.findViewableParent().data.sheet_extras;if(a&&a.placements){var b=a.placements[this.data.viewableID];if(b)return b}},e.prototype.getHash=function(){var a=this.findViewableParent().data.sheet_extras;return a&&a.hashes_v1?a.hashes_v1[this.data.viewableID]:null},e.prototype.isMetadata=function(){if(this.data.role){if(-1!==this.data.role.indexOf("Autodesk.CloudPlatform.DesignDescription"))return!0;if("Autodesk.CloudPlatform.PropertyDatabase"===this.data.role)return!0}return!1},e.prototype.findViewableParent=function(){for(var a=null,b=this;b;)b.isViewable()&&(a=b),b=b.parent;if(!a&&!this.parent&&this.children)for(var c=0;c<this.children.length;c++){var d=this.children[c];if(d.isViewable()){a=d;break}}return a},e.prototype.findParentGeom2Dor3D=function(){for(var a=this;a&&!a.is2DGeom()&&!a.is3DGeom();)a=a.parent;return a},e.prototype.findAllViewables=function(){var a=[];this.isForgeManifest()&&(a=this.search({outputType:"svf"}));var b=this.search({role:"viewable"});return a.concat(b)},e.prototype.getViewableRootPath=function(a){if(!this.isGeomLeaf())return null;var b=this.getOtgGraphicsNode();if(b&&!b.error){return this._getOtgManifest().paths.version_root+b.urn}if(!a&&this.is2D()){var c=this.search({role:"leaflet"});if(c&&c.length)return c[0].urn()}var d=this.is2D()?"application/autodesk-f2d":"application/autodesk-svf",e=this.search({mime:d});if(e&&e.length){return e[0].urn()}return null},e.prototype.getNamedViews=function(){var a=this.search({type:"view"});return a=a.filter(function(a){return!!a.data.name&&!!Array.isArray(a.data.camera)})},e.prototype.findByGuid=function(a){var b=null;return this.traverse(function(c){if(c.data.guid===a)return b=c,!0}),b},e.prototype.search=function(a){var b=[];return this.traverse(function(c){var d=!0;for(var e in a)if(!c.data.hasOwnProperty(e)||c.data[e]!==a[e]){d=!1;break}d&&b.push(c)}),b},e.prototype.traverse=function(a){if(a(this))return!0;if(this.children)for(var b=0;b<this.children.length;b++)if(this.children[b].traverse(a))return!0;return!1},e.prototype.getShallowCopySource=function(a){if(!this.isViewable())return console.error("getShallowCopySource must be called with a viewable node."),null;a||(a=this.parent.urn());var b=this.urn();return b!==a&&(b?(console.log("Redirecting shallow copied URN "+a+" to "+b),a=b):console.warn("Unexpected: manifest viewable node does not have a urn property.\n"+JSON.stringify(this._raw()))),a},e.prototype.getTag=function(a){return(this.data.tags?this.data.tags:this.data)[a]},e.prototype.setTag=function(a,b){this.data.tags?this.data.tags[a]=b:this.data[a]=b},e.prototype.getAecModelData=function(){var a=this.findViewableParent();return a?a.data.aec_model_data:null},e.prototype.searchByTag=function(a){var b=[];return this.traverse(function(c){var d=!0;for(var e in a)if(c.getTag(e)!==a[e]){d=!1;break}d&&b.push(c)}),b.length?b:null},e.prototype.extractRevitMetadata=function(){var a=this.data;if(a.hasOwnProperty("levelNumber")){var b=a.levelNumber,c=a.levelName||b,d=this.findViewableParent();d&&(d.levelNumToName=d.levelNumToName||{},d.levelNameToNum=d.levelNameToNum||{},d.levelNumToName[b]=c,d.levelNameToNum[c]=b)}if(a.placement&&"2d"===a.role){for(var e=!0,f=0;f<11;f++)if(0!==a.placement[f]&&1!==a.placement[f]){e=!1;break}e&&(a.placement[12]*=-1,a.placement[13]*=-1,a.placement[14]*=-1)}},e.prototype.getLevel=function(){var a=this.data.levelNumber;return Array.isArray(a)?a[0]:a},e.prototype.getLevelName=function(){return this.data.levelName||this.getLevel()},e.MODEL_NODE={role:"3d",type:"geometry"},e.GEOMETRY_SVF_NODE={role:"graphics",mime:"application/autodesk-svf"},e.SHEET_NODE={role:"2d",type:"geometry"},e.LEAFLET_NODE={role:"leaflet"},e.IMAGE_NODE={role:"image"},e.GEOMETRY_F2D_NODE={role:"graphics",mime:"application/autodesk-f2d"},e.VIEWABLE_NODE={role:"viewable"},e.AEC_MODEL_DATA={role:"Autodesk.AEC.ModelData"}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Extension=void 0;var d=c(34),e=c(8),f=b.Extension=function(a,b){this.viewer=a,this.options=b||{},this.id="",this.modes=[],this.mode="",this.name="",this.activeStatus=!1};f.prototype.load=function(){return!0},f.prototype.unload=function(){return!0},f.prototype.activate=function(a){return!0},f.prototype.deactivate=function(){return!0},f.prototype.getName=function(){return this.name},f.prototype.getModes=function(){return this.modes},f.prototype.isActive=function(a){return a?this.activeStatus&&this.mode===a:this.activeStatus},f.prototype.getState=function(a){},f.prototype.restoreState=function(a,b){return!0},f.prototype.extendLocalization=function(a){return(0,d.extendLocalization)(a)},f.prototype.getCache=function(){this.viewer.extensionCache||(this.viewer.extensionCache={},e.logger.warn("Extension cache runtime creation; missing ViewingApplication context."));var a=this.viewer.extensionCache[this.id];return a||(a=this.viewer.extensionCache[this.id]={}),a},"undefined"!=typeof Autodesk&&(Autodesk.Viewing.Extension=f)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ExtensionMixin=b.theExtensionManager=void 0;var d=c(8),e=c(6),f=c(198),g=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(f),h=function(){function a(a,b){return!i[a]&&(i[a]=b,!0)}function b(a){return i.hasOwnProperty(a)?i[a]:null}function c(a){return!!i.hasOwnProperty(a)&&(delete i[a],!0)}function d(a,b){return!j[a]&&(j[a]=b,!0)}function e(a){return j.hasOwnProperty(a)?j[a]:null}function f(a){return!!j.hasOwnProperty(a)&&(delete j[a],!0)}function g(){var a,b=[];for(a in i)i.hasOwnProperty(a)&&b.push({id:a,inMemory:!0,isAsync:a in j});for(a in j)!j.hasOwnProperty(a)||a in i||b.push({id:a,inMemory:!1,isAsync:!0});return b}function h(a){for(var b in i)i.hasOwnProperty(b)&&i[b].hasOwnProperty("populateDefaultOptions")&&i[b].populateDefaultOptions(a)}var i={},j={};return{registerExtension:a,getExtension:b,unregisterExtension:c,registerExternalExtension:d,getExternalPath:e,unregisterExternalExtension:f,getRegisteredExtensions:g,popuplateOptions:h}},i=b.theExtensionManager=new h,j=b.ExtensionMixin=function(){};j.prototype={loadExtension:function(a,b){this.loadedExtensions||(this.loadedExtensions={});var c=this.getExtension(a);if(c)return Promise.resolve(c);if(!i.getExtension(a)){var d=i.getExternalPath(a);return d?this.loadExtensionAsync(a,d,b):Promise.reject("Extension not found: "+a+". Has it been registered(1)?")}return this.loadExtensionLocal(a,b)},getExtension:function(a){return this.loadedExtensions&&a in this.loadedExtensions?this.loadedExtensions[a]:null},unloadExtension:function(a){var b=!1,c=this.getExtension(a);return c?(b=c.unload(),d.logger.info("Extension unloaded: "+a),delete this.loadedExtensions[a],this.dispatchEvent({type:g.EXTENSION_UNLOADED_EVENT,extensionId:a})):d.logger.warn("Extension not found: "+a),b},loadExtensionLocal:function(a,b){var c=i.getExtension(a);if(!c)return Promise.reject("Extension not found: "+a+". Has it been registered(2)?");var e=new c(this,b);return e.id=a,e.load()?(this.loadedExtensions[a]=e,d.logger.info("Extension loaded: "+a),this.dispatchEvent({type:g.EXTENSION_LOADED_EVENT,extensionId:a}),Promise.resolve(e)):Promise.reject("Extension failed to .load() : "+a)},loadExtensionAsync:function(a,b,c){var d=this;return new Promise(function(f,g){(0,e.loadDependency)(a,b,function(){d.loadExtension(a,c);var b=d.getExtension(a);b?f(b):g("Failed to getExtension("+a+")")},function(){g("Failed to loadExtensionAsync: ("+a+") from: ("+b+")")})})},apply:function(a){var b=j.prototype;a.loadExtension=b.loadExtension,a.getExtension=b.getExtension,a.unloadExtension=b.unloadExtension,a.loadExtensionLocal=b.loadExtensionLocal,a.loadExtensionAsync=b.loadExtensionAsync}}},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=b.FileLoader=function(a){this.viewer=a};c.prototype.constructor=c,c.prototype.loadFile=function(a,b,c,d){return!1},c.prototype.is3d=function(){return!1}},function(a,b,c){"use strict";function d(a){for(var b=0;b<n.length;++b)document.addEventListener(n[b],a,!1)}function e(a){for(var b=0;b<n.length;++b)document.removeEventListener(n[b],a,!1)}function f(a){this.viewer=a,this.bindFullscreenEventListener=this.fullscreenEventListener.bind(this),this.getMode()===o.kFullScreen&&d(this.bindFullscreenEventListener)}function g(a){f.call(this,a)}function h(a){f.call(this,a)}function i(){}Object.defineProperty(b,"__esModule",{value:!0}),b.ApplicationScreenModeDelegate=b.ScreenMode=void 0,b.ScreenModeDelegate=f,b.AppScreenModeDelegate=g,b.NullScreenModeDelegate=h,b.ScreenModeMixin=i;var j=c(4),k=c(198),l=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(k),m=c(8),n=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"],o=b.ScreenMode={kNormal:0,kFullBrowser:1,kFullScreen:2};f.prototype.uninitialize=function(){e(this.bindFullscreenEventListener),this.viewer=null},f.prototype.isModeSupported=function(a){return!0},f.prototype.setMode=function(a){var b=this.getMode();return!(a===b||!this.isModeSupported(a))&&(this.doScreenModeChange(b,a),this.onScreenModeChanged(b,a),!0)},f.prototype.getMode=function(){throw"Implement getMode() in derived class"},f.prototype.getNextMode=function(){var a,b=this.getMode(),c=o;return b===c.kNormal&&this.isModeSupported(c.kFullBrowser)?a=c.kFullBrowser:b===c.kNormal&&this.isModeSupported(c.kFullScreen)?a=c.kFullScreen:b===c.kFullBrowser&&this.isModeSupported(c.kFullScreen)?a=c.kFullScreen:b===c.kFullBrowser&&this.isModeSupported(c.kNormal)?a=c.kNormal:b===c.kFullScreen&&this.isModeSupported(c.kNormal)?a=c.kNormal:b===c.kFullScreen&&this.isModeSupported(c.kFullBrowser)&&(a=c.kFullBrowser),a},f.prototype.getEscapeMode=function(){return this.getMode()!==o.kNormal?o.kNormal:void 0},f.prototype.fullscreenEventListener=function(){(0,j.inFullscreen)()?this.viewer.resize():(this.doScreenModeChange(o.kFullScreen,o.kNormal),this.onScreenModeChanged(o.kFullScreen,o.kNormal))},f.prototype.doScreenModeChange=function(a,b){throw"Implement doScreenModeChange() in derived class"},f.prototype.onScreenModeChanged=function(a,b){a===o.kFullScreen?e(this.bindFullscreenEventListener):b===o.kFullScreen&&d(this.bindFullscreenEventListener),this.viewer.resize(),this.viewer.dispatchEvent({type:l.FULLSCREEN_MODE_EVENT,mode:b})},g.prototype=Object.create(f.prototype),g.prototype.constructor=g,g.prototype.isModeSupported=function(a){return a!==o.kFullBrowser},g.prototype.getMode=function(){return(0,j.inFullscreen)()?o.kFullScreen:o.kNormal},g.prototype.doScreenModeChange=function(a,b){var c=this.viewer.container;b===o.kNormal?(c.classList.remove("viewer-fill-browser"),(0,j.exitFullscreen)()):b===o.kFullScreen&&(c.classList.add("viewer-fill-browser"),(0,j.launchFullscreen)(c))};b.ApplicationScreenModeDelegate=g;h.prototype=Object.create(f.prototype),h.prototype.constructor=f,h.prototype.isModeSupported=function(a){return!1},h.prototype.getMode=function(){return o.kNormal},i.prototype={setScreenModeDelegate:function(a){this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.screenModeDelegateClass=a||(null===a?h:g)},getScreenModeDelegate:function(){return this.screenModeDelegate||(this.screenModeDelegate=new this.screenModeDelegateClass(this)),this.screenModeDelegate},isScreenModeSupported:function(a){return this.getScreenModeDelegate().isModeSupported(a)},canChangeScreenMode:function(){return this.isScreenModeSupported(Autodesk.Viewing.ScreenMode.kNormal)},setScreenMode:function(a){var b={category:"screen_mode",value:a};return m.logger.track(b),this.getScreenModeDelegate().setMode(a)},getScreenMode:function(){return this.getScreenModeDelegate().getMode()},nextScreenMode:function(){var a=this.getScreenModeDelegate().getNextMode();return void 0!==a&&this.setScreenMode(a)},escapeScreenMode:function(){var a=this.getScreenModeDelegate().getEscapeMode();return void 0!==a&&this.setScreenMode(a)},apply:function(a){var b=i.prototype;a.setScreenModeDelegate=b.setScreenModeDelegate,a.getScreenModeDelegate=b.getScreenModeDelegate,a.isScreenModeSupported=b.isScreenModeSupported,a.canChangeScreenMode=b.canChangeScreenMode,a.setScreenMode=b.setScreenMode,a.getScreenMode=b.getScreenMode,a.nextScreenMode=b.nextScreenMode,a.escapeScreenMode=b.escapeScreenMode}}},function(a,b,c){"use strict";function d(a){this.viewer=a,this.matman=a.matman(),this.model=null,this.root=null,this.initialized=!1,this.layerToIndex={},this.indexToLayer=[null],this.nodeToLayer=[]}function e(a){var b=a.getData(),c=n;return b&&b.layersRoot&&(c=b.layersRoot),Promise.resolve(c)}function f(a){if(a.getData().loadOptions.skipPropertyDb)return Promise.resolve(null);var b=a.getPropertyDb();return b?b.findLayers():Promise.resolve(n)}function g(a,b){var c=a.model,d=a.indexToLayer;if(c.is2d()){var e=[];for(var f in a.layerToIndex)e.push(a.layerToIndex[f]);a.matman.setLayerVisible(e,b),a.viewer.invalidate(!0)}else{var g=[],i=b?a.viewer.visibilityManager.show:a.viewer.visibilityManager.hide;h(a,function(a,e){d[e].visible!==b&&(g.push(a),g.length===m&&(i(g,c),g.length=0))}),g.length>0&&i(g,c)}for(var j=d.length,k=1;k<j;++k){var l=d[k];l&&(l.visible=b)}}function h(a,b){var c=a.nodeToLayer;if(c&&c.length){var d=a.model.getData().instanceTree.nodeAccess;for(var e in d.dbIdToIndex){var f=d.dbIdToIndex[e],g=c[f]||0;0!==g&&b(0|e,g)}}}function i(a,b){return"number"==typeof b?b:a.layerToIndex[b.name||b]||0}Object.defineProperty(b,"__esModule",{value:!0}),b.ModelLayers=d;var j=c(8),k=c(198),l=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(k),m=1024,n={name:"root",id:"root",isLayer:!1,children:[],childCount:0},o=d.prototype;o.addModel=function(a){var b=function(b){var c=this.model.getData(),d=c.instanceTree;if(b){b.children=b.children||[],b.childCount=b.children.length,this.indexToLayer=new Array(b.childCount+1),this.indexToLayer[0]=null;for(var e=0;e<b.childCount;++e){var f=b.children[e],g=f.name,h=f.id,i=f.index;this.indexToLayer[i]={name:g,id:h,index:i,visible:!0},this.layerToIndex[g]=i}if(!this.model.is2d()&&0!==b.childCount){this.nodeToLayer=b.childCount<=256?new Uint8Array(d.nodeAccess.getNumNodes()):new Uint16Array(d.nodeAccess.getNumNodes());var k=function(a){if(this.model){var b=this.model.getData(),c=b.instanceTree;for(var d in a)if(a.hasOwnProperty(d))for(var e=this.layerToIndex[d],f=a[d],g=0,h=f.length;g<h;++g){var i=c.nodeAccess.getIndex(f[g]);this.nodeToLayer[i]=e}}}.bind(this),l=function(){j.logger.warn("ModelLayers error: coudn't get layers from property database.")}.bind(this);a.getLayerToNodeIdMapping(k,l)}}}.bind(this),c=function(b){this.root=b,this.initialized=!0,this.activateLayerState("Initial"),this.viewer.api.dispatchEvent({type:l.MODEL_LAYERS_LOADED_EVENT,model:a,root:b})}.bind(this);this.model=a,(a.is2d()?e(a):f(a)).then(function(a){b(a),c(a)}).catch(function(a){j.logger.warn(a),c(n)})},o.removeModel=function(a){this.model===a&&(this.model=null,this.root=null,this.initialized=!1,this.layerToIndex={},this.indexToLayer=[null],this.nodeToLayer=[])},o.getRoot=function(){return this.initialized||j.logger.warn("Autodesk.Viewing.ModelLayers.getRoot couldn't peform action, layers are still being loaded"),this.root
},o.showAllLayers=function(){g(this,!0)},o.hideAllLayers=function(){g(this,!1)},o.isLayerVisible=function(a){return this.initialized?(a=i(this,a),this.indexToLayer[a]&&this.indexToLayer[a].visible):(j.logger.warn("Autodesk.Viewing.ModelLayers.isLayerVisible couldn't peform action, layers are still being loaded"),!1)},o.setLayerVisible=function(a,b){if(!this.initialized)return void j.logger.warn("Autodesk.Viewing.ModelLayers.setLayersVisible couldn't peform action, layers are still being loaded");var c=Array.isArray(a)?a:[a];c=a.map(function(a){return i(this,a)}.bind(this));var d=this.model,e=this.indexToLayer;if(d.is2d())this.matman.setLayerVisible(c,b),this.viewer.invalidate(!0);else{var f=e.map(function(a){return!(null!==a&&-1!==c.indexOf(a.index)&&a.visible!==b)}),g=[],k=b?this.viewer.visibilityManager.show:this.viewer.visibilityManager.hide;h(this,function(a,b){f[b]||(g.push(a),g.length===m&&(k(g,d),g.length=0))}),g.length>0&&k(g,d)}for(var l=c.length,n=0;n<l;++n){var o=this.indexToLayer[c[n]];o&&(o.visible=b)}},o.getVisibleLayerIndices=function(){if(!this.initialized)return j.logger.warn("Autodesk.Viewing.ModelLayers.getVisibleLayerIndices couldn't peform action, layers are still being loaded"),[];for(var a=(this.model,[]),b=this.indexToLayer,c=b.length,d=1;d<c;++d){var e=b[d];e&&e.visible&&a.push(e.index)}return a},o.activateLayerState=function(a){if(!this.initialized||!this.model)return void j.logger.warn("Autodesk.Viewing.ModelLayers.activateLayerState couldn't peform action, layers are still being loaded");var b=this.model.getData().metadata,c=b?b.layer_states:null;if(!this.model.is3d()&&c&&a){var d;for(d=0;d<c.length&&c[d].name!==a;d++);if(d<c.length){var e=c[d],f=e.visible_layers,g={};if(f&&0<f.length)for(var h=0;h<f.length;h++)g[f[h]]=1;var i=[],k=[];for(var l in b.layers){var m=b.layers[l].name;l|=0,1===g[m]?i.push(l):k.push(l)}this.setLayerVisible(i,!0),this.setLayerVisible(k,!1)}}},o.getLayerStates=function(){if(!this.initialized)return j.logger.warn("Autodesk.Viewing.ModelLayers.getLayerStates couldn't peform action, layers are still being loaded"),null;var a=this.model,b=a?a.getData().metadata:null,c=b?b.layers:null,d=b?b.layer_states:null;if(this.model.is3d()||!c||!d)return null;var e,f={},g={};for(var h in c)if(c.hasOwnProperty(h)){var i=parseInt(h),k=c[h];e="string"==typeof k?k:k.name,f[e]=!0,this.isLayerVisible(i)&&(g[e]=!0)}for(var l=[],m=0;m<d.length;++m){var n=d[m],o=n.visible_layers,p={};if(!n.hidden){if(o&&0<o.length)for(var q=0;q<o.length;++q)e=o[q],f.hasOwnProperty(e)&&(p[e]=!0);l.push({name:n.name,description:n.description,active:function(a,b){var c=Object.getOwnPropertyNames(a),d=Object.getOwnPropertyNames(b);if(c.length!==d.length)return!1;for(var e=0;e<c.length;++e){var f=c[e];if(a[f]!==b[f])return!1}return!0}(g,p)})}}return 0<l.length?l:null}},function(a,b,c){"use strict";function d(){}Object.defineProperty(b,"__esModule",{value:!0}),b.LocalStorage=void 0;var e=c(8),f=function(){if("undefined"==typeof window)return!1;try{var a="lmv_viewer_test_localStorage",b=window.localStorage;return!!b&&(b.setItem(a,"1"),b.removeItem(a),!0)}catch(a){return!1}}();d.prototype.getItem=function(a){return f?window.localStorage.getItem(a):null},d.prototype.setItem=function(a,b){if(f)try{window.localStorage.setItem(a,b)}catch(a){e.logger.debug("avp.LocalStorage: Failed to setItem()")}},d.prototype.removeItem=function(a){f&&window.localStorage.removeItem(a)},d.prototype.isSupported=function(){return f};b.LocalStorage=new d},function(a,b,c){"use strict";function d(a){e.RenderModel.call(this,a),this.myData=a,this.topology=null,this.topologyPromise=null,this.svfUUID=null,this.defaultCameraHash=null;var b="Autodesk.Viewing.Private.HomeViewPFs.";this.getInstanceTree=function(){return this.myData?this.myData.instanceTree:null},this.getFragmentMap=function(){return this.myData?this.myData.instanceTree||this.myData.fragmentMap:null},this.getBoundingBox=function(){return this.myData?this.myData.bbox:null},this.is2d=function(){return!(!this.myData||!this.myData.is2d)},this.is3d=function(){return!this.is2d()},this.isOTG=function(){return this.myData&&!!this.myData.isOTG},this.getFastLoadList=function(){if(this.svfUUID||!f.LocalStorage.isSupported())return JSON.parse(f.LocalStorage.getItem(b+this.svfUUID))},this.setFastLoadList=function(a,c){if(f.LocalStorage.isSupported()&&!f.LocalStorage.getItem(b+this.svfUUID)){var d=this.getDefaultCamera();c.position.x+c.position.z==d.position.x+d.position.z&&f.LocalStorage.setItem(b+this.svfUUID,JSON.stringify(a))}}}Object.defineProperty(b,"__esModule",{value:!0}),b.ModelUnits=void 0,b.Model=d;var e=c(112),f=c(206),g=c(33),h=c(12),i=(c(8),c(128)),j=c(4),k=b.ModelUnits={METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in"};g.EventDispatcher.prototype.apply(d.prototype),d.prototype.constructor=d,d.prototype.getData=function(){return this.myData},d.prototype.setUUID=function(a){this.svfUUID=btoa((0,h.pathToURL)(a))},d.prototype.getDocumentNode=function(){var a=this.getData();return a.loadOptions?a.loadOptions.bubbleNode||null:null},d.prototype.getRoot=function(){var a=this.getData();return a&&a.instanceTree?a.instanceTree.root:null},d.prototype.getRootId=function(){var a=this.getData();if(a){if(a.instanceTree)return a.instanceTree.getRootId();if(a.fragmentMap)return a.fragmentMap.getRootId()}return 0},d.prototype.getUnitData=function(a){var b={unitString:null,unitScale:1};switch(a){case"meter":case"meters":case"m":return b.unitString=k.METER,b.unitScale=1,b;case"foot":case"feet":case"ft":return b.unitString=k.FOOT,b.unitScale=.3048,b;case"feet and inches":case"inch":case"inches":case"in":return b.unitString=k.INCH,b.unitScale=.0254,b;case"centimeter":case"centimeters":case"cm":return b.unitString=k.CENTIMETER,b.unitScale=.01,b;case"millimeter":case"millimeters":case"mm":return b.unitString=k.MILLIMETER,b.unitScale=.001,b;default:return b}},d.prototype.getUnitScale=function(){var a;if(this.is2d())a=this.getMetadata("page_dimensions","page_units",null);else{var b=this.getData();a=b&&b.overriddenUnits?b.overriddenUnits:b&&b.scalingUnit?b.scalingUnit:this.getMetadata("distance unit","value",null)}return a&&(a=a.toLowerCase()),this.getUnitData(a).unitScale},d.prototype.getUnitString=function(){var a;if(this.is2d())a=this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null);else{var b=this.getData();a=b&&b.overriddenUnits?b.overriddenUnits:b&&b.scalingUnit?b.scalingUnit:this.getMetadata("distance unit","value",null)}return a&&(a=a.toLowerCase()),this.getUnitData(a).unitString},d.prototype.getDisplayUnit=function(){var a;if(this.is2d())a=this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null);else{var b=this.getData();a=b&&b.scalingUnit?b.scalingUnit:this.getMetadata("distance unit","value",null)}return a&&(a=a.toLowerCase()),this.getUnitData(a).unitString},d.prototype.getMetadata=function(a,b,c){var d=this.getData();if(d){var e=d.metadata;if(e){var f=e[a];if(void 0!==f){if(!b)return f;var g=f[b];if(void 0!==g)return g}}}return c},d.prototype.getDefaultCamera=function(){var a=this.getData();if(!a)return null;var b=null,c=a.cameras?a.cameras.length:0;if(0<c){var d=this.getMetadata("default camera","index",null);if(null!==d&&a.cameras[d])b=a.cameras[d];else{for(var e=0;e<c;e++){var f=a.cameras[e];if(f.isPerspective){b=f;break}}b||(b=a.cameras[0])}}return b},d.prototype.isAEC=function(){return!!this.getData().loadOptions.isAEC},d.prototype.getUpVector=function(){return this.getMetadata("world up vector","XYZ",null)},d.prototype.geomPolyCount=function(){var a=this.getGeometryList();return a?a.geomPolyCount:null},d.prototype.instancePolyCount=function(){var a=this.getGeometryList();return a?a.instancePolyCount:null},d.prototype.isLoadDone=function(){var a=this.getData();return!(!a||!a.loadDone)},d.prototype.isObjectTreeCreated=function(){return!!this.getData().instanceTree},d.prototype.getPropertyDb=function(){var a=this.getData();return a&&a.propDbLoader},d.prototype.getProperties=function(a,b,c){var d=this.getPropertyDb();if(!d||a<=0)return void(c&&c());d.getProperties(a,b,c)},d.prototype.getBulkProperties=function(a,b,c,d){Array.isArray(b)&&(b={propFilter:b}),b=b||{};var e=b.propFilter||null,f=b.ignoreHidden||!1,g=this.getPropertyDb();if(!g)return void(d&&d());g.getBulkProperties(a,e,c,d,f)},d.prototype.getExternalIdMapping=function(a,b){var c=this.getPropertyDb();if(!c)return void(b&&b());c.getExternalIdMapping(a,b)},d.prototype.getLayerToNodeIdMapping=function(a,b){var c=this.getPropertyDb();if(!c)return void(b&&b());c.getLayerToNodeIdMapping(a,b)},d.prototype.getObjectTree=function(a,b){var c=this.getPropertyDb();if(!c)return void(b&&b());c.getObjectTree(a,b)},d.prototype.isObjectTreeLoaded=function(){var a=this.getPropertyDb();return!!a&&a.isObjectTreeLoaded()},d.prototype.search=function(a,b,c,d){var e=this.getPropertyDb();if(!e)return void(c&&c());e.searchProperties(a,d,b,c)},d.prototype.findProperty=function(a){var b=this.getPropertyDb();return b?b.findProperty(a):Promise.reject("Model doesn't have any properties.")};var l=function(a){var b=a;if(Math.abs(b[0])<.001)if(Math.abs(b[4])>.001)for(var c=0;c<4;c++){var d=b[c];b[c]=b[c+4],b[c+4]=d}else for(var c=0;c<4;c++){var d=b[c];b[c]=b[c+8],b[c+8]=d}if(Math.abs(b[5])<.001)for(var c=4;c<8;c++){var d=b[c];b[c]=b[c+4],b[c+4]=d}},m=function(a,b,c,d){var e,f,g,h,i,j,k=!1;g=d[c[c.length-1]].x,h=d[c[c.length-1]].y,e=h>=b;for(var l=0,m=c.length;l<m;++l)i=d[c[l]].x,j=d[c[l]].y,f=j>=b,e!=f&&(j-b)*(g-i)>=(i-a)*(h-j)==f&&(k=!k),e=f,g=i,h=j;return k};d.prototype.pointInPolygon=function(a,b,c,d){for(var e=!1,f=0;f<c.length;f++)m(a,b,c[f],d)&&(e=!e);return e},d.prototype.getPageToModelTransform=function(a){var b=this.getData();if(b.pageToModelTransform)return b.pageToModelTransform;var c=b,d=c.metadata,e=d.page_dimensions,f=c.viewports[a];if(!f)return new THREE.Matrix4;c.viewportTransforms||(c.viewportTransforms=new Array(c.viewports.length));var g=c.viewportTransforms[a];if(g)return g;var h=new i.LmvMatrix4(!0).set(e.logical_width/e.page_width,0,0,e.logical_offset_x,0,e.logical_height/e.page_height,0,e.logical_offset_y,0,0,1,0,0,0,0,1),j=f.transform.slice();l(j);var k=new i.LmvMatrix4(!0);k.elements.set(j);var m=new i.LmvMatrix4(!0);return m.getInverse(k),m.multiply(h),c.viewportTransforms[a]=m,m},d.prototype.pageToModel=function(a,b,c){function d(a){if(a){var b=(new THREE.Vector3).set(a.x,a.y,0).applyMatrix4(e);a.x=b.x,a.y=b.y}}var e=this.getPageToModelTransform(c);d(a),d(b)},d.prototype.pointInClip=function(a,b){for(var c=this.getData().clips,d=[],e=1;e<c.length;e++)if(e!==b){for(var f=[],g=[],h=c[e].contourCounts,i=c[e].points,j=0,k=[],l=0;l<h.length;l++){for(var m=0;m<h[l];m++)f.push(j),j++;g.push(f),f=[]}for(var l=0;l<i.length;l+=2){var n={x:i[l],y:i[l+1]};k.push(n)}var o=this.pointInPolygon(a.x,a.y,g,k);o&&d.push(e)}return d},d.prototype.getClip=function(a){for(var b=this.getData().clips,c=[],d=[],e=b[a].contourCounts,f=b[a].points,g=0,h=[],i=0;i<e.length;i++){for(var j=0;j<e[i];j++)c.push(g),g++;d.push(c),c=[]}for(var i=0;i<f.length;i+=2){var k={x:f[i],y:f[i+1]};h.push(k)}return{contours:d,points:h}},d.prototype.getTopoIndex=function(a){var b=this.getData();if(b&&b.fragments){var c=b.fragments.topoIndexes;if(c)return c[a]}},d.prototype.getTopology=function(a){return this.topology?this.topology[a]:null},d.prototype.hasTopology=function(){return!!this.topology},d.prototype.fetchTopology=function(a){if(this.topology)return Promise.resolve(this.topology);var b=this.getData();if(!b.topologyPath)return Promise.reject({error:"no-topology"});var c=a||((0,j.isMobileDevice)()?20:100);if(b.topologySizeMB>c)return Promise.reject({error:"topology-too-big",limitMB:c,topologyMB:b.topologySizeMB});if(!this.topologyPromise){var d=this;this.topologyPromise=new Promise(function(a,b){d.loader.fetchTopologyFile(d.getData().topologyPath,function(c){c&&c.topology?(d.topology=c.topology,a(c.topology)):b(c)})})}return this.topologyPromise},d.prototype.hasGeometry=function(){var a=this.getData();return!!a&&(!!a.isLeaflet||a.fragments.length>0)}},function(a,b,c){"use strict";function d(a,b,c){this.myPath=b,this.myData=a,a&&(this.docRoot=new f.BubbleNode(a)),this.myViewGeometry={},this.myNumViews={},this.myPropertyDb=null,this.acmSessionId=c;var d=this;this.docRoot.traverse(function(a){if(!d.myPropertyDb&&a.isGeometry()){var b=a.findPropertyDbPath();d.myPropertyDb=b}if(a.isGeometry()){var c=0,e=a.children;if(e)for(var f=0;f<e.length;f++){var g=e[f];g.isViewPreset()&&(d.myViewGeometry[g.guid()]=a,c++)}d.myNumViews[a.guid()]=c}}),0===this.docRoot.findAllViewables().length&&l.logger.error("Document contains no viewables.")}Object.defineProperty(b,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};b.Document=d;var f=c(200),g=c(13),h=c(9),i=c(12),j=c(4),k=c(209),l=c(8),m=c(7),n=(0,j.getGlobal)();d.load=function(a,b,c,e){function f(a){h.endpoint.getApiFlavor()===h.endpoint.ENDPOINT_API_FLUENT&&(l=a.urn);var e=new d(a,p,l);if(e.getRoot().search({type:"geometry"}).length>0)o=e.getGlobalMessages(),b&&b(e,o);else if(c){o=e.getGlobalMessages();var f=g.ErrorCodes.BAD_DATA_NO_VIEWABLE_CONTENT;c(f,"No viewable content",o)}}function j(a,b,d){if(401===a&&void 0===n.LMV_THIRD_PARTY_COOKIE)n.LMV_THIRD_PARTY_COOKIE=!1,(0,m.refreshRequestHeader)(m.token.accessToken),k();else if(c){var e="Error: "+a+" ("+b+")",f=(0,g.getErrorCode)(a);c(f,e,a,b,d)}}function k(){!l&&e?i.ViewingService.getACMSession(h.endpoint.getApiEndpoint(),e,function(a){l=a;var b={queryParams:l?"acmsession="+l:""};i.ViewingService.getManifest(h.endpoint.initLoadContext(b),p,f,j)},c):i.ViewingService.getManifest(h.endpoint.initLoadContext(),p,f,j)}var l,o,p=d.getDocumentPath(a);k()},d.getDocumentPath=function(a){if(-1===a.indexOf("urn:")){if(-1!==a.indexOf("://"))return a;var b=a;return"undefined"!=typeof window?(0!==b.indexOf("/")&&(b="/"+b),window.location.protocol+"//"+window.location.host+b):b}return a},d.requestThumbnailWithSecurity=function(a,b){var c=function(a){b(null,a)},d=function(){b("error",null)},e={responseType:"blob",skipAssetCallback:!0,size:a.width,guid:a.guid},f="urn:"+a.urn;i.ViewingService.getThumbnail(h.endpoint.initLoadContext(),f,c,d,e)},d.prototype.getFullPath=function(a){if(!a)return a;var b=a;return(0,h.isOffline)()?-1==b.indexOf((0,h.getOfflineResourcePrefix)())&&(b=decodeURIComponent((0,h.getOfflineResourcePrefix)())+b.substr(b.indexOf("/"))):0===a.indexOf("urn")?b=h.endpoint.getItemApi(null,a):0===a.indexOf("$file$")&&(b=this.myPath.replace("/bubble.json","")+a.replace("$file$","")),b},d.prototype.getThumbnailOptions=function(a,b,c){var d=b||200,e=c||200;return{urn:this.myData.urn,width:d,height:e,guid:a.guid,acmsession:this.acmSessionId}},d.prototype.getThumbnailPath=function(a,b,c){var d=this.getThumbnailOptions(a,b,c),e=h.endpoint.getThumbnailApi(null,d.urn)+"?guid="+d.guid+"&width="+d.width+"&height="+d.height;return d.acmsession&&(e+="&acmsession="+d.acmsession),e},d.prototype.getLeafletZipParams=function(a,b){for(var c,d,e=b.search({role:"leaflet-zip"},!1),f=0;f<e.length;f++)d={},c=e[f]._raw(),d.urnZip=this.getFullPath(c.urn),d.centralDirOffset=c.central_dir_offset,d.centralDirLength=c.central_dir_length,d.centralDirEntries=c.central_dir_entries,d.zipMaxLevel=c.max_level-a.levelOffset,d.loadFromZip=!!(d.urnZip&&d.centralDirOffset&&d.centralDirLength&&d.centralDirEntries),a.zips||(a.zips=[]),a.zips.push(d);a.zips.sort(function(a,b){return a.zipMaxLevel-b.zipMaxLevel})},d.prototype.getLeafletParams=function(a,b,c){a.tileSize=c.tileSize?c.tileSize:512,a.texWidth=c.resolution[0],a.texHeight=c.resolution[1],a.paperWidth=c.paperWidth,a.paperHeight=c.paperHeight,a.paperUnits=c.paperUnits,a.urlPattern=c.urn,a.mime=c.mime,a.levelOffset=k.LeafletLoader.computeLevelOffset(a.tileSize),this.getLeafletZipParams(a,b),a.loadFromZip=a.zips&&a.zips[0].loadFromZip,a.zips&&(0,h.isOffline)()&&(0,j.isMobileDevice)()&&(a.zips=a.zips.slice(0,1),a.maxLevel=a.zips[0].zipMaxLevel)},d.prototype.getViewableUrn=function(a,b){var c=a instanceof f.BubbleNode?a:new f.BubbleNode(a);if(c.isGeometry()){var d=[];if(c.is3D())return c.getViewableRootPath();if(c.is2D()&&(d=c.search(f.BubbleNode.LEAFLET_NODE),d.length>0&&b&&this.getLeafletParams(b,c,d[0].data),0===d.length&&(d=c.search(f.BubbleNode.IMAGE_NODE)),0===d.length&&(d=c.search(f.BubbleNode.GEOMETRY_F2D_NODE))),d.length>0)return d[0].urn()}else if(c.isViewPreset()){var e=this.getViewGeometry(c,!0);if(e)return this.getViewableUrn(e,b)}return""},d.prototype.getViewablePath=function(a,b){var c=this.getViewableUrn(a,b);return c?this.getFullPath(c):""},d.prototype.getPropertyDbPath=function(){return this.getFullPath(this.myPropertyDb)},d.prototype.getRootItem=function(){return this.myData},d.prototype.getRoot=function(){return this.docRoot},d.prototype.getPath=function(){return this.myPath},d.prototype.getItemById=function(a){function b(c){if(!c)return null;for(var d in c){var f=c[d];if("guid"===d&&f===a)return c;if(null!==f&&"object"===(void 0===f?"undefined":e(f))&&"parent"!==d){var g=b(f);if(g)return g}}return null}return b(this.myData)},d.getSubItemsWithProperties=function(a,b,c){var e=[];if(!a)return[];for(var f=a.children||a.derivatives,g=f?f.length:0,h=0;h<g;h++){var i=f[h];(function(a,b){for(var c in b)if(!(c in a)||b[c]!==a[c])return!1;return!0})(i,b)&&e.push(i),c&&e.push.apply(e,d.getSubItemsWithProperties(i,b,c))}return e},d.getViewableItems=function(a,b){return b?a.getRoot().findAllViewables():(console.warn("Deprecated use of Document.getViewableItems(). Adjust call too pass 'true' as second argument and use BubbleNode result."),d.getSubItemsWithProperties(a.getRootItem(),{type:"folder",role:"viewable"},!0).concat(d.getSubItemsWithProperties(a.getRootItem(),{outputType:"svf"},!0)))},d.prototype.getViewGeometry=function(a,b){return b?this.myViewGeometry[a.guid()]:this.myViewGeometry[a.guid()]._raw()},d.prototype.getNumViews=function(a){return a instanceof f.BubbleNode||(console.warn("Deprecated use of Document.getNumViews(). Pass in instance of BubbleNode instead of raw JSON."),a=new f.BubbleNode(a)),this.myNumViews[a.guid()]||0},d.prototype.getParentId=function(a){var b=this.getItemById(a);if(!b)return null;var c=b.parent;return c?c.guid:null},d.prototype.getMessages=function(a,b){var c=[];if(!a)return c;if(a instanceof f.BubbleNode)for(var d=a;d&&(!b||d.parent);)d._raw().messages&&(c=c.concat(d._raw().messages)),d=d.parent;else{console.warn("deprecated call to getMessages. Call with BubbleNode instead of raw manifest JSON");var e=null;b&&(e=this.getRootItem());for(var d=a;d&&(!b||parent!==e);)d.messages&&(c=c.concat(d.messages)),d=d.parent}return c},d.prototype.getGlobalMessages=function(){var a=[],b=0,c=0;this.getRoot().traverse(function(d){var e=d._raw().messages||[];e.filter(function(a){return"error"===a.type}).length>0&&(b+=1),"inprogress"===d._raw().status&&(c+=1),a=a.concat(e)});var d="translated";d=b>0?"failed":d,d=c>0?"processing":d;for(var e=a.length;e--;a[e].$translation=d);return a}},function(a,b,c){"use strict";function d(a){var b=a,c=function(a,b){var c=[80,75,1,2],d=b;if(a[d++]!==c[0]||a[d++]!==c[1]||a[d++]!==c[2]||a[d++]!==c[3])return g.logger.error("invalid file header signature"),null;var e={};return e.version=a[d++],e.os=a[d++],e.needVersion=a[d++]|a[d++]<<8,e.flags=a[d++]|a[d++]<<8,e.compression=a[d++]|a[d++]<<8,e.time=a[d++]|a[d++]<<8,e.date=a[d++]|a[d++]<<8,e.crc32=(a[d++]|a[d++]<<8|a[d++]<<16|a[d++]<<24)>>>0,e.compressedSize=(a[d++]|a[d++]<<8|a[d++]<<16|a[d++]<<24)>>>0,e.plainSize=(a[d++]|a[d++]<<8|a[d++]<<16|a[d++]<<24)>>>0,e.fileNameLength=a[d++]|a[d++]<<8,e.extraFieldLength=a[d++]|a[d++]<<8,e.fileCommentLength=a[d++]|a[d++]<<8,e.diskNumberStart=a[d++]|a[d++]<<8,e.internalFileAttributes=a[d++]|a[d++]<<8,e.externalFileAttributes=a[d++]|a[d++]<<8|a[d++]<<16|a[d++]<<24,e.relativeOffset=(a[d++]|a[d++]<<8|a[d++]<<16|a[d++]<<24)>>>0,e.filename=String.fromCharCode.apply(null,a.slice(d,d+=e.fileNameLength)),e.extraField=a.slice(d,d+=e.extraFieldLength),e.comment=a.slice(d,d+e.fileCommentLength),e.length=d-b,e},d=function(a){var b=[80,75,3,4],c=0;if(a[c++]!==b[0]||a[c++]!==b[1]||a[c++]!==b[2]||a[c++]!==b[3])return g.logger.error("invalid local file header signature"),null;var d={};return d.needVersion=a[c++]|a[c++]<<8,d.flags=a[c++]|a[c++]<<8,d.compression=a[c++]|a[c++]<<8,d.time=a[c++]|a[c++]<<8,d.date=a[c++]|a[c++]<<8,d.crc32=(a[c++]|a[c++]<<8|a[c++]<<16|a[c++]<<24)>>>0,d.compressedSize=(a[c++]|a[c++]<<8|a[c++]<<16|a[c++]<<24)>>>0,d.plainSize=(a[c++]|a[c++]<<8|a[c++]<<16|a[c++]<<24)>>>0,d.fileNameLength=a[c++]|a[c++]<<8,d.extraFieldLength=a[c++]|a[c++]<<8,d.filename=String.fromCharCode.apply(null,a.slice(c,c+=d.fileNameLength)),d.extraField=a.slice(c,c+=d.extraFieldLength),d.length=c,d},k=function(a){var b=d(a),c=b.length,e=b.compressedSize;return a.slice(c,c+e)},n=function(a,b,d){for(var e,f=0,g=[],h=null,i=0;i<d;++i){if(!(e=c(a,f)))return null;h&&(h.contentSize=e.relativeOffset-h.relativeOffset),f+=e.length,g[e.filename]=e,h=e}return h.contentSize=b-h.relativeOffset,g},p=function(a,b,c,d,e,f){var g=null;if(!(0,m.isOffline)()){b&&(g="acmsession="+b);var i="start="+c+"&end="+(d+c);g?g+="&"+i:g=i}var j=(0,m.initLoadContext)({queryParams:g});h.ViewingService.getItem(j,a,e,f)};this.continueLoadFile=function(a,c,d,f,h,j){function k(){function f(c){this.bbox=new o.Box3,this.basePath=a,this.is2d=!0;var d=c&&c.paperWidth>=0?c.paperWidth:h.texWidth,f=c&&c.paperHeight>=0?c.paperHeight:h.texHeight;this.pageToModelTransform=h.getPageToModelTransform(d,f),this.metadata={},this.metadata.page_dimensions={};var g=this.metadata.page_dimensions;g.page_width=d,g.page_height=f,g.page_units=c.paperUnits,this.loadDone=!0,this.isLeaflet=!0,b.signalProgress(100,e.ProgressState.LOADING),h.texWidth>0&&(this.maxPixelPerUnit=h.texWidth/h.getQuadWidth(),h.isSimpleImage&&(this.maxPixelPerUnit*=10))}var i=new f(c.loadOptions);i.loadOptions=c,p.getVisibleBounds(i.bbox);var j=new l.Model(i);j.initFromCustomIterator(p),p.callWhenRefined(function(){var a=Date.now();i.loadTime=a-n.t0,g.logger.log("SVF load: "+i.loadTime)}),d(null,j)}var m,n=this;if(c.loadOptions&&c.loadOptions.loadFromZip){m="{z}/{x}_{y}."+c.loadOptions.mime.split("/")[1]}else m=a;h.initFromLoadOptions(m,c.loadOptions,j);var p=null;f&&f();var q=!h.valid();q&&h.initForSimpleImage(a,k),h.pixelRatio=b.glrenderer().getPixelRatio(),p=new i.ModelIteratorTexQuad(h,b.getMaterials()),q||k()},this.loadFile=function(a,b,c,d){var e=this;this.t0=Date.now();var h=new i.TexQuadConfig,l=null,q=b.acmSessionId;if(b.loadOptions&&b.loadOptions.loadFromZip){l=function(a,b,c){for(var d,e=a.split("/")[0]-h.levelOffset,f=0;f<h.zips.length;f++)if(e<=h.zips[f].zipMaxLevel){d=h.zips[f];break}if(!d)return c("Failed loading texture - tile's level doesn't exists."),!1;var g=d.fileTable[a];if(!g)return c("Failed loading texture - entry does not exist inside fileTable."),!1;var i={extractImage:k},l=g.relativeOffset,m=g.relativeOffset+g.contentSize;if(d.rawData)i.rawData=d.rawData.slice(l,m);else{var n="start="+l+"&end="+m;i.queryParams=n}j.TextureLoader.loadTextureWithSecurity(d.urnZip,!1,o.UVMapping,b,q,!0,i)};var r=function(){return b.loadOptions.zips.every(function(a){return!!a.fileTable})};b.loadOptions.zips.forEach(function(i){var j=i.centralDirOffset,k=i.centralDirLength,o=i.centralDirEntries,s=function(f){(0,m.isOffline)()&&(i.rawData=f,f=f.slice(j,j+k));var g=n(f,j,o);if(!g)return c("Failed parsing central directory of the zip.",null),!1;i.fileTable=g,r()&&e.continueLoadFile(a,b,c,d,h,l)},t=function(a){g.logger.error("Zip download failed: "+a.statusText,(0,f.errorCodeString)(f.ErrorCodes.NETWORK_FAILURE)),c("Zip download failed: "+a.statusText,null)};p(i.urnZip,q,j,k,s,t)})}else l=function(a,b,c){j.TextureLoader.loadTextureWithSecurity(a,!1,o.UVMapping,b,q,!0)},this.continueLoadFile(a,b,c,d,h,l)}}Object.defineProperty(b,"__esModule",{value:!0}),b.LeafletLoader=d;var e=c(210),f=c(13),g=c(8),h=c(12),i=c(134),j=c(139),k=c(199),l=c(207),m=c(9),n=c(2),o=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(n);d.computeLevelOffset=function(a){for(var b=1,c=0,d=0;d<20;d++){if((b*=2)>a)return c;c++}return g.logger.log("unexpected leaflet tileSize"),0},d.prototype.is3d=function(){return!1},k.FileLoaderManager.registerFileLoader("Leaflet",["jpeg","jpg","png"],d)},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.ProgressState={ROOT_LOADED:0,LOADING:1,RENDERING:2}},function(a,b,c){"use strict";function d(a,b){function c(a,c){if(k){if(l.hasTag(a,"no-storage"))return;var d=b.prefix+a;return void 0!==c?localStorage[d]=c:c=localStorage[d],c}}function d(a,b){if("string"!=typeof a||"function"==typeof l[a])return void g.logger.log("Preferences: invalid name="+a);var d=c(a),e=!1;if(void 0!==d)try{d=JSON.parse(d),e=!0}catch(a){}l[a]=e?d:b,j[a]={}}function e(a){k&&(a=b.prefix+a,delete localStorage[a])}"string"==typeof b&&(b={prefix:b}),b||(b={}),b.prefix||(b.prefix="Autodesk.Viewing.Preferences."),b.hasOwnProperty("localStorage")||(b.localStorage=!0);var h={},i={},j={},k=b.localStorage&&function(){var a=b.prefix+"test";try{var c=window.localStorage;return c.setItem(a,"1"),c.removeItem(a),!0}catch(a){return!1}}(),l=this;a.addEventListener(f.PREF_CHANGED_EVENT,function(a){var b=i[a.name];if(b){var c=b.changed;c&&c(a.value)}}),a.addEventListener(f.PREF_RESET_EVENT,function(a){var b=i[a.name];if(b){var c=b.reset;c&&c(a.value)}}),this.load=function(a){h=a;for(var b in h)h.hasOwnProperty(b)&&d(b,h[b])},this.tag=function(a,b){if(a){b?Array.isArray(b)||(b=[b]):b=Object.keys(h);for(var c=0;c<b.length;++c)j[b[c]]&&(j[b[c]][a]=!0)}},this.untag=function(a,b){if(a){b?Array.isArray(b)||(b=[b]):b=Object.keys(h);for(var c=0;c<b.length;++c)j[b[c]]&&(j[b[c]][a]=!1)}},this.hasTag=function(a,b){var c=j[a];return!!c&&!0===c[b]},this.add=function(a,b,c){if(!h.hasOwnProperty(a)){if(h[a]=b,d(a,b),c){Array.isArray(c)||(c=[c]);for(var e=0;e<c.length;++e)this.tag(c[e],a)}return!0}return g.logger.log("Preferences: "+a+" already exists"),!1},this.remove=function(a,b){return!!h.hasOwnProperty(a)&&(delete h[a],delete j[a],delete this[a],b&&e(a),!0)},this.reset=function(b,c){b&&void 0===c&&(c=!0);for(var d in h)if(h.hasOwnProperty(d)){if(b){var g=!!j[d][b];if(c&&!g||!c&&g)continue}this.set(d,h[d],!1)&&a.dispatchEvent({type:f.PREF_RESET_EVENT,name:d,value:this[d]}),e(d)}},this.get=function(a){return this[a]},this.set=function(b,d,e){return this[b]!==d&&(this[b]=d,c(b,d),(void 0===e||e)&&a.dispatchEvent({type:f.PREF_CHANGED_EVENT,name:b,value:d}),!0)},this.addListeners=function(a,b,c){i[a]={changed:b,reset:c}},this.removeListeners=function(a){void 0!==i[a]&&delete i[a]}}Object.defineProperty(b,"__esModule",{value:!0}),b.Preferences=d;var e=c(198),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(8)},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(){if(window.WebGLRenderingContext){for(var a=document.createElement("canvas"),b=["webgl","experimental-webgl","moz-webgl","webkit-3d"],c=!1,d=0;d<4;d++)try{if((c=a.getContext(b[d]))&&"function"==typeof c.getParameter)return 1}catch(a){}return 0}return-1}function f(a){return a instanceof MouseEvent&&1===a.button}function g(a,b){if(!(a instanceof MouseEvent))return!1;var c=a.button;return"buttons"in a&&(!T||1&a.buttons?2===c&&1&a.buttons&&(c=0,T=!0):(T=!1,c=0)),c===(!!b&&b.getUseLeftHandedInput()?0:2)}function h(a,b){if(a){if(this.clientContainer=a,this.container=document.createElement("div"),this.container.classList.add("adsk-viewing-viewer"),this.container.style.height="100%",this.container.style.width="100%",this.container.style.overflow="hidden",this.container.classList.add((0,k.isTouchDevice)()?"touch":"notouch"),this.clientContainer.appendChild(this.container),this.config=b||(0,O.createViewerConfig)(),this.contextMenu=null,this.contextMenuCallbacks={},this.started=!1,this.theme=this.config.theme||"dark-theme",this.container.classList.add(this.theme),this.containerLayerOrder=this.config.containerLayerOrder||S,(0,k.isChrome)()&&this.container.classList.add("quality-text"),"CANVAS"===this.container.nodeName)throw"Viewer must be initialized on a div [temporary]";this.canvasWrap=document.createElement("div"),this.canvasWrap.classList.add("canvas-wrap"),this.canvas=document.createElement("canvas"),this.canvas.tabIndex=0,this.canvas.setAttribute("data-viewer-canvas","true"),this.canvasWrap.appendChild(this.canvas),this.container.appendChild(this.canvasWrap),this.canvas.viewer=this}var c={prefix:"Autodesk.Viewing.Private.GuiViewer3D.SavedSettings.",localStorage:!(0,k.isNodeJS)()};this.prefs=new n.Preferences(this,c),this._hotkeyManager=new t.HotkeyManager,this.extensionCache=null,this.running=!1,this._pushedTool="",this._defaultNavigationTool="",this.id=Q++,this.impl=new L.Viewer3DImpl(this.canvas,this),this.trackADPTimer=[]}Object.defineProperty(b,"__esModule",{value:!0}),b.DefaultSettings=void 0,b.isMiddleClick=f,b.isRightClick=g,b.Viewer3D=h;var i=c(2),j=d(i),k=c(4),l=c(197),m=c(8),n=c(211),o=c(6),p=c(13),q=c(33),r=c(204),s=c(202),t=c(213),u=c(215),v=c(216),w=c(217),x=c(218),y=c(219),z=c(35),A=c(9),B=c(198),C=d(B),D=c(199),E=c(220),F=c(196),G=c(7),H=c(195),I=c(221),J=c(222),K=c(224),L=c(225),M=c(200),N=c(124),O=c(232),P=c(214),Q=0,R=b.DefaultSettings={ambientShadows:!0,antialiasing:!(0,k.isMobileDevice)(),groundShadow:!0,groundReflection:!1,progressiveRendering:!0,renderCache:!1,swapBlackAndWhite:!1,openPropertiesOnSelect:!1,ghosting:!0,viewCube:!(0,k.isMobileDevice)(),lineRendering:!0,pointRendering:!0,edgeRendering:!1,grayscale:!1,lightPreset:l.DefaultLightPreset,backgroundColorPreset:null,reverseMouseZoomDir:!1,reverseHorizontalLookDirection:!1,reverseVerticalLookDirection:!1,alwaysUsePivot:!1,zoomTowardsPivot:!1,orbitPastWorldPoles:!0,leftHandedMouseSetup:!1,clickToSetCOI:!1,optimizeNavigation:(0,k.isMobileDevice)(),fusionOrbit:!0,fusionOrbitConstrained:!0,envMapBackground:!1,firstPersonToolPopup:!0,bimWalkToolPopup:!0,wheelSetsPivot:!1},S=["markups-svg","pushpin-container"],T=!1;q.EventDispatcher.prototype.apply(h.prototype),r.ScreenModeMixin.prototype.apply(h.prototype),s.ExtensionMixin.prototype.apply(h.prototype),h.prototype.constructor=h,Object.defineProperty(h.prototype,"model",{get:function(){return this.impl.model},set:function(){throw"Do not set viewer.model"}}),h.ScreenMode=r.ScreenMode,h.ViewerCount=0,h.kDefaultCanvasConfig={click:{onObject:["selectOnly"],offObject:["deselectAll"]},clickAlt:{onObject:["setCOI"],offObject:["setCOI"]},clickCtrl:{onObject:["selectToggle"]},clickShift:{onObject:["selectToggle"]},disableSpinner:!1,disableMouseWheel:!1,disableTwoFingerSwipe:!1},h.prototype.start=function(a,b,c,d){if(this.started)return 0;this.started=!0;var e=this,f=e.initialize();return 0!==f?(d&&setTimeout(function(){d(f)},1),f):(setTimeout(function(){e.setUp(e.config)},1),a&&this.loadModel(a,b,c,d),0)},h.prototype.startWithDocumentNode=function(a,b,c){var d=this;return new Promise(function(e,f){if(d.started)return 0;d.started=!0;var g=d.initialize();if(0!==g)return void setTimeout(function(){f(g)},1);setTimeout(function(){d.setUp(d.config)},1),d.loadDocumentNode(a,b,c).then(e).catch(f)})},h.prototype.registerUniversalHotkeys=function(){var a,b,c,d=this;a=function(){return d.navigation.setRequestFitToView(!0),!0},d._hotkeyManager.pushHotkeys("Autodesk.FitToView",[{keycodes:[P.KeyCode.f],onPress:a}]),a=function(){return d.navigation.setRequestHomeView(!0),!0},d._hotkeyManager.pushHotkeys("Autodesk.Home",[{keycodes:[P.KeyCode.h],onPress:a
},{keycodes:[P.KeyCode.HOME],onPress:a}]),b=function(){return!(!d.objectContextMenu||!d.objectContextMenu.hide())||(d.dispatchEvent({type:C.ESCAPE_EVENT}),!0)},d._hotkeyManager.pushHotkeys("Autodesk.Escape",[{keycodes:[P.KeyCode.ESCAPE],onRelease:b}]),a=function(){return c=d.getActiveNavigationTool(),d.setActiveNavigationTool("pan")},b=function(){return d.setActiveNavigationTool(c)};var e=[{keycodes:[P.KeyCode.SHIFT],onPress:a,onRelease:b},{keycodes:[P.KeyCode.SPACE],onPress:a,onRelease:b}];d._hotkeyManager.pushHotkeys("Autodesk.Pan",e,{tryUntilSuccess:!0})},h.prototype.createControls=function(){var a=this,b=a.impl;return a.navigation=new u.Navigation(b.camera),a.__initAutoCam(b),a.utilities=new w.ViewingUtilities(b,a.autocam,a.navigation),a.clickHandler=new x.DefaultHandler(b,a.navigation,a.utilities),a.toolController=new v.ToolController(b,a,a.autocam,a.utilities,a.clickHandler),a.toolController.registerTool(new y.GestureHandler(a)),a.toolController.registerTool(a._hotkeyManager),a.toolController.activateTool(a._hotkeyManager.getName()),a.registerUniversalHotkeys(),a.toolController.registerTool(new I.OrbitDollyPanTool(b,a)),a.toolController},h.prototype.initialize=function(){this.setScreenModeDelegate(this.config?this.config.screenModeDelegate:void 0);var a=this.getDimensions();if(this.canvas.width=a.width,this.canvas.height=a.height,(0,k.isIOSDevice)()&&window.devicePixelRatio&&(this.canvas.width/=window.devicePixelRatio,this.canvas.height/=window.devicePixelRatio),this.impl.initialize(),!this.impl.glrenderer()){var b=e();if(b<=0)return-1===b?p.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED:p.ErrorCodes.BROWSER_WEBGL_DISABLED}var c=this;if((0,k.isIOSDevice)()){var d;this.onResizeCallback=function(a){clearTimeout(d),d=setTimeout(c.resize.bind(c),500)}}else this.onResizeCallback=function(a){var b=c.impl.camera.clientWidth,d=c.impl.camera.clientHeight,e=c.container.clientWidth,f=c.container.clientHeight;b===e&&d===f||c.resize()};window.addEventListener("resize",this.onResizeCallback,!1),this.onScrollCallback=function(a){c.impl.canvasBoundingclientRectDirty=!0},window.addEventListener("scroll",this.onScrollCallback),this.initContextMenu(),this.localize(),this.impl.controls=this.createControls(),this.setDefaultNavigationTool("orbit"),this.impl.controls&&this.impl.controls.setAutocam(this.autocam);var f=this.config&&this.config.canvasConfig?this.config.canvasConfig:h.kDefaultCanvasConfig;if(this.setCanvasClickBehavior(f),!f.disableSpinner){this.loadSpinner=document.createElement("div"),this.loadSpinner.className="spinner",this.container.appendChild(this.loadSpinner);for(var g=1;g<=3;g++){var i=document.createElement("div");i.className="bounce"+g,this.loadSpinner.appendChild(i)}}return this.initSettings(),this.viewerState=new F.ViewerState(this),this.config&&this.config.hasOwnProperty("startOnInitialize")&&!this.config.startOnInitialize||this.run(),window.NOP_VIEWER=this,this.addEventListener(C.MODEL_ADDED_EVENT,function(a){c.onModelAdded(a.model,a.preserveTools)}),this.dispatchEvent(C.VIEWER_INITIALIZED),this.trackADPSettingsOptions(),this.trackADPExtensionsLoaded(),h.ViewerCount++,0},h.prototype.setUp=function(a){if(this.config=a,this.config&&this.config.hasOwnProperty("extensions"))for(var b=this.config.extensions,c=0;c<b.length;++c)this.loadExtension(b[c],this.config);"true"===(0,o.getParameterByName)("lmv_viewer_debug")&&this.loadExtension("Autodesk.Debug",this.config);var d=this.config&&this.config.canvasConfig?this.config.canvasConfig:h.kDefaultCanvasConfig;this.setCanvasClickBehavior(d)},h.prototype.tearDown=function(){if(this.clearSelection(),this.loadedExtensions){for(var a in this.loadedExtensions)try{this.unloadExtension(a)}catch(b){m.logger.error("Failed to unload extension: "+a,b,(0,p.errorCodeString)(p.ErrorCodes.VIEWER_INTERNAL_ERROR)),m.logger.track({category:"error_unload_extension",extensionId:a,error_message:b.message,call_stack:b.stack})}this.loadedExtensions=null}for(this.toolController&&(this.toolController.enableMouseButtons(!1),this.toolController.deactivateTool("gestures")),m.logger.reportRuntimeStats(!0),this.loadSpinner&&(this.loadSpinner.style.display="block"),this.liveReviewClient&&(this.liveReviewClient.destroy(),this.liveReviewClient=null);this.trackADPTimer.length>0;)clearTimeout(this.trackADPTimer.pop());this.impl.unloadCurrentModel()},h.prototype.run=function(){this.running||(this.resize(),this.running=!0,this.impl.run())},h.prototype.localize=function(){z.i18n.localize()},h.prototype.__initAutoCam=function(a){function b(a){e.autocamCamera.isPerspective!==f.isPerspective&&(e.autocamCamera.isPerspective?e.navigation.toPerspective():e.navigation.toOrthographic()),e.navigation.setVerticalFov(e.autocamCamera.fov,!1),e.navigation.setView(e.autocamCamera.position,e.autocamCamera.target),e.navigation.setPivotPoint(e.autocamCamera.pivot),e.navigation.setCameraUpVector(e.autocamCamera.up),a&&e.navigation.setWorldUpVector(e.autocamCamera.worldup),e.impl.syncCamera(a)}function c(a){e.utilities?e.utilities.pivotActive(a,!1):e.impl.controls.pivotActive(a,!1)}function d(){e.fireEvent({type:C.CAMERA_TRANSITION_COMPLETED})}var e=this,f=a.camera;f.pivot||(f.pivot=new j.Vector3(0,0,0)),f.target||(f.target=new j.Vector3(0,0,0)),f.worldup||(f.worldup=f.up.clone()),e.autocamCamera=f.clone(),e.autocamCamera.target=f.target.clone(),e.autocamCamera.pivot=f.pivot.clone(),e.autocamCamera.worldup=f.worldup.clone(),e.autocam=new K.Autocam(e.autocamCamera,e.navigation,e.canvas),e.autocam.registerCallbackCameraChanged(b),e.autocam.registerCallbackPivotDisplay(c),e.autocam.registerCallbackTransitionCompleted(d),e.addEventListener("cameraChanged",function(a){var b=a.camera;e.autocam.sync(b)}),e.autocam.sync(f)},h.prototype.uninitialize=function(){window.removeEventListener("resize",this.onResizeCallback,!1),this.onResizeCallback=null,window.removeEventListener("scroll",this.onScrollCallback),this.onScrollCallback=null,this.canvas.parentNode.removeChild(this.canvas),this.canvas.viewer=null,this.canvas=null,this.canvasWrap=null,this.viewerState=null,m.logger.reportRuntimeStats(),m.logger.track({category:"viewer_destroy"},!0),this.toolController&&(this.toolController.uninitialize(),this.toolController=null,this.clickHandler=null,this.utilities=null),this.navigation&&(this.navigation.uninitialize(),this.navigation=null),this.impl&&(this.impl.dtor(),this.impl=null),this.loadSpinner=null,this.prefs=null,this.autocam.dtor(),this.autocam=null,this.autocamCamera=null,this._hotkeyManager.popHotkeys("Autodesk.FitToView"),this._hotkeyManager.popHotkeys("Autodesk.Home"),this._hotkeyManager.popHotkeys("Autodesk.Escape"),this._hotkeyManager.popHotkeys("Autodesk.Pan"),this._hotkeyManager.popHotkeys("Autodesk.Orbit"),h.ViewerCount--,0===h.ViewerCount&&(0,E.clearPropertyWorkerCache)(),this.onDefaultContextMenu&&(this.container.removeEventListener("contextmenu",this.onDefaultContextMenu,!1),this.onDefaultContextMenu=null),this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.extensionCache=null,this.clientContainer=null,this.config=null,this.listeners={},this.contextMenu=null,this.contextMenuCallbacks=null,this.viewCubeUi&&(this.viewCubeUi.uninitialize(),this.viewCubeUi=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.dispatchEvent(C.VIEWER_UNINITIALIZED),this.listeners={},m.logger.log("viewer destroy")},h.prototype.finish=function(){this.tearDown(),this.uninitialize()},h.prototype.load=function(a,b,c,d,e,f){m.logger.warn("viewer.load() is deprecated. Please use viewer.loadModel() instead.");var g={ids:null,sharedPropertyDbPath:b,acmSessionId:e,loadOptions:f};return this.loadModel(a,g,c,d)},h.prototype.setLoadHeuristics=function(a){var b=a.bubbleNode;if(b){var c=b.findViewableParent();if(c){var d=c.name();a.fileExt=d.slice(d.length-3).toLowerCase();var e=["rvt","nwd","nwc","ifc"];a.hasOwnProperty("isAEC")||-1===e.indexOf(a.fileExt)||(a.isAEC=!0)}}a.isAEC&&(void 0===a.useConsolidation&&(a.useConsolidation=!(0,k.isMobileDevice)()&&!(0,k.isNodeJS)()),void 0===a.createWireframe&&(a.createWireframe=!(0,k.isMobileDevice)()),a.disablePrecomputedNodeBoxes=!0),a.useConsolidation&&!a.bvhOptions&&(a.bvhOptions={},N.Consolidation.applyBVHDefaults(a.bvhOptions))},h.prototype.trackADPSettingsOptions=function(){var a=this;this.trackADPTimer.push(setTimeout(function(){if(a.prefs){var b={category:"settingOptionsStatus",switchSheetColorWhiteToBlack:a.prefs.swapBlackAndWhite,leftHandedMouseSetup:a.prefs.leftHandedMouseSetup,openPropertiesOnSelect:a.prefs.openPropertiesOnSelect,orbitPastWorldPoles:a.prefs.orbitPastWorldPoles,reverseMouseZoomDirection:a.prefs.reverseMouseZoomDir,fusionStyleOrbit:a.prefs.fusionOrbit,setPivotWithLeftMouseButton:a.prefs.clickToSetCOI,zoomTowardPivot:a.prefs.zoomTowardsPivot,viewCubeActsOnPivot:a.prefs.alwaysUsePivot,showViewCube:a.prefs.viewCube,environmentImageVisible:a.prefs.envMapBackground,displayEdges:a.prefs.edgeRendering,displayPoints:a.prefs.pointRendering,displayLines:a.prefs.lineRendering,ghostHiddenObjects:a.prefs.ghosting,groundReflection:a.prefs.groundReflection,groundShadow:a.prefs.groundShadow,ambientShadows:a.prefs.ambientShadows,antiAliasing:a.prefs.antialiasing,progressiveModelDisplay:a.prefs.progressiveRendering,smoothNavigation:a.prefs.optimizeNavigation};m.logger.track(b)}},3e4))},h.prototype.trackADPExtensionsLoaded=function(){var a=this,b={};b.category="loaded_extensions",this.trackADPTimer.push(setTimeout(function(){if(a.loadedExtensions)for(var c in a.loadedExtensions)b[c]=c;m.logger.track(b)},3e4))},h.prototype.activateDefaultNavigationTools=function(a){if(!(0,k.isNodeJS)()){var b=a?"pan":"orbit";this.setActiveNavigationTool(b),this.setDefaultNavigationTool(b),this.toolController&&(this.toolController.enableMouseButtons(!0),this.toolController.activateTool("gestures"))}},h.prototype.registerDimensionSpecificHotkeys=function(a){if(this._hotkeyManager)if(a)this._hotkeyManager.popHotkeys("Autodesk.Orbit");else{var b,c=this,d=function(){return b=c.getActiveNavigationTool(),c.setActiveNavigationTool("orbit")},e=function(){return c.setActiveNavigationTool(b)},f=[{keycodes:[P.KeyCode.ALT],onPress:d,onRelease:e}];this._hotkeyManager.pushHotkeys("Autodesk.Orbit",f,{tryUntilSuccess:!0})}},h.prototype.onModelAdded=function(a,b){var c=this.impl.modelQueue().getModels(),d=1===c.length;if(d){a.is2d()&&this.activateLayerState("Initial"),d&&!a.getData().loadOptions.preserveView&&(this.setActiveNavigationTool(),this.impl.setViewFromFile(a,!0),this.toolController.recordHomeView()),this.registerDimensionSpecificHotkeys(a.is2d()),b||this.activateDefaultNavigationTools(a.is2d()),this.navigation.setIs2D(this.impl.modelQueue().areAll2D());var e=a.getData();e.isLeaflet?this.navigation.setConstraints2D(e.bbox,e.maxPixelPerUnit):this.navigation.setConstraints2D()}},h.prototype.loadModel=function(a,b,c,d,e){function f(a,d){if(h.impl._removeLoadingFile(i),a)return void g(a.code,a.msg,a.args);b.loadAsHidden?h.impl.modelQueue().addHiddenModel(d):h.impl.addModel(d),h.loadSpinner&&(h.loadSpinner.style.display="None"),c&&c(d)}function g(a,b,c){h.loadSpinner&&(h.loadSpinner.style.display="None"),d&&d(a,b,c)}var h=this;b=b||{};var i,j,l=a.toLowerCase().match(/\.([a-z0-9]+)(\?|$)/),n=l?l[1]:null;if(!(j=b&&b.fileLoader?b.fileLoader:D.FileLoaderManager.getFileLoaderForExtension(n)))return m.logger.error("File extension not supported:"+n,(0,p.errorCodeString)(p.ErrorCodes.UNSUPORTED_FILE_EXTENSION)),g(p.ErrorCodes.UNSUPORTED_FILE_EXTENSION,"File extension not supported",0),!1;this.setLoadHeuristics(b),(0,G.processMemoryOptions)(this.config),i=new j(this.impl,this.config);var o=i.loadFile(a,b,f,e);return!(0,k.isNodeJS)()&&b.isAEC&&i.is3d()&&this.impl.setLightPresetForAec(),this.impl.setRenderingPrefsFor2D(!i.is3d()),o},h.prototype.loadDocumentNode=function(a,b,c){var d=b instanceof M.BubbleNode?b:a.getRoot().findByGuid(b.guid),e=d.findViewableParent().parent,f=e.urn(),g={},h=a.getViewableUrn(d,g),i=d.findPropertyDbPath();if(0===h.indexOf("$file$")||(0,A.isOffline)())h=a.getFullPath(h),i=a.getFullPath(i);else{var j=d.getOtgGraphicsNode();if(j&&!j.error)h=A.endpoint.getItemApi(null,h),i=A.endpoint.getItemApi(null,i);else if(A.endpoint.getApiFlavor()===A.endpoint.ENDPOINT_API_FLUENT)h=A.endpoint.getItemApi(A.endpoint.getApiEndpoint(),h,"derivativeV2"),i=A.endpoint.getItemApi(A.endpoint.getApiEndpoint(),i,"derivativeV2");else{for(var k=d;k.parent;)k=k.parent;f=k.acmSessionId}}var l={sharedPropertyDbPath:i,acmSessionId:f,bubbleNode:d,applyRefPoint:!1,loadOptions:g};c=c||{};for(var m in l)c.hasOwnProperty(m)||(c[m]=l[m]);c.keepCurrentModels||(this.impl.unloadCurrentModel(),this.impl.model=null);var n=this;return new Promise(function(a,b){n.loadModel(h,c,function(b){a(b)},function(a){b(a)})})},h.prototype.getDimensions=function(){if(this.container){var a={};return this.getScreenMode()===r.ScreenMode.kFullScreen?(a.width=screen.width,a.height=screen.height):a=this.container.getBoundingClientRect(),{width:a.width,height:a.height}}return null},h.prototype.resize=function(){this.impl.resize(this.container.clientWidth,this.container.clientHeight)},h.prototype.getHotkeyManager=function(){return this._hotkeyManager},h.prototype.getCamera=function(){return this.impl.camera},h.prototype.getState=function(a){return this.viewerState.getState(a)},h.prototype.restoreState=function(a,b,c){var d=this.viewerState.restoreState(a,b,c);return d&&this.dispatchEvent({type:C.VIEWER_STATE_RESTORED_EVENT,value:d}),d},h.prototype.setViewFromArray=function(a,b){var c=this.model?this.model.getData().globalOffset:{x:0,y:0,z:0},d={position:new j.Vector3(a[0]-c.x,a[1]-c.y,a[2]-c.z),target:new j.Vector3(a[3]-c.x,a[4]-c.y,a[5]-c.z),up:new j.Vector3(a[6],a[7],a[8]),aspect:a[9],fov:j.Math.radToDeg(a[10]),orthoScale:a[11],isPerspective:!a[12]};0===a[10]&&1===a[11]&&1===a[12]&&(d.orthoScale=d.position.distanceTo(d.target)),this.impl.setViewFromCamera(d,!1,!0)},h.prototype.setViewFromViewBox=function(a,b){var c=this.model;if(c&&!c.is2d())return void m.logger.warn("Viewer3D.setViewFromViewBox is not applicable to 3D");if(b&&b.length){var d,e=c.getData().metadata,f=e.views;for(d=0;d<f.length&&f[d].name!=b;d++);if(d<f.length){var g=f[d].layer_state;g&&this.activateLayerState(g)}}this.impl.setViewFromViewBox(this.model,a,b,!1)},h.prototype.activateLayerState=function(a){this.impl.layers.activateLayerState(a),this.dispatchEvent({type:C.LAYER_VISIBILITY_CHANGED_EVENT})},h.prototype.getLayerStates=function(){return this.impl.layers.getLayerStates()},h.prototype.setViewFromFile=function(a){this.setActiveNavigationTool(),this.impl.setViewFromFile(a||this.model)},h.prototype.getProperties=function(a,b,c){this.model?this.model.getProperties(a,b,c):c&&c(p.ErrorCodes.BAD_DATA,"Properties failed to load since model does not exist")},h.prototype.getObjectTree=function(a,b){this.model?this.model.getObjectTree(a,b):b&&b(p.ErrorCodes.BAD_DATA,"ObjectTree failed to load since model does not exist")},h.prototype.setCanvasClickBehavior=function(a){if(this.impl.controls.hasOwnProperty("setClickBehavior")&&this.impl.controls.setClickBehavior(a),this.clickHandler&&this.clickHandler.setClickBehavior(a),a&&a.disableMouseWheel&&this.toolController.setMouseWheelInputEnabled(!1),a&&a.disableTwoFingerSwipe){var b=this.toolController.getTool("gestures");b&&b.disableTwoFingerSwipe()}},h.prototype.search=function(a,b,c,d){this.searchText=a,this.model?this.model.search(a,b,c,d):c&&c(p.ErrorCodes.BAD_DATA,"Search failed since model does not exist")},h.prototype.getHiddenNodes=function(){return this.impl.visibilityManager.getHiddenNodes()},h.prototype.getIsolatedNodes=function(){return this.model&&this.model.is2d()?(m.logger.warn("Viewer3D.getIsolatedNodes is not yet implemented for 2D"),[]):this.impl.visibilityManager.getIsolatedNodes()},h.prototype.isolate=function(a,b){if(b=b||this.model){b.getData();this.impl.visibilityManager.isolate(a,b)}},h.prototype.isolateById=function(a){return m.logger.warn("isolateById() is deprecated. Use isolate() instead."),this.isolate(a)},h.prototype.setBackgroundColor=function(a,b,c,d,e,f){this.impl.setClearColors(a,b,c,d,e,f)},h.prototype.toggleSelect=function(a,b){if((b=b||this.model)&&b.is2d())return void m.logger.warn("Viewer3D.toggleSelect is not yet implemented for 2D");this.impl.selector.toggleSelection(a,b)},h.prototype.select=function(a,b){"number"==typeof a&&(a=[a]),b=b||this.model,this.impl.selector.setSelection(a,b)},h.prototype.clearSelection=function(){this.impl.selector.clearSelection()},h.prototype.getSelectionVisibility=function(){return this.impl.selector.getSelectionVisibility()},h.prototype.getSelectionCount=function(){return this.impl.selector.getSelectionLength()},h.prototype.setSelectionMode=function(a){this.impl.selector.setSelectionMode(a)},h.prototype.getSelection=function(){return this.impl.selector.getSelection()},h.prototype.getAggregateSelection=function(a){var b=this.impl.selector.getAggregateSelection();if(a)for(var c=0;c<b.length;c++)for(var d=0;d<b[c].selection.length;d++)a(b[c].model,b[c].selection[d]);return b},h.prototype.getAggregateIsolation=function(){return this.impl.visibilityManager.getAggregateIsolatedNodes()},h.prototype.getAggregateHiddenNodes=function(){return this.impl.visibilityManager.getAggregateHiddenNodes()},h.prototype.hide=function(a,b){b=b||this.model,this.impl.visibilityManager.hide(a,b)},h.prototype.show=function(a,b){b=b||this.model,this.impl.visibilityManager.show(a,b)},h.prototype.showAll=function(){this.impl.visibilityManager.aggregateIsolate([]),this.impl.layers.showAllLayers()},h.prototype.toggleVisibility=function(a,b){this.impl.visibilityManager.toggleVisibility(a,b)},h.prototype.areAllVisible=function(){return this.impl.isWholeModelVisible(this.model)},h.prototype.isNodeVisible=function(a,b){return b=b||this.model,this.impl.isNodeVisible(a,b)},h.prototype.explode=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.explode is not applicable to 2D");m.logger.track({name:"explode_count",aggregate:"count"}),this.impl.explode(a)},h.prototype.getExplodeScale=function(){return this.model&&this.model.is2d()?(m.logger.warn("Viewer3D.getExplodeScale is not applicable to 2D"),0):this.impl.getExplodeScale()},h.prototype.setQualityLevel=function(a,b){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setQualityLevel is not applicable to 2D");this.prefs.set("ambientShadows",a),this.prefs.set("antialiasing",b),this.impl.togglePostProcess(a,b)},h.prototype.setGhosting=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setGhosting is not applicable to 2D");this.prefs.set("ghosting",a),this.impl.toggleGhosting(a)},h.prototype.setGroundShadow=function(a){return this.model&&this.model.is2d()?void m.logger.warn("Viewer3D.setGroundShadow is not applicable to 2D"):this.getMemoryInfo()?void m.logger.warn("Viewer3D.setGroundShadow is not available when memory is limited"):(this.prefs.set("groundShadow",a),void this.impl.toggleGroundShadow(a))},h.prototype.setGroundReflection=function(a){return this.model&&this.model.is2d()?void m.logger.warn("Viewer3D.setGroundReflection is not applicable to 2D"):this.getMemoryInfo()?void m.logger.warn("Viewer3D.setGroundReflection is not available when memory is limited"):(this.prefs.set("groundReflection",a),void this.impl.toggleGroundReflection(a))},h.prototype.setEnvMapBackground=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setEnvMapBackground is not applicable to 2D");this.prefs.set("envMapBackground",a),this.impl.toggleEnvMapBackground(a)},h.prototype.setFirstPersonToolPopup=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setFirstPersonToolPopup is not applicable to 2D");this.prefs.set("firstPersonToolPopup",a)},h.prototype.getFirstPersonToolPopup=function(){return this.model&&this.model.is2d()?void m.logger.warn("Viewer3D.getFirstPersonToolPopup is not applicable to 2D"):this.prefs.firstPersonToolPopup},h.prototype.setBimWalkToolPopup=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setBimWalkToolPopup is not applicable to 2D");this.prefs.set("bimWalkToolPopup",a)},h.prototype.setRenderCache=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setRenderCache is not applicable to 2D");this.impl.toggleVizBuffer(a),this.prefs.set("renderCache",a)},h.prototype.getBimWalkToolPopup=function(){return this.model&&this.model.is2d()?void m.logger.warn("Viewer3D.getBimWalkToolPopup is not applicable to 2D"):this.prefs.bimWalkToolPopup},h.prototype.setProgressiveRendering=function(a){this.prefs.set("progressiveRendering",a),this.impl.toggleProgressive(a)},h.prototype.setGrayscale=function(a){this.prefs.set("grayscale",a),this.impl.toggleGrayscale(a)},h.prototype.setSwapBlackAndWhite=function(a){this.prefs.set("swapBlackAndWhite",a),this.impl.toggleSwapBlackAndWhite(a)},h.prototype.setOptimizeNavigation=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setOptimizeNaviation is not applicable to 2D");this.prefs.set("optimizeNavigation",a),this.impl.setOptimizeNavigation(a)},h.prototype.setNavigationLock=function(a){this.navigation.getIsLocked()!==a&&(this.navigation.setIsLocked(a),this.dispatchEvent({type:C.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()}))},h.prototype.getNavigationLock=function(){return this.navigation.getIsLocked()},h.prototype.setNavigationLockSettings=function(a){this.navigation.setLockSettings(a),this.dispatchEvent({type:C.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()})},h.prototype.getNavigationLockSettings=function(){return this.navigation.getLockSettings()},h.prototype.setActiveNavigationTool=function(a){if(a===this._pushedTool||!a&&!this._pushedTool)return!0;if(this._pushedTool){if(!this.impl.controls.deactivateTool(this._pushedTool))return!1;this.impl.controls.setToolActiveName(this.getDefaultNavigationToolName()),this._pushedTool=null}return a&&a!==this.getDefaultNavigationToolName()||null!==this._pushedTool?!!this.impl.controls.activateTool(a)&&(this._pushedTool=a,this.dispatchEvent({type:C.NAVIGATION_MODE_CHANGED_EVENT,id:this._pushedTool}),!0):(this.dispatchEvent({type:C.NAVIGATION_MODE_CHANGED_EVENT,id:this.getDefaultNavigationToolName()}),!0)},h.prototype.getActiveNavigationTool=function(){return this._pushedTool?this._pushedTool:this._defaultNavigationTool},h.prototype.setDefaultNavigationTool=function(a){this._defaultNavigationTool&&this.impl.controls.deactivateTool(this._defaultNavigationTool),this._pushedTool&&this.impl.controls.deactivateTool(this._pushedTool),this.impl.controls.activateTool(a),this._defaultNavigationTool=a,this._pushedTool&&this.impl.controls.activateTool(this._pushedTool)},h.prototype.getDefaultNavigationToolName=function(){return this._defaultNavigationTool},h.prototype.getFOV=function(){return this.navigation.getVerticalFov()},h.prototype.setFOV=function(a){this.navigation.setVerticalFov(a,!0)},h.prototype.getFocalLength=function(){return this.navigation.getFocalLength()},h.prototype.setFocalLength=function(a){this.navigation.setFocalLength(a,!0)},h.prototype.hideLines=function(a){this.prefs.set("lineRendering",!a);this.impl.hideLines(a)},h.prototype.hidePoints=function(a){this.prefs.set("pointRendering",!a);this.impl.hidePoints(a)},h.prototype.setDisplayEdges=function(a){this.prefs.set("edgeRendering",a),this.impl.setDisplayEdges(a)},h.prototype.applyCamera=function(a,b){this.impl.setViewFromCamera(a,!0),b&&this.fitToView()},h.prototype.fitToView=function(a,b,c){var d=[];a&&(a.length>0&&a[0].model?d=a:a.length>0&&d.push({model:b||this.model,selection:a})),this.impl.fitToView(d,c)},h.prototype.setClickConfig=function(a,b,c){var d=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(a in d){var e=d[a];if(b in e)return e[b]=c,!0}return!1},h.prototype.getClickConfig=function(a,b){var c=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(a in c){var d=c[a];if(b in d)return d[b]}return null},h.prototype.setClickToSetCOI=function(a,b){!1!==b&&this.prefs.set("clickToSetCOI",a);var c=this.getClickConfig("click","onObject");a?-1===c.indexOf("setCOI")&&this.setClickConfig("click","onObject",["setCOI"]):c.indexOf("setCOI")>=0&&this.setClickConfig("click","onObject",["selectOnly"])},h.prototype.initSettings=function(){this.prefs.load(R),this.prefs.tag("3d"),this.prefs.tag("2d"),this.prefs.untag("2d",["viewCube","alwaysUsePivot","zoomTowardsPivot","reverseHorizontalLookDirection","reverseVerticalLookDirection","orbitPastWorldPoles","clickToSetCOI","ghosting","optimizeNavigation","renderCache","ambientShadows","antialiasing","groundShadow","groundReflection","lineRendering","edgeRendering","lightPreset","envMapBackground","firstPersonToolPopup","bimWalkToolPopup"]),this.prefs.untag("3d",["grayscale","swapBlackAndWhite"]),this.setQualityLevel(this.prefs.ambientShadows,this.prefs.antialiasing),this.setGroundShadow(this.prefs.groundShadow),this.setGroundReflection(this.prefs.groundReflection),this.setGhosting(this.prefs.ghosting),this.setProgressiveRendering(this.prefs.progressiveRendering),this.setGrayscale(this.prefs.grayscale),this.setSwapBlackAndWhite(this.prefs.swapBlackAndWhite),this.setClickToSetCOI(this.prefs.clickToSetCOI),this.setOptimizeNavigation(this.prefs.optimizeNavigation),this.hideLines(!this.prefs.lineRendering),this.hidePoints(!this.prefs.pointRendering),this.setDisplayEdges(this.prefs.edgeRendering),this.setEnvMapBackground(this.prefs.envMapBackground),this.setFirstPersonToolPopup(this.prefs.firstPersonToolPopup),this.setBimWalkToolPopup(this.prefs.bimWalkToolPopup),this.setRenderCache(this.prefs.renderCache),this.navigation.setUsePivotAlways(this.prefs.alwaysUsePivot),this.navigation.setReverseZoomDirection(this.prefs.reverseMouseZoomDir),this.navigation.setReverseHorizontalLookDirection(this.prefs.reverseHorizontalLookDirection),this.navigation.setReverseVerticalLookDirection(this.prefs.reverseVerticalLookDirection),this.navigation.setZoomTowardsPivot(this.prefs.zoomTowardsPivot),this.navigation.setOrbitPastWorldPoles(this.prefs.orbitPastWorldPoles),this.navigation.setUseLeftHandedInput(this.prefs.leftHandedMouseSetup),this.navigation.setWheelSetsPivot(this.prefs.wheelSetsPivot);var a=this.prefs.backgroundColorPreset;if(a)try{var b=JSON.parse(a);this.impl.setClearColors(b[0],b[1],b[2],b[3],b[4],b[5])}catch(a){this.prefs.set("backgroundColorPreset",null)}var c=this.prefs.lightPreset;this.impl.setLightPreset(c),this.impl.saveLightPreset()},h.prototype.setLightPreset=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setLightPreset is not applicable to 2D");this.prefs.set("lightPreset",a),this.impl.setLightPreset(a)},h.prototype.setUsePivotAlways=function(a){this.prefs.set("alwaysUsePivot",a),this.navigation.setUsePivotAlways(a)},h.prototype.setReverseZoomDirection=function(a){this.prefs.set("reverseMouseZoomDir",a),this.navigation.setReverseZoomDirection(a)},h.prototype.setReverseHorizontalLookDirection=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setReverseHorizontalLookDirection is not applicable to 2D");this.prefs.set("reverseHorizontalLookDirection",a),this.navigation.setReverseHorizontalLookDirection(a)},h.prototype.setReverseVerticalLookDirection=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setReverseVerticalLookDirection is not applicable to 2D");this.prefs.set("reverseVerticalLookDirection",a),this.navigation.setReverseVerticalLookDirection(a)},h.prototype.setZoomTowardsPivot=function(a){this.prefs.set("zoomTowardsPivot",a),this.navigation.setZoomTowardsPivot(a)},h.prototype.setOrbitPastWorldPoles=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setOrbitPastWorldPoles is not applicable to 2D");this.prefs.set("orbitPastWorldPoles",a),this.navigation.setOrbitPastWorldPoles(a)},h.prototype.setUseLeftHandedInput=function(a){this.prefs.set("leftHandedMouseSetup",a),this.navigation.setUseLeftHandedInput(a)},h.prototype.setLayerVisible=function(a,b,c){var d=this.impl.layers;null===a?b?d.showAllLayers():d.hideAllLayers():(Array.isArray(a)||(a=[a]),c&&d.hideAllLayers(),this.impl.setLayerVisible(a,b)),this.dispatchEvent({type:C.LAYER_VISIBILITY_CHANGED_EVENT})},h.prototype.isLayerVisible=function(a){return!!(a&&a.isLayer&&this.impl.isLayerVisible(a))},h.prototype.anyLayerHidden=function(){for(var a=this.impl.getLayersRoot(),b=a&&a.children,c=b?b.length:0,d=0;d<c;++d)if(!this.impl.layers.isLayerVisible(b[d]))return!0;return!1},h.prototype.allLayersHidden=function(){for(var a=this.impl.getLayersRoot(),b=a&&a.children,c=b?b.length:0,d=0;d<c;++d)if(this.impl.layers.isLayerVisible(b[d]))return!1;return!0},h.prototype.setGroundShadowColor=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setGroundShadowColor is not applicable to 2D");this.impl.setGroundShadowColor(a)},h.prototype.setGroundShadowAlpha=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setGroundShadowAlpha is not applicable to 2D");this.impl.setGroundShadowAlpha(a)},h.prototype.setGroundReflectionColor=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setGroundReflectionColor is not applicable to 2D");this.impl.setGroundReflectionColor(a)},h.prototype.setGroundReflectionAlpha=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.setGroundReflectionAlpha is not applicable to 2D");this.impl.setGroundReflectionAlpha(a)},h.prototype.getCutPlanes=function(){return this.model&&this.model.is2d()?(m.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"),[]):this.impl.getCutPlanes()},h.prototype.setCutPlanes=function(a){if(this.model&&this.model.is2d())return void m.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D");this.impl.setCutPlanes(a)},h.prototype.getScreenShot=function(a,b,c,d){return this.impl.getScreenShot(a,b,c,d)},h.prototype.setContextMenu=function(a){this.contextMenu&&this.contextMenu.hide(),this.contextMenu=a||null},h.prototype.setDefaultContextMenu=function(){var a=Autodesk.Viewing.Extensions;return!(!a||!a.ViewerObjectContextMenu)&&(this.setContextMenu(new a.ViewerObjectContextMenu(this)),!0)},h.prototype.triggerContextMenu=function(a){return this.config&&this.config.onTriggerContextMenuCallback&&this.config.onTriggerContextMenuCallback(a),!!this.contextMenu&&(this.contextMenu.show(a),!0)},h.prototype.triggerSelectionChanged=function(a){this.config&&this.config.onTriggerSelectionChangedCallback&&this.config.onTriggerSelectionChangedCallback(a)},h.prototype.triggerDoubleTapCallback=function(a){this.config&&this.config.onTriggerDoubleTapCallback&&this.config.onTriggerDoubleTapCallback(a)},h.prototype.triggerSingleTapCallback=function(a){this.config&&this.config.onTriggerSingleTapCallback&&this.config.onTriggerSingleTapCallback(a)},h.prototype.initContextMenu=function(){(!this.config||!this.config.hasOwnProperty("disableBrowserContextMenu")||this.config.disableBrowserContextMenu)&&(this.onDefaultContextMenu=function(a){a.preventDefault()},this.container.addEventListener("contextmenu",this.onDefaultContextMenu,!1));var a=this,b=this.canvas||this.container;b.addEventListener("mousedown",function(b){g(b,a.navigation)&&(a.startX=b.clientX,a.startY=b.clientY)}),b.addEventListener("mouseup",function(b){return g(b,a.navigation)&&b.clientX===a.startX&&b.clientY===a.startY&&a.triggerContextMenu(b),!0},!1)},h.prototype.registerContextMenuCallback=function(a,b){this.contextMenuCallbacks[a]=b},h.prototype.unregisterContextMenuCallback=function(a){return a in this.contextMenuCallbacks&&(delete this.contextMenuCallbacks[a],!0)},h.prototype.runContextMenuCallbacks=function(a,b){
for(var c in this.contextMenuCallbacks)this.contextMenuCallbacks.hasOwnProperty(c)&&this.contextMenuCallbacks[c](a,b)},h.prototype.playAnimation=function(a){var b=this.impl.keyFrameAnimator;b&&b.play(0,a)},h.prototype.joinLiveReview=function(a){this.liveReviewClient||(this.liveReviewClient=new H.LiveReviewClient(this));var b=this.liveReviewClient;(0,o.loadDependency)("lmv_io","socket.io-1.3.5.js",function(){b.joinLiveReviewSession(a)})},h.prototype.leaveLiveReview=function(){this.liveReviewClient&&this.liveReviewClient.leaveLiveReviewSession()},h.prototype.setModelUnits=function(a){this.model&&(this.model.getData().overriddenUnits=a)},h.prototype.worldToClient=function(a){return this.impl.worldToClient(a)},h.prototype.clientToWorld=function(a,b,c){return this.impl.clientToWorld(a,b,c)},h.prototype.modelHasTopology=function(){return!(!this.model||!this.model.hasTopology())},h.prototype.setSelectionColor=function(a,b){this.impl.setSelectionColor(a,b)},h.prototype.set2dSelectionColor=function(a){this.impl.matman().set2dSelectionColor(a)},h.prototype.createViewCube=function(){this.viewCubeUi||(this.viewCubeUi=new J.ViewCubeUi(this),this.viewCubeUi.create())},h.prototype.displayViewCube=function(a){this.viewCubeUi&&this.viewCubeUi.displayViewCube(a,!1)},h.prototype.displayViewCubeUI=function(a){this.viewCubeUi&&this.viewCubeUi.setVisible(a)},h.prototype.setViewCube=function(a){this.viewCubeUi&&this.viewCubeUi.cube&&this.viewCubeUi.cube.cubeRotateTo(a)},h.prototype.setTheme=function(a){for(var b=this.container.classList,c=0;c<b.length;++c){-1!==b[c].indexOf("-theme")&&b.remove(b[c--])}b.add(a)},h.prototype.setThemingColor=function(a,b,c){c=c||this.model,c.setThemingColor(a,b),this.impl.invalidate(!0)},h.prototype.clearThemingColors=function(a){a=a||this.model,a.clearThemingColors(),this.impl.invalidate(!0)},h.prototype.transferModel=function(a,b){var c=this.impl.findModel(a);if(c){var d=[];this.getAggregateSelection(function(b,c){b.id==a&&d.push(c)});var e=this.impl.visibilityManager.getIsolatedNodes(c),f=this.impl.visibilityManager.getHiddenNodes(c),g=this.impl.matman().exportModelMaterials(c),h=c.loader;c.loader=null,this.impl.unloadModel(c),c.loader=h,c.isAEC()&&c.is3d()&&b.impl.setLightPresetForAec(),b.impl.setRenderingPrefsFor2D(c.is2d()),b.impl.addModel(c),b.impl.matman().importModelMaterials(g),b.loadSpinner&&(b.loadSpinner.style.display="None"),c.loader&&c.loader.viewer3DImpl===this.impl&&(c.loader.viewer3DImpl=b.impl),c.getData().loadDone&&b.impl.onLoadComplete(c),b.impl.selector.setSelection(d,c),0!=e.length?b.impl.visibilityManager.isolate(e,c):0!=f.length&&b.impl.visibilityManager.hide(f,c)}},h.prototype.hideModel=function(a){var b=this.impl.modelQueue(),c=b.findModel(a);return!!c&&(this.impl.removeModel(c),b.addHiddenModel(c),!0)},h.prototype.showModel=function(a,b){var c=this.impl.modelQueue(),d=c.findHiddenModel(a);return!!d&&(c.removeHiddenModel(d),this.impl.addModel(d,b),!0)},h.prototype.getVisibleModels=function(){return this.impl.modelQueue().getModels()},h.prototype.getHiddenModels=function(){return this.impl.modelQueue().getHiddenModels()},h.prototype.getVisibleModels=function(){return this.impl.modelQueue().getModels()},h.prototype.setModelCrossFadeEnabled=function(a){this.impl.renderer().setCrossFadeEnabled(a)},h.prototype.setModelTargetIndex=function(a,b){var c=this.impl.renderer().getCrossFade();c&&(c.setModelTargetIndex(a,b),this.impl.invalidate(!0))},h.prototype.setCrossFadeOpacity=function(a,b){var c=this.impl.renderer().getCrossFade();c&&(c.setCrossFadeOpacity(a,b),this.impl.invalidate(!0))},h.prototype.getCrossFadeOpacity=function(a){var b=this.impl.renderer().getCrossFade();return b&&b.getCrossFadeOpacity(a)},h.prototype.getMemoryInfo=function(){var a=this.impl.modelQueue();return a?a.getMemoryInfo():null},h.prototype.restoreDefaultSettings=function(){var a=this.model,b=a.is2d()?"2d":"3d";this.prefs.reset(b),this.impl.setupLighting(a),a.isAEC()&&a.is3d()&&this.impl.setLightPresetForAec(),this.impl.setRenderingPrefsFor2D(!a.is3d()),this.fireEvent({type:C.RESTORE_DEFAULT_SETTINGS_EVENT})},h.prototype.disableHighlight=function(a){this.impl.disableHighlight(a)},h.prototype.disableSelection=function(a){a&&this.clearSelection(),this.impl.disableSelection(a)},h.prototype.isHighlightDisabled=function(){return this.impl.selector.highlightDisabled},h.prototype.isHighlightPaused=function(){return this.impl.selector.highlightPaused},h.prototype.isHighlightActive=function(){return!(this.impl.selector.highlightDisabled||this.impl.selector.highlightPaused)},h.prototype.isSelectionDisabled=function(){return this.impl.selector.selectionDisabled},h.prototype.activateExtension=function(a,b){if(this.loadedExtensions&&a in this.loadedExtensions){return this.loadedExtensions[a].activate(b)}return m.logger.warn("Extension is not loaded or doesn't exist"),!1},h.prototype.deactivateExtension=function(a){if(this.loadedExtensions&&a in this.loadedExtensions){return this.loadedExtensions[a].deactivate()}return m.logger.warn("Extension is not loaded or doesn't exist"),!1},h.prototype.isExtensionActive=function(a,b){if(this.loadedExtensions&&a in this.loadedExtensions){return this.loadedExtensions[a].isActive(b)}return m.logger.warn("Extension is not loaded or doesn't exist"),!1},h.prototype.isExtensionLoaded=function(a){return this.loadedExtensions&&a in this.loadedExtensions},h.prototype.getLoadedExtensions=function(){return this.loadedExtensions||[]},h.prototype.getExtensionModes=function(a){if(this.loadedExtensions&&a in this.loadedExtensions){return this.loadedExtensions[a].getModes()}return console.warn("Extension is not loaded or doesn't exist"),[]},h.prototype.reorderElements=function(a){var b=a.getAttribute("layer-order-id"),c=this.containerLayerOrder.indexOf(b),d=null;if(-1!==c)for(var e=c+1;e<this.containerLayerOrder.length&&!d;e++)d=this.container.querySelector('[layer-order-id="'+this.containerLayerOrder[e]+'"]');d?this.container.insertBefore(a,d):this.container.appendChild(a)},h.prototype.appendOrderedElementToViewer=function(a){var b=this.container.querySelector('[layer-order-id="'+a+'"]');if(b)return b;var c=document.createElement("div");return c.setAttribute("layer-order-id",a),this.reorderElements(c),c}},function(a,b,c){"use strict";function d(){function a(){return o}function b(){return o[0]}function c(a,b){return a-b}function d(a,b,d){if(k.some(function(b){return b.id===a}))return!1;for(var e=0;e<b.length;e++)k.push({id:a,keys:b[e].keycodes.sort(c).join(),onPress:b[e].onPress,onRelease:b[e].onRelease,options:d||{}});return!0}function e(a){for(var b=!1,c=k.length-1;c>=0;c--)k[c].id===a&&(k.splice(c,1),b=!0);return b}function f(){var a,b,c=l.join();for(b=0;b<n.length;)a=n[b],a.keys===c?n.splice(b,1):b++;for(b=0;b<m.length;)a=m[b],a.keys!==c?m.splice(b,1):b++}function g(a,b){if(-1===l.indexOf(b)){for(var c=l.join(),d=l.slice(0),e=0;e<l.length&&l[e]<b;)e++;l.splice(e,0,b);var g=l.join(),h=l.slice(0);f();var i,j=[],o=[];for(e=k.length-1;e>=0;e--)i=k[e],i.keys===c&&i.onRelease?j.unshift(i):i.keys===g&&i.onPress&&o.unshift(i);for(e=j.length-1;e>=0&&(i=j[e],!i.onRelease(d));e--)i.options.tryUntilSuccess&&n.unshift(i);for(e=o.length-1;e>=0&&(i=o[e],!i.onPress(h));e--)i.options.tryUntilSuccess&&m.unshift(i)}}function h(a,b){var c=l.join(),d=l.slice(0),e=l.indexOf(b);e>-1&&l.splice(e,1);var g=l.join(),h=l.slice(0);f();var i,j=[],o=[];for(e=k.length-1;e>=0;e--)i=k[e],i.keys===c&&i.onRelease?j.unshift(i):i.keys===g&&i.onPress&&o.unshift(i);for(e=j.length-1;e>=0&&(i=j[e],!i.onRelease(d));e--)i.options.tryUntilSuccess&&n.unshift(i);for(e=o.length-1;e>=0&&(i=o[e],!i.onPress(h));e--)i.options.tryUntilSuccess&&m.unshift(i)}function i(){var a,b;for(b=0;b<n.length;)a=n[b],!0===a.onRelease(a.keys.split())?n.splice(b,1):b++;for(b=0;b<m.length;)a=m[b],!0===a.onPress(a.keys.split())?m.splice(b,1):b++;return!1}function j(){for(var a=l.length-1;a>=0;a--)h(null,l[a])}var k=[],l=[],m=[],n=[],o=["hotkeys"];return{pushHotkeys:d,popHotkeys:e,handleKeyDown:g,handleKeyUp:h,handleBlur:j,getName:b,getNames:a,activate:function(){},deactivate:function(){},update:i}}Object.defineProperty(b,"__esModule",{value:!0}),b.HotkeyManager=d;c(214)},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.KeyCode={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,SEMICOLONMOZ:59,EQUALSMOZ:61,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,LCOMMAND:91,RCOMMAND:93,PLUS:107,PLUSMOZ:171,DASHMOZ:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DASHMOZNEW:173,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,LBRACKET:219,RBRACKET:221,SINGLEQUOTE:222,COMMANDMOZ:224}},function(a,b,c){"use strict";function d(a){this.__options={dollyToPivot:!1,orbitPastPoles:!0,reverseDolly:!1,reverseHorizontalLook:!1,reverseVerticalLook:!1,useLeftHandedInput:!1,usePivotAlways:!1,lockNavigation:!1},this.__lockSettings={orbit:!1,pan:!1,zoom:!1,roll:!1,fov:!1,gotoview:!1,walk:!1},this.FIT_TO_VIEW_VERTICAL_MARGIN=.05,this.FIT_TO_VIEW_VERTICAL_OFFSET=0,this.FIT_TO_VIEW_HORIZONTAL_MARGIN=.05,this.FIT_TO_VIEW_HORIZONTAL_OFFSET=0,this.__pivotIsSetFlag=!1,this.__fitToViewRequested=!1,this.__homeViewRequested=!1,this.__transitionActive=!1,this.__destinationView=null,this.__is2D=!1,this.__isTouchDevice=!1,this.__kEpsilon=1e-6,this.__minDistance=1e-5;var b=void 0,c=void 0,d=2,e=200,g=null,h={left:0,top:0,width:1,height:1};this.uninitialize=function(){this.setCamera(null)},this.setCamera=function(a){a!==g&&(g=a,a&&(a.hasOwnProperty("target")||(a.target=new f.Vector3(0,0,0)),a.hasOwnProperty("pivot")||(a.pivot=new f.Vector3(0,0,0)),a.worldup=a.up.clone(),a.dirty=!0))},this.getCamera=function(){return g},this.setScreenViewport=function(a){h=a},this.getScreenViewport=function(){return h},this.__setUp=function(a){if(a&&g){if(0!==a.clone().normalize().sub(g.worldup).lengthSq())return g.worldup.copy(a).normalize(),g.dirty=!0,!0}return!1},this.__getUp=function(){return g?g.worldup:new f.Vector3(0,1,0)},this.setView=function(a,b){g&&a&&b&&(g.position.copy(a),g.target.copy(b),g.dirty=!0)},this.orientCameraUp=function(){g&&this.isActionEnabled("roll")&&(g.up.copy(this.getAlignedUpVector()),g.dirty=!0)},this.getPivotPoint=function(){return g?g.pivot.clone():new f.Vector3(0,0,0)},this.setPivotPoint=function(a){g&&a&&(g.pivot.copy(a),g.dirty=!0)},this.getPosition=function(){return g?g.position.clone():new f.Vector3(0,0,1)},this.setPosition=function(a){g&&a&&(g.position.copy(a),g.dirty=!0)},this.setTarget=function(a){g&&a&&(g.target.copy(a),g.dirty=!0)},this.getTarget=function(){return g?g.target.clone():new f.Vector3(0,0,0)},this.getEyeVector=function(){return g?g.target.clone().sub(g.position):new f.Vector3(0,0,-1)},this.getEyeToCenterOfBoundsVec=function(a){return g?a.center().sub(g.position):new f.Vector3(0,0,-1)},this.getFovMin=function(){return 6.88},this.getFovMax=function(){return 100},this.setZoomInLimitFactor=function(a){e=a},this.getZoomInLimitFactor=function(){return e},this.setZoomOutLimitFactor=function(a){d=a},this.getZoomOutLimitFactor=function(){return d},this.isPointVisible=function(a){return(new f.Frustum).setFromMatrix(g.projectionMatrix.clone().multiply(g.matrixWorldInverse)).containsPoint(a)},this.setVerticalFov=function(a,b){if((!g||g.isPerspective)&&(a<6.88?a=6.88:a>100&&(a=100),g&&this.isActionEnabled("fov"))){if(Math.abs(g.fov-a)<=1e-6)return;if(b){var c=this.__pivotIsSetFlag&&this.isPointVisible(this.getPivotPoint()),d=this.getPosition(),e=this.getEyeVector(),h=f.Math.degToRad(g.fov),i=f.Math.degToRad(a),j=c?this.getPivotPlaneDistance():e.length(),k=j*Math.tan(.5*h)/Math.tan(.5*i),l=e.normalize().multiplyScalar(j-k);this.setPosition(d.add(l)),c&&this.setTarget(this.getTarget().add(l))}g.setFov(a),g.dirty=!0}},this.computeFit=function(b,c,d,e,g){if(!e||e.empty())return{position:b,target:c};g=void 0===g?1:g;for(var h=e.center(),i=e.size(),j=b.clone().sub(c).normalize(),k=Math.tan(f.Math.degToRad(.5*d)),l=0,m=this.computeOrthogonalUp(b,c),n=j.clone().cross(m).normalize(),o=new f.Vector3,p=0===i.z?4:8,q=0;q<p;q++){o.set(0==(1&q)?-.5*i.x:.5*i.x,0==(2&q)?-.5*i.y:.5*i.y,0==(4&q)?-.5*i.z:.5*i.z);var r=0;a.isPerspective&&(r=o.dot(j));var s=Math.abs(o.dot(m)),t=Math.abs(o.dot(n)),u=r+(1+2*this.FIT_TO_VIEW_VERTICAL_MARGIN/(1-2*this.FIT_TO_VIEW_VERTICAL_MARGIN))*s/k;l<u&&(l=u),u=r+(1+2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN/(1-2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN))*t/(g*k),l<u&&(l=u)}return h.add(m.multiplyScalar(-l*this.FIT_TO_VIEW_VERTICAL_OFFSET)),h.add(n.multiplyScalar(l*this.FIT_TO_VIEW_HORIZONTAL_OFFSET)),j.multiplyScalar(l),{position:h.clone().add(j),target:h}},this.computeOrthogonalUp=function(a,b){var c=this.__getUp(),d=b.clone().sub(a);if(0===d.lengthSq())return d.copy(c);var e=d.clone().cross(c);return 0===e.lengthSq()&&(c.z>c.y?d.y-=1e-4:d.z-=1e-4,e.crossVectors(d,c)),e.cross(d).normalize()},this.fitBounds=function(a,b,c){var d=this.getTarget(),e=this.getPosition();if(!this.isActionEnabled("gotoview")||!b||b.empty())return{position:e,target:d};var f=this.getVerticalFov(),h=this.computeFit(e,d,f,b,g.aspect),i=c?this.computeOrthogonalUp(e,d):g.up;return a?(g.up.copy(i),this.setView(h.position,h.target)):this.setRequestTransitionWithUp(!0,h.position,h.target,f,i),this.setPivotPoint(h.target),this.setPivotSetFlag(!0),h},this.computeOverviewDistance=function(a){if(this.__is2D){var b=a.size(),c=g.aspect,d=b.x/c,e=b.y;return Math.max(d,e)}var h=this.getVerticalFov(),b=a.size(),i=b.length();return 0===i&&(i=2),g.isPerspective?.5*i/Math.tan(f.Math.degToRad(.5*h)):i},this.applyDollyConstraint=function(a,f){if(!(b||c||d))return a;var h=a;if((b||d&&f)&&a>1){var i,j=g.isPerspective?this.getEyeToCenterOfBoundsVec(f):this.getEyeVector();i=b?d*this.computeOverviewDistance(b):d*this.computeOverviewDistance(f);var k=Math.abs(i/j.length());k=Math.max(k,1),h=Math.min(h,k)}if((c||e&&f)&&this.__is2D){var l;l=c?g.clientHeight/c:this.computeOverviewDistance(f)/e;var j=this.getEyeVector(),m=l/-j.z;m=Math.min(m,1),h=Math.max(h,m)}return h},this.applyPanningConstraint2D=function(a){if(this.__is2D&&b){var c=g.position.x+a.x,d=g.position.y+a.y;c=f.Math.clamp(c,b.min.x,b.max.x),d=f.Math.clamp(d,b.min.y,b.max.y);var e=c-g.position.x,h=d-g.position.y,i=Math.min(a.x,0),j=Math.min(a.y,0),k=Math.max(a.x,0),l=Math.max(a.y,0);e=f.Math.clamp(e,i,k),h=f.Math.clamp(h,j,l),a.x=e,a.y=h}},this.updateCamera=function(){g&&(g.updateProjectionMatrix(),this.orient(g,g.target,g.position,g.up),g.dirty=!1)},this.setCamera(a),this.setConstraints2D=function(a,d){b=a,c=d}}Object.defineProperty(b,"__esModule",{value:!0}),b.Navigation=d;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(8);d.prototype.constructor=d,d.prototype.setIs2D=function(a){this.__is2D=!!a},d.prototype.getIs2D=function(){return this.__is2D},d.prototype.setIsTouchDevice=function(a){this.__isTouchDevice=!!a},d.prototype.getIsTouchDevice=function(){return this.__isTouchDevice},d.prototype.orient=function(){function a(){b||(b=new f.Matrix4,c=new f.Vector3,d=new f.Vector3,e=new f.Vector3)}var b,c,d,e;return function(f,g,h,i){a();var j=b.elements;e.subVectors(h,g).normalize(),0===e.lengthSq()&&(e.z=1),c.crossVectors(i,e).normalize(),0===c.lengthSq()&&(i.z>i.y?e.y-=1e-4:e.z+=1e-4,c.crossVectors(i,e).normalize()),d.crossVectors(e,c),j[0]=c.x,j[4]=d.x,j[8]=e.x,j[1]=c.y,j[5]=d.y,j[9]=e.y,j[2]=c.z,j[6]=d.z,j[10]=e.z,f.setRotationFromMatrix(b)}}(),d.prototype.fov2fl=function(a){var b=f.Math.degToRad(a);return b<=0&&(b=1e-4),Math.round(12/Math.tan(.5*b))},d.prototype.fl2fov=function(a){a<=0&&(a=1e-4);var b=2*Math.atan(12/a);return f.Math.radToDeg(b)},d.prototype.setCameraUpVector=function(a){if(this.isActionEnabled("roll")){var b=this.getCamera();b.up.copy(a),b.dirty=!0}},d.prototype.getCameraUpVector=function(){var a=this.getCameraRightVector(!1),b=this.getEyeVector();return a.cross(b).normalize()},d.prototype.getAlignedUpVector=function(){var a=this.getCameraRightVector(!0),b=this.getEyeVector();return a.cross(b).normalize()},d.prototype.getCameraRightVector=function(a){var b=new f.Vector3,c=a?this.getWorldUpVector():this.getCamera().up,d=this.getEyeVector();return b.crossVectors(d,c),0===b.lengthSq()&&(Math.abs(d.z)>=Math.abs(d.y)?c.set(0,1,0):c.set(0,0,1),b.crossVectors(d,c)),b.normalize()},d.prototype.setWorldUpVector=function(a,b){this.isActionEnabled("roll")&&(this.__setUp(a),b&&this.orientCameraUp())},d.prototype.getWorldUpVector=function(){return this.__getUp().clone()},d.prototype.getWorldRightVector=function(){var a=new f.Vector3;return a.copy(this.__getUp()),Math.abs(a.z)<=Math.abs(a.y)?a.set(a.y,-a.x,0):a.z>=0?a.set(a.z,0,-a.x):a.set(-a.z,0,a.x),a.normalize()},d.prototype.getVerticalFov=function(){return this.getCamera().fov},d.prototype.getHorizontalFov=function(){var a=this.getScreenViewport();return this.getCamera().fov*(a.width/a.height)},d.prototype.getFocalLength=function(){return this.fov2fl(this.getVerticalFov())},d.prototype.setFocalLength=function(a,b){this.setVerticalFov(this.fl2fov(a),b)},d.prototype.setReverseZoomDirection=function(a){this.__options.reverseDolly=!!a},d.prototype.setReverseHorizontalLookDirection=function(a){if(this.getIs2D())return void g.logger.warn("Autodesk.Viewing.Navigation.setReverseHorizontalLookDirection is not applicable to 2D");this.__options.reverseHorizontalLookDirection=!!a},d.prototype.setReverseVerticalLookDirection=function(a){if(this.getIs2D())return void g.logger.warn("Autodesk.Viewing.Navigation.setReverseVerticalLookDirection is not applicable to 2D");this.__options.reverseVerticalLookDirection=!!a},d.prototype.getReverseZoomDirection=function(){return this.__options.reverseDolly},d.prototype.getReverseHorizontalLookDirection=function(){return this.getIs2D()?(g.logger.warn("Autodesk.Viewing.Navigation.getReverseHorizontalLookDirection is not applicable to 2D"),!1):this.__options.reverseHorizontalLookDirection},d.prototype.getReverseVerticalLookDirection=function(){return this.getIs2D()?(g.logger.warn("Autodesk.Viewing.Navigation.getReverseVerticalLookDirection is not applicable to 2D"),!1):this.__options.reverseVerticalLookDirection},d.prototype.setZoomTowardsPivot=function(a){this.__options.dollyToPivot=!!a},d.prototype.getZoomTowardsPivot=function(){return this.__options.dollyToPivot},d.prototype.setOrbitPastWorldPoles=function(a){if(this.getIs2D())return void g.logger.warn("Autodesk.Viewing.Navigation.setOrbitPastWorldPoles is not applicable to 2D");this.__options.orbitPastPoles=!!a},d.prototype.getOrbitPastWorldPoles=function(){return this.getIs2D()?(g.logger.warn("Autodesk.Viewing.Navigation.orbitPastWorldPoles is not applicable to 2D"),!1):this.__options.orbitPastPoles},d.prototype.setUsePivotAlways=function(a){this.__options.usePivotAlways=!!a},d.prototype.getUsePivotAlways=function(){return this.__options.usePivotAlways},d.prototype.setUseLeftHandedInput=function(a){this.__options.useLeftHandedInput=!!a},d.prototype.getUseLeftHandedInput=function(){return this.__options.useLeftHandedInput},d.prototype.setWheelSetsPivot=function(a){this.__options.wheelSetsPivot=!!a},d.prototype.getWheelSetsPivot=function(){return this.__options.wheelSetsPivot},d.prototype.setIsLocked=function(a){this.__options.lockNavigation=!!a},d.prototype.getIsLocked=function(){return this.__options.lockNavigation},d.prototype.setLockSettings=function(a){for(var b in this.__lockSettings)a.hasOwnProperty(b)&&(this.__lockSettings[b]=a[b])},d.prototype.getLockSettings=function(){var a={};for(var b in this.__lockSettings)a[b]=this.__lockSettings[b];return a},d.prototype.isActionEnabled=function(a){return!this.__options.lockNavigation||!0===this.__lockSettings[a]},d.prototype.setPivotSetFlag=function(a){this.__pivotIsSetFlag=!!a},d.prototype.getPivotSetFlag=function(){return this.__pivotIsSetFlag},d.prototype.setRequestFitToView=function(a){this.isActionEnabled("gotoview")&&(this.__fitToViewRequested=!!a)},d.prototype.getRequestFitToView=function(){return this.__fitToViewRequested},d.prototype.setRequestHomeView=function(a){this.isActionEnabled("gotoview")&&(this.__homeViewRequested=!!a)},d.prototype.getRequestHomeView=function(){return this.__homeViewRequested},d.prototype.setRequestTransition=function(a,b,c,d,e,f){this.__destinationView=a?{position:b.clone(),coi:c.clone(),fov:d,up:this.getCamera().up.clone(),worldUp:this.getWorldUpVector(),reorient:e,pivot:f?f.clone():c.clone()}:null},d.prototype.setRequestTransitionWithUp=function(a,b,c,d,e,f,g){this.__destinationView=a?{position:b.clone(),coi:c.clone(),fov:d,up:e.clone(),worldUp:f||this.getWorldUpVector(),reorient:!1,pivot:g?g.clone():c.clone()}:null},d.prototype.getRequestTransition=function(){return this.__destinationView},d.prototype.setTransitionActive=function(a){this.__transitionActive=!!a},d.prototype.getTransitionActive=function(){return this.__transitionActive},d.prototype.getWorldSize=function(a){var b=this.getScreenViewport(),c=b.width/b.height,d=2*a*Math.tan(f.Math.degToRad(.5*this.getCamera().fov)),e=d*c;return new f.Vector2(e,d)},d.prototype.screenToViewport=function(a,b){return b=1-b,a=2*a-1,b=2*b-1,new f.Vector3(a,b,1)},d.prototype.viewportToScreen=function(a,b){return a=(a+1)/2,b=(b+1)/2,b=1-b,new f.Vector2(a,b)},d.prototype.getWorldPoint=function(a,b){var c=this.screenToViewport(a,b);a=c.x,b=c.y;var d,e=this.getCamera();e.isPerspective&&(d=new f.Vector3(a,b,1),d=d.unproject(e));var g,h,i=this.getEyeVector(),j=this.getPosition();if(!e.isPerspective||isNaN(d.x)){var k=this.getWorldSize(i.length()),l=this.getCameraRightVector(!1).multiplyScalar(.5*a*k.x),m=this.getCameraUpVector().multiplyScalar(.5*b*k.y);g=i.clone().add(l).add(m).normalize()}else g=d.sub(j).normalize();var n=this.getPivotPoint(),o=g.dot(i);return h=this.__pivotIsSetFlag&&(this.getIs2D()||e.isPerspective&&o>0)?0!==o?Math.abs(n.sub(j).dot(i))/o:n.sub(j).length():e.isPerspective?.5*(e.near+e.far):e.orthoScale,g.multiplyScalar(h).add(j)},d.prototype.getPivotPlaneDistance=function(){var a=this.getPivotPoint(),b=this.getEyeVector(),c=this.getPosition();return a.sub(c).dot(b.normalize())},d.prototype.panRelative=function(a,b,c){if(this.isActionEnabled("pan")){var d=this.getWorldSize(c),e=a*d.x,f=b*d.y,g=this.getCameraRightVector(!1).multiplyScalar(e),h=this.getCameraUpVector().multiplyScalar(f),i=g.add(h);this.applyPanningConstraint2D(i),this.setView(this.getPosition().add(i),this.getTarget().add(i))}},d.prototype.dollyFromPoint=function(a,b,c){if(this.isActionEnabled("zoom")&&!(Math.abs(a)<=this.__kEpsilon)){var d=this.getPosition(),e=this.getEyeVector();if(!this.getCamera().isPerspective){var f=e.lengthSq(),g=e.dot(this.getTarget().sub(b));b=e.clone().multiplyScalar(g/f).add(b)}var h=b.clone().sub(d),i=h.length(),j=i+a;j<this.__minDistance&&(j=this.__minDistance);var k=j/i;if(k=this.applyDollyConstraint(k,c),Math.abs(k-1)>this.__kEpsilon){h.multiplyScalar(k),h.set(-h.x,-h.y,-h.z);var l=h.add(b),e=this.getEyeVector();this.getCamera().isPerspective||e.multiplyScalar(k),this.setView(l,e.add(l))}}},d.prototype.toPerspective=function(){if(this.getIs2D())return void g.logger.warn("Autodesk.Viewing.Navigation.toPerspective is not applicable to 2D");var a=this.getCamera();a.isPerspective||(a.toPerspective(),a.dirty=!0)},d.prototype.toOrthographic=function(){var a=this.getCamera();a.isPerspective&&(a.toOrthographic(),a.dirty=!0)},d.snapToAxis=function(a){var b=new f.Vector3(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z));return b.x>b.y&&b.x>b.z?a.set(a.x>0?1:-1,0,0):b.y>b.x&&b.y>b.z?a.set(0,a.y>0?1:-1,0):a.set(0,0,a.z>0?1:-1),a}},function(a,b,c){"use strict";function d(a,b,c,d,g){function j(a){return a.getPriority instanceof Function&&a.getPriority()||0}function k(a,c){return b.navigation.getUseLeftHandedInput()&&0===a||m&&1===a||l&&!o&&0===a&&c.ctrlKey}this.domElement=b.canvasWrap,this.selector=a.selector,this.autocam=c,this.lastClickX=-1,this.lastClickY=-1,this.scrollInputEnabled=!0;var l=-1!=navigator.userAgent.search("Mac OS"),m=-1!=navigator.userAgent.search("Firefox"),n=-1!==navigator.userAgent.search("Chrome"),o=-1!==navigator.userAgent.search("Safari")&&!n,p={},q=[],r=!1,s=-1,t=-1,u=!1,v=null,w=null,x=!1,y={},z=this;this.__registerToolByName=function(a,b){p[b]=a},this.registerTool=function(a){var b=a.getNames();if(!b||0==b.length)return f.logger.warn("Cannot register tool with no name."),!1;for(var c=!1,e=0;e<b.length;++e)"default"!==b[e]&&(this.__registerToolByName(a,b[e]),c=!0);return a.utilities=d,a.controller=this,a.register&&a.register(),c},this.deregisterTool=function(a){this.deactivateTool(a.getName());var b=a.getNames();if(!b||0==b.length)return!1;for(var c=b.length;--c>=0;)this.__deregisterToolName(b[c]);return a.deregister&&a.deregister(),a.utilities=null,a.controller=null,!0},this.__deregisterToolName=function(a){a in p&&(!function(a){for(var b=q.length;--b>=0;)q[b].activeName===a&&(p[a].deactivate(a),q.splice(b,1))}(a),delete p[a])},this.getTool=function(a){return p[a]},this.getActiveToolName=function(){var a=q.length;return a>0?q[a-1].activeName:"default"},this.getActiveTool=function(){var a=q.length;return a>0?q[a-1]:p.default},this.isToolActivated=function(a){for(var b=0;b<q.length;b++)if(q[b].activeName===a)return!0;return!1},this.setToolActiveName=function(a){var b=p[a];b&&(b.activeName=a)},this.activateTool=function(a){if(r)return!1;var c=p[a];if(c){void 0===c.count&&(c.count=0);var d=null;q.length&&"intercept"===q[q.length-1].activeName&&(d=q.pop());for(var e=0,g=0;g<q.length;g++)q[g]===c&&c.count++,j(q[g])<=j(c)&&(e=g+1);return c.activeName=a,0===c.count&&(c.count++,q.splice(e,0,c)),c.activate(a,b),d&&q.push(d),b.dispatchEvent({type:h.TOOL_CHANGE_EVENT,toolName:a,tool:c,active:!0}),!0}return f.logger.warn("activateTool not found: "+a),!1},this.deactivateTool=function(a){if(r)return!1;for(var c=q.length;--c>=0;)if(q[c].activeName===a)return 1===p[a].count&&q.splice(c,1),p[a].count--,p[a].deactivate(a),b.dispatchEvent({type:h.TOOL_CHANGE_EVENT,toolName:a,tool:q[c],active:!1}),!0;return f.logger.warn("deactivateTool not found: "+a),!1},this.getToolNames=function(){return Object.keys(p)},this.setDefaultTool=function(a){var b=this.getDefaultTool();return!(!a||a===b)&&(this.__registerToolByName(a,"default"),b&&b.deactivate("default"),a.activate("default"),!0)},this.getDefaultTool=function(){return p.default},this.setDefaultTool(g),this.setIsLocked=function(a){var b=r;return r=!!a,b},this.getIsLocked=function(){return r},this.__checkCursor=function(){for(var a=null,c=q.length;--c>=0;){var d=q[c];if(d.getCursor&&(a=d.getCursor()))break}a||(a="auto"),v!=a&&(b.canvas.style.cursor=a,v=a)},this.update=function(a){this.__checkCursor();var c=!1;d&&d.update()&&(c=!0);for(var e=q.length;--e>=0;){var f=q[e];f.update&&f.update(a)&&(c=!0)}if(b.navigation.getCamera().dirty?(b.navigation.updateCamera(),c=!0,this.cameraUpdated=!0):this.cameraUpdated=!1,c)b.navigation.updateCamera(),this.moveDelay=Date.now()+150;else if(0!==this.moveDelay){var g=this.moveDelay-Date.now();g>0?c=!0:this.moveDelay=0}return c},this.__clientToCanvasCoords=function(b,c,d){var e=a.getCanvasBoundingClientRect(),f=e.width,g=e.height,h=b.clientX-e.left,i=b.clientY-e.top;b.canvasX=h,b.canvasY=i,b.normalizedX=h/f*2-1,b.normalizedY=(g-i)/g*2-1,c&&c.set(h/f,i/g,0),d&&d.set(h,i)},this.__invokeStack=function(a,b,c){for(var d=q.length;--d>=0;){var e=q[d];if(e[a]&&e[a](b,c))return!0}var f=this.getDefaultTool();return!(!f[a]||!f[a](b,c))},this.distributeEvent=function(a,b,c){return this.__invokeStack(a,b,c)},this.handleResize=function(){b.navigation.setScreenViewport(b.container.getBoundingClientRect());for(var a=q.length;--a>=0;){var c=q[a];c.handleResize&&c.handleResize()}},this.handleSingleClick=function(a){var b=this.applyButtonMappings(a);this.lastClickX=a.clientX,this.lastClickY=a.clientY,this.__invokeStack("handleSingleClick",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleDoubleClick=function(a){var b=this.applyButtonMappings(a);this.__invokeStack("handleDoubleClick",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleSingleTap=function(a){this.lastClickX=a.canvasX,this.lastClickY=a.canvasY,this.__invokeStack("handleSingleTap",a)&&(a.preventDefault(),a.stopPropagation())},this.handleDoubleTap=function(a){this.lastClickX=a.canvasX,this.lastClickY=a.canvasY,this.__invokeStack("handleDoubleTap",a)&&(a.preventDefault(),a.stopPropagation())},this.handleWheelInput=function(a,b){this.__invokeStack("handleWheelInput",a)&&(b.preventDefault(),b.stopPropagation())},this.applyButtonMappings=function(a){var c=a.button;return"buttons"in a&&(a.firefoxSpoof?c=0:!u||1&a.buttons?2===c&&1&a.buttons&&(c=0,a.firefoxSpoof=u=!0):(a.firefoxSpoof=!0,u=!1,c=0)),b.navigation.getUseLeftHandedInput()&&(c=0===c?2:2===c?0:c),c},this.applyKeyMappings=function(a){switch(a.keyCode){case i.KeyCode.LCOMMAND:case i.KeyCode.RCOMMAND:case i.KeyCode.COMMANDMOZ:return i.KeyCode.CONTROL;case i.KeyCode.EQUALSMOZ:return i.KeyCode.EQUALS;case i.KeyCode.DASHMOZNEW:case i.KeyCode.DASHMOZ:return i.KeyCode.DASH}return a.keyCode},this.handleKeyDown=function(a){var b=this.applyKeyMappings(a);b&&this.__invokeStack("handleKeyDown",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleKeyUp=function(a){var b=this.applyKeyMappings(a);b&&this.__invokeStack("handleKeyUp",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleButtonDown=function(a,b){this.__invokeStack("handleButtonDown",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleButtonUp=function(a,b){this.__invokeStack("handleButtonUp",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleMouseMove=function(a){this.__invokeStack("handleMouseMove",a)&&(a.preventDefault(),a.stopPropagation())},this.handleBlur=function(a){this.__invokeStack("handleBlur",a)&&(a.preventDefault(),a.stopPropagation())},this.keydown=function(a){if((!w||z.domElement.contains(w))&&!(document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLSelectElement)){if(document.activeElement){var b=document.activeElement.getAttribute("contenteditable");if("true"===b||""===b)return}z.handleKeyDown(a)}},this.keyup=function(a){z.handleKeyUp(a)},this.mousedown=function(a){function b(a){z.applyButtonMappings(a)===c&&(document.removeEventListener("mouseup",b),z.mouseup(a))}e.isIE11&&(0,e.inFullscreen)()||document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),z.__clientToCanvasCoords(a);var c=z.applyButtonMappings(a);if(z.handleButtonDown(a,c),s=a.canvasX,t=a.canvasY,k(c,a)){var d=y,f=void 0!==d.time&&a.timeStamp-d.time<500,g=void 0!==d.x&&void 0!==d.y&&Math.abs(d.x-a.canvasX)<=2&&Math.abs(d.y-a.canvasY)<=2;(!f||!g||d.clickCount&&2<=d.clickCount)&&(d.clickCount=0),d.clickCount?1===d.clickCount&&(d.clickCount=2):(d.clickCount=1,d.x=a.canvasX,d.y=a.canvasY,d.time=a.timeStamp)}document.addEventListener("mouseup",b,!1),z.registerWindowMouseMove()},this.mousemove=function(a){z.__clientToCanvasCoords(a);var b=s-a.canvasX,c=t-a.canvasY;(Math.abs(b)>2||Math.abs(c)>2)&&(s=-1,t=-1),z.handleMouseMove(a)},this.mouseup=function(a){z.__clientToCanvasCoords(a);var b=z.applyButtonMappings(a);z.handleButtonUp(a,b);var c=s-a.canvasX,d=t-a.canvasY;if(s=-1,t=-1,Math.abs(c)<=2&&Math.abs(d)<=2&&z.handleSingleClick(a),k(b,a)){var e=y;2===e.clickCount&&(z.handleDoubleClick(a),e.clickCount=0,e.x=void 0,e.y=void 0,e.time=void 0)}z.unregisterWindowMouseMove()},this.doubleclick=function(a){z.__clientToCanvasCoords(a),s=a.canvasX,t=a.canvasY,z.handleDoubleClick(a)},this.mousewheel=function(a){if(z.scrollInputEnabled){var b=0;if(a.wheelDelta)b=a.wheelDelta/40;else if(a.detail)b=-a.detail;else if(a.deltaY){var c=m?1:40;b=-a.deltaY/c}z.handleWheelInput(b,a)}},this.blur=function(a){z.handleBlur(a)},this.mouseover=function(a){w=a.target
},this.registerWindowMouseMove=function(){window.addEventListener("mousemove",z.mousemove),window.addEventListener("mouseover",z.mouseover),z.domElement.removeEventListener("mousemove",z.mousemove),z.domElement.removeEventListener("mouseover",z.mouseover)},this.unregisterWindowMouseMove=function(){window.removeEventListener("mousemove",z.mousemove),window.removeEventListener("mouseover",z.mouseover),z.domElement.addEventListener("mousemove",z.mousemove),z.domElement.addEventListener("mouseover",z.mouseover)},this.enableMouseButtons=function(a){a&&!x?(this.domElement.addEventListener("mousedown",this.mousedown),this.domElement.addEventListener("dblclick",this.doubleclick),this.domElement.addEventListener("mousemove",this.mousemove),this.domElement.addEventListener("mouseover",this.mouseover)):!a&&x&&(this.domElement.removeEventListener("mousedown",this.mousedown),this.domElement.removeEventListener("dblclick",this.doubleclick),this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover));var b=x;return x=a,b},this.domElement.addEventListener("mousewheel",this.mousewheel,!1),this.domElement.addEventListener("DOMMouseScroll",this.mousewheel,!1),window.addEventListener("keydown",this.keydown,!1),window.addEventListener("keyup",this.keyup,!1),window.addEventListener("blur",this.blur,!1),this.uninitialize=function(){for(x&&(this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover),window.removeEventListener("mousemove",z.mousemove),window.removeEventListener("mouseover",z.mouseover)),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup),window.removeEventListener("blur",this.blur),this.domElement=null,this.selector=null,this.autocam=null;q.length>0;)this.deactivateTool(q[q.length-1].activeName);p=null,q=null,z=null,d=null,b=null,a=null,w=null},this.set2DMode=function(a){},this.setAutocam=function(a){},this.syncCamera=function(){},this.recordHomeView=function(){var a=b.navigation.getCamera();c.sync(a),c.setHomeViewFrom(a)},this.setMouseWheelInputEnabled=function(a){this.scrollInputEnabled=a}}Object.defineProperty(b,"__esModule",{value:!0}),b.ToolController=d;var e=c(4),f=c(8),g=c(198),h=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(g),i=c(214)},function(a,b,c){"use strict";function d(a,b,c){function d(a){var b=.6,c=0,d=new f.SphereGeometry(1),e=new f.MeshPhongMaterial({color:32512,ambient:32512,opacity:b,transparent:!0}),g=new f.Mesh(d,e),h=a,i=1;h.createOverlayScene("pivot"),g.visible=!1,this.shown=function(){return g.visible},this.show=function(a,d,f){g.scale.x=d*i,g.scale.y=d*i,g.scale.z=d*i,g.position.set(a.x,a.y,a.z),e.opacity=b,g.visible=!0,h.addOverlay("pivot",g),h.invalidate(!1,!1,!0),c=f?Date.now()+500:0},this.hide=function(){g.visible&&(g.visible=!1,h.removeOverlay("pivot",g),h.invalidate(!1,!1,!0),c=0)},this.fade=function(){if(c>0){var a=c-Date.now();if(a<=0)return this.hide(),!0;var d=a/500*b;return e.opacity=d,!0}return!1},this.fading=function(){return c>0},this.setSize=function(a){i=a},this.setColor=function(a,c){e.color=new f.Color(a),void 0!==c&&(b=c,e.opacity=b)}}function e(a,b,c){var d=b.clone().sub(a);if(0===d.lengthSq())return d.copy(c);var e=d.clone().cross(c);return 0===e.lengthSq()&&(c.z>c.y?d.y-=1e-4:d.z-=1e-4,e.crossVectors(d,c)),e.cross(d).normalize()}this.autocam=b,this.viewerImpl=a;var g=c.getCamera(),h={},i={},j=new d(this.viewerImpl);this.transitionView=function(a,d,f,h,i,j,k){i=i||c.getWorldUpVector();var l=j?e(a,d,i):h;l||(l=g.up),k=k||d;var m={position:a,center:d,pivot:k,fov:f,up:l,worldUp:i,isOrtho:!1===g.isPerspective};b.goToView(m)},this.goHome=function(){this.viewerImpl.track({name:"navigation/home",aggregate:"count"}),b.goHome()},this.getHitPoint=function(a,b){var d=this.viewerImpl.hitTestViewport(c.screenToViewport(a,b),!1);return d?d.intersectPoint:null},this.activatePivot=function(a){if(this.viewerImpl.model&&!this.viewerImpl.model.is2d()){var b=g.isPerspective?c.getPivotPlaneDistance():c.getEyeVector().length(),d=c.getVerticalFov(),e=2*b*Math.tan(f.Math.degToRad(.5*d)),h=c.getScreenViewport(),i=window.devicePixelRatio||1,k=5*e/(h.height*i);j.show(c.getPivotPoint(),k,a)}},this.pivotActive=function(a,b){if(a=a&&!c.getIs2D(),b=b||!1,!a&&j.shown())return void j.hide();a&&this.activatePivot(b)},this.pivotUpdate=function(){j.shown()&&j.fade()&&this.viewerImpl.invalidate(!1,!1,!0)},this.setPivotPoint=function(a,b,d){c.setPivotPoint(a),b||c.setTarget(a),d&&c.setPivotSetFlag(!0),this.setTemporaryPivot(null),c.getIs2D()||j.shown()&&this.activatePivot(j.fading())},this.savePivot=function(a){a||(a="default"),h[a]=c.getPivotPoint(),i[a]=c.getPivotSetFlag()},this.restorePivot=function(a){if(a||(a="default"),h[a]){var b=i[a];this.setPivotPoint(h[a],!0,b),b||c.setPivotSetFlag(!1),delete h[a],delete i[a]}},this.setTemporaryPivot=function(a){if(a){var b=c.getPivotPoint(),d=c.getPivotSetFlag();this.setPivotPoint(a,!0,d),h.TEMP=b,i.TEMP=d}else delete h.TEMP,delete i.TEMP},this.removeTemporaryPivot=function(){this.restorePivot("TEMP")},this.setPivotSize=function(a){j.setSize(a)},this.setPivotColor=function(a,b){j.setColor(a,b)},this.getBoundingBox=function(a){return this.viewerImpl.getFitBounds(a)},this.fitToView=function(a){this.viewerImpl.track({name:"navigation/fit",aggregate:"count"}),this.viewerImpl.fitToView(this.viewerImpl.selector.getAggregateSelection(),a),this.activatePivot(!0)},this.update=function(){c.getRequestFitToView()&&!c.getTransitionActive()&&(c.setRequestFitToView(!1),this.fitToView()),c.getRequestHomeView()&&!c.getTransitionActive()&&(c.setRequestHomeView(!1),this.goHome());var a=c.getRequestTransition();return a&&!c.getTransitionActive()&&(c.setRequestTransition(!1),this.transitionView(a.position,a.coi,a.fov,a.up,a.worldUp,a.reorient,a.pivot)),!1}}Object.defineProperty(b,"__esModule",{value:!0}),b.ViewingUtilities=d;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e)},function(a,b,c){"use strict";function d(a,b,c){this.clickConfig=null,this.getNames=function(){return["default"]},this.getName=function(){return this.getNames()[0]},this.setClickBehavior=function(a){this.clickConfig=a},this.getClickBehavior=function(){return this.clickConfig},this.activate=function(a){},this.deactivate=function(a){},this.handleAction=function(b,d){for(var e=0;e<b.length;++e)switch(b[e]){case"selectOnly":a.selector&&d&&a.selector.setSelection([d.dbId],d.model);break;case"deselectAll":a.selector&&a.selector.setSelection([]);break;case"selectToggle":a.selector&&d&&a.selector.toggleSelection(d.dbId,d.model);break;case"isolate":d&&a.isolate(d.dbId);break;case"showAll":a.showAll();break;case"setCOI":d&&d.intersectPoint&&(c.setPivotPoint(d.intersectPoint,!0,!0),c.pivotActive(!0,!0));break;case"hide":d&&a.hide(d.dbId);break;case"show":d&&a.show(d.dbId);break;case"toggleVisibility":d&&a.toggleVisibility(d.dbId);break;case"focus":a.selector&&(d?a.selector.setSelection([d.dbId],d.model):a.selector.setSelection([]),c.fitToView())}},this.handleSingleClick=function(b,d){var e=b.ctrlKey||b.metaKey,f=b.shiftKey,g=b.altKey;if(0===d){var h=a.clientToViewport(b.clientX,b.clientY),i=a.hitTestViewport(h,!1),j="click";e&&(j+="Ctrl"),f&&(j+="Shift"),g&&(j+="Alt");var k=i?"onObject":"offObject";if(this.clickConfig&&this.clickConfig[j]&&this.clickConfig[j][k])return this.handleAction(this.clickConfig[j][k],i),!0}else if(1===d&&f&&!g&&!e){var h=a.clientToViewport(b.clientX,b.clientY),i=a.hitTestViewport(h,!1);if(i&&i.intersectPoint)return c.setPivotPoint(i.intersectPoint,!0,!0),c.pivotActive(!0,!0),!0}return!1},this.handleDoubleClick=function(d,e){if(a.selector&&0===e){var f=a.clientToViewport(d.clientX,d.clientY),g=a.hitTestViewport(f,!1);return g?a.selector.setSelection([g.dbId],g.model):a.selector.clearSelection(),c.fitToView(),!0}return 1===e&&(b.fitBounds(!1,c.getBoundingBox(!0)),b.setPivotSetFlag(!1),!0)},this.handleSingleTap=function(c){if(c.clientX=c.pointers[0].clientX,c.clientY=c.pointers[0].clientY,a.api.triggerSingleTapCallback(c),c.hasOwnProperty("pointers")&&2===c.pointers.length)return b.setRequestHomeView(!0),!0;if(a.selector){var d=a.clientToViewport(c.clientX,c.clientY),e=a.hitTestViewport(d,!1);return e?(a.selector.setSelection([e.dbId],e.model),a.api.triggerSelectionChanged([e.dbId])):(a.selector.clearSelection(),a.api.triggerSelectionChanged(null)),!0}return!1},this.handleDoubleTap=function(b){b.clientX=b.pointers[0].clientX,b.clientY=b.pointers[0].clientY,a.api.triggerDoubleTapCallback(b);var d=this.handleSingleTap(b,0);return c.fitToView(),d},this.handlePressHold=function(b){return"press"===b.type&&(b.clientX=b.pointers[0].clientX,b.clientY=b.pointers[0].clientY,a.api.triggerContextMenu(b))}}Object.defineProperty(b,"__esModule",{value:!0}),b.DefaultHandler=d;var e=c(2);!function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a}(e)},function(a,b,c){"use strict";function d(a){var b=a.navigation,c=["gestures"],d=this,h=!0,i=!0,j=null,k=!1,l=(0,e.isTouchDevice)();b.setIsTouchDevice(l),l&&(j=new f.Manager(a.canvasWrap,{recognizers:[g.drag,g.doubletap,g.doubletap2,g.singletap,g.singletap2,g.press,g.drag3,g.pan,g.pinch,g.rotate],handlePointerEventMouse:!1,inputClass:e.isIE11?f.PointerEventInput:f.TouchInput}),j.get("pinch").recognizeWith([j.get("drag")]),a.canvasWrap.addEventListener("touchstart",this.onTouchStart,!1)),this.onTouchStart=function(a){a.preventDefault()},this.getNames=function(){return c},this.getName=function(){return c[0]},this.isActive=function(){return k},this.__clientToCanvasCoords=function(b){var c,d,e=a.impl.getCanvasBoundingClientRect(),f=e.width,g=e.height;b.hasOwnProperty("center")?(c=b.center.x-e.left,d=b.center.y-e.top):(c=b.pointers[0].clientX-e.left,d=b.pointers[0].clientY-e.top),b.canvasX=c,b.canvasY=d,b.normalizedX=c/f*2-1,b.normalizedY=(g-d)/g*2-1},this.distributeGesture=function(a){d.__clientToCanvasCoords(a),d.controller.distributeEvent("handleGesture",a)&&a.preventDefault()},this.onSingleTap=function(a){d.__clientToCanvasCoords(a),d.controller.distributeEvent("handleSingleTap",a)&&a.preventDefault()},this.onDoubleTap=function(a){d.__clientToCanvasCoords(a),d.controller.distributeEvent("handleDoubleTap",a)&&a.preventDefault()},this.onPressHold=function(a){d.__clientToCanvasCoords(a),d.controller.distributeEvent("handlePressHold",a)&&a.preventDefault()},this.onHammerInput=function(a){d.setMouseDisabledWhenTouching(a)},this.setMouseDisabledWhenTouching=function(a){a.isFirst?h=d.controller.enableMouseButtons(!1):a.isFinal&&setTimeout(function(){d.controller.enableMouseButtons(h)},10)},this.activate=function(a){j&&!k&&(j.on("dragstart dragmove dragend",this.distributeGesture),j.on("singletap",this.onSingleTap),j.on("singletap2",this.onSingleTap),j.on("doubletap",this.onDoubleTap),j.on("doubletap2",this.onDoubleTap),j.on("press pressup",this.onPressHold),j.on("drag3start drag3move drag3end",this.distributeGesture),i&&(j.on("panstart panmove panend",this.distributeGesture),j.on("pinchstart pinchmove pinchend",this.distributeGesture),j.on("rotatestart rotatemove rotateend",this.distributeGesture)),j.on("hammer.input",this.onHammerInput),j.get("doubletap2").recognizeWith("doubletap"),j.get("singletap2").recognizeWith("singletap"),j.get("singletap").requireFailure("doubletap")),k=!0},this.deactivate=function(a){j&&k&&(j.off("dragstart dragmove dragend",this.distributeGesture),j.off("singletap",this.onSingleTap),j.off("singletap2",this.onSingleTap),j.off("doubletap",this.onDoubleTap),j.off("doubletap2",this.onDoubleTap),j.off("press pressup",this.onPressHold),j.off("drag3start drag3move drag3end",this.distributeGesture),i&&(j.off("panstart panmove panend",this.distributeGesture),j.off("pinchstart pinchmove pinchend",this.distributeGesture),j.off("rotatestart rotatemove rotateend",this.distributeGesture)),j.off("hammer.input",this.onHammerInput)),k=!1},this.update=function(){return!1},this.handleBlur=function(a){return!1},this.disableTwoFingerSwipe=function(){i=!1,j&&(j.remove(f.Pan),j.remove(f.Pinch),j.remove(f.Rotate),j.off("panstart panmove panend",this.distributeGesture),j.off("pinchstart pinchmove pinchend",this.distributeGesture),j.off("rotatestart rotatemove rotateend",this.distributeGesture))}}Object.defineProperty(b,"__esModule",{value:!0}),b.GestureRecognizers=void 0,b.GestureHandler=d;var e=c(4),f=void 0;(0,e.isNodeJS)()||(f=c(5));var g=b.GestureRecognizers={};f&&function(){if(!g.singletap){var a=g;a.singletap=[f.Tap,{event:"singletap",threshold:7,time:400}],a.singletap2=[f.Tap,{event:"singletap2",pointers:2,threshold:7,time:400}],a.press=[f.Press,{event:"press",time:500,threshold:50}],a.doubletap=[f.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],a.doubletap2=[f.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],a.drag=[f.Pan,{event:"drag",pointers:1}],a.drag3=[f.Pan,{event:"drag3",pointers:3,threshold:15}],a.pan=[f.Pan,{event:"pan",pointers:2,threshold:20}],a.pinch=[f.Pinch,{event:"pinch",pointers:2,enable:!0,threshold:.05}],a.rotate=[f.Rotate,{event:"rotate",pointers:2,enable:!0,threshold:7}]}}()},function(a,b,c){"use strict";function d(a){var b=a.data;if(b&&b.debug)return void i.logger.debug(b.message);if(b.cbId){var c=u[b.cbId];b&&b.error?c[1]&&c[1](b.error):c[0]&&c[0](b.result),delete u[b.cbId]}}function e(a,b){var c=t++;return u[c]=[a,b],c}function f(){return h}function g(){h&&h.doOperation({operation:s,clearCaches:!0})}Object.defineProperty(b,"__esModule",{value:!0}),b.PropDbLoader=void 0,b.getPropWorker=f,b.clearPropertyWorkerCache=g;var h,i=c(8),j=c(12),k=c(13),l=c(198),m=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(l),n=c(9),o=c(188),p=c(190),q=c(10),r=c(33),s="UNLOAD_PROPERTYDB",t=1,u={},v=b.PropDbLoader=function(a,b,c){this.eventTarget=c||new r.EventDispatcher,this.model=b,this.svf=b&&b.getData(),this.dbPath="",this.sharedDbPath=!1;var d=this.svf&&this.svf.is2d&&this.svf.loadOptions.bubbleNode&&this.svf.loadOptions.bubbleNode.findViewableParent()._getOtgManifest();if(this.svf&&!d&&this.svf.propertydb&&this.svf.propertydb.avs.length){this.dbFiles=this.svf.propertydb;for(var e in this.dbFiles)this.dbFiles[e][0]&&(this.dbFiles[e][0]=this.dbFiles[e][0].replace(/\\/g,"/"));var f=(0,j.pathToURL)(this.svf.basePath);if(a){var g=j.ViewingService.simplifyPath(f+this.svf.propertydb.avs[0]);if((g=g.slice(0,g.lastIndexOf("/")+1))===a){var h={};for(var e in this.dbFiles){var k=this.dbFiles[e][0];k=j.ViewingService.simplifyPath(f+k),0===k.indexOf(a)&&(k=k.slice(a.length)),h[e]=[k]}this.dbFiles=h,this.dbPath=a,this.sharedDbPath=!0}else this.dbPath=f,this.sharedDbPath=!1}else this.dbPath=f,this.sharedDbPath=!1}else this.sharedDbPath=!0,this.svf&&this.svf.loadOptions.bubbleNode?(this.dbPath=a,this.dbFiles=this.svf.loadOptions.bubbleNode.getPropertyDbManifest()):(i.logger.warn("Deprecated shared property database initialization without bubbleNode in Model load options."),this.dbPath=a,this.dbFiles={attrs:[],avs:[],ids:[],values:[],offsets:[]}),i.logger.log("Using shared db path "+a);this.queryParams="",this.svf&&this.svf.acmSessionId&&(this.queryParams="acmsession="+this.svf.acmSessionId)};v.prototype.dtor=function(){this.asyncPropertyOperation({operation:s},function(){},function(){}),this.model=null,this.svf=null},v.prototype.processLoadResult=function(a){var b=this;if(a.instanceTreeStorage){var c=new p.InstanceTreeAccess(a.instanceTreeStorage,a.rootId,a.instanceBoxes);b.instanceTree=new o.InstanceTree(c,a.objectCount,a.maxTreeDepth),b.svf&&(b.svf.instanceTree=b.instanceTree,b.instanceTree.setFragmentList(b.model.getFragmentList()))}else a.instanceTree?(i.logger.warn("glTF instance tree not supported"),b.hasObjectProperties=a.objectCount):a.objectCount&&(b.hasObjectProperties=a.objectCount,b.svf&&(b.svf.hasObjectProperties=a.objectCount));a.dbidOldToNew&&this.model.setDbIdRemap(a.dbidOldToNew),b.eventTarget.dispatchEvent({type:m.OBJECT_TREE_CREATED_EVENT,svf:b.svf,model:b.model,target:b})},v.prototype.processLoadError=function(a){var b=this;b.propertyDbError=a,b.eventTarget.dispatchEvent({type:m.OBJECT_TREE_UNAVAILABLE_EVENT,svf:b.svf,model:b.model,target:b})},v.prototype.load=function(){var a=this;if(this.svf&&this.svf.instanceTree&&this.svf.instanceBoxes)return void setTimeout(function(){a.processLoadResult(a.svf)},0);h||(h=(0,q.createWorkerWithIntercept)(),h.addEventListenerWithIntercept(d));var b=function(b){a.processLoadResult(b)},c=function(b){a.processLoadError(b)},f=e(b,c),g=this.svf&&this.svf.loadOptions,i=!(g&&g.disablePrecomputedNodeBoxes),j={operation:"LOAD_PROPERTYDB",dbPath:this.dbPath,sharedDbPath:this.sharedDbPath,propertydb:this.dbFiles,fragToDbId:this.svf&&this.svf.fragments.fragId2dbId,fragBoxes:i&&this.svf&&this.svf.fragments.boxes,needsDbIdRemap:this.svf&&this.svf.is2d,cbId:f,queryParams:this.queryParams};h.doOperation((0,n.initLoadContext)(j))},v.prototype.asyncPropertyOperation=function(a,b,c){var d=this;if(a.dbPath=this.dbPath,d.instanceTree||d.hasObjectProperties)a.cbId=e(b,c),h.doOperation(a);else if(d.propertyDbError)c&&c(d.propertyDbError);else{var f=function e(f){d.eventTarget.removeEventListener(m.OBJECT_TREE_CREATED_EVENT,e),d.eventTarget.removeEventListener(m.OBJECT_TREE_UNAVAILABLE_EVENT,e),d.instanceTree||d.hasObjectProperties||d.propertyDbError?d.asyncPropertyOperation(a,b,c):c&&c({code:k.ErrorCodes.UNKNOWN_FAILURE,msg:"Failed to load properties"})};d.eventTarget.addEventListener(m.OBJECT_TREE_CREATED_EVENT,f),d.eventTarget.addEventListener(m.OBJECT_TREE_UNAVAILABLE_EVENT,f)}},v.prototype.getProperties=function(a,b,c){this.asyncPropertyOperation({operation:"GET_PROPERTIES",dbId:a},b,c)},v.prototype.getBulkProperties=function(a,b,c,d,e){this.asyncPropertyOperation({operation:"GET_PROPERTIES",dbIds:a,propFilter:b,ignoreHidden:e},c,d)},v.prototype.searchProperties=function(a,b,c,d){this.asyncPropertyOperation({operation:"SEARCH_PROPERTIES",searchText:a,attributeNames:b},c,d)},v.prototype.findProperty=function(a){var b=this;return new Promise(function(c,d){b.asyncPropertyOperation({operation:"FIND_PROPERTY",propertyName:a},c,d)})},v.prototype.diffProperties=function(a,b,c,d){this.asyncPropertyOperation({operation:"DIFF_PROPERTIES",dbPath2:a,diffOptions:d},b,c)},v.prototype.findLayers=function(){var a=this;return new Promise(function(b,c){a.asyncPropertyOperation({operation:"FIND_LAYERS"},b,c)})},v.prototype.getExternalIdMapping=function(a,b){this.asyncPropertyOperation({operation:"BUILD_EXTERNAL_ID_MAPPING"},a,b)},v.prototype.getLayerToNodeIdMapping=function(a,b){this.asyncPropertyOperation({operation:"BUILD_LAYER_TO_NODE_ID_MAPPING"},a,b)},v.prototype.isObjectTreeLoaded=function(){return!!this.instanceTree},v.prototype.getObjectTree=function(a,b){var c=this;if(c.instanceTree)a(c.instanceTree);else if(c.propertyDbError)b&&b(c.propertyDbError);else if("hasObjectProperties"in c)b&&b("F2D files do not have an InstanceTree.");else{var d=function d(){c.eventTarget.removeEventListener(m.OBJECT_TREE_CREATED_EVENT,d),c.eventTarget.removeEventListener(m.OBJECT_TREE_UNAVAILABLE_EVENT,d),c.getObjectTree(a,b)};c.eventTarget.addEventListener(m.OBJECT_TREE_CREATED_EVENT,d),c.eventTarget.addEventListener(m.OBJECT_TREE_UNAVAILABLE_EVENT,d)}}},function(a,b,c){"use strict";function d(a,b){function c(){var a=ea;return L===K&&!a.SHIFT&&!(a.ALT^a.CONTROL)||L===K&&a.SHIFT&&a.CONTROL||L===J&&!a.SHIFT&&!a.CONTROL||L===J&&a.ALT||L===J&&a.CONTROL&&!a.ALT||L===I&&a.SHIFT&&!a.CONTROL&&!a.ALT||"pan"===w&&L!==J&&!a.ALT&&!("pinch"===x)||a.SPACE}function d(){var a=ea;return L===K&&a.SHIFT&&!a.ALT&&!a.CONTROL||L===K&&a.ALT&&!a.SHIFT&&!a.CONTROL||"dolly"===w&&!a.ALT&&!("pinch"===x)}function e(){var a=ea;return!(a.CONTROL||a.ALT||a.SHIFT||L!==K&&L!==J)}function g(){return!!s.isPerspective&&r.getPivotPoint().sub(r.getPosition()).dot(r.getEyeVector())<=0}function h(a,b){var c={left:0,top:0,width:window.innerWidth,height:window.innerHeight};Z.set((a-.5*c.width-c.left)/(.5*c.width),(.5*c.height+c.top-b)/(.5*c.height),0);var d=Z.length();return aa?d<Math.SQRT1_2?Z.z=Math.sqrt(1-d*d):Z.z=.5/d:d>1?Z.normalize():Z.z=Math.sqrt(1-d*d),V.copy(s.position).sub(s.pivot),X.copy(s.up).setLength(Z.y),X.add(Y.copy(s.up).cross(V).setLength(Z.x)),X.add(V.setLength(Z.z)),X}function i(){if(r.isActionEnabled("orbit")){V.subVectors(s.position,s.pivot),W.subVectors(s.position,s.target);var a=W.length();W.normalize();var b=Math.acos(T.dot(U)/T.length()/U.length());b&&(b*=p,$.crossVectors(T,U).normalize(),_.setFromAxisAngle($,-b),V.applyQuaternion(_),s.up.applyQuaternion(_),U.applyQuaternion(_),W.applyQuaternion(_),ba?T.copy(U):(_.setFromAxisAngle($,b*(ca-1)),T.applyQuaternion(_))),s.position.addVectors(s.pivot,V),s.target.subVectors(s.position,W.multiplyScalar(a)),s.dirty=!0}}function j(a,b){return-1!==a.indexOf(b,a.length-b.length)}function k(a){var b=a.pointers[1].clientX-a.pointers[0].clientX,c=a.pointers[1].clientY-a.pointers[0].clientY;return Math.sqrt(b*b+c*c)}var l,m,n,o=this,p=2,q=-1!=navigator.userAgent.search("Mac OS"),r=b.navigation,s=r.getCamera(),t=["orbit","freeorbit","dolly","pan"],u=t[0],v=[u],w=u,x=null,y=1,z=1,A=0,B=0,C=0,D=0,E=!1,F=null,G=!1,H={SHIFT:16,CONTROL:17,ALT:18,SPACE:32,PAGEUP:33,PAGEDOWN:34,LEFT:37,UP:38,RIGHT:39,DOWN:40,ZERO:48,EQUALS:187,DASH:189},I=0,J=1,K=2,L=-5,M=new THREE.Vector3,N=new THREE.Vector3,O=new THREE.Vector2,P=new THREE.Vector2,Q=new THREE.Vector2,R=new THREE.Vector2,S=new THREE.Vector3,T=new THREE.Vector3,U=new THREE.Vector3,V=new THREE.Vector3,W=new THREE.Vector3,X=new THREE.Vector3,Y=new THREE.Vector3,Z=new THREE.Vector3,$=new THREE.Vector3,_=new THREE.Quaternion,aa=!1,ba=!0,ca=.2,da=[!1,!1,!1,!1,!1,!1],ea={SHIFT:0,ALT:0,CONTROL:0,SPACE:0},fa=function(b){a.renderer().rolloverObjectId(0,null,0)},ga=1,ha=5,ia=.025;this.getNames=function(){return t},this.getName=function(){return t[0]},this.activate=function(b){v.push(b),w=b,a.canvas.addEventListener("mouseout",fa)},this.deactivate=function(b){var c=v.length-1;c>0&&v[c]===b&&(v.pop(),w=v[c-1]),0===v.length&&a.canvas.removeEventListener("mouseout",fa)},this.adjustDollyLookSpeed=function(a){0===a?(ia=.025,ha=5):(ia*=a>0?1.1:.9,ha*=a>0?1.1:.9,ia<1e-6&&(ia=1e-6),ha<1e-6&&(ha=1e-6))},this.getDollySpeed=function(a){var b=r.getEyeVector(),c=r.getPosition(),d=a.clone().sub(c).dot(b.normalize()),e=d*ia;return Math.abs(e)<.01?e<0?-.01:.01:e},this.getLookSpeed=function(){return ha},this.coiIsActive=function(){return r.getPivotSetFlag()&&r.isPointVisible(r.getPivotPoint())},this.adjustSpeed=function(a){this.adjustDollyLookSpeed(a),this.utilities.autocam&&(this.utilities.autocam.orbitMultiplier=this.getLookSpeed())},this.getTriggeredMode=function(){return L===J&&ea.SHIFT?v[1]:d()||0!==S.z?e()?"pan":"dolly":c()?"pan":"pan"===x||"pinch"===x?"dollypan":w},this.initTracking=function(a,b){var c;if(s.isPerspective){c=.5*(s.near+s.far);var d=this.utilities.getHitPoint(a,b),e=r.getPosition();if(d&&d.sub){var f=d.sub(e),g=r.getEyeVector().normalize();c=Math.abs(g.dot(f))}else{if(r.getPivotSetFlag()&&r.isPointVisible(r.getPivotPoint())){var h=r.getPivotPlaneDistance();h>1e-5&&(c=h)}}}else c=r.getEyeVector().length();ga=c},this.initOrbit=function(){this.utilities.setTemporaryPivot(g()?r.getTarget():null)},this.getActiveMode=function(){return u},this.getCursor=function(){switch(u){case"freeorbit":case"orbit":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto";case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return null},this.getMotionDelta=function(a,b){var c=r&&r.getReverseZoomDirection()?-1.5:1.5;q&&(c*=-1),da[0]&&(N.x+=.01,Q.x+=20),da[1]&&(N.x-=.01,Q.x-=20),da[2]&&(N.y+=.01,Q.y+=20),da[3]&&(N.y-=.01,Q.y-=20),da[4]&&(N.z+=c),da[5]&&(N.z-=c);var d=N.x-M.x,e=N.y-M.y,f=N.z-M.z;Math.abs(d)<.001&&(d=0),Math.abs(e)<.001&&(e=0),Math.abs(f)<.001&&(f=0),a.set(d,e,f),b&&b.set(Q.x-P.x,Q.y-P.y)},this.stepMotionDelta=function(a,b){b?(M.x+=.6*a.x,M.y+=.6*a.y,M.z+=.6*a.z):M.copy(N),P.copy(Q)},this.getFitBounds=function(){return this.utilities.viewerImpl.zoomBoundsChanged&&(n=this.utilities.viewerImpl.getVisibleBounds(!0),this.utilities.viewerImpl.zoomBoundsChanged=!1),n},this.update=function(){var a,c=!1,d=!1;this.getMotionDelta(S,R);var e=S.x,f=S.y,g=S.z;if(E||this.checkInteractionMode(),E=L>-1,E&&this.controller.setIsLocked(!0),0!==e||0!==f||0!==g){switch(u){case"orbit":this.utilities.autocam&&this.utilities.autocam.startState&&(R.x=-R.x,F&&this.utilities.autocam.orbit(Q,F,R.multiplyScalar(p),this.utilities.autocam.startState));break;case"freeorbit":i();break;case"dolly":var h,j=new THREE.Vector2;g*=.6,L>=I?(f=-f,g=Math.abs(e)>Math.abs(f)?e:f,r.getReverseZoomDirection()&&(g*=-1),g*=100,e=0,f=0,j=r.viewportToScreen(0,0)):(a=r.getScreenViewport(),l&&m?(j.x=l/a.width,j.y=m/a.height):j=r.viewportToScreen(0,0)),!r.getIs2D()&&r.getZoomTowardsPivot()?this.coiIsActive()?h=r.getPivotPoint():(j=r.viewportToScreen(0,0),h=r.getWorldPoint(j.x,j.y)):h=r.getWorldPoint(j.x,j.y),r.dollyFromPoint(g*this.getDollySpeed(h),h,this.getFitBounds());break;case"pan":r.panRelative(-e,f,ga);break;case"dollypan":0===e&&0===f||r.panRelative(-e,f,ga),a=r.getScreenViewport(),h=r.getWorldPoint(l/a.width,m/a.height);var k=r.getPosition(),n=r.getIs2D()?k.sub(h).length():ga,o=A/B-1,q=o*n;r.dollyFromPoint(q,h,this.getFitBounds());var v=new THREE.Vector3,w=new THREE.Quaternion,D=r.getCameraUpVector(),H=v.copy(s.position).sub(s.target).normalize();w.setFromAxisAngle(H,1.2*C),D.applyQuaternion(w),r.getIs2D()||r.setCameraUpVector(D),A=B,z=y,ga=n+q}d=!0}return this.stepMotionDelta(S,"pan"!==u&&"dollypan"!==u),-1===L&&Math.abs(g)<1e-5&&(this.interactionEnd(-1),c=!0,d=!0),(ea.SHIFT||ea.ALT)&&-1!==t.indexOf(b.getActiveNavigationTool())&&(d=!0),!G&&(c||L>-5)&&(L>-1&&(M.copy(N),this.utilities.removeTemporaryPivot()),this.utilities.autocam.endInteraction(),L=-5,E&&this.controller.setIsLocked(!1),E=!1,F=null,x=null),d?this.utilities.pivotActive(r.getPivotSetFlag(),L<=-1):this.utilities.pivotUpdate(),s.dirty},this.checkInteractionMode=function(){var a=this.getTriggeredMode();a!==u&&("pan"===(u=a)&&L>-1||"dollypan"===u)&&this.initTracking(M.x,M.y)},this.interactionStart=function(a,b){(b||a>L)&&(L=a,G=!0,a>-1&&("pan"===u&&this.initTracking(M.x,M.y),"orbit"===u&&this.initOrbit()),this.utilities.pivotActive(r.getPivotSetFlag(),-1===a),this.utilities.autocam&&(this.utilities.autocam.sync(s),this.utilities.autocam.startInteraction(P.x,P.y),F=P.clone()))},this.interactionCheck=function(){(da[0]||da[1]||da[2]||da[3]||da[4]||da[5]||ea.SHIFT||ea.CONTROL||ea.ALT||ea.SPACE)&&this.interactionStart(-4,!0)},this.interactionEnd=function(a){a===L&&(-1!==a&&this.utilities.pivotActive(!1),G=!1)},this.isInteractionActive=function(){return G},this.handleWheelInput=function(b){if(this.isDragging)return!1;if(r.getIs2D()){var c=r.getScreenViewport(),d=a.intersectGround(l+c.width,m+c.height);this.utilities.setPivotPoint(d,!0,!0)}else if(r.getWheelSetsPivot()){var e=a.hitTest(l,m,!0);e&&e.intersectPoint&&this.utilities.setPivotPoint(e.intersectPoint,!0,!0)}return r.getReverseZoomDirection()&&(b*=-1),N.z+=b,0!=b&&this.interactionStart(-1),!0},this.resetKeys=function(){this.autoMove(-1,!1),ea.SHIFT=0,ea.CONTROL=0,ea.ALT=0,ea.SPACE=0},this.autoMove=function(a,b){b&&this.isDragging||(a<0?da[0]=da[1]=da[2]=da[3]=da[4]=da[5]=b:da[a]=b,b||this.interactionEnd(-4),this.interactionCheck())},this.updateModifierState=function(a){ea.CONTROL=q&&a.metaKey||a.ctrlKey?1:0,ea.SHIFT=a.shiftKey?1:0,ea.ALT=a.altKey?1:0},this.handleKeyDown=function(a,b){this.updateModifierState(a);var c=!1;switch(b){case H.EQUALS:this.adjustSpeed(1),c=!0;break;case H.DASH:this.adjustSpeed(-1),c=!0;break;case H.ZERO:this.adjustSpeed(0),c=!0;break;case H.LEFT:this.autoMove(0,!0),c=!0;break;case H.RIGHT:this.autoMove(1,!0),c=!0;break;case H.PAGEUP:this.autoMove(2,!0),c=!0;break;case H.PAGEDOWN:this.autoMove(3,!0),c=!0;break;case H.UP:this.autoMove(4,!0),c=!0;break;case H.DOWN:this.autoMove(5,!0),c=!0;break;default:return!1}return this.isDragging||this.interactionStart(-4),c},this.handleKeyUp=function(a,b){this.updateModifierState(a);var c=!1;switch(b){case H.LEFT:this.autoMove(0,!1),c=!0;break;case H.RIGHT:this.autoMove(1,!1),c=!0;break;case H.PAGEUP:this.autoMove(2,!1),c=!0;break;case H.PAGEDOWN:this.autoMove(3,!1),c=!0;break;case H.UP:this.autoMove(4,!1),c=!0;break;case H.DOWN:this.autoMove(5,!1),c=!0;break;default:return!1}return c&&(this.interactionEnd(-4),G||this.interactionCheck()),c},this.handleDollyPan=function(a){l=a.canvasX,m=a.canvasY;var b=r.getScreenViewport();Q.x=l,Q.y=m,N.x=Q.x/b.width,N.y=Q.y/b.height,B=k(a);var c=THREE.Math.degToRad(a.rotation);C=c-D,Math.abs(C)>1&&(C=0),D=c,j(a.type,"start")&&(A=B,z=1,C=0,D=c),y=a.scale},this.handleGesture=function(a){switch(a.type){case"dragstart":return x="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"!==x&&(this.handleButtonDown(a,0),x="drag"),this.handleMouseMove(a);case"dragend":return"drag"===x&&(this.handleButtonUp(a,0),x=null,!0);case"panstart":return x="pan",this.handlePanStart(a),this.handleDollyPan(a),!0;case"panmove":return"pan"!==x&&(x="pan",this.handlePanStart(a)),this.handleDollyPan(a);case"panend":return"pan"===x&&(this.isDragging=!1,this.handleDollyPan(a),this.interactionEnd(3),!0);case"pinchstart":return this.isDragging=!0,x="pinch",M.x=.5*(a.normalizedX+1),M.y=1-.5*(a.normalizedY+1),O.set(a.canvasX,a.canvasY),P.set(a.canvasX,a.canvasY),E=!1,this.interactionStart(3),this.handleDollyPan(a),!0;case"pinchmove":
return"pinch"===x&&this.handleDollyPan(a);case"pinchend":return"pinch"===x&&(this.isDragging=!1,this.handleDollyPan(a),this.interactionEnd(3),!0)}return!1},this.handleButtonDown=function(a,b){return this.updateModifierState(a),M.x=.5*(a.normalizedX+1),M.y=1-.5*(a.normalizedY+1),P.set(a.canvasX,a.canvasY),N.copy(M),Q.copy(P),T.copy(h(a.canvasX,a.canvasY)),U.copy(T),l=a.canvasX,m=a.canvasY,this.isDragging=!0,this.interactionStart(b),!0},this.handlePanStart=function(a){return this.isDragging=!0,M.x=.5*(a.normalizedX+1),M.y=1-.5*(a.normalizedY+1),O.set(a.canvasX,a.canvasY),P.set(a.canvasX,a.canvasY),this.interactionStart(3),!0},this.handleButtonUp=function(a,b){return this.updateModifierState(a),N.x=.5*(a.normalizedX+1),N.y=1-.5*(a.normalizedY+1),Q.set(a.canvasX,a.canvasY),U.copy(h(a.canvasX,a.canvasY)),T.copy(U),l=a.canvasX,m=a.canvasY,this.interactionEnd(b),this.isDragging=!1,!0},this.handleMouseMove=function(b){return this.updateModifierState(b),this.isDragging?(N.x=.5*(b.normalizedX+1),N.y=1-.5*(b.normalizedY+1),Q.set(b.canvasX,b.canvasY),U.copy(h(b.canvasX,b.canvasY)),l=b.canvasX,m=b.canvasY,!0):(M.x=.5*(b.normalizedX+1),M.y=1-.5*(b.normalizedY+1),P.set(b.canvasX,b.canvasY),N.x=M.x,N.y=M.y,Q.copy(P),l=b.canvasX,m=b.canvasY,b.target===a.canvas&&a.rolloverObject(l,m),!1)},this.handleBlur=function(a){this.resetKeys(),this.interactionEnd(L)},b.addEventListener(f.ESCAPE_EVENT,function(a){o.handleBlur(a)})}Object.defineProperty(b,"__esModule",{value:!0}),b.OrbitDollyPanTool=d;var e=c(198),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e)},function(a,b,c){"use strict";function d(a){this.viewer=a,this.container=null,this.cube=null,this.viewcube=null,this.homeViewContainer=null}Object.defineProperty(b,"__esModule",{value:!0}),b.ViewCubeUi=d;var e=c(223),f=c(4),g=(0,f.getGlobal)();d.prototype={constructor:d,create:function(){this.viewer.config;this.initContainer(),this.initHomeButton()},initContainer:function(){this.container=document.createElement("div"),this.container.className="viewcubeWrapper",this.viewer.container.appendChild(this.container)},initHomeButton:function(){if(!this.homeViewContainer){var a=document.createElement("div");a.className="homeViewWrapper",this.container.appendChild(a),this.homeViewContainer=a;var b=this;a.addEventListener("click",function(a){b.viewer.navigation.setRequestHomeView(!0)})}},setVisible:function(a){this.container.style.display=a?"block":"none"},showTriad:function(a){this.cube&&this.cube.showTriad(a)},displayViewCube:function(a,b){if(b&&this.viewer.prefs.set("viewCube",a),a&&!this.cube)this.viewcube=document.createElement("div"),this.viewcube.className="viewcube",this.container.appendChild(this.viewcube),this.cube=new e.ViewCube("cube",this.viewer.autocam,this.viewcube,g.LOCALIZATION_REL_PATH),this.container.appendChild(this.homeViewContainer);else if(!this.cube)return void this._positionHomeButton();this.viewcube.style.display=a?"block":"none",this._positionHomeButton(),a&&this.viewer.autocam.refresh()},_positionHomeButton:function(){if(this.homeViewContainer){this.cube&&this.viewcube&&"block"===this.viewcube.style.display?this.homeViewContainer.classList.remove("no-viewcube"):this.homeViewContainer.classList.add("no-viewcube")}},uninitialize:function(){this.container&&(this.viewer.container.removeChild(this.container),this.viewcube=null),this.cube&&(this.cube.dtor(),this.cube=null),this.homeViewContainer=null,this.hideHomeViewMenu=null,this.viewer=null}}},function(a,b,c){"use strict";function d(a,b,c,d,e){function n(a,b){var c={};return 0===a.type.indexOf("touch")?a.touches.length>0?(c.clientX=a.touches[0].clientX,c.clientY=a.touches[0].clientY,c.pageX=a.touches[0].pageX,c.pageY=a.touches[0].pageY,c.screenX=a.touches[0].screenX,c.screenY=a.touches[0].screenY,c.movementX=c.screenX-b.prevX,c.movementY=c.screenY-b.prevY,c.which=p.navApi.getUseLeftHandedInput()?3:1):c=b.prevCoords:(c.clientX=a.clientX,c.clientY=a.clientY,c.pageX=a.pageX,c.pageY=a.pageY,c.screenX=a.screenX,c.screenY=a.screenY,c.which=a.which,_?(c.movementX=a.movementX||a.mozMovementX||a.webkitMovementX||0,c.movementY=a.movementY||a.mozMovementY||a.webkitMovementY||0):(c.movementX=c.screenX-b.prevX,c.movementY=c.screenY-b.prevY)),b.prevX=c.screenX,b.prevY=c.screenY,b.prevCoords=c,c}var o=this,p=b,q=b.camera;b.setCube(this),o.currentFace="front",o.showTriad=e&&e.showTriad;var r,s,t,u,v,w,x,y=["top,front","top right","top,left","top,back","bottom,front","bottom,right","bottom,left","bottom,back","left,front","front,right","right,back","back,left"],z=["front,top,right","back,top,right","front,top,left","back,top,left","front,bottom,right","back,bottom,right","front,bottom,left","back,bottom,left"],A=["Go Home",null,"Orthographic","Perspective","Perspective with Ortho Faces",null,"Set current view as Home","Focus and set as Home","Reset Home",null,"Set current view as Front","Set current view as Top","Reset orientation"],B=[!0,null,!0,!0,!0,null,!0,!0,!0,null,!0,!0,!0],C=[null,null,function(){return!p.orthographicFaces&&!q.isPerspective},function(){return!p.orthographicFaces&&q.isPerspective},function(){return p.orthographicFaces},null,null,null,null,null,null,null,null],D=[];o.pcam=new f.PerspectiveCamera(45,1,1,2e3),o.ocam=new f.OrthographicCamera(-265,265,265,-265,-1e3,1e3),o.ocam.fov=o.pcam.fov,o.ocam.aspect=o.pcam.aspect,o.camera=q.isPerspective?o.pcam:o.ocam,o.camera.position.copy(q.position),o.center=new f.Vector3(0,0,0),o.camera.lookAt(o.center);var E,F,G,H,I,J,K,L,M,N,O,P,Q=[],R=[],S=[],T=[],U=[],V=null,W=null,X=null,Y=0,Z=0,$=!0,_=!1,aa=!1,ba=!1,ca=-1!=navigator.userAgent.search("Chrome"),da=-1!=navigator.platform.search("Win32"),ea=!1,fa=!1,ga=[];this.width=0,this.height=0,this.animSpeed=500,this.animate=!0,this.compass=!1,this.viewScaleFactorCompass=1.5,this.viewScale=1,this.draggable=!0,this.wantHomeButton=!1,this.wantRollArrows=!0,this.wantContextMenu=!0,this.inactiveOpacity=.5;var ha=function(a){var b=a.getBoundingClientRect();return{x:b.left,y:b.top,w:b.width,h:b.height}},ia=function(a){a.preventDefault(),a.stopPropagation(),aa=document.pointerLockElement===c||document.mozPointerLockElement===c||document.webkitPointerLockElement===c},ja=function(a,b){var c=a/2,d={x:16711680,y:65280,z:255},e=new f.Matrix4,g=new f.Matrix4;if(1===b.z){var h=new f.Vector3(0,1,0);g.makeRotationAxis(h,Math.PI/2),h.set(1,1,1).normalize(),g.multiply(e.makeRotationAxis(h,2*-Math.PI/3))}var i=new f.PlaneBufferGeometry(50,50),j=function(a,b){var c=document.createElement("canvas");c.width=c.height=128;var d=c.getContext("2d");d.font="128px Arial",d.fillStyle="rgba(255,255,255,1)",d.textAlign="center",d.textBaseline="middle",d.fillText(a,c.width/2,c.height/2);var e=new f.Texture(c);return e.needsUpdate=!0,new f.Mesh(i,new f.MeshBasicMaterial({map:e,side:f.DoubleSide,transparent:!0,color:b,depthWrite:!1,depthTest:!0}))};v=new f.Scene;var k=new f.BoxGeometry(a,10,10),l=new f.Mesh(k,new f.MeshBasicMaterial({color:d.x,shading:f.SmoothShading})),m=new f.Mesh(k,new f.MeshBasicMaterial({color:d.y,shading:f.SmoothShading})),n=new f.Mesh(k,new f.MeshBasicMaterial({color:d.z,shading:f.SmoothShading}));l.applyMatrix(e.makeTranslation(5,-c,-c)),m.applyMatrix(e.makeRotationZ(Math.PI/2)),m.applyMatrix(e.makeTranslation(-c,5,-c)),n.applyMatrix(e.makeRotationY(Math.PI/2)),n.applyMatrix(e.makeTranslation(-c,-c,5)),l.applyMatrix(g),m.applyMatrix(g),n.applyMatrix(g),v.add(l),v.add(m),v.add(n);var o=j("X",d.x),p=j("Y",d.y),q=j("Z",d.z),r=-(50+c)/2-20,s=c+50;o.position.set(s,r,r),p.position.set(r,s,r),q.position.set(r,r,s),o.position.applyMatrix4(g),p.position.applyMatrix4(g),q.position.applyMatrix4(g),D.push(o),D.push(p),D.push(q),v.add(o),v.add(p),v.add(q)},ka=function(){p.navApi.isActionEnabled("orbit")&&(c.style.opacity="1.0",fa=!1),requestAnimationFrame(o.render)},la=function(a){if(fa||p.viewCubeMenuOpen||!p.navApi.isActionEnabled("orbit"))p.navApi.isActionEnabled("orbit")&&(c.style.opacity=1);else{var b=Math.max(4*Math.abs((a.clientX-P.x)/P.w-.5)-1,0),d=Math.max(4*Math.abs((a.clientY-P.y)/P.h-.5)-1,0),e=Math.max(0,Math.min(Math.sqrt(b*b+d*d),1));c.style.opacity=1-e*(1-o.inactiveOpacity)}},ma=function(){p.viewCubeMenuOpen||(c.style.opacity=o.inactiveOpacity,fa=!0,requestAnimationFrame(o.render))},na=function(a){var b=new Image,c=m.endpoint.getUseCredentials()&&(-1===a.indexOf("://")||-1!==a.indexOf(window.location.host));b.crossOrigin=c?"use-credentials":"anonymous";var d=new f.Texture(b);return b.onload=function(){d.needsUpdate=!0,++Z>=11&&requestAnimationFrame(o.render)},b.src=a,d},oa=function(){var a,b=[],c=[];b[0]=za(0,0),b[1]=za(0,Math.PI/2),b[2]=za(0,-Math.PI/2),b[3]=za(0,Math.PI),b[4]=za(Math.PI/2,0),b[5]=za(Math.PI/2,Math.PI/2),b[6]=za(Math.PI/2,-Math.PI/2),b[7]=za(Math.PI/2,Math.PI),c[0]=ya(0,0,0),c[1]=ya(0,Math.PI/2,0),c[2]=ya(0,-Math.PI/2,0),c[3]=ya(0,Math.PI,0),c[4]=ya(Math.PI/2,0,0),c[5]=ya(Math.PI/2,Math.PI/2,0),c[6]=ya(Math.PI/2,-Math.PI/2,0),c[7]=ya(Math.PI/2,Math.PI,0),c[8]=ya(0,0,Math.PI/2),c[9]=ya(0,0,-Math.PI/2),c[10]=ya(-Math.PI/2,0,-Math.PI/2),c[11]=ya(-Math.PI,0,-Math.PI/2),Q.push(xa(0,0)),Q[0].name="front",S.push(Q[0]),U.push(Q[0]),t.add(Q[0]),Q.push(xa(0,Math.PI/2)),Q[1].name="right",S.push(Q[1]),U.push(Q[1]),t.add(Q[1]),Q.push(xa(0,Math.PI)),Q[2].name="back",S.push(Q[2]),U.push(Q[2]),t.add(Q[2]),Q.push(xa(0,-Math.PI/2)),Q[3].name="left",S.push(Q[3]),U.push(Q[3]),t.add(Q[3]),Q.push(xa(Math.PI/2,0)),Q[4].name="bottom",S.push(Q[4]),U.push(Q[4]),t.add(Q[4]),Q.push(xa(-Math.PI/2,0)),Q[5].name="top",S.push(Q[5]),U.push(Q[5]),t.add(Q[5]),a=Q.length;var d;for(d=0;d<b.length;d++)Q.push(b[d]),Q[a+d].name=z[d],t.add(Q[a+d]),S.push(Q[a+d]),U.push(Q[a+d]);for(a=Q.length,d=0;d<c.length;d++)Q.push(c[d]),Q[a+d].name=y[d],t.add(Q[a+d]),S.push(Q[a+d]),U.push(Q[a+d])},pa=function(a,b,c){var d,e=new f.Vector3;if("PerspectiveCamera"===b.type)e.copy(a),e.unproject(b),d=new f.Raycaster(b.position,e.sub(b.position).normalize());else{var g=new f.Vector3;g.copy(a),g.unproject(b),e.copy(b.position).negate().normalize(),d=new f.Raycaster(g,e)}return d.intersectObjects(c)},qa=function(a,b){var c=a.clientX-b.x,d=a.clientY-b.y;return c=c/b.w*2-1,d=(b.h-d)/b.h*2-1,new f.Vector3(c,d,.5)},ra=function(a){if(a.preventDefault(),a.stopPropagation(),p.navApi.isActionEnabled("orbit")&&!p.currentlyAnimating){var b=n(a,o);P=ha(c),c.removeEventListener("mousemove",va,!1),document.addEventListener("mouseup",ua,!1),document.addEventListener("touchend",ua,!1),p.navApi.getUsePivotAlways()||(p.pivot.copy(p.center),p.navApi.setPivotPoint(p.center),p.navApi.setPivotSetFlag(!1)),p.startInteraction(b.pageX,b.pageY);var d,e;0==p.rewindParams.history.length&&p.addHistoryElement(),p.rewindParams.snapped&&p.rewindParams.timelineIndex+1==p.rewindParams.history.length||p.addIntermediateHistoryElement();var f=p.navApi.getUseLeftHandedInput()?1:3;if(b.which!==f){if(o.animSpeed<=0)return void j.logger.error("animSpeed cannot be 0 or less, use ViewCube.animate flag to turn on and off animation",(0,l.errorCodeString)(l.ErrorCodes.VIEWER_INTERNAL_ERROR));e=qa(b,P),d=pa(e,o.camera,U),d.length>0&&(Ca(),o.draggable&&(document.addEventListener("mousemove",sa,!1),document.addEventListener("touchmove",sa,!1),_&&(c.requestPointerLock(),ba=ca&&da)))}}},sa=function a(b){if(b.preventDefault(),b.stopPropagation(),o.animSpeed<=0)return document.removeEventListener("mousemove",a,!1),document.removeEventListener("touchmove",a,!1),void j.logger.error("animSpeed cannot be 0 or less",(0,l.errorCodeString)(l.ErrorCodes.VIEWER_INTERNAL_ERROR));if(!p.currentlyAnimating){var c=n(b,o);if(_&&ba&&(ba=!1,c.movementX=c.movementY=0),aa&&(c.movementX>300||c.movementY>300)&&(c.movementX=0,c.movementY=0),c.movementX===c.movementY&&0===c.movementX)return void(p.currentlyAnimating=!1);$=!1,ea=!0,p.showPivot(!0),p.currentCursor=new f.Vector2(c.pageX,c.pageY),p.orbit(p.currentCursor,p.startCursor,new f.Vector3(-c.movementX,c.movementY,0),p.startState),o.camera.lookAt(o.center),requestAnimationFrame(o.render)}},ta=function(a){a||(document.removeEventListener("mouseup",ua,!1),document.removeEventListener("touchend",ua,!1)),document.removeEventListener("mousemove",sa,!1),document.removeEventListener("touchmove",sa,!1),c.addEventListener("mousemove",va,!1),aa&&document.exitPointerLock()},ua=function(a){a.preventDefault(),a.stopPropagation();var b,d,e;if(p.currentlyAnimating||ea)return p.endInteraction(),p.showPivot(!1),ea=!1,void ta(!1);var f=n(a,o);if(p.viewCubeMenuOpen){var g=f.clientX-P.x,h=f.clientY-P.y;if(p.menuOrigin.x<=g&&g<=p.menuOrigin.x+p.menuSize.x&&p.menuOrigin.y<=h&&h<=p.menuOrigin.y+p.menuSize.y){var i=Math.floor((h-5-p.menuOrigin.y)/25),k=function(a){j.logger.track({name:"navigation/"+a,aggregate:"count"})};switch(i){case 0:k("home"),p.goHome();break;case 1:k("setortho"),p.setOrthographicFaces(!1),p.toOrthographic(),o.camera=o.ocam;break;case 2:k("setpersp"),p.setOrthographicFaces(!1),p.toPerspective(),o.camera=o.pcam;break;case 3:p.setOrthographicFaces(!0),$?(p.toOrthographic(),o.camera=o.ocam):(p.toPerspective(),o.camera=o.pcam);break;case 4:k("sethome"),p.setCurrentViewAsHome(!1);break;case 5:k("focushome"),p.setCurrentViewAsHome(!0);break;case 6:k("resethome"),p.resetHome();break;case 7:k("setfront"),p.setCurrentViewAsFront();break;case 8:k("settop"),p.setCurrentViewAsTop();break;case 9:p.resetOrientation()}}return p.viewCubeMenuOpen=!1,p.removeDropdownMenu(c),(f.clientX<P.x||f.clientX>P.w+P.x||f.clientY<P.y||f.clientY>P.h+P.y)&&ma(),o.mouseMoveSave&&o.processMouseMove(o.mouseMoveSave),p.endInteraction(),void ta(!1)}var l=p.navApi.getUseLeftHandedInput()?1:3;if(f.which===l)return p.viewCubeMenuOpen=!0,p.drawDropdownMenu(A,B,C,f.clientX,f.clientY,c,P),void ta(!0);var m=qa(f,P);if(b=pa(m,o.camera,U),d=pa(m,x,R),e=pa(m,x,T),d.length>0&&$){var r=p.getOrientation();switch(o.currentFace){case"front":switch(r){case"up":d[0].object===R[0]?(p.calculateCubeTransform("top"),o.currentFace="top"):d[0].object===R[1]?(p.calculateCubeTransform("bottom"),o.currentFace="bottom"):d[0].object===R[2]?(p.calculateCubeTransform("right"),o.currentFace="right"):d[0].object===R[3]&&(p.calculateCubeTransform("left"),o.currentFace="left");break;case"right":d[0].object===R[0]?(p.calculateCubeTransform("right"),o.currentFace="right"):d[0].object===R[1]?(p.calculateCubeTransform("left"),o.currentFace="left"):d[0].object===R[2]?(p.calculateCubeTransform("bottom"),o.currentFace="bottom"):d[0].object===R[3]&&(p.calculateCubeTransform("top"),o.currentFace="top");break;case"down":d[0].object===R[0]?(p.calculateCubeTransform("bottom"),o.currentFace="bottom"):d[0].object===R[1]?(p.calculateCubeTransform("top"),o.currentFace="top"):d[0].object===R[2]?(p.calculateCubeTransform("left"),o.currentFace="left"):d[0].object===R[3]&&(p.calculateCubeTransform("right"),o.currentFace="right");break;case"left":d[0].object===R[0]?(p.calculateCubeTransform("left"),o.currentFace="left"):d[0].object===R[1]?(p.calculateCubeTransform("right"),o.currentFace="right"):d[0].object===R[2]?(p.calculateCubeTransform("top"),o.currentFace="top"):d[0].object===R[3]&&(p.calculateCubeTransform("bottom"),o.currentFace="bottom")}break;case"right":switch(r){case"up":d[0].object===R[0]?(p.calculateCubeTransform("top"),o.currentFace="top"):d[0].object===R[1]?(p.calculateCubeTransform("bottom"),o.currentFace="bottom"):d[0].object===R[2]?(p.calculateCubeTransform("back"),o.currentFace="back"):d[0].object===R[3]&&(p.calculateCubeTransform("front"),o.currentFace="front");break;case"right":d[0].object===R[0]?(p.calculateCubeTransform("back"),o.currentFace="back"):d[0].object===R[1]?(p.calculateCubeTransform("front"),o.currentFace="front"):d[0].object===R[2]?(p.calculateCubeTransform("bottom"),o.currentFace="bottom"):d[0].object===R[3]&&(p.calculateCubeTransform("top"),o.currentFace="top");break;case"down":d[0].object===R[0]?(p.calculateCubeTransform("bottom"),o.currentFace="bottom"):d[0].object===R[1]?(p.calculateCubeTransform("top"),o.currentFace="top"):d[0].object===R[2]?(p.calculateCubeTransform("front"),o.currentFace="front"):d[0].object===R[3]&&(p.calculateCubeTransform("back"),o.currentFace="back");break;case"left":d[0].object===R[0]?(p.calculateCubeTransform("front"),o.currentFace="front"):d[0].object===R[1]?(p.calculateCubeTransform("back"),o.currentFace="back"):d[0].object===R[2]?(p.calculateCubeTransform("top"),o.currentFace="top"):d[0].object===R[3]&&(p.calculateCubeTransform("bottom"),o.currentFace="bottom")}break;case"left":switch(r){case"up":d[0].object===R[0]?(p.calculateCubeTransform("top"),o.currentFace="top"):d[0].object===R[1]?(p.calculateCubeTransform("bottom"),o.currentFace="bottom"):d[0].object===R[2]?(p.calculateCubeTransform("front"),o.currentFace="front"):d[0].object===R[3]&&(p.calculateCubeTransform("back"),o.currentFace="back");break;case"right":d[0].object===R[0]?(p.calculateCubeTransform("front"),o.currentFace="front"):d[0].object===R[1]?(p.calculateCubeTransform("back"),o.currentFace="back"):d[0].object===R[2]?(p.calculateCubeTransform("bottom"),o.currentFace="bottom"):d[0].object===R[3]&&(p.calculateCubeTransform("top"),o.currentFace="top");break;case"down":d[0].object===R[0]?(p.calculateCubeTransform("bottom"),o.currentFace="bottom"):d[0].object===R[1]?(p.calculateCubeTransform("top"),o.currentFace="top"):d[0].object===R[2]?(p.calculateCubeTransform("back"),o.currentFace="back"):d[0].object===R[3]&&(p.calculateCubeTransform("front"),o.currentFace="front");break;case"left":d[0].object===R[0]?(p.calculateCubeTransform("back"),o.currentFace="back"):d[0].object===R[1]?(p.calculateCubeTransform("front"),o.currentFace="front"):d[0].object===R[2]?(p.calculateCubeTransform("top"),o.currentFace="top"):d[0].object===R[3]&&(p.calculateCubeTransform("bottom"),o.currentFace="bottom")}break;case"back":switch(r){case"up":d[0].object===R[0]?(p.calculateCubeTransform("top"),o.currentFace="top"):d[0].object===R[1]?(p.calculateCubeTransform("bottom"),o.currentFace="bottom"):d[0].object===R[2]?(p.calculateCubeTransform("left"),o.currentFace="left"):d[0].object===R[3]&&(p.calculateCubeTransform("right"),o.currentFace="right");break;case"right":d[0].object===R[0]?(p.calculateCubeTransform("left"),o.currentFace="left"):d[0].object===R[1]?(p.calculateCubeTransform("right"),o.currentFace="right"):d[0].object===R[2]?(p.calculateCubeTransform("bottom"),o.currentFace="bottom"):d[0].object===R[3]&&(p.calculateCubeTransform("top"),o.currentFace="top");break;case"down":d[0].object===R[0]?(p.calculateCubeTransform("bottom"),o.currentFace="bottom"):d[0].object===R[1]?(p.calculateCubeTransform("top"),o.currentFace="top"):d[0].object===R[2]?(p.calculateCubeTransform("right"),o.currentFace="right"):d[0].object===R[3]&&(p.calculateCubeTransform("left"),o.currentFace="left");break;case"left":d[0].object===R[0]?(p.calculateCubeTransform("right"),o.currentFace="right"):d[0].object===R[1]?(p.calculateCubeTransform("left"),o.currentFace="left"):d[0].object===R[2]?(p.calculateCubeTransform("top"),o.currentFace="top"):d[0].object===R[3]&&(p.calculateCubeTransform("bottom"),o.currentFace="bottom")}break;case"top":switch(r){case"up":d[0].object===R[0]?(p.calculateCubeTransform("back"),o.currentFace="back"):d[0].object===R[1]?(p.calculateCubeTransform("front"),o.currentFace="front"):d[0].object===R[2]?(p.calculateCubeTransform("right"),o.currentFace="right"):d[0].object===R[3]&&(p.calculateCubeTransform("left"),o.currentFace="left");break;case"right":d[0].object===R[0]?(p.calculateCubeTransform("right"),o.currentFace="right"):d[0].object===R[1]?(p.calculateCubeTransform("left"),o.currentFace="left"):d[0].object===R[2]?(p.calculateCubeTransform("front"),o.currentFace="front"):d[0].object===R[3]&&(p.calculateCubeTransform("back"),o.currentFace="back");break;case"down":d[0].object===R[0]?(p.calculateCubeTransform("front"),o.currentFace="front"):d[0].object===R[1]?(p.calculateCubeTransform("back"),o.currentFace="back"):d[0].object===R[2]?(p.calculateCubeTransform("left"),o.currentFace="left"):d[0].object===R[3]&&(p.calculateCubeTransform("right"),o.currentFace="right");break;case"left":d[0].object===R[0]?(p.calculateCubeTransform("left"),o.currentFace="left"):d[0].object===R[1]?(p.calculateCubeTransform("right"),o.currentFace="right"):d[0].object===R[2]?(p.calculateCubeTransform("back"),o.currentFace="back"):d[0].object===R[3]&&(p.calculateCubeTransform("front"),o.currentFace="front")}break;case"bottom":switch(r){case"up":d[0].object===R[0]?(p.calculateCubeTransform("front"),o.currentFace="front"):d[0].object===R[1]?(p.calculateCubeTransform("back"),o.currentFace="back"):d[0].object===R[2]?(p.calculateCubeTransform("right"),o.currentFace="right"):d[0].object===R[3]&&(p.calculateCubeTransform("left"),o.currentFace="left");break;case"right":d[0].object===R[0]?(p.calculateCubeTransform("right"),o.currentFace="right"):d[0].object===R[1]?(p.calculateCubeTransform("left"),o.currentFace="left"):d[0].object===R[2]?(p.calculateCubeTransform("back"),o.currentFace="back"):d[0].object===R[3]&&(p.calculateCubeTransform("front"),o.currentFace="front");break;case"down":d[0].object===R[0]?(p.calculateCubeTransform("back"),o.currentFace="back"):d[0].object===R[1]?(p.calculateCubeTransform("front"),o.currentFace="front"):d[0].object===R[2]?(p.calculateCubeTransform("left"),o.currentFace="left"):d[0].object===R[3]&&(p.calculateCubeTransform("right"),o.currentFace="right");break;case"left":d[0].object===R[0]?(p.calculateCubeTransform("left"),o.currentFace="left"):d[0].object===R[1]?(p.calculateCubeTransform("right"),o.currentFace="right"):d[0].object===R[2]?(p.calculateCubeTransform("front"),o.currentFace="front"):d[0].object===R[3]&&(p.calculateCubeTransform("back"),o.currentFace="back")}}p.elapsedTime=0,p.sphericallyInterpolateTransition()}if(e.length>0){if(p.elapsedTime=0,o.wantHomeButton&&e[0].object===T[N])return p.goHome(),void ta(!1);if(o.wantContextMenu&&e[0].object===T[O])return p.viewCubeMenuOpen=!0,p.drawDropdownMenu(A,B,C,f.clientX,f.clientY,c,P),void ta(!0);if(o.wantRollArrows&&$&&(e[0].object===T[K]||e[0].object===T[L])){var s=e[0].object===T[L],t={center:p.center.clone(),position:q.position.clone(),pivot:q.pivot.clone(),fov:q.fov,worldUp:p.sceneUpDirection.clone(),isOrtho:!1===q.isPerspective},u=p.center.clone().sub(q.position).normalize();s?t.up=q.up.clone().cross(u):(t.up=q.up.clone().multiplyScalar(-1),t.up.cross(u)),t.up.normalize(),p.elapsedTime=0,p.animateTransition(t)}}if(b.length>0){var v=b[0].object.name;o.mouseMoveSave=a,o.cubeRotateTo(v)}ta(!1)};this.cubeRotateTo=function(a){o.currentFace=a,p.orthographicFaces&&-1!==o.currentFace.indexOf(",")&&p.setCameraOrtho(!1),p.calculateCubeTransform(o.currentFace),p.elapsedTime=0,p.sphericallyInterpolateTransition(function(){o.mouseMoveSave&&o.processMouseMove(o.mouseMoveSave)})},this.processMouseMove=function(a){var b,c,d;if(p.viewCubeMenuOpen||p.currentlyAnimating)return void(o.mouseMoveSave=a);o.mouseMoveSave=null;var e=n(a,o),f=qa(e,P);if(b=pa(f,o.camera,S),c=pa(f,x,R),d=pa(f,x,T),V&&!ea&&(V.material.color.setHex(14540253),V=null,requestAnimationFrame(o.render)),c.length>0&&!ea){V=c[0].object;for(var g=J.children.length;--g>=0;)if(V===R[g]){V=J.children[g],V.material.color.setHex(45055);break}requestAnimationFrame(o.render)}W&&!ea&&(W.material.opacity=0,W=null,requestAnimationFrame(o.render)),b.length>0&&!ea&&(W=b[0].object,W.material.opacity=.3,requestAnimationFrame(o.render)),d.length>0&&!ea?X!==d[0].object&&(o.wantHomeButton&&d[0].object===T[N]?(X=d[0].object,T[N].material.map=ga[0]):o.wantRollArrows&&d[0].object===T[K]?(X=d[0].object,T[M].material.map=ga[1]):o.wantRollArrows&&d[0].object===T[L]?(X=d[0].object,T[M].material.map=ga[2]):o.wantContextMenu&&d[0].object===T[O]?(X=d[0].object,T[O].material.map=ga[6]):o.wantHomeButton&&X===T[N]?(X=null,T[N].material.map=ga[3]):!o.wantRollArrows||X!==T[K]&&X!==T[L]&&X!==T[M]?o.wantContextMenu&&X===T[O]&&(X=null,T[O].material.map=ga[5]):(X=null,T[M].material.map=ga[4]),requestAnimationFrame(o.render)):null===X||ea||(o.wantHomeButton&&X===T[N]?(X=null,T[N].material.map=ga[3]):!o.wantRollArrows||X!==T[K]&&X!==T[L]&&X!==T[M]?o.wantContextMenu&&X===T[O]&&(X=null,T[O].material.map=ga[5]):(X=null,T[M].material.map=ga[4]),requestAnimationFrame(o.render))};var va=function(a){p.navApi.isActionEnabled("orbit")&&o.processMouseMove(a)},wa=function(){P=ha(c),o.width=c.offsetWidth,o.height=c.offsetHeight,o.pcam.aspect=o.ocam.aspect=o.width/o.height,o.pcam.updateProjectionMatrix(),o.ocam.updateProjectionMatrix(),o.camera.topFov=o.camera.bottomFov=o.camera.fov/2,o.camera.leftFov=o.camera.rightFov=o.camera.aspect*o.camera.fov/2,o.pcam.aspect=o.ocam.aspect=o.camera.aspect,o.pcam.topFov=o.ocam.topFov=o.camera.topFov,o.pcam.bottomFov=o.ocam.bottomFov=o.camera.bottomFov,o.pcam.leftFov=o.ocam.leftFov=o.camera.leftFov,o.pcam.rightFov=o.ocam.rightFov=o.camera.rightFov,o.renderer.setSize(o.width,o.height),requestAnimationFrame(o.render)},xa=function(a,b){var c,d=new f.Geometry,e=new f.Vector3(0,0,0),g=new f.Vector3(60,-60,105),h=new f.Vector3(60,60,105),i=new f.Vector3(-60,60,105),j=new f.Vector3(-60,-60,105);return d.vertices.push(e),d.vertices.push(g),d.vertices.push(h),d.vertices.push(i),d.vertices.push(j),d.faces.push(new f.Face3(1,2,3)),d.faces.push(new f.Face3(1,3,4)),d.applyMatrix((new f.Matrix4).makeRotationX(a)),d.applyMatrix((new f.Matrix4).makeRotationY(b)),d.computeFaceNormals(),d.computeVertexNormals(),c=new f.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new f.Mesh(d,c)},ya=function(a,b,c){var d,e=new f.Geometry,g=new f.Vector3(60,105,105),h=new f.Vector3(-60,105,105),i=new f.Vector3(-60,60,105),j=new f.Vector3(60,60,105),k=new f.Vector3(60,105,60),l=new f.Vector3(-60,105,60),m=new f.Vector3(-60,105,105),n=new f.Vector3(60,105,105);return e.vertices.push(g),e.vertices.push(h),e.vertices.push(i),e.vertices.push(j),e.vertices.push(k),e.vertices.push(l),e.vertices.push(m),e.vertices.push(n),e.faces.push(new f.Face3(0,1,2)),e.faces.push(new f.Face3(0,2,3)),e.faces.push(new f.Face3(4,5,6)),e.faces.push(new f.Face3(4,6,7)),e.applyMatrix((new f.Matrix4).makeRotationX(a)),e.applyMatrix((new f.Matrix4).makeRotationY(b)),e.applyMatrix((new f.Matrix4).makeRotationZ(c)),e.computeFaceNormals(),e.computeVertexNormals(),d=new f.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new f.Mesh(e,d)},za=function(a,b){var c,d=new f.Geometry,e=new f.Vector3(105,105,105),g=new f.Vector3(60,105,105),h=new f.Vector3(60,60,105),i=new f.Vector3(105,60,105),j=new f.Vector3(105,105,60),k=new f.Vector3(105,105,105),l=new f.Vector3(105,60,105),m=new f.Vector3(105,60,60),n=new f.Vector3(105,105,105),o=new f.Vector3(105,105,60),p=new f.Vector3(60,105,60),q=new f.Vector3(60,105,105);return d.vertices.push(e),d.vertices.push(g),d.vertices.push(h),d.vertices.push(i),d.vertices.push(j),d.vertices.push(k),d.vertices.push(l),d.vertices.push(m),d.vertices.push(n),d.vertices.push(o),d.vertices.push(p),d.vertices.push(q),d.faces.push(new f.Face3(0,1,2)),d.faces.push(new f.Face3(0,2,3)),d.faces.push(new f.Face3(4,5,6)),d.faces.push(new f.Face3(4,6,7)),d.faces.push(new f.Face3(8,9,10)),d.faces.push(new f.Face3(8,10,11)),d.applyMatrix((new f.Matrix4).makeRotationX(a)),d.applyMatrix((new f.Matrix4).makeRotationY(b)),d.computeFaceNormals(),d.computeVertexNormals(),c=new f.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new f.Mesh(d,c)},Aa=function(a){var b=p.cubeFront.clone(),c=p.sceneUpDirection.clone(),d=b.clone().cross(c);c.copy(d).cross(b),b.normalize(),c.normalize(),d.normalize();var e=new f.Vector3(b.x,c.x,d.x).multiplyScalar(a.x);return e.add(new f.Vector3(b.y,c.y,d.y).multiplyScalar(a.y)),e.add(new f.Vector3(b.z,c.z,d.z).multiplyScalar(a.z)),e};this.render=function(){o.camera=q.isPerspective?o.pcam:o.ocam;var a=o.compass?o.viewScaleFactorCompass*o.viewScale:o.viewScale,b=p.center.clone().sub(q.position).normalize(),c=q.up.normalize(),d=new f.Matrix4;b=Aa(b),c=Aa(c),o.camera.position.copy(b),o.camera.position.multiplyScalar(-a/o.camera.position.length()),o.camera.up=c.normalize(),o.camera.lookAt(o.center),Ba();var e=o.renderer;if(e){for(var g=0;g<D.length;g++)d.lookAt(o.camera.position,D[g].position,o.camera.up),D[g].setRotationFromMatrix(d);e.clear(),e.render(r,o.camera),e.render(s,o.camera),e.render(u,o.camera),o.renderTriad&&e.render(v,o.camera),e.render(t,o.camera),e.render(w,x)}};var Ba=function(){$=p.isFaceView(),!$||fa||p.currentlyAnimating?Ca():Da(),fa?Ea():Fa(),fa?Ga():Ha()},Ca=function(){w.remove(J),T[M].material.opacity=0,T[O].material.opacity=0},Da=function(){w.add(J);var a=o.wantRollArrows?1:0;T[M].material.opacity=a,T[O].material.opacity=a},Ea=function(){I.material.opacity=(0,k.isMobileDevice)()?1:0},Fa=function(){I.material.opacity=o.wantContextMenu?1:0},Ga=function(){G.material.opacity=0},Ha=function(){G.material.opacity=o.wantHomeButton?1:0};this.refreshCube=function(){wa()},this.setSize=function(a,b){if(o.width=a,o.height=b,c.children.length>1)for(var d=1;d<c.children.length;d++)c.children[d].style.bottom=(o.height/5).toString()+"px";wa()},this.useTransparency=function(a){fa=a,a?(c.onmouseover=ka,c.onmousemove=la,c.onmouseout=ma,ma()):(c.onmouseover=null,c.onmouseout=null,c.onmousemove=null,c.style.opacity="1.0")},this.showTriad=function(a){a!==o.renderTriad&&(o.renderTriad=a,requestAnimationFrame(o.render))},this.dtor=function(){this.renderer=null},function(){var a=c.getBoundingClientRect();o.width=a.width,o.height=a.height,P=ha(c),x=new f.PerspectiveCamera(70,o.height/o.width,1,1e4),x.position.set(0,0,500),r=new f.Scene,s=new f.Scene,t=new f.Scene,u=new f.Scene,w=new f.Scene,$=!0,Y=200,o.viewScale=3.5*Y;var e=f.LinearFilter,k=Autodesk.Viewing.Private.getResourceUrl,l="res/textures/",m=d||l,n=(new g.DDSLoader).load(k(m+"VCcrossRGBA8small.dds"));n.minFilter=n.maxFilter=e;var q=f.ShaderLib.cube,v=(0,h.createShaderMaterial)(q);v.depthWrite=!1,v.uniforms.tCube.value=n;var y=new f.BoxGeometry(Y,Y,Y,4,4,4),z=new f.BoxGeometry(Y+1,Y+1,Y+1,4,4,4);E=new f.Mesh(y,v),E.position.set(0,0,0),s.add(E);var A=na(k(l+"VCedge1.png"));A.minFilter=A.maxFilter=e,F=new f.Mesh(z,new f.MeshBasicMaterial({map:A,overdraw:!1,transparent:!0,shading:f.SmoothShading})),F.position.set(0,0,0),u.add(F),ja(Y+20,b.getWorldUpVector());var B=Y,C=new f.Geometry,D=new f.Vector3(-30,0,0),Q=new f.Vector3(30,0,0),S=new f.Vector3(0,-30,0);C.vertices.push(D),C.vertices.push(Q),C.vertices.push(S),C.faces.push(new f.Face3(1,0,2)),C.computeFaceNormals();var U=new f.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:f.FlatShading}),V=new f.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:f.FlatShading}),W=new f.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:f.FlatShading}),X=new f.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:f.FlatShading}),Z=new f.PlaneBufferGeometry(.5*Y,.3*Y,2,2),aa=new f.MeshBasicMaterial({transparent:!0,opacity:0}),ba=new f.Mesh(C,U),ca=new f.Mesh(Z,aa);ba.position.set(0,B,0),ca.position.set(0,.9*B,.1);var da=new f.Mesh(C,V),ea=new f.Mesh(Z,aa);da.position.set(0,-B,0),ea.position.set(0,.9*-B,.1),da.rotation.z+=Math.PI,ea.rotation.z+=Math.PI;var fa=new f.Mesh(C,W),ka=new f.Mesh(Z,aa);fa.position.set(B,0,0),ka.position.set(.9*B,0,.1),fa.rotation.z-=Math.PI/2,ka.rotation.z-=Math.PI/2;var la=new f.Mesh(C,X),ma=new f.Mesh(Z,aa);la.position.set(-B,0,0),ma.position.set(.9*-B,0,.1),la.rotation.z+=Math.PI/2,ma.rotation.z+=Math.PI/2,J=new f.Object3D,J.position.set(0,0,0),J.add(ba),J.add(da),J.add(fa),J.add(la),w.add(ca),w.add(ea),w.add(ka),w.add(ma),w.add(J),R.push(ca),R.push(ea),R.push(ka),R.push(ma);var pa=new f.PlaneBufferGeometry(Y/3,Y/3,2,2),qa=new f.MeshBasicMaterial({map:na(k(l+"VChome.png")),transparent:!0,shading:f.FlatShading});G=new f.Mesh(pa,qa),G.position.set(-Y,Y,0),N=T.length,w.add(G),T.push(G);var sa=new f.PlaneBufferGeometry(1.5*Y,1.5*Y,2,2),ta=new f.MeshBasicMaterial({map:na(k(l+"VCarrows.png")),shading:f.FlatShading,transparent:!0
}),ua=new f.Mesh(sa,ta);ua.position.set(.5*Y+20,.5*Y+20,0);var wa=new f.PlaneBufferGeometry(.6*Y,.45*Y,2,2),xa=new f.MeshBasicMaterial({transparent:!0,opacity:0}),ya=new f.Mesh(wa,xa);ya.position.set(.5*Y+20,Y+20,.1);var za=new f.PlaneBufferGeometry(.45*Y,.6*Y,2,2),Aa=new f.MeshBasicMaterial({transparent:!0,opacity:0}),Ba=new f.Mesh(za,Aa);Ba.position.set(Y+20,.5*Y+20,.1),w.add(ua),w.add(ya),w.add(Ba),K=T.length,T.push(ya),L=T.length,T.push(Ba),M=T.length,T.push(ua);var Ca=new f.PlaneBufferGeometry(Y/2.3,Y/2.3,2,2),Da=new f.MeshBasicMaterial({map:na(k(l+"VCcontext.png")),transparent:!0,shading:f.FlatShading});I=new f.Mesh(Ca,Da),I.position.set(Y,-Y,0),O=T.length,w.add(I),T.push(I);var Ea=new f.Geometry;Ea.vertices.push(new f.Vector3(0,0,0)),Ea.vertices.push(new f.Vector3(-Y/2,-Y/2-20,-Y/2)),Ea.vertices.push(new f.Vector3(Y/2,-Y/2-20,-Y/2)),Ea.vertices.push(new f.Vector3(Y/2,-Y/2-20,Y/2)),Ea.vertices.push(new f.Vector3(-Y/2,-Y/2-20,Y/2)),Ea.faces.push(new f.Face3(4,3,2)),Ea.faces.push(new f.Face3(4,2,1));var Fa;Fa=new f.MeshBasicMaterial({color:0,transparent:!0,opacity:.5}),H=new f.Mesh(Ea,Fa),r.add(H),oa(),"CANVAS"===p.renderer.toUpperCase()?o.renderer=new f.CanvasRenderer:"WEBGL"===p.renderer.toUpperCase()?o.renderer=new i.WebGLRenderer({alpha:!0,antialias:!1}):(j.logger.warn("Incorrect use of Autocam.renderer property"),o.renderer=new f.CanvasRenderer),o.useTransparency(!0),o.setSize(o.width,o.height),o.camera.topFov=o.camera.bottomFov=o.camera.fov/2,o.camera.leftFov=o.camera.rightFov=o.camera.aspect*o.camera.fov/2,o.pcam.topFov=o.ocam.topFov=o.camera.topFov,o.pcam.bottomFov=o.ocam.bottomFov=o.camera.bottomFov,o.pcam.leftFov=o.ocam.leftFov=o.camera.leftFov,o.pcam.rightFov=o.ocam.rightFov=o.camera.rightFov,o.renderer.autoClear=!1,o.renderer.setSize(o.width,o.height),o.renderer.sortObjects=!1,c.appendChild(o.renderer.domElement),c.addEventListener("touchstart",ra,!1),c.addEventListener("mousedown",ra,!1),c.addEventListener("mousemove",va,!1),_=!1,_&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,c.requestPointerLock=c.requestPointerLock||c.mozRequestPointerLock||c.webkitRequestPointerLock,document.addEventListener("pointerlockchange",ia,!1),document.addEventListener("mozpointerlockchange",ia,!1),document.addEventListener("webkitpointerlockchange",ia,!1)),ga.push(na(k(l+"VChomeS.png"))),ga.push(na(k(l+"VCarrowsS0.png"))),ga.push(na(k(l+"VCarrowsS1.png"))),ga.push(na(k(l+"VChome.png"))),ga.push(na(k(l+"VCarrows.png"))),ga.push(na(k(l+"VCcontext.png"))),ga.push(na(k(l+"VCcontextS.png")))}()}Object.defineProperty(b,"__esModule",{value:!0}),b.ViewCube=d;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(140),h=c(40),i=c(179),j=c(8),k=c(4),l=c(13),m=c(9)},function(a,b,c){"use strict";function d(a,b,c){function d(b){w=!0,a.target.copy(t.center),a.pivot.copy(t.pivot),a.worldup?a.worldup.copy(t.sceneUpDirection):a.up.copy(t.sceneUpDirection),t.cameraChangedCallback(b),w=!1}function e(a,b){var c=a.clone();return Math.abs(c.clone().dot(b))<Number.MIN_VALUE?(c.normalize(),c):(c=h(a,b),c.length()<Number.MIN_VALUE&&(c=i(b)),c.normalize(),c)}function h(a,b){b.normalize();var c=a.clone().dot(b),d=b.clone().multiplyScalar(c);return d=a.clone().sub(d)}function i(a){for(var b=new f.Vector3(0,0,0),c=[new f.Vector3(0,1,0),new f.Vector3(1,0,0),new f.Vector3(0,0,1),new f.Vector3(0,1,1),new f.Vector3(1,0,1),new f.Vector3(1,1,0),new f.Vector3(1,1,1)],d=0;d<7;d++)if(Math.abs(c[d].dot(a))<Number.MIN_VALUE){b=c[d];break}return b}function j(a,b){var c=new f.Vector2(0,0);return c.x=a/window.innerWidth,c.y=b/window.innerHeight,c}function k(b){b.y=Math.abs(b.y-window.innerHeight);var c,d,e=a.position,g=t.center,h=g.clone().sub(e),i=a.up,j=h.clone().cross(i),k=h.clone().length(),l=k*Math.tan(f.Math.degToRad(a.leftFov)),m=k*Math.tan(f.Math.degToRad(a.rightFov)),n=k*Math.tan(f.Math.degToRad(a.topFov)),o=k*Math.tan(f.Math.degToRad(a.bottomFov)),p=l+m,q=n+o,r=b.x*p/window.innerWidth,s=r-l,u=b.y*q/window.innerHeight,v=u-o;return i=i.clone().normalize().clone().multiplyScalar(v),j=j.clone().normalize().clone().multiplyScalar(s),t.ortho?(c=e.clone().add(j).clone().add(i),d=h):(c=e,d=h.clone().add(i).clone().add(j)),{rayO:c,rayD:d}}function l(a,b,c){var d,e,f,g;d=e=f=g=0;var h=0,i=null,j=null,k=t.snapOrbitDeadZone,l=t.orbitMultiplier;return"h"==a?(d=t.snapOrbitThresholdH,e=t.snapOrbitAccelerationAX,f=t.snapOrbitAccelerationBX,g=1-t.snapOrbitAccelerationPointX,j=t.lockDeltaX,i=t.lockedX):(d=t.snapOrbitThresholdV,e=t.snapOrbitAccelerationAY,f=t.snapOrbitAccelerationBY,g=1-t.snapOrbitAccelerationPointY,j=t.lockDeltaY,i=t.lockedY),i?(j+=c,j<-k?(h=(j+k)*l*1/f,i=!1):j>k&&(h=(j-k)*l*1/f,i=!1)):(h=Math.abs(b)>d?c*l:Math.abs(b)>g*d?c*b>0?c*l*e:c*l*1/e:c*b>0?c*l*f:c*l*1/f)*b>0&&Math.abs(h)>Math.abs(b)&&(this.lockDeltaX=this.lockDeltaY=0,i=!0,h=b),h}function m(){return t.combined}function n(a,b){var c=!1,d=window.innerWidth,e=a.x%d,f=window.innerHeight,g=a.y%f,h=e>0?e-b.x:d+e-b.x,i=g>0?g-b.y:f+g-b.y;return Math.abs(h)<30&&Math.abs(i)<30&&(c=!0),c}function o(a,b,c){c.x=(a.x-b.x)/window.innerWidth,a.x=b.x+(a.x-b.x)%window.innerWidth,c.y=(a.y-b.y)/window.innerHeight,a.y=b.y+(a.y-b.y)%window.innerHeight}function p(a,b,c){if(!R||!a){if(a){var d=new f.Vector2,e=b.x,g=b.y;o(b,c,d),P=window.innerWidth*d.x,Q=window.innerHeight*d.y,e<c.x?e-=60:e+=60,g<c.y?g-=60:g+=60}R=a}}function q(a,b,c){if(0===b)return 0;var d=a,e=t.saveEye.clone().sub(worldUp.clone().multiplyScalar(c+d)),f=t.saveEye.clone().sub(worldUp.clone().multiplyScalar(c)),g=0,h=(t.maxSceneBound-t.minSceneBound)/1e3;t.topLimit&&b>0?(g=t.maxSceneBound-h,t.topLimit=!1):t.bottomLimit&&b<0?(g=t.minSceneBound+h,t.bottomLimit=!1):g=e.dot(worldUp);var i=f.dot(worldUp);return g<t.minSceneBound?i<t.minSceneBound&&(t.bottomLimit=!0,d=0):g>t.maxSceneBound&&i>t.maxSceneBound&&(t.topLimit=!0,d=0),d}function r(a){var b=Math.pow(a,2);a<0&&(b=-b);var c=j(0,b),d=t.maxSceneBound-t.minSceneBound,e=.01*d;c.y*=e;var f=t.userHeightSpeed*c.y;return f=q(f,a,t.m_amount)}function s(a){var b=t.sceneFrontDirection.clone().cross(t.sceneUpDirection),c=Math.abs(Math.abs(a.dot(t.sceneUpDirection))-1),d=Math.abs(Math.abs(a.dot(t.sceneFrontDirection))-1),e=Math.abs(Math.abs(a.dot(b))-1);return c<1e-5||d<1e-5||e<1e-5}var t=this,u=null,v=null,w=!1;this.cube=null,this.camera=a,this.renderer="WEBGL",this.startState={},this.navApi=b,this.orthographicFaces=!1,this.canvas=c,this.cameraChangedCallback=function(){},this.pivotDisplayCallback=function(){},this.transitionCompletedCallback=function(){};var z,A=Date.now(),B=!1;this.dtor=function(){this.cube=null,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.transitionCompletedCallback=null,this.canvas=null},this.registerCallbackCameraChanged=function(a){this.cameraChangedCallback=a},this.registerCallbackPivotDisplay=function(a){this.pivotDisplayCallback=a},this.registerCallbackTransitionCompleted=function(a){this.transitionCompletedCallback=a},this.showPivot=function(a){this.pivotDisplayCallback(a)},this.setWorldUpVector=function(a){w||a&&a.lengthSq()>0&&!a.normalize().equals(this.sceneUpDirection)&&(this.sceneUpDirection.copy(a),this.sceneFrontDirection.copy(this.getWorldFrontVector()),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.cube&&requestAnimationFrame(this.cube.render))},this.getWorldUpVector=function(){return this.sceneUpDirection.clone()},this.getWorldRightVector=function(){var a=this.sceneUpDirection.clone();return Math.abs(a.z)<=Math.abs(a.y)?a.set(a.y,-a.x,0):a.z>=0?a.set(a.z,0,-a.x):a.set(-a.z,0,a.x),a.normalize()},this.getWorldFrontVector=function(){return this.getWorldUpVector().cross(this.getWorldRightVector()).normalize()},this.goToView=function(a){if(this.navApi.isActionEnabled("gotoview")){var b={position:a.position.clone(),up:a.up.clone(),center:a.center.clone(),pivot:a.pivot.clone(),fov:a.fov,worldUp:a.worldUp.clone(),isOrtho:a.isOrtho};t.elapsedTime=0,this.animateTransition(b)}},this.getCurrentView=function(){return{position:a.position.clone(),up:a.up.clone(),center:this.center.clone(),pivot:this.pivot.clone(),fov:a.fov,worldUp:this.sceneUpDirection.clone(),isOrtho:!1===a.isPerspective}},this.setCurrentViewAsHome=function(a){a?(this.navApi.setRequestFitToView(!0),B=!0):this.homeVector=this.getCurrentView()},this.setHomeViewFrom=function(a){var b=a.pivot?a.pivot:this.center,c=a.target?a.target:this.pivot,d=a.worldup?a.worldup:this.sceneUpDirection;this.homeVector={position:a.position.clone(),up:a.up.clone(),center:c.clone(),pivot:b.clone(),fov:a.fov,worldUp:d.clone(),isOrtho:!1===a.isPerspective},this.originalHomeVector={position:a.position.clone(),up:a.up.clone(),center:c.clone(),pivot:b.clone(),fov:a.fov,worldUp:d.clone(),worldFront:this.sceneFrontDirection.clone(),isOrtho:!1===a.isPerspective}},this.toPerspective=function(){a.isPerspective||(a.toPerspective(),d(!1))},this.toOrthographic=function(){a.isPerspective&&(a.toOrthographic(),d(!1))},this.setOrthographicFaces=function(a){this.orthographicFaces=a},this.goHome=function(){this.navApi.isActionEnabled("gotoview")&&(this.navApi.setPivotSetFlag(!1),this.goToView(this.homeVector))},this.resetHome=function(){this.homeVector.position.copy(this.originalHomeVector.position),this.homeVector.up.copy(this.originalHomeVector.up),this.homeVector.center.copy(this.originalHomeVector.center),this.homeVector.pivot.copy(this.originalHomeVector.pivot),this.homeVector.fov=this.originalHomeVector.fov,this.homeVector.worldUp.copy(this.originalHomeVector.worldUp),this.homeVector.isOrtho=this.originalHomeVector.isOrtho,this.goHome()},this.getView=function(){return this.center.clone().sub(a.position)},this.setCameraUp=function(b){var c=this.dir.clone(),d=c.cross(b).normalize();0===d.lengthSq()&&(c.copy(this.dir),b.z>b.y?c.y+=1e-4:c.z+=1e-4,d=c.cross(b).normalize()),a.up.copy(d).cross(this.dir).normalize()},function a(){requestAnimationFrame(a);var b=Date.now();z=b-A,A=b}(),this.ortho=!1,this.center=a.target?a.target.clone():new f.Vector3(0,0,0),this.pivot=a.pivot?a.pivot.clone():this.center.clone(),this.sceneUpDirection=a.worldup?a.worldup.clone():a.up.clone(),this.sceneFrontDirection=this.getWorldFrontVector(),this.dir=this.getView(),this.setCameraUp(a.up),this.saveCenter=this.center.clone(),this.savePivot=this.pivot.clone(),this.saveEye=a.position.clone(),this.saveUp=a.up.clone();var C,D,E,F;this.cubeFront=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),this.setHomeViewFrom(a);var G,H,I=new f.Quaternion,J=new f.Quaternion,K=new f.Quaternion,L=new f.Quaternion;this.userPanSpeed=.5,this.userLookSpeed=2,this.userHeightSpeed=5,this.walkMultiplier=1,this.userZoomSpeed=1.015,this.orbitMultiplier=5,this.currentlyAnimating=!1,a.keepSceneUpright=!0,this.preserveOrbitUpDirection=!0,this.alignOrbitUpDirection=!0,this.constrainOrbitHorizontal=!1,this.constrainOrbitVertical=!1,this.doCustomOrbit=!1,this.snapOrbitDeadZone=.045,this.snapOrbitThresholdH=this.snapOrbitThresholdV=f.Math.degToRad(15),this.snapOrbitAccelerationAX=this.snapOrbitAccelerationAY=1.5,this.snapOrbitAccelerationBX=this.snapOrbitAccelerationBY=2,this.snapOrbitAccelerationPointX=this.snapOrbitAccelerationPointY=.5,this.alignDirTable=new Array(26),this.alignDirTable[0]=new f.Vector3(-1,0,0),this.alignDirTable[1]=new f.Vector3(1,0,0),this.alignDirTable[2]=new f.Vector3(0,-1,0),this.alignDirTable[3]=new f.Vector3(0,1,0),this.alignDirTable[4]=new f.Vector3(0,0,-1),this.alignDirTable[5]=new f.Vector3(0,0,1),this.alignDirTable[6]=new f.Vector3(-1,-1,0),this.alignDirTable[7]=new f.Vector3(-1,1,0),this.alignDirTable[8]=new f.Vector3(1,-1,0),this.alignDirTable[9]=new f.Vector3(1,1,0),this.alignDirTable[10]=new f.Vector3(0,-1,-1),this.alignDirTable[11]=new f.Vector3(0,-1,1),this.alignDirTable[12]=new f.Vector3(0,1,-1),this.alignDirTable[13]=new f.Vector3(0,1,1),this.alignDirTable[14]=new f.Vector3(-1,0,-1),this.alignDirTable[15]=new f.Vector3(1,0,-1),this.alignDirTable[16]=new f.Vector3(-1,0,1),this.alignDirTable[17]=new f.Vector3(1,0,1),this.alignDirTable[18]=new f.Vector3(-1,-1,-1),this.alignDirTable[19]=new f.Vector3(-1,-1,1),this.alignDirTable[20]=new f.Vector3(-1,1,-1),this.alignDirTable[21]=new f.Vector3(-1,1,1),this.alignDirTable[22]=new f.Vector3(1,-1,-1),this.alignDirTable[23]=new f.Vector3(1,-1,1),this.alignDirTable[24]=new f.Vector3(1,1,-1),this.alignDirTable[25]=new f.Vector3(1,1,1),this.combined=!1,this.useSnap=!1,this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new f.Vector3(0,0,0),this.topLimit=!1,this.bottomLimit=!1,this.minSceneBound=0,this.maxSceneBound=0;var M={destinationPercent:1,duration:1,zoomToFitScene:!0,useOffAxis:!1};this.shotParams=M;var N,O;this.zoomDelta=new f.Vector2;var P,Q,R,S=0,T=new f.Vector3,U=new f.Vector3;this.rewindParams={history:[],startTime:void 0,thumbnailSize:56,thumbnailGapSize:12,maxHistorySize:25,snappingEnabled:!0,timelineIndex:0,timelineIndexSlide:0,open:!1,openLocation:new f.Vector2(0,0),openBracket:new f.Vector2(0,0),openBracketA:new f.Vector2(0,0),openBracketB:new f.Vector2(0,0),openLocationOrigin:new f.Vector2(0,0),locationOffset:new f.Vector2(0,0),snapOffset:new f.Vector2(0,0),slideOffset:new f.Vector2(0,0),snapped:!0,resetWeights:!1,recordEnabled:!1,elementIsRecording:!1},this.viewCubeMenuOpen=!1,this.menuSize=new f.Vector2(0,0),this.menuOrigin=new f.Vector2(0,0),a.lookAt(this.center),this.setCube=function(a){this.cube=a},this.loadObject=function(a,b,c){(new f.JSONLoader).load(a,function(a,d){var e=new f.MeshPhongMaterial(d),g=new f.Mesh(a,e);g.scale=b,g.position.copy(c),g.geometry.computeBoundingBox();var h=g.geometry.boundingBox.clone();U.set(h.max.x,h.max.y,h.max.z),T.set(h.min.x,h.min.y,h.min.z),U.multiply(b),T.multiply(b),scene.add(g),objects.push(g)})},this.sync=function(b){b.isPerspective!==a.isPerspective&&(b.isPerspective?a.toPerspective():(a.toOrthographic(),b.saveFov&&(a.saveFov=b.saveFov))),a.fov=b.fov,a.position.copy(b.position),b.target&&(this.center.copy(b.target),a.target.copy(b.target)),b.pivot&&(this.pivot.copy(b.pivot),a.pivot.copy(b.pivot)),this.dir.copy(this.center).sub(a.position),this.setCameraUp(b.up);var c=b.worldup?b.worldup:b.up;c.distanceToSquared(this.sceneUpDirection)>1e-4&&this.setWorldUpVector(c),B&&!this.navApi.getTransitionActive()&&(B=!1,this.setCurrentViewAsHome(!1)),this.cube&&requestAnimationFrame(this.cube.render)},this.refresh=function(){this.cube&&this.cube.refreshCube()},f.Box2.prototype.setCenter=function(a){var b=new f.Vector2(Math.abs(this.max.x-this.min.x)/2,Math.abs(this.max.y-this.min.y)/2);return this.min.copy(a).sub(b),this.max.copy(a).add(b),this},f.Box2.prototype.getIcon2DCoords=function(a,b){var c=this.center;b.set((a.x-c.x)/(this.size().x/2),(a.y-c.y)/(this.size().y/2))},f.Matrix3.prototype.makeRotationFromQuaternion=function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[3]=k-r,b[6]=l+q,b[1]=k+r,b[4]=1-(j+o),b[7]=n-p,b[2]=l-q,b[5]=n+p,b[8]=1-(j+m),this},f.Quaternion.prototype.setFromRotationMatrix3=function(a){var b,c=a.elements,d=c[0],e=c[3],f=c[6],g=c[1],h=c[4],i=c[7],j=c[2],k=c[5],l=c[8],m=d+h+l;return m>0?(b=.5/Math.sqrt(m+1),this.w=.25/b,this.x=(k-i)*b,this.y=(f-j)*b,this.z=(g-e)*b):d>h&&d>l?(b=2*Math.sqrt(1+d-h-l),this.w=(k-i)/b,this.x=.25*b,this.y=(e+g)/b,this.z=(f+j)/b):h>l?(b=2*Math.sqrt(1+h-d-l),this.w=(f-j)/b,this.x=(e+g)/b,this.y=.25*b,this.z=(i+k)/b):(b=2*Math.sqrt(1+l-d-h),this.w=(g-e)/b,this.x=(f+j)/b,this.y=(i+k)/b,this.z=.25*b),this},f.Quaternion.prototype.rotate=function(a){var b=(new f.Matrix4).makeRotationFromQuaternion(this),c=b.elements,d=(new f.Matrix3).set(c[0],c[1],c[2],c[4],c[5],c[6],c[8],c[9],c[10]);return a.applyMatrix3(d)},f.Vector3.prototype.findAngleWith=function(a,b){var c=0,d=this.clone().normalize().clone().dot(a.clone().normalize()),e=this.clone().cross(a).clone().normalize();if(e.clone().length()<Number.MIN_VALUE)c=d>0?0:180;else{b=e.clone().dot(b.clone().normalize())>0?e:-e;var g=(new f.Quaternion).setFromAxisAngle(b,90*f.Math.degToRad);g=g.clone().rotate(a).clone().normalize().clone().dot(this),c=Math.acos(d)*f.Math.radToDeg,Math.abs(c-90)<Number.MIN_VALUE&&(c=90),(c<90&&d*g>0||c>90&&d*g<0||90==c&&g>0)&&(c*=-1)}return c=f.Math.degToRad(c)},"contains"in String.prototype||(String.prototype.contains=function(a,b){return-1!==String.prototype.indexOf.call(this,a,b)}),Math.linearClamp=function(a,b,c){return a<=b?0:a>=c?1:(a-b)/(c-b)},Math.easeClamp=function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;var d=(a-b)/(c-b);return.5*(Math.sin((d-.5)*Math.PI)+1)},Math.linearInterp=function(a,b,c){return b*(1-a)+c*a},Math.equalityClamp=function(a,b,c){return a<=b?b:a>=c?c:a},Math.round2=function(a){return Math.round(100*a)/100},Math.round1=function(a){return Math.round(10*a)/10},this.animateTransition=function(b){if(b){var c=!1,e=0;if(this.setCameraOrtho(b.isOrtho),t.elapsedTime>=M.duration)return e=1,t.center.copy(b.center),t.pivot.copy(b.pivot),a.position.copy(b.position),a.up.copy(b.up),a.target.copy(b.center),b.isOrtho||(a.fov=b.fov),a.dirty=!0,c=!b.worldUp.equals(this.sceneUpDirection),c&&this.setWorldUpVector(b.worldUp),this.currentlyAnimating=!1,d(c),this.showPivot(!1),this.cube&&requestAnimationFrame(this.cube.render),this.addHistoryElement(),this.navApi.setTransitionActive(!1),void this.transitionCompletedCallback();this.currentlyAnimating=!0,this.showPivot(!0),this.navApi.setTransitionActive(!0);var f=M.destinationPercent;e=Math.easeClamp(t.elapsedTime/M.duration,0,f);var g=1-e;t.elapsedTime+=z/500;var h=t.center.clone().multiplyScalar(g).add(b.center.clone().multiplyScalar(e)),i=a.position.clone().multiplyScalar(g).add(b.position.clone().multiplyScalar(e)),j=a.up.clone().multiplyScalar(g).add(b.up.clone().multiplyScalar(e)),k=a.pivot.clone().multiplyScalar(g).add(b.pivot.clone().multiplyScalar(e)),l=this.sceneUpDirection.clone().multiplyScalar(g).add(b.worldUp.clone().multiplyScalar(e)),m=a.fov*g+b.fov*e;t.center.copy(h),t.pivot.copy(k),a.position.copy(i),a.up.copy(j),a.target.copy(h),b.isOrtho||(a.fov=m),a.dirty=!0,c=l.distanceToSquared(this.sceneUpDirection)>1e-4,c&&this.setWorldUpVector(l),a.lookAt(t.center),d(c),this.cube&&requestAnimationFrame(this.cube.render),requestAnimationFrame(function(){t.animateTransition(b)})}},this.sphericallyInterpolateTransition=function(b){var c,e,g,h=0;if(this.currentlyAnimating=!0,this.navApi.setTransitionActive(!0),t.elapsedTime>=M.duration)h=1,this.currentlyAnimating=!1;else{var i=M.destinationPercent;h=Math.easeClamp(t.elapsedTime/M.duration,0,i),t.elapsedTime+=z/500}if(1===h)e=O.position,c=O.center,g=O.up;else{var j=new f.Matrix3,k=I.clone();k.slerp(J,h),j.makeRotationFromQuaternion(k);var l=Math.linearInterp(h,G,H),m=j.elements;c=N.center.clone().multiplyScalar(1-h).add(O.center.clone().multiplyScalar(h)),e=c.clone().sub(new f.Vector3(m[0],m[1],m[2]).multiplyScalar(l)),g=new f.Vector3(m[3],m[4],m[5])}t.center.copy(c),a.position.copy(e),a.up.copy(g),t.navApi.getUsePivotAlways()||t.pivot.copy(c),a.lookAt(t.center),!0===this.currentlyAnimating?(this.showPivot(!0),requestAnimationFrame(function(){t.sphericallyInterpolateTransition(b)})):(this.navApi.setTransitionActive(!1),this.showPivot(!1),this.addHistoryElement(),this.orthographicFaces&&this.isFaceView()&&this.setCameraOrtho(!0),b&&b()),d(!1),this.cube&&requestAnimationFrame(this.cube.render)},this.getOrientation=function(){if(this.cube){var b=Math.round1(a.up.x),c=Math.round1(a.up.y),d=Math.round1(a.up.z),e=this.sceneFrontDirection.clone(),f=this.sceneUpDirection.clone(),g=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();e.x=Math.round1(e.x),e.y=Math.round1(e.y),e.z=Math.round1(e.z),f.x=Math.round1(f.x),f.y=Math.round1(f.y),f.z=Math.round1(f.z),g.x=Math.round1(g.x),g.y=Math.round1(g.y),g.z=Math.round1(g.z);var h=g.clone().multiplyScalar(-1),i=f.clone().multiplyScalar(-1),j=e.clone().multiplyScalar(-1);switch(this.cube.currentFace){case"front":if(f.x==b&&f.y==c&&f.z==d)return"up";if(i.x==b&&i.y==c&&i.z==d)return"down";if(g.x==b&&g.y==c&&g.z==d)return"right";if(h.x==b&&h.y==c&&h.z==d)return"left";break;case"right":if(f.x==b&&f.y==c&&f.z==d)return"up";if(i.x==b&&i.y==c&&i.z==d)return"down";if(j.x==b&&j.y==c&&j.z==d)return"left";if(e.x==b&&e.y==c&&e.z==d)return"right";break;case"left":if(f.x==b&&f.y==c&&f.z==d)return"up";if(i.x==b&&i.y==c&&i.z==d)return"down";if(e.x==b&&e.y==c&&e.z==d)return"left";if(j.x==b&&j.y==c&&j.z==d)return"right";break;case"back":if(f.x==b&&f.y==c&&f.z==d)return"up";if(i.x==b&&i.y==c&&i.z==d)return"down";if(h.x==b&&h.y==c&&h.z==d)return"right";if(g.x==b&&g.y==c&&g.z==d)return"left";break;case"top":if(j.x==b&&j.y==c&&j.z==d)return"down";if(e.x==b&&e.y==c&&e.z==d)return"up";if(g.x==b&&g.y==c&&g.z==d)return"right";if(h.x==b&&h.y==c&&h.z==d)return"left";break;case"bottom":if(e.x==b&&e.y==c&&e.z==d)return"down";if(j.x==b&&j.y==c&&j.z==d)return"up";if(g.x==b&&g.y==c&&g.z==d)return"right";if(h.x==b&&h.y==c&&h.z==d)return"left"}}},this.setCameraOrtho=function(b){b&&a.isPerspective&&a.toOrthographic(),b||a.isPerspective||a.toPerspective()},this.resetOrientation=function(){this.setCameraOrtho(this.originalHomeVector.isOrtho),this.sceneUpDirection.copy(this.originalHomeVector.worldUp),this.sceneFrontDirection.copy(this.originalHomeVector.worldFront),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.setCameraUp(this.sceneUpDirection),d(!0)},this.setCurrentViewAsFront=function(){this.cube&&(this.cube.currentFace="front"),this.sceneUpDirection.copy(a.up.clone()),this.sceneFrontDirection.copy(this.getView()).normalize(),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.orthographicFaces&&this.setCameraOrtho(!0),d(!0)},this.setCurrentViewAsTop=function(){this.cube&&(this.cube.currentFace="top"),this.sceneUpDirection.copy(this.getView()).multiplyScalar(-1).normalize(),this.sceneFrontDirection.copy(a.up),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),d(!0)},this.calculateCubeTransform=function(b){var c=this.sceneUpDirection.clone(),d=this.sceneFrontDirection.clone(),e=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();N=a.clone(),N.center=t.center.clone(),N.pivot=t.pivot.clone(),O=a.clone(),O.center=t.center.clone(),O.pivot=t.pivot.clone();var g=new f.Vector3(0,0,0);b.contains("back")&&(g=g.add(d)),b.contains("front")&&(g=g.sub(d)),b.contains("top")&&(g=g.add(c)),b.contains("bottom")&&(g=g.sub(c)),b.contains("right")&&(g=g.add(e)),b.contains("left")&&(g=g.sub(e));var h=c,i=g.clone().normalize();if(1-Math.abs(i.dot(c))<Number.MIN_VALUE)for(var j=this.getView().normalize(),k=[d.clone(),d.clone().negate(),e.clone(),e.clone().negate()],l=i.dot(c)>0?1:-1,m=j.clone().add(a.up.clone().multiplyScalar(l)).normalize(),n=-2,o=0;o<4;o++){var p=m.dot(k[o]);p>n&&(n=p,h=k[o].multiplyScalar(l))}H=G=this.getView().length(),O.position.copy(O.center.clone().add(g.multiplyScalar(H/g.length()))),O.up.copy(h);var q=N.center.clone().sub(N.position).normalize(),r=q.clone().cross(N.up).normalize(),s=r.clone().cross(q).normalize(),u=new f.Matrix3;u.set(q.x,s.x,r.x,q.y,s.y,r.y,q.z,s.z,r.z),I.setFromRotationMatrix3(u),q=O.center.clone().sub(O.position).normalize(),r=q.clone().cross(O.up).normalize(),s=r.clone().cross(q).normalize(),u.set(q.x,s.x,r.x,q.y,s.y,r.y,q.z,s.z,r.z),K.setFromAxisAngle(q,0),L.setFromAxisAngle(s,0),J.setFromRotationMatrix3(u),J.multiply(K).multiply(L).normalize()},this.centerShot=function(b){N&&!b||(t.elapsedTime=0,N=O=a.clone(),N.center=t.center);var c=t.pivot.clone(),e=c.clone().sub(N.position),f=N.center.clone().sub(N.position).normalize(),g=N.up.clone(),h=f.clone().cross(g).normalize();g=h.clone().cross(f).normalize();var i=h.clone().multiplyScalar(h.dot(e)),j=g.clone().multiplyScalar(g.dot(e)),k=i.clone().add(j);O.position.copy(N.position.clone().add(k)),O.center=c,O.pivot=c;var l=0;if(t.elapsedTime>=M.duration)l=1;else{var m=M.destinationPercent;l=Math.easeClamp(t.elapsedTime/M.duration,0,m),t.elapsedTime+=z/2e3}var n=a.position.clone().multiplyScalar(1-l).add(O.position.clone().multiplyScalar(l)),o=t.center.clone().multiplyScalar(1-l).add(O.center.clone().multiplyScalar(l)),p=t.pivot.clone().multiplyScalar(1-l).add(O.pivot.clone().multiplyScalar(l));a.position.copy(n),t.center.copy(o),t.pivot.copy(p),a.lookAt(t.center),d(!1),1===l?this.addHistoryElement():requestAnimationFrame(function(){t.centerShot(!1)})},this.levelShot=function(){var b=this.getView(),c=b.length(),d=this.sceneUpDirection.clone(),e=a.up.clone().normalize(),f=b.normalize(),g=f.dot(d);if(1-Math.abs(g)>Number.MIN_VALUE){var h=f.clone().cross(d);f=d.clone().cross(h),f.normalize()}else f=e.clone();f.multiplyScalar(c);var i={center:f.add(a.position),up:d,position:a.position,pivot:t.center.clone().add(f),fov:a.fov,worldUp:d};t.elapsedTime=0,t.animateTransition(i)},this.fitToWindow=function(){var b=this.getView(),c=a.up.clone();b.normalize(),c.normalize(),O=a.clone(),O.center=t.center,c=e(c,b),c.normalize(),O.up.copy(c);var d=b.clone().cross(c);d.normalize();var g=T.clone(),h=U.clone(),i=[g,h],j=new f.Vector3(h.x-g.x,h.y-g.y,h.z-g.z);i[2]=new f.Vector3(h.x,g.y,h.z),i[3]=new f.Vector3(h.x,g.y,g.z),i[4]=new f.Vector3(h.x,h.y,g.z),i[5]=new f.Vector3(g.x,h.y,h.z),i[6]=new f.Vector3(g.x,h.y,g.z),i[7]=new f.Vector3(g.x,g.y,h.z);for(var k=0;k<8;k++){var l=i[k].clone().sub(a.position);i[k].setX(l.clone().dot(d)),i[k].setY(l.clone().dot(c)),i[k].setZ(l.clone().dot(b))}var m,n,o,p,q=f.Math.degToRad(a.topFov),r=f.Math.degToRad(a.bottomFov),s=f.Math.degToRad(a.leftFov),u=f.Math.degToRad(a.rightFov);m=s>=0?Number.MAX_VALUE:Number.MIN_VALUE,n=u>=0?Number.MAX_VALUE:Number.MIN_VALUE,o=q>=0?Number.MAX_VALUE:Number.MIN_VALUE,p=r>=0?Number.MAX_VALUE:Number.MIN_VALUE;for(var v=1/Math.tan(u),w=-1/Math.tan(s),x=1/Math.tan(q),y=-1/Math.tan(r),z=0;z<8;z++){var A=i[z].clone(),B=A.z-w*A.x;m=s>=0?Math.min(m,B):Math.max(m,B),B=A.z-v*A.x,n=u>=0?Math.min(n,B):Math.max(n,B),B=A.z-x*A.y,o=q>=0?Math.min(o,B):Math.max(o,B),B=A.z-y*A.y,p=r>=0?Math.min(p,B):Math.max(p,B)}var C=(n-m)/(w-v),D=w*C+m,E=(p-o)/(x-y),F=x*E+o,G=0;if(D<=F){var H=(q-r)/2;if(Math.abs(H)>Number.MIN_VALUE){var I=1/Math.tan(H);E=E-F/I+D/I}G=D}else{var J=(u-s)/2;if(Math.abs(J)>Number.MIN_VALUE){var K=1/Math.tan(J);C=C-D/K+F/K}G=F}var L=new f.Vector3(C,E,G),M=d.clone().multiplyScalar(L.x),N=c.clone().multiplyScalar(L.y),P=b.clone().multiplyScalar(L.z);L=M.clone().add(N.clone().add(P)),O.position.add(L);var Q=j.clone().sub(O.position).dot(b);O.center=O.position.clone().add(b.multiplyScalar(Q)),O.pivot=j.clone();var R={center:O.center,up:O.up,position:O.position,pivot:O.pivot,fov:a.fov,worldUp:t.sceneUpDirection.clone()};t.elapsedTime=0,t.animateTransition(R)},this.updatePivotPosition=function(b){var c,d,e=new f.Vector3(b.x/window.innerWidth*2-1,-b.y/window.innerHeight*2+1,.5);if(e=e.unproject(a),c=new f.Raycaster(a.position,e.sub(a.position).normalize()),d=c.intersectObjects(objects),"zoom"==t.mode)if(void 0!==d[0]){var g=d[0].point;t.pivot.copy(g)}else{var h=k(b);t.pivot.copy(h.rayO.clone().add(h.rayD))}else if(void 0!==d[0]){wheel.cursorImage("pivot");var g=d[0].point;t.isMouseDown||t.pivot.copy(g)}else wheel.cursorImage("SWInvalidArea")},this.onDrawHeight=function(b,c,d,e,g){var h=new f.Vector3(0,1,0),i=a.position.clone().dot(h),j=Math.linearClamp(i,t.minSceneBound,t.maxSceneBound),k=j-.5;v&&(v.find("img#updownImageA").remove(),v.prepend('<img src="'+g+'SWheighthandleA.png" id="updownImageA" style="position:fixed; z-index:9999; top:'+(d-86*k)+"px; left:"+c+'px;"/>'),e||v.prepend('<img src="'+g+'SWheighthandleI.png" id="updownImageI" style="position:fixed; z-index:9998; top:'+(d-86*k)+"px; left:"+c+'px;"/>'))},this.drawDropdownMenu=function(a,b,c,d,e,f,h){var i=0;if(u)f.appendChild(u);else{u=document.createElement("div"),u.className="dropDownMenu",u.style.top="100px",u.style.left="-400px";for(var j=0,k=0,l=0;l<a.length;l++){var m;if(null===a[l])m=document.createElement("li"),m.style.height="1px",j+=1,m.style.backgroundColor="#E0E0E0";else{var n=g.i18n.translate(a[l]);if(k=n.length>k?n.length:k,c[l]){m=document.createElement("div");var o=document.createElement("input"),p=document.createElement("label");o.type="radio",o.className="dropDownMenuCheck",p.innerHTML=n,p.className="dropDownMenuCheckText",m.appendChild(o),m.appendChild(p),m.className="dropDownMenuCheckbox"}else m=document.createElement("li"),m.textContent=n,m.className=b[l]?"dropDownMenuItem":"dropDownMenuItemDisabled";m.id="menuItem"+i,i++,j+=25,m.setAttribute("data-i18n",a[l])}u.appendChild(m)}f.appendChild(u),u.style.minWidth=Math.max(256,7.4*k)+"px";var q=u.getBoundingClientRect().width;this.menuSize.x=q,this.menuSize.y=j}i=0;for(var l=0;l<a.length;l++)if(null!==a[l]){if(c[l]){var r="menuItem"+i,s=document.getElementById(r);s&&(s.children[0].checked=c[l]())}i++}var t=e-15,v=d+1,w=this.canvas.getBoundingClientRect();v+this.menuSize.x>w.right&&(v=d-this.menuSize.x-1),t+this.menuSize.y>w.bottom&&(t=w.bottom-this.menuSize.y),t-=h.y,v-=h.x,u.style.top=t+"px",u.style.left=v+"px",this.menuOrigin.x=v,this.menuOrigin.y=t},this.removeDropdownMenu=function(a){a.removeChild(u)},this.isFaceView=function(){return s(this.center.clone().sub(a.position).normalize())&&s(a.up)},this.startInteraction=function(a,b){this.startCursor=new f.Vector2(a,b),this.startState={saveCenter:this.center.clone(),saveEye:this.camera.position.clone(),savePivot:this.pivot.clone(),saveUp:this.camera.up.clone()},this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new f.Vector3(0,0,0),this.navApi.setTransitionActive(!0)},this.orbit=function(b,c,e,g){if(this.navApi.isActionEnabled("orbit")&&!0!==this.currentlyAnimating){var h="wheel";if(t.orthographicFaces&&!a.isPerspective&&(a.toPerspective(),g&&g.saveEye.copy(this.camera.position)),g&&(h="cube"),"cube"==h?(this.saveCenter.copy(g.saveCenter),this.saveEye.copy(g.saveEye),this.savePivot.copy(g.savePivot),this.saveUp.copy(g.saveUp),this.useSnap=!0,this.doCustomOrbit=!0):(this.saveCenter.copy(this.center),this.savePivot.copy(this.pivot),this.saveEye.copy(a.position),this.saveUp.copy(a.up),this.useSnap=!1,this.doCustomOrbit=!1),m()&&void 0==D&&(D=this.saveCenter.clone(),C=this.saveEye.clone(),F=this.savePivot.clone(),E=this.saveUp.clone()),this.preserveOrbitUpDirection){var i=j(b.x-c.x,b.y-c.y),k=j(e.x,e.y),n=this.sceneUpDirection.clone(),o=this.sceneFrontDirection.clone(),p=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),q=m()?F:this.savePivot,r=m()?C:this.saveEye,s=m()?D:this.saveCenter,u=m()?E:this.saveUp,v=q.clone().sub(r).normalize(),w=s.clone().sub(r).normalize(),x=w.clone().cross(u),y=r.clone().sub(q).length(),z=r.clone().sub(s).length(),A=v.clone().multiplyScalar(-1),B=w.clone().multiplyScalar(-1),G=x,H=u.clone();if(!this.constrainOrbitHorizontal){n.dot(this.saveUp)<-.009&&(i.x=-i.x,k.x=-k.x);var I=0;I=m()?k.x*this.orbitMultiplier:this.useSnap?this.lastSnapRotateX+l("h",0,-k.x):i.x*this.orbitMultiplier,this.lastSnapRotateX=I;var J=(new f.Quaternion).setFromAxisAngle(n,-I);A.applyQuaternion(J),B.applyQuaternion(J),G.applyQuaternion(J),H.applyQuaternion(J)}if(!this.constrainOrbitVertical){var K=o.clone().multiplyScalar(o.dot(G)),L=p.clone().multiplyScalar(p.dot(G)),M=K.clone().add(L);M.clone().normalize();var N=0;if(m())N=k.y*this.orbitMultiplier;else{var O=l("v",0,k.y);N=this.useSnap?this.lastSnapRotateY+O:i.y*this.orbitMultiplier}var P=(new f.Quaternion).setFromAxisAngle(M,-N);if(this.navApi.getOrbitPastWorldPoles())A.applyQuaternion(P).normalize(),B.applyQuaternion(P).normalize(),H.applyQuaternion(P).normalize();else{var Q=H.clone();Q.applyQuaternion(P).normalize();if(n.dot(Q)<0){var R=B.clone();R.applyQuaternion(P).normalize();var S=R.angleTo(n)
;Math.abs(S)>.5*Math.PI&&(S-=S>0?Math.PI:-Math.PI),N-=S,P.setFromAxisAngle(M,-N),A.applyQuaternion(P).normalize(),B.applyQuaternion(P).normalize(),H.applyQuaternion(P).normalize()}else A.applyQuaternion(P).normalize(),B.applyQuaternion(P).normalize(),H.applyQuaternion(P).normalize()}this.lastSnapRotateY=N}var T=A.multiplyScalar(y).add(q);a.position.copy(T),a.up.copy(H),this.center.copy(T),this.center.sub(B.multiplyScalar(z)),m()&&(D.copy(this.center),C.copy(a.position),F.copy(this.pivot),E.copy(a.up))}a.lookAt(this.center),d(!1)}},this.endInteraction=function(){this.navApi.setTransitionActive(!1)},this.look=function(b){if(this.navApi.isActionEnabled("walk")){var c=j(b.x,b.y),e=this.userLookSpeed,g=this.getView(),h=a.up,i=g.clone().cross(h).normalize(),k=this.sceneUpDirection.clone(),l=c.clone();l.x*=Math.PI,l.y*=Math.PI/a.aspect,l.multiplyScalar(e);var m=(new f.Quaternion).setFromAxisAngle(i,-l.y);if(a.keepSceneUpright&&!this.navApi.getOrbitPastWorldPoles()){var n=h.clone();if(n.applyQuaternion(m).normalize(),n.dot(k)<0){var o=g.clone();o.applyQuaternion(m);var p=o.angleTo(k);Math.abs(p)>.5*Math.PI&&(p-=p>0?Math.PI:-Math.PI),l.y-=p,m.setFromAxisAngle(i,-l.y)}}g=m.clone().rotate(g),h=m.clone().rotate(h),h.normalize();var q=a.keepSceneUpright?k:h,r=(new f.Quaternion).setFromAxisAngle(q,-l.x);g=r.clone().rotate(g),h=r.clone().rotate(h),this.center.copy(g.add(a.position)),a.up.copy(h),a.lookAt(this.center),d(!1)}},this.pan=function(b){if(this.navApi.isActionEnabled("pan")){b=j(b.x,b.y);var c=this.getView(),e=a.up.clone().cross(c),g=c.clone().cross(e);e.normalize(),g.normalize(),c.normalize();var h=this.pivot.clone().sub(a.position),i=c.clone().dot(h),k=i*(Math.tan(f.Math.degToRad(a.leftFov))+Math.tan(f.Math.degToRad(a.rightFov))),l=i*(Math.tan(f.Math.degToRad(a.topFov))+Math.tan(f.Math.degToRad(a.bottomFov))),m=b.x*Math.abs(k),n=b.y*Math.abs(l),o=new f.Vector3,p=e.clone().multiplyScalar(m),q=g.clone().multiplyScalar(n);o=p.clone().add(q).clone().multiplyScalar(this.userPanSpeed),a.position.add(o),this.center.add(o),a.lookAt(this.center),d(!1)}},this.zoom=function(b){if(this.navApi.isActionEnabled("zoom")){var c=this.userZoomSpeed,e=Number.MAX_VALUE,f=b.x+b.y,g=Math.pow(c,f),h=this.pivot.clone().sub(this.pivot.clone().sub(this.saveEye).clone().multiplyScalar(g)),i=h.clone().add(t.D.clone().multiplyScalar(t.D.clone().dot(this.pivot.clone().sub(h).clone())));if(!(g>=e)){if(f>0){Math.pow(c,f-0);if(f<0)return void(S=0);a.position.copy(h),this.center.copy(i);var j=h.clone().sub(this.saveEye).dot(t.D);j>e?(a.position.copy(this.saveEye.sub(t.D).clone().multiplyScalar(e)),S=e>0?-1:0):S=-j/e}else a.position.copy(h),this.center.copy(i);a.lookAt(this.center),d(!1)}}},this.walk=function(b,c,e,g,h){if(this.navApi.isActionEnabled("walk")){var i=this.sceneUpDirection.clone(),k=this.sceneFrontDirection.clone(),l=this.sceneFrontDirection.clone().cross(this.sceneUpDirection);n(b,c)?(wheel.cursorImage("SWWalk"),p(!0,b,c),x=c.x,y=c.y):p(!1,b,c),x=b.x,y=b.y;var m=j(x-c.x,y-c.y),o=-m.x,q=-m.y,r=o<0?-1:1,s=q<0?-1:1,t=Math.abs(o),u=Math.abs(q),v=new f.Vector2(30,30);v=j(v.x,v.y),t=n(b,c)?0:Math.abs(o)-v.x,u=n(b,c)?0:Math.abs(q)-v.y;t/=.25,u/=.25,t=t<1?Math.easeClamp(t,0,1):Math.pow(t,1),u=u<1?Math.easeClamp(u,0,1):Math.pow(u,1);var w=t>0?t*r:0,z=u>0?u*s:0,A=this.getView(),B=A.length();A.normalize();A.clone().cross(a.up).normalize();var C=l.clone().multiplyScalar(l.clone().dot(A)),D=k.clone().multiplyScalar(k.clone().dot(A)),E=D.clone().add(C);E=E.clone().length()>Number.MIN_VALUE?E.normalize():a.up;var F=z*(1*this.walkMultiplier),G=E,H=Math.cos(.65);1!=H&&(i.clone().dot(a.up)<-Number.MIN_VALUE&&i.clone().dot(A)<-H||i.clone().dot(a.up)>Number.MIN_VALUE&&i.clone().dot(A)>H)&&(G=-G);var I=-w*this.walkMultiplier*.05,J=a.up;(i.clone().dot(a.up)<-Number.MIN_VALUE||Math.abs(i.clone().dot(a.up))<Number.MIN_VALUE&&i.clone().dot(A)>Number.MIN_VALUE)&&(I=-I),J=i;var K=(new f.Quaternion).setFromAxisAngle(J,I);K.normalize(),A=K.clone().rotate(A),A.normalize(),a.up.copy(K.clone().rotate(a.up)),a.up.normalize(),a.position.add(G.clone().multiplyScalar(F)),this.center.copy(a.position.clone().add(A.clone().multiplyScalar(B))),G=i,G.normalize(),0===F&&(F=.01),a.lookAt(this.center),d(!1)}},this.updown=function(b){if(!this.navApi.getIsLocked()){var c=b,e=r(c);t.m_amount+=e;var g=new f.Vector3(0,1,0),h=t.saveEye.clone().sub(g.clone().multiplyScalar(t.m_amount)),i=h.clone().dot(g);a.position.copy(h),i<t.minSceneBound&&a.position.add(g.clone().multiplyScalar(t.minSceneBound-i)),i>t.maxSceneBound&&a.position.add(g.clone().multiplyScalar(t.maxSceneBound-i)),this.center.copy(a.position.clone().add(t.saveCenter.clone().sub(t.saveEye))),a.lookAt(this.center),d(!1)}},this.addHistoryElement=function(){},this.addIntermediateHistoryElement=function(){this.rewindParams.snapped?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.slideOffset.x>0?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex+1),this.addHistoryElement()},this.clearHistory=function(){this.rewindParams.history.length=0,this.rewindParams.timelineIndex=0,this.rewindParams.timelineIndexSlide=0,this.rewindParams.resetWeights=!0},this.openTimeline=function(a){this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights&&(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=this.rewindParams.snappingEnabled),0===this.rewindParams.history.length&&this.addHistoryElement();for(var b=0;b<this.rewindParams.history.length;b++){var c=b-this.rewindParams.timelineIndex,d=this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize;this.rewindParams.history[b].thumbnailBounds.setCenter(new f.Vector2(a.x+c*d,a.y).add(this.rewindParams.slideOffset)),this.rewindParams.resetWeights&&(this.rewindParams.history[b].weight=b==this.rewindParams.timelineIndex?1:0)}this.rewindParams.resetWeights&&(this.rewindParams.resetWeights=!1);var d=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize);if(this.rewindParams.open=!0,this.rewindParams.openLocation=a.clone(),this.rewindParams.openLocationOrigin=a.clone(),this.rewindParams.openBracket=a.clone(),this.rewindParams.openBracketA=new f.Vector2(d,a.y),this.rewindParams.openBracketB=new f.Vector2(window.innerWidth-d,a.y),this.rewindParams.openBracketA.x>this.rewindParams.openBracketB.x){var e=this.rewindParams.openBracketA.x;this.rewindParams.openBracketA.x=this.rewindParams.openBracketB.x,this.rewindParams.openBracketB.x=e}this.rewindParams.locationOffset=new f.Vector2(0,0),this.rewindParams.snapOffset=new f.Vector2(0,0)},this.slideTimeline=function(a){if(this.rewindParams.open&&0!==this.rewindParams.history.length){var b=a.clone().add(this.rewindParams.locationOffset),c=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),d=c,e=window.innerWidth-c,g=this.rewindParams.history[0].thumbnailBounds.center().x,h=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x,i=0;if(b.x<this.rewindParams.openBracketA.x){i=b.x-this.rewindParams.openBracketA.x;var j=g-i;d<j&&(i=Math.min(i+(j-d),0))}if(b.x>this.rewindParams.openBracketB.x){i=b.x-this.rewindParams.openBracketB.x;var k=h-i;e>k&&(i=Math.max(i+(k-e),0))}this.rewindParams.openLocation.x+=i,this.rewindParams.openBracketA.x+=i,this.rewindParams.openBracketB.x+=i,this.rewindParams.openBracket.x=b.x-(this.rewindParams.openLocation.x-this.rewindParams.openLocationOrigin.x);var l=new f.Vector2(-i,0),m=b.clone().sub(this.rewindParams.openLocation.clone().sub(this.rewindParams.openLocationOrigin));l.x+=this.rewindParams.snapOffset.x,this.rewindParams.snapOffset.x=0;var n=!1;if(this.rewindParams.snappingEnabled)for(var o=0;o<this.rewindParams.history.length;o++){var p=this.rewindParams.history[o].thumbnailBounds.center().add(l);if(Math.abs(p.x-m.x)<4||this.rewindParams.snapped&&Math.abs(p.x-m.x)<16){n=!0,0!==i?(this.rewindParams.snapOffset.x=p.x-m.x,l.x-=this.rewindParams.snapOffset.x):this.rewindParams.openBracket.x+=p.x-m.x,m.x=p.x;break}}this.rewindParams.snapped=n;for(var q=-1,r=0,s=0;s<this.rewindParams.history.length;s++){var t=this.rewindParams.history[s].thumbnailBounds.clone();if(this.rewindParams.history[s].thumbnailBounds.setCenter(this.rewindParams.history[s].thumbnailBounds.center().add(l)),this.rewindParams.history[s].thumbnail){var u=this.rewindParams.history[s].thumbnailBounds.center().x-this.rewindParams.thumbnailSize/2;$("#rewindFrame"+s).css("left",u),$("#rewindBorder"+s).css("left",u-4)}var v=new f.Vector2(2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize));t.setFromCenterAndSize(t.center(),v);var w=new f.Vector2(0,0);t.getIcon2DCoords(m,w);var x=1-Math.abs(Math.equalityClamp(w.x,-1,1));this.rewindParams.history[s].weight=x,0===s&&m.x<t.center().x&&(this.rewindParams.history[s].weight=1),s===this.rewindParams.history.length-1&&m.x>t.center().x&&(this.rewindParams.history[s].weight=1),r+=this.rewindParams.history[s].weight,this.rewindParams.history[s].weight>q&&(q=this.rewindParams.history[s].weight,this.rewindParams.snappingEnabled&&1==this.rewindParams.history[s].weight?(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=!0):this.rewindParams.slideOffset.x=this.rewindParams.history[s].thumbnailBounds.center().x-m.x,this.rewindParams.timelineIndexSlide=s)}for(var y=0;y<this.rewindParams.history.length;y++)this.rewindParams.history[y].weight=this.rewindParams.history[y].weight/r;var z=this.rewindParams.history[0].thumbnailBounds.center().x,A=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x;this.rewindParams.openBracket.x<z?(this.rewindParams.locationOffset.x+=z-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=z):this.rewindParams.openBracket.x>A&&(this.rewindParams.locationOffset.x+=A-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=A)}},this.shiftBackOneElement=function(){0!==this.rewindParams.history.length&&(this.rewindParams.timelineIndex>0||0!==this.rewindParams.slideOffset.x)&&((this.rewindParams.snapped||this.rewindParams.slideOffset.x>0)&&this.rewindParams.timelineIndex--,this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights=!0,t.elapsedTime=0,this.animateToRewindIndex())},this.animateToRewindIndex=function(){var b=this.rewindParams.timelineIndex,c=0;if(t.elapsedTime>=M.duration)c=1;else{var e=M.destinationPercent;c=Math.easeClamp(t.elapsedTime/M.duration,0,e),t.elapsedTime+=z/500}t.center.copy(t.center.clone().multiplyScalar(1-c).clone().add(this.rewindParams.history[b].camera.center.clone().multiplyScalar(c))),a.position.copy(a.position.clone().multiplyScalar(1-c).clone().add(this.rewindParams.history[b].camera.position.clone().multiplyScalar(c))),a.up.copy(this.rewindParams.history[b].camera.up),t.pivot.copy(t.center),a.lookAt(t.center),d(!1),this.cube&&requestAnimationFrame(this.cube.render),1!==c&&requestAnimationFrame(function(){t.animateToRewindIndex()})},this.closeTimeline=function(){this.rewindParams.timelineIndex!=this.rewindParams.timelineIndexSlide&&(this.rewindParams.timelineIndex=this.rewindParams.timelineIndexSlide),this.rewindParams.open=!1},this.getInterpolatedCamera=function(){var b=new f.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e4);b.center=new f.Vector3(0,0,0),b.pivot=new f.Vector3(0,0,0),b.leftFov=0,b.rightFov=0,b.topFov=0,b.bottomFov=0,b.up.set(0,0,0);for(var c=0;c<this.rewindParams.history.length;c++){var e=this.rewindParams.history[c].camera,g=this.rewindParams.history[c].weight;b.center.add(e.center.clone().multiplyScalar(g)),b.position.add(e.position.clone().multiplyScalar(g)),b.up.add(e.up.clone().multiplyScalar(g)),b.rotation.add(e.rotation.clone().multiplyScalar(g)),b.pivot.add(e.pivot.clone().multiplyScalar(g)),b.leftFov+=e.leftFov*g,b.rightFov+=e.rightFov*g,b.topFov+=e.topFov*g,b.bottomFov+=e.bottomFov*g}a.position.copy(b.position),a.up.copy(b.up),a.rotation=b.rotation,a.leftFov=b.leftFov,a.rightFov=b.rightFov,a.topFov=b.topFov,a.bottomFov=b.bottomFov,t.center.copy(b.center),t.pivot.copy(b.pivot),a.lookAt(t.center),a.up.normalize(),d(!1)}}Object.defineProperty(b,"__esModule",{value:!0}),b.Autocam=d;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e),g=c(35)},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b){function c(a){if(!a)return null;var b=window.devicePixelRatio;b||(b=1);var c=S;c.canvas=a,c.devicePixelRatio=b,c.stencil=!0;var d=new t.WebGLRenderer(c);return d.context?(d.autoClear=!1,d.sortObjects=!1,d):null}function d(a){var b=jb.phase,c=b!=u.RenderFlags.RENDER_HIGHLIGHTED2,d=b==u.RenderFlags.RENDER_NORMAL||b==u.RenderFlags.RENDER_HIGHLIGHTED1,e=(Da.settings.idbuffer||Da.settings.occlusionid)&&b!=u.RenderFlags.RENDER_HIDDEN,f=b==u.RenderFlags.RENDER_HIGHLIGHTED1||b==u.RenderFlags.RENDER_HIGHLIGHTED2?15:0;e&&Da.settings.occlusionid&&a instanceof v.RenderBatch&&a.sortObjects&&(e=!1);var g=b==u.RenderFlags.RENDER_HIDDEN?Ja.edgeColorGhosted:Ja.edgeColorMain;Da.setEdgeColor(g),b==u.RenderFlags.RENDER_HIDDEN&&(a.overrideMaterial=Ja.fadeMaterial),Da.renderScenePart(a,c,d,e,f),a.overrideMaterial=null}function e(a){db++,bb<=a&&bb>0&&(cb=.8*cb+.2*(a-bb)),Ja.fpsCallback&&Ja.fpsCallback(Ja.fps())}function w(a){if(Ja.keyFrameAnimator){var b=bb>0?(a-bb)/1e3:0,c=Ja.keyFrameAnimator.update(b);if(c&&(Ja.sceneUpdated(!0),c&Ja.keyFrameAnimator.UPDATE_CAMERA))return!0}return!1}function J(a){ya&&(Ja.canvasBoundingclientRectDirty=!0,Ja.camera.aspect=za/Aa,Ja.camera.clientWidth=za,Ja.camera.clientHeight=Aa,Da.setSize(za,Aa),Ja.controls.handleResize(),Ha&&Ha.setSize(za,Aa),Ja.invalidate(!0,!0,!0),ya=!1,a||Ja.api.dispatchEvent({type:N.VIEWER_RESIZE_EVENT,width:za,height:Aa}))}function M(){if((Ga.enabled||Ha)&&!Ja.is2d){var a;if(a=Ja.model&&!Ja.model.isLoadDone()?Ja.model.getData().bbox:Ja.getVisibleBounds(!0,!1)){var b=Ja.camera,c=a.clone(),d=new K.Vector3(1,0,0),e=Sa.clone();b.worldUpTransform&&(c.applyMatrix4(b.worldUpTransform),d.applyMatrix4(b.worldUpTransform),e.applyMatrix4(b.worldUpTransform)),c.min.y-=.005*(c.max.y-c.min.y),Ea&&Ea.expandByGroundShadow(c,e);var f=c.size(),g=c.center();if(Ea||(f.x*=1.25,f.z*=1.25,f.x=f.z=Math.max(f.x,f.z)),b.worldUpTransform){var h=(new K.Matrix4).getInverse(b.worldUpTransform);g.applyMatrix4(h)}if(Ga.setTransform(g,f,b.worldup,d),Ha){var i=(new K.Vector3).subVectors(g,b.worldup.clone().multiplyScalar(f.y/2));Ha.setTransform(i,b.worldup,f)}Ea&&Ea.setGroundShadowTransform(g,f,b.worldup,d)}}}function T(){return!!Za&&(M(),Ga.setDirty(),Za=!1,!0)}function U(a){for(var b in Ja.selectionMeshes){var c=Ja.selectionMeshes[b];if(c.model){var d=c.model.getFragmentList();c.geometry===d.getGeometry(c.fragId)&&d.getWorldMatrix(c.fragId,c.matrix)}}}function V(){Ea&&(Ea.state=x.SHADOWMAP_NEEDS_UPDATE)}function W(){this.highResTimeStamp=-1,this.screenDrawn=sb.NOTHING_DRAWN,this.screenHasChanged=!1,this.frameBudget=0,this.frameRemaining=0,this.phase=u.RenderFlags.RENDER_NORMAL,this.useStencil=!1,this.signalProgressByRendering=!1,this.tickCount=0,this.beginFrameAvg=0,this.lastBeginFrameTimeStamp=0,this.RENDERMODE_FULL=0,this.RENDERMODE_PROGRESSIVE=1,this.RENDERMODE_SILENT=2,this.renderType=this.RENDERMODE_FULL,this.INITIAL_GROUND_SHADOW=.2,this.cmdListActive=!1,this.cmdIndex=0,this.continueExecution=!0,this.encounteredAlwaysDo=!1,this.finishedFullRender=!0,this.groundShadowInPost=!1,this.drawOverlay=!1,this.cmdIsOpen=!1,this.allocArraySize=0,this.cmdListLength=0,this.cmdList=[],this.paramList=[],this.CMD_NORMAL_SEQUENCE=0,this.CMD_DO_AFTER=1,this.CMD_ALWAYS_DO=2,this.isActive=function(){return this.cmdListActive},this.setFrame=function(a){this.frameBudget=a},this.beginCommandSet=function(){this.cmdListActive=!0,this.cmdIndex=0,this.cmdListLength=0,this.encounteredAlwaysDo=!1,this.tickCount=0,this.screenDrawn=sb.NOTHING_DRAWN,this.screenHasChanged=!1},this.endCommandSet=function(){this.cmdIsOpen&&(this.cmdIsOpen=!1,this.cmdListLength++)},this._internalSetParam=function(a,b){this.paramList[this.cmdIndex][a]=b},this.addCommand=function(a,b){for(this.cmdIsOpen&&this.cmdListLength++,this.cmdIsOpen=!0;this.allocArraySize<=this.cmdListLength;)this.cmdList[this.cmdListLength]={},this.paramList[this.cmdListLength]={},this.allocArraySize++;return this.cmdList[this.cmdListLength]=a,this.paramList[this.cmdListLength].executionLevel=b||this.CMD_NORMAL_SEQUENCE,this.encounteredAlwaysDo=this.encounteredAlwaysDo||b===this.CMD_ALWAYS_DO,this.cmdListLength},this.setParam=function(a,b){this.cmdIsOpen?this.paramList[this.cmdListLength][a]=b:Q&&r.logger.error("ERROR: cannot set param when no command is open!")},this.getParam=function(a){return Q&&void 0===this.paramList[this.cmdIndex][a]&&r.logger.error("ERROR: parameter "+a+" was never set for this command! Go fix it."),this.paramList[this.cmdIndex][a]},this.executeCommandList=function(){if(jb.cmdListActive){this.frameRemaining=this.frameBudget,Q&&this.cmdIsOpen&&r.logger.error("ERROR: should call endCommandSet before executing"),this.continueExecution=!0;var a;if(R&&(0===this.tickCount&&console.log("==================="),console.log("Running commands for "+(jb.renderType===jb.RENDERMODE_PROGRESSIVE?"progressive":jb.renderType===jb.RENDERMODE_FULL?"full":"silent")+" render, for tick count "+this.tickCount)),this.encounteredAlwaysDo)for(var b=0;b<this.cmdIndex;)this.paramList[b].executionLevel>=jb.CMD_ALWAYS_DO&&(R&&console.log("  ALWAYS DO command "+b+": "+this.cmdList[b].name),this.cmdList[b]()),b++;for(;this.cmdIndex<this.cmdListLength;)(this.continueExecution||this.paramList[this.cmdIndex].executionLevel>=jb.CMD_DO_AFTER)&&(R&&console.log("  command "+this.cmdIndex+": "+this.cmdList[this.cmdIndex].name+" and "+jb.frameRemaining+" frame budget remaining"),this.cmdList[this.cmdIndex]()&&(R&&console.log("  >>> out of tick time with "+jb.frameRemaining),a=this.cmdIndex,this.continueExecution=!1)),this.cmdIndex++;return this.continueExecution?this.cmdListActive=!1:this.cmdIndex=a,this.tickCount++,!this.continueExecution}return!0}}function X(){if(jb.renderType===jb.RENDERMODE_PROGRESSIVE)if(jb.getParam("GenerateGroundShadow.afterBeauty")){if(jb.frameRemaining=Ga.prepareGroundShadow(Ja.modelQueue(),0,jb.frameRemaining),Ga.getStatus()==y.GroundFlags.GROUND_RENDERED){if(jb.getParam("GenerateGroundShadow.signalRedraw"))return Ja.requestSilentRender(),R&&console.log(" $$$$ SIGNAL FULL GROUND SHADOW REDRAW"),!0;jb.groundShadowInPost=!0}}else 0===jb.tickCount&&Ga.prepareGroundShadow(Ja.modelQueue(),10);else jb.frameRemaining=Ga.prepareGroundShadow(Ja.modelQueue(),0,jb.frameRemaining);return jb.frameRemaining<0&&Ga.getStatus()===y.GroundFlags.GROUND_UNFINISHED}function Y(){return Ga.getStatus()!==y.GroundFlags.GROUND_UNFINISHED&&Ja.renderGroundShadow(),!1}function Z(){return jb.renderType===jb.RENDERMODE_PROGRESSIVE?jb.getParam("GenerateGroundReflection.afterBeauty")?(jb.frameRemaining=Ha.prepareGroundReflection(Ga,Ja,!1,0,jb.frameRemaining),Ha.getStatus()==y.GroundFlags.GROUND_RENDERED&&(jb.screenDrawn|=sb.REFLECTION_DRAWN,jb.groundShadowInPost&&Ba.hasTransparentMaterial()&&Ja.requestDeferredSilentRender())):0===jb.tickCount&&Ha.prepareGroundReflection(Ga,Ja,!0,10):jb.frameRemaining=Ha.prepareGroundReflection(Ga,Ja,!1,0,jb.frameRemaining),jb.frameRemaining<0&&Ha.getStatus()===y.GroundFlags.GROUND_UNFINISHED}function $(){if(Ea.state===x.SHADOWMAP_NEEDS_UPDATE)jb.frameRemaining=Ea.startUpdate(Ia,jb.frameRemaining,Ja.camera,Sa,Ba);else if(Ea.state==x.SHADOWMAP_INCOMPLETE&&(jb.frameRemaining=Ea.continueUpdate(Ia,jb.frameRemaining,Ba),Ea.state==x.SHADOWMAP_VALID))return Ja.requestSilentRender(),R&&console.log(" $$$$ SIGNAL FULL SHADOW MAP REDRAW"),!0;return jb.frameRemaining<0&&Ea.state!==x.SHADOWMAP_VALID}function _(){Ea.state=x.SHADOWMAP_NEEDS_UPDATE}function aa(){if(jb.signalProgressByRendering&&Ja.signalProgress(0,g.ProgressState.RENDERING),jb.renderType===jb.RENDERMODE_PROGRESSIVE){if(jb.lastBeginFrameTimeStamp>0){var a=jb.highResTimeStamp-jb.lastBeginFrameTimeStamp;jb.beginFrameAvg=.75*jb.beginFrameAvg+.25*a}jb.lastBeginFrameTimeStamp=jb.highResTimeStamp,jb.beginFrameAvg<La&&jb.frameBudget<Ka?(Ja.targetFrameBudget+=1,Ja.targetFrameBudget>Ka&&(Ja.targetFrameBudget=Ka)):jb.beginFrameAvg>La&&jb.frameBudget>Ma&&(Ja.targetFrameBudget-=1,Ja.targetFrameBudget<Ma&&(Ja.targetFrameBudget=Ma))}Ja.updateCameraMatrices();var b=jb.getParam("BeginScene.clear");return Da.beginScene(Ja.scene,Ja.camera,Ja.lightsOn?Ja.lights:Ja.no_lights,b),Ja.toggleHighlightsLights(!0),b&&(jb.screenDrawn|=sb.BACKGROUND_DRAWN),jb.getParam("BeginScene.signalCameraChanged")&&Ja.api.dispatchEvent(Ja.cameraChangedEvent),!1}function ba(){return jb.phase=jb.getParam("BeginPhase.phase"),jb.useStencil=jb.getParam("BeginPhase.useStencil"),jb.useStencil||Da.setStencilEnabled(!1),R&&console.log("     render phase is now "+jb.phase),Ia.reset(Ja.camera,jb.phase,jb.getParam("BeginPhase.moved"),Ba.getCutPlanes(),jb.phase==u.RenderFlags.RENDER_HIGHLIGHTED1||jb.phase==u.RenderFlags.RENDER_HIGHLIGHTED2),!1}function ca(){return Ia.isEmpty()||Ia.isDone()||(jb.useStencil&&Da.setStencilEnabled(jb.phase<=u.RenderFlags.RENDER_HIGHLIGHTED2),jb.screenDrawn|=sb.MODEL_DRAWN,jb.frameRemaining=Ia.renderSome(d,jb.frameRemaining,qb),jb.signalProgressByRendering&&(Ja.signalProgress(100*Ia.getRenderProgress(),g.ProgressState.RENDERING),R&&console.log("  %%% percent done "+100*Ia.getRenderProgress())),jb.useStencil&&Da.setStencilEnabled(!1)),!Ia.isDone()}function da(){return jb.phase=u.RenderFlags.RENDER_FINISHED,Da.renderScenePart(Ja.sceneAfter,!0,!0,!0,0),Ja.renderAfters.render(),!1}function ea(){return jb.phase=u.RenderFlags.RENDER_FINISHED,!1}function fa(){Ja.signalProgress(100,g.ProgressState.RENDERING)}function ga(){return Ja.isOverlayDirty()&&(Ja.clearOverlayDirtyFlag(),jb.drawOverlay=!0),jb.drawOverlay&&(!Ia.isEmpty()&&Ia.isDone()||Ja.showOverlaysWhileMoving?(Ja.renderOverlays(),jb.screenDrawn|=sb.OVERLAY_DRAWN):(Da.clearAllOverlays(),jb.drawOverlay=!1)),!1}function ha(){jb.screenDrawn|=sb.ALL_DRAWN}function ia(){if(jb.screenDrawn&&(jb.phase===u.RenderFlags.RENDER_FINISHED||jb.tickCount%Ja.frameDisplayRate==0)){var a=!jb.getParam("PostAndPresent.performAO")||(jb.screenDrawn&(sb.BACKGROUND_DRAWN|sb.MODEL_DRAWN))==sb.BACKGROUND_DRAWN;Da.composeFinalFrame(a),jb.screenHasChanged=!0,jb.screenDrawn=sb.NOTHING_DRAWN,e(jb.highResTimeStamp),Ja.api.dispatchEvent({type:N.RENDER_PRESENTED_EVENT})}return!1}function ja(){return Q&&!1===Da.getAOEnabled()&&r.logger.error("AO should be on at this point!"),Da.setAOEnabled(!1),!1}function ka(){return Q&&!0===Da.getAOEnabled()&&r.logger.error("AO should be off at this point!"),Da.setAOEnabled(!0),!1}function la(){return Ja.requestSilentRender(),!1}function ma(){return jb.finishedFullRender=!0,!1}function na(a){jb.highResTimeStamp=a=a||0;var b=Ba.updateMaterials();Ja.invalidate(b.needsClear,b.needsRender,b.overlayDirty);var c=w(a),d=Ja.controls.update(a),e=Ia&&Ia.update(a),f=d||c||Fa||e;qb.moved=f,Fa=!1;var g=ya;J(),Ua=Ua||f,Wa=Wa||f,Xa=Xa||f;var h=!1;Wa?U(a):Da.overlayUpdate()&&!Wa&&(Wa=h=!0),jb.signalProgressByRendering=Ja.model&&(Ja.model.isLoadDone()||!0===Ja.model.getData().partPacksLoadDone)&&!Ja.model.getData().isLeaflet,T()&&(Ua=!0);var i=Ua,j=Ia.frameResumePossible();if(Ua=Ua||!j,_a=_a||$a&&!jb.cmdListActive,Xa&&jb.cmdListActive&&(Ua=!0),Ua||Va||Wa||Xa||_a)if(jb.drawOverlay=Wa,Ua||Va||_a){var k,l=i?z.ResetFlags.RESET_RELOAD:Ua?z.ResetFlags.RESET_REDRAW:z.ResetFlags.RESET_NORMAL;Ua||Va?Ja.progressiveRender?(jb.renderType=jb.RENDERMODE_PROGRESSIVE,k=Ja.targetFrameBudget):(jb.renderType=jb.RENDERMODE_FULL,k=Ja.interruptBudget):(jb.renderType=jb.RENDERMODE_SILENT,k=Ja.targetFrameBudget,Ua=!0,l=z.ResetFlags.RESET_REDRAW),$a=_a=!1,jb.setFrame(k),jb.finishedFullRender=!1,jb.beginCommandSet();var m=Ga.enabled&&!Ja.is2d&&!eb,n=!!Ha&&!Ja.is2d&&!eb,o=f||g,p=f&&Ja.skipAOWhenMoving&&Da.getAOEnabled();jb.addCommand(aa),jb.setParam("BeginScene.signalCameraChanged",o),jb.setParam("BeginScene.clear",Ua),p&&jb.addCommand(ja,jb.CMD_ALWAYS_DO);var q=!1;Ia&&(Ea&&Ea.state!==x.SHADOWMAP_VALID&&jb.addCommand($),m&&(jb.addCommand(X),jb.setParam("GenerateGroundShadow.afterBeauty",!1),jb.setParam("GenerateGroundShadow.signalRedraw",!1)),n?(Ha.setDirty(),jb.addCommand(Z),jb.setParam("GenerateGroundReflection.afterBeauty",!1)):m&&jb.addCommand(Y),q=Ia.hasHighlighted(),q&&(jb.addCommand(ba),jb.setParam("BeginPhase.phase",u.RenderFlags.RENDER_HIGHLIGHTED1),jb.setParam("BeginPhase.moved",l),jb.setParam("BeginPhase.useStencil",q),l=!1,jb.addCommand(ca)),jb.addCommand(ba),jb.setParam("BeginPhase.phase",u.RenderFlags.RENDER_NORMAL),jb.setParam("BeginPhase.moved",l),jb.setParam("BeginPhase.useStencil",q),l=!1,jb.addCommand(ca),!Ia.areAllVisible()&&Ja.showGhosting?(n&&jb.renderType===jb.RENDERMODE_PROGRESSIVE||(jb.addCommand(ba),jb.setParam("BeginPhase.phase",u.RenderFlags.RENDER_HIDDEN),jb.setParam("BeginPhase.moved",l),jb.setParam("BeginPhase.useStencil",q),jb.addCommand(ca)),jb.addCommand(ea)):jb.addCommand(da),jb.signalProgressByRendering&&jb.addCommand(fa)),jb.addCommand(ga,jb.renderType===jb.RENDERMODE_PROGRESSIVE?jb.CMD_DO_AFTER:jb.CMD_NORMAL_SEQUENCE),jb.addCommand(ia,jb.renderType===jb.RENDERMODE_PROGRESSIVE?jb.CMD_DO_AFTER:jb.CMD_NORMAL_SEQUENCE),jb.setParam("PostAndPresent.performAO",Da.getAOEnabled()&&!p),jb.renderType===jb.RENDERMODE_PROGRESSIVE&&Ia&&(Ea&&Ea.state!==x.SHADOWMAP_VALID&&(jb.addCommand(_),jb.addCommand($)),m&&(jb.addCommand(X),jb.setParam("GenerateGroundShadow.afterBeauty",!0),jb.setParam("GenerateGroundShadow.signalRedraw",!n),jb.signalProgressByRendering&&jb.addCommand(fa)),n&&(jb.groundShadowInPost=!1,jb.addCommand(Z),jb.setParam("GenerateGroundReflection.afterBeauty",!0),!Ia.areAllVisible()&&Ja.showGhosting&&(jb.addCommand(ba),jb.setParam("BeginPhase.phase",u.RenderFlags.RENDER_HIDDEN),jb.setParam("BeginPhase.moved",l),jb.setParam("BeginPhase.useStencil",q),jb.addCommand(ca)),jb.addCommand(ea),jb.addCommand(ia),jb.setParam("PostAndPresent.performAO",Da.getAOEnabled()&&!p),jb.signalProgressByRendering&&jb.addCommand(fa))),p&&(jb.addCommand(ka,jb.CMD_ALWAYS_DO),jb.addCommand(la)),jb.addCommand(ma),jb.endCommandSet(),Ua=!1,Va=!1,Wa=!1,Xa=!1}else jb.finishedFullRender&&(jb.beginCommandSet(),R&&console.log("=====\nOVERLAY DIRTY"),Xa&&(jb.addCommand(Da.clearHighlight.bind(Da)),Ia.hasHighlighted()&&(jb.addCommand(ba),jb.setParam("BeginPhase.phase",u.RenderFlags.RENDER_HIGHLIGHTED2),jb.setParam("BeginPhase.moved",z.ResetFlags.RESET_REDRAW),jb.setParam("BeginPhase.useStencil",!0),jb.addCommand(ca))),h?jb.addCommand(ha):jb.addCommand(ga,!0),jb.addCommand(ia,!0),jb.setParam("PostAndPresent.performAO",Da.getAOEnabled()),jb.endCommandSet(),Wa=!1,Xa=!1);mb=jb.cmdListActive,jb.executeCommandList(),mb!==rb&&(Ja.api.dispatchEvent({type:N.FINAL_FRAME_RENDERED_CHANGED_EVENT,value:{finalFrame:!mb}}),rb=mb),bb=jb.highResTimeStamp}function oa(){for(var a in Ja.selectionMeshes){var b=Ja.selectionMeshes[a];b.model&&b.model.isConsolidated()&&b.model.updateRenderProxy(b,b.fragId)}}function pa(a){function b(){if(c){Ja.keyFrameAnimator=new C.KeyFrameAnimator(Ja,c.duration);for(var a in c.animations)Ja.keyFrameAnimator.add(c.animations[a]);Ja.keyFrameAnimator.goto(0),Ja.api.dispatchEvent({type:N.ANIMATION_READY_EVENT})}Ja.api.removeEventListener(N.OBJECT_TREE_CREATED_EVENT,b)}var c=a.getData().animations;c&&(a.isObjectTreeCreated()?b():Ja.api.addEventListener(N.OBJECT_TREE_CREATED_EVENT,b))}function qa(){if(!(0,f.isMobileDevice)()){var a=Ia.getModels().length;Da.setIdTargetCount(a)&&Ba.toggleMRTSetting(Da.mrtFlags())}}function ra(a,b){wb=wb||new K.Box3,b.updateMatrixWorld(!0),b.traverse(function(b){var c=b.geometry;void 0!==c&&c.visible&&(c.boundingBox||c.computeBoundingBox(),wb.copy(c.boundingBox),wb.applyMatrix4(b.matrixWorld),a.union(wb))})}function sa(){var a=new K.Box3,b=Ja.overlayScenes;for(var c in b)b.hasOwnProperty(c)&&ra(a,b[c].scene);return ra(a,Ja.scene),a}function ta(){var a=void 0;for(var b in ob){var c=ob[b];c&&c.length&&(a=a?b===pb?c.concat(a):a.concat(c):c)}Ja.setCutPlanes(a)}function ua(a,b,c,d,e){var f=a.getFragmentList().getVizmesh(b);new I.VertexBufferReader(f.geometry,d).enumGeomsForVisibleLayer(c,e)}function va(a,b,c,d,e){var f=a.getFragmentList().getVizmesh(b);new I.VertexBufferReader(f.geometry,d).enumGeomsForObject(c,e)}var wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja=this,Ka=1e3/15,La=1e3/30,Ma=1e3/120,Na=-1,Oa=-1,Pa=null,Qa="y",Ra=null,Sa=null,Ta=null,Ua=!1,Va=!1,Wa=!1,Xa=!1,Ya={type:N.PROGRESS_UPDATE_EVENT,state:g.ProgressState.LOADING,percent:0},Za=!1,$a=!1,_a=!1,ab=0,bb=0,cb=1e3/60,db=0,eb=!0,fb=!1,gb=!1,hb=null,ib=null;this.edgeColorMain=new K.Vector4(0,0,0,.3),this.edgeColorGhosted=new K.Vector4(0,0,0,.1);var jb,kb,lb,mb,nb=(0,f.getGlobal)(),ob={},pb="",qb={visibleIdCB:function(){return Da?Da.copyOcclusionIds():null},occlusionTestCB:function(a,b,c,d,e){return Da?Da.occlusionTest(a,b,c,d,e):Promise.resolve(!0)}},rb=!0;a&&setInterval(function(){eb||db<60||Ja.track({name:"fps",value:Number(Ja.fps().toFixed(2)),aggregate:"last"})},3e4),this.api=b,this.canvas=a,this.loader=null,this.canvasBoundingclientRectDirty=!0,this.initialize=function(){if(wa=new K.Vector3(0,1,0),Ia=new h.RenderScene,(Ca=c(a))||(0,f.isNodeJS)()){Ca&&(this.onWebGLcontextLost=this.onWebGLcontextLost.bind(this),Ca.webglcontextlost=this.onWebGLcontextLost),Da=new j.RenderContext,Da.init(Ca,a?a.clientWidth:0,a?a.clientHeight:0),this.use2dInstancing=(0,f.isMobileDevice)()&&this.glrenderer().supportsInstancedArrays(),Ba=new k.MaterialManager(Ca),this.camera=new L.UnifiedCamera(a?a.clientWidth:512,a?a.clientHeight:512),this.lightsOn=!1,this.lights=[],this.highlight_lights=[],this.no_lights=[],hb=(new K.Color).setRGB(1,1,1),ib=(new K.Color).setRGB(1,1,1),this.cameraChangedEvent={type:N.CAMERA_CHANGE_EVENT,camera:this.camera},Ra=new K.Vector3(1,1,1),Sa=(new K.Vector3).copy(Ra),Ta=new K.Vector3(-1,0,1),this.scene=new K.Scene,this.sceneAfter=new K.Scene,this.sceneAfter.sortObjects=!1,this.renderAfters=new l.RenderCallbacks,this.overlayScenes={},this.selectionMaterial2d=null,vb(),this.createOverlayScene("selection_points",null,null),this.selectionMeshes={},this.fadeMaterial=new K.MeshPhongMaterial({color:16777215,opacity:.1,reflectivity:0,transparent:!0,depthWrite:!1}),this.fadeMaterial.packedNormals=!0,Ba.addInstancingSupport(this.fadeMaterial),Ba.addMaterial("__fadeMaterial__",this.fadeMaterial,!0),this.setSelectionColor(6724095),Ba.togglePolygonOffset(!0),Da.setDepthMaterialOffset(Ba.getPolygonOffsetOn(),Ba.getPolygonOffsetFactor(),Ba.getPolygonOffsetUnits()),this.progressiveRender=!0,this.swapBlackAndWhite=!1,this.targetFrameBudget=La,this.frameDisplayRate=5,(0,f.isMobileDevice)()&&(Ka*=2,Ma/=2,La*=2,this.targetFrameBudget/=2,this.frameDisplayRate/=2),this.interruptBudget=1e10,this.controls={update:function(a){this.camera.lookAt(this.camera.target),this.camera.updateProjectionMatrix(),this.camera.dirty=!1},handleResize:function(){},recordHomeView:function(){},uninitialize:function(){},isToolActivated:function(){return!1}},this.selector=new m.MultiModelSelector(this),this.visibilityManager=new n.MultiModelVisibilityManager(this),this.showGhosting=!0,this.showOverlaysWhileMoving=!0,this.skipAOWhenMoving=!1,this.keyFrameAnimator=null,this.zoomBoundsChanged=!0;var b=o.LightPresets[o.DefaultLightPreset].bgColorGradient;this.setClearColors(b[0],b[1],b[2],b[3],b[4],b[5]),Ga=new p.GroundShadow(Ca),Ga.enabled=!0,jb=new W,Ba.addMaterialNonHDR("groundShadowDepthMaterial",Ga.getDepthMaterial()),Ba.addOverrideMaterial("normalsMaterial",Da.getDepthMaterial()),Ba.addOverrideMaterial("edgeMaterial",Da.getEdgeMaterial()),
Da.beginScene(this.scene,this.camera,this.noLights,!0),Da.composeFinalFrame(!0,f.isIE11),this.api.addEventListener(N.GEOMETRY_DOWNLOAD_COMPLETE,function(a){a.memoryLimited?Ja.onDemandLoadComplete(a.model):Ja.onLoadComplete(a.model)},!1),lb=function(){var a=!!Ia.getMemoryInfo();Ba.toggleDepthWriteTransparent(!a),Da.setMemoryLimited(a),a&&(this.toggleGroundReflection(!1),this.toggleGroundShadow(!1))}.bind(this),this.api.addEventListener(N.MODEL_ROOT_LOADED_EVENT,lb),this.api.addEventListener(N.MODEL_UNLOADED_EVENT,lb)}},this.renderGroundShadow=function(a){Ea?Ea.state==x.SHADOWMAP_VALID&&Ea.renderGroundShadow(Ja.camera,a||Da.getColorTarget()):(Ga.renderShadow(Ja.camera,a||Da.getColorTarget()),Ga.rendered=!0)};var sb={NOTHING_DRAWN:0,MODEL_DRAWN:1,BACKGROUND_DRAWN:2,OVERLAY_DRAWN:4,REFLECTION_DRAWN:8,ALL_DRAWN:15};this.setLmvDisplay=function(a){nb=a},this.run=function(){xa=0,setTimeout(function(){!function a(b){xa=nb.requestAnimationFrame(a),na(b)}()},1)},this.stop=function(){window.cancelAnimationFrame(xa)},this.toggleProgressive=function(a){this.progressiveRender=a,Ua=!0},this.toggleVizBuffer=function(a){var b=this.glrenderer();b&&this.isvizCacheEnabled!==a&&(this.isvizCacheEnabled=a,this.model&&b&&(this.model.isvizCacheEnabled=a,this.model.readbackTargetIdCallback=this.renderer().readbackTargetId,b.setUseFragmentIdsInBuffer(a)),Ua=!0)},this.toggleSwapBlackAndWhite=function(a){this.swapBlackAndWhite=a,Da.toggleSwapBlackAndWhite(a),Ua=!0},this.toggleGrayscale=function(a){Ba.setGrayscale(a),Ua=!0},this.toggleGhosting=function(a){this.showGhosting=a,Ua=!0},this.toggleOverlaysWhileMoving=function(a){this.showOverlaysWhileMoving=a},this.togglePostProcess=function(a,b){Da.initPostPipeline(a,b),this.fireRenderOptionChanged(),Ua=!0},this.preloadPostProcessStyle=function(a){Da.preloadPostProcessStyle(a)},this.setPostProcessParameter=function(a,b){Da.setPostProcessParameter(a,b),this.fireRenderOptionChanged(),this.invalidate(!0)},this.toggleGroundShadow=function(a){Ga.enabled!==a&&(Ga.enabled=a,Ga.clear(),a&&Ga.setDirty(),M(),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundShadowColor=function(a){Ga.enabled&&(Ga.setColor(a),this.invalidate(!0,!1,!1))},this.setGroundShadowAlpha=function(a){Ga.enabled&&(Ga.setAlpha(a),this.invalidate(!0,!1,!1))},this.toggleGroundReflection=function(a){a&&Ha||!a&&!Ha||(a?(Ha=new A.GroundReflection(Ca,this.canvas.clientWidth,this.canvas.clientHeight,{clearPass:Da.getClearPass()}),Ha.setClearColors(this.clearColorTop,this.clearColorBottom,(0,f.isMobileDevice)()),Ha.toggleEnvMapBackground(fb),Ha.setEnvRotation(Da.getEnvRotation()),M()):(Ha.cleanup(),Ha=void 0),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundReflectionColor=function(a){Ha&&(Ha.setColor(a),this.invalidate(!0,!1,!1))},this.setGroundReflectionAlpha=function(a){Ha&&(Ha.setAlpha(a),this.invalidate(!0,!1,!1))},this.toggleEnvMapBackground=function(a){fb=a,Da.toggleEnvMapBackground(a),Ha&&Ha.toggleEnvMapBackground(a),this.invalidate(!0,!0,!1)},this.isEnvMapBackground=function(){return fb},this.setOptimizeNavigation=function(a){this.skipAOWhenMoving=a},this.renderOverlays=function(){oa();var a=this.lightsOn;a||this.toggleLights(!0,!0);var b;this.dir_light1&&(b=this.dir_light1.intensity,this.dir_light1.intensity=1),Da.renderOverlays(this.overlayScenes,this.lightsOn?this.lights:this.no_lights),a||this.toggleLights(!1,!0),this.dir_light1&&(this.dir_light1.intensity=b)},this.setLayerVisible=function(a,b){this.layers.setLayerVisible(a,b)},this.isLayerVisible=function(a){return this.layers.isLayerVisible(a)},this.getVisibleLayerIndices=function(){return this.layers.getVisibleLayerIndices()},this.updateCameraMatrices=function(){function a(){b=new K.Matrix4,c=new K.Matrix4,d=new K.Box3}var b,c,d;return function(){d||a();var e=this.camera;if(b.compose(e.position,e.quaternion,e.scale),c.getInverse(b),e.worldup&&this.setWorldUp(e.worldup),this.model){var f=this.getVisibleBounds(!0,Wa);if(d.copy(f),Ha){var g=new K.Vector3;g.multiplyVectors(d.max,e.worldup);var h=new K.Vector3;h.multiplyVectors(d.min,e.worldup),g.sub(h),g.x>=0?d.min.x-=g.x:d.max.x-=g.x,g.y>=0?d.min.y-=g.y:d.max.y-=g.y,g.z>=0?d.min.z-=g.z:d.max.z-=g.z}Ea&&Ea.groundShapeBox&&d.union(Ea.groundShapeBox),d.applyMatrix4(c);var i=1e-5*(d.max.z-d.min.z),j=.5*(d.max.y-d.min.y),k=-(d.max.z+i)-j,l=-(d.min.z-i)+j;e.isPerspective&&(k=Math.max(k,Math.min(1,1e-4*Math.abs(l-k))),l<0&&(l=1e-4),k=Math.max(k,1e-5*l)),l=Math.max(l,k),e.near=k,e.far=l,e.updateProjectionMatrix(),e.updateMatrixWorld();var m,n;if(this.model.is2d()){var o=this.intersectGroundViewport(new K.Vector3(0,0,1));m=o?e.position.distanceTo(o):e.position.distanceTo(f.center()),n=Da.settings.deviceHeight/(2*m*Math.tan(K.Math.degToRad(.5*e.fov))),Ba.updatePixelScale(n,Da.settings.deviceWidth,Da.settings.deviceHeight),Ba.updateSwapBlackAndWhite(this.swapBlackAndWhite)}else{var p,q=Ba.getCutPlanesRaw();if(q&&q.length){var r=q[0],s=e.target.clone().sub(e.position).normalize(),t=s.dot(r);if(0===t)p=f.center();else{var u=-(e.position.clone().dot(r)+r.w)/t;p=f.clampPoint(s.multiplyScalar(u).add(e.position))}}else p=f.center();m=e.position.distanceTo(p),n=Da.settings.deviceHeight/(2*m*Math.tan(K.Math.degToRad(.5*e.fov))),Ba.updatePixelScale(n,Da.settings.deviceWidth,Da.settings.deviceHeight)}}}}(),this.initLights=function(){this.dir_light1=new K.DirectionalLight(hb,1),this.dir_light1.position.copy(Ta),this.highlight_dir_light1=new K.DirectionalLight(hb,1),this.highlight_dir_light1.intensity=1,this.highlight_dir_light1.position.copy(Ta),this.amb_light=new K.AmbientLight(ib),this.highlight_amb_light=new K.AmbientLight(ib),this.lights=[this.dir_light1,this.amb_light],this.highlight_lights=[this.highlight_dir_light1,this.highlight_amb_light],this.camera.add(this.dir_light1),this.camera.add(this.dir_light1.target),this.camera.add(this.highlight_dir_light1),this.camera.add(this.highlight_dir_light1.target),gb=!0};var tb=function(a,b,c,d){var e=o.LightPresets[Na],f=e&&e.ambientColor,g=e&&e.directLightColor;f=f||ib.toArray(),g=g||hb.toArray(),c?(d&&a?a.color.setRGB(.5*g[0],.5*g[1],.5*g[2]):a&&a.color.setRGB(f[0],f[1],f[2]),b&&b.color.setRGB(g[0],g[1],g[2])):a&&d&&a.color.setRGB(f[0],f[1],f[2])};this.toggleHighlightsLights=function(a){this.highlight_amb_light&&(this.highlightsOn=a,tb(this.highlight_amb_light,this.highlight_dir_light1,a,!0),Da.setHighlightLights(a?this.highlight_lights:this.no_lights))},this.toggleLights=function(a,b){this.amb_light&&(this.lightsOn=a,tb(this.amb_light,this.dir_light1,a,b))},this.syncCamera=function(a){this.camera.updateProjectionMatrix(),a&&this.setWorldUp(this.api.navigation.getWorldUpVector()),Fa=!0},this.setViewFromFile=function(a,b){if(a){var c,d=a.getDefaultCamera();if(d)c=d;else{c={};var e=a.getBoundingBox(),f=e.size();if(c.target=e.center(),a.is2d()){c.isPerspective=!1;var g=f.x/f.y,h=this.camera.aspect;c.orthoScale=h>g?f.y:f.x/h,c.up=new K.Vector3(0,0,1),c.position=c.target.clone(),c.position.z+=c.orthoScale,c.target.y+=1e-6*f.y}else c.isPerspective=!0,c.fov=this.camera.fov,c.up=this.camera.up.clone(),c.position=c.target.clone(),c.position.z+=1.5*Math.max(f.x,f.y,f.z)}var i=a.getMetadata("navigation hint","value",null),j=this.controls.isToolActivated("freeorbit")||b&&"Freeorbit"===i;this.setViewFromCamera(c,b,j)}},this.adjustOrthoCamera=function(a){if(!a.isPerspective&&this.model){var b=this.model.getBoundingBox(),c=b.size(),d=a.target.clone().sub(a.position),e=d.length();if(e>1e3*c.length()){var f=a.position.distanceTo(b.center());a.target.copy(a.position).add(d.normalize().multiplyScalar(f))}else if(Math.abs(e-a.orthoScale)/e>1e-5){r.logger.warn("Ortho scale does not match eye-target distance. One of them is likely wrong, but which one?");var g=0===a.fov&&1===a.orthoScale,h=!g;h&&a.position.copy(a.target).add(d.normalize().multiplyScalar(-a.orthoScale))}}},this.setViewFromCamera=function(a,b,c){this.adjustOrthoCamera(a);var d,e=this.model?this.model.getUpVector():null;d=e?(new K.Vector3).fromArray(e):c?a.up.clone():O.Navigation.snapToAxis(a.up.clone()),c?this.api.prefs&&this.api.prefs.set("fusionOrbitConstrained",d.equals(a.up)):a.up=d;var f=this.api.navigation;if(f){var g=this.camera;if(b)g.up.copy(a.up),g.position.copy(a.position),g.target.copy(a.target),a.isPerspective?g.fov=a.fov:(g.saveFov=a.fov,g.fov=L.UnifiedCamera.ORTHO_FOV),g.isPerspective=a.isPerspective,g.orthoScale=a.orthoScale,g.dirty=!0,f.setWorldUpVector(c?d:g.up),f.setView(g.position,g.target),f.setPivotPoint(g.target),this.syncCamera(!0);else if(g.isPerspective=a.isPerspective,a.isPerspective||(g.saveFov=a.fov,a.fov=L.UnifiedCamera.ORTHO_FOV),c)f.setRequestTransitionWithUp(!0,a.position,a.target,a.fov,a.up,d);else{var h=this.model.getData().bbox;if(!h.containsPoint(a.target)){var i=h.center().distanceTo(a.position),j=a.target.clone().sub(a.position).normalize().multiplyScalar(i);a.target.copy(a.position.clone().add(j))}var k=f.computeOrthogonalUp(a.position,a.target);f.setRequestTransitionWithUp(!0,a.position,a.target,a.fov,k,d)}}Fa=!0},this.setViewFromViewBox=function(a,b,c,d){if(a.is2d()){var e={},f=a.getBoundingBox(),g={width:b[2]-b[0],height:b[3]-b[1]};g.aspect=g.width/g.height,g.centerX=b[0]+g.width/2,g.centerY=b[1]+g.height/2;var h=this.camera.aspect;h>g.aspect?e.orthoScale=g.height:e.orthoScale=g.width/h,e.isPerspective=!1,e.position=new K.Vector3(g.centerX,g.centerY,f.center().z+e.orthoScale),e.target=new K.Vector3(g.centerX,g.centerY,f.center().z),e.target.y+=1e-6*g.height,e.up=new K.Vector3(0,0,1),this.setViewFromCamera(e,d,!1)}},this.setWorldUp=function(a){if(!wa.equals(a)){wa.copy(a);var b=Math.abs(a.x);Qa="x",Math.abs(a.y)>b&&(Qa="y",b=Math.abs(a.y)),Math.abs(a.z)>b&&(Qa="z");var c=new K.Vector3(0,1,0);Ja.camera.worldUpTransform=function(a,b){var c=(new K.Vector3).crossVectors(b,a).normalize(),d=Math.acos(a.dot(b));return(new K.Matrix4).makeRotationAxis(c,d)}(c,a),this.sceneUpdated(!1)}},this.addModel=function(a,b){if(a){var c=!!this.model,d=a.is2d();if(this.model||(this.model=a,d||this.toggleVizBuffer(this.isvizCacheEnabled),Da.setUnitScale(a.getUnitScale())),this.layers||(this.layers=new B.ModelLayers(this)),this.layers.initialized||this.layers.addModel(a),Ia.addModel(a),this.selector.addModel(a),this.visibilityManager.addModel(a),this.api.fireEvent({type:N.MODEL_ADDED_EVENT,model:a,preserveTools:b}),this.api.prefs&&(a.hideLines(!this.api.prefs.lineRendering),a.hidePoints(!this.api.prefs.pointRendering)),d){for(var e=a.getData(),f=Ia.getModels(),g=0;g<f.length;++g){var h=f[g];if(h===a){Ba.initLayersTexture(e.layerCount,e.layersMap);break}if(h.is2d())break}var i=Ba.create2DMaterial(null,{useInstancing:this.use2dInstancing},!0,!1,function(){Ja.invalidate(!1,!0,!1)}),j=Ba.findMaterial(null,i);if(this.is2d||Da.enter2DMode(j,c||!a.getData().isLeaflet),!c){this.is2d=!0,this.setLightPreset(o.DefaultLightPreset2d);var k=a.getData();if(k.hidePaper){var l=k.bgColor,m=l>>16&255,n=l>>8&255,p=255&l;this.setClearColors(m,n,p,m,n,p)}}}else!c&&this.is2d&&(this.is2d=void 0,Da.exit2DMode());this.setupLighting(a),qa(),this.fireRenderOptionChanged(),this.invalidate(!0)}},this.setupLighting=function(a){(a=a||this.model)&&!a.is2d()&&(this.setLightPresetFromFile(a)||(Oa>=0?(this.setLightPreset(Oa,!0,Pa),Oa=-1,Pa=null):this.setLightPreset(Na,!1)),this.setAOHeuristics(a))},this.getSvfMaterialId=function(a){return this.model.getFragmentList().getSvfMaterialId(a)},this.getMaterials=function(){return Ba},this.setupMesh=function(a,b,c,d){var e={geometry:b,matrix:d,isLine:b.isLines,isWideLine:b.isWideLines,isPoint:b.isPoints,is2d:b.is2d};return c&&(e.material=this.matman().setupMaterial(a,b,c)),e},this.onDemandLoadComplete=function(a){if(eb=!1,this.signalProgress(100,g.ProgressState.LOADING),(Ga&&Ga.enabled||Ha)&&this.invalidate(!1,!0),this.is2d){var b=Ba.initSelectionTexture(a.getData().maxObjectNumber),c=Ba.create2DMaterial(a,{useInstancing:this.use2dInstancing},!1,b,function(){Ja.invalidate(!1,!0,!1)});this.selectionMaterial2d=Ba.findMaterial(a,c),this.createOverlayScene("selection2d",this.selectionMaterial2d)}Ba.hasTransparentMaterial()&&this.requestDeferredSilentRender(),pa(a),this.api.dispatchEvent({type:N.GEOMETRY_LOADED_EVENT,model:a,onDemandLoad:!0})},this.onLoadComplete=function(a){if(eb=!1,this.signalProgress(100,g.ProgressState.LOADING),(Ga&&Ga.enabled||Ha)&&this.sceneUpdated(!1),this.is2d){var b=Ba.initSelectionTexture(a.getData().maxObjectNumber),c=Ba.create2DMaterial(a,{useInstancing:this.use2dInstancing},!1,b,function(){Ja.invalidate(!1,!0,!1)});this.selectionMaterial2d=Ba.findMaterial(a,c),this.createOverlayScene("selection2d",this.selectionMaterial2d)}a.getData();Ia.getGeometryList()&&Ia.getGeometryList().printStats(),a.hasGeometry()?Ba.hasTransparentMaterial()&&this.requestSilentRender():r.logger.warn("Loaded model has no geometry."),this.handleInitialVisibility(a),pa(a),this.api.dispatchEvent({type:N.GEOMETRY_LOADED_EVENT,model:a})},this.onTextureLoadComplete=function(a){this.api.dispatchEvent({type:N.TEXTURES_LOADED_EVENT,model:a})},this.signalProgress=function(a,b){void 0===b&&(b=g.ProgressState.LOADING),Ya.percent===a&&Ya.state===b||(Ya.percent=a,Ya.state=b,this.api.dispatchEvent(Ya))},this.resize=function(a,b){ya=!0,za=a,Aa=b},this.unloadModel=function(a){(this.removeModel(a)||Ia.removeHiddenModel(a))&&(a.dtor(this.glrenderer()),Ba.cleanup(a),a.loader&&(a.loader.dtor(),a.loader=null),this.api.dispatchEvent({type:N.MODEL_UNLOADED_EVENT,model:a}))},this._addLoadingFile=function(a){this.loaders||(this.loaders=[]),this.loaders.push(a)},this._removeLoadingFile=function(a){if(this.loaders){var b=this.loaders.indexOf(a);b>=0&&this.loaders.splice(b,1)}},this.removeModel=function(a){return!!Ia.removeModel(a)&&(this.keyFrameAnimator&&(this.keyFrameAnimator.destroy(),this.keyFrameAnimator=null),this.selector.removeModel(a),this.visibilityManager.removeModel(a),this.layers.removeModel(a),a===this.model&&(this.model=null,Ia.isEmpty()||(this.model=Ia.getModels()[0])),qa(),this.invalidate(!0,!0,!0),!0)},this.unloadCurrentModel=function(){this.model&&(this.is2d?(this.is2d=void 0,this.selectionMaterial2d=null,this.removeOverlayScene("selection2d"),Da.exit2DMode()):Oa=Na,Da.beginScene(this.scene,this.camera,this.lightsOn?this.lights:this.no_lights,!0),Da.composeFinalFrame(!0)),this.loaders&&(this.loaders.forEach(function(a){a.dtor()}),this.loaders=[]);for(var a=Ia.getModels(),b=a.length-1;b>=0;b--)this.unloadModel(a[b]);this.model=null};var ub=function(a){var b=[{material:Ja.selectionMaterialBase,target:1,renderHidden:!1},{material:Ja.selectionMaterialTop,target:0,renderHidden:!0}];if(a){var c=Da.getEdgeMaterial();b.splice(1,0,{material:c,target:1,renderHidden:!1}),b.push({material:c,target:0,renderHidden:!0})}Da.setSelectionMaterials(b)},vb=function(){var a=Ja.selectionMaterialBase=new K.MeshPhongMaterial({specular:526344,ambient:0,opacity:1,transparent:!1});a.packedNormals=!0,a.depthWrite=!0,a.depthTest=!0,a._polygonOffsetOn=!0,a._polygonOffsetFactor=1,a._polygonOffsetUnits=.075,a.side=K.DoubleSide;var b=Ja.selectionMaterialTop=new K.MeshPhongMaterial({specular:526344,ambient:0,opacity:.15,transparent:!0});b.packedNormals=!0,b.depthWrite=!1,b.depthTest=!1,b.side=K.DoubleSide,Ba.addInstancingSupport(a),Ba.addOverrideMaterial("selectionHighlightBase",a),Ba.addInstancingSupport(b),Ba.addOverrideMaterial("selectionHighlightTop",b),ub(!1)};this.createOverlayScene=function(a,b,c,d){b&&Ba.addOverrideMaterial(a+"_pre",b),c&&Ba.addOverrideMaterial(a+"_post",c);var e=new K.Scene;e.__lights=this.scene.__lights,this.overlayScenes[a]={scene:e,camera:d,materialPre:b,materialPost:c}},this.removeOverlayScene=function(a){this.overlayScenes[a]&&(delete this.overlayScenes[a],this.invalidate(!1,!1,!0))},this.addOverlay=function(a,b){this.overlayScenes[a]&&(this.overlayScenes[a].scene.add(b),this.invalidate(!1,!1,!0))},this.addMultipleOverlays=function(a,b){for(var c in b)b.hasOwnProperty(c)&&this.addOverlay(a,b[c])},this.removeOverlay=function(a,b){this.overlayScenes[a]&&(this.overlayScenes[a].scene.remove(b),this.invalidate(!1,!1,!0))},this.removeMultipleOverlays=function(a,b){for(var c in b)b.hasOwnProperty(c)&&this.removeOverlay(a,b[c])},this.clearOverlay=function(a){if(this.overlayScenes[a]){var b,c,d=this.overlayScenes[a].scene;for(c=d.children.length-1;c>=0;--c)(b=d.children[c])&&d.remove(b);this.invalidate(!1,!1,!0)}},this.setClearColors=function(a,b,c,d,e,g){this.clearColorTop=new K.Vector3(a/255,b/255,c/255),this.clearColorBottom=new K.Vector3(d/255,e/255,g/255),Da.setClearColors(this.clearColorTop,this.clearColorBottom),Ha&&Ha.setClearColors(this.clearColorTop,this.clearColorBottom,(0,f.isMobileDevice)()),Ua=!0,this.fireRenderOptionChanged()};var wb;this.getVisibleBounds=function(a,b){var c=new K.Box3;return Ia.isEmpty()||(ra(c,this.scene),c=Ia.getVisibleBounds(a).union(c),b&&(c=sa().union(c))),c},this.getFitBounds=function(a){var b;return a||null===this.selector||(b=this.selector.getSelectionBounds()),b&&!b.empty()||(b=this.getVisibleBounds()),b},this.getRenderProxy=function(a,b){return a.getFragmentList().getVizmesh(b)},this.getLayersRoot=function(){return this.layers.getRoot()},this.promiseRenderProxy=function(a,b){var c=a.getFragmentList().promiseVizmesh(b);return c.lmv_model=a,c},this.cancelPromisedRenderProxy=function(a){return!!a.lmv_model&&a.lmv_model.getFragmentList().cancelPromisedVizmesh(a)},this.getFragmentProxy=function(a,b){return new D.FragmentPointer(a.getFragmentList(),b)},this.getRenderProxyCount=function(a){return a.getFragmentList().getCount()},this.getRenderProxyDbIds=function(a,b){return a.getFragmentList().getDbIds(b)},this.isWholeModelVisible=function(a){return!Ia||Ia.areAllVisible()},this.isNodeVisible=function(a,b){return this.visibilityManager.isNodeVisible(b,a)},this.highlightObjectNode=function(a,b,c){a.is2d()&&(Ba.highlightObject2D(b,c),this.invalidate(!1,!1,!0));var d=this,e=a.getData().instanceTree||a.getData().fragmentMap;if(e&&!a.is2d())e.enumNodeFragments(b,function(b){d.highlightFragment(a,b,c)},!1);else{var f=b;if(a.is2d()&&(f=a.getData().fragments.dbId2fragId[b]),Array.isArray(f))for(var g=0;g<f.length;g++)d.highlightFragment(a,f[g],c);else d.highlightFragment(a,f,c)}},this.highlightFragment=function(a,b,c){var d=this.getRenderProxy(a,b);if(d){var e=d.is2d||d.isPoint,f=a.id+":"+b;if(e){var g="selection";if(a.is2d()&&(g+="2d"),d.isPoint&&(g+="_points"),c){var h=this.promiseRenderProxy(a,b),i=this;this.selectionMeshes[f]=h,h.then(function(c){var d,e=i.getRenderProxy(c.model,c.fragId);if(e&&e.geometry){if(e.isPoint){var h=e.material.clone();h.color=i.selectionMaterialBase.color,h.needsUpdate=!0,d=new K.Mesh(e.geometry,h)}else d=new K.Mesh(e.geometry,e.material);d.matrix.copy(e.matrixWorld),d.matrixAutoUpdate=!1,d.matrixWorldNeedsUpdate=!0,d.frustumCulled=!1,d.model=a,d.fragId=b,c.model.getFragmentList().lockGeometry(b),i.addOverlay(g,d),i.selectionMeshes[f]=d}}).catch(function(a){a.canceled||delete i.selectionMeshes[f]})}else if(this.selectionMeshes.hasOwnProperty(f)){var j=this.selectionMeshes[f];j instanceof Promise?this.cancelPromisedRenderProxy(j):(a.getFragmentList().unlockGeometry(b),this.removeOverlay(g,j)),delete this.selectionMeshes[f]}}e&&c||a.setHighlighted(b,c)&&this.invalidateHighlight()}},this.explode=function(a){a!=ab&&(ab=a,Ia.explode(a),this.sceneUpdated(!0),this.api.dispatchEvent({type:N.EXPLODE_CHANGE_EVENT,scale:a}))},this.getExplodeScale=function(){return ab},this.setGhostingBrightness=function(a){this.fadeMaterial.color=a?new K.Color(1052688):new K.Color(16777215),this.fadeMaterial.needsUpdate=!0},this.loadCubeMapFromColors=function(a,b){var c=(0,E.CreateCubeMapFromColors)(a,b);return c.isBgColor=!0,Ba.setReflectionMap(c),c},this.loadCubeMap=function(a,b){this._reflectionMapPath=a;var c=function(b){a===Ja._reflectionMapPath&&Ba&&(Ba.setReflectionMap(b),Ja.invalidate(!0),b?o.LightPresets[Na].useIrradianceAsBackground||Da.setCubeMap(b):Ja.loadCubeMapFromColors(Ja.clearColorTop,Ja.clearColorBottom))};return s.TextureLoader.loadCubeMap(a,b,c)},this.loadIrradianceMap=function(a,b){this._irradianceMapPath=a;var c=function(b){a===Ja._irradianceMapPath&&Ba&&(Ba.setIrradianceMap(b),Ja.invalidate(!0),o.LightPresets[Na].useIrradianceAsBackground&&Da.setCubeMap(b))};return s.TextureLoader.loadCubeMap(a,b,c)},this.setLightPreset=function(a,b,c){if((0,f.isNodeJS)()&&(a=0),gb||this.initLights(),Na===a&&!b)return void(c&&c());if((a<0||o.LightPresets.length<=a)&&(a=o.DefaultLightPreset),Na=a,Ia.isEmpty())return Oa=Na,void(Pa=c);var d=o.LightPresets[a],e=d.bgColorGradient;if(e||(e=o.BackgroundPresets.Custom),this.setClearColors(e[0],e[1],e[2],e[3],e[4],e[5]),void 0!==d.useIrradianceAsBackground&&(this.api.prefs.hasTag("envMapBackground","ignore-producer")?r.logger.debug("setLightPreset(): envMapBackground is locked. No changes."):(this.api.prefs.tag("no-storage","envMapBackground"),this.api.setEnvMapBackground(d.useIrradianceAsBackground))),d.path){var g="res/environments/"+d.path,h=(0,F.getResourceUrl)(g+"_mipdrop."+(d.type||"")+".dds"),i=(0,F.getResourceUrl)(g+"_irr."+(d.type||"")+".dds");this.loadIrradianceMap(i,d.E_bias),this.loadCubeMap(h,d.E_bias),Ba.setEnvExposure(-d.E_bias),Da.setEnvExposure(-d.E_bias),this.setTonemapExposureBias(d.E_bias),this.setTonemapMethod(d.tonemap),this.setGhostingBrightness(d.darkerFade)}else{var j=this.loadCubeMapFromColors(this.clearColorTop,this.clearColorBottom);Da.setCubeMap(j),Ba.setIrradianceMap(null),Ba.setEnvExposure(-d.E_bias||0),Da.setEnvExposure(-d.E_bias||0),this.setTonemapExposureBias(d.E_bias||0),this.setTonemapMethod(d.tonemap||0),this.setGhostingBrightness(d.darkerFade),Da.toggleEnvMapBackground(fb),this.invalidate(!0)}var k=G.SAOShader.uniforms.radius.value,l=G.SAOShader.uniforms.intensity.value;d.hasOwnProperty("saoRadius")&&(k=d.saoRadius),d.hasOwnProperty("saoIntensity")&&(l=d.saoIntensity),Da.setAOOptions(k,l);var m=1;null!==d.lightMultiplier&&void 0!==d.lightMultiplier&&(m=d.lightMultiplier),Sa.copy(Ra),d.lightDirection&&Sa.fromArray(d.lightDirection).negate(),Ea&&V(),this.dir_light1&&(this.dir_light1.intensity=m,d.lightDirection?(this.dir_light1.position.set(-d.lightDirection[0],-d.lightDirection[1],-d.lightDirection[2]),this.highlight_dir_light1.position.set(-d.lightDirection[0],-d.lightDirection[1],-d.lightDirection[2])):(this.dir_light1.position.copy(Ta),this.highlight_dir_light1.position.copy(Ta))),Ba.setEnvRotation(d.rotation||0),Da.setEnvRotation(d.rotation||0),Ha&&Ha.setEnvRotation(d.rotation||0),this.toggleLights(0!==m),this.invalidate(!0,!1,!0),this.fireRenderOptionChanged(),c&&c()},this.setLightPresetFromFile=function(a){if(!a||a.is2d())return!1;var b=a.getMetadata("renderEnvironmentGroundReflection","value",null);null!==b&&(this.api.prefs.hasTag("groundReflection","ignore-producer")?r.logger.debug("setLightPresetFromFile(): groundReflection is locked. No changes."):(this.api.prefs.tag("no-storage","groundReflection"),this.api.setGroundReflection(b)));var c=a.getMetadata("renderEnvironmentGroundShadow","value",null);null!==c&&(this.api.prefs.hasTag("groundShadow","ignore-producer")?r.logger.debug("setLightPresetFromFile(): groundShadow is locked. No changes."):(this.api.prefs.tag("no-storage","groundShadow"),this.api.setGroundShadow(c)));var d=a.getMetadata("renderEnvironmentAmbientShadows","value",null);null!==d&&(this.api.prefs.hasTag("ambientShadows","ignore-producer")?r.logger.debug("setLightPresetFromFile(): ambientShadows is locked. No changes."):(this.api.prefs.tag("no-storage","ambientShadows"),this.api.setQualityLevel(d,Da.getAntialiasing())));var e=a.getMetadata("renderEnvironmentDisplayLines","value",null);null!==e&&(this.api.prefs.hasTag("lineRendering","ignore-producer")?r.logger.debug("setLightPresetFromFile(): lineRendering is locked. No changes."):(this.api.prefs.tag("no-storage","lineRendering"),this.api.hideLines(!e)));var g=a.getMetadata("renderEnvironmentDisplayPoints","value",null);null!==g&&(this.api.prefs.hasTag("pointRendering","ignore-producer")?r.logger.debug("setLightPresetFromFile(): pointRendering is locked. No changes."):(this.api.prefs.tag("no-storage","pointRendering"),this.api.hidePoints(!g)));var h=a.getMetadata("renderEnvironmentDisplayEdges","value",null);null!==h&&(this.api.prefs.hasTag("edgeRendering","ignore-producer")?_Logger.logger.debug("setLightPresetFromFile(): edgeRendering is locked. No changes."):(this.api.prefs.tag("no-storage","edgeRendering"),this.api.setDisplayEdges(!(0,f.isMobileDevice)()&&!!h)));var i=a.getMetadata("renderEnvironmentStyle","value",null),j=o.LightPresets.filter(function(a){return a.name===i})[0];if(j)if(this.api.prefs.hasTag("lightPreset","ignore-producer"))r.logger.debug("setLightPresetFromFile(): lightPreset is locked. No changes.");else{this.api.prefs.tag("no-storage","lightPreset");var k=P;k||(k=P={},o.LightPresets.push(k)),(0,o.copyLightPreset)(j,k),k.name="(Custom: Model defined)";var l=a.getMetadata("renderEnvironmentExposureBias","value",null),m=a.getMetadata("renderEnvironmentExposureBase","value",null);null!==l&&null!==m&&(k.E_bias=l+m);var n=a.getMetadata("renderEnvironmentBackgroundColor","value",null);this.api.prefs.hasTag("backgroundColorPreset","ignore-producer")?r.logger.debug("setLightPresetFromFile(): backgroundColorPreset is locked. No changes."):n&&(k.bgColorGradient=[255*n[0],255*n[1],255*n[2],255*n[0],255*n[1],255*n[2]]);var p=a.getMetadata("renderEnvironmentRotation","value",null);null!==p&&(k.rotation=p);var q=o.LightPresets.indexOf(k);this.setLightPreset(q,!0)}var s=a.getMetadata("renderEnvironmentBackgroundFromEnvironment","value",null);return null!==s&&(this.api.prefs.hasTag("envMapBackground","ignore-producer")?r.logger.debug("setLightPresetFromFile(): envMapBackground is locked. No changes."):(this.api.prefs.tag("no-storage","envMapBackground"),this.api.setEnvMapBackground(s))),j},this.setLightPresetForAec=function(){for(var a=(0,f.getGlobal)().DefaultLightPresetAec||"Boardwalk",b=-1,c=0;c<o.LightPresets.length;c++)if(o.LightPresets[c].name===a){b=c;break}return b>=0&&(this.api.prefs.hasTag("lightPreset","ignore-producer")?r.logger.debug("setLightPresetForAec(): lightPreset is locked. No changes."):(this.api.prefs.tag("no-storage","lightPreset"),this.setLightPreset(b,!0,function(){this.api.prefs.tag("ignore-producer","envMapBackground")}.bind(this)),this.saveLightPreset())),this.api.prefs.hasTag("edgeRendering","ignore-producer")?r.logger.debug("setLightPresetForAec(): edgeRendering is locked. No changes."):(this.api.prefs.tag("no-storage","edgeRendering"),this.api.setDisplayEdges(!(0,f.isMobileDevice)())),!0},this.setAOHeuristics=function(a){var b=a.getUnitScale(),c=a.getMetadata("renderEnvironmentAmbientShadows","radius",void 0),d=a.getMetadata("renderEnvironmentAmbientShadows","intensity",void 0),e=a.getMetadata("renderEnvironmentAmbientShadows","opacity",void 0);if(void 0!==c||void 0!==d||void 0!==e)Da.setAOOptions(c/b,d,e);else if(a.isAEC()){var f=b>.3;f?Da.setAOOptions(4/b,1,.625):Da.setAOOptions(.25/b,1,.625)}else{var g=a.getData().bbox,h=g.size().length();Da.setAOOptions(Math.min(10,.05*h))}},this.setTonemapMethod=function(a){a!=Da.getToneMapMethod()&&(Da.setTonemapMethod(a),Ba.setTonemapMethod(a),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setTonemapExposureBias=function(a){a!=Da.getExposureBias()&&(Da.setTonemapExposureBias(a),Ba.setTonemapExposureBias(a),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setRenderingPrefsFor2D=function(a){if(!(0,f.isNodeJS)()){var b=!a&&!!this.api.prefs.envMapBackground;this.toggleEnvMapBackground(b)}},this.dtor=function(){window.cancelAnimationFrame(xa),this.api.removeEventListener(N.MODEL_ROOT_LOADED_EVENT,lb),this.api.removeEventListener(N.MODEL_UNLOADED_EVENT,lb),this.unloadCurrentModel(),this.controls=null,this.canvas=null,this.loader=null,this.selector.dtor(),this.selector=null,this.model=null,this.layers=null,this.visibilityManager=null,kb&&(kb.dtor(),kb=null),Ia=null,Da=null,Ba.dtor(),Ba=null,Ca&&(Ca.webglcontextlost=null)},this.hideLines=function(a){Ia&&!Ia.isEmpty()&&(Ia.hideLines(a),this.sceneUpdated(!0))},this.hidePoints=function(a){Ia&&!Ia.isEmpty()&&(Ia.hidePoints(a),this.sceneUpdated(!0))},this.setDisplayEdges=function(a){Da.toggleEdges(a),ub(a),this.invalidateHighlight(),this.invalidate(!0)},this.setCutPlaneSet=function(a,b){ob[a]=b?b.slice():void 0,ta()},this.setCutPlaneSetFor2DRendering=function(a){pb=a,ta()},this.getCutPlaneSet=function(a){return ob[a]},this.getCutPlaneSets=function(){var a=[];for(var b in ob){var c=ob[b];c&&c.length&&a.push(b)}return a},this.getCutPlanes=function(){return Ba.getCutPlanes()},this.setCutPlanes=function(a){Ba.setCutPlanes(a),this.sceneUpdated(),this.api.dispatchEvent({type:N.CUTPLANES_CHANGE_EVENT,planes:a})},this.fireRenderOptionChanged=function(){Ba.toggleMRTSetting(Da.mrtFlags()),this.api.dispatchEvent({type:N.RENDER_OPTION_CHANGED_EVENT})},this.dispatchEvent=function(a){this.api.dispatchEvent(a)},this.viewportToRay=function(a,b){var c=this.camera;a.z=-1;var d=new K.Vector3(a.x,a.y,1);return a=a.unproject(c),d=d.unproject(c),d.sub(a).normalize(),b||(b=new K.Ray),b.set(c.isPerspective?c.position:a,d),b},this.rayIntersect=function(a,b,c,d,e){var f=Ia.rayIntersect(a.origin,a.direction,b,c,d,e);if(this.sceneAfter.children.length){var g=new K.Raycaster(a.origin,a.direction,this.camera.near,this.camera.far),h=[];H.VBIntersector.intersectObject(this.sceneAfter,g,h,!0),h.length&&(!f||h[0].distance<f.distance)&&(f=h[0])}if(!f)return null;var i=f.fragId,j=f.point,k=f.face,l=f.model,m=f.dbId;if(void 0===m&&void 0!==i){m=l.getFragmentList().getDbIds(i);l.getData().instanceTree||l.getData().fragmentMap||(m=i)}return{dbId:m,fragId:i,intersectPoint:j,face:k,model:l}},this.castRayViewport=function(){var a;return function(b,c,d,e,f){return a=a||new K.Ray,Ia?(this.viewportToRay(b,a),this.rayIntersect(a,c,d,e,f)):{}}}(),this.getCanvasBoundingClientRect=function(){return this.canvasBoundingclientRectDirty&&(this.canvasBoundingclientRectDirty=!1,this.boundingClientRect=this.canvas.getBoundingClientRect()),this.boundingClientRect},this.clientToViewport=function(a,b){var c=this.getCanvasBoundingClientRect();return new K.Vector3((a+.5)/c.width*2-1,-(b+.5)/c.height*2+1,1)},this.viewportToClient=function(a,b){var c=this.getCanvasBoundingClientRect();return new K.Vector3(.5*(a+1)*c.width-.5,-.5*(b-1)*c.height-.5,0)},this.castRay=function(a,b,c){return this.castRayViewport(this.clientToViewport(a,b),c)},this.intersectGroundViewport=function(a){var b=this.camera,c="z";this.is2d||(c=Qa);var d=a;d.z=-1;var e=new K.Vector3(d.x,d.y,1);d=d.unproject(b),e=e.unproject(b),e.sub(d).normalize();var f=e;if(Math.abs(f[c])<1e-6)return null;var g;g=b.isPerspective?b.position:d;var h=this.model?this.model.getBoundingBox().min[c]:0,i=(h-g[c])/f[c];return f.multiplyScalar(i),f.add(g),f},this.intersectGround=function(a,b){return this.intersectGroundViewport(this.clientToViewport(a,b))};var xb=[0,0];this.hitTestViewport=function(a,b){var c;if(Ja.is2d){var d=(0,f.isMobileDevice)()?45:5,e=Da.idAtPixels(a.x,a.y,d,xb);if(e<=0)return null;var g=this.intersectGroundViewport(a),h=Ia.findModel(xb[1])||Ja.model;c={intersectPoint:g,dbId:h.remapDbId(e),fragId:h.getData().fragments.dbId2fragId[e],model:h}}else c=this.castRayViewport(a,b);return c},this.hitTest=function(a,b,c){return Ja.hitTestViewport(this.clientToViewport(a,b),c)},this.snappingHitTestViewport=function(a,b){var c,d,e;if(this.model&&this.model.getData().isLeaflet)d=this.intersectGroundViewport(a),c={intersectPoint:d};else if(Ja.is2d){var g=(0,f.isMobileDevice)()?45:17,h=Da.idAtPixels(a.x,a.y,g,xb),i=Ia.findModel(xb[1])||Ja.model;if(h<0)return null;d=this.intersectGroundViewport(a);var j=Ja.model.getData().fragments,k=j?j.dbId2fragId[h]:-1;c={intersectPoint:d,dbId:i.remapDbId(h),fragId:k}}else e=Da.idAtPixel(a.x,a.y),c=this.castRayViewport(a,b,e>0?[e]:null);return c},this.snappingHitTest=function(a,b,c){return this.snappingHitTestViewport(this.clientToViewport(a,b),c)},this.rolloverObjectViewport=function(a){
this.model&&this.model.getData().isLeaflet||Da.rolloverObjectViewport(a.x,a.y)&&this.invalidate(!1,!1,!0)},this.rolloverObject=function(a,b){this.selector.highlightPaused||this.selector.highlightDisabled||this.rolloverObjectViewport(this.clientToViewport(a,b))},this.pauseHighlight=function(a){this.selector.highlightPaused=a,a&&(Da.rolloverObjectId(-1),this.invalidate(!1,!1,!0))},this.disableHighlight=function(a){this.selector.highlightDisabled=a,a&&(Da.rolloverObjectId(-1),this.invalidate(!1,!1,!0))},this.disableSelection=function(a){this.selector.selectionDisabled=a},this.rolloverObjectNode=function(a,b){var c=[];b=b||Ja.model;var d=b?b.getData().instanceTree:void 0;if(d){if(d.enumNodeChildren(a,function(a){c.push(a)},!0),c.length>1){var e=c.shift();c.sort(function(a,b){return a-b}),c.unshift(e)}}else c.push(a);var f=b?b.id:0;Da.rolloverObjectId(a,c,f)&&this.invalidate(!1,!1,!0)},this.getScreenShot=function(a,b,c,d){function e(){function a(){Ja.progressiveRender=h,Ja.resize(f,g),J(!0),b.canvas.toBlob(function(a){var b=window.URL.createObjectURL(a);c?c(b):window.open(b)},"image/png")}var b=Da.targetToCanvas(Da.getColorTarget());d?d(b.ctx,a):a()}var f=Da.settings.logicalWidth,g=Da.settings.logicalHeight,h=this.progressiveRender,i=Ca.getPixelRatio();if(a&&b||(a=f,b=g),this.progressiveRender=!1,this.resize(a/i,b/i),J(!0),na(performance.now()),this.model.getData().isLeaflet){var j=function(){k=!0,Ja.progressiveRender=h,Ja.resize(f,g)},k=!1;Ja.api.addEventListener(N.CANCEL_LEAFLET_SCREENSHOT,j,{once:!0}),this.invalidate(!0),this.model.getIterator().callWhenRefined(function(){k||(Ja.api.removeEventListener(N.CANCEL_LEAFLET_SCREENSHOT,j),e())})}else e()},this.getScreenShotProgressive=function(a,b,c,d){function e(){var a=m.getColorTarget();(n.aoEnabled||n.antialias)&&(n.aoEnabled&&m.computeSSAO(),a=m.getNamedTarget("overlay"),m.getBlendPass().uniforms.tOverlay.value=null,m.setOffscreenTarget(a),m.presentBuffer()),m.targetToCanvas(a).canvas.toBlob(function(a){var b=window.URL.createObjectURL(a);c&&c(b)})}function f(){var c=performance.now();for(Ca.pushViewport(),Ca.setViewport(0,0,a,b),d.beforeRender&&d.beforeRender();p<g.length;){var h=g[p];h instanceof v.RenderBatch&&h.applyVisibility(u.RenderFlags.RENDER_NORMAL,k),m.renderScenePart(h,!0,!0,!1,!1),p++;if(performance.now()-c>o)break}if(Ca.popViewport(),d.afterRender&&d.afterRender(),p===g.length?e():q=nb.setTimeout(f,0),d.onProgress){var i=Math.floor(100*p/g.length);i!==s&&(s=i,d.onProgress(i))}}d=d||{};var g=Ia.getGeomScenes(),h=d.camera||this.camera;h===this.camera&&(h=h.clone());var k=new i.FrustumIntersector,l=Ba.getCutPlanes();k.reset(h,l),k.areaCullThreshold=F.PIXEL_CULLING_THRESHOLD,Ca.pushViewport();var m=new j.RenderContext;m.init(Ca,a,b,!0),Ba.addOverrideMaterial("normalsMaterial_screenshot",m.getDepthMaterial()),Ba.addOverrideMaterial("edgeMaterial_screenshot",m.getEdgeMaterial());var n=d.renderConfig||Da.getConfig();m.applyConfig(n),m.beginScene(Ja.scene,h,Ja.noLights,!0),Ca.popViewport();var o=20,p=0,q=void 0,r={stop:function(){return q&&nb.clearTimeout(q)},finished:function(){return!!q}},s=-1;return f(),r},this.cancelLeafletScreenshot=function(){Ja.api.dispatchEvent({type:N.CANCEL_LEAFLET_SCREENSHOT})},this.modelQueue=function(){return Ia},this.glrenderer=function(){return Ca},this.renderer=function(){return Da},this.geomCache=function(){return kb||(kb=new q.OtgGeomCache(Ja.api)),kb},this.shadowMaps=function(){return Ea},this.worldUp=function(){return wa},this.worldUpName=function(){return Qa},this.setUserRenderContext=function(a,b){Da=a||new j.RenderContext,b||(Da.init(Ca,this.canvas.clientWidth,this.canvas.clientHeight),Da.setClearColors(this.clearColorTop,this.clearColorBottom)),this.invalidate(!0),this.sceneUpdated(!1)},this.setUserGroundShadow=function(a){var b=Ga;return Ga=a,b},this.invalidate=function(a,b,c){Ua=a||Ua,Va=b||Va,Wa=c||Wa},this.invalidateHighlight=function(){Xa=!0,this.invalidate(!1,!1,!0)},this.isOverlayDirty=function(){return Wa},this.clearOverlayDirtyFlag=function(){Wa=!1},this.sceneUpdated=function(a){this.invalidate(!0,!1,!0),Ia&&a&&(Ia.invalidateVisibleBounds(),this.zoomBoundsChanged=!0),Za=!0,V()},this.requestSilentRender=function(){$a=_a=!0},this.requestDeferredSilentRender=function(){$a=!0},this.currentLightPreset=function(){return Na},this.saveLightPreset=function(){Oa=Na},this.matman=function(){return Ba},this.fps=function(){return 1e3/cb},this.setFPSTargets=function(a,b,c){Ka=1e3/c,Ma=1e3/a,La=1e3/b,this.targetFrameBudget=(0,f.isMobileDevice)()?La/4:La},this.track=function(a){r.logger.track(a)},this.worldToClient=function(a){var b=new K.Vector4(a.x,a.y,a.z,1);return b.applyMatrix4(this.camera.matrixWorldInverse),b.applyMatrix4(this.camera.projectionMatrix),b.w>0&&(b.x/=b.w,b.y/=b.w,b.z/=b.w),this.viewportToClient(b.x,b.y)},this.clientToWorld=function(a,b,c){var d=null,e=this.model,f=e.getData();if(e.is2d()){var g=this.intersectGround(a,b);if(g){g.z=0;var h=f.bbox;(f.hidePaper||h.containsPoint(g))&&(d={point:g,model:e})}}else(d=this.hitTest(a,b,c))&&(d.point=d.intersectPoint);return d},this.setSelectionColor=function(a,b){var c=new K.Color(a);c.multiplyScalar(.5),this.selectionMaterialBase.color.set(a),this.selectionMaterialTop.color.set(a),this.selectionMaterialBase.emissive.set(c),this.selectionMaterialTop.emissive.set(c),Da.setSelectionColor(a),this.invalidateHighlight(),this.invalidate(!1,!1,!0)},this.updateViewportId=function(a){Ba.updateViewportId(a),this.invalidate(!0)},this.findModel=function(a){return Ia.findModel(a)},this.getFrameRate=function(){return this.frameDisplayRate},this.setFrameRate=function(a){this.frameDisplayRate=a<1?1:a},this.setShadowLightDirection=function(a){Sa.copy(a),V(),this.invalidate(!0,!1,!1),M()},this.getShadowLightDirection=function(a){var b=a||new K.Vector3;return b.copy(Sa),b},this.toggleShadows=function(a){!!Ea!=!!a&&(a?Ea=new x.ShadowMaps(Ca):(Ea.cleanup(Ba),Ea=null),M(),this.invalidate(!0,!0,!1))},this.showTransparencyWhenMoving=function(a){Ia.enableNonResumableFrames=a},this.fitToView=function(a,b){if(b=!!b,0===a.length){a=Ia.getModels().map(function(a){return{model:a,selection:[]}})}for(var c=0,d=0,e=0;e<a.length;++e){var f=a[e].model;if(!f)return!1;f.is2d()?c++:d++}var g=!1;if(d===a.length)g=this._fitToView3d(a,b);else{if(c!==a.length)return r.logger.warn("Hybrid 2d/3d fitToView() not supported."),!1;g=this._fitToView2d(a,b)}return!!g&&(1===Ia.getModels().length&&this.api.dispatchEvent({type:N.FIT_TO_VIEW_EVENT,nodeIdArray:a[0].selection,immediate:b,model:a[0].model}),this.api.dispatchEvent({type:N.AGGREGATE_FIT_TO_VIEW_EVENT,selection:a,immediate:b}),!0)},this._fitToView2d=function(a,b){a.length>1&&r.logger.warn("fitToView() doesn't support multiple 2D models. Using the first one...");var c=a[0].model,d=a[0].selection,e=new K.Box3,f=new I.BoundsCallback(e);if(d&&0!==d.length)for(var g=c.getData().fragments.dbId2fragId,h=0;h<d.length;h++){var i=c.reverseMapDbId(d[h]),j=g[i];if(Array.isArray(j))for(var k=0;k<j.length;k++)va(c,j[k],i,this.use2dInstancing,f);else"number"==typeof j&&va(c,j,i,this.use2dInstancing,f)}else if(this.api.anyLayerHidden()){var l=c.getData().fragments,m=this.getVisibleLayerIndices();for(h=0;h<l.length;h++)ua(c,h,m,this.use2dInstancing,f)}else e=this.getFitBounds(!0);return!e.empty()&&(this.api.navigation.fitBounds(b,e),!0)},this._fitToView3d=function(a,b){for(var c=!1,d=0;d<a.length;++d)if(a[d].selection.length>0){c=!0;break}var e=new K.Box3,f=new K.Box3;if(c)for(var g=0;g<a.length;++g){var h=a[g].selection;if(0!==h.length){var i=a[g].model,j=i.getFragmentMap(),k=i.getFragmentList();if(j)for(var l=0;l<h.length;++l){var m=parseInt(h[l]);j.enumNodeFragments(m,function(a){k.getWorldBounds(a,f),e.union(f)},!0)}}}else e.union(this.getVisibleBounds(!1,!1));return!e.empty()&&(this.api.navigation.fitBounds(b,e),!0)},this.renderFadingImage=function(a,b){var c=Da.getCrossFade();if(!c)return void r.logger.error("cross fade must be enabled");c.beginRenderToFadeTarget(a,Da),this.invalidate(!0,!0,!0);var d=this.targetFrameBudget;b&&(this.targetFrameBudget=b),na(performance.now()),this.targetFrameBudget=d,c.endRenderFadeTarget(Da)},this.onWebGLcontextLost=function(a){this.api.fireEvent({type:N.WEBGL_CONTEXT_LOST_EVENT})},this.releaseFadingImage=function(a){var b=Da.getCrossFade();b&&b.setClearEnabled(a,!0)},this.modelVisible=function(a){return!!Ia.findModel(a)},this.handleInitialVisibility=function(a){function b(b){var d=a.getFragmentList();if(!d.areAllVisible()){var e=a.getFragmentMap(),f=[];b.enumNodeChildren(a.getRootId(),function(a){e.enumNodeFragments(a,function(a){return d.isFragVisible(a)},!0)||f.push(a)},!0),f.length&&c.hide(f,a)}}var c=this.api;a.getObjectTree(b)}}Object.defineProperty(b,"__esModule",{value:!0}),b.InitParametersSetting=void 0,b.Viewer3DImpl=e;var f=c(4),g=c(210),h=c(183),i=c(120),j=c(148),k=c(111),l=c(178),m=c(226),n=c(227),o=c(197),p=c(50),q=c(228),r=c(8),s=c(139),t=c(179),u=c(121),v=c(116),w=c(104),x=d(w),y=c(49),z=c(138),A=c(38),B=c(205),C=c(229),D=c(114),E=c(95),F=c(6),G=c(97),H=c(117),I=c(181),J=c(2),K=d(J),L=c(231),M=c(198),N=d(M),O=c(215),P=(Autodesk.Viewing.Private.DefaultLightPresetAec,null),Q=(0,f.getGlobal)().ENABLE_DEBUG,R=(0,f.getGlobal)().ENABLE_DEBUG_RCS,S=b.InitParametersSetting={canvas:null,antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!1,depth:!1,devicePixelRatio:null};e.prototype.constructor=e},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b){function c(){return b.getData().instanceTree}function d(){return b.getData().instanceTree||b.getData().fragmentMap}function e(d){var f=c();if(p[d]>0)0==--p[d]&&a.highlightObjectNode(b,d,!1);else if(p[d]<0)throw"Selection State machine broken. Negatively selected object!";f&&f.enumNodeChildren(d,function(a){e(a)},!1)}function f(d){var e=c();p[d]?p[d]++:(a.highlightObjectNode(b,d,!0),p[d]=1),e&&e.enumNodeChildren(d,function(a){f(a)},!1)}function j(a){if(void 0!==a&&o.selectedObjectIds[a])return!0}function k(a){var b=c();if(!b||(a=b.findNodeForSelection(a,o.selectionMode),b.isNodeSelectable(a))){j(a)||(o.selectedObjectIds[a]=a,o.selectionCount++,f(a))}}function l(a){j(a)&&(e(a),o.selectedObjectIds[a]=0,o.selectionCount--)}function n(a){if(o.selectionCount!==a.length)return!1;for(var b=0;b<a.length;b++)if(!j(a[b]))return!1;return!0}var o=this;this.selectedObjectIds={},this.selectionCount=0,this.selectionMode=g.SelectionMode.LEAF_OBJECT;var p={};this.getInstanceTree=c,this.getFragmentMap=d,this.getSelectionLength=function(){return o.selectionCount},this.getSelection=function(){var a=[],b=o.selectedObjectIds;for(var c in b)if(b[c]){var d=parseInt(c);a.push(d)}return a},this.isSelected=function(a){return j(a)},this.clearSelection=function(a){if(this.selectionCount>0){var b=o.selectedObjectIds;for(var c in b){var d=parseInt(c);void 0!==d&&e(d)}o.selectedObjectIds={},o.selectionCount=0}},this.deselectInvisible=function(){var c=!1,d=o.selectedObjectIds,e=a.visibilityManager;for(var f in d){var g=parseInt(f);g&&!e.isNodeVisible(b,g)&&(l(g),c=!0)}return c},this.toggleSelection=function(a){if(!a)return void i.logger.error("Attempting to select node 0.",(0,h.errorCodeString)(h.ErrorCodes.VIEWER_INTERNAL_ERROR));j(a)?l(a):k(a)},this.setSelectionMode=function(a){this.clearSelection(!0),this.selectionMode=a},this.setSelection=function(a){if(!n(a)&&(this.clearSelection(!0),null!=a&&0!==a.length))for(var b=0;b<a.length;b++)k(a[b])},this.getSelectionBounds=function(){var a=new m.Box3,c=new m.Box3,e=d();if(e){var f=b.getFragmentList(),g=o.selectedObjectIds;for(var h in g){var i=parseInt(h);e.enumNodeFragments(i,function(b){f.getWorldBounds(b,c),a.union(c)},!0)}}return a},this.getSelectionVisibility=function(){var a=!1,c=!1,e=o.selectedObjectIds;for(var f in e){var g=parseInt(f);if(g){var h=d();if(h&&h.isNodeHidden(g)?c=!0:a=!0,a&&c)break}}return{hasVisible:a,hasHidden:c,model:b}},this.dtor=function(){this.selectedObjectIds=null}}function f(a){function b(){f.length>1&&i.logger.warn("This selection call does not yet support multiple models.")}function c(){for(var b=[],c=0;c<f.length;c++){var d=[],e=[],g=f[c].selector.selectedObjectIds,h=f[c].selector.getFragmentMap();for(var i in g)if(g[i]){var j=parseInt(i);j&&(d.push(j),h&&h.enumNodeFragments(j,function(a){e.push(a)},!1))}d.length&&b.push({fragIdsArray:e,dbIdArray:d,nodeArray:d,model:f[c]})}var l;1===f.length&&(l={type:k.SELECTION_CHANGED_EVENT,fragIdsArray:b[0]?b[0].fragIdsArray:[],dbIdArray:b[0]?b[0].dbIdArray:[],nodeArray:b[0]?b[0].dbIdArray:[],model:f[0]},a.api.dispatchEvent(l)),l={type:k.AGGREGATE_SELECTION_CHANGED_EVENT,selections:b},a.api.dispatchEvent(l)}function d(){for(var a=!1,b=0;b<f.length;b++)a=f[b].selector.deselectInvisible()||a;a&&c()}var f=[];this.highlightDisabled=!1,this.highlightPaused=!1,this.selectionDisabled=!1,this.addModel=function(b){-1==f.indexOf(b)&&(b.selector=new e(a,b),f.push(b))},this.removeModel=function(a){var b=f.indexOf(a);a.selector.getSelection();a.selector.clearSelection(),a.selector=null,f.splice(b,1)},this.getSelectionLength=function(){for(var a=0,b=0;b<f.length;b++)a+=f[b].selector.getSelectionLength();return a},this.getSelection=function(){return b(),f.length>1&&i.logger.warn("Use getAggregateSelection instead of getSelection when there are multiple models in the scene."),f[0].selector.getSelection()},this.getAggregateSelection=function(){for(var a=[],b=0;b<f.length;b++){var c=f[b].selector.getSelection();c&&c.length&&a.push({model:f[b],selection:c})}return a},this.clearSelection=function(a){for(var b=0;b<f.length;b++)f[b].selector.clearSelection(a);a||c()},this.toggleSelection=function(a,d){d||(b(),d=f[0]),d.selector.toggleSelection(a),c()},this.setSelectionMode=function(a){for(var b=0;b<f.length;b++)f[b].selector.setSelectionMode(a)},this.setSelection=function(a,d){if(!this.selectionDisabled){if(a&&0!==a.length){if(d)for(var e=0;e<f.length;e++)f[e]!==d&&f[e].selector.clearSelection();else b(),d=f[0];d.selector.setSelection(a)}else this.clearSelection(!0);c()}},this.setAggregateSelection=function(a){if(!this.selectionDisabled){if(a&&0!==a.length)for(var b=0;b<a.length;++b){var d=a[b].model,e=a[b].ids;d.selector.setSelection(e)}else this.clearSelection(!0);c()}},this.getSelectionBounds=function(){if(1==f.length)return f[0].selector.getSelectionBounds();for(var a=new m.Box3,b=0;b<f.length;b++){var c=f[b].selector.getSelectionBounds();a.union(c)}return a},this.getSelectionVisibility=function(){for(var a={hasVisible:!1,hasHidden:!1,details:[]},b=0;b<f.length;b++){var c=f[b].selector.getSelectionVisibility();a.hasVisible=a.hasVisible||c.hasVisible,a.hasHidden=a.hasHidden||c.hasHidden,a.details.push(c)}return a},this.dtor=function(){for(var a=0;a<f.length;a++)f[a].selector.dtor()},a.api.addEventListener(k.ISOLATE_EVENT,function(a){d()}),a.api.addEventListener(k.HIDE_EVENT,function(a){d()})}Object.defineProperty(b,"__esModule",{value:!0}),b.Selector=e,b.MultiModelSelector=f;var g=c(187),h=c(13),i=c(8),j=c(198),k=d(j),l=c(2),m=d(l)},function(a,b,c){"use strict";function d(a,b){this.viewerImpl=a,this.model=b,this.isolatedNodes=[],this.hiddenNodes=[]}function e(a){this.viewerImpl=a,this.models=[]}function f(a){var b=a.getAggregateIsolatedNodes();if(1===a.models.length){var c={type:j.ISOLATE_EVENT,nodeIdArray:b.length?b[0].ids:[],model:a.models[0]};a.viewerImpl.api.dispatchEvent(c)}var c={type:j.AGGREGATE_ISOLATION_CHANGED_EVENT,isolation:b};a.viewerImpl.api.dispatchEvent(c)}Object.defineProperty(b,"__esModule",{value:!0});var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};b.VisibilityManager=d,b.MultiModelVisibilityManager=e;var h=c(8),i=c(198),j=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(i);d.prototype.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null},d.prototype.getFragmentMap=function(){return this.model?this.model.getData().instanceTree||this.model.getData().fragmentMap:null},d.prototype.getIsolatedNodes=function(){return this.isolatedNodes.slice(0)},d.prototype.getHiddenNodes=function(){return this.hiddenNodes.slice(0)},d.prototype.setAllVisibility=function(a){var b=this.model?this.model.getRootId():null;b&&this.setVisibilityOnNode(b,a),this.model.getData().is2d&&this.model.setAllVisibility(a)},d.prototype.isNodeVisible=function(a){var b=this.getInstanceTree();return b?!b.isNodeHidden(a):-1==this.hiddenNodes.indexOf(a)&&(0==this.isolatedNodes.length||-1!=this.isolatedNodes.indexOf(a))},d.prototype.isolate=function(a){var b=this.getInstanceTree(),c=b?b.getRootId():null,d="number"==typeof a&&a===c||"object"==(void 0===a?"undefined":g(a))&&a.dbId===c;a&&!d?this.isolateMultiple(Array.isArray(a)?a:[a]):this.isolateNone()},d.prototype.isolateNone=function(){this.model.setAllVisibility(!0),this.viewerImpl.sceneUpdated(!0),this.setAllVisibility(!0),this.hiddenNodes=[],this.isolatedNodes=[],this.viewerImpl.invalidate(!0)},d.prototype.isolateMultiple=function(a){if(a&&0!=a.length){this.setAllVisibility(!1),this.model.getData().is2d||(this.model.setAllVisibility(!1),this.viewerImpl.sceneUpdated(!0)),this.isolatedNodes=a.slice(0),this.hiddenNodes=[];for(var b=0;b<a.length;b++)this.setVisibilityOnNode(a[b],!0)}else this.isolateNone();this.viewerImpl.invalidate(!0)},d.prototype.hide=function(a){var b;if(Array.isArray(a)){for(var c=0;c<a.length;++c)this.setVisibilityOnNode(a[c],!1);a.length>0&&(b={type:j.HIDE_EVENT,nodeIdArray:a,model:this.model})}else this.setVisibilityOnNode(a,!1),b={type:j.HIDE_EVENT,nodeIdArray:[a],model:this.model};b&&this.viewerImpl.api.dispatchEvent(b)},d.prototype.show=function(a){var b;if(Array.isArray(a)){for(var c=0;c<a.length;++c)this.setVisibilityOnNode(a[c],!0);a.length>0&&(b={type:j.SHOW_EVENT,nodeIdArray:a,model:this.model})}else this.setVisibilityOnNode(a,!0),b={type:j.SHOW_EVENT,nodeIdArray:[a],model:this.model};b&&this.viewerImpl.api.dispatchEvent(b)},d.prototype.toggleVisibility=function(a){var b=this.getFragmentMap().isNodeHidden(a);this.setVisibilityOnNode(a,b);var c={type:b?j.SHOW_EVENT:j.HIDE_EVENT,nodeIdArray:[a],model:this.model};this.viewerImpl.api.dispatchEvent(c)},d.prototype.setVisibilityOnNode=function(a,b){var c=this.viewerImpl,d=this.model,e=this.getFragmentMap(),f=!b,g=d.getData().is2d;this.viewerImpl.matman();e?e.enumNodeChildren(a,function(a){if(e.setNodeHidden(a,f),g){var c=d.reverseMapDbId(a);d.getFragmentList().setObject2DGhosted(c,!b)}else e.enumNodeFragments(a,function(a){d.setVisibility(a,b)},!1)},!0):g?d.getFragmentList().setObject2DGhosted(a,!b):d.setVisibility(a,b),c.sceneUpdated(!0),this.updateNodeVisibilityTracking(a,b)},d.prototype.updateNodeVisibilityTracking=function(a,b){var c=b;if(this.isolatedNodes.length>0){var d=this.isolatedNodes.indexOf(a);c&&-1===d?this.isolatedNodes.push(a):c||-1===d||(this.isolatedNodes.splice(d,1),0===this.isolatedNodes.length&&(this.hiddenNodes=[this.model.getRootId()]))}else{var e=this.hiddenNodes.indexOf(a);c||-1!==e?c&&-1!==e&&this.hiddenNodes.splice(e,1):this.hiddenNodes.push(a)}var f=this.getInstanceTree();f&&f.root&&f.root.dbId===a&&(b?(this.isolatedNodes=[],this.hiddenNodes=[]):(this.isolatedNodes=[],this.hiddenNodes=[a]))},d.prototype.setNodeOff=function(a,b){var c=this.viewerImpl,d=this.model,e=this.getFragmentMap(),f=d.getData().is2d;e?e.enumNodeChildren(a,function(a){if(e.setNodeOff(a,b),f){var c=d.reverseMapDbId(a);d.getFragmentList().setObject2DVisible(c,!b)}else e.enumNodeFragments(a,function(a){d.getFragmentList().setFragOff(a,b)},!1)},!0):f?d.getFragmentList().setObject2DVisible(a,!b):d.getFragmentList().setFragOff(a,b),c.sceneUpdated(!0)},e.prototype.addModel=function(a){-1==this.models.indexOf(a)&&(a.visibilityManager=new d(this.viewerImpl,a),this.models.push(a))},e.prototype.removeModel=function(a){var b=this.models.indexOf(a);a.visibilityManager.isolateNone(),a.visibilityManager=null,this.models.splice(b,1)},e.prototype.warn=function(){this.models.length>1&&h.logger.warn("This selection call does not yet support multiple models.")},e.prototype.getAggregateIsolatedNodes=function(){for(var a=[],b=this.models,c=0;c<b.length;c++){var d=b[c].visibilityManager.getIsolatedNodes();d&&d.length&&a.push({model:b[c],ids:d})}return a},e.prototype.getIsolatedNodes=function(a){return a||(this.warn(),a=this.models[0]),a.visibilityManager.getIsolatedNodes()},e.prototype.getAggregateHiddenNodes=function(){for(var a=[],b=this.models,c=0;c<b.length;c++){var d=b[c].visibilityManager.getHiddenNodes();d&&d.length&&a.push({model:b[c],ids:d})}return a},e.prototype.getHiddenNodes=function(a){return a||(this.warn(),a=this.models[0]),a.visibilityManager.getHiddenNodes()},e.prototype.isNodeVisible=function(a,b){return a||(this.warn(),a=this.models[0]),a.visibilityManager.isNodeVisible(b)},e.prototype.isolate=function(a,b){b||(this.warn(),b=this.models[0]),b.visibilityManager.isolate(a),f(this)},e.prototype.aggregateIsolate=function(a){if(a&&0!==a.length){for(var b=this.models.concat(),c=0;c<a.length;++c){var d=a[c].model,e=a[c].ids||a[c].selection,g=b.indexOf(d);b.splice(g,1),d.visibilityManager.isolate(e)}for(;b.length;)b.pop().visibilityManager.setAllVisibility(!1)}else for(var c=0;c<this.models.length;++c)this.models[c].visibilityManager.isolateNone();f(this)},e.prototype.hide=function(a,b){b||(this.warn(),b=this.models[0]),b.visibilityManager.hide(a)},e.prototype.show=function(a,b){b||(this.warn(),b=this.models[0]),b.visibilityManager.show(a)},e.prototype.toggleVisibility=function(a,b){b||(this.warn(),b=this.models[0]),b.visibilityManager.toggleVisibility(a)},e.prototype.setVisibilityOnNode=function(a,b,c){c||(this.warn(),c=this.models[0]),c.visibilityManager.setVisibilityOnNode(a,b)},e.prototype.setNodeOff=function(a,b,c){c||(this.warn(),c=this.models[0]),c.visibilityManager.setNodeOff(a,b)}},function(a,b,c){"use strict";function d(a){var b=a.max.x-a.min.x,c=a.max.y-a.min.y,d=a.max.z-a.min.z;return 2*(b*c+c*d+d*b)}function e(a){var b=(0,n.initLoadContext)(a);return b.disableIndexedDb=w,b.disableWebSocket=x,b}function f(a,b){return a.importance-b.importance}function g(a,b){return b.importance-a.importance}function h(a,b,c){var d=6*b;return c.min.y=a[d+1],c.min.z=a[d+2],c.min.x=a[d+0],c.max.x=a[d+3],c.max.y=a[d+4],c.max.z=a[d+5],c}function i(a){function b(){M=!1}function c(a){if(a.data){if(a.data.error){var b=a.data.error,c=b.args?b.args.hash:void 0;c&&(w[c]=b,J.fireEvent({type:v,error:b}),console.warn("Error loading mesh",c)),delete x[b.hash],C--}else for(var d=a.data,e=0;e<d.length;e++){var f=d[e];if(f.hash&&f.mesh){l.BufferGeometryUtils.meshToGeometry(f);var c=f.hash,g=f.geometry;w[c]=g,J.byteSize+=g.byteSize,J.cleanup(),J.fireEvent({type:u,geom:g}),delete x[f.hash]}C--}F.length&&!E&&(E=setTimeout(i,0))}}function h(a){if(!t||!t.length||!a)return 0|Math.random()*y;var b,c=0,d=t.length-1;do{var e=0|(c+d)/2;if(b=t[e],b.geomStart>a)d=e-1;else{if(!(b.geomEnd<=a))break;c=e+1}}while(c<=d);return b.geomStart<=a&&b.geomEnd>a?b.workerId:(console.error("Range not found",a),-1)}function i(){var a=D*y-C;if(0===a)return void(E=setTimeout(i,30));J.updateRequestPriorities()||(a=Math.min(a,10*y));for(var b=[],c=0,d=0;d<F.length&&c<a;){var f=F[d++],g=h(f.geomIdx),j=b[g];j?(j.urls.push(f.url),j.hashes.push(f.hash),j.geomIds.push(f.geomIdx),j.sampleWorldMatrices.push(f.sampleWorldMatrix)):(j={operation:"LOAD_GEOMETRY_OTG",urls:[f.url],isCDN:f.isCDN,hashes:[f.hash],geomIds:[f.geomIdx],sampleWorldMatrices:[f.sampleWorldMatrix],queryParams:f.queryParams},b[g]=j),c++}F.splice(0,d);for(var k=0;k<b.length;k++){var j=b[k];j&&(A[k].doOperation(e(j)),C+=j.urls.length)}E=void 0}function j(a,b,c){return Math.abs(a.x-b.x)<c&&Math.abs(a.y-b.y)<c&&Math.abs(a.z-b.z)<c}function n(a,b){return(!j(N,a,.01)||!j(O,b,.01))&&(N.copy(a),O.copy(b),!0)}function o(){var a=L.impl.modelQueue(),b=a.getModels(),c=!1;b.length!=P.length&&(P.length=b.length,c=!0);for(var d=0;d<b.length;d++){var e=P[d],f=b[d].id;e!==f&&(P[d]=f,c=!0)}return c}function p(){var a=L.impl.camera,b=a.position,c=a.target,d=n(b,c),e=o();if(d||e)for(var f=0;f<F.length;f++)F[f].importanceNeedsUpdate=!0}for(var t,w={},x={},y=(0,k.isMobileDevice)()?2:8,A=[],B=0;B<y;B++)A.push((0,m.createWorkerWithIntercept)());this.byteSize=0;var C=0,D=100,E=void 0,F=[],G={},H=0,I=!1,J=this,K=0,L=a,M=!1,N=new r.LmvVector3,O=new r.LmvVector3,P=[];L.addEventListener(q.MODEL_UNLOADED_EVENT,b),this.dtor=function(){L.removeEventListener(q.MODEL_UNLOADED_EVENT,b),L=null};for(var B=0;B<y;B++)A[B].addEventListenerWithIntercept(c);this.initWorker=function(a){for(var b=0;b<y;b++){var c={operation:"INIT_WORKER_OTG",workerId:b,authorizeUrns:[a]};A[b].doOperation(e(c))}},this.updateMruTimestamps=function(){for(var a=0;a<y;a++){var b={operation:"UPDATE_MRU_TIMESTAMPS_OTG",workerId:a};A[a].doOperation(e(b))}},this.requestGeometry=function(a,b,c,d,e,f){var g=w[c];if(g&&g.args)return void this.fireEvent({type:v,error:g,repeated:!0});if(g)return void this.fireEvent({type:u,geom:g});var h=x[c];if(h&&h.refcount)return h.importanceNeedsUpdate=!0,void h.refcount++;var j=null;f&&(j=Array.from(f.elements));var k={operation:"LOAD_GEOMETRY_OTG",url:a,isCDN:b,hash:c,geomIdx:d,queryParams:e,importance:0,sampleWorldMatrix:j,importanceNeedsUpdate:!0,refcount:1};F.push(k),x[c]=k,E||(E=setTimeout(i,0))},this.cancelRequests=function(a){for(var b in a){var c=x[b];c&&c.refcount--}for(var d=[],e=0;e<F.length;e++){var f=F[e];x[f.hash].refcount?d.push(f):delete x[f.hash]}F=d},this.updateGeomImportance=function(){var a=new s.LmvBox3;return function(b,c){var e=b.getFragmentList(),f=e.getGeometry(c);if(e.getWorldBounds(c,a),f){var g=f.importance||0,h=d(a);f.importance=Math.max(g,h)}}}(),this.cleanup=function(){var a=[];return function(){if(!(this.byteSize<104857600)){var b=L.impl.modelQueue(),c=b.getModels().concat(L.getHiddenModels());if(!M){K++;for(var d=0;d<c.length;d++){var e=c[d],g=e.getData();if(e.isOTG()){var h=g.geomMetadata.hashes;if(h)for(var i=h.length/g.geomMetadata.byteStride,j=1;j<i;j++){var k=g.getGeometryHash(j),l=w[k];l&&(l.timeStamp=K)}}}a.length>0&&console.warn("OtgGeomCache.cleanup(): array must be empty");for(var k in w){var l=w[k];l.timeStamp!==K&&a.push(l)}a.sort(f);for(var d=0;d<a.length&&this.byteSize>=52428800;d++){var l=a[d];delete w[l.hash],this.byteSize-=l.byteSize,l.dispose()}d===a.length&&(M=!0),a.length=0}}}}(),this.updateRequestPriorities=function(){var a=performance.now();p();var b=L.impl.modelQueue(),c=b.frustum(),d=b.getModels();c.reset(L.impl.camera);var e=!1,f=0===H||F.length-H>3e3||!I;I=!f,H=F.length;for(var h=0;h<F.length;h++){var i=F[h];if(i.importanceNeedsUpdate)if(G[i.hash])i.importance=1/0;else{if(h%10==0){var j=performance.now()-a;if(j>10){e=!0;break}}i.importanceNeedsUpdate=!1,i.importance=0;for(var k=0,l=i.hash,m=0;m<d.length;m++){var n=d[m];if(n.isOTG()){var o=n.myData,q=o.fragments,r=q.boxes,s=o.geomMetadata.hashToIndex[l];if(s&&q.mesh2frag){var t=q.mesh2frag[s];if("number"==typeof t){var u=z(t,r,c);k+=u}else if(Array.isArray(t))for(var v=0;v<t.length;v++){var w=t[v],u=z(w,r,c);k+=u}}}}if(i.importance=k,!f){for(var m=h;m>0&&k>F[m-1].importance;)F[m]=F[m-1],m--;F[m]=i}}}return f&&!e&&(F.sort(g),I=!0),!e},this.waitForGeometry=function(a,b){function c(c,g){delete G[c],!0!=!a[c]&&(a[c]=g,++f<h||(J.removeEventListener(u,d),J.removeEventListener(v,e),b(a)))}function d(a){c(a.geom.hash,a.geom)}function e(a){c(a.error.args.hash,void 0)}var f=0,h=0;for(var j in a)!0===a[j]&&(G[j]=!0,h++);if(0===h&&a)return void b(a);for(var k=0;k<F.length;k++){var l=F[k];G[l.hash]&&(l.importance=1/0)}F.sort(g),i(),this.addEventListener(u,d),this.addEventListener(v,e);for(j in a){var m=w[j];m&&c(j,m)}},this.getGeometry=function(a){return w[a]}}Object.defineProperty(b,"__esModule",{value:!0}),b.MESH_FAILED_EVENT=b.MESH_RECEIVE_EVENT=void 0,b.OtgGeomCache=i;var j=c(120),k=c(4),l=c(125),m=c(10),n=c(9),o=c(33),p=c(198),q=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(p),r=c(119),s=c(122),t=c(6),u=b.MESH_RECEIVE_EVENT="meshReceived",v=b.MESH_FAILED_EVENT="meshFailed",w=(0,t.getParameterByName)("disableIndexedDb")||(0,k.getGlobal)().DISABLE_INDEXED_DB,x=(0,t.getParameterByName)("disableWebSocket")||(0,k.getGlobal)().DISABLE_WEBSOCKET,y=function(){var a=null;return function(b,c,d){return a||(a=new r.LmvVector3),a.copy(b),a.max(c),a.min(d),a.distanceToSquared(b)}}(),z=function(){var a=null;return function(b,c,d){a||(a=new s.LmvBox3);var e=h(c,b,a);if(d.intersectsBox(e)===j.OUTSIDE)return 0;var f=j.INSIDE,g=d.projectedBoxArea(e,f),i=y(d.eye,e.min,e.max);return i=Math.max(i,.01),g/i}}();o.EventDispatcher.prototype.apply(i.prototype)},function(a,b,c){"use strict";function d(a,b){this.animations=[],this.viewer=a,this.keys=[],this.isPlaying=!1,this.isPaused=!0,this.updateFlag=0,this.duration=b,this.currentTime=0,this.onPlayCallback=null,this.animationHandler=new e.AnimationHandler,this.areCameraAnimationsPaused=!1,this.UPDATE_SCENE=1,this.UPDATE_CAMERA=2}Object.defineProperty(b,"__esModule",{value:!0}),b.KeyFrameAnimator=d;var e=c(230);d.prototype.destroy=function(){this.stop(),this.viewer=null,this.keys=null,this.animations=null,this.isPlaying=!1,this.isPaused=!1,this.animationHandler=null},d.prototype.add=function(a){if(!(!a.hierarchy||a.hierarchy.length<1||!a.hierarchy[0].keys||a.hierarchy[0].keys.length<2)){var b=null,c=this;if("camera"===a.type?(b=new e.CameraAnimation(c.viewer.camera,a,c),c.animations.push(b)):"annotation"===a.type?(b=new e.AnnotationAnimation(null,a,c),c.animations.push(b)):"polyline"===a.type?(b=new e.PolylineAnimation(null,a,c),c.animations.push(b)):"mesh"!==a.type&&"visibility"!==a.type||c.viewer.model.getData().instanceTree.enumNodeFragments(a.id,function(d){var f=c.viewer.getFragmentProxy(c.viewer.model,d);f&&(b="mesh"===a.type?new e.MeshAnimation(f,a,c):new e.VisibilityAnimation(f,a,a.id,c),c.animations.push(b))},!0),b){for(var d=0,f=a.hierarchy.length;d<f;d++)for(var g=a.hierarchy[d].keys,h=0;h<g.length;h++)void 0===g[h].xk&&c.keys.push(g[h].time);!function(a){a.sort(function(a,b){return a-b}),function(a,b,c){for(b=a.length;c=--b;)for(;c--;)a[b]!==a[c]||a.splice(c,1)}(a)}(c.keys)}this.updateFlag|=this.UPDATE_SCENE}},d.prototype.update=function(a){this.animationHandler.update(a);var b=this.updateFlag;return this.isPlaying&&!this.isPaused&&(this.currentTime+=a,this.currentTime=Math.min(this.currentTime,this.duration),this.onPlayCallback&&this.onPlayCallback(this.duration>0?this.currentTime/this.duration*100:0),this.currentTime>=this.duration&&this.pause(),b|=this.UPDATE_SCENE),this.updateFlag=0,b},d.prototype.play=function(a,b){if(this.onPlayCallback=b,this.currentTime>=this.duration&&this.goto(0),this.isPlaying)return void this.pause();for(var c=0;c<this.animations.length;c++){this.animations[c].play(a)}this.isPlaying=!0,this.isPaused=!1},d.prototype.pause=function(){for(var a=0;a<this.animations.length;a++){var b=this.animations[a];b.isPaused===this.isPaused&&b.pause()}this.isPaused=!this.isPaused,this.areCameraAnimationsPaused=this.isPaused},d.prototype.pauseCameraAnimations=function(){for(var a=0;a<this.animations.length;a++){var b=this.animations[a];b instanceof e.CameraAnimation&&b.pause()}this.areCameraAnimationsPaused=!this.areCameraAnimationsPaused},d.prototype.stop=function(){for(var a=0;a<this.animations.length;a++){this.animations[a].stop()}this.isPlaying=!1,this.isPaused=!1},d.prototype.goto=function(a){if(void 0!==a){for(var b=0;b<this.animations.length;b++){this.animations[b].goto(a)}this.isPlaying=!0,this.isPaused=!0,this.currentTime=a,this.updateFlag|=this.UPDATE_SCENE}},d.prototype.next=function(){var a=function(a,b){for(var c=-1,d=0;d<b.length;d++)if(b[d]>a){c=b[d];break}return c<0?b[b.length-1]:c
}(this.currentTime,this.keys);this.goto(a)},d.prototype.prev=function(){var a=function(a,b){for(var c=-1,d=b.length-1;d>-1;d--)if(b[d]<a){c=b[d];break}return c<0?b[0]:c}(this.currentTime,this.keys);this.goto(a)}},function(a,b,c){"use strict";function d(){this.animations=[]}function e(a,b,c){this.root=a,this.handler=c.animationHandler,this.data=this.handler.init(b),this.hierarchy=this.handler.parse(a),this.viewer=c.viewer,this.animator=c,this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!1,this.delta=.5,this.interpolationType=n.LINEAR,this.setStartAndEndKeyTime()}function f(a,b,c){e.call(this,a,b,c),this.localMatrix=new m.Matrix4,this.root.getAnimTransform(),this.relativeTransform=!b.custom||!b.custom.transform||"abs"!==b.custom.transform}function g(a,b,c){e.call(this,a,b,c)}function h(a,b,c,d){e.call(this,a,b,d),this.nodeId=c,this.epsilon=.1,this.root.setMaterial(this.viewer.matman().cloneMaterial(a.getMaterial(),d.viewer.model))}function i(a,b,c){var d=this;null===a&&(a=function(a,b,c){var e=d.container=document.createElement("div"),f=a.name;e.id=f,e.style.cursor="pointer",e.style.visibility=c;var g=document.createElement("div");g.id=f+"-txt",g.style.cssText="display: none;position: absolute;z-index: 1;",e.appendChild(g);var h=document.createElement("img"),i=a.custom&&a.custom.att&&1===a.custom.att;h.src=i?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAAAAAAAAAAAAAABAwEAAAAAAAAjSRkAAAAFDASJqnZhg1IqTyAjSRkpTx8hRxggRRcAAAAhRRcKFwgAAACau4R9mnFmiFUhSBgbOhMZNhIAAAAECQMgQxcAAAAAAAAAAAAHDwXB2q2jw4yfvoivyJ6fuI6mv5eSr4KAoWu2trZpiV3Nzc0wVSUhRxhNT01vb28AAAAgRBcAAAAAAAAAAAAhRxgeQBYAAAAAAAAAAAAfQRbP5MC0zqCqyJKpyJJBYje3z6WxyKOFpXF9nmkrTiG+wb5xkGVcf0xYfEg1WSpNTU0hRhgfQhYfQhZVVVVAQEAXMREcOhQcHBwSJw0AAAAAAAAWLxAVLQ8AAAAAAAAfQhYIEgYAAACbvn+DsGCGsmSUunaItGXc6dStypelxY2ZvX2Ntm2JtGnS48fB17G40aWNuWucxH6ny4mUvnPF27aPuHCEsGHV5czI3Lq52KGvzJqz1JmqyJOqzY6ew4OYwHiGs2OEsWHb29vL4LvM5bnD3q2+3KWkyoaLtWuKtmfOzs7IyMi21pyawXqPuG/g4ODX68fI4rTG4LCu0ZKszJKlx4qZwHuBnXR2iXENcZskAAAAXnRSTlMAEAIBCAsF6BUn+vPu7erjsZyBEwP99/TRk3JgRUQ1IxwO/v79/Pv6+fn09PPq08q7sqWDe2xrY01AMBj+/v7+/v37+fn59fXz8u/c1cbFxLWonZiIcm1lYVdSQT8de/EoFwAAAgVJREFUOMutklVz21AQRiNFlswYs+M6DTdN0kCDZWZmuAKDZFtgiO2YYm6TlOEHV53ptGs5j93Xc+a7e3d36P/W9prdZ/PZ17aPxphz3mR0x91G07wTG8TDo5R3HLGH3S6fGPdSo8Na/to6W2HZBEqwPCNULlu1BkFdQSyKx4qxOMoyDDJSRB/HnTcqWbSbTmVS6V3E57hvXicOBZd1gmfj6Z1kPrmTjrMMfRizumDA+k3UTcRSyWg0mkzFEgLNlU3rIIJcns0KqJjJq0I+U0SqUJlZJv8JugU3J/QnHEwu6MCMqPN1pq+H3sFxCgOC7RyT48Ev6qLUL/gmeJrJ/p0DzSnyxTtAGLMbv9dohv8zSbomSqUpOxB0AdNXsUbnGEEQmJzKq3JrLgCaJAzms5LI1enfVefEamc/YzYQYFB6/1xBUsQex3E9UZHkUvO6X48PwQjLTKEjVRVFqUqd8v6naQsMUCNcL8xTrVJZluXyl1K7OW1+7sL71x15cvVH43O7UGi3mmc8lkCE0ByMbvXazwueycbHxiXPrUdv3hLDGiF8au/d4sO7Novtnj9k0BO45uRGTp98f2JlK/RqYzN8TK8bGTjZLTXgfvDp6rMNA0ZADAOWHI6VTYwE4WAZjz/s3V5yvIxADosIPlh0BNXHSdA8LFIfDgE8WDg5hmmx9h/40fgXth2SDk3yjP4AAAAASUVORK5CYII=":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABvFBMVEUAAAAAAAADAAAAAAAAAAACAAAAAAAAAAC5PznHVE8BAAAAAADbc27NXVeUDQaZDQaRBwAAAAAAAACHBgDuhoHVa2W9RD2QCAKYCAGPBgB0BQAAAAAAAACMBgAAAAADAAD2jonWb2n2jYjYbWfmeXPNzc3RYFqzODKfFA1RUVGKBgCVBwBvb2+WBwCBBgCFBgCWBwCLBgAAAAAAAACMBgCTBwByBQCTBwBbBACEBgAAAAAAAAAoAgBSBADgeHOoOzXmfnnofnjieHPGvr63t7e0tLTidW/ebmnba2XWZWDAT0qRHBfBSkRNTU2aFxGOBgBYTEsAAACNBgBAQEAAAABbBQAcHBxyBQBKBAAAAABfBAAAAAAAAAAsAgAkAgCJBgDZRT3MOTHQPDTVQjrlUkrjUEjRPjbOOjP/bGTvXFTqV0/fTETNOjL5Zl7eS0PzYFjxXlbiT0fUQTn0e3T7aGDWXFXbSEDTRj/PQTrOPjbb29vgamTxY1zoVE3STETTQjvSPzfOzs7IyMj5g3zzaWLXY13XYVrsXlbbU0zg4OD8lZD4gXq0eHXqd3HscWv2b2jrZmDQZWDdWVLkV1C5y9+5AAAAYHRSTlMAAgUBDggMEeDsIBj+8NHJxpxAEP754tDDtIFsYDkvI/78+/j08/DfycfHxbuvr5mTjYN0bWxkWVZTTDUjEfz8+/n59fT08vHw8PDw5NzV0Mq5uLWrm5iLfX1hV0g/ODZEwKduAAACAklEQVQ4y62SVXPbQBzEa1mWZYaY49ihBhtmKjMzw92JLLBsyxxT2mCZvnCVmU59VpO37Ms97G929nb+p05WXUvTE5GJ6aWuY+yFEdoVdAZd9MjCEYi5J0L3FZutSqVZdIYiPWaj/85j2yszAACGVyq7Lo+RIMZtxRaQOZaTwZZSLbrGLR2+aX54twVykpgVpRzgYbVGz5twYMPTV2ZkKZMupDOSzAiwfNazgQesDO9VASemU6lUWuQAgnyNXsEiiBlbEwE2W9CBQpbVAfRraIZoA5ZosII6EpB6MYrVpLxOQejowKsBL9UGSK+zCnnsF4omB7wkBkQHylDZ+rcDROD3hYcYQE0NHQhQ4f8uCQVG/XF9isJKLtI1TYBQQAgdPlqJzYcWMYBYd58/YJACD6UgpsTVA+51AhvKGgt9zQGN1xN4Dajs/vbtmBXf2mIP3/jGqiW9Q0nlGtn8tXBSnwGPWHYP5PcbLMs2JHFn+6p7WQ/ARTie3/rZm9+pZ+rfP/fawi8dhOFgqLlLX87dHOz/1D9ou/vsrcNiNgBrZzbf338yOXZvbDL2xm4ljCdn6j794cpswr/62p+wWy2m/042oQeMxudedK8mSdzGAy4/9vlm/STRtjGRTz9u3nnge2U3+O2h4o9GfXG7lcLKGWZY8ycduG3sQJCk0Tb+w3S0/Qemc4+eJchuZgAAAABJRU5ErkJggg==",h.id=f+"-img",h.style.cssText="display: block;position: absolute;z-index: 1;",e.appendChild(h),b.api.container.appendChild(e),e.addEventListener("click",function(){g.style.display="none"===g.style.display?"block":"none"});var j=new m.SphereGeometry(.01),k=new m.MeshPhongMaterial({color:32512,ambient:32512,opacity:.6,transparent:!0}),l=new m.Mesh(j,k);return l.visible=!1,void 0===b.overlayScenes.annotation&&b.createOverlayScene("annotation"),b.addOverlay("annotation",l),l}(b,c.viewer,"hidden")),e.call(this,a,b,c),this.id=b.name,this.text="",this.state="hidden",this.epsilon=.1,this.viewer.api.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(b){d.updateText(a.position,d.text)})}function j(a,b,c){this.viewer=c.viewer,null===a&&(a=this.createPolyline([])),e.call(this,a,b,c),this.epsilon=.1}function k(a,b){function c(a,b,c,d,e,f,g){var h=.5*(c-a),i=.5*(d-b);return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b}var d,e,f,g,h,i,j,k,l,m=[],n=[];return d=(a.length-1)*b,e=Math.floor(d),f=d-e,m[0]=0===e?e:e-1,m[1]=e,m[2]=e>a.length-2?e:e+1,m[3]=e>a.length-3?e:e+2,i=a[m[0]],j=a[m[1]],k=a[m[2]],l=a[m[3]],g=f*f,h=f*g,n[0]=c(i[0],j[0],k[0],l[0],f,g,h),n[1]=c(i[1],j[1],k[1],l[1],f,g,h),n[2]=c(i[2],j[2],k[2],l[2],f,g,h),n}Object.defineProperty(b,"__esModule",{value:!0}),b.INTERPOLATION_TYPE=void 0,b.AnimationHandler=d,b.Animation=e,b.MeshAnimation=f,b.CameraAnimation=g,b.VisibilityAnimation=h,b.AnnotationAnimation=i,b.PolylineAnimation=j,b.interpolateCatmullRom=k;var l=c(2),m=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(l),n=b.INTERPOLATION_TYPE={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2};d.prototype.init=function(a){if(!0===a.initialized)return a;for(var b=0;b<a.hierarchy.length;b++){for(var c=0;c<a.hierarchy[b].keys.length;c++)if(a.hierarchy[b].keys[c].time<0&&(a.hierarchy[b].keys[c].time=0),void 0!==a.hierarchy[b].keys[c].rot&&!(a.hierarchy[b].keys[c].rot instanceof m.Quaternion)){var d=a.hierarchy[b].keys[c].rot;Array.isArray(d)||(d=[d._x,d._y,d._z,d._w]),a.hierarchy[b].keys[c].rot=(new m.Quaternion).fromArray(d)}for(var c=1;c<a.hierarchy[b].keys.length;c++)a.hierarchy[b].keys[c].time===a.hierarchy[b].keys[c-1].time&&(a.hierarchy[b].keys.splice(c,1),c--);for(var c=0;c<a.hierarchy[b].keys.length;c++)a.hierarchy[b].keys[c].index=c}return a.initialized=!0,a},d.prototype.parse=function(a){function b(a,c){if(c.push(a),a.children&&!(a instanceof m.Camera))for(var d=0;d<a.children.length;d++)b(a.children[d],c)}var c=[];return b(a,c),c},d.prototype.play=function(a){-1===this.animations.indexOf(a)&&this.animations.push(a)},d.prototype.stop=function(a){var b=this.animations.indexOf(a);-1!==b&&this.animations.splice(b,1)},d.prototype.update=function(a){for(var b=0;b<this.animations.length;b++)this.animations[b].update(a)},e.prototype.setStartAndEndKeyTime=function(){if(this.data.hierarchy.length>0){var a=this.data.hierarchy[0].keys;this.startKeyTime=a[0].time,this.endKeyTime=a[a.length-1].time}else this.startKeyTime=this.endKeyTime=0},e.prototype.keyTypes=[],e.prototype.defaultKey={},e.prototype.play=function(a){this.currentTime=void 0!==a?a:0,this.isPlaying=!0,this.isPaused=!1,this.reset(),this.handler.play(this)},e.prototype.pause=function(){!0===this.isPaused?this.handler.play(this):this.handler.stop(this),this.isPaused=!this.isPaused},e.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,this.handler.stop(this)},e.prototype.goto=function(a){this.isPlaying||this.play(),this.isPaused||this.pause();var b=a-this.currentTime;this.update(b)},e.prototype.reset=function(){for(var a=0,b=this.hierarchy.length;a<b;a++){var c=this.hierarchy[a];void 0===c.animationCache&&(c.animationCache={}),void 0===c.animationCache[this.data.name]&&(c.animationCache[this.data.name]={prevKey:this.defaultKey,nextKey:this.defaultKey,originalMatrix:c.matrix});for(var d=c.animationCache[this.data.name],e=0;e<this.keyTypes.length;e++){for(var f=this.keyTypes[e],g=this.data.hierarchy[a].keys[0],h=this.getNextKeyWith(f,a,1);h.time<this.currentTime&&h.index>g.index;)g=h,h=this.getNextKeyWith(f,a,h.index+1);d.prevKey[f]=g,d.nextKey[f]=h}}this.setStartAndEndKeyTime()},e.prototype.getNextKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;for(this.interpolationType===n.CATMULLROM||this.interpolationType===n.CATMULLROM_FORWARD?c=c<d.length-1?c:d.length-1:c%=d.length;c<d.length;c++)if(void 0!==d[c][a])return d[c];return this.data.hierarchy[b].keys[0]},e.prototype.getPrevKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;for(c=this.interpolationType===n.CATMULLROM||this.interpolationType===n.CATMULLROM_FORWARD?c>0?c:0:c>=0?c:c+d.length;c>=0;c--)if(void 0!==d[c][a])return d[c];return this.data.hierarchy[b].keys[d.length-1]},e.prototype.isPlayingOutOfRange=function(){return!1===this.isPaused&&(this.currentTime<this.startKeyTime-this.delta||this.currentTime>this.endKeyTime+this.delta)},e.prototype.resetIfLooped=function(){!0===this.loop&&this.currentTime>this.endKeyTime&&(this.currentTime%=this.endKeyTime,this.reset())},f.prototype=Object.create(e.prototype),f.prototype.constructor=f,f.prototype.keyTypes=["pos","rot","scl"],f.prototype.defaultKey={pos:0,rot:0,scl:0},f.prototype.update=function(){function a(){b||(b=new m.Vector3,c=new m.Vector3,d=new m.Quaternion,e=new m.Matrix4,f=new m.Matrix4)}var b,c,d,e,f,g=[];return function(h){if(!1!==this.isPlaying&&(this.currentTime+=h*this.timeScale,a(),this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var i=0,j=this.hierarchy.length;i<j;i++){for(var l=this.hierarchy[i],o=l.animationCache[this.data.name],p=0;p<this.keyTypes.length;p++){var q=this.keyTypes[p],r=o.prevKey[q],s=o.nextKey[q];if(s.time<=this.currentTime||r.time>=this.currentTime){for(r=this.data.hierarchy[i].keys[0],s=this.getNextKeyWith(q,i,1);s.time<this.currentTime&&s.index>r.index;)r=s,s=this.getNextKeyWith(q,i,s.index+1);o.prevKey[q]=r,o.nextKey[q]=s}var t=r[q],u=s[q];if(s.time!==r.time&&void 0!==t&&void 0!==u){var v=(this.currentTime-r.time)/(s.time-r.time);if(v<0&&(v=0),v>1&&(v=1),"pos"===q)if(this.interpolationType===n.LINEAR)c.x=t[0]+(u[0]-t[0])*v,c.y=t[1]+(u[1]-t[1])*v,c.z=t[2]+(u[2]-t[2])*v,l.position.copy(c);else{g[0]=this.getPrevKeyWith("pos",i,r.index-1).pos,g[1]=t,g[2]=u,g[3]=this.getNextKeyWith("pos",i,s.index+1).pos,v=.33*v+.33;var w=k(g,v);if(c.x=w[0],c.y=w[1],c.z=w[2],l.position.copy(c),this.interpolationType===n.CATMULLROM_FORWARD){var x=k(g,1.01*v);b.set(x[0],x[1],x[2]),b.sub(vector),b.y=0,b.normalize();var y=Math.atan2(b.x,b.z);l.rotation.set(0,y,0)}}else"rot"===q?(m.Quaternion.slerp(t,u,d,v),l.quaternion.copy(d)):"scl"===q&&(c.x=t[0]+(u[0]-t[0])*v,c.y=t[1]+(u[1]-t[1])*v,c.z=t[2]+(u[2]-t[2])*v,l.scale.copy(c))}}if(!this.relativeTransform){var z=e.compose(l.position,l.quaternion,l.scale),A=f;l.getOriginalWorldMatrix(A),A.getInverse(A);var B=e.multiplyMatrices(z,A);B.decompose(l.position,l.quaternion,l.scale)}l.updateAnimTransform()}}}(),g.prototype=Object.create(e.prototype),g.prototype.constructor=g,g.prototype.keyTypes=["pos","up","target","fov","perspective"],g.prototype.defaultKey={pos:0,up:0,target:0,fov:0,perspective:0},g.prototype.update=function(){function a(){b||(b=new m.Vector3,c=new m.Vector3)}var b,c,d=[];return function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,a(),this.resetIfLooped(),!this.isPlayingOutOfRange())){for(var f=0,g=this.hierarchy.length;f<g;f++){for(var h=this.hierarchy[f],i=h.animationCache[this.data.name],j=0;j<this.keyTypes.length;j++){var l=this.keyTypes[j],m=i.prevKey[l],o=i.nextKey[l];if(o.time<=this.currentTime||m.time>=this.currentTime){for(m=this.data.hierarchy[f].keys[0],o=this.getNextKeyWith(l,f,1);o.time<this.currentTime&&o.index>m.index;)m=o,o=this.getNextKeyWith(l,f,o.index+1);i.prevKey[l]=m,i.nextKey[l]=o}var p=m[l],q=o[l];if(o.time!==m.time&&void 0!==p&&void 0!==q){var r=(this.currentTime-m.time)/(o.time-m.time);r<0&&(r=0),r>1&&(r=1);var s;if("pos"===l)s=h.position;else if("up"===l)s=h.up;else if("target"===l)s=h.target;else{if("fov"===l){h.setFov(p+(q-p)*r);continue}if("perspective"===l){var t=r>.5?q:p;t?h.toPerspective():h.toOrthographic();continue}}if(this.interpolationType===n.LINEAR)c.x=p[0]+(q[0]-p[0])*r,c.y=p[1]+(q[1]-p[1])*r,c.z=p[2]+(q[2]-p[2])*r,s.copy(c);else{d[0]=this.getPrevKeyWith(l,f,m.index-1)[l],d[1]=p,d[2]=q,d[3]=this.getNextKeyWith(l,f,o.index+1)[l],r=.33*r+.33;var u=k(d,r);if(c.x=u[0],c.y=u[1],c.z=u[2],s.copy(c),this.interpolationType===n.CATMULLROM_FORWARD){var v=k(d,1.01*r);b.set(v[0],v[1],v[2]),b.sub(s),b.y=0,b.normalize();var w=Math.atan2(b.x,b.z);h.rotation.set(0,w,0)}}}}h.matrixAutoUpdate=!0,h.matrixWorldNeedsUpdate=!0}h.lookAt(h.target),this.animator.updateFlag|=this.animator.UPDATE_CAMERA}}}(),h.prototype=Object.create(e.prototype),h.prototype.constructor=h,h.prototype.keyTypes=["vis","opa"],h.prototype.defaultKey={viz:1,opa:1},h.prototype.update=function(){return function(a){if(!1!==this.isPlaying&&(this.currentTime+=a*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var b=0,c=this.hierarchy.length;b<c;b++)for(var d=this.hierarchy[b],e=d.animationCache[this.data.name],f=0;f<this.keyTypes.length;f++){var g=this.keyTypes[f],h=e.prevKey[g],i=e.nextKey[g];if(i.time<=this.currentTime||h.time>=this.currentTime){for(h=this.data.hierarchy[b].keys[0],i=this.getNextKeyWith(g,b,1);i.time<this.currentTime&&i.index>h.index;)h=i,i=this.getNextKeyWith(g,b,i.index+1);e.prevKey[g]=h,e.nextKey[g]=i}var j=h[g],k=i[g];if(i.time!==h.time&&void 0!==j&&void 0!==k){var l=d.getMaterial();if("vis"===g){var m=Math.abs(this.currentTime-i.time)<this.epsilon,n=m?k:j;this.viewer.visibilityManager.setNodeOff(this.nodeId,!n)}else if("opa"===g){var o=(this.currentTime-h.time)/(i.time-h.time);o<0&&(o=0),o>1&&(o=1);var p=j+(k-j)*o;l.transparent=1!==p,l.opacity=p,p>0&&this.viewer.visibilityManager.setNodeOff(this.nodeId,!1)}}}}}(),i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.keyTypes=["pos","text","vis"],i.prototype.defaultKey={pos:0,text:"",vis:1},i.prototype.stop=function(){e.prototype.stop.call(this),this.container.parentNode.removeChild(this.container),this.viewer.removeOverlay("annotation",this.root),this.root=null},i.prototype.updateText=function(a,b){var c=function(a,b,c){var d=a.clone(),e=new m.Matrix4;return b.updateMatrixWorld(),b.matrixWorldInverse.getInverse(b.matrixWorld),e.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),d.applyProjection(e),{x:(d.x+1)*c.width/2+c.offsetLeft,y:(1-d.y)*c.height/2+c.offsetTop}}(a,this.viewer.camera,this.viewer.canvas),d=document.getElementById(this.id+"-txt");d&&(d.innerHTML=b,d.style.left=c.x+"px",d.style.top=c.y+"px",this.text=b),(d=document.getElementById(this.id+"-img"))&&(d.style.left=c.x+"px",d.style.top=c.y-24+"px")},i.prototype.update=function(){function a(){b||(b=new m.Vector3,c=new m.Vector3)}var b,c,d=[];return function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,a(),this.resetIfLooped(),!this.isPlayingOutOfRange())){if(this.isPaused&&this.currentTime<this.startKeyTime){var f=document.getElementById(this.id);return void(f&&(f.style.visibility=this.state))}for(var g=0,h=this.hierarchy.length;g<h;g++){for(var i=this.hierarchy[g],j=i.animationCache[this.data.name],l=0;l<this.keyTypes.length;l++){var m=this.keyTypes[l],o=j.prevKey[m],p=j.nextKey[m];if(p.time<=this.currentTime||o.time>=this.currentTime){for(o=this.data.hierarchy[g].keys[0],p=this.getNextKeyWith(m,g,1);p.time<this.currentTime&&p.index>o.index;)o=p,p=this.getNextKeyWith(m,g,p.index+1);j.prevKey[m]=o,j.nextKey[m]=p}var q=o[m],r=p[m];if(p.time!==o.time&&void 0!==q&&void 0!==r){var s=(this.currentTime-o.time)/(p.time-o.time);if(s<0&&(s=0),s>1&&(s=1),"pos"===m){if(this.interpolationType===n.LINEAR)c.x=q[0]+(r[0]-q[0])*s,c.y=q[1]+(r[1]-q[1])*s,c.z=q[2]+(r[2]-q[2])*s,i.position.copy(c);else if(this.interpolationType===n.CATMULLROM||this.interpolationType===n.CATMULLROM_FORWARD){d[0]=this.getPrevKeyWith("pos",g,o.index-1).pos,d[1]=q,d[2]=r,d[3]=this.getNextKeyWith("pos",g,p.index+1).pos,s=.33*s+.33;var t=k(d,s);if(c.x=t[0],c.y=t[1],c.z=t[2],i.position.copy(c),this.interpolationType===n.CATMULLROM_FORWARD){var u=k(d,1.01*s);b.set(u[0],u[1],u[2]),b.sub(vector),b.y=0,b.normalize();var v=Math.atan2(b.x,b.z);i.rotation.set(0,v,0)}}}else if("text"===m){var w=Math.abs(this.currentTime-p.time)<this.epsilon?r:q;this.updateText(i.position,w)}else if("vis"===m){var f=document.getElementById(this.id);if(f){var x=Math.abs(this.currentTime-p.time)<this.epsilon?r:q;f.style.visibility=x?"visible":"hidden"}}}}i.matrixAutoUpdate=!0,i.matrixWorldNeedsUpdate=!0}}}}(),j.prototype=Object.create(e.prototype),j.prototype.constructor=j,j.prototype.keyTypes=["points","vis"],j.prototype.defaultKey={points:[],vis:1},j.prototype.stop=function(){e.prototype.stop.call(this),this.viewer.removeOverlay("polyline",this.root),this.root=null},j.prototype.update=function(){function a(a){a.root&&(a.viewer.removeOverlay("polyline",a.root),a.root=null)}return function(b){if(!1!==this.isPlaying&&(this.currentTime+=b*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange())){if(this.isPaused&&this.currentTime<this.startKeyTime)return void a(this);for(var c=0,d=this.hierarchy.length;c<d;c++)for(var e=this.hierarchy[c],f=e.animationCache[this.data.name],g=0;g<this.keyTypes.length;g++){var h=this.keyTypes[g],i=f.prevKey[h],j=f.nextKey[h];if(j.time<=this.currentTime||i.time>=this.currentTime){for(i=this.data.hierarchy[c].keys[0],j=this.getNextKeyWith(h,c,1);j.time<this.currentTime&&j.index>i.index;)i=j,j=this.getNextKeyWith(h,c,j.index+1);f.prevKey[h]=i,f.nextKey[h]=j}var k=i[h],l=j[h];if(j.time!==i.time&&void 0!==k&&void 0!==l){var n=(this.currentTime-i.time)/(j.time-i.time);if(n<0&&(n=0),n>1&&(n=1),"points"===h){var o=n<.5?k:l;this.viewer.removeOverlay("polyline",this.root),this.root=null;for(var p=[],q=0;q<o.length;q++){var r=o[q].slice();if(0===q)r[0]=k[q][0]+(l[q][0]-k[q][0])*n,r[1]=k[q][1]+(l[q][1]-k[q][1])*n,r[2]=k[q][2]+(l[q][2]-k[q][2])*n;else if(q===o.length-1){var s=k.length-1,t=l.length-1;r[0]=k[s][0]+(l[t][0]-k[s][0])*n,r[1]=k[s][1]+(l[t][1]-k[s][1])*n,r[2]=k[s][2]+(l[t][2]-k[s][2])*n}var u=new m.Vector3(r[0],r[1],r[2]);p.push(u)}this.root=this.createPolyline(p)}else if("vis"===h){var v=Math.abs(this.currentTime-j.time)<this.epsilon?l:k;this.root.visible=v,v||a(this)}}}}}}(),j.prototype.createPolyline=function(a){for(var b=new m.Geometry,c=0;c<a.length;c++)b.vertices.push(a[c]);b.computeLineDistances();var d=new m.LineDashedMaterial({color:0,dashSize:1,gapSize:.5,linewidth:1}),e=new m.Line(b,d,m.LineStrip);return void 0===this.viewer.overlayScenes.polyline&&this.viewer.createOverlayScene("polyline"),this.viewer.addOverlay("polyline",e),e}},function(a,b,c){"use strict";function d(a,b){f.Camera.call(this),this.fov=45,this.near=.1,this.far=1e5,this.aspect=a/b,this.left=-a/2,this.right=a/2,this.top=b/2,this.bottom=-b/2,this.clientWidth=a,this.clientHeight=b,this.target=new f.Vector3(0,0,-1),this.worldup=new f.Vector3(0,1,0),this.orthographicCamera=new f.OrthographicCamera(this.left,this.right,this.top,this.bottom,this.near,this.far),this.perspectiveCamera=new f.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this.zoom=1,this.toPerspective()}Object.defineProperty(b,"__esModule",{value:!0}),b.UnifiedCamera=d;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e);d.ORTHO_FOV=2*Math.atan(.5)*180/Math.PI,d.prototype=Object.create(f.Camera.prototype),d.prototype.clone=function(){var a=new d(2*this.right,2*this.top);return f.Camera.prototype.clone.call(this,a),a.position.copy(this.position),a.up.copy(this.up),this.target&&(a.target=this.target.clone()),this.worldup&&(a.worldup=this.worldup.clone()),this.worldUpTransform&&(a.worldUpTransform=this.worldUpTransform.clone()),a.left=this.left,a.right=this.right,a.top=this.top,a.bottom=this.bottom,a.near=this.near,a.far=this.far,a.fov=this.fov,a.aspect=this.aspect,a.zoom=this.zoom,a.isPerspective=this.isPerspective,this.updateProjectionMatrix(),a},d.prototype.__computeFovPosition=function(a){if(Math.abs(this.fov-a)<=1e-4)return this.position.clone();var b,c,d=this.target.clone().sub(this.position),e=d.clone().normalize(),g=f.Math.degToRad(this.fov),h=f.Math.degToRad(a),i=Math.tan(.5*g)/Math.tan(.5*h);if(this.pivot){b=(new f.Plane).setFromNormalAndCoplanarPoint(e.clone().negate(),this.pivot).distanceToPoint(this.position),c=e.clone().multiplyScalar(b).add(this.position)}else b=d.length(),c=this.target;b*=i;var j=e.multiplyScalar(-b);return c.clone().add(j)},d.prototype.toPerspective=function(){!this.isPerspective&&this.saveFov&&(this.position.copy(this.__computeFovPosition(this.saveFov)),this.fov=this.saveFov),this.perspectiveCamera.aspect=this.aspect,this.perspectiveCamera.near=this.near,this.perspectiveCamera.far=this.far,this.perspectiveCamera.fov=this.fov/this.zoom,this.perspectiveCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspectiveCamera.projectionMatrix,this.isPerspective=!0},d.prototype.toOrthographic=function(){if(this.isPerspective){this.saveFov=this.fov;var a=d.ORTHO_FOV;this.position.copy(this.__computeFovPosition(a)),this.fov=a}this.orthoScale=this.target.clone().sub(this.position).length();var b=.5*this.orthoScale,c=b*this.aspect;this.left=this.orthographicCamera.left=-c,this.right=this.orthographicCamera.right=c,this.top=this.orthographicCamera.top=b,this.bottom=this.orthographicCamera.bottom=-b,this.orthographicCamera.near=this.near,this.orthographicCamera.far=this.far,this.orthographicCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthographicCamera.projectionMatrix,this.isPerspective=!1},d.prototype.updateProjectionMatrix=function(){this.isPerspective?this.toPerspective():this.toOrthographic()},d.prototype.setSize=function(a,b){this.aspect=a/b,this.left=-a/2,this.right=a/2,this.top=b/2,this.bottom=-b/2},d.prototype.setFov=function(a){this.fov=a,this.updateProjectionMatrix()},d.prototype.setLens=function(a,b){void 0===b&&(b=24);var c=2*f.Math.radToDeg(Math.atan(b/(2*a)));return this.setFov(c),c}},function(a,b,c){"use strict";function d(){var a={extensions:[],sharedPropertyDbPath:void 0,canvasConfig:void 0,startOnInitialize:!0,experimental:[]};return f.theExtensionManager.popuplateOptions(a),a.hasOwnProperty("disabledExtensions")||(a.disabledExtensions={}),["measure","hyperlink","section"].forEach(function(b){a.disabledExtensions.hasOwnProperty(b)||(a.disabledExtensions[b]=!1)}),a}function e(){return{env:"AutodeskProduction",api:void 0,getAccessToken:void 0,language:void 0,logLevel:g.LogLevels.ERROR,webGLHelpLink:null}}Object.defineProperty(b,"__esModule",{value:!0}),b.createViewerConfig=d,b.createInitializerOptions=e;var f=c(202),g=c(8)},function(a,b,c){"use strict";function d(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],e=Array.isArray(d),f=a[c],g=Array.isArray(f);e&&g?(d?e||(d=[d]):d=[],f?g||(f=[f]):f=[],a[c]=f.concat(d)):a[c]=d}}Object.defineProperty(b,"__esModule",{value:!0}),b.ViewingApplication=void 0;var e=c(13),f=c(198),g=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(f),h=c(208),i=c(200),j=c(8),k=b.ViewingApplication=function(a,b){this.appContainerId=a,this.container=document.getElementById(a),this.options=b||{},this.myRegisteredViewers={},this.myDocument=null,this.bubble=null,this.myCurrentViewer=null,this.urn=null,this.selectedItem=null,this.extensionCache={};var c=this;this.onHyperlinkHit=function(a){var b=a.data.item;b&&c.selectItem(b)},this.onLoadGeometry=function(a){var b=a.data;c.selectItem(b.item,b.onSuccessCb,b.onErrorCb)}};k.prototype.k3D="3D",k.prototype.finish=function(){this.myCurrentViewer&&(this.myCurrentViewer.finish(),this.myCurrentViewer=null)},k.prototype.registerViewer=function(a,b,c){if(a!==this.k3D)return void j.logger.error("The only acceptable viewer type is k3D.",(0,e.errorCodeString)(e.ErrorCodes.VIEWER_INTERNAL_ERROR));c=c||{},this.options&&this.options.hasOwnProperty("disableBrowserContextMenu")&&(c.hasOwnProperty("disableBrowserContextMenu")||(c.disableBrowserContextMenu=this.options.disableBrowserContextMenu)),this.myRegisteredViewers[a]={},this.myRegisteredViewers[a].class=b,this.myRegisteredViewers[a].config=c},k.prototype.getViewerClass=function(a){return this.myRegisteredViewers.hasOwnProperty(a)?this.myRegisteredViewers[a].class:null},k.prototype.getViewerContainer=function(){return document.getElementById(this.appContainerId)},k.prototype.getViewer=function(a){var b=this.myRegisteredViewers[this.k3D];if(!b)return null;var c={};d(c,b.config),d(c,a);var e=b.class;if(this.myCurrentViewer&&this.myCurrentViewer.__proto__.constructor===e)return this.myCurrentViewer.tearDown(),this.myCurrentViewer.setUp(c),this.myCurrentViewer;this.setCurrentViewer(null);for(var f=this.getViewerContainer();f.hasChildNodes();)f.removeChild(f.lastChild);var g=new e(f,c);return this.setCurrentViewer(g),g},k.prototype.setCurrentViewer=function(a){this.myCurrentViewer&&(this.myCurrentViewer.removeEventListener(g.HYPERLINK_EVENT,this.onHyperlinkHit),this.myCurrentViewer.removeEventListener(g.LOAD_GEOMETRY_EVENT,this.onLoadGeometry),this.myCurrentViewer.finish()),this.myCurrentViewer=a,this.myCurrentViewer&&(a.addEventListener(g.HYPERLINK_EVENT,this.onHyperlinkHit),a.addEventListener(g.LOAD_GEOMETRY_EVENT,this.onLoadGeometry),a.extensionCache=this.extensionCache)},k.prototype.getCurrentViewer=function(){return this.myCurrentViewer},k.prototype.setDocument=function(a){if(!a.urn||"$file$"===a.urn)return j.logger.error("Unsupported Manifest urn: "+a.urn),!1;var b=h.Document.getDocumentPath(a.urn);return this.myDocument=new h.Document(a,b),this.bubble=this.myDocument.getRoot(),this.onDocumentLoaded(this.myDocument),!0},k.prototype.loadDocument=function(a,b,c,d){j.logger.track({category:"load_document",urn:0==a.indexOf("urn:")?a.substring(4):a}),h.Document.load(a,function(a,c){this.myDocument=a,this.bubble=a.getRoot(),this.onDocumentLoaded(a,c),b&&b(a,c)}.bind(this),function(a,b,d,e,f){this.onDocumentFailedToLoad(a,b,f),c&&c(a,b,d,e,f)}.bind(this),d)},k.prototype.onDocumentLoaded=function(a,b){j.logger.log(a,b)},k.prototype.onDocumentFailedToLoad=function(a,b,c){j.logger.error((0,e.errorCodeString)(a),b,c)},k.prototype.getDefaultGeometry=function(a){for(var b=0,c=a.length;b<c;++b){var d=a[b];d instanceof i.BubbleNode&&(d=d._raw());var e=d.useAsDefault;if(!0===e||"true"===e)return a[b]}return a[0]},k.prototype.selectItem=function(a,b,c){var d={};a instanceof i.BubbleNode||(console.warn("Deprecated use of ViewingApplication.selectItem. Pass BubbleNode instead of raw manifest JSON"),a=this.bubble.findByGuid(a.guid));var e=this.myDocument.getViewablePath(a,d);if(!e&&a.isViewPreset()&&(e=this.urn),!e)return!1;var f,g,h,k=!1;if(a.isGeometry()&&a.is3D())k=!0,g=a.name(),h=a;else if(a.isViewPreset()&&a.is3D())f=a,k=!0,(h=this.myDocument.getViewGeometry(a,!0))&&(g=h.name());else if(a.isGeometry()&&a.is2D()){var l=a.search(i.BubbleNode.GEOMETRY_F2D_NODE),m=a.search(i.BubbleNode.LEAFLET_NODE),n=a.search(i.BubbleNode.IMAGE_NODE);(l.length>0||m.length>0||n.length>0)&&(k=!0),g=a.name(),h=a}else a.isViewPreset()&&a.is2D()&&(f=a,k=!0,(h=this.myDocument.getViewGeometry(a,!0))&&(g=h.name()));if(!k)return!1;var o=e.indexOf("urn:");j.logger.track({category:"load_viewable",role:a._raw().role,type:a._raw().type,urn:-1!==o?e.substring(o+4):e});var p=this.myDocument.getMessages(a,!0),q=this,r=this.myCurrentViewer&&this.urn===e,s=function(c){var d=q.myCurrentViewer;f&&f._raw().camera?d.setViewFromArray(f._raw().camera,f.name()):f&&f._raw().viewbox?d.setViewFromViewBox(f._raw().viewbox,f.name()):r&&d.setViewFromFile(c),b&&b(q.myCurrentViewer,a,p)},t=function(a,b,d,e){c&&c(a,b,d,e,p)},u=!1;if(r)s&&s(),u=!0;else{this.urn=null;var v={defaultModelStructureTitle:g,viewableName:g},w=a.extensions();w&&(v.extensions=w);var x=this.getViewer(v);if(x){var y={ids:null,acmSessionId:this.myDocument.acmSessionId,loadOptions:d,useConsolidation:this.options.useConsolidation,consolidationMemoryLimit:this.options.consolidationMemoryLimit||104857600};this.options.hasOwnProperty("isAEC")&&(y.isAEC=this.options.isAEC),x.started?(x.loadDocumentNode(this.myDocument,a,y).then(s).catch(t),u=!0):(x.startWithDocumentNode(this.myDocument,a,y).then(s).catch(t),u=!0),this.urn=e}}return!!u&&(this.selectedItem=a,this.onItemSelected(a,h),!0)},k.prototype.onItemSelected=function(a,b){if(j.logger.log("Selected URL: http://"+location.host+location.pathname+"?document=urn:"+this.myDocument.getRoot().guid()+"&item="+encodeURIComponent(a.guid())),this.itemSelectedObservers)for(var c=this.getCurrentViewer(),d=0;d<this.itemSelectedObservers.length;++d){var e=this.itemSelectedObservers[d];e.onItemSelected&&e.onItemSelected(c,a,b)}},k.prototype.addItemSelectedObserver=function(a){this.itemSelectedObservers||(this.itemSelectedObservers=[]),this.itemSelectedObservers.push(a)},k.prototype.selectItemById=function(a,b,c){var d=this.myDocument.getRoot().findByGuid(a);return!!d&&this.selectItem(d,b,c)},k.prototype.getSelectedItem=function(){return this.selectedItem},k.prototype.getNamedViews=function(a){if(!(a=a||this.selectedItem)||!a.guid)return[];var b;return b=a instanceof i.BubbleNode?a:this.bubble.findByGuid(a.guid),a===this.selectedItem&&(b=b.findParentGeom2Dor3D()),b.getNamedViews()}},function(a,b){"use strict";function c(a){return a?a.byteLength:0}function d(a){return c(a.boxes)+c(a.transforms)+c(a.fragId2dbId)+c(a.geomDataIndexes)+c(a.materials)}function e(a){return c(a.geomids)+c(a.materialids)+c(a.vizflags)+(a.boxes!==a.fragments.boxes?c(a.boxes):0)+(a.transforms!==a.fragments.transforms?c(a.transforms):0)}function f(a){return c(a.nodes.nodesRaw?a.nodes.nodesRaw:a.nodes)+c(a.primitives)}function g(a){var b=a.nodeAccess;return c(b.children)+c(b.nameSuffixes)+c(b.names)+c(b.nodeBoxes)+c(b.nodes)}function h(a){for(var b=0,c=0;c<a.length;c++){var h=a[c],i=h.getData(),j=h.getConsolidation();if(j&&(b+=j.byteSize),i.isLeaflet)l||(console.warn("Memory tracking not implemented for leaflets."),l=!0);else{if(!i.isOTG){b+=h.getGeometryList().geomMemory}var k=i.fragments;k&&(b+=d(k));var m=h.getFragmentList();m&&(b+=e(m));var n=i.bvh;n&&(b+=f(n));var o=i.instanceTree;o&&(b+=g(o))}}return isFinite(b)||avp.logger.warn("Memory estimate result was not a number"),b}function i(a){var b=a.impl.geomCache(),c=b?b.byteSize:0,d=a.impl.modelQueue(),e=d.getModels(),f=d.getHiddenModels();return c+h(e)+h(f)}function j(a,b){function c(a){return a.lruTimestamp===f}function d(){for(var a=e.impl.modelQueue(),b=a.getHiddenModels(),d=[],f=0;f<b.length;f++){var g=b[f];c(g)||d.push(g)}var h=function(a,b){return a.lurTimestamp-b.lruTimestamp};return d.sort(h),d}var e=a,f=0,g=b||k;this.updateModelTimestamps=function(a){f++;for(var b=0;b<a.length;b++){a[b].lruTimestamp=f}},this.memoryExceeded=function(){return i(e)>=g},this.getMemLimit=function(){return g},this.cleanup=function(a){var b=a||e.impl.unloadModel.bind(e.impl);if(this.memoryExceeded()){for(var c=d(),f=0;f<c.length;f++){var g=c[f];if(g.isConsolidated&&(g.unconsolidate(),!this.memoryExceeded()))return}var h=e.impl.geomCache();for(f=0;f<c.length;f++)if(g=c[f],b(g),h&&h.cleanup(),!this.memoryExceeded())return}}}Object.defineProperty(b,"__esModule",{value:!0}),b.estimateMemUsage=i,b.ModelMemoryTracker=j;var k=1048576e3,l=!1},function(a,b,c){"use strict";function d(a,b,c,e){function f(a){var b=0<=a?Math.floor(a):Math.ceil(a);return{
intPart:b,fracPart:a-b}}function h(a,b,c){var d="";return c&&0===a&&(d+="-"),d+=0<b?a.toFixed(b):a.toFixed(0)}function i(a,b,c){for(var d="",e=1,g=a<0,i=0;i<b;++i)e*=2;a>0?a+=.5/e:a-=.5/e;var j,k;c?k=a:(j=f(a/12).intPart,d+=h(j,0,g)+"' ",(k=a-12*j)<0&&(k=-k));var l=f(k).intPart,m=f((k-l)*e).intPart;if(0!==m&&0===l||(d+=h(l,0)),0!==m){for(l<0&&m<0&&(m=-m);m%2==0;)m/=2,e/=2;0!==l&&(d+="-"),d+=h(m,0)+"/"+h(e,0)}return d+='"'}function j(a,b){var c="";a<0&&(c="-",a=Math.abs(a));var d=f(a),e=d.intPart,g=100*d.fracPart;return c+h(e,0)+" m "+h(g,b)+" cm"}function k(a,b){var c="";a<0&&(c="-",a=Math.abs(a));var d=f(a),e=d.intPart,g=12*d.fracPart;return c+h(e,0)+"' "+h(g,b)+'"'}var l;null!==e&&void 0!==e||(e=3);try{if(1===c)l=g.i18n.translate(a?"Yes":"No");else if(24===c){var m=a.split(" ");l=[];for(var n=0;n<m.length;++n)l.push(d(parseFloat(m[n]),b,3,e));l=l.join(", ")}else 2!==c&&3!==c||!isNaN(a)?"ft-and-fractional-in"===b?l=i(12*a,e):"ft-and-fractional-in^2"===b?l=i(12*a,e)+" "+String.fromCharCode(178):"ft-and-decimal-in"===b?l=k(a,e):"ft-and-decimal-in^2"===b?l=k(a,e)+" "+String.fromCharCode(178):"decimal-in"===b||"in"===b||"inch"===b?l=h(a,e)+'"':"decimal-in^2"===b||"in^2"===b||"inch^2"===b?l=h(a,e)+'" '+String.fromCharCode(178):"decimal-ft"===b||"ft"===b||"feet"===b||"foot"===b?l=h(a,e)+"'":"decimal-ft^2"===b||"ft^2"===b||"feet^2"===b||"foot^2"===b?l=h(a,e)+"' "+String.fromCharCode(178):"fractional-in"===b?l=i(a,e,!0):"fractional-in^2"===b?l=i(a,e,!0)+" "+String.fromCharCode(178):"m-and-cm"===b?l=j(a,e):"m-and-cm^2"===b?l=j(a,e)+" "+String.fromCharCode(178):3===c&&b?(b=b.replace("^2",String.fromCharCode(178)),b=b.replace("^3",String.fromCharCode(179)),l=h(a,e)+" "+b):l=b?a+" "+b:3===c?h(a,e):a:l="NaN"}catch(c){l=b?a+" "+b:a}return l}function e(a,b,c,d,e){if(c=c||1,a===b&&1==c)return d;var f=1;switch(b){case"mm":f=1e3;break;case"cm":f=100;break;case"m":f=1;break;case"in":f=39.37007874;break;case"ft":case"ft-and-fractional-in":case"ft-and-decimal-in":f=3.280839895;break;case"decimal-in":f=39.37007874;break;case"decimal-ft":f=3.280839895;break;case"fractional-in":f=39.37007874;break;case"m-and-cm":f=1}var g=1;switch(a){case"mm":g=.001;break;case"cm":g=.01;break;case"m":g=1;break;case"in":g=.0254;break;case"ft":case"ft-and-fractional-in":case"ft-and-decimal-in":g=.3048;break;case"decimal-in":g=.0254;break;case"decimal-ft":g=.3048;break;case"fractional-in":g=.0254;break;case"m-and-cm":g=1}return"square"===e?d*Math.pow(f*g*c,2):d*f*g*c}function f(a){if(!a)return 0;var b=a.toString().split(".")[1];if(!b){var c=a.toString().split("/")[1],d=c&&c.match(/\d+/);if(d){var e=parseFloat(d);if(e&&!isNaN(e))return Math.floor(Math.log2(e))}return 0}return(b=b.match(/\d+/))&&b[0]&&b[0].length||0}Object.defineProperty(b,"__esModule",{value:!0}),b.formatValueWithUnits=d,b.convertUnits=e,b.calculatePrecision=f;var g=c(35)},function(a,b){"use strict";function c(a,b,c,d){if(!a)return NaN;a=a.toString();var e=a.trim();if(0==e.length)return NaN;var f,g=c.join("| *"),h=d.join("| *");if(f=e.match(new RegExp("^([+-]?\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+h+") *$")))return parseFloat(f[1])/parseFloat(f[2])/b;if(f=e.match(new RegExp("^([+-]?\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+g+")? *$")))return parseFloat(f[1])/parseFloat(f[2]);var i=NaN;if(!(f=e.match(/^[+-]? *(?:\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?/i)))return NaN;if(i=parseFloat(f[0].replace(/ */g,"")),e=e.slice(f[0].length),e=e.replace("-"," "),0==e.length||isNaN(i))return i;var j=Math.sign(i);return 0===j&&(j=1),e.match(new RegExp("^(?: *)(?:"+h+") *$","i"))?i/b:(f=e.match(new RegExp("^ +(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+h+") *$","i")))?(i+j*parseFloat(f[1])/parseFloat(f[2]))/b:(f=e.match(new RegExp("^(?: *)(?:"+g+"|-| +-?) *","i")))?(e=e.slice(f[0].length).trim(),0==e.length?f[0].match(/-/)?NaN:i:(f=e.match(new RegExp("^(\\d+(?:\\.\\d*)?)(?: *)(?:"+h+")? *$")))?i+j*parseFloat(f[1])/b:(f=e.match(new RegExp("^(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+h+")? *$")))?i+j*(parseFloat(f[1])/parseFloat(f[2]))/b:(f=e.match(new RegExp("^(\\d+) +(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+h+")? *$")))?i+j*(parseFloat(f[1])+parseFloat(f[2])/parseFloat(f[3]))/b:NaN):NaN}Object.defineProperty(b,"__esModule",{value:!0});var d=b.UnitParser={};d.parseFeet=function(a){return c(a,12,["ft","feet","'","`","",""],["in","inch",'\\"',"''","``","",""])},d.parseMeter=function(a){return c(a,100,["m","meter"],["cm","centimeter"])},d.parseNumber=function(a,b){switch(b){case"ft":case"decimal-ft":case"ft-and-fractional-in":case"ft-and-decimal-in":case"decimal-in":case"fractional-in":return d.parseFeet(a);case"":case"m":case"cm":case"mm":case"m-and-cm":default:return d.parseMeter(a)}},d.parsePositiveNumber=function(a,b){var c=d.parseNumber(a,b);return c>=0?c:NaN}},function(a,b,c){"use strict";function d(a,b){if(!a)return null;if(a.isPerpendicular)return a.intersectPoint;switch(a.geomType){case J.SnapType.SNAP_VERTEX:case J.SnapType.SNAP_MIDPOINT:case J.SnapType.SNAP_CIRCLE_CENTER:return a.getGeometry();case J.SnapType.SNAP_EDGE:var c=t(a.getGeometry()),d=c[0].clone(),e=c[1].clone();return p(a.intersectPoint,d,e);case J.SnapType.SNAP_FACE:return w(a.intersectPoint,a.getGeometry().vertices[0],a.faceNormal);case J.SnapType.SNAP_CIRCULARARC:if(b&&b.model&&b.model.is2d()){var f=z(a.intersectPoint,a.getGeometry());return a.geomType=J.SnapType.SNAP_VERTEX,a.geomVertex=f,f}return a.circularArcCenter;case J.SnapType.SNAP_CURVEDEDGE:return z(a.intersectPoint,a.getGeometry());case J.SnapType.SNAP_CURVEDFACE:return a.intersectPoint;default:return null}}function e(a,b,c,e){if(!(a&&b&&a.getGeometry()&&b.getGeometry()))return!1;var f=d(a,c);if(e&&c)if(b.geomType===J.SnapType.SNAP_EDGE){var g=new I.Vector3,h=new I.Vector3,i=b.getGeometry();if(g.subVectors(b.intersectPoint,f).normalize(),h.subVectors(i.vertices[0],i.vertices[1]).normalize(),y(g,h,.05)){var j=q(f,i.vertices[0],i.vertices[1],!0);if(j)return e.onMouseMove(n(j,c))&&e.setPerpendicular(!0),b.geomVertex=j,b.intersectPoint=j,!0}}else if(b.geomType===J.SnapType.SNAP_FACE){var k=new I.Vector3,l=b.getGeometry();if(k.subVectors(b.intersectPoint,f).normalize(),x(b.faceNormal,k,.05)){var j=w(f,l.vertices[0],b.faceNormal);return e.onMouseMove(n(j,c))&&e.setPerpendicular(!0),b.geomVertex=j,b.intersectPoint=j,!0}}}function f(a,b,c,e){if(!(a&&b&&a.getGeometry()&&b.getGeometry()))return null;var f=d(a,e),g=d(b,e);if(!f||!g)return null;if(r(f,g,M))return null;var h,i,j,k;if(e.model.is2d()&&(f=f.clone(),g=g.clone(),e.model.pageToModel(f,g,a.viewportIndex2d)),c){var l=Math.log(2*c)/Math.log(10),m=Math.floor(l);1<2*c/Math.pow(10,m)&&m++,c=Math.pow(10,m);var n=f.distanceTo(g),o=n/c;return h=Math.floor(o+.5)*c,n=Math.abs(f.x-g.x),o=n/c,i=Math.floor(o+.5)*c,n=Math.abs(f.y-g.y),o=n/c,j=Math.floor(o+.5)*c,{distanceXYZ:h,distanceX:i,distanceY:j,distanceZ:0,type:K.MeasurementTypes.MEASUREMENT_DISTANCE}}return h=f.distanceTo(g),i=Math.abs(f.x-g.x),j=Math.abs(f.y-g.y),k=Math.abs(f.z-g.z),{distanceXYZ:h,distanceX:i,distanceY:j,distanceZ:k,type:K.MeasurementTypes.MEASUREMENT_DISTANCE}}function g(a,b){if(a.is3d())return 0;var c=a.getMetadata("page_dimensions","page_width",null),d=a.getMetadata("page_dimensions","logical_width",null),e=a.getMetadata("page_dimensions","page_height",null),f=a.getMetadata("page_dimensions","logical_height",null);if(!(c&&d&&e&&f))return 0;var g=c/d,h=e/f,i=new I.Vector3(0,0,0),j=new I.Vector3(g,h,0);return a.pageToModel(i,j,b),i.distanceTo(j)}function h(a){for(var b=0;b<a.length;b++)for(var c=0;c<a.length;c++)if(b!==c&&r(a[b],a[c],M))return!0;return!1}function i(a,b){var c=[];for(var e in a)if(a.hasOwnProperty(e)){var f=d(a[e],b);f&&c.push(f)}if(3!==c.length||h(c))return null;var g=new I.Vector3,i=new I.Vector3;return g.subVectors(c[0],c[1]),i.subVectors(c[2],c[1]),u(g,i)}function j(a,b){var c=[];for(var e in a)if(a.hasOwnProperty(e)){var f=d(a[e],b);f&&c.push(f.clone())}var g=d(a[1],b);g&&c.push(g.clone());for(var h=0;h<c.length;h+=2)b.model.pageToModel(c[h],c[h+1],a[1].viewportIndex2d);for(var i=0,j=0,h=0;h<c.length-1;h++)i+=c[h].x*c[h+1].y,j+=c[h].y*c[h+1].x;return Math.abs((i-j)/2)}function k(a,b,c){switch(b){case K.MeasurementTypes.MEASUREMENT_DISTANCE:var d=a[1];return f(d,a[2],g(c.model,d.viewportIndex2d),c);case K.MeasurementTypes.MEASUREMENT_ANGLE:var e=i(a,c);return e?{angle:e,type:b}:null;case K.MeasurementTypes.MEASUREMENT_AREA:return{area:j(a,c),type:b};default:return null}}function l(a,b,c,d,e,f){for(var g=0,h=c.vertices,i=new I.Vector3,j=new I.Vector3,k=0;k<h.length;k+=3)i.subVectors(h[k+1],h[k]),j.subVectors(h[k+2],h[k]),g+=i.length()*j.length()*Math.sin(i.angleTo(j))/2;return g=(0,L.convertUnits)(a.model.getUnitString(),d,f,g,"square"),d?(0,L.formatValueWithUnits)(g,d+"^2",3,e):(0,L.formatValueWithUnits)(g,null,3,e)}function m(a,b,c,d,e,f){var g=c.radius;if(g){if(a.model.is2d()){var h=c.center.clone(),i=c.vertices[0].clone();a.model.pageToModel(h,i,b.getPick(1).viewportIndex2d),g=h.distanceTo(i)}return g=(0,L.convertUnits)(a.model.getUnitString(),d,f,g),(0,L.formatValueWithUnits)(g,d,3,e)}}function n(a,b,c){var d=b.navigation.getCamera(),e=b.navigation.getScreenViewport(),f=new I.Vector3(a.x,a.y,a.z);return f=f.project(d),c=c||0,new I.Vector2(Math.round((f.x+1)/2*e.width)+c,Math.round((1-f.y)/2*e.height)+c)}function o(a,b){var c=b.navigation.getCamera(),d=b.navigation.getScreenViewport(),e=new I.Vector3;return e.x=a.x/d.width*2-1,e.y=-(a.y/d.height*2-1),e.z=0,e=e.unproject(c)}function p(a,b,c){var d,e=new I.Vector3,f=new I.Vector3;return e.subVectors(b,a),f.subVectors(c,b),d=e.dot(f),e.subVectors(c,b),d=-d/e.dot(e),e.subVectors(c,b),e.multiplyScalar(d),e.add(b)}function q(a,b,c,d){var e,f,g=new I.Vector3,h=new I.Vector3;return g.subVectors(b,a),h.subVectors(c,b),f=g.dot(h),g.subVectors(c,b),f=-f/g.dot(g),f<0?e=d?null:b:f>1?e=d?null:c:(g.subVectors(c,b),g.multiplyScalar(f),e=g.add(b)),e}function r(a,b,c){return!(!a||!b)&&(Math.abs(a.x-b.x)<=c&&Math.abs(a.y-b.y)<=c&&Math.abs(a.z-b.z)<=c)}function s(a,b,c){return Math.abs(a.x+b.x)<=c&&Math.abs(a.y+b.y)<=c&&Math.abs(a.z+b.z)<=c}function t(a){for(var b=a.vertices,c=[],d=0;d<b.length;++d){for(var e=!1,f=0;f<b.length;++f)if(f!==d&&b[f].equals(b[d])){e=!0;break}e||c.push(b[d])}return c}function u(a,b){return 180*a.angleTo(b)/Math.PI}function v(a,b,c,d){var e=new I.Vector3,f=new I.Vector3,g=new I.Vector3;e.subVectors(b,a),f.subVectors(d,c),g.subVectors(a,c);var h,i,j,k,l=e.dot(e),m=e.dot(f),n=f.dot(f),o=e.dot(g),p=f.dot(g),q=l*n-m*m,r=q,s=q;return q<M?(i=0,r=1,k=p,s=n):(i=m*p-n*o,k=l*p-m*o,i<0?(i=0,k=p,s=n):i>r&&(i=r,k=p+m,s=n)),k<0?(k=0,-o<0?i=0:-o>l?i=r:(i=-o,r=l)):k>s&&(k=s,-o+m<0?i=0:-o+m>l?i=r:(i=-o+m,r=l)),h=Math.abs(i)<M?0:i/r,j=Math.abs(k)<M?0:k/s,e.multiplyScalar(h),f.multiplyScalar(j),g.add(e),g.sub(f),e.add(a),f.add(c),[e,f]}function w(a,b,c){var d=new I.Vector3,e=c.clone(),f=new I.Vector3;f.subVectors(a,b);var g=-e.dot(f),h=e.dot(e),i=g/h;return d.addVectors(a,e.multiplyScalar(i)),d}function x(a,b,c){return c=c||M,1-Math.abs(a.dot(b))<c}function y(a,b,c){return c=c||M,Math.abs(a.dot(b))<c}function z(a,b){for(var c,d=Number.MAX_VALUE,e=0;e<b.vertices.length;e++){var f=a.distanceTo(b.vertices[e]);d>f&&(c=b.vertices[e],d=f)}return c}function A(a,b){if(a)for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];d&&b(d)}}function B(a,b){a.impl.overlayScenes[b]||a.impl.createOverlayScene(b)}function C(a,b,c){(a.classList.contains(b)&&!c||!a.classList.contains(b)&&c)&&a.classList.toggle(b,c)}function D(a){for(var b=new I.Vector3,c=a.length,d=0;d<c;d++)b.add(a[d]);return b.multiplyScalar(1/c),b}function E(a,b,c,d){var e=new I.Vector3,f=new I.Vector3,g=new I.Vector3,h=new I.Vector3;if(e.subVectors(b,a),f.subVectors(d,c),g.crossVectors(e,f),Math.abs(g.z)<M)return!1;var i=h.subVectors(c,a).cross(f).z/g.z,j=h.subVectors(c,a).cross(e).z/g.z;return!(Math.abs(g.z)<M)&&0<=i&&i<=1&&0<=j&&j<=1}function F(a){var b=a.length;if(3===b)return!0;for(var c=0;c<b;c++)for(var d=a[c],e=a[(c+1)%b],f=c+2;f<b;f++){var g=a[f%b],h=a[(f+1)%b];if(h===d)break;if(E(d,e,g,h))return!1}return!0}function G(a){function b(a,b){return b.max-a.max}function c(a,b,c,e){this.x=a,this.y=b,this.h=c,this.d=d(a,b,e),this.max=this.d+this.h*Math.SQRT2}function d(a,b,c){for(var d=!1,f=1/0,g=0;g<c.length;g++)for(var h=c[g],i=0,j=h.length,k=j-1;i<j;k=i++){var l=h[i],m=h[k];l.y>b!=m.y>b&&a<(m.x-l.x)*(b-l.y)/(m.y-l.y)+l.x&&(d=!d),f=Math.min(f,e(a,b,l,m))}return(d?1:-1)*Math.sqrt(f)}function e(a,b,c,d){var e=c.x,f=c.y,g=d.x-e,h=d.y-f;if(0!==g||0!==h){var i=((a-e)*g+(b-f)*h)/(g*g+h*h);i>1?(e=d.x,f=d.y):i>0&&(e+=g*i,f+=h*i)}return g=a-e,h=b-f,g*g+h*h}function f(a,b){function c(a,b){return a<b?-1:a>b?1:0}if(!(this instanceof f))return new f(a,b);if(this.data=a||[],this.length=this.data.length,this.compare=b||c,this.length>0)for(var d=this.length>>1;d>=0;d--)this._down(d)}if(f.prototype={push:function(a){this.data.push(a),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var a=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),a}},peek:function(){return this.data[0]},_up:function(a){for(var b=this.data,c=this.compare,d=b[a];a>0;){var e=a-1>>1,f=b[e];if(c(d,f)>=0)break;b[a]=f,a=e}b[a]=d},_down:function(a){for(var b=this.data,c=this.compare,d=this.length>>1,e=b[a];a<d;){var f=1+(a<<1),g=f+1,h=b[f];if(g<this.length&&c(b[g],h)<0&&(f=g,h=b[g]),c(h,e)>=0)break;b[a]=h,a=f}b[a]=e}},3===a.length)return D(a);a=[a];for(var g,h,i,j,k=0;k<a[0].length;k++){var l=a[0][k];(!k||l.x<g)&&(g=l.x),(!k||l.y<h)&&(h=l.y),(!k||l.x>i)&&(i=l.x),(!k||l.y>j)&&(j=l.y)}var m=i-g,n=j-h,o=Math.min(m,n),p=o/2,q=new f(null,b);if(0===o)return[g,h];for(var r=g;r<i;r+=o)for(var s=h;s<j;s+=o)q.push(new c(r+p,s+p,p,a));var t=function(a){for(var b=0,d=0,e=0,f=a[0],g=0,h=f.length,i=h-1;g<h;i=g++){var j=f[g],k=f[i],l=j.x*k.y-k.x*j.y;d+=(j.x+k.x)*l,e+=(j.y+k.y)*l,b+=3*l}return 0===b?new c(f[0].x,f[0].y,0,a):new c(d/b,e/b,0,a)}(a),u=new c(g+m/2,h+n/2,0,a);for(u.d>t.d&&(t=u);q.length;){var v=q.pop();v.d>t.d&&(t=v),v.max-t.d<=.01||(p=v.h/2,q.push(new c(v.x-p,v.y-p,p,a)),q.push(new c(v.x+p,v.y-p,p,a)),q.push(new c(v.x-p,v.y+p,p,a)),q.push(new c(v.x+p,v.y+p,p,a)))}return{x:t.x,y:t.y}}Object.defineProperty(b,"__esModule",{value:!0}),b.EPSILON=void 0,b.getSnapResultPosition=d,b.correctPerpendicularPicks=e,b.calculateDistance=f,b.computeResult=k,b.getFaceArea=l,b.getCircularArcRadius=m,b.project=n,b.inverseProject=o,b.nearestPointInPointToLine=p,b.nearestPointInPointToSegment=q,b.isEqualVectors=r,b.isInverseVectors=s,b.getEndPointsInEdge=t,b.angleVectorToVector=u,b.nearestPointsInSegmentToSegment=v,b.isParallel=x,b.isPerpendicular=y,b.forAll=A,b.createCommonOverlay=B,b.safeToggle=C,b.getCentroidOfPolygon=D,b.isPolygonSimple=F,b.getPolygonVisualCenter=G;var H=c(2),I=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(H),J=c(238),K=c(239),L=c(235),M=b.EPSILON=1e-4},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.SnapType={SNAP_VERTEX:0,SNAP_MIDPOINT:1,SNAP_CIRCLE_CENTER:2,SNAP_EDGE:3,SNAP_FACE:4,SNAP_CIRCULARARC:5,SNAP_CURVEDEDGE:6,SNAP_CURVEDFACE:7}},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.MeasurementTypes={MEASUREMENT_DISTANCE:1,MEASUREMENT_ANGLE:2,MEASUREMENT_AREA:3,CALIBRATION:4}},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.MeasureEvents={MEASUREMENT_CHANGED_EVENT:"measurement-changed",UNITS_CALIBRATION_STARTS_EVENT:"units_calibration_starts_event"}},function(a,b,c){"use strict";function d(a,b){this.measurementType=a,this.id=b,this.picks=[],this.closedArea=!1,this.resetMeasureValues()}Object.defineProperty(b,"__esModule",{value:!0}),b.Measurement=d;var e=c(242),f=c(239),g=c(237);d.prototype.resetMeasureValues=function(){this.angle=0,this.distanceX=0,this.distanceY=0,this.distanceZ=0,this.distanceXYZ=0,this.result=null},d.prototype.setPick=function(a,b){var c=this.picks[a]=b;return c.id=parseInt(a),c},d.prototype.getPick=function(a){var b=this.picks[a];return b||(b=this.setPick(a,new e.SnapResult)),b},d.prototype.countPicks=function(){return Object.keys(this.picks).length},d.prototype.getMaxNumberOfPicks=function(){switch(this.measurementType){case f.MeasurementTypes.MEASUREMENT_DISTANCE:return 2;case f.MeasurementTypes.MEASUREMENT_ANGLE:return 3;case f.MeasurementTypes.MEASUREMENT_AREA:return this.closedArea?this.countPicks():Number.MAX_VALUE-1}},d.prototype.hasPick=function(a){return this.picks[a]&&!this.picks[a].isEmpty()},d.prototype.isComplete=function(){var a=this.countPicks()===this.getMaxNumberOfPicks();for(var b in this.picks)if(this.picks.hasOwnProperty(b)&&!(a=a&&this.hasPick(b)))break;return a},d.prototype.isEmpty=function(){var a=!0;for(var b in this.picks)if(this.picks.hasOwnProperty(b)&&!(a=a&&!this.hasPick(b)))break;return a},d.prototype.clearPick=function(a){this.picks[a]&&this.picks[a].clear(),this.resetMeasureValues()},d.prototype.clearAllPicks=function(){for(var a in this.picks)this.picks.hasOwnProperty(a)&&this.clearPick(a)},d.prototype.hasEqualPicks=function(a,b){if(!a||!b)return!1;if(a.geomType===b.geomType){var c=(0,g.getSnapResultPosition)(a),d=(0,g.getSnapResultPosition)(b);return(0,g.isEqualVectors)(c,d,g.EPSILON)}return!1},d.prototype.computeResult=function(a,b){if(this.resetMeasureValues(),!b.model)return this.result=null,!1;var c=this.result=(0,g.computeResult)(a,this.measurementType,b);if(null===c)return!this.isComplete();switch(c.type){case f.MeasurementTypes.MEASUREMENT_DISTANCE:return this.distanceXYZ=c.distanceXYZ,this.distanceX=c.distanceX,this.distanceY=c.distanceY,this.distanceZ=c.distanceZ,!0;case f.MeasurementTypes.MEASUREMENT_ANGLE:return this.angle=isNaN(c.angle)?0:c.angle,!0;case f.MeasurementTypes.MEASUREMENT_AREA:return this.area=c.area,!0;default:return!1}},d.prototype.getGeometry=function(a){return{type:this.picks[a].geomType,geometry:this.picks[a].getGeometry()}},d.prototype.attachIndicator=function(a,b,c){this.indicator=new c(a,this,b),this.indicator.init()}},function(a,b,c){"use strict";function d(){this.clear()}Object.defineProperty(b,"__esModule",{value:!0}),b.SnapResult=d;var e=c(238);d.prototype.clear=function(){this.geomType=null,this.snapNode=null,this.geomVertex=null,this.geomEdge=null,this.geomFace=null,this.radius=null,this.intersectPoint=null,this.faceNormal=null,this.viewportIndex2d=null,this.circularArcCenter=null,this.circularArcRadius=null,this.fromTopology=!1,this.isPerpendicular=!1},d.prototype.copyTo=function(a){a.snapNode=this.snapNode,a.geomVertex=this.geomVertex,a.geomFace=this.geomFace,a.geomEdge=this.geomEdge,a.radius=this.radius,a.geomType=this.geomType,a.intersectPoint=this.intersectPoint,a.faceNormal=this.faceNormal,a.viewportIndex2d=this.viewportIndex2d,a.circularArcCenter=this.circularArcCenter,a.circularArcRadius=this.circularArcRadius,a.fromTopology=this.fromTopology,a.isPerpendicular=this.isPerpendicular},d.prototype.clone=function(){var a=new d;return this.copyTo(a),a},d.prototype.isEmpty=function(){return!this.getGeometry()},d.prototype.getFace=function(){return this.geomFace},d.prototype.getEdge=function(){return this.geomEdge},d.prototype.getVertex=function(){return this.geomVertex},d.prototype.getGeometry=function(){switch(this.geomType){case e.SnapType.SNAP_VERTEX:case e.SnapType.SNAP_MIDPOINT:case e.SnapType.SNAP_CIRCLE_CENTER:return this.geomVertex;case e.SnapType.SNAP_EDGE:return this.geomEdge;case e.SnapType.SNAP_FACE:return this.geomFace;case e.SnapType.SNAP_CIRCULARARC:case e.SnapType.SNAP_CURVEDEDGE:return this.geomEdge;case e.SnapType.SNAP_CURVEDFACE:return this.geomFace}return null},d.prototype.setGeometry=function(a,b){switch(a){case e.SnapType.SNAP_VERTEX:case e.SnapType.SNAP_MIDPOINT:case e.SnapType.SNAP_CIRCLE_CENTER:this.geomVertex=b;break;case e.SnapType.SNAP_EDGE:this.geomEdge=b;break;case e.SnapType.SNAP_FACE:this.geomFace=b;break;case e.SnapType.SNAP_CIRCULARARC:case e.SnapType.SNAP_CURVEDEDGE:this.geomEdge=b;break;case e.SnapType.SNAP_CURVEDFACE:this.geomFace=b;break;default:return}this.geomType=a}},function(a,b,c){"use strict";function d(a,b){return Math.abs(a-b)<=q}function e(a,b){return Math.abs(a.x-b.x)<=q&&Math.abs(a.y-b.y)<=q&&Math.abs(a.z-b.z)<=q}function f(a,b){return Math.abs(a.x+b.x)<=q&&Math.abs(a.y+b.y)<=q&&Math.abs(a.z+b.z)<=q}function g(a,b,c){var d,e,f=new j.Vector3,g=new j.Vector3;return f.subVectors(b,a),g.subVectors(c,b),e=f.dot(g),f.subVectors(c,b),e=-e/f.dot(f),e<0?d=a.distanceTo(b):e>1?d=a.distanceTo(c):(f.subVectors(a,b),g.subVectors(a,c),f.cross(g),g.subVectors(c,b),d=Math.sqrt(f.dot(f))/Math.sqrt(g.dot(g))),d}function h(a,b){function c(a,b,c){this.viewer=a,this.snapper=b,this.lineGeom=new j.Geometry,this.circularArc=null,this.circularArcCenter,this.circularArcRadius,this.ellipticalArc=null,this.ellipticalArcCenter,this.minDist=Number.MAX_VALUE,this.vpIdLine=null,this.vpIdCircular=null,this.vpIdElliptical=null,this.detectRadius=c}var h,i=new k.SnapResult,r=a,s=b||{};h=s.markupMode?["snapper-markup"]:["snapper"];var t=!1,u=Number.MAX_VALUE,v=null,w=!1,x=!1,y=!1,z=null;this.indicator=new l.SnapperIndicator(a,this),this.markupMode=s.markupMode,this.isActive=function(){return t},this.getNames=function(){return h},this.getName=function(){return h[0]},this.getPriority=function(){return 60},this.activate=function(){t=!0,this.indicator||(this.indicator=new l.SnapperIndicator(a,this))},this.deactivate=function(){t=!1,this.indicator&&(this.indicator.destroy(),this.indicator=null)},this.copyResults=function(a){i.copyTo(a)},this.getEdge=function(){return i.geomEdge},this.getVertex=function(){return i.geomVertex},this.getGeometry=function(){return i.getGeometry()},this.getGeometryType=function(){return i.geomType},this.getIntersectPoint=function(){return i.intersectPoint},this.getSnapResult=function(){return i},this.isSnapped=function(){return y},this.clearSnapped=function(){i.clear(),y=!1},this.setViewportId=function(a){z=a},this.snapping3D=function(a){if(i.snapNode=a.dbId,i.intersectPoint=a.intersectPoint,a.model){var b,c=a.face;b=a.fragId&&void 0!==a.fragId.length?a.fragId:[a.fragId],i.hasTopology=a.model.hasTopology(),i.hasTopology?this.snapping3DwithTopology(c,b,a.model):this.snapping3DtoMesh(c,b,a.model)}},this.snapping3DwithTopology=function(a,b,c){i.snapNode&&(b=[],c.getData().instanceTree.enumNodeFragments(i.snapNode,function(a){b.push(a)},!0)),i.geomFace=i.geomEdge=i.geomVertex=null,u=Number.MAX_VALUE;for(var d=0;d<b.length;++d){var e=b[d],f=r.impl.getRenderProxy(c,e),g=f.geometry,h=c.getTopoIndex(e),k=c.getTopology(h),l=k.faces,n=k.edges;if(!i.geomFace){i.geomFace=this.faceSnappingWithTopology(a,g,l,f),i.geomFace&&(i.geomFace.fragId=e);var o=(new j.Matrix3).getNormalMatrix(f.matrixWorld);i.faceNormal=a.normal.applyMatrix3(o).normalize()}this.edgeSnappingWithTopology(i.intersectPoint,g,n,f)}if(i.geomVertex=this.vertexSnappingWithTopology(i.geomEdge,i.intersectPoint),i.geomFace){if(i.radius=this.setDetectRadius(i.intersectPoint),(s.forceSnapVertices||v<i.radius)&&i.geomVertex)i.geomType=m.SnapType.SNAP_VERTEX;else if((s.forceSnapEdges||u<i.radius)&&i.geomEdge){var p=this.edgeIsCircle(i.geomEdge);p?(i.circularArcCenter=p,i.circularArcRadius=p.distanceTo(i.geomEdge.vertices[0]),i.geomEdge.center=i.circularArcCenter,i.geomEdge.radius=i.circularArcRadius,i.geomType=m.SnapType.SNAP_CIRCULARARC):this.edgeIsCurved(i.geomEdge)?i.geomType=m.SnapType.SNAP_CURVEDEDGE:i.geomType=m.SnapType.SNAP_EDGE}else this.faceIsCurved(i.geomFace)?i.geomType=m.SnapType.SNAP_CURVEDFACE:i.geomType=m.SnapType.SNAP_FACE;y=!0}},this.snapping3DtoMesh=function(a,b,c){for(var d=0;d<b.length;++d){var e=b[d],f=r.impl.getRenderProxy(c,e),g=f.geometry;if(i.geomFace=this.faceSnapping(a,g),i.geomFace){i.geomFace.applyMatrix(f.matrixWorld),i.geomEdge=this.edgeSnapping(i.geomFace,i.intersectPoint),i.geomVertex=this.vertexSnapping(i.geomEdge,i.intersectPoint);var h=(new j.Matrix3).getNormalMatrix(f.matrixWorld);i.faceNormal=a.normal.applyMatrix3(h).normalize(),i.radius=this.setDetectRadius(i.intersectPoint),s.forceSnapVertices||v<i.radius?i.geomType=m.SnapType.SNAP_VERTEX:s.forceSnapEdges||u<i.radius?i.geomType=m.SnapType.SNAP_EDGE:i.geomType=m.SnapType.SNAP_FACE,y=!0;break}}},this.faceSnappingWithTopology=function(a,b,c,d){var e=new j.Vector3,f=new j.Vector3,g=new j.Vector3,h=new j.Geometry,i=b.attributes;if(void 0!==i.index){for(var k=b.vb?b.vb:i.position.array,l=b.vb?b.vbstride:3,m=0;m<c.length;m++){for(var n=c[m].indexList,o=c[m].id,p=0;p<n.length;p+=3)if(a.a===n[p]){if(a.b===n[p+1]&&a.c===n[p+2]||a.b===n[p+2]&&a.c===n[p+1])break}else if(a.a===n[p+1]){if(a.b===n[p]&&a.c===n[p+2]||a.b===n[p+2]&&a.c===n[p])break}else if(a.a===n[p+2]&&(a.b===n[p]&&a.c===n[p+1]||a.b===n[p+1]&&a.c===n[p]))break;if(p<n.length)break}if(m<c.length)for(var p=0;p<n.length;p+=3){e.set(k[n[p]*l],k[n[p]*l+1],k[n[p]*l+2]),f.set(k[n[p+1]*l],k[n[p+1]*l+1],k[n[p+1]*l+2]),g.set(k[n[p+2]*l],k[n[p+2]*l+1],k[n[p+2]*l+2]);var q=h.vertices.length;h.vertices.push(e.clone()),h.vertices.push(f.clone()),h.vertices.push(g.clone()),h.faces.push(new j.Face3(q,q+1,q+2))}}return h.vertices.length>0?(h.faceId=o,h.applyMatrix(d.matrixWorld),h):null},this.faceSnapping=function(a,b){var c=new j.Vector3,f=new j.Vector3,g=new j.Vector3,h=new j.Geometry,i=b.attributes;if(void 0!==i.index){var k=i.index.array||b.ib,l=b.vb?b.vb:i.position.array,m=b.vb?b.vbstride:3,n=b.offsets;n&&0!==n.length||(n=[{start:0,count:k.length,index:0}]);for(var o=0;o<n.length;++o)for(var p=n[o].start,q=n[o].count,r=n[o].index,s=p;s<p+q;s+=3){var t=r+k[s],u=r+k[s+1],v=r+k[s+2];c.set(l[t*m],l[t*m+1],l[t*m+2]),f.set(l[u*m],l[u*m+1],l[u*m+2]),g.set(l[v*m],l[v*m+1],l[v*m+2]);var w=j.Triangle.normal(c,f,g),x=new j.Vector3;if(x.set(l[a.a*m],l[a.a*m+1],l[a.a*m+2]),e(w,a.normal)&&d(w.dot(c),a.normal.dot(x))){var y=h.vertices.length;h.vertices.push(c.clone()),h.vertices.push(f.clone()),h.vertices.push(g.clone()),h.faces.push(new j.Face3(y,y+1,y+2))}}}return h.vertices.length>0?this.getTrianglesOnSameFace(h,a,l,m):null},this.getTrianglesOnSameFace=function(a,b,c,d){var e=!1,f=a.vertices.slice(),g=new j.Vector3;g.set(c[b.a*d],c[b.a*d+1],c[b.a*d+2]);var h=new j.Vector3;h.set(c[b.b*d],c[b.b*d+1],c[b.b*d+2]);var i=new j.Vector3;i.set(c[b.c*d],c[b.c*d+1],c[b.c*d+2]);var k=new j.Geometry;k.vertices.push(g),k.vertices.push(h),k.vertices.push(i),k.faces.push(new j.Face3(0,1,2));var l=[];do{l=[];for(var m=0;m<f.length;m+=3)if(f[m].equals(g)&&f[m+1].equals(h)&&f[m+2].equals(i))e=!0,l.push(m);else for(var n=0;n<k.vertices.length;n+=3)if(this.trianglesSharedEdge(f[m],f[m+1],f[m+2],k.vertices[n],k.vertices[n+1],k.vertices[n+2])){var o=k.vertices.length;k.vertices.push(f[m].clone()),k.vertices.push(f[m+1].clone()),k.vertices.push(f[m+2].clone()),k.faces.push(new j.Face3(o,o+1,o+2)),l.push(m);break}for(var p=l.length-1;p>=0;--p)f.splice(l[p],3)}while(l.length>0);return e?k:null},this.trianglesSharedEdge=function(a,b,c,d,e,f){var g=!1,h=!1,i=!1;return(a.equals(d)||a.equals(e)||a.equals(f))&&(g=!0),(b.equals(d)||b.equals(e)||b.equals(f))&&(h=!0),(c.equals(d)||c.equals(e)||c.equals(f))&&(i=!0),!!(g&h||g&i||h&i)},this.edgeSnappingWithTopology=function(a,b,c,d){var e,f=new j.Geometry,h=Number.MAX_VALUE,k=new j.Vector3,l=new j.Vector3,m=b.attributes;if(void 0!==m.index&&void 0!=c){for(var n=b.vb?b.vb:m.position.array,o=b.vb?b.vbstride:3,p=0;p<c.length;p++)for(var q=c[p].indexList,r=0;r<q.length-1;r++){k.set(n[q[r]*o],n[q[r]*o+1],n[q[r]*o+2]),l.set(n[q[r+1]*o],n[q[r+1]*o+1],n[q[r+1]*o+2]),k.applyMatrix4(d.matrixWorld),l.applyMatrix4(d.matrixWorld);var s=g(a,k,l);s<h&&(h=s,e=p)}if(e){q=c[e].indexList;for(var t=0;t<q.length-1;t++)f.vertices.push(new j.Vector3(n[q[t]*o],n[q[t]*o+1],n[q[t]*o+2])),f.vertices.push(new j.Vector3(n[q[t+1]*o],n[q[t+1]*o+1],n[q[t+1]*o+2]))}}u>=h&&f.vertices.length>0&&(u=h,f.applyMatrix(d.matrixWorld),i.geomEdge=f)},this.edgeSnapping=function(a,b){for(var c=new j.Geometry,d=!0,e=!0,f=!0,h=0;h<a.vertices.length;h+=3){for(var i=0;i<a.vertices.length;i+=3)h!==i&&((a.vertices[h].equals(a.vertices[i])||a.vertices[h].equals(a.vertices[i+1])||a.vertices[h].equals(a.vertices[i+2]))&&(a.vertices[h+1].equals(a.vertices[i])||a.vertices[h+1].equals(a.vertices[i+1])||a.vertices[h+1].equals(a.vertices[i+2]))&&(d=!1),(a.vertices[h].equals(a.vertices[i])||a.vertices[h].equals(a.vertices[i+1])||a.vertices[h].equals(a.vertices[i+2]))&&(a.vertices[h+2].equals(a.vertices[i])||a.vertices[h+2].equals(a.vertices[i+1])||a.vertices[h+2].equals(a.vertices[i+2]))&&(e=!1),(a.vertices[h+1].equals(a.vertices[i])||a.vertices[h+1].equals(a.vertices[i+1])||a.vertices[h+1].equals(a.vertices[i+2]))&&(a.vertices[h+2].equals(a.vertices[i])||a.vertices[h+2].equals(a.vertices[i+1])||a.vertices[h+2].equals(a.vertices[i+2]))&&(f=!1));d&&(c.vertices.push(a.vertices[h].clone()),c.vertices.push(a.vertices[h+1].clone())),e&&(c.vertices.push(a.vertices[h].clone()),c.vertices.push(a.vertices[h+2].clone())),f&&(c.vertices.push(a.vertices[h+1].clone()),c.vertices.push(a.vertices[h+2].clone())),d=!0,e=!0,f=!0}for(var k,l=new j.Geometry,m=Number.MAX_VALUE,n=0;n<c.vertices.length;n+=2){var o=g(b,c.vertices[n],c.vertices[n+1]);o<m&&(m=o,k=n)}return l.vertices.push(c.vertices[k].clone()),l.vertices.push(c.vertices[k+1].clone()),l.vertices=this.getConnectedLineSegmentsOnSameLine(c,l.vertices),u=m,l},this.getConnectedLineSegmentsOnSameLine=function(a,b){var c=a.vertices.slice(),d=b[0],g=b[1],h=[];do{h=[];for(var i=0;i<c.length;i+=2)if(!c[i].equals(d)||!c[i+1].equals(g))for(var k=0;k<b.length;k+=2)if(c[i].equals(b[k])||c[i+1].equals(b[k])||c[i].equals(b[k+1])||c[i+1].equals(b[k+1])){var l=new j.Vector3,m=new j.Vector3;if(l.subVectors(b[k],b[k+1]),l.normalize(),m.subVectors(c[i],c[i+1]),m.normalize(),e(l,m)||f(l,m)){h.push(i);break}}for(var n=h.length-1;n>=0;--n)b.push(c[h[n]]),b.push(c[h[n]+1]),c.splice(h[n],2)}while(h.length>0);return b},this.vertexSnappingWithTopology=function(a,b){var c=Number.MAX_VALUE,d=new j.Vector3;if(a&&a.vertices.length>1){var e=b.distanceTo(a.vertices[0]),f=b.distanceTo(a.vertices[a.vertices.length-1]);e<=f?(c=e,d=a.vertices[0].clone()):(c=f,d=a.vertices[a.vertices.length-1].clone())}return v=c,d},this.vertexSnapping=function(a,b){for(var c=Number.MAX_VALUE,d=new j.Vector3,e=0;e<a.vertices.length;++e){var f=b.distanceTo(a.vertices[e]);f<c-q&&(c=f,d=a.vertices[e].clone())}return v=c,d},this.edgeIsCircle=function(a){var b=a.vertices;if(b.length<8)return!1;if(b[0].equals(b[b.length-1])){for(var c=new j.Vector3(0,0,0),d=0;d<b.length;d+=2)c.add(b[d]);c.divideScalar(b.length/2);for(var e=c.distanceTo(b[0]),d=0;d<b.length;d+=2)if(!(Math.abs(c.distanceTo(b[d])-e)<=q))return!1;return c}return!1},this.edgeIsCurved=function(a){var b=a.vertices;if(b.length<=2)return!1;if(b[0].equals(b[b.length-1]))return!0;var c=new j.Vector3;c.subVectors(b[0],b[1]);for(var d=new j.Vector3,f=2;f<b.length;f+=2)if(d.subVectors(b[f],b[f+1]),!e(c,d))return!0;return!1},this.faceIsCurved=function(a){var b=a.vertices,c=a.faces;if(c.length<=1)return!1;for(var f=j.Triangle.normal(b[c[0].a],b[c[0].b],b[c[0].c]),g=b[c[0].a],h=1;h<c.length;h++){var i=j.Triangle.normal(b[c[h].a],b[c[h].b],b[c[h].c]),k=b[c[h].a];if(!e(f,i)||!d(f.dot(g),i.dot(k)))return!0}return!1},this.angleVector2=function(a){return a.x>0&&a.y>=0?Math.atan(a.y/a.x):a.x>=0&&a.y<0?Math.atan(a.y/a.x)+2*Math.PI:a.x<0&&a.y<=0?Math.atan(a.y/a.x)+Math.PI:a.x<=0&&a.y>0?Math.atan(a.y/a.x)+Math.PI:null},c.prototype.onLineSegment=function(a,b,c,d,e){var f=this.snapper.getIntersectPoint(),h=this.lineGeom.vertices,i=new j.Vector3(a,b,f.z),k=new j.Vector3(c,d,f.z),l=g(f,i,k);l<=this.detectRadius&&l<this.minDist&&(h.splice(0,2,i,k),this.minDist=l,this.vpIdLine=e)},c.prototype.onCircularArc=function(a,b,c,d,e,f){var g=this.snapper.getIntersectPoint(),h=new j.Vector2(g.x,g.y),i=new j.Vector2(a,b),k=h.distanceTo(i);h.sub(i);var l=this.snapper.angleVector2(h);if(Math.abs(k-e)<=this.detectRadius){if(d>c&&l>=c&&l<=d)var m=new j.CircleGeometry(e,100,c,d-c);else{if(!(d<c&&(l>=c||l<=d)))return;var m=new j.CircleGeometry(e,100,c,2*Math.PI-c+d)}
m.vertices.splice(0,1),m.applyMatrix((new j.Matrix4).makeTranslation(a,b,g.z)),this.circularArc=m,this.circularArcCenter=new j.Vector3(a,b,g.z),this.circularArcRadius=e,this.vpIdCircular=f}},c.prototype.onEllipticalArc=function(a,b,c,e,f,g,h,i){var k=this.snapper.getIntersectPoint(),l=new j.Vector2(k.x,k.y),m=f-this.detectRadius,n=g-this.detectRadius,o=f+this.detectRadius,p=g+this.detectRadius,q=(l.x-a)*(l.x-a)/(m*m)+(l.y-b)*(l.y-b)/(n*n),r=(l.x-a)*(l.x-a)/(o*o)+(l.y-b)*(l.y-b)/(p*p),s=new j.Vector2(a,b);l.sub(s),l.x*=g,l.y*=f;var t=this.snapper.angleVector2(l);if(e>2*Math.PI&&(e=2*Math.PI),q>=1&&r<=1&&(e>c&&t>=c&&t<=e||e<c&&(t>=c||t<=e))){var u=new j.EllipseCurve(a,b,f,g,c,e,!1),v=new j.Path(u.getPoints(50)),w=v.createPointsGeometry(50);d(e-c,2*Math.PI)||w.vertices.pop(),w.applyMatrix((new j.Matrix4).makeTranslation(0,0,k.z)),this.ellipticalArc=w,this.ellipticalArcCenter=new j.Vector3(a,b,k.z),this.vpIdElliptical=i}},this.snapping2D=function(a){if(a){var b=a.intersectPoint,d=a.fragId;if(void 0!==d){Array.isArray(d)||(d=[d]),i.hasTopology=!1,i.intersectPoint=b,i.radius=this.setDetectRadius(b);if(!(null!=r.model.getFragmentList()))return y=!0,i.geomType=m.SnapType.SNAP_VERTEX,void(i.geomVertex=b);for(var e=new c(r,this,i.radius),f=0;f<d.length;++f){var g=r.impl.getRenderProxy(r.model,d[f]);if(g&&g.geometry){new o.VertexBufferReader(g.geometry,r.impl.use2dInstancing).enumGeomsForObject(a.dbId,e)}}if(e.circularArc){if(i.viewportIndex2d=e.vpIdCircular,null!==z&&z!==i.viewportIndex2d)return;b.distanceTo(e.circularArc.vertices[0])<i.radius?(i.geomVertex=e.circularArc.vertices[0],i.geomType=m.SnapType.SNAP_VERTEX):b.distanceTo(e.circularArc.vertices[e.circularArc.vertices.length-1])<i.radius?(i.geomVertex=e.circularArc.vertices[e.circularArc.vertices.length-1],i.geomType=m.SnapType.SNAP_VERTEX):(this.lineStripToPieces(e.circularArc),i.geomEdge=e.circularArc,i.circularArcCenter=e.circularArcCenter,i.circularArcRadius=e.circularArcRadius,i.geomType=m.SnapType.SNAP_CIRCULARARC),y=!0}else if(e.ellipticalArc){if(i.viewportIndex2d=e.vpIdElliptical,null!==z&&z!==i.viewportIndex2d)return;b.distanceTo(e.ellipticalArc.vertices[0])<i.radius?(i.geomVertex=e.ellipticalArc.vertices[0],i.geomType=m.SnapType.SNAP_VERTEX):b.distanceTo(e.ellipticalArc.vertices[e.ellipticalArc.vertices.length-1])<i.radius?(i.geomVertex=e.ellipticalArc.vertices[e.ellipticalArc.vertices.length-1],i.geomType=m.SnapType.SNAP_VERTEX):(this.lineStripToPieces(e.ellipticalArc),i.geomEdge=e.ellipticalArc,i.circularArcCenter=e.ellipticalArcCenter,i.circularArcRadius=null,i.geomType=m.SnapType.SNAP_CIRCULARARC),y=!0}else if(e.lineGeom.vertices.length){if(i.viewportIndex2d=e.vpIdLine,null!==z&&z!==i.viewportIndex2d)return;if(this.markupMode){var h=e.lineGeom.vertices[0],k=e.lineGeom.vertices[1],l=new j.Vector3;l.addVectors(h,k),l.divideScalar(2);var n=b.distanceTo(l),q=b.distanceTo(h),t=b.distanceTo(k);i.geomEdge=e.lineGeom,n<i.radius?(i.geomVertex=l,i.geomType=m.SnapType.SNAP_VERTEX):q<i.radius?(i.geomVertex=h,i.geomType=m.SnapType.SNAP_VERTEX):t<i.radius?(i.geomVertex=k,i.geomType=m.SnapType.SNAP_VERTEX):i.geomType=m.SnapType.SNAP_EDGE,e.lineGeom.vertices[0].distanceTo(e.lineGeom.vertices[1])<p.EPSILON&&(i.geomType=m.SnapType.SNAP_CIRCLE_CENTER)}else b.distanceTo(e.lineGeom.vertices[0])<i.radius?(e.lineGeom.vertices[0].distanceTo(e.lineGeom.vertices[1])<p.EPSILON?i.geomType=m.SnapType.SNAP_CIRCLE_CENTER:i.geomType=m.SnapType.SNAP_VERTEX,i.geomVertex=e.lineGeom.vertices[0]):s.forceSnapVertices||b.distanceTo(e.lineGeom.vertices[1])<i.radius?(i.geomVertex=e.lineGeom.vertices[1],i.geomType=m.SnapType.SNAP_VERTEX):(i.geomEdge=e.lineGeom,i.geomType=m.SnapType.SNAP_EDGE);y=!0}}}},this.snappingLeaflet=function(a){if(a){var b=a.intersectPoint;i.intersectPoint=b,i.hasTopology=!1,i.radius=this.setDetectRadius(b),i.geomType=m.SnapType.SNAP_VERTEX,i.geomVertex=b,y=!0}},this.snapMidpoint=function(){if(i.isMidpoint=!1,y&&i.geomType===m.SnapType.SNAP_EDGE){var a=i.geomEdge,b=a.vertices[0],c=a.vertices[1],d=new j.Vector3((b.x+c.x)/2,(b.y+c.y)/2,(b.z+c.z)/2);i.intersectPoint.distanceTo(d)<2*i.radius&&(i.geomVertex=d,i.geomType=m.SnapType.SNAP_MIDPOINT)}},this.setPerpendicular=function(a){i.isPerpendicular=a},this.lineStripToPieces=function(a){for(var b=a.vertices,c=b.length-2;c>0;c--)b.splice(c,0,b[c])},this.setDetectRadius=function(a){var b=(0,n.isMobileDevice)()?50:10,c=r.navigation,d=c.getCamera(),e=c.getPosition(),f=a.clone(),g=d.isPerspective?f.sub(e).length():c.getEyeVector().length(),h=c.getVerticalFov(),i=2*g*Math.tan(j.Math.degToRad(.5*h)),k=c.getScreenViewport(),l=window.devicePixelRatio||1;return b*i/(k.height*l)},this.handleButtonDown=function(a,b){return w=!0,!1},this.handleButtonUp=function(a,b){return w=!1,!1},this.handleMouseMove=function(a){return!w&&(this.onMouseMove({x:a.canvasX,y:a.canvasY}),!1)},this.handleSingleTap=function(a){return this.handleMouseMove(a)},this.handlePressHold=function(a){if((0,n.isMobileDevice)())switch(a.type){case"press":x=!0,this.onMouseMove({x:a.canvasX,y:a.canvasY});break;case"pressup":this.onMouseMove({x:a.canvasX,y:a.canvasY}),x=!1}return!1},this.handleGesture=function(a){if((0,n.isMobileDevice)()&&x)switch(a.type){case"dragstart":case"dragmove":this.onMouseMove({x:a.canvasX,y:a.canvasY});break;case"dragend":this.onMouseMove({x:a.canvasX,y:a.canvasY}),x=!1}return!1},this.onMouseDown=function(a){return this.onMouseMove(a)},this.onMouseMove=function(a){this.clearSnapped();var b=r.impl.snappingHitTest(a.x,a.y,!1);return!(!b||!b.intersectPoint)&&(b.face?this.snapping3D(b):b.dbId||0===b.dbId?this.snapping2D(b):this.snappingLeaflet(b),this.snapMidpoint(),!0)}}Object.defineProperty(b,"__esModule",{value:!0}),b.Snapper=h;var i=c(2),j=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(i),k=c(242),l=c(244),m=c(238),n=c(4),o=c(181),p=c(237),q=.001},function(a,b,c){"use strict";function d(a,b){this.viewer=a,this.snapper=b,this.overlayType=i,this.previewsIntersectPoint=null,this.viewer.impl.createOverlayScene(j),this.viewer.impl.createOverlayScene(k),this.geometryMaterial=new g.MeshPhongMaterial({color:n,ambient:n,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:g.DoubleSide}),this.indicatorMaterial=new g.MeshBasicMaterial({color:m,ambient:m,opacity:1,transparent:!1,depthTest:!1,depthWrite:!1,side:g.DoubleSide})}Object.defineProperty(b,"__esModule",{value:!0}),b.SnapperIndicator=d;var e=c(237),f=c(2),g=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(f),h=c(238),i=0,j="MeasureTool-snapper-geometries",k="MeasureTool-snapper-indicator",l=null,m=16742144,n=52224;d.prototype.constructor=d;var o=d.prototype;o.render=function(){var a=this.snapper.getSnapResult();(0,e.isEqualVectors)(this.previewsIntersectPoint,a.intersectPoint,e.EPSILON)||this.clearOverlay(j),this.clearOverlay(k),a.isEmpty()||(this.renderIndicator(a),this.previewsIntersectPoint=a.intersectPoint.clone())},o.removeOverlay=function(a){this.viewer.impl.clearOverlay(a),this.viewer.impl.removeOverlayScene(a)},o.clearOverlay=function(a){this.removeOverlay(a),this.viewer.impl.createOverlayScene(a)},o.clearOverlays=function(){this.removeOverlay(j),this.viewer.impl.createOverlayScene(j),this.removeOverlay(k),this.viewer.impl.createOverlayScene(k),this.previewsIntersectPoint=null},o.addOverlay=function(a,b){this.viewer.impl.addOverlay(a,b)},o.drawFace=function(a,b,c){var d=new g.Mesh(a,b,!0);c===j&&(this.overlayType=1),this.addOverlay(c,d)},o.cylinderMesh=function(a,b,c,d){var e=(new g.Vector3).subVectors(b,a),f=new g.Matrix4;f.lookAt(a,b,(new g.Object3D).up),f.multiply((new g.Matrix4).set(1,0,0,0,0,0,1,0,0,-e.length(),0,0,0,0,0,1)),d=d||.5;var h=new g.CylinderGeometry(d,d,1,8,1,!0),i=new g.Mesh(h,c);return h=null,i.applyMatrix(f),i.position.x=(b.x+a.x)/2,i.position.y=(b.y+a.y)/2,i.position.z=(b.z+a.z)/2,i},o.renderGeometry=function(a){if(!(0,e.isEqualVectors)(this.previewsIntersectPoint,a.intersectPoint,e.EPSILON))switch(a.geomType){case h.SnapType.SNAP_VERTEX:this.drawPoint(a.geomVertex,this.geometryMaterial,j);break;case h.SnapType.SNAP_EDGE:case h.SnapType.SNAP_CURVEDEDGE:case h.SnapType.SNAP_CIRCULARARC:case h.SnapType.SNAP_MIDPOINT:this.drawLine(a.geomEdge,this.geometryMaterial,.3,j);break;case h.SnapType.SNAP_FACE:case h.SnapType.SNAP_CURVEDFACE:this.drawFace(a.geomFace,this.geometryMaterial,j)}},o.renderVertexIndicator=function(a){var b=(0,e.getSnapResultPosition)(a,this.viewer),c=this.setScale(b),d=1.2*c,f=this.viewer.navigation.getCameraRightVector().multiplyScalar(d),h=this.viewer.navigation.getCameraUpVector().multiplyScalar(d),i=new g.Geometry,j=new g.Vector3;j.addVectors(b,f),j.addVectors(j,h),i.vertices[0]=j.clone(),j.subVectors(b,f),j.addVectors(j,h),i.vertices[1]=j.clone(),this.drawLine(i,this.indicatorMaterial,.2,k),j.addVectors(b,f),j.subVectors(j,h),i.vertices[0]=j.clone(),j.subVectors(b,f),j.subVectors(j,h),i.vertices[1]=j.clone(),this.drawLine(i,this.indicatorMaterial,.2,k),j.subVectors(b,f),j.subVectors(j,h),i.vertices[0]=j.clone(),j.subVectors(b,f),j.addVectors(j,h),i.vertices[1]=j.clone(),this.drawLine(i,this.indicatorMaterial,.2,k),j.addVectors(b,f),j.subVectors(j,h),i.vertices[0]=j.clone(),j.addVectors(b,f),j.addVectors(j,h),i.vertices[1]=j.clone(),this.drawLine(i,this.indicatorMaterial,.2,k)},o.renderMidpointIndicator=function(a){var b=a.geomVertex,c=this.setScale(b),d=1.2*c,e=this.viewer.navigation.getCameraRightVector().multiplyScalar(d),f=this.viewer.navigation.getCameraUpVector().multiplyScalar(d),h=new g.Geometry,i=new g.Vector3;i.addVectors(b,e),i.subVectors(i,f),h.vertices[0]=i.clone(),i.subVectors(b,e),i.subVectors(i,f),h.vertices[1]=i.clone(),this.drawLine(h,this.indicatorMaterial,.2,k),i.subVectors(b,e),i.subVectors(i,f),h.vertices[0]=i.clone(),i.addVectors(b,f),h.vertices[1]=i.clone(),this.drawLine(h,this.indicatorMaterial,.2,k),i.addVectors(b,e),i.subVectors(i,f),h.vertices[0]=i.clone(),i.addVectors(b,f),h.vertices[1]=i.clone(),this.drawLine(h,this.indicatorMaterial,.2,k)},o.renderEdgeIndicator=function(a){var b=(0,e.getSnapResultPosition)(a,this.viewer),c=this.setScale(b),d=1.2*c,f=this.viewer.navigation.getCameraRightVector().multiplyScalar(d),h=this.viewer.navigation.getCameraUpVector().multiplyScalar(d),i=new g.Geometry,j=new g.Vector3;j.addVectors(b,f),j.subVectors(j,h),i.vertices[0]=j.clone(),i.vertices[1]=b.clone(),this.drawLine(i,this.indicatorMaterial,.2,k),j.subVectors(b,f),j.subVectors(j,h),i.vertices[0]=j.clone(),i.vertices[1]=b.clone(),this.drawLine(i,this.indicatorMaterial,.2,k),j.addVectors(b,h),i.vertices[0]=j.clone(),i.vertices[1]=b.clone(),this.drawLine(i,this.indicatorMaterial,.2,k)},o.renderCircleIndicator=function(a){var b=(0,e.getSnapResultPosition)(a,this.viewer);this.drawCircle(b,this.indicatorMaterial,k)},o.renderPerpendicular=function(a){var b=(0,e.getSnapResultPosition)(a,this.viewer),c=this.setScale(b),d=1.2*c,f=this.viewer.navigation.getCameraRightVector().multiplyScalar(d),h=this.viewer.navigation.getCameraUpVector().multiplyScalar(d),i=new g.Geometry,j=new g.Vector3;i.vertices[0]=b.clone(),j.subVectors(b,f),i.vertices[1]=j.clone(),this.drawLine(i,this.indicatorMaterial,.2,k),j.addVectors(b,f),j.subVectors(j,h),i.vertices[0]=j.clone(),j.subVectors(b,f),j.subVectors(j,h),i.vertices[1]=j.clone(),this.drawLine(i,this.indicatorMaterial,.2,k),j.subVectors(b,f),j.subVectors(j,h),i.vertices[0]=j.clone(),j.subVectors(b,f),j.addVectors(j,h),i.vertices[1]=j.clone(),this.drawLine(i,this.indicatorMaterial,.2,k),i.vertices[0]=b.clone(),j.subVectors(b,h),i.vertices[1]=j.clone(),this.drawLine(i,this.indicatorMaterial,.2,k)},o.renderIndicator=function(a){if(a.isPerpendicular)return void this.renderPerpendicular(a);switch(a.geomType){case h.SnapType.SNAP_VERTEX:this.renderVertexIndicator(a);break;case h.SnapType.SNAP_MIDPOINT:this.renderMidpointIndicator(a);break;case h.SnapType.SNAP_CIRCLE_CENTER:this.renderCircleIndicator(a);break;case h.SnapType.SNAP_EDGE:case h.SnapType.SNAP_CURVEDEDGE:this.renderEdgeIndicator(a);break;case h.SnapType.SNAP_CIRCULARARC:this.viewer.model.is2d()?this.renderVertexIndicator(a):this.renderCircleIndicator(a);break;case h.SnapType.SNAP_FACE:case h.SnapType.SNAP_CURVEDFACE:this.renderVertexIndicator(a)}},o.drawLine=function(a,b,c,d){d===j&&(this.overlayType=2);for(var e=0;e<a.vertices.length;e+=2){var f=this.cylinderMesh(a.vertices[e],a.vertices[e+1],b,c);this.setEdgeScale(f),this.addOverlay(d,f)}},o.drawPoint=function(a,b,c){if(!this.viewer.model.getData().isLeaflet){l||(l=new g.SphereGeometry(1));var d=new g.Mesh(l,b);d.position.set(a.x,a.y,a.z),this.setPointScale(d),c===j&&(this.overlayType=3),this.addOverlay(c,d)}},o.drawCircle=function(a,b,c){var d=new g.TorusGeometry(1.2,.2,2,20),e=new g.Mesh(d,b);e.lookAt(this.viewer.navigation.getEyeVector().normalize()),d=null,e.position.set(a.x,a.y,a.z),this.setCircleScale(e),this.addOverlay(c,e)},o.setScale=function(a){var b=this.viewer.navigation,c=b.getCamera(),d=b.getPosition(),e=a.clone(),f=c.isPerspective?e.sub(d).length():b.getEyeVector().length(),h=b.getVerticalFov();return 2*f*Math.tan(g.Math.degToRad(.5*h))*5/b.getScreenViewport().height},o.setPointScale=function(a){var b=this.setScale(a.position);a.scale.x=b,a.scale.y=b,a.scale.z=b},o.setCircleScale=function(a){var b=this.setScale(a.position);a.scale.x=b,a.scale.y=b},o.setEdgeScale=function(a){var b=this.setScale(a.position);a.scale.x=b,a.scale.z=b},o.updatePointScale=function(a){if(3==this.overlayType){var b=this.viewer.impl.overlayScenes[a];if(b)for(var c=b.scene,d=0;d<c.children.length;d++){var e=c.children[d];e&&this.setPointScale(e)}}},o.updateEdgeScale=function(a){if(2==this.overlayType){var b=this.viewer.impl.overlayScenes[a];if(b)for(var c=b.scene,d=0;d<c.children.length;d++){var e=c.children[d];e&&this.setEdgeScale(e)}}},o.onCameraChange=function(){this.updatePointScale(j),this.updateEdgeScale(j),this.render()},o.destroy=function(){this.removeOverlay(j),this.removeOverlay(k),l&&(l.dispose(),l=null)}},function(a,b){"use strict";function c(){this.names=["unnamed"],this.getNames=function(){return this.names},this.getName=function(){return this.names[0]},this.getPriority=function(){return 0},this.register=function(){},this.deregister=function(){},this.activate=function(a,b){},this.deactivate=function(a){},this.update=function(a){return!1},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){return!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(a){return!1},this.handleGesture=function(a){return!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}}Object.defineProperty(b,"__esModule",{value:!0}),b.ToolInterface=c},function(a,b){"use strict";function c(a){var b=["hottouch"],c={SHIFT:0,ALT:0,CONTROL:0},d=null,e=null,f=!1,g=!1,h=null,i={SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,LCOMMAND:91,RCOMMAND:93,COMMANDMOZ:224};this.getNames=function(){return b},this.getName=function(){return b[0]},this.activate=function(a){},this.deactivate=function(a){},this.__checkStart=function(){h&&(this.controller.distributeEvent("handleGesture",h),h=null)},this.update=function(){if(this.controller.getIsLocked())return!1;var b=a.getActiveNavigationTool(),c=!1===f&&!0===g,h=!0===f&&!1===g;if(c||h){var i=c?"worldup":"fov";if(b===i)return!1;if(b===d)return a.setActiveNavigationTool(i),d=i,this.__checkStart(),!1;e=b,a.setActiveNavigationTool(i),d=i,this.__checkStart()}else d&&(a.setActiveNavigationTool(e),d=null,e=null);return!1},this.resetKeys=function(){c.SHIFT=0,c.CONTROL=0,c.ALT=0},this.updateModifierState=function(a){c.CONTROL=a.ctrlKey?1:0,c.SHIFT=a.shiftKey?1:0,c.ALT=a.altKey?1:0},this.handleGesture=function(b){if(b===h)return!1;switch(b.type){case"drag3start":a.navigation.isActionEnabled("fov")&&(h=b,f=!0);break;case"drag3move":break;case"drag3end":f=!1;break;case"rotatestart":a.navigation.isActionEnabled("roll")&&(h=b,g=!0);break;case"rotatemove":break;case"rotateend":g=!1}return!1},this.handleKeyDown=function(a,b){switch(this.updateModifierState(a),b){case i.SHIFT:c.SHIFT=1;break;case i.CONTROL:c.CONTROL=1;break;case i.ALT:c.ALT=1}return!1},this.handleKeyUp=function(a,b){switch(this.updateModifierState(a),b){case i.SHIFT:c.SHIFT=0;break;case i.CONTROL:c.CONTROL=0;break;case i.ALT:c.ALT=0}return!1},this.handleButtonDown=function(a,b){return this.updateModifierState(a),!1},this.handleButtonUp=function(a,b){return this.updateModifierState(a),!1},this.handleMouseMove=function(a){return this.updateModifierState(a),!1},this.handleBlur=function(a){return this.resetKeys(),!1}}Object.defineProperty(b,"__esModule",{value:!0}),b.HotGestureTool=c},function(a,b,c){"use strict";function d(a){function b(a){return a<0&&a>-3?-3:a>0&&a<3?3:a}var c=a.navigation,d=c.getCamera(),e=["fov"],g=!1,h=0,i=null,j=null,k=!1,l=0,m=-5,n=new f.Vector3,o=new f.Vector3,p=new f.Vector3,q=null;this.getNames=function(){return e},this.getName=function(){return e[0]},this.activate=function(a){l=0},this.deactivate=function(a){m=-5},this.getCursor=function(){return 0!==l&&-5===m?null:"url(data:image/x-icon;base64,AAACAAEAGBgAAAAAAACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAYAkAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnAwMD/yEhIf8AAABmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAGknJyf/goKC/8/Pz/8aGhr/AAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAABTFBQU/2lpaf/MzMz///////////+Wlpb/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAOAAAAKFTU1P/t7e3////////////8PDw////////////AQEB/wAAAAEAAAAAAAAAFAAAAH0KCgr/AAAAYwAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAjCwsL/6Ghof/t7e3///////Dw8P9MTEz/LS0t//Pz8///////Ghoa/wAAABoAAAANDQ0N/319ff+rq6v/Y2Nj/wAAAK8AAABGAAAA////////////AAAA/wAAAF0hISH/jIyM////////////sLCw/xEREf8AAACHAAAArKysrP//////V1dX/wAAAFcAAABSUlJS//f39///////8PDw/6+vr/86Ojr/LS0t////////////FRUV/1xcXP/Gxsb/+Pj4//Hx8f9MTEz/AAAAsAAAAEcAAAAAAAAAZ2dnZ///////pKSk/wAAAKQAAACtra2t///////////////////////m5ub/kZGR/wAAAP8AAAD/q6ur//Hx8f//////vb29/x0dHf8AAACIAAAAAAAAAAAAAAAAAAAAOjo6Ov//////5+fn/wAAAOcAAADd3d3d////////////////////////////+/v7/9bW1v/i4uL//v7+//Pz8/9hYWH/AAAAvQAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAJycnJ//6+vr//////wMDA/8AAADv7+/v/////////////////////////////////////////////////7y8vP8ODg7/AAAAKwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJiYmJv/6+vr//////wkJCf8AAADv7+/v//////////////////////////////////f39//9/f3//////+np6f+UlJT/GBgY/wAAAH0AAAACAAAAAAAAAAAAAAAAAAAAKSkpKf///////v7+/w0NDf8AAADd3d3d////////////////////////////29vb/39/f/+Xl5f/5+fn////////////5ubm/1RUVP8CAgL/AAAAPwAAAAAAAAAAAAAAOTk5Of//////8PDw/wgICP8AAAChoaGh/////////////////+np6f+YmJj/QkJC/wAAAP8AAAD/UFBQ/7e3t//39/f///////////+oqKj/EBAQ/wAAAIgAAAAAAAAAZ2dnZ///////29vb/wEBAf8AAAA4NTU1/9zc3P/t7e3/tbW1/01NTf8AAACYAAAA////////////AwMD/wsLC/9oaGj/y8vL////////////8fHx/zg4OP8AAACWAAAApaWlpf//////n5+f/wAAAJ8AAAAAAAAAczg4OP9LS0v/EhIS/wAAAE0AAAAAAAAA////////////FRUV/wAAABUAAABoJSUl/4GBgf/i4uL///////////9+fn7/Pz8///b29v//////SkpK/wAAAEoAAAAAAAAAAAAAADgAAABLAAAAEgAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAJQAAAIE8PDz/np6e//z8/P/////////////////8/Pz/CQkJ/wAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAA8DAwM/09PT/+7u7v///////////+QkJD/AAAAkwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////Dw8P/wAAAA8AAAAAAAAAAAAAAAAAAAAAAAAADAAAAFIYGBj/aGho/729vf8WFhb/AAAAJwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////FRUV/wAAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAQEB/w8PD/8AAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////DAwM/wAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8x/h/nO/4fw1D+HwFy/h4BRu4YAHOGEABkAAAAXAAAIFwAAOBnAAHgIAAD4GUAAOB4AABgXAAAIGMAAABtggAAVMYYAHT+HgE7/g8BcP4Pw2/+D+dc/h//XP///2c=), auto"},this.getMotionDelta=function(a){var b=o.x-n.x,c=o.y-n.y,d=o.z-n.z;Math.abs(b)<.001&&(b=0),Math.abs(c)<.001&&(c=0),Math.abs(d)<.001&&(d=0),a.set(b,c,d)},this.stepMotionDelta=function(a,b){b?(n.x+=.6*a.x,n.y+=.6*a.y,n.z+=.6*a.z):n.copy(o)},this.getAccumulatedWheelDelta=function(){var a=Date.now(),c=0;return j&&a-j>100?(c=b(h),h=0,i=null,j=null,k=!1):i&&a-i>100&&(k?Math.abs(h)>=3&&(c=h,h=0):(c=b(h),k=!0,h=0)),c},this.update=function(){var a=!1,b=m>-5;if(m>-5){this.controller.setIsLocked(!0),this.getMotionDelta(p);var e=p.x,f=p.y,h=p.z;if(0!==e||0!==f||0!==h)if(b=!0,m>=0)f=-f,0!==(h=Math.abs(e)>Math.abs(f)?e:f)&&(h*=-1,c.setVerticalFov(c.getVerticalFov()*(1+h),!0));else{var i=this.getAccumulatedWheelDelta()/3;0!==i&&c.setFocalLength(c.getFocalLength()+i,!0)}this.stepMotionDelta(p,!0),-1===m&&Math.abs(h)<1e-5&&(this.interactionEnd(-1),a=!0)}return b?this.utilities.pivotActive(c.getPivotSetFlag(),!0):this.utilities.pivotUpdate(),!g&&(a||m>-5)&&(m>-1&&n.copy(o),m=-5,this.controller.setIsLocked(!1)),d.dirty},this.interactionStart=function(a,b){(b||a>m)&&(m=a,g=!0),c.toPerspective()},this.interactionEnd=function(a){a===m&&(-1!==a&&this.utilities.pivotActive(!1),g=!1)},this.handleWheelInput=function(a){if(m>-1)return!1;c.getReverseZoomDirection()&&(a*=-1),o.z+=a,h+=a;var b=Date.now();return i||(i=b),j=b,0!=a&&this.interactionStart(-1),!0},this.handleGesture=function(a){switch(a.type){case"dragstart":return this.handleButtonDown(a,0);case"dragmove":return this.handleMouseMove(a);case"dragend":return this.handleButtonUp(a,0);case"drag3start":return q="drag",this.handleButtonDown(a,0);case"drag3move":return"drag"===q&&this.handleMouseMove(a);case"drag3end":return"drag"===q&&this.handleButtonUp(a,0),q=null,!1}return!1},this.handleButtonDown=function(a,b){return l+=1<<b,2!==b&&(n.x=.5*(a.normalizedX+1),n.y=1-.5*(a.normalizedY+1),o.copy(n),this.interactionStart(b),!0)},this.handleButtonUp=function(a,b){return l-=1<<b,2!==b&&(o.x=.5*(a.normalizedX+1),o.y=1-.5*(a.normalizedY+1),this.interactionEnd(b),!0)},this.handleMouseMove=function(a){return o.x=.5*(a.normalizedX+1),o.y=1-.5*(a.normalizedY+1),m>-1},this.handleBlur=function(a){return this.interactionEnd(m),!1}}Object.defineProperty(b,"__esModule",{value:!0}),b.FovTool=d;var e=c(2),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e)},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function e(a,b){function c(a,b){function c(a,b){var c=Math.abs(a-b);return c>n?c:Math.min(n-c,c)}function d(a,b){var c=q(a);return c.distanceToSquared(b)<o||(C.set(-b.x,-b.y,-b.z),c.distanceToSquared(C)<o)}function i(a,b){for(var e=X+Y+2*Math.PI/180,f=0;f<6;++f)if(R[f]!==$)for(var g=f+1;g<6;++g)if(R[g]!==$){var h=c(R[f],R[g]);if(h<e){if(a[f]<a[g]&&!d(f,b)||d(g,b)){R[f]=$;break}R[g]=$}}}function j(a){return a>n?a:a<=0?a+Math.PI:a-Math.PI}function k(a,b,c){var d=a.clone().normalize(),e=new Array(3),f=new Array(6);e[0]=m(1,0,0,d),e[1]=m(0,1,0,d),e[2]=m(0,0,1,d);var g,h=b.clone().cross(d).normalize();for(g=0;g<3;++g){var k=e[g];f[g]=k.length(),f[g]<_?R[g]=$:(k.multiplyScalar(1/f[g]),R[g]=Math.atan2(h.dot(k),b.dot(k)))}for(R[3]=j(R[0]),R[4]=j(R[1]),R[5]=j(R[2]),f[3]=f[0],f[4]=f[1],f[5]=f[2],i(f,c),g=0;g<6;++g)if(R[g]!==$){var l=C.set(0,0,1);D.setFromAxisAngle(l,R[g]);var n=C.set(0,.54,0);n.applyQuaternion(D),P[g].position.copy(n),P[g].visible=!0}else P[g].visible=!1}function l(){N=new g.Object3D;var a=new g.RingGeometry(.5-.01*G,.5,60),b=new g.Mesh(a,A);J=b;var c=.007*G,d=new g.BoxGeometry(.93,c,c),e=new g.BoxGeometry(c,.93,c),f=new g.BoxGeometry(c,c,.93);K=new g.Mesh(d,A),L=new g.Mesh(e,A),M=new g.Mesh(f,A),N.add(K),N.add(L),N.add(M),O=new g.Mesh(new g.CircleGeometry(.005),A),N.add(O),P=new Array(6),Q=new Array(6);for(var h=0;h<6;++h){var i=.005*G,j=.0025*G;P[h]=new g.Mesh(new g.CircleGeometry(i,16),A),Q[h]=new g.Mesh(new g.CircleGeometry(j,16),A),Q[h].visible=!1,P[h].add(Q[h]),b.add(P[h])}return N.add(b),N}function p(a,b,c,d,e){return N||(N=l()),h.orient(J,b,E.position,d),k(c,e,d),N.scale.x=a,N.scale.y=a,N.scale.z=a,N.position.copy(b),N}function q(a){if(B.set(0,0,0),a>=0){var b=a>=3?-1:1;a%=3,0===a&&(B.x=b),1===a&&(B.y=b),2===a&&(B.z=b)}return U&&B.multiplyScalar(-1),B}function r(a,b){for(var d=c(R[0],a),e=0,f=1;f<6;++f){var g=c(R[f],a);g<d&&(d=g,e=f)}return S=d,d<b?e:-1}function s(a){h.setWorldUpVector(a,!0)}function t(a){if(0!==a){var b=30*Math.PI/180,c=C.copy(E.position).sub(I).normalize();D.setFromAxisAngle(c,a);var d=h.getWorldUpVector(),e=Math.abs(c.angleTo(d));(e<b||Math.PI-e<b)&&d.copy(h.getCameraUpVector()),d.applyQuaternion(D),s(d)}}function u(){if(!V){var a=r(T,X);if(a>=0)return S=0,V=!0,T=R[a],q(a)}return!1}function v(){if(V){if(r(T,Y)<0)return V=!1,!0;S=0}return!1}function w(a,b,c,d){if(a<b)return q(c).distanceToSquared(d)<o;return!1}function x(a,b){a.dot(b)<0&&(b=b.clone().multiplyScalar(-1)),h.orient(O,I,E.position,b),O.position.copy(b.multiplyScalar(.495));for(var d=!1,e=V?Y:X,f=0;f<6;++f){var g=c(R[f],T),i=w(g,e,f,a);i&&(d=!0);var j=i?4:3*(1-3*g/Math.PI);j<1&&(j=1),j*=G,Q[f].visible=i;var k=P[f];k.scale.x=j,k.scale.y=j,k.scale.z=j}return K.visible=d,L.visible=d,M.visible=d,d}function y(a){T+=a,T>Math.PI?T-=n:T<=-Math.PI&&(T=n+T);var b=u();if(b)W=T,s(b);else if(v()){var c=T-W;t(c),W=0}else{if(V)return!1;t(a)}return!0}var z=2*Math.tan(g.Math.degToRad(15)),A=new g.MeshPhongMaterial({color:12303291,ambient:12303291,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),B=new g.Vector3,C=new g.Vector3,D=new g.Quaternion,E=new g.PerspectiveCamera(30,b.aspect,b.near,b.far),F=b,G=1,H=1,I=null,J=null,K=null,L=null,M=null,N=null,O=null,P=null,Q=null,R=new Array(6),S=0,T=0,U=!1,V=!0,W=0,X=5*Math.PI/180,Y=7*Math.PI/180,Z=1,$=1e3,_=.1;a.createOverlayScene("roll",null,null,E),this.updateRollCamera=function(a,b){E.position.copy(F.position),E.quaternion.copy(F.quaternion),E.up.copy(F.up),E.aspect=F.aspect,a&&b&&(E.near=b-a,E.far=b+a),E.updateProjectionMatrix()},this.isSnapped=function(){return V},this.resize=function(){var a=Z*z,b=a*F.aspect,c=(F.aspect<1?b:a)*H;N.scale.x=c,N.scale.y=c,N.scale.z=c},this.start=function(b,c){this.updateHUD(b,c),a.addOverlay("roll",N)},this.updateHUD=function(a,b){I=a,b<e?b=e:b>f&&(b=f),H=b,G=f/b;var c=B.copy(a).sub(F.position);Z=c.length();var d=Z*z,g=d*F.aspect,i=(F.aspect<1?g:d)*b;this.updateRollCamera(i,Z);var j=h.getWorldUpVector(),k=h.getCameraUpVector();p(i,a,c,j,k),T=0,W=0;var l=j.dot(k);U=l<0,V=x(j,k)},this.handleRoll=function(a,b,c){if(this.updateRollCamera(),x(h.getWorldUpVector(),h.getCameraUpVector()),0!==a||0!==b){var d=c.x-a-.5,e=c.y-b-.5,f=c.x-.5,g=c.y-.5;return y(Math.atan2(g,f)-Math.atan2(e,d))}return!1},this.handleRollTouch=function(a){this.updateRollCamera(),x(h.getWorldUpVector(),h.getCameraUpVector());var b=a-T;return Math.abs(b)>.001&&y(b)},this.end=function(){a.removeOverlay("roll",N)}}function d(a){var b=a.pointers[1].clientX-a.pointers[0].clientX,c=a.pointers[1].clientY-a.pointers[0].clientY,d=Math.sqrt(b*b+c*c),e=h.getScreenViewport();return d/Math.min(e.width,e.height)}var e=.35,f=.8,h=b.navigation,j=h.getCamera(),k=["worldup"],l=this,m=function(){var a=new g.Vector3;return function(b,c,d,e){var f=new g.Vector3(b,c,d),h=e.dot(f);return a.copy(e),a.multiplyScalar(h),f.sub(a)}}(),n=2*Math.PI,o=1e-5,p=!1,q=!1,r=!1,s=new c(a,j),t=new g.Vector3,u=new g.Vector3,v=new g.Vector3,w=null,x=0,y={x:.5,y:.5},z=1;this.getNames=function(){return k},this.getName=function(){return k[0]},this.activate=function(a){b.addEventListener(i.CAMERA_CHANGE_EVENT,this.handleCameraChange),r=!1},this.deactivate=function(a){s.end(),b.removeEventListener(i.CAMERA_CHANGE_EVENT,this.handleCameraChange),this.utilities.restorePivot(),w=null,p=!1,r=!1},this.getCursor=function(){return"auto"},this.getMotionDelta=function(a){var b=u.x-t.x,c=u.y-t.y,d=u.z-t.z;Math.abs(b)<.001&&(b=0),Math.abs(c)<.001&&(c=0),Math.abs(d)<.001&&(d=0),a.set(b,c,d)},this.stepMotionDelta=function(){t.copy(u)},this.update=function(){if(!r){var a=h.getEyeVector(),b=.5*(j.near+j.far);a.normalize().multiplyScalar(b);var c=a.add(j.position);this.utilities.savePivot(),this.utilities.setPivotPoint(c,!0,!0),this.utilities.pivotActive(!0);s.start(c,.65),r=!0}var d=q;this.getMotionDelta(v);var e=v.x,f=v.y,g=v.z;return(q||"roll"===w||p&&(0!==e||0!==f||0!==g))&&(q="roll"===w?s.handleRollTouch(x):s.handleRoll(e,f,u)),this.stepMotionDelta(),j.dirty&&(d=!0),d},this.handleResize=function(){s.resize(),q=!0},this.handleGesture=function(a){switch(a.type){case"dragstart":return w="drag",this.handleButtonDown(a,0);case"dragmove":return this.handleMouseMove(a);case"dragend":return w=null,this.handleButtonUp(a,0);case"rotatestart":return b.removeEventListener(i.CAMERA_CHANGE_EVENT,this.handleCameraChange),w="roll",x=g.Math.degToRad(a.rotation),y={x:.5*(a.normalizedX+1),y:1-.5*(a.normalizedY+1)},z=d(a),!0;case"rotatemove":return x=g.Math.degToRad(a.rotation),"roll"===w;case"rotateend":return b.addEventListener(i.CAMERA_CHANGE_EVENT,this.handleCameraChange),x=g.Math.degToRad(a.rotation),w=null,!1}return!1},this.handleWheelInput=function(a){return!0},this.handleCameraChange=function(){var a=h.getEyeVector(),b=.5*(j.near+j.far);a.normalize().multiplyScalar(b);var c=a.add(j.position);s.updateHUD(c,.65)},this.handleButtonDown=function(a,c){return t.x=.5*(a.normalizedX+1),t.y=1-.5*(a.normalizedY+1),u.copy(t),p=!0,w=null,this.controller.setIsLocked(!0),b.removeEventListener(i.CAMERA_CHANGE_EVENT,l.handleCameraChange),!0},this.handleButtonUp=function(a,c){return u.x=.5*(a.normalizedX+1),u.y=1-.5*(a.normalizedY+1),p=!1,q=!0,this.controller.setIsLocked(!1),b.addEventListener(i.CAMERA_CHANGE_EVENT,l.handleCameraChange),!0},this.handleMouseMove=function(a){return u.x=.5*(a.normalizedX+1),u.y=1-.5*(a.normalizedY+1),!0},this.handleBlur=function(a){return p=!1,w=null,!1}}Object.defineProperty(b,"__esModule",{value:!0}),b.WorldUpTool=e;var f=c(2),g=d(f),h=c(198),i=d(h)},function(a,b,c){"use strict";function d(){this.stop=null,this.isRunning=!0}function e(a,b,c,e,f){var g=performance.now(),h=1e3*c,i=0,j=new d;j.stop=function(){i&&window.cancelAnimationFrame(i),j.isRunning=!1};return function c(d){var k=(d-g)/h;k=Math.max(k,0),k=Math.min(k,1),e(a+k*(b-a)),k<1?i=window.requestAnimationFrame(c):(j.isRunning=!1,f&&f())}(g),j}function f(a,b,c){return(1-c)*a+c*b}function g(a){return THREE.Math.smootherstep(a,0,1)}function h(a){function b(a,b,c){r.set(0,0,-c).applyQuaternion(b),a.target.addVectors(a.position,r),r.set(0,1,0).applyQuaternion(b),a.up.copy(r)}function c(a,b,c,d){Autodesk.Viewing.Navigation.prototype.orient(t,c,b,d),a.copy(t.quaternion)}function d(){c(p,e,h,o),c(q,j,k,o)}var e=new THREE.Vector3,h=new THREE.Vector3,i=new THREE.Vector3,j=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,m=0,n=0,o=new THREE.Vector3,p=new THREE.Quaternion,q=new THREE.Quaternion,r=new THREE.Vector3,s=new THREE.Quaternion,t=new THREE.Object3D;new THREE.Matrix4;this.init=function(a,b,c,f){e.copy(a.position),h.copy(a.target),i.copy(a.up),j.copy(b),k.copy(c),l.copy(f),o.copy(a.worldup),m=e.distanceTo(h),n=j.distanceTo(k),d()},this.updateCamera=function(a,c){var d=g(a)
;c.position.lerpVectors(e,j,d),THREE.Quaternion.slerp(p,q,s,d),s.normalize();var h=f(m,n,d);b(c,s,h),c.dirty=!0},this.updateViewerCamera=function(a,b){this.updateCamera(a,b.impl.camera),b.impl.syncCamera(),b.impl.invalidate(!0,!0)}}function i(a,b,c,d){p||(p=new h),c=c||2;var f=a.impl.camera;return p.init(f,b.position,b.target,b.up),e(0,1,c,function(b){p.updateViewerCamera(b,a)},d)}function j(a,b,c,d,f){function g(b){a.setCrossFadeOpacity(0,1-b),a.setCrossFadeOpacity(1,b)}function h(){a.setModelTargetIndex(b,void 0),a.setModelTargetIndex(c,void 0),f&&f()}return a.setModelCrossFadeEnabled(!0),a.setModelTargetIndex(b,0),a.setModelTargetIndex(c,1),e(0,1,d,g,h)}function k(a,b,c,e,f,g){var h=new d,k=function(){h.isRunning=!1,g&&g()},l=c.id,m=e.id,n=i(a,b,f),o=j(a,l,m,f,k);return h.stop=function(){n.stop(),o.stop(),a.setModelTargetIndex(l,void 0),a.setModelTargetIndex(m,void 0);var b=h.isRunning;h.isRunning=!1,g&&b&&g()},h}function l(a,b,c){function d(b){g=b,a.impl.setGroundShadowAlpha(b)}function f(){h=null,k&&k(j)}var g=1,h=null,i=b,j=void 0,k=c;this.shadowOn=function(){if(!(h&&j||(h&&!j&&(h.stop(),h=null),g>=1))){h=e(g,1,i*(1-g),d,f),j=!0}},this.shadowOff=function(){if((!h||j)&&(h&&j&&(h.stop(),h=null),!(g<=0))){h=e(g,0,i*g,d,f),j=!1}},this.isFading=function(){return h&&h.isRunning}}function m(a,b,c,d,f,g){return e(c,d,f,function(c){a.setCrossFadeOpacity(b,c)},g)}function n(a,b,c,d,f){function g(){a.impl.renderer().getCrossFade().setFadeMode(q.FadeMode.CROSSFADE);for(var b=0;b<i.length;b++){var c=i[b];h.showModel(c.id)}f&&f()}for(var h=a.impl.modelQueue(),i=h.getModels().slice(),j=0;j<i.length;j++){var k=i[j];h.hideModel(k.id)}var l=function(b){a.setCrossFadeOpacity(0,1-b),a.setCrossFadeOpacity(1,b),a.impl.renderer().presentBuffer()};return a.impl.renderer().getCrossFade().setFadeMode(q.FadeMode.CROSSFADE),e(b,c,d,l,g)}function o(a,b,c){function d(){a.impl.releaseFadingImage(0),a.impl.releaseFadingImage(1),e.setAOEnabled(f)}a.setModelCrossFadeEnabled(!0),a.impl.renderFadingImage(0,300),b(),a.impl.renderFadingImage(1,300);var e=a.impl.renderer(),f=e.getAOEnabled();e.setAOEnabled(!1),n(a,0,1,c,d)}var p,q=c(177).TargetCrossFade;a.exports={flyToView:i,crossFadeModels:j,startViewTransition:k,fadeTarget:m,ShadowFader:l,fadeToViewerState:o,lerp:f,smootherStep:g,fadeValue:e}},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}Object.defineProperty(b,"__esModule",{value:!0}),b.SvfLoader=void 0;var e=c(37),f=d(e),g=c(4),h=c(8),i=c(251),j=c(128),k=c(13),l=c(191),m=c(125),n=c(189),o=c(109),p=c(12),q=c(220),r=c(139),s=c(10),t=c(198),u=d(t),v=c(207),w=c(2),x=d(w),y=c(199),z=c(9),A=Autodesk.Viewing,B=(0,g.isNodeJS)()?10:(0,g.isMobileDevice)()?2:6,C=1048576,D={type:u.FRAGMENTS_LOADED_EVENT,model:null,data:null,getFragIds:function(){if(this.fragIds)return this.fragIds;var a=this.model;if(!a||!this.data||!this.data.meshes)return null;var b=this.fragIds=[],c=this.data.packId,d=0,e=a.getData(),f=e.fragments,g=this.data.meshes.length;for(d=0;d<g;++d){var h=c+":"+d++,i=f.mesh2frag[h];if(void 0===i)return;Array.isArray(i)?i.forEach(function(a){b.push(a)}):b.push(i)}return b}},E=function(a,b){D.model=a.model,D.data=b,a.viewer3DImpl.dispatchEvent(D)},F=b.SvfLoader=function(a,b){this.viewer3DImpl=a,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.tmpMatrix=new x.Matrix4,this.tmpBox=new x.Box3,this.fetchingTopology=!1,this.loadTime=0;var c=b&&b.memory,d=this.memoryOpts={debug:{}};if(!(0,g.isNodeJS)()&&(d.limit=(0,g.isAndroidDevice)()?195:(0,g.isIOSDevice)()?150:600,d.onDemandLoading=!0,d.pageOutGeometryEnabled=!0,c)){d.debug=c.debug||{};var e=c.hasOwnProperty("limit")?c.limit:0;(0|e)>0?d.limit=0|e:0==e?(d.onDemandLoading=!1,d.pageOutGeometryEnabled=!1,d.debug.force=!1):h.logger.warn("Memory limit, "+e+", is invalid - ignored")}};F.prototype.dtor=function(){if(this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,h.logger.debug("SVF loader dtor: on init worker script.")),this.svfWorker&&(this.svfWorker.clearAllEventListenerWithIntercept(),this.svfWorker.terminate(),this.svfWorker=null,h.logger.debug("SVF loader dtor: on svf worker.")),this.svfLoadOrderWorker&&(this.svfLoadOrderWorker.terminate(),this.svfLoadOrderWorker=null,h.logger.debug("SVF loader dtor: on load order worker.")),this.pack_workers){for(var a=0;a<this.pack_workers.length;a++)this.pack_workers[a].clearAllEventListenerWithIntercept(),this.pack_workers[a].terminate();this.pack_workers=null,h.logger.debug("SVF loader dtor: on geom worker.")}this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.pagingProxy&&(this.pagingProxy.dtor(),this.pagingProxy=null),this.tmpMatrix=null,this.tmpBox=null,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadTime=0,this.viewer3DImpl=null},F.prototype.isValid=function(){return this.viewer3DImpl},F.prototype.loadFile=function(a,b,c,d){if(!this.viewer3DImpl)return h.logger.log("SVF loader was already destructed. So no longer usable."),!1;if(this.loading)return h.logger.log("Loading of SVF already in progress. Ignoring new request."),!1;this.loading=!0,this.viewer3DImpl._addLoadingFile(this);var e=a.indexOf("urn:");if(-1!=e){a=decodeURIComponent(a);var f=a.substr(e,a.substr(e).indexOf("/"));h.logger.log("Extracted URN: "+f);var g=f.lastIndexOf(":");this.svfUrn=f.substr(g+1)}else this.svfUrn=a;this.sharedDbPath=b.sharedPropertyDbPath,this.currentLoadPath=a;var i=this.currentLoadPath.lastIndexOf("/");-1!=i&&(this.basePath=this.currentLoadPath.substr(0,i+1)),this.acmSessionId=b.acmSessionId,this.queryParams="",this.acmSessionId&&(this.queryParams="acmsession="+this.acmSessionId),this.options=b;var j=this;return this.initWorkerScriptToken=(0,s.initWorkerScript)(function(){j.loadSvfCB(a,b,c,d)}),!0},F.prototype.loadSvfCB=function(a,b,c,d){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null,this.failedToLoadSomeGeometryPacks=null,this.failedToLoadPacksCount=0;var e=!0;b.doneWhenDownloaded&&(this.onDone=c);var f=this,i={url:(0,p.pathToURL)(a),basePath:this.currentLoadPath,objectIds:b.ids,globalOffset:b.globalOffset,placementTransform:b.placementTransform,applyRefPoint:b.applyRefPoint,queryParams:this.queryParams,bvhOptions:b.bvhOptions||{isWeakDevice:(0,g.isMobileDevice)()},applyScaling:b.applyScaling,loadInstanceTree:b.loadInstanceTree,max_pf_files:0},j=this.memoryOpts.onDemandLoading||!!this.memoryOpts.debug.memoryOptimizedSvfLoading;j&&(i.perfOpt={memoryOptimizedSvfLoading:j,forceMemoryOptimizedMode:!!this.memoryOpts.debug.forceMemoryOptimizedModeOnSvfLoading});var m=this.svfWorker=(0,s.createWorkerWithIntercept)(),n=function(a){var j=function(){m&&(m.clearAllEventListenerWithIntercept(),m.terminate(),f.svfWorker=null,m=null)};if(e&&d&&(e=!1,d()),a.data&&a.data.manifest)F.interceptManifest.call(f,a.data.manifest),i.operation="LOAD_SVF_CONTD",i.manifest=a.data.manifest,m.doOperation(i);else if(a.data&&a.data.svf){var n=f.svf=a.data.svf;f.failedToLoadSomeGeometryPacks&&(c&&(c(f.failedToLoadSomeGeometryPacks,null),delete f.onDone),f.failedToLoadSomeGeometryPacks=null),f.onModelRootLoadDone(n),c&&!b.doneWhenDownloaded&&c(null,f.model),f.viewer3DImpl.dispatchEvent({type:u.MODEL_ROOT_LOADED_EVENT,svf:n,model:f.model}),f.svf.loadDone=!1;var o=!1;if(f.svf.metadata&&f.svf.metadata.gltf&&(o=!0),!o){var p=n.geompacks.length;if(0==p)f.onGeomLoadDone();else if(f.model.getFragmentList().onDemandLoadingEnabled())h.logger.debug("[On Demand Loading]: Enabled."),f.loadedPacksCount=0;else if(p)for(var q=Math.min(p,A.NUM_WORKER_THREADS||B),r=0;r<q;r++){var s=n.geompacks[f.next_pack++];s.loading=!0,(0,g.isNodeJS)()?f.loadGeometryPack(s.id,s.uri):function(a){setTimeout(function(){f.loadGeometryPack(a.id,a.uri)},200*r)}(s)}}1==a.data.progress&&(f.loading=!1,j()),n.fragments.polygonCounts||(n.fragments.polygonCounts=new Int32Array(n.fragments.length)),a.data.bvh&&(f.svf.bvh=a.data.bvh,f.model.setBVH(new l.NodeArray(f.svf.bvh.nodes,f.svf.bvh.useLeanNodes),f.svf.bvh.primitives,f.options.bvhOptions),f.viewer3DImpl.invalidate(!1,!0))}else a.data&&a.data.bvh?(f.svf&&!f.svf.bvh&&(f.svf.bvh=a.data.bvh,f.model.setBVH(new l.NodeArray(f.svf.bvh.nodes,f.svf.bvh.useLeanNodes),f.svf.bvh.primitives,f.options.bvhOptions),f.viewer3DImpl.invalidate(!1,!0)),f.loading=!1,j()):a.data&&a.data.mesh?(f.processReceivedMesh(a.data),1===a.data.progress&&(f.onGeomLoadDone(),f.loading=!1,j())):a.data&&a.data.progress?1==a.data.progress&&(f.loading=!1,j()):a.data&&a.data.error?(f.loading=!1,j(),h.logger.error("Error while processing SVF: "+JSON.stringify(a.data.error.args)),c&&(c(a.data.error,null),delete f.onDone)):a.data&&a.data.debug?h.logger.debug(a.data.message):(h.logger.error("SVF download failed.",(0,k.errorCodeString)(k.ErrorCodes.NETWORK_FAILURE)),f.loading=!1,j())};return m.addEventListenerWithIntercept(n),i.operation="LOAD_SVF",i.interceptManifest=!!F.interceptManifest,m.doOperation((0,z.initLoadContext)(i)),!0},F.prototype.cancelGeometryPackLoading=function(){if(this.pack_workers&&this.isValid()){for(var a=0;a<this.pack_workers.length;a++){if(this.svf){var b=this.geommap[this.pack_workers[a].packId];b&&(b.loading=!1)}this.pack_workers[a].queued=0,this.pack_workers[a].clearAllEventListenerWithIntercept(),this.pack_workers[a].terminate()}this.pack_workers=null}},F.prototype.loadGeometryPackOnDemand=function(a,b){function c(a,b){a.queued=0,i.geommap[b].loading=!1,g.doOnDemandLoadFinished()}if(!this.svf||!this.isValid())return!0;var d=this.geommap[a];if(!d||d.loading)return!0;this.t0||(this.t0=(new Date).getTime());var e,g=this.pagingProxy,i=this,j=function(a){if(a.data&&a.data.meshes){for(var b=a.data.meshes,d={packId:a.data.packId,meshIndex:0,mesh:null},e=0,j=0;j<b.length;j++){var k=b[j];k&&(d.meshIndex=j,d.mesh=k,i.processReceivedMesh(d),d.geometry&&(e+=d.geometry.byteSize+f.GEOMETRY_OVERHEAD,d.geometry=null))}g.onPackFileLoaded(a.data.packId,a.data,e/C),E(i,a.data),a.data.progress>=1&&(i.loadedPacksCount++,c(i.pack_workers[a.data.workerId],a.data.packId))}else a.data&&a.data.progress?(i.pack_workers[a.data.workerId].queued-=1,i.viewer3DImpl.signalProgress(100*i.loadedPacksCount/i.svf.geompacks.length)):a.data&&a.data.debug?h.logger.debug(a.data.message):a.data&&a.data.error?(g.onPackFileLoaded(a.target.packId,null,0),c(a.target,a.target.packId),++i.failedToLoadPacksCount,i.failedToLoadSomeGeometryPacks={code:a.data.error.code,msg:a.data.error.msg}):(g.onPackFileLoaded(a.target.packId,null,0),c(a.target,a.target.packId))};if(!this.pack_workers){this.pack_workers=[];var k=B;for(e=0;e<k;e++){var l=(0,s.createWorkerWithIntercept)();l.addEventListenerWithIntercept(j),l.queued=0,this.pack_workers.push(l)}}var m=0,n=this.pack_workers[0].queued;for(e=1;e<this.pack_workers.length;e++)this.pack_workers[e].queued<n&&(m=e,n=this.pack_workers[e].queued);if(n>1||g.preparedPackFilesSize()>=g.getMemoryLimit())return this.model.addGeomPackMissingLastFrame(a)||this.viewer3DImpl.invalidate(!1,!0),!1;var o,q,r=d.uri;o=this.pack_workers[m],o.queued+=2,o.packId=a,q=m,g.onPackFileLoading(a),d.loading=!0,this.svf.partPacksLoadDone=!1,h.logger.debug("[On Demand Loading] Loading Geometry Pack file: "+a);var t=(0,p.pathToURL)(this.svf.basePath+r),u={operation:"LOAD_GEOMETRY",url:t,packId:a,workerId:q,packNormals:this.options.packNormals,createWireframe:this.options.createWireframe||this.model.getMetadata("renderEnvironmentDisplayEdges","value",!1),skipAssetCallback:!0,queryParams:this.queryParams,inMemory:b};return o.doOperation((0,z.initLoadContext)(u)),!0},F.prototype.loadGeometryPack=function(a,b){var c,d,e,f,g=this;if(this.svf&&this.isValid()){var i=function(a){if(a.data&&a.data.meshes){for(var b=a.data.meshes,c={packId:a.data.packId,meshIndex:0,mesh:null},d=0;d<b.length;d++){var e=b[d];e&&(c.meshIndex=d,c.mesh=e,g.processReceivedMesh(c))}if(a.data.progress>=1){g.pack_workers[a.data.workerId].queued-=1,g.loadedPacksCount++,g.viewer3DImpl.signalProgress(100*g.loadedPacksCount/g.svf.geompacks.length);var i=!0;for(f=0;f<g.pack_workers.length;f++)if(0!=g.pack_workers[f].queued){i=!1;break}if(i){for(f=0;f<g.pack_workers.length;f++)g.pack_workers[f].clearAllEventListenerWithIntercept(),g.pack_workers[f].terminate();g.pack_workers=null}g.loadedPacksCount+g.failedToLoadPacksCount==g.svf.geompacks.length&&g.onGeomLoadDone()}}else if(a.data&&a.data.progress){if(g.pack_workers[a.data.workerId].queued-=1,g.next_pack<g.svf.geompacks.length){for(var j=null;g.next_pack<g.svf.geompacks.length&&(j=g.svf.geompacks[g.next_pack++],j.loading););j&&!j.loading?(j.loading=!0,g.loadGeometryPack(j.id,j.uri)):g.svf.fragments.packIds=null}}else a.data&&a.data.debug?h.logger.debug(a.data.message):a.data&&a.data.error?(++g.failedToLoadPacksCount,g.failedToLoadSomeGeometryPacks={code:a.data.error.code,msg:a.data.error.msg}):g.pack_workers[a.data.workerId].queued-=2},j=this.pack_workers;if(j||(j=this.pack_workers=[]),j.length<(A.NUM_WORKER_THREADS||B)){var k=!0;for(e=0;e<j.length;e++)if(0===j[e].queued){k=!1;break}if(k){var l=(0,s.createWorkerWithIntercept)();l.addEventListenerWithIntercept(i),l.queued=0,j.push(l)}}var m=0,n=j[0].queued;for(e=1;e<j.length;e++)j[e].queued<n&&(m=e,n=j[e].queued);c=j[m],c.queued+=2,d=m;var o=(0,p.pathToURL)(this.svf.basePath+b),q={operation:"LOAD_GEOMETRY",url:o,packId:parseInt(a),workerId:d,createWireframe:this.options.createWireframe||this.model.getMetadata("renderEnvironmentDisplayEdges","value",!1),packNormals:this.options.packNormals,queryParams:this.queryParams};c.doOperation((0,z.initLoadContext)(q))}},F.prototype.processReceivedMesh=function(a){var b=a.packId+":"+a.meshIndex,c=this.svf,d=c.fragments,e=this.model,f=d.mesh2frag[b];if(void 0===f)return void h.logger.warn("Mesh "+b+" was not referenced by any fragments.");Array.isArray(f)||(f=[f]),m.BufferGeometryUtils.meshToGeometry(a),a.geometry.packId=a.packId,a.geometry.meshIndex=a.meshIndex;var g=f.length,i=e.getFragmentList().getGeometryId(f[0]),j=e.getGeometryList().addGeometry(a.geometry,g,i);this.pagingProxy&&this.pagingProxy.onProcessReceivedMesh(a.geometry,g);for(var k=a.geometry.attributes.index.array||a.geometry.ib,l=k.length/3,n=0;n<f.length;n++){var o=0|f[n];e.getFragmentList().getOriginalWorldMatrix(o,this.tmpMatrix);var p=d.materials[o].toString();d.polygonCounts&&(d.polygonCounts[o]=l);var q=this.viewer3DImpl.setupMesh(this.model,a.geometry,p,this.tmpMatrix);e.activateFragment(o,q,!!c.placementTransform)}this.options.onMeshReceived&&this.options.onMeshReceived(this.model,j,f),this.model.getFragmentList().onDemandLoadingEnabled()||(d.mesh2frag[b]=null),d.numLoaded+=f.length,e.getGeometryList().geomPolyCount>c.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),c.numRepaints++,c.nextRepaintPolys+=1e4*Math.pow(1.5,c.numRepaints),this.viewer3DImpl.invalidate(!1,!0))},F.prototype.onModelRootLoadDone=function(a){function b(a){r.isValid()&&r.pagingProxy&&r.pagingProxy.onLoadOrderCalculated(a.data)}a.geomMemory=0,a.fragments.numLoaded=0,a.gpuNumMeshes=0,a.gpuMeshMemory=0,a.nextRepaintPolys=0,a.numRepaints=0,a.urn=this.svfUrn,a.acmSessionId=this.acmSessionId,a.basePath=this.basePath,a.loadOptions=this.options;var c=Date.now();this.loadTime+=c-this.t0,h.logger.log("SVF load: "+(c-this.t0));var d=this.model=new v.Model(a);d.loader=this;var e=this.memoryOpts;this.viewer3DImpl.modelQueue()&&this.viewer3DImpl.modelQueue().length>0&&(e.pageOutGeometryEnabled=!1);var k=this.geommap={},l=Object.keys(a.fragments.mesh2frag).length,m=a.fragments.length,o=(224*l+134*m)/C,p=0;a.geompacks.forEach(function(a){a.hasOwnProperty("geomSize")||(a.geomSize=.7*a.usize),a.usize/=C,a.geomSize/=C,p+=a.geomSize,k[parseInt(a.id)]=a});var q=(0,g.isMobileDevice)()?Math.min(p,f.GPU_MEMORY_LIMIT/C):0;p+=o,e.totalGeomSize=p,e.overheadSize=o,e.onDemandLoading&&(p+q<e.limit&&!e.debug.force?e.onDemandLoading=!1:this.pagingProxy=new i.SvfPagingProxy(this,e)),d.initialize(this.pagingProxy);var r=this;this.model.getFragmentList().onDemandLoadingEnabled()&&a.fragments.boxes&&a.fragments.packIds&&(this.svfLoadOrderWorker=(0,s.createWorker)(),this.svfLoadOrderWorker.addEventListener("message",b,!1),this.svfLoadOrderWorker.doOperation({operation:"CALCULATE_LOAD_ORDER",fragments:{boxes:a.fragments.boxes,packIds:a.fragments.packIds}}),this.model.setUUID(a.urn)),this.model.getFragmentList().onDemandLoadingEnabled()&&(0,g.isMobileDevice)()||this.options.skipPropertyDb?this.svf.fragmentMap=new n.DbidFragmentMap(this.svf.fragments.fragId2dbId):this.loadPropertyDb();var t=this.convertMaterials(d);if(this.t1=c,a.bbox=(new x.Box3).copy(a.bbox),a.modelBox&&(a.modelBox=(new x.Box3).copy(a.modelBox)),a.refPointTransform&&(a.refPointTransform=new j.LmvMatrix4(!0).copy(a.refPointTransform)),a.placementTransform&&(a.placementTransform=new j.LmvMatrix4(!0).copy(a.placementTransform)),a.cameras)for(var u=0;u<a.cameras.length;u++){var w=a.cameras[u];w.position=(new x.Vector3).copy(w.position),w.target=(new x.Vector3).copy(w.target),w.up=(new x.Vector3).copy(w.up),isFinite(w.position.x+w.position.y+w.position.z+w.target.x+w.target.y+w.target.z+w.up.x+w.up.y+w.up.z)||(w.target=a.bbox.center(),w.position.copy(w.target),w.position.z+=a.bbox.max.z-a.bbox.min.z,w.up={x:0,y:1,z:0}),isFinite(w.aspect)||(w.aspect=1),isFinite(w.fov)||(w.fov=90),isFinite(w.orthoScale)||(w.orthoScale=1)}h.logger.log("scene bounds: "+JSON.stringify(a.bbox));var y={category:"metadata_load_stats",urn:a.urn,has_topology:!!a.topologyPath,has_animations:!!a.animations,cameras:a.cameras?a.cameras.length:0,lights:a.lights?a.lights.length:0,materials:t,is_mobile:(0,g.isMobileDevice)()};h.logger.track(y),this.viewer3DImpl.signalProgress(5),this.viewer3DImpl.invalidate(!1,!0)},F.prototype.calculateLoadOrder=function(a,b,c){if(!this.svfLoadOrderWorker)return!1;var d={projectionMatrix:{elements:b.projectionMatrix.elements},matrixWorldInverse:{elements:b.matrixWorldInverse.elements},aspect:b.aspect,position:{x:b.position.x,y:b.position.y,z:b.position.z},clientWidth:b.clientWidth,clientHeight:b.clientHeight},e={operation:"CALCULATE_LOAD_ORDER",id:a,camera:d,pixelCullingThreshold:c};return this.svfLoadOrderWorker.doOperation(e),!0},F.prototype.convertMaterials=function(a){var b,c=this.viewer3DImpl.matman(),d=a.getData(),e=0;if(!d.materials)return e;if(d.gltfMaterials){var f=d.materials.materials;for(b in f){var g=f[b],h=o.MaterialConverter.convertMaterialGltf(g,d),i=c._getMaterialHash(a,b);c.addMaterial(i,h,!1),e++}return e}var j=d.materials.materials,k=d.proteinMaterials?d.proteinMaterials.materials:null;for(b in j){var l=k&&k[b]&&o.MaterialConverter.isPrismMaterial(k[b]),m=l?k[b]:j[b];c.convertOneMaterial(a,m,c._getMaterialHash(a,b)),e++}return e},F.prototype.makeBVH=function(a){var b=performance.now(),c=a.materials?a.materials.materials:null;a.bvh=new l.BVHBuilder(a.fragments,c),a.bvh.build(this.options.bvhOptions||{isWeakDevice:(0,g.isMobileDevice)()});var d=performance.now();h.logger.log("BVH build time: "+(d-b))},F.prototype.onDemandGeomLoadDone=function(){if(!this.svf.loadDone)if((0,g.isMobileDevice)()){var a=this.viewer3DImpl.modelQueue()?this.viewer3DImpl.modelQueue().getMemoryInfo():this.model.getMemoryInfo();if(a&&a.effectiveLimit<=a.limit&&a.limit-a.loaded>50){var b=function(a){this.viewer3DImpl.api.removeEventListener(u.TEXTURES_LOADED_EVENT,b);var c=0;this.viewer3DImpl.matman().enumTextures(this.model,function(a){a&&(c+=r.TextureLoader.calculateTextureSize(a))}),c/=C,this.pagingProxy.options.limit-=c}.bind(this);this.viewer3DImpl.api.addEventListener(u.TEXTURES_LOADED_EVENT,b),r.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl)}}else r.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl);this.svf.loadDone=!0;var c=Date.now(),d="[On Demand Loading] On demand requested geometries load time: "+(c-this.t0);h.logger.log(d);var e={category:"on_demand_geom_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:c-this.t0,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),load_pack_count:this.loadedPacksCount,urn:this.svfUrn};h.logger.track(e),this.t0=null,this.loadedPacksCount=0,this.svf.partPacksLoadDone=!0,this.viewer3DImpl.dispatchEvent({type:u.GEOMETRY_DOWNLOAD_COMPLETE_EVENT,model:this.model,memoryLimited:!0}),this.onDone&&(this.onDone(null,this.model),delete this.onDone)},F.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,r.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null;var a=Date.now(),b="Fragments load time: "+(a-this.t1);this.loadTime+=a-this.t0;var c=this.firstPixelTimestamp-this.t0;b+=" (first pixel time: "+c+")",this.svf.bvh&&!this.svf.placementTransform||(this.makeBVH(this.svf),this.model.setBVH(this.svf.bvh.nodes,this.svf.bvh.primitives,this.options.bvhOptions),this.viewer3DImpl.invalidate(!1,!0)),h.logger.log(b),this.options.useConsolidation&&this.viewer3DImpl.glrenderer()&&this.model.consolidate(this.viewer3DImpl.matman(),this.options.consolidationMemoryLimit,this.viewer3DImpl.glrenderer());var d={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),urn:this.svfUrn};c>0&&(d.first_pixel_time=c),h.logger.track(d),this.currentLoadPath=null,this.viewer3DImpl.dispatchEvent({type:u.GEOMETRY_DOWNLOAD_COMPLETE_EVENT,model:this.model,memoryLimited:!1}),this.onDone&&(this.onDone(null,this.model),delete this.onDone)},F.prototype.loadPropertyDb=function(){this.svf.propDbLoader=new q.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propDbLoader.load()},F.prototype.fetchTopologyFile=function(a,b){function c(a){if(a.data["status-topology"])return e=(new Date).getTime(),g=Math.round((e-j)/1e3),void h.logger.log("Topology file downloaded. ("+g+" seconds). Processing...");var c=a.data["fetch-topology"];c&&(f=(new Date).getTime(),g=Math.round((f-e)/1e3),c.topology?h.logger.log("Topology file processed successfully! ("+g+" seconds)."):h.logger.log("Topology file processed, but an error ocurred. ("+g+" seconds)."),b(c),k.fetchingTopology=!1,d.clearAllEventListenerWithIntercept(),d.terminate(),d=null)}if(!this.fetchingTopology){this.fetchingTopology=!0;var d=(0,s.createWorkerWithIntercept)();d.addEventListenerWithIntercept(c);var e,f,g,i={path:a,queryParams:this.queryParams},j=(new Date).getTime();h.logger.log("Fetching topology file..."),i.operation="FETCH_TOPOLOGY",d.doOperation((0,z.initLoadContext)(i));var k=this}},F.prototype.is3d=function(){return!0},y.FileLoaderManager.registerFileLoader("svf",["svf","gltf","glb"],F)},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}Object.defineProperty(b,"__esModule",{value:!0}),b.SvfPagingProxy=void 0;var e=c(37),f=d(e),g=c(198),h=d(g),i=c(8),j=2,k=1048576;b.SvfPagingProxy=function(a,b){function c(a,b,c,d,f,g){function h(a,b,c){var d=null;if(b){var e=c-1;t=t+e&~e;var f=b.length;d=new a(s,t,f),d.set(b),t+=f*c}return d}var i,j=0,l=0,m=[],n=g.inMemory,o=!1,p=0,q=b.geoms;if(!c&&g.travsed>=g.currentCount)return 0;var r;for(r=0;r<g.totalCount;++r)!function(g){if(n[g>>5]&1<<(31&g)){var h=b.fragments.mesh2frag[a+":"+g];Array.isArray(h)&&(h=h[0]);var k=q.geoms[b.getGeometryId(h)];if(k&&k.packId==a){var r=k.vb.buffer===k.ib.buffer?k.vb.buffer.byteLength>k.vb.byteLength+k.ib.byteLength:k.vb.buffer.byteLength>k.vb.byteLength||k.ib.buffer.byteLength>k.ib.byteLength;(c||k.traversed!=d&&k.transparent!=f)&&(i=q.removeGeometry(k.svfid,e.viewer3DImpl.glrenderer()))>0?(l+=i,n[k.meshIndex>>5]&=~(1<<(31&k.meshIndex)),o=o||r):(++p,r&&(j+=k.vb.byteLength,j+=k.ib.byteLength+3&-4,m.push(k)))}else console.error("Mismapped or missing geometry %d:%d",a,g)}}(r);if(g.currentCount=p,g.culled=0,0==l)return 0;if(l/=k,0==m.length||!o)return l;var s=new ArrayBuffer(j),t=0;return m.forEach(function(a){a.vb=h(Float32Array,a.vb,4),a.ib=h(Uint16Array,a.ib,2)}),l}var d=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},e=a;this.options={onDemandLoading:!1,pageOutGeometryEnabled:!1},d(this.options,b),this.options.debug={maxPageOutSize:195,pixelCullingEnable:this.options.onDemandLoading,pixelCullingThreshold:f.PIXEL_CULLING_THRESHOLD,occlusionThreshold:1,occlusionTestThreshold:1,startOcclusionTestingPackCount:8,testPackfileCount:4,useOcclusionInstancing:!0,automaticRefresh:!0,boxProxyMaxCount:0,boxProxyMinScreen:.4},d(this.options.debug,b.debug),this.reachLimit=!1,this.geomidsmap={},this.geomTravCount=[],this.loadedPacks={},this.loadedPackfileCount=0,this.memoryOverhead=0,this.loadingPacks={},this.loadingPacksSize=0,this.queuedPacks=[],this.packQueuedMap={},this.queuedPacksSize=0,this.occludedPacks=[],this.occlusionCulledCount=0,this.packsPagedOut=0,this.traversedCounter=0,this.transparentCounter=0,this.resetCount=0,this.invalidateCount=-1,this.geompacks=e.svf.geompacks,this.geommap=e.geommap,this.totalGeomSize=this.options.totalGeomSize,this.overheadSize=this.options.overheadSize,this.minMemoryLimit=Math.min(Math.max(.1*this.totalGeomSize,10),50)+this.overheadSize,this.lastPageOut=-1,this.pageOutResetCounter=-1;var g,l=!1,m=0,n=0,o=0,p=[],q=-1,r=[],s=!0,t=null,u=0,v=!0,w=!1,x=function(a){this.resetCanPageOut(!!a.debug.unloadPackFiles,0!=a.delay,!1)}.bind(this);e.viewer3DImpl&&e.viewer3DImpl.api.addEventListener(h.LOAD_MISSING_GEOMETRY,x),this.dtor=function(){e.viewer3DImpl&&e.viewer3DImpl.api.removeEventListener(h.LOAD_MISSING_GEOMETRY,x)},this.onDemandLoadingEnabled=function(){return this.options.onDemandLoading},this.pageOutGeometryEnabled=function(){return this.options.pageOutGeometryEnabled&&this.onDemandLoadingEnabled()},this.pixelCullingEnable=function(){return this.options.debug.pixelCullingEnable},this.pixelCullingThreshold=function(){return this.options.debug.pixelCullingThreshold},this.getMemoryLimit=function(){return Math.max(this.minMemoryLimit,this.options.limit)},this.getMemoryInfo=function(){return this.onDemandLoadingEnabled()?{limit:this.options.limit,effectiveLimit:this.getMemoryLimit(),loaded:this.preparedPackFilesSize()}:null},this.getLoadedMeshes=function(a){var b=this.loadedPacks[a];return b&&b.inMemory},this.loadPackFile=function(){return!0},this.doLoadPackFile=function(a){return!!this.onDemandLoadingEnabled()&&(!!this.loadingPacks[a]||!0!==this.occludedPacks[a]&&(this.queuedPacks.length>0||this.occlusionTesting>=1?!!this.addGeomPackMissingLastFrame(a)&&(this.loadGeometryMissingLastFrame(),!0):e.loadGeometryPackOnDemand(a,this.getLoadedMeshes(a))))},this.unloadPackFile=function(a,b,d){if(!this.onDemandLoadingEnabled())return!1;var f=e.model.getFragmentList(),g=this.loadedPacks[a];return!!(f&&g&&f.geoms)&&(c(a,f,b,this.traversedCounter,this.transparentCounter,g),0==g.currentCount&&(delete this.loadedPacks[a],--this.loadedPackfileCount,d&&++this.packsPagedOut),!0)};var y=function(){if(this.resetCount!=this.pageOutResetCounter)return!1;e.viewer3DImpl.invalidate(!1,!0)}.bind(this);this.onPackFileLoaded=function(a,b,c){var d=this.geommap[a];if(w=!1,this.loadingPacks.hasOwnProperty(a)&&(delete this.loadingPacks[a],this.loadingPacksSize-=d.geomSize+d.usize),b){var e=this.loadedPacks[a];if(!e){var f=b.meshes.length;e=this.loadedPacks[a]={totalCount:f,travsed:0,culled:0,resetCounter:this.resetCount,geomSize:0,inMemory:new Array((f+31)/32|0)},++this.loadedPackfileCount,this.options.debug.occlusionTestThreshold>0&&0==this.occlusionTesting&&this.loadedPackfileCount>=this.options.debug.startOcclusionTestingPackCount&&(this.occlusionTesting=1)}e.geomSize+=c,e.currentCount=e.totalCount,e.inMemory.fill(-1),this.totalGeomSize+=e.geomSize-d.geomSize,this.packQueuedMap[a]&&(this.queuedPacksSize+=e.geomSize-d.geomSize),d.geomSize=e.geomSize,y()}this.loadedGeometrySize()>this.getMemoryLimit()&&i.logger.warn("More pack files being loaded than the max count: "+this.loadedGeometrySize())},this.checkLoadFinished=function(){if(!w){var a=e.pack_workers;if(a)for(var b=0;b<a.length;b++)if(0!=a[b].queued)return;(0!=this.geomPacksMissingLastFrame().length||m<p.length)&&(this.loadedGeometrySize()<this.getMemoryLimit()||v)||(w=!0,e.onDemandGeomLoadDone())}},this.doOnDemandLoadFinished=function(){this.loadGeometryMissingLastFrame(),this.checkLoadFinished()},this.onPackFileLoading=function(a){if(!this.loadingPacks.hasOwnProperty(a)){this.loadingPacks[a]=!0;var b=this.geommap[a];this.loadingPacksSize+=b.geomSize+b.usize}},this.onProcessReceivedMesh=function(a,b){var c=a.svfid;this.onDemandLoadingEnabled()&&b>1&&null==this.geomidsmap[c]&&(this.geomidsmap[c]=this.geomTravCount.length,this.geomTravCount.push(0))},this.loadedGeometrySize=function(){return e.model.getGeometryList().geomMemory/k+this.overheadSize},this.preparedPackFilesSize=function(){return this.loadingPacksSize+this.loadedGeometrySize()},this.cancelPending=function(){this.loadingPacksSize>1/k&&(e.cancelGeometryPackLoading(),this.loadingPacks={},this.loadingPacksSize=0),this.queuedPacks.length=0,this.queuedPacksSize=0,this.packQueuedMap={},this.occlusionTesting=this.onDemandLoadingEnabled()&&this.options.debug.occlusionTestThreshold>0&&this.loadedPackfileCount>=this.options.debug.startOcclusionTestingPackCount?1:0,this.occludedPacks.length=0},this.resetIterator=function(a){this.lastCamera=a,++this.resetCount},this.reset=function(){var a=this.loadedPacks;for(var b in a)a[b].travsed=0,a[b].culled=0;this.geomTravCount.fill(0),this.resetCount>this.invalidateCount&&(this.cancelPending(),this.resetCanPageOut(!1,!0,!0))},this.geomPacksMissingLastFrame=function(){return this.queuedPacks},this.addGeomPackMissingLastFrame=function(a){if(!this.onDemandLoadingEnabled())return!0;if(this.pageOutGeometryEnabled()&&this.loadedGeometrySize()>=this.getMemoryLimit()&&(this.reachLimit=!0),!this.packQueuedMap[a]){var b=this.geommap[a];b&&(this.queuedPacks.push(a),this.queuedPacksSize+=b.geomSize,this.packQueuedMap[a]=!0)}return!0},this.loadGeometryMissingLastFrame=function(){var a,b=this.queuedPacks;for(a=0;a<b.length;++a){var c=b[a];if(this.occlusionTesting>=1&&void 0===this.occludedPacks[c])break;if(!this.geommap[c].loading&&!this.occludedPacks[c]&&!e.loadGeometryPackOnDemand(c,this.getLoadedMeshes(c)))break}0!=a||w||y();var d=this;b.splice(0,a).forEach(function(a){d.queuedPacksSize-=d.geommap[a].geomSize,delete d.packQueuedMap[a]})},this.needResumeNextFrame=function(){return l};var z=function(a,b){var c=a>=r.length?1e10:r[a];return(b>=r.length?1e10:r[b])-c}.bind(this.loadedPacks);this.markVisibleGeoms=function(a){var b,c=e.model.getData().instanceTree||e.model.getData().fragmentMap;if(c&&a.visibleIdCB&&(b=a.visibleIdCB())){var d,f,g=++this.traversedCounter,h={},i=b.length,j=this.loadedPacks;for(f in j)j[f].travsed=0;for(var k=0;k<i;k+=4)d=b[k]|b[k+1]<<8|b[k+2]<<16,(d=d<<8>>8)>0&&(h[d]=1+(0|h[d]));var l=e.model.getFragmentList(),m=0|this.options.debug.occlusionThreshold;for(f in h)d=Number(f),h[d]>=m&&c.enumNodeFragments(d,function(a){var b=l.getGeometry(a);if(b){var c=j[b.packId];c&&b.traversed!=g&&++c.travsed,b.traversed=g}})}},this.pageOut=function(a,b,c){l=!1;var d=f.PAGEOUT_SUCCESS;if(a&&this.options.debug.occlusionTestThreshold>0&&this.loadedPackfileCount>=this.options.debug.startOcclusionTestingPackCount&&(this.occlusionTesting=j),this.occlusionTest(c),!a)return d;this.pageOutResetCounter=this.resetCount;var e=this.loadedGeometrySize();if(v=!0,e&&(this.reachLimit||e>this.getMemoryLimit())){this.markVisibleGeoms(c);var g=this.loadedPacks,h=Object.keys(g),k=!1;h.sort(z);var m=e-Math.min(e,this.options.debug.maxPageOutSize);return h.every(function(a){return g[a].resetCounter<this.resetCount?this.unloadPackFile(a,!1,!0):k=!0,this.loadedGeometrySize()>m}.bind(this)),
b&&this.loadedGeometrySize()==e&&g[h[0]].resetCounter<this.resetCount&&(this.unloadPackFile(h[0],!1,!0),i.logger.log("A force page out occur.")),this.loadedGeometrySize()==e?(d=f.PAGEOUT_SUCCESS,this.reachLimit=!0):(this.reachLimit=!1,this.loadGeometryMissingLastFrame(),l=!0),this.lastPageOut=e-this.loadedGeometrySize(),i.logger.log("[On Demand Loading] Unload pack files size: "+this.lastPageOut),window&&window.gc&&window.gc(),0==this.lastPageOut&&(v=k,this.checkLoadFinished()),d}return l=l||this.queuedPacks.length>0,this.loadFragsFromLoadOrder(),d},this.occlusionTest=function(a){function b(a){var b=k.fragments.packIds;if(!b)return null;var c=[];return a.forEach(function(a){for(var d=[],e=b.lastIndexOf(a);e>=0;)b[e]==a?d.push(e--):e=b.lastIndexOf(a,e-1);c.push(d)}),c}function c(b){var c=null;p=0;var d=a.queuedPacks,e=a.occludedPacks;b=Math.min(4,b||4);for(var f=d.length,g=0;g<f&&b>0;++g){var h=d[g];void 0===e[h]?(c=c||[],c.push(h),--b):e[h]||++p}return c}function d(b){m=null;for(var c=0;c<n.length;++c)a.occludedPacks[n[c]]=!b[c],b[c]||(i.logger.debug("[On Demand Loading] Occluded Geometry Pack file: "+n[c]),++a.occlusionCulledCount);a.doOnDemandLoadFinished(),f()}function f(){o||m||w||(m=null,h&&!l&&(n=c(a.options.debug.testPackfileCount))&&(o=setTimeout(function(){o=0;var c=b(n);m=h(k.boxes,a.options.debug.occlusionTestThreshold,c,a.options.debug.useOcclusionInstancing,n),m.then(d,function(){d([!0,!0,!0,!0])})},p*q)))}function g(a){m||this.occlusionTesting<j||(a&&(h=a.occlusionTestCB,l=a.moved),(k=e.model.getFragmentList())&&h&&!l&&f())}var h=null,k=null,l=!1,m=null,n=null,o=0,p=0,q=3;return g}(this),this.loadFragsFromLoadOrder=function(){for(var a=e.model.getFragmentList();m<p.length;){for(var b=p[m],c=b.length;n<c;){var d=b[n];if(!a.getGeometry(d)){var f=a.fragments.packIds?a.fragments.packIds[d]:d,g=this.queuedPacks.length;if(!this.doLoadPackFile(f)&&g==this.queuedPacks.length)return}++n}++m,n=0}},this.pfOrder=function(){return g},this.getNumVisiblePFs=function(){return g?q:-1},this.onLoadOrderCalculated=function(a){if(a.error)return void(t=null);if(a.fragOrder&&a.packOrder&&(t=a),a.id==o&&t){if(this.lastPageOut=-1,v=!0,w=!1,p.length=0,e.model){var b=e.model.getFastLoadList();b&&(i.logger.log("Using PF fast-load-list for homeView, size:",b.length),p.push(b))}p.push(t.fragOrder),g=t.packOrder,q=t.pfVisible;var c,d=g.length;for(r.length=this.geompacks.length,r.fill(1e10),c=0;c<d;++c)r[g[c]]=c;var f,h=e.model.getFragmentList(),j=this.overheadSize,k=this.getMemoryLimit();for(f=0;f<p.length&&j<k;++f){var l=p[f];d=l.length;var s=[];s.length=r.length,s.fill(0);var u=this.geompacks;for(c=0;c<d&&j<k;++c){var x=l[c],y=h.fragments.packIds?h.fragments.packIds[x]:x,z=u[y];if(z){var A=h.getGeometry(x)?z.geomSize:z.totalGeomSize;A>s[y]&&(j+=A-s[y],s[y]=A)}}}var B=this.loadedPacks;for(var C in B)B.hasOwnProperty(C)&&(s[C]||this.unloadPackFile(C,!0));++this.traversedCounter,++this.transparentCounter,this.reachLimit=this.loadedGeometrySize()>=this.getMemoryLimit(),this.cancelPending(),m=0,n=0,this.loadFragsFromLoadOrder(),e.viewer3DImpl.invalidate(!0),this.invalidateCount=this.resetCount+1}},this.resetCanPageOut=function(a,b,c){function d(){if(u=0,s||!c||f.options.debug.automaticRefresh){f.occlusionCulledCount=0,f.packsPagedOut=0;var b,d=f.lastCamera,g=f.loadedPacks;if(a)for(b in g)g.hasOwnProperty(b)&&f.unloadPackFile(b,!0);e.calculateLoadOrder(++o,d,f.options.debug.pixelCullingEnable?f.options.debug.pixelCullingThreshold:-1),s=!1}}u&&(clearTimeout(u),u=0);var f=this;b?u=setTimeout(d,100):d()},this.onGeomTraversed=function(a,b){var c=a.packId,d=a.svfid;a.traversed=this.traversedCounter,b&&(a.transparent=this.transparentCounter);var e=!0,f=this.geomidsmap[d];null!=f&&(this.geomTravCount[f]+=2,this.geomTravCount[f]|=1,e=a.instanceCount==this.geomTravCount[f]>>1);var g=this.loadedPacks[c];g&&e&&g.travsed++},this.onGeomCulled=function(a){if(a){var b=a.packId,c=a.svfid,d=this.geomidsmap[c],e=!d;null!=d&&(1&this.geomTravCount[d]?this.onGeomTraversed(a):(this.geomTravCount[d]+=2,e=a.instanceCount==this.geomTravCount[d]>>1));var f=this.loadedPacks[b];f&&e&&f.culled++}}}},function(a,b,c){"use strict";function d(a,b){this.viewer3DImpl=a,this.loading=!1,this.tmpMatrix=new THREE.Matrix4,this.overrideModelConstructor=b&&b.overrideModelConstructor,this.logger=f.logger,this.loadTime=0,this.useInstancing=this.viewer3DImpl.use2dInstancing}function e(a,b){function c(){if(this.fragIds)return a;if(!this.model||!this.data||!this.data.meshes)return null;for(var a=this.fragIds=[],b=0|this.data.baseIndex,c=0;c<this.data.meshes.length;++c)a.push(b++);return a}a.viewer3DImpl.api.dispatchEvent({type:q.FRAGMENTS_LOADED_EVENT,model:a.model,getFragIds:c,data:b})}Object.defineProperty(b,"__esModule",{value:!0}),b.F2DLoader=d;var f=c(8),g=c(125),h=c(13),i=c(210),j=c(199),k=c(12),l=c(10),m=c(37),n=c(220),o=c(4),p=c(198),q=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(p),r=c(139),s=c(9),t=c(207),u=c(253);d.prototype.dtor=function(){this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,f.logger.debug("F2D loader dtor: on init worker script.")),this.streamingWorker&&(this.streamingWorker.terminate(),this.streamingWorker=null,f.logger.debug("F2D loader dtor: on streaming worker.")),this.parsingWorker&&(this.parsingWorker.terminate(),this.parsingWorker=null,f.logger.debug("F2D loader dtor: on parsing worker.")),this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.viewer3DImpl=null,this.loading=!1,this.tmpMatrix=null,this.logger=null,this.loadTime=0,this.svf=null,this.options=null,this.pagingProxy=null},d.prototype.isValid=function(){return!!this.viewer3DImpl},d.prototype.loadFile=function(a,b,c,d){if(!this.viewer3DImpl)return f.logger.log("F2D loader was already destructed. So no longer usable."),!1;if(this.loading)return f.logger.log("Loading of F2D already in progress. Ignoring new request."),!1;this.loading=!0,this.viewer3DImpl._addLoadingFile(this);var e=a.indexOf("urn:");if(-1!=e){a=decodeURIComponent(a);var g=a.substr(e,a.substr(e).indexOf("/"));f.logger.log("Extracted URN: "+g);var h=g.lastIndexOf(":");this.svfUrn=g.substr(h+1)}else this.svfUrn=a;this.sharedDbPath=b.sharedPropertyDbPath,this.currentLoadPath=a,this.acmSessionId=b.acmSessionId,this.queryParams="",this.acmSessionId&&(this.queryParams="acmsession="+this.acmSessionId),this.options=b,this.options.placementTransform?this.modelScale=this.options.modelScale||this.options.placementTransform.getMaxScaleOnAxis():this.modelScale=this.options.modelScale||1,this.isf2d=!0;var i=this,j=this.viewer3DImpl.api.config&&this.viewer3DImpl.api.config.memory,k=this.memoryOpts={onDemandLoading:!1,debug:{}};return j&&(j.hasOwnProperty("limit")&&(k.limit=j.limit,k.onDemandLoading=!0,k.pageOutGeometryEnabled=!0),k.debug=j.debug||{}),this.initWorkerScriptToken=(0,l.initWorkerScript)(function(){i.loadFydoCB(a,b,c,d)}),!0};d.prototype.loadFydoCB=function(a,b,c,d){this.t0=Date.now();var g=(0,k.pathToURL)(a);this.streamingWorker=(0,l.createWorker)(),this.parsingWorker=(0,l.createWorker)();var j=this,n=!0,p=function(){j.memoryOpts.onDemandLoading||(j.parsingWorker.terminate(),j.parsingWorker=null)},r=function(a){if(j.isValid()){var e=function(a){if(a){var b=a.geom_metrics,c=3*(b.arcs+b.circ_arcs);c+=b.circles,c+=b.pline_points-(b.plines||0),c+=b.rasters,c+=b.ptri_indices/3*3;var d,e=(0,o.isMobileDevice)()?16383:32767;j.useInstancing?(c+=b.ptri_indices/3,d=0,e/=4):(d=6*c+b.ptri_indices,c*=4,c+=b.ptri_points);var f=(c*(48+m.GEOMETRY_OVERHEAD/e)+2*d)/1048576+j.fileMemorySize,g=j.memoryOpts;g.onDemandLoading&&!g.debug.force&&f<g.limit&&(g.onDemandLoading=!1,g.pageOutGeometryEnabled=!1),j.totalGeomSize=f}return j.memoryOpts.onDemandLoading};n&&d&&(n=!1,d());var k;a.data&&"F2DBLOB"==a.data.type?(a.data.hasOwnProperty("f2dSize")&&(j.fileMemorySize=a.data.f2dSize/1048576),e(a.data.metadata),k={operation:"PARSE_F2D",data:a.data.buffer,metadata:a.data.metadata,manifest:a.data.manifest,basePath:a.data.basePath,f2dLoadOptions:{modelSpace:b.modelSpace,bgColor:b.bgColor,isMobile:(0,o.isMobileDevice)(),useInstancing:j.useInstancing,onDemandLoading:j.memoryOpts.onDemandLoading},url:g},j.parsingWorker.doOperation(k,[k.data]),j.streamingWorker.terminate(),j.streamingWorker=null):a.data&&"F2DSTREAM"==a.data.type?(a.data.hasOwnProperty("f2dSize")&&(j.fileMemorySize=2*a.data.f2dSize/1048576),e(a.data.metadata),k={operation:"PARSE_F2D_FRAME",data:a.data.frames,url:g,f2dLoadOptions:{modelSpace:b.modelSpace,bgColor:b.bgColor,isMobile:(0,o.isMobileDevice)(),useInstancing:j.useInstancing,onDemandLoading:j.memoryOpts.onDemandLoading}},a.data.metadata&&(k.metadata=a.data.metadata,k.manifest=a.data.manifest),a.data.finalFrame&&(k.finalFrame=!0,j.streamingWorker.terminate(),j.streamingWorker=null,j.fileMemorySize/=2),a.data.progress&&j.viewer3DImpl.signalProgress(100*a.data.progress,i.ProgressState.LOADING),j.parsingWorker.doOperation(k,k.data?[k.data]:void 0)):a.data&&"F2DAssetURL"==a.data.type||a.data&&a.data.assetRequest||a.data&&a.data.progress||(a.data&&a.data.debug?f.logger.debug(a.data.message):a.data&&a.data.error?(j.loading=!1,j.streamingWorker.terminate(),j.streamingWorker=null,c&&c.call(this,a.data.error)):(f.logger.error("F2D download failed.",(0,h.errorCodeString)(h.ErrorCodes.NETWORK_FAILURE)),j.loading=!1,j.streamingWorker.terminate(),j.streamingWorker=null))}},t=function(a){if(j.isValid()){n&&d&&(n=!1,d());var b,g;if(a.data&&a.data.f2d){for(b=j.svf=a.data.f2d,p(),f.logger.info("Num polylines: "+b.numPolylines),f.logger.info("Line segments: "+b.numLineSegs),f.logger.info("Circular arcs: "+b.numCircles),f.logger.info("Ellipitcal arcs:"+b.numEllipses),f.logger.info("Plain triangles:"+b.numTriangles),f.logger.info("Total # of op codes generated by fydo.parse: "+b.opCount),j.onModelRootLoadDone(j.svf),c&&c(null,j.model),j.viewer3DImpl.api.dispatchEvent({type:q.MODEL_ROOT_LOADED_EVENT,svf:j.svf,model:j.model}),g=0;g<b.meshes.length;g++)j.processReceivedMesh2D(b.meshes[g],g);b.meshes=null,j.onGeomLoadDone(),j.loading=!1}else if(a.data&&a.data.f2dframe){var i=0;if(a.data.meshes){var k=a.data.bbox;j.svf.bbox=new THREE.Box3(k.min,k.max),i=a.data.baseIndex}else j.svf=a.data.f2dframe,i=a.data.baseIndex;if(b=j.svf,b.fragments&&b.fragments.initialized||(j.onModelRootLoadDone(b),c&&c(null,j.model),j.viewer3DImpl.api.dispatchEvent({type:q.MODEL_ROOT_LOADED_EVENT,svf:b,model:j.model})),a.data.meshes&&a.data.meshes.length){for(g=0;g<a.data.meshes.length;g++)j.processReceivedMesh2D(a.data.meshes[g],i+g);j.pagingProxy&&j.pagingProxy.onDemandLoadingEnabled()&&e(j,a.data)}if(a.data.finalFrame){var l=a.data.cumulativeProps;for(var m in l)b[m]=l[m];p(),j.onGeomLoadDone(),j.loading=!1,j.pagingProxy&&j.pagingProxy.onFinalFrame()}}else a.data&&a.data.progress||(a.data&&a.data.debug?f.logger.debug(a.data.message):a.data&&a.data.canceled&&j.pagingProxy?j.pagingProxy.cancelAcknowledged():a.data&&a.data.error?(j.loading=!1,p(),f.logger.error("Error while processing F2d: "+JSON.stringify(a.data.error.args)),c&&c.call(this,a.data.error)):(f.logger.error("F2D download failed.",(0,h.errorCodeString)(h.ErrorCodes.NETWORK_FAILURE)),j.loading=!1,p()))}};this.streamingWorker.addEventListener("message",r,!1),this.parsingWorker.addEventListener("message",t,!1);var u={operation:"STREAM_F2D",url:g,objectIds:b.ids,queryParams:this.queryParams};return this.streamingWorker.doOperation(s.endpoint.initLoadContext(u)),!0},d.prototype.processReceivedMesh=function(a){var b=a.packId+":"+a.meshIndex,c=this.svf,d=c.fragments,e=d.mesh2frag[b];if(void 0===e)return void f.logger.warn("Mesh "+b+" was not referenced by any fragments.");Array.isArray(e)||(e=[e]),g.BufferGeometryUtils.meshToGeometry(a);var h=e.length,i=this.model;i.getGeometryList().addGeometry(a.geometry,h,a.meshIndex+1);for(var j=a.geometry.attributes.index.array||a.geometry.ib,k=j.length/3,l=0;l<e.length;l++){var m=0|e[l];i.getFragmentList().getOriginalWorldMatrix(m,this.tmpMatrix),this.options.placementTransform&&(this.tmpMatrix=(new THREE.Matrix4).multiplyMatrices(this.options.placementTransform,this.tmpMatrix));var n=d.materials[m].toString();d.polygonCounts&&(d.polygonCounts[m]=k);var o=this.viewer3DImpl.setupMesh(this.model,a.geometry,n,this.tmpMatrix);i.activateFragment(m,o)}d.mesh2frag[b]=null,d.numLoaded+=e.length,d.numLoaded},d.prototype.processReceivedMesh2D=function(a,b){if(!this.pagingProxy||this.pagingProxy.onMeshReceived(a,b)){var c={mesh:a,is2d:!0,packId:"0",meshIndex:b},d="0:"+b,e=this.svf.fragments;if(!e.fragId2dbId[b]){var f=Object.keys(c.mesh.dbIds).map(function(a){return parseInt(a)});e.fragId2dbId[b]=f;for(var g=0;g<f.length;g++){var h=f[g],i=e.dbId2fragId[h];Array.isArray(i)?i.push(b):e.dbId2fragId[h]=void 0!==i?[i,b]:b}a.material.modelScale=this.modelScale;var j=this.viewer3DImpl;e.materials[b]=this.viewer3DImpl.matman().create2DMaterial(this.model,a.material,!1,!1,function(a,b){var c=b.getData();r.TextureLoader.requestsInProgress()||!c.loadDone||c.texLoadDone||(c.texLoadDone=!0,j.onTextureLoadComplete(b)),j.invalidate(!1,!0,!1)}),e.length++}e.mesh2frag[d]=b,this.processReceivedMesh(c)}},d.prototype.onModelRootLoadDone=function(a){a.fragments={},a.fragments.mesh2frag={},a.fragments.materials=[],a.fragments.fragId2dbId=[],a.fragments.dbId2fragId=[],a.fragments.length=0,a.fragments.initialized=!0,a.geomMemory=0,a.fragments.numLoaded=0,a.gpuNumMeshes=0,a.gpuMeshMemory=0,a.nextRepaintPolys=1e4,a.numRepaints=0,a.urn=this.svfUrn,a.acmSessionId=this.acmSessionId,a.basePath="";var b=this.currentLoadPath.lastIndexOf("/");-1!=b&&(a.basePath=this.currentLoadPath.substr(0,b+1)),a.loadOptions=this.options;var c=Date.now();this.loadTime+=c-this.t0,f.logger.log("SVF load: "+(c-this.t0)),this.t0=c,a.bbox=(new THREE.Box3).copy(a.bbox);var d=this.model=this.overrideModelConstructor?new this.overrideModelConstructor(a):new t.Model(a);d.loader=this;var e=this.memoryOpts;this.viewer3DImpl.modelQueue().getModels().length>0&&(e.pageOutGeometryEnabled=!1),e.onDemandLoading&&(this.pagingProxy=new u.F2DPagingProxy(this,e)),d.initialize(this.pagingProxy),!(this.model.getFragmentList().onDemandLoadingEnabled()&&(0,o.isMobileDevice)())&&!this.options.skipPropertyDb&&(this.svf.propDbLoader=new n.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api)),f.logger.log("scene bounds: "+JSON.stringify(a.bbox));var g={category:"metadata_load_stats",urn:a.urn,layers:a.layerCount};f.logger.track(g),this.viewer3DImpl.signalProgress(5,i.ProgressState.ROOT_LOADED),this.viewer3DImpl.invalidate(!1,!1)},d.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,this.svf.fragments.entityIndexes=null,this.memoryOpts.onDemandLoading||(this.svf.fragments.mesh2frag=null);var a=Date.now(),b="Fragments load time: "+(a-this.t0);this.loadTime+=a-this.t0,r.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),this.options.skipPropertyDb||this.loadPropertyDb(),f.logger.log(b);var c={category:"model_load_stats",is_f2d:!0,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,urn:this.svfUrn};f.logger.track(c,!0),this.currentLoadPath=null,this.isf2d=void 0,this.memoryOpts.onDemandLoading?this.viewer3DImpl.onDemandLoadComplete(this.model):this.viewer3DImpl.onLoadComplete(this.model)},d.prototype.loadPropertyDb=function(){this.svf.propDbLoader&&this.svf.propDbLoader.load()},d.prototype.is3d=function(){return!1},j.FileLoaderManager.registerFileLoader("f2d",["f2d"],d)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.F2DPagingProxy=void 0;var d=c(4),e=c(37),f="PARSE_F2D_FRAME",g=1,h=2,i=4,j=8,k=1048576;b.F2DPagingProxy=function(a,b){function c(a){for(;++a<p.length&&(p[a]&(i|j))!=i;);return a}function l(a){var b=0;if(n.model){var d=n.model.getGeometryList();d&&(b=d.geomMemory/k)}for(var e=c(u),i=b+n.fileMemorySize+o;i+s<a.limit;){var l=-1,m=null;if(r.length>0&&(y||e>p.length))m=r.shift(),l=m.lmv_buffer_id;else{if(!(e<p.length))break;l=e,u=e,e=c(e),y=!0}n.parsingWorker.doOperation({operation:f,bufferId:l,rendered:!!(p[l]&g),promised:!!(p[l]&h),conditional:!!(p[l]&j)}),p[l]&j||(s+=o,p[l]|=j)}}var m=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},n=a;this.options={onDemandLoading:!1,pageOutGeometryEnabled:!1},m(this.options,b),this.options.debug={pageOutStart:.75,pageOutEnd:.5,pixelCullingEnable:!1,pixelCullingThreshold:e.PIXEL_CULLING_THRESHOLD},m(this.options.debug,b.debug);var o,p=[],q={},r=[],s=0,t=0,u=-1,v=-1,w=-1,x=0,y=!0,z=0;n.useInstancing?(o=((0,d.isMobileDevice)()?16383:32767)/4|0,o=48*o/k):o=3932100/k;var A=!1,B=[];this.options.limit=Math.max(this.options.limit,10),this.options.debug.pageOutEnd=Math.min(this.options.debug.pageOutEnd,this.options.debug.pageOutStart),this.totalGeomSize=a.totalGeomSize,this.onDemandLoadingEnabled=function(){return this.options.onDemandLoading},this.pageOutGeometryEnabled=function(){return this.options.onDemandLoading},this.pixelCullingEnable=function(){return this.options.debug.pixelCullingEnable},this.pixelCullingThreshold=function(){return this.options.debug.pixelCullingThreshold},this.getMemoryInfo=function(){var a=0;if(n.model){var b=n.model.getGeometryList();b&&(a=b.geomMemory/k)}return this.onDemandLoadingEnabled()?{limit:this.options.limit,effectiveLimit:this.options.limit,loaded:a+n.fileMemorySize}:null},this.loadPackFile=function(a){return!!this.onDemandLoadingEnabled()&&(!(a<0||A&&a>=z)&&(a>w&&(w=a),p[a]&g||(a<=u&&this.reset(),p[a]|=i|g),l(this.options),!0))},this.promisePackFile=function(a){if(!this.onDemandLoadingEnabled())return Promise.reject({reason:"Not supported"});if(a<0||a>=z)return Promise.reject({reason:"Buffer id out of bounds"});var b=q[a];if(b)return l(this.options),b;var c,d;return b=new Promise(function(a,b){c=a,d=b}),b.lmv_resolve=c,b.lmv_reject=d,b.lmv_buffer_id=a,r.push(b),q[a]=b,p[a]|=i|h,l(this.options),b},this.cancelPromisedPackFile=function(a){if(!a||!a.hasOwnProperty("lmv_buffer_id")||q[a.lmv_buffer_id]!=a)return!1;var b=r.indexOf(a);b>=0&&r.splice(b,1);var c=p[a.lmv_buffer_id];return c&j&&(n.parsingWorker.doOperation({operation:f,cancelPromise:a.lmv_buffer_id}),c&g||(s-=o)),c&g?c&=~h:c=0,p[a.lmv_buffer_id]=c,delete q[a.lmv_buffer_id],a.lmv_reject&&a.lmv_reject({canceled:!0}),l(this.options),!0},this.resetIterator=function(){},this.reset=function(){n.parsingWorker.doOperation({operation:f,cancel:!0}),s=0;for(var a=0;a<p.length;++a)p[a]&h?(p[a]&=~g,p[a]&j&&(s+=o)):p[a]=0;this.lastPageOut=-1,u=-1,v=-1,B.length=0,w=z-1,++x},this.addGeomPackMissingLastFrame=function(){return!0},this.needResumeNextFrame=function(){return!1},this.pageOut=function(a,b){var c=n.model.getGeometryList(),d=c.geomMemory/k+n.fileMemorySize,f=Math.min(this.options.debug.pageOutStart*this.options.limit,this.options.limit-1.1*o),g=Math.min(this.options.debug.pageOutEnd*this.options.limit,f);if(d>f){for(var h=0,i=d-g;h<B.length&&i>0;)i-=c.removeGeometry(B[h++],n.viewer3DImpl.glrenderer())/k;for(B.splice(0,h),h=c.geoms.length;--h>0&&i>0;)(h<=v||h>u)&&(i-=c.removeGeometry(h,n.viewer3DImpl.glrenderer())/k);if(b)for(i=c.geomMemory/k-f,h=u;h>0&&i>0;--h)i-=c.removeGeometry(h,n.viewer3DImpl.glrenderer())/k;this.lastPageOut=d-c.geomMemory/k,window&&window.gc&&window.gc()}var j=c.geomMemory/k;if(a&&!A){var l=this.options.limit-j;if(l>0)for(var m=u;(l-=o)>=0;)this.loadPackFile(++m)}return e.PAGEOUT_SUCCESS},this.onGeomTraversed=function(a){v=a.svfid-1},this.onGeomCulled=function(a){this.onDemandLoadingEnabled()&&a&&B.push(a.svfid-1)},this.onMeshReceived=function(a,b){if(!this.onDemandLoadingEnabled())return!0;var c=q[b];if(c){c.lmv_resolve&&c.lmv_resolve(),delete q[b];var d=r.indexOf(c);d>=0&&r.splice(d,1)}return!!(p[b]&j&&(0==x||p[b]&h))&&(b>=z&&(z=b+1,t+=a.vb.byteLength+a.indices.byteLength+e.GEOMETRY_OVERHEAD),p[b]&g&&n.viewer3DImpl.invalidate(!1,!0),p[b]=0,s-=o,!0)},this.onFinalFrame=function(){this.onDemandLoadingEnabled()&&(A||(this.totalGeomSize=t/k+n.fileMemorySize),A=!0,p.splice(z,p.length).forEach(function(a){a&j&&(s-=o)}))},this.preparedPackFilesSize=function(){return n.fileMemorySize+s+n.model.getGeometryList().geomMemory/k},this.cancelAcknowledged=function(){--x}}},function(a,b,c){"use strict";function d(a){for(var b=[],c=Array.isArray(a.image)?a.image:[a.image],d=0;d<c.length;d++)for(var e=c[d],f=0;f<e.mipmaps.length;f++){var g=e.mipmaps[f];b.push(g.data.buffer)}return b}Object.defineProperty(b,"__esModule",{value:!0}),b.DecodeEnvMapAsync=void 0;var e=c(8),f=c(2),g=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(f),h=c(10),i=null,j=1;b.DecodeEnvMapAsync=function(a,b,c,f){if(!a.LogLuv)return void e.logger.warn("Environment map expected to be in LogLuv format.");i||(i=(0,h.createWorker)());var k=j++,l=function b(d){if(d.data.id===k){i.removeEventListener("message",b);var e=d.data.map;a.image=e.image,a.LogLuv=!1,c?(a.type=g.HalfFloatType,a.format=g.RGBFormat,a.RGBM=!1,a.GammaEncoded=!0):a.RGBM=!0,f(a)}};i.addEventListener("message",l),i.doOperation({operation:"DECODE_ENVMAP",map:a,exposure:b,useHalfFloat:c,id:k},d(a))}},function(a,b,c){"use strict";function d(a){this.viewer3DImpl=a,this.loading=!1,this.tmpMatrix=new f.LmvMatrix4,this.tmpBox=new g.LmvBox3,this.logger=i.logger,this.loadTime=0,this.pendingMaterials={},this.pendingMaterialsCount=0,this.pendingMeshes={},this.pendingMeshesCount=0,this.operationsDone=0}function e(a){return Math.floor(100*a.fragsLoaded/a.metadata.stats.num_fragments)}Object.defineProperty(b,"__esModule",{value:!0}),b.OtgLoader=d;var f=c(128),g=c(122),h=c(119),i=c(8),j=c(139),k=c(191),l=c(220),m=c(10),n=c(9),o=c(12),p=c(256),q=c(199),r=c(207),s=c(198),t=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(s),u=c(210),v=c(4),w=c(228);d.prototype.dtor=function(){this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,i.logger.debug("SVF loader dtor: on init worker script.")),this.bvhWorker&&(this.bvhWorker.clearAllEventListenerWithIntercept(),this.bvhWorker.terminate(),this.bvhWorker=null,i.logger.debug("SVF loader dtor: on svf worker.")),this.svf&&(this.svf.loadDone||console.log("stopping load before it was complete"),this.svf.abort(),this.svf.propWorker&&(this.svf.propWorker.dtor(),this.svf.propWorker=null)),this.viewer3DImpl.geomCache()&&this.model&&(this.loading&&this.viewer3DImpl.geomCache().cancelRequests(this.svf.geomMetadata.hashToIndex),this.removeMeshReceiveListener()),this.viewer3DImpl=null,this.model=null,this.svf=null,this.logger=null,this.tmpMatrix=null,this.loading=!1,this.loadTime=0},d.prototype.isValid=function(){return null!=this.viewer3DImpl},d.prototype.removeMeshReceiveListener=function(){this.meshReceiveListener&&(this.viewer3DImpl.geomCache().updateMruTimestamps(),this.viewer3DImpl.geomCache().removeEventListener(w.MESH_RECEIVE_EVENT,this.meshReceiveListener),this.viewer3DImpl.geomCache().removeEventListener(w.MESH_FAILED_EVENT,this.meshReceiveListener),this.meshReceiveListener=null)},d.prototype.loadFile=function(a,b,c,d){if(!this.viewer3DImpl)return i.logger.log("SVF loader was already destructed. So no longer usable."),!1;if(this.loading)return i.logger.log("Loading of SVF already in progress. Ignoring new request."),!1;if(this.loading=!0,this.viewer3DImpl._addLoadingFile(this),b.acmSessionId)this.svfUrn=b.acmSessionId;else{var e=a.indexOf("urn:adsk.fluent:fs.file:");if(-1!==e){var f=a.slice(e+"urn:adsk.fluent:fs.file:".length).split("/"),g=f[1],h=f[2],j=g+"?version="+h,k=btoa(j).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");this.svfUrn=k}}this.sharedDbPath=b.sharedPropertyDbPath,this.currentLoadPath=a;var l="",m=this.currentLoadPath.lastIndexOf("/");-1!=m&&(l=this.currentLoadPath.substr(0,m+1)),this.basePath=l,this.acmSessionId=b.acmSessionId,this.options=b;var p={basePath:l,objectIds:b.ids,globalOffset:b.globalOffset,placementTransform:b.placementTransform,applyRefPoint:b.applyRefPoint,queryParams:b.acmSessionId?"acmsession="+b.acmSessionId:"",bvhOptions:b.bvhOptions||{isWeakDevice:(0,v.isMobileDevice)()},applyScaling:b.applyScaling,loadInstanceTree:b.loadInstanceTree};return this.loadContext=(0,n.initLoadContext)(p),p.raiseError=function(a,b,d){var e={code:a,msg:b,args:d};c&&c(e)},p.onFailureCallback=o.ViewingService.defaultFailureCallback.bind(p),this.loadModelRoot(p,c),d&&d(),!0},d.prototype.loadModelRoot=function(a,b){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null;var c=this,d=this.svf=new p.OtgPackage;return d.basePath=a.basePath,a.onLoaderEvent=function(a,e){if(!c.svf)return void console.error("load callback called after load was aborted");if("otg_root"===a){c.onModelRootLoadDone(d),b&&b(null,c.model),c.makeBVHInWorker();var f=c.viewer3DImpl.geomCache();f||i.logger.error("geomCache is required for loading OTG models."),f.initWorker(c.svfUrn),c.meshReceiveListener=function(a){a.error&&a.error.args?c.onMeshError(a):c.onMeshReceived(a.geom)},f.addEventListener(w.MESH_RECEIVE_EVENT,c.meshReceiveListener),f.addEventListener(w.MESH_FAILED_EVENT,c.meshReceiveListener),c.svf.loadDone=!1}else if("fragment"===a)c.options.skipMeshLoad||c.tryToActivateFragment(e,"fragment"),c.options.onFragmentListLoadProgress&&c.trackFragmentListLoadProgress();else if("all_fragments"===a)c.options.skipPropertyDb||c.loadPropertyDb(),c.viewer3DImpl.api.fireEvent({type:t.MODEL_ROOT_LOADED_EVENT,svf:d,model:c.model}),c.options.skipMeshLoad||!c.svf.fragments.length?c.onGeomLoadDone():c.onOperationComplete();else if("bvh"===a){var g=e;c.model&&(c.model.setBVH(g.nodes,g.primitives,c.options.bvhOptions),c.viewer3DImpl&&c.viewer3DImpl.modelVisible(c.model.id)&&c.viewer3DImpl.invalidate(!1,!0)),c.onOperationComplete()}},d.loadRemainingSvf(a,(0,o.pathToURL)(this.currentLoadPath)),!0},d.prototype.makeBVHInWorker=function(){var a=this;this.initWorkerScriptToken=(0,m.initWorkerScript)(function(){a.bvhWorker=(0,m.createWorkerWithIntercept)();var b=function(b){if(b.data.bvh){console.log("Received BVH from worker");var c=b.data.bvh;a.model&&(a.svf.bvh=c,a.model.setBVH(new k.NodeArray(c.nodes,c.useLeanNodes),c.primitives,a.options.bvhOptions),a.viewer3DImpl&&a.viewer3DImpl.modelVisible(a.model.id)&&a.viewer3DImpl.invalidate(!1,!0)),a.bvhWorker.clearAllEventListenerWithIntercept(),a.bvhWorker.terminate(),a.bvhWorker=null,a.onOperationComplete()}};a.bvhWorker.addEventListenerWithIntercept(b);var c=Object.assign({},a.loadContext);c.operation="LOAD_OTG_BVH",c.raiseError=null,c.onFailureCallback=null,c.onLoaderEvent=null,c.fragments_extra=(0,o.pathToURL)(a.basePath)+a.svf.manifest.assets.fragments_extra,c.placementTransform=a.svf.placementTransform,c.placementWithOffset=a.svf.placementWithOffset,c.globalOffset=a.svf.globalOffset,c.fragments_extra?a.bvhWorker.doOperation(c):a.onOperationComplete()})},d.prototype.tryToActivateFragment=function(a,b){var c=this;if(c.model){var d=c.svf,e=c.model,f=e.getGeometryList(),g=d.fragments.materials[a],h=d.getMaterialHash(g),i=this.findOrLoadMaterial(e,h,g),j=!1;i||("fragment"===b&&this.pendingMaterials[h].push(a),"material"!==b?j=!0:console.log("material loading probably failed"));var k=d.fragments.geomDataIndexes[a];if(0===k)return void c.trackGeomLoadProgress(d,a,!1);e.getFragmentList().getOriginalWorldMatrix(a,c.tmpMatrix);var l=f.getGeometry(k);if(l||("fragment"===b&&this.loadGeometry(k,this.options.createWireframe?c.tmpMatrix:null,a),j=!0),!j){var m=c.viewer3DImpl.setupMesh(e,l,h,c.tmpMatrix);m.geomId=k,e.activateFragment(a,m,!!d.placementTransform),this.viewer3DImpl.geomCache().updateGeomImportance(e,a),c.trackGeomLoadProgress(d,a,!1)}}},d.prototype.onModelRootLoadDone=function(a){this.viewer3DImpl._removeLoadingFile(this),a.isOTG=!0,a.geomMetadata.hashToIndex={},a.failedFrags={},a.failedMeshes={},a.failedMaterials={},a.geomMemory=0,a.gpuNumMeshes=0,a.gpuMeshMemory=0,a.fragsLoaded=0,a.fragsLoadedNoGeom=0,a.nextRepaintPolys=0,a.numRepaints=0,a.urn=this.svfUrn,a.acmSessionId=this.acmSessionId,a.basePath=this.basePath,a.loadOptions=this.options;var b=Date.now();this.loadTime+=b-this.t0,i.logger.log("SVF load: "+(b-this.t0));var c=this.model=new r.Model(a);if(c.loader=this,c.initialize(),this.t0=b,a.bbox=(new g.LmvBox3).copy(a.bbox),a.refPointTransform&&(a.refPointTransform=new f.LmvMatrix4(!0).copy(a.refPointTransform)),a.placementTransform&&(a.placementTransform=new f.LmvMatrix4(!0).copy(a.placementTransform)),a.cameras)for(var d=0;d<a.cameras.length;d++){var e=a.cameras[d];e.position=(new h.LmvVector3).copy(e.position),e.target=(new h.LmvVector3).copy(e.target),e.up=(new h.LmvVector3).copy(e.up)}i.logger.log("scene bounds: "+JSON.stringify(a.bbox));var j={category:"metadata_load_stats",urn:a.urn,has_topology:!!a.topology,has_animations:!!a.animations,materials:a.metadata.stats.num_materials,is_mobile:(0,v.isMobileDevice)()};i.logger.track(j),this.viewer3DImpl.signalProgress(5,u.ProgressState.ROOT_LOADED,this.model),a.handleHashListRequestFailures(this.loadContext)},d.prototype.trackGeomLoadProgress=function(a,b,c){if(c){if(a.failedFrags[b])return void console.log("Double fail",b);a.failedFrags[b]=1}var d=e(a);a.fragsLoaded++;var f=e(a);f>d&&this.viewer3DImpl.signalProgress(f,u.ProgressState.LOADING,this.model),this.model.getGeometryList().geomPolyCount>a.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),a.numRepaints++,a.nextRepaintPolys+=1e5*Math.pow(1.5,a.numRepaints),this.viewer3DImpl.modelVisible(this.model.id)&&this.viewer3DImpl.invalidate(!1,!0)),a.fragsLoaded===a.metadata.stats.num_fragments&&this.onOperationComplete()},d.prototype.trackFragmentListLoadProgress=function(){function a(a){return Math.floor(100*a.fragsLoadedNoGeom/a.metadata.stats.num_fragments)}var b=this.svf,c=a(b);b.fragsLoadedNoGeom++;var d=a(b);d>c&&this.options.onFragmentListLoadProgress(this.model,d)},d.prototype.onOperationComplete=function(){3===++this.operationsDone&&this.onGeomLoadDone()},d.prototype.onMaterialLoaded=function(a,b,c){var d=this.viewer3DImpl.matman();if(a){a.hash=b;var e=d.convertSharedMaterial(this.model,a,b);j.TextureLoader.loadMaterialTextures(this.model,e,this.viewer3DImpl),d.hasTwoSidedMaterials()&&this.viewer3DImpl.renderer().toggleTwoSided(!0)}else this.svf.failedMaterials[b]=1;for(var f=this.pendingMaterials[b],g=0;g<f.length;g++)this.tryToActivateFragment(f[g],"material");this.pendingMaterialsCount--,delete this.pendingMaterials[b]},d.prototype.findOrLoadMaterial=function(a,b,c){this.model.getData();if(this.viewer3DImpl.matman().findMaterial(a,b))return!0;if(this.pendingMaterials[b])return!1;this.pendingMaterialsCount++,this.pendingMaterials[b]=[];var d=this,e=function(a){d.onMaterialLoaded(a,b,c)},f=function(a,b){d.onMaterialLoaded(null,a,c)};return this.svf.loadMaterial(this.loadContext,b,e,f),!1},d.prototype.loadGeometry=function(a,b,c){var d=this.svf,e=d.getGeometryHash(a);if(this.pendingMeshes[e])return this.pendingMeshes[e].push(c),!1;this.pendingMeshesCount++,this.pendingMeshes[e]=[c];var f=!!this.loadContext.otg_cdn;d.geomMetadata.hashToIndex[e]=a;var g=d.makeSharedResourcePath(this.loadContext.otg_cdn,"geometry",e);this.viewer3DImpl.geomCache().requestGeometry(g,f,e,a,f?"":this.queryParam,b)},d.prototype.onMeshError=function(a){var b=a.error.args.hash;this.svf.failedMeshes[b]=1;var c=(this.svf.geomMetadata.hashToIndex[b],this.pendingMeshes[b]);if(c){for(var d=0;d<c.length;d++)this.trackGeomLoadProgress(this.svf,c[d],!0);delete this.pendingMeshes[b],this.pendingMeshesCount--}},d.prototype.onMeshReceived=function(a){var b=this.model;if(!b)return void console.warn("Received geometry after loader was done. Possibly leaked event listener?",a.hash);var c=b.getGeometryList(),d=this.svf.geomMetadata.hashToIndex[a.hash];if(void 0!==d){
var e=c.getGeometry(d),f=this.pendingMeshes[a.hash];if(!e){c.addGeometry(a,f&&f.length||1,d),this.svf.loadDone&&console.error("Geometry received after load was done");for(var g=0;g<f.length;g++)this.tryToActivateFragment(f[g],"geom");delete this.pendingMeshes[a.hash],this.pendingMeshesCount--}}},d.prototype.onGeomLoadDone=function(){if(this.svf.loadDone=!0,this.removeMeshReceiveListener(),j.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),this.options.skipMeshLoad)return this.currentLoadPath=null,void this.viewer3DImpl.onLoadComplete(this.model);this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null;var a=Date.now(),b="Fragments load time: "+(a-this.t0);this.loadTime+=a-this.t0;var c=this.firstPixelTimestamp-this.t0;if(b+=" (first pixel time: "+c+")",i.logger.log(b),this.options.useConsolidation){var d=this.viewer3DImpl.glrenderer();this.model.consolidate(this.viewer3DImpl.getMaterials(),this.options.consolidationMemoryLimit,d)}var e={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.svf.metadata.stats.num_geoms,fragments_count:this.svf.metadata.stats.num_fragments,urn:this.svfUrn};c>0&&(e.first_pixel_time=c),i.logger.track(e,!0),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model)},d.prototype.loadPropertyDb=function(){this.svf.propDbLoader=new l.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propDbLoader.load()},d.prototype.is3d=function(){return!0},q.FileLoaderManager.registerFileLoader("json",["json"],d)},function(a,b,c){"use strict";function d(a,b){function c(a){var c=new Uint8Array(4);if("string"==typeof a)for(var k=0;k<4;k++)c[k]=a.charCodeAt(k);else for(var k=0;k<4;k++)c[k]=a[k];e=c[1]<<8|c[0],e||(e=b||0),e||h.logger.error("Unknwon byte stride."),e%4&&h.logger.error("Expected byte size to be multiple of 4, but got "+e),f=c[3]<<8|c[2],d=e/4,g=new Uint8Array(e),i=new Float32Array(g.buffer),j=new Uint32Array(g.buffer)}var d,e,f,g,i,j,k=0;this.onData=function(b,d){for(var f="string"==typeof b;;){if(!k&&b.length>=4)c(b),k++;else if(b.length<4)return!1;var h=k*e,i=h+e;if(b.length<i)return d;if(f)for(var j=0;j<e;j++)g[j]=255&b.charCodeAt(j+h);else for(var j=0;j<e;j++)g[j]=b[j+h];if(!a(k-1))return!1;k++}},this.onEnd=function(a){this.onData(a,!0)||(this.rawData=a)},this.flush=function(){if(this.rawData){this.onData(this.rawData,!0)||h.logger.warn("Unexpected data stream termination."),this.rawData=null}},this.idata=function(){return j},this.fdata=function(){return i},this.bdata=function(){return g},this.version=function(){return f},this.byteStride=function(){return e}}function e(){this.materials=null,this.fragments=null,this.geompacks=[],this.propertydb={attrs:[],avs:[],ids:[],values:[],offsets:[]},this.bbox=null,this.animations=null,this.pendingRequests=0,this.globalOffset={x:0,y:0,z:0},this.pendingRequests=0,this.initialLoadProgress=0,this.materialIdToHash=[],this.geomIdToHash=[],this.aborted=!1,this.materialCache=new q.LocalDbCache,this.materialCache.open()}function f(a,b){return 0===b.indexOf("file://")?b:0===b.indexOf("urn:adsk.fluent:fs.file:")?b:0!==b.indexOf("https://")&&0!==b.indexOf("http://")?a.basePath+b:b}Object.defineProperty(b,"__esModule",{value:!0}),b.OtgPackage=e;var g=c(12),h=c(8),i=c(191),j=c(257),k=c(258),l=c(14),m=c(119),n=c(115),o=c(122),p=c(128),q=c(259);e.prototype.getMaterialHash=function(a){var b=this.materialIdToHash[a];if(b)return b;var c=this.materialHashes.byteStride,d=(0,l.getHexString)(this.materialHashes.hashes,a*c,c);return this.materialIdToHash[a]=d,d},e.prototype.getGeometryHash=function(a){var b=this.geomIdToHash[a];if(b)return b;var c=this.geomMetadata.byteStride,d=(0,l.getHexString)(this.geomMetadata.hashes,a*c,c);return this.geomIdToHash[a]=d,d},e.prototype.initEmptyLists=function(){var a=this,b=a.fragments={};b.length=a.metadata.stats.num_fragments,b.numLoaded=0,b.boxes=new Float32Array(6*b.length),b.transforms=new Float32Array(12*b.length),b.materials=new Int32Array(b.length),b.geomDataIndexes=new Int32Array(b.length),b.fragId2dbId=new Int32Array(b.length),b.visibilityFlags=new Uint8Array(b.length),b.mesh2frag={},b.topoIndexes=null,a.geomMetadata={hashes:null,byteStride:0,version:0,numLoaded:0,hashToIndex:{}},a.materialHashes={hashes:null,byteStride:0,version:0,numLoaded:0},a.materials={name:"LMVTK Simple Materials",version:"1.0",scene:{SceneUnit:8215,YIsUp:0},materials:{}}},e.prototype.loadAsyncResource=function(a,b,c,d,e){function h(a){i.pendingRequests--,d(a)}var i=this;this.pendingRequests++,b=f(a,b),g.ViewingService.getItem(a,b,h,a.onFailureCallback,{asynchronous:!0,responseType:c||"arraybuffer",onprogress:e})},e.prototype.loadAsyncProgressive=function(a,b,c,d,e){var h=this;b=f(a,b),g.ViewingService.getItem(a,b,function(b){c.onEnd(b),h.postLoad(a,d,c,b)},e||a.onFailureCallback,{asynchronous:!0,responseType:"text",onprogress:function(a){if(h.aborted)return void request.abort();c.onData(a)}})},e.prototype.loadMetadata=function(a,b){var c=this;this.loadAsyncResource(a,b,"json",function(d){c.metadata=d,c.manifest=c.metadata.manifest,c.processMetadata(a),c.initEmptyLists();var e=c.metadata.manifest,f=e.shared_assets.pdb;for(var g in f)c.propertydb[g]&&c.propertydb[g].push(f[g]);var h=e.assets.pdb;for(var g in h)c.propertydb[g]&&c.propertydb[g].push(h[g]);e.assets.animations&&c.loadAsyncResource(a,e.assets.animations,"json",function(a){c.animations=a,(0,k.transformAnimations)(c)}),e.assets.topology&&c.loadAsyncResource(a,b,"json",function(a){c.topology=a}),a.onLoaderEvent("otg_root"),c.postLoad(a,"metadata")})},e.prototype.loadFragmentList=function(a,b){function c(b){if(e.metadata){var c=q.idata(),d=q.fdata(),m=e.fragments,o=m.geomDataIndexes[b]=c[0],p=m.materials[b]=c[1];if(o>e.geomMetadata.numLoaded||p>e.materialHashes.numLoaded)return console.log("Delayed fragment",b),!1;var r=(m.fragId2dbId[b]=c[2],m.mesh2frag[o]);void 0===r?m.mesh2frag[o]=b:Array.isArray(r)?r.push(b):m.mesh2frag[o]=[r,b];var s=0+k,t=c[s];m.visibilityFlags[b]=1&t?n.MeshFlags.MESH_HIDE:0;var u=0+l;f.set(d[u+0],d[u+1],d[u+2]),h.x=d[u+3],h.y=d[u+4],h.z=d[u+5],h.w=d[u+6],g.set(d[u+7],d[u+8],d[u+9]),i.compose(f,h,g),e.placementWithOffset&&i.multiplyMatrices(e.placementWithOffset,i);var v=i.elements,w=m.transforms,x=12*b;return w[x+0]=v[0],w[x+1]=v[1],w[x+2]=v[2],w[x+3]=v[4],w[x+4]=v[5],w[x+5]=v[6],w[x+6]=v[8],w[x+7]=v[9],w[x+8]=v[10],w[x+9]=v[12],w[x+10]=v[13],w[x+11]=v[14],j.min.x=-.5,j.min.y=-.5,j.min.z=-.5,j.max.x=.5,j.max.y=.5,j.max.z=.5,j.applyMatrix4(i),w=m.boxes,x=6*b,w[x+0]=j.min.x,w[x+1]=j.min.y,w[x+2]=j.min.z,w[x+3]=j.max.x,w[x+4]=j.max.y,w[x+5]=j.max.z,m.numLoaded=b+1,a.onLoaderEvent("fragment",b),!0}}var e=this,f=new m.LmvVector3,g=new m.LmvVector3,h={x:0,y:0,z:0,w:1},i=new p.LmvMatrix4,j=new o.LmvBox3,k=3,l=4,q=new d(c,52);return this.loadAsyncProgressive(a,b,q,"all_fragments"),q},e.prototype.handleHashListRequestFailures=function(a){this.metadata&&(this.geomHashListFailure&&this.metadata.stats.num_geoms>0&&a.onFailureCallback.apply(a,this.geomHashListFailure),this.matHashListFailure&&this.metadata.stats.num_materials>0&&a.onFailureCallback.apply(a,this.matHashListFailure),this.geomHashListFailure=null,this.matHashListFailure=null)},e.prototype.loadGeometryHashList=function(a,b){function c(a){return!!e.metadata&&(e.geomMetadata.hashes||(e.numGeoms=e.metadata.stats.num_geoms,e.geomMetadata.hashes=new Uint8Array(f.byteStride()*(e.numGeoms+1)),e.geomMetadata.byteStride=f.byteStride(),e.geomMetadata.version=f.version()),a+=1,e.geomMetadata.hashes.set(f.bdata(),a*f.byteStride()),e.geomMetadata.numLoaded=a,!0)}var e=this,f=new d(c,20),g=function(){e.geomHashListFailure=arguments,e.handleHashListRequestFailures(a),e.postLoad(a,"geometry_ptrs",f)};return this.loadAsyncProgressive(a,b,f,"geometry_ptrs",g),f},e.prototype.loadMaterialHashList=function(a,b){function c(a){return!!e.metadata&&(e.materialHashes.hashes||(e.numMaterials=e.metadata.stats.num_materials,e.materialHashes.hashes=new Uint8Array(f.byteStride()*(e.numMaterials+1)),e.materialHashes.byteStride=f.byteStride(),e.materialHashes.version=f.version()),a+=1,e.materialHashes.hashes.set(f.bdata(),a*f.byteStride()),e.materialHashes.numLoaded=a,!0)}var e=this,f=new d(c,20),g=function(){e.matHashListFailure=arguments,e.handleHashListRequestFailures(a),e.postLoad(a,"material_ptrs",f)};return this.loadAsyncProgressive(a,b,f,"material_ptrs",g),f},e.prototype.processMetadata=function(a){var b=this,c=b.metadata;(0,k.initPlacement)(b,a);var d=b.placementWithOffset;if(c.cameras&&(b.cameras=c.cameras,d))for(var e=0;e<b.cameras.length;e++){var f=b.cameras[e];f.position=new m.LmvVector3(f.position.x,f.position.y,f.position.z),f.position.applyMatrix4(d),f.target=new m.LmvVector3(f.target.x,f.target.y,f.target.z),f.target.applyMatrix4(d),f.up=new m.LmvVector3(f.up.x,f.up.y,f.up.z),f.up.transformDirection(d)}},e.prototype.loadRemainingSvf=function(a,b){this.loadMetadata(a,b),this.materialsCtx=this.loadMaterialHashList(a,"materials_ptrs.hl"),this.geometryCtx=this.loadGeometryHashList(a,"geometry_ptrs.hl"),this.fragmentsCtx=this.loadFragmentList(a,"fragments.fl")},e.prototype.makeSharedResourcePath=function(a,b,c){if(a){var d=this.manifest.shared_assets.global_sharding||0,e=c,f="";d&&(f="/"+c.slice(0,d),e=c.slice(d));var h=this.manifest.shared_assets[b];if(0!==h.indexOf("urn:adsk.fluent:fs.file:")){var i=h.split("/");h="/"+(i[i.length-1]||i[i.length-2])+"/"}else h=h.slice(h.indexOf("/"));return a+f+h+e}var d=this.manifest.shared_assets.global_sharding||2,e=c,f="";return d&&(f="/"+c.slice(0,d)+"/",e=c.slice(d)),(0,g.pathToURL)(this.basePath)+this.manifest.shared_assets[b]+f+e},e.prototype.getFromLocalDb=function(a,b,c){if(this.materialCache)return this.materialCache.get(b,c);var d=this.materialCache=new q.LocalDbCache;this.materialCache.open(function(){d.get(b,c)},a.disableIndexedDb)},e.prototype.loadMaterial=function(a,b,c,d){var e=this,f=this;this.getFromLocalDb(a,b,function(i,j){if(j)j instanceof Uint8Array?j=(0,l.blobToJson)(j):"string"==typeof j&&(j=JSON.parse(j)),c(j);else{var k;k=e.makeSharedResourcePath(a.otg_cdn,"materials",b);var m=function(a){h.logger.error("Failed to load material "+b),d&&d(b,a)};0!==k.indexOf("https://")&&0!==k.indexOf("http://")&&0!==k.indexOf("file://")&&(k=a.basePath+k),g.ViewingService.getItem(a.otg_cdn?{}:a,k,function(a){f.materialCache.store(b,a),a=(0,l.blobToJson)(a),c(a)},m,{asynchronous:!0,responseType:"arraybuffer",withCredentials:!1})}})},e.prototype.postLoad=function(a,b,c,d){b&&this.initialLoadProgress++,4===this.initialLoadProgress&&(this.materialsCtx.flush(),this.geometryCtx.flush(),this.fragmentsCtx.flush(),this.materialsCtx=null,this.geometryCtx=null,this.fragmentsCtx=null,this.fragments.numLoaded<this.metadata.stats.num_fragments&&h.logger.warn("Fragments actually loaded fewer than expected."),a.onLoaderEvent("all_fragments"))},e.prototype.abort=function(){this.aborted=!0},e.prototype.makeBVH=function(a){var b=this;this.manifest.assets.fragments_extra&&this.loadAsyncResource(a,this.manifest.assets.fragments_extra,"",function(c){if(c&&c.length){var d=performance.now(),e=new j.OtgFragInfo(c,b.placementWithOffset);if(e.count){var f=new i.BVHBuilder(null,null,e);f.build(a.bvhOptions),b.bvh={nodes:f.nodes,primitives:f.primitives};var g=performance.now();h.logger.debug("BVH build time:"+(g-d)),a.onLoaderEvent("bvh",b.bvh)}}})}},function(a,b,c){"use strict";function d(a,b,c,d){k.ViewingService.getItem(a,b,d,a.onFailureCallback,{asynchronous:!0,responseType:c||"arraybuffer"})}function e(a,b){this.min.x=a[b],this.min.y=a[b+1],this.min.z=a[b+2],this.max.x=a[b+3],this.max.y=a[b+4],this.max.z=a[b+5]}function f(a,b){a[b]=this.min.x,a[b+1]=this.min.y,a[b+2]=this.min.z,a[b+3]=this.max.x,a[b+4]=this.max.y,a[b+5]=this.max.z}function g(a,b,c,d){var g=a[1]<<16|a[0];if(g||(g=28),this.boxStride=g/4,this.count=a.byteLength/g-1,this.count){this.boxes=new Float32Array(a.buffer,g),this.flags=new Int32Array(a.buffer,g);var h=this.boxes;if(c)for(var i=new m.LmvBox3,j=0,k=0;k<this.count;k++,j+=this.boxStride)e.call(i,h,j),i.applyMatrix4(b),f.call(i,h,j);else if(d&&(d.x||d.y||d.z))for(var j=0,k=0;k<this.count;k++,j+=this.boxStride)h[j]-=d.x,h[j+1]-=d.y,h[j+2]-=d.z,h[j+3]-=d.x,h[j+4]-=d.y,h[j+5]-=d.z}this.hasPolygonCounts=!0,this.wantSort=!1}function h(a){a.fragments_extra&&d(a,a.fragments_extra,"",function(b){if(b&&b.length){var c=new g(b,a.placementWithOffset,a.placementTransform,a.globalOffset);if(c.count){var d=new l.BVHBuilder(null,null,c);d.build(a.bvhOptions);var e={nodes:d.nodes.getRawData(),primitives:d.primitives};a.worker.postMessage({bvh:e},[e.nodes,e.primitives.buffer])}}})}function i(a){}function j(a){a.register("LOAD_OTG_BVH",{doOperation:h}),a.register("LOAD_OTG_MATS",{doOperation:i})}Object.defineProperty(b,"__esModule",{value:!0}),b.OtgFragInfo=void 0,b.register=j;var k=c(12),l=c(191),m=c(122);g.prototype.getCount=function(){return this.count},g.prototype.isTransparent=function(a){return!!(this.flags[a*this.boxStride+6]>>24)},g.prototype.getPolygonCount=function(a){return 16777215&this.flags[a*this.boxStride+6]},b.OtgFragInfo=g},function(a,b,c){"use strict";function d(a){switch(a){case"meter":case"meters":case"m":return 1;case"feet and inches":case"foot":case"feet":case"ft":return.3048;case"inch":case"inches":case"in":return.0254;case"centimeter":case"centimeters":case"cm":return.01;case"millimeter":case"millimeters":case"mm":return.001;default:return 1}}function e(a){for(var b=a.elements,c=0;c<4;c++)for(var d=0;d<4;d++)if(c===d){if(1!==b[4*c+d])return!1}else if(0!==b[4*c+d])return!1;return!0}function f(a,b){if(a.placementTransform=b.placementTransform,b.applyScaling){var c="m";a.metadata["distance unit"]&&(c=a.metadata["distance unit"].value),a.scalingUnit=c,"object"===j(b.applyScaling)?(b.applyScaling.from&&(c=b.applyScaling.from),b.applyScaling.to&&(a.scalingUnit=b.applyScaling.to)):a.scalingUnit=b.applyScaling;var f=d(c)/d(a.scalingUnit);if(1!=f){var g=new m.LmvMatrix4(!0),h=new m.LmvMatrix4(!0);h.elements[0]=f,h.elements[5]=f,h.elements[10]=f,b.placementTransform&&g.copy(b.placementTransform),a.placementTransform=b.placementTransform=g.multiply(h)}}var i=a.metadata["custom values"];if(i&&i.refPointTransform){a.refPointTransform=new m.LmvMatrix4(!0);var k=a.refPointTransform.elements,l=i.refPointTransform;k[0]=l[0],k[1]=l[1],k[2]=l[2],k[4]=l[3],k[5]=l[4],k[6]=l[5],k[8]=l[6],k[9]=l[7],k[10]=l[8],k[12]=l[9],k[13]=l[10],k[14]=l[11]}else{var n=a.metadata.georeference,o=n&&n.refPointLMV,p=0;if(i&&i.hasOwnProperty("angleToTrueNorth")&&(p=Math.PI/180*i.angleToTrueNorth),o||p){var q=new m.LmvMatrix4(!0),r=q.elements;r[0]=r[5]=Math.cos(p),r[1]=-Math.sin(p),r[4]=Math.sin(p),o&&(r[12]=o[0],r[13]=o[1],r[14]=o[2]),a.refPointTransform=q}}if(b.applyRefPoint&&a.refPointTransform){var s=new m.LmvMatrix4(!0);b.placementTransform&&s.copy(b.placementTransform),s.multiply(a.refPointTransform),a.placementTransform=b.placementTransform=s}else!b.applyRefPoint&&b.placementTransform&&(a.placementTransform=(new m.LmvMatrix4).copy(b.placementTransform));return a.placementTransform&&e(a.placementTransform)&&(a.placementTransform=null),a.placementTransform}function g(a,b){if(a.metadata){var c=a.metadata["world bounding box"],d=new k.LmvVector3(c.minXYZ[0],c.minXYZ[1],c.minXYZ[2]),e=new k.LmvVector3(c.maxXYZ[0],c.maxXYZ[1],c.maxXYZ[2]);a.bbox=new l.LmvBox3(d,e),a.globalOffset=b.globalOffset||{x:.5*(d.x+e.x),y:.5*(d.y+e.y),z:.5*(d.z+e.z)};var g=f(a,b),h=a.globalOffset;if(h.x||h.y||h.z){if(g){var i=new m.LmvMatrix4(!0);i.copy(g),g=i,g.elements[12]-=h.x,g.elements[13]-=h.y,g.elements[14]-=h.z}else g=new m.LmvMatrix4(!0),g.makeTranslation(-h.x,-h.y,-h.z);a.placementWithOffset=g}else a.placementWithOffset=g;g&&a.bbox.applyMatrix4(g),a.metadata.hasOwnProperty("double sided geometry")&&a.metadata["double sided geometry"].value&&(a.doubleSided=!0)}}function h(a,b){a[0]-=b.x,a[1]-=b.y,a[2]-=b.z}function i(a){if(a.animations){var b=a.animations.animations;if(b)for(var c=a.globalOffset,d=(new m.LmvMatrix4).makeTranslation(c.x,c.y,c.z),e=(new m.LmvMatrix4).makeTranslation(-c.x,-c.y,-c.z),f=new m.LmvMatrix4,g=new m.LmvMatrix4,i=0;i<b.length;i++){var j=b[i];if(j.hierarchy)for(var k=0;k<j.hierarchy.length;k++){var l=j.hierarchy[k].keys;if(l)for(var n=0;n<l.length;n++){var o=l[n].pos;if(o){var p=c,q=l[n].rot;q&&(f.makeRotationFromQuaternion({x:q[0],y:q[1],z:q[2],w:q[3]}),g.multiplyMatrices(d,f).multiply(e),p={x:g.elements[12],y:g.elements[13],z:g.elements[14]}),h(o,p)}var r=l[n].target;r&&h(r,c);var s=l[n].points;if(s)for(var t=0;t<s.length;t++)h(s[t],c)}}}}}Object.defineProperty(b,"__esModule",{value:!0});var j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};b.derivePlacementTransform=f,b.initPlacement=g,b.transformAnimations=i;var k=c(119),l=c(122),m=c(128)},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0}),b.LocalDbCache=void 0;var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=(c(14),c(4)),g=c(15),h="otg-content",i="otg-lru";b.LocalDbCache=function(){function a(){d(this,a),this.db=null,this.readTransaction=null,this.loaded=!1,this.storeName=h,this.storeNameTimestamp=i,this.bothStoreNames=[this.storeName,this.storeNameTimestamp],this.useCompression=!0,this.pendingTimestampUpdates={},this.pendingTimestampCount=0,this.pendingStores=[]}return e(a,[{key:"open",value:function(a,b){var c=this;if(b||(0,f.isSafari)()||(0,f.isMobileDevice)()||(0,f.isNodeJS)()||"undefined"==typeof indexedDB)return console.log("IndexedDb disabled"),void(a&&a());var d=indexedDB.open("otg",1);d.onerror=function(b){console.error("Failed to open or create cache database."),a&&a(b)},d.onsuccess=function(b){c.db=b.target.result,c.db.onerror=function(a){console.error("Database error",a)},c.loaded=!0,a&&a(null,c.db)},d.onupgradeneeded=function(a){console.log("Db upgrade",c.storeName);var b=a.target.result;b.createObjectStore(h),b.createObjectStore(i).createIndex(i+"-index","t",{unique:!1})}}},{key:"deleteOld",value:function(a){var b=this;if(!this.db)return void a();if(!this.deleteInProgress){this.deleteInProgress=!0;var c=IDBKeyRange.upperBound(Date.now()-3e5,!0),d=[];this.db.transaction([this.storeNameTimestamp]).objectStore(this.storeNameTimestamp).index(this.storeNameTimestamp+"-index").openCursor(c).onsuccess=function(c){var e=c.target.result;if(e&&d.length<200)return d.push(e.primaryKey),void e.continue();if(d.length){console.log("Deleting old objects.",d.length);var f=b.db.transaction(b.bothStoreNames,"readwrite");f.oncomplete=function(c){b.deleteInProgress=!1,console.log("Delete done"),a&&a()},f.onerror=function(a){b.deleteInProgress=!1,console.error("Transaction error.",a)},f.onabort=function(a){b.deleteInProgress=!1;var c=a.target.error;console.log("Failed to delete cached objects",c)};for(var g=f.objectStore(b.storeName),h=f.objectStore(b.storeNameTimestamp),i=0;i<d.length;i++)g.delete(d[i]),h.delete(d[i])}}}}},{key:"flush",value:function(a){var b=this;if(!this.pendingStores.length)return void(a&&a());if(!this.writeTransaction){var c=this.db.transaction(this.bothStoreNames,"readwrite");a&&(c.oncomplete=function(b){a()}),c.onerror=function(b){console.error("Transaction error.",b),a&&a(b.target.error)},c.onabort=function(c){"QuotaExceededError"===c.target.error.name&&b.deleteOld(function(){}),a&&a(c.target.error)},this.writeTransaction=c}for(var d=0;d<this.pendingStores.length;d+=2){var e=this.pendingStores[d],f=this.pendingStores[d+1];if(f instanceof Uint8Array&&this.useCompression)if(31===f[0]&&139===f[1]);else try{f=g.gzip(f)}catch(a){console.error("Compression failed.")}this.writeTransaction.objectStore(this.storeName).put(f,e).onerror=function(a){console.error("Object store error.",a)};this.writeTransaction.objectStore(this.storeNameTimestamp).put({t:Date.now()},e)}this.pendingStores=[],this.writeTransaction=null}},{key:"store",value:function(a,b,c){return this.db?(this.pendingStores.push(a),this.pendingStores.push(b),this.pendingStores.length<200?void(c&&c()):void this.flush(c)):void(c&&c())}},{key:"flushTimestamps",value:function(a){var b=this,c=this.db.transaction([this.storeNameTimestamp],"readwrite");a&&(c.oncomplete=function(b){a()}),c.onerror=function(b){console.error("Transaction error.",b),a&&a(b.target.error)},c.onabort=function(c){"QuotaExceededError"===c.target.error.name&&(console.log("Quota exceeded"),b.deleteOld(function(){})),a&&a(c.target.error)};var d=c.objectStore(this.storeNameTimestamp);for(var e in this.pendingTimestampUpdates)d.put({t:this.pendingTimestampUpdates[e]},e);this.pendingTimestampUpdates={},this.pendingTimestampCount=0}},{key:"_createReadTransaction",value:function(){var a=this,b=this.readTransaction=this.db.transaction(this.storeName);b.oncomplete=function(b){a.readTransaction=null},b.onerror=function(b){console.error("Transaction error.",comment,b),a.readTransaction=null},b.onabort=function(b){console.warn("Transaction abort",comment,b),a.readTransaction=null}}},{key:"get",value:function(a,b){var c=this;if(!this.db)return void b(-1,null);this.readTransaction||this._createReadTransaction();var d=void 0;try{d=this.readTransaction.objectStore(this.storeName).get(a)}catch(b){this._createReadTransaction(),d=this.readTransaction.objectStore(this.storeName).get(a)}d.onsuccess=function(d){if(!d.target.result)return void b(-1,null);var e=d.target.result;if(31===e[0]&&139===e[1])try{e=g.ungzip(e)}catch(a){return console.error("Failed to decompress.",a),void b(a,null)}b(null,e),c.pendingTimestampUpdates[a]=Date.now(),c.pendingTimestampCount++},d.onerror=function(a){b(a.target.errorCode)}}},{key:"updatePendingTimestamps",value:function(){var a=this;this.db&&this.flush(function(b){b||a.flushTimestamps()})}},{key:"size",value:function(a){if(!this.db)return void a();var b=0,c=0,d=this.db.transaction([this.storeName]).objectStore(this.storeName).openCursor();d.onsuccess=function(d){var e=d.target.result;if(e){var f=e.value;b+=f.length,c++,e.continue()}else a(null,{size:b,items:c})},d.onerror=function(b){a(b)}}}]),a}()},function(a,b,c){"use strict";function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}Object.defineProperty(b,"__esModule",{value:!0}),b.ScalarisLoader=void 0;var e=c(8),f=c(199),g=c(190),h=c(188),i=c(13),j=c(210),k=c(2),l=d(k),m=c(12),n=c(10),o=c(198),p=d(o),q=c(9),r=c(6),s=c(207),t=function(a){this.viewer3DImpl=a,this.loading=!1};t.prototype.dtor=function(){this.viewer3DImpl=null,this.model=null,this.svf=null,this.logger=null,this.loading=!1},t.prototype.isValid=function(){return null!=this.viewer3DImpl},t.prototype.loadFile=function(a,b,c,d){if(!this.viewer3DImpl)return e.logger.log("Scalaris loader was already destructed. So no longer usable."),!1;if(this.loading)return e.logger.log("Loading of Scalaris already in progress. Ignoring new request."),!1;this.loading=!0,this.viewer3DImpl._addLoadingFile(this),this.currentLoadPath=a;var f="",g=this.currentLoadPath.lastIndexOf("/");-1!=g&&(f=this.currentLoadPath.substr(0,g+1)),this.basePath=f,this.options=b,this.options.debug={},this.options.preserveView=!0;var h=this;return this.initWorkerScriptToken=(0,n.initWorkerScript)(function(){h.loadScalarisCB(a,h.options,c,d)}),!0},t.prototype.loadScalarisCB=function(a,b,c,d){var f=!0,g=this,h=this.svfWorker=(0,n.createWorkerWithIntercept)(),k=function(a){var b=function(){h&&(h.clearAllEventListenerWithIntercept(),h.terminate(),g.svfWorker=null,h=null)};if(f&&d&&(f=!1,d()),a.data&&a.data.geometry){var k=g.svf=a.data.geometry;g.onModelRootLoadDone(k),c&&c(null,g.model),g.viewer3DImpl.api.dispatchEvent({type:p.MODEL_ROOT_LOADED_EVENT,svf:k,model:g.model}),g.svf.loadDone=!1}else if(a.data&&a.data.progress){var l=g.viewer3DImpl;l&&g.viewer3DImpl.signalProgress(100*a.data.progress,j.ProgressState.LOADING),1==a.data.progress&&setTimeout(function(){g.onGeomLoadDone(),g.loading=!1,b()},0)}else a.data&&a.data.error?(g.loading=!1,console.error(a.data),b(),c&&c(a.data.error,null)):a.data&&a.data.debug?e.logger.debug(a.data.message):(e.logger.error("Scalaris load failed.",(0,i.errorCodeString)(i.ErrorCodes.NETWORK_FAILURE)),g.loading=!1,b())};h.addEventListenerWithIntercept(k);var l={url:(0,m.pathToURL)(a),basePath:this.currentLoadPath,scalarisProtoPath:(0,r.getResourceUrl)("res/protobuf/scalaris.proto")};return l.operation="LOAD_SCALARIS",h.doOperation((0,q.initLoadContext)(l)),!0},t.prototype.onModelRootLoadDone=function(a){this.viewer3DImpl._removeLoadingFile(this),a.basePath=this.basePath,a.disableStreaming=!0,a.geomPolyCount=0,a.gpuNumMeshes=0,a.gpuMeshMemory=0,a.fragments={length:a.meshCount,numLoaded:0,boxes:null,transforms:null,materials:null,fragId2dbId:null,entityIndexes:null,mesh2frag:null},a.animations=null,a.nodeToDbId={},a.loadOptions=this.options,a.bbox=new l.Box3(a.min,a.max);var b=this.model=new s.Model(a);a.urn&&b.setUUID(a.urn),b.initialize(),b.loader=this,this.viewer3DImpl.signalProgress(5,j.ProgressState.ROOT_LOADED),this.viewer3DImpl.invalidate(!1,!1)},t.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0;var a=this.svf.fragments.length;this.svf.numGeoms=a,this.svf.fragments.numLoaded=a,this.svf.fragments.boxes=new Float32Array(6*a),this.svf.fragments.transforms=new Float32Array(12*a),this.svf.fragments.materials=new Int32Array(a),this.svf.fragments.fragId2dbId=new Int32Array(a),this.svf.fragments.mesh2frag=new Int32Array(a);var b=function(a){if(0===a.offsets.length)for(var b=a.attributes.index.array.length/3,c=b/21845,d=0;d<c;d++){var e={start:21845*d*3,count:3*Math.min(b-21845*d,21845)};a.addDrawCall(e.start,e.count)}},c=function(a){0==a.attributes.normal.array.length&&(a.attributes.normal.array=new Float32Array(a.attributes.position.array.length),a.computeVertexNormals())},d=this.svf,e=function(a){var d=new l.BufferGeometry;if(d.byteSize=0,d.addAttribute("index",new l.BufferAttribute(new Uint32Array(a.indices),1)),d.addAttribute("position",new l.BufferAttribute(new Float32Array(a.vertices),3)),d.addAttribute("normal",new l.BufferAttribute(new Float32Array(a.normals),3)),a.hasOwnProperty("uvs")&&a.uvs.byteLength>0&&(d.byteSize+=a.uvs.byteLength,d.addAttribute("uv",new l.BufferAttribute(new Float32Array(a.uvs),2))),d.hasColors=!1,a.hasOwnProperty("colors")&&a.colors.byteLength>0&&(d.byteSize+=a.colors.byteLength,d.addAttribute("color",new l.BufferAttribute(new Float32Array(a.colors),3)),d.hasColors=!0,d.colorsNeedUpdate=!0),d.attributes.index.array.length>0&&d.attributes.position.array.length>0){if(a.hasOwnProperty("offsets")&&a.offsets.byteLength>0){d.byteSize+=a.offsets.byteLength;for(var e=a.offsets.length,f=0;f<e;f++){var g=a.offsets[f];d.addDrawCall(g.start,g.count)}}return a.min?d.boundingBox=new l.Box3(new l.Vector3(a.min.x,a.min.y,a.min.z),new l.Vector3(a.max.x,a.max.y,a.max.z)):d.computeBoundingBox(),a.bbox.min=a.min=d.boundingBox.min,a.bbox.max=a.max=d.boundingBox.max,b(d),c(d),d.byteSize+=a.indices.byteLength+a.vertices.byteLength+a.normals.byteLength,d.polyCount=d.attributes.index.array.length/3,d}return null}(d);d.geomPolyCount+=e.polyCount;this.createInstanceTree(0);this.model.getGeometryList().addGeometry(e,1,0);var f=new l.Matrix4,g=this.viewer3DImpl.setupMesh(this.model,e,null,f);g.material=this.viewer3DImpl.getMaterials().defaultMaterial,d.fragments.materials[0]=null,d.fragments.fragId2dbId[0]=2,d.fragments.mesh2frag[0]=0;var h=d.fragments.boxes;h[0]=d.min.x,h[1]=d.min.y,h[2]=d.min.z,h[3]=d.max.x,h[4]=d.max.y,h[5]=d.max.z;for(var i=d.fragments.transforms,j=0;j<12;j++)i[j]=0;if(i[0]=i[4]=i[8]=1,this.model.activateFragment(0,g,!!d.placementTransform),this.currentLoadPath=null,this.viewer3DImpl.api.setModelUnits("meter"),e.hasColors&&d.colors.byteLength){var k=this.viewer3DImpl.getMaterials().defaultMaterial;k.vertexColors=l.NoColors,k.needsUpdate=!0,this.viewer3DImpl.invalidate(!0,!0,!1)}this.options.skipFitToView||this.viewer3DImpl.api.fitToView(null,null,!0),this.viewer3DImpl.onLoadComplete(this.model)},t.prototype.createInstanceTree=function(a){var b=new g.InstanceTreeStorage(2,1),c=[2],d=[];b.setNode(1,0,"RootNode",0,c,[]),b.setNode(2,1,"Geometry",0,d,[a]);var e=new g.InstanceTreeAccess(b,0);e.computeBoxes(this.svf.fragments.boxes),this.svf.instanceTree=new h.InstanceTree(e,1,1)},t.prototype.is3d=function(){return!0},f.FileLoaderManager.registerFileLoader("scalaris",["scalaris"],t);b.ScalarisLoader=t},function(a,b){"use strict";function c(){this.ios=window.webkit,this.android=window.JSINTERFACE,this.iosSend=function(a,b){return window.webkit.messageHandlers.callbackHandler.postMessage({command:a,data:b})},this.androidSend=window.JSINTERFACE}Object.defineProperty(b,"__esModule",{value:!0}),b.MobileCallbacks=c;var d=c.prototype;d.animationReady=function(){this.ios?this.iosSend("animationReady"):this.android&&this.androidSend.animationReady()},d.onSelectionChanged=function(a){this.ios?this.iosSend("selectionChanged",a):this.android&&this.androidSend.onSelectionChanged(a)},d.onLongTap=function(a,b){this.ios?this.iosSend("onLongTap",[a,b]):this.android&&this.androidSend.onLongTap(a,b)},d.onSingleTap=function(a,b){this.ios?this.iosSend("onSingleTap",[a,b]):this.android&&this.androidSend.onSingleTap(a,b)},d.onDoubleTap=function(a,b){this.ios?this.iosSend("onDoubleTap",[a,b]):this.android&&this.androidSend.onDoubleTap(a,b)},d.setRTCSession=function(a){this.ios?this.iosSend("setRTCSession",{id:a}):this.android&&this.androidSend.setRTCSessionID(a)},d.putProperties=function(a,b){this.ios?this.iosSend("putProperties",{name:a,value:b}):this.android&&this.androidSend.putProperties(a,b)},d.onPropertyRetrievedSuccess=function(){this.ios?this.iosSend("onPropertyRetrievedSuccess"):this.android&&this.androidSend.onPropertyRetrievedSuccess()},d.onPropertyRetrievedFailOrEmptyProperties=function(){this.ios?this.iosSend("onPropertyRetrievedFailOrEmptyProperties"):this.android&&this.androidSend.onPropertyRetrievedFailOrEmptyProperties()},d.resetAnimationStatus=function(){this.ios?this.iosSend("resetAnimationStatus"):this.android&&this.androidSend.resetAnimationStatus()},d.setPauseUI=function(){this.ios?this.iosSend("setPauseUI"):this.android&&this.androidSend.setToPaused()},d.getDeviceAvailableMemory=function(){return this.ios?this.iosSend("getDeviceAvailableMemory"):this.android?this.androidSend.getDeviceAvailableMemory():void 0},d.onDeviceMemoryInsufficient=function(){return this.ios?this.iosSend("onDeviceMemoryInsufficient"):this.android?this.androidSend.onDeviceMemoryInsufficient():void 0},d.updateAnimationTime=function(a){this.ios?this.iosSend("updateAnimationTime",a):this.android&&this.androidSend.updateAnimationTime(a)},d.setLoadingProgress=function(a,b){this.ios?this.iosSend("setLoadingProgress",{state:a,progress:b}):this.android&&this.androidSend.setLoadingProgress(a,b)},d.objectTreeCreated=function(){this.ios?this.iosSend("objectTreeCreated"):this.android&&this.androidSend.objectTreeCreated()},d.geometryLoaded=function(){this.ios?this.iosSend("geometryLoaded"):this.android&&this.androidSend.geometryLoaded()},d.putSheets=function(a,b){this.ios?this.iosSend("putSheets",[a,b]):this.android&&this.androidSend.putSheets(a,b)},d.putAllSheets=function(a){this.ios?this.iosSend("putAllSheets",a):this.android&&this.androidSend.putAllSheets(a)},d.hideLoadingView=function(){this.android&&this.androidSend.hideLoadingView()},d.instanceTree=function(a){this.ios?this.iosSend("instanceTree",a):this.android&&this.androidSend.instanceTree(a)},d.loadSheetFailed=function(){this.ios?this.iosSend("loadSheetFailed"):this.android&&this.androidSend.loadSheetFailed()},
d.sheetSelected=function(a){this.ios?this.iosSend("sheetSelected",a):this.android&&this.androidSend.sheetSelected(a)},"undefined"!=typeof window&&(window.MobileCallbacks=c)},function(a,b,c){"use strict";function d(a,b){this.offset=0,this.byteLength=b,this.range=0,this.compressedBuffer=a,this.compressedByteLength=a.length,this.compressedOffset=0,this.decompressEnd=!1,this.resetCount=0,this.convBuf=new ArrayBuffer(8),this.convUint8=new Uint8Array(this.convBuf),this.convUint16=new Uint16Array(this.convBuf),this.convInt32=new Int32Array(this.convBuf),this.convUint32=new Uint32Array(this.convBuf),this.convFloat32=new Float32Array(this.convBuf),this.convFloat64=new Float64Array(this.convBuf),this.COMPRESSED_chunk_SIZE=524288,this.DECOMPRESSED_chunk_SIZE=262144,this.chunks=[],this.chunksByteLengthMax=0,this.chunksByteLengthMin=0,this.chunkPointer=null,this.chunkOffset=0,this.tempchunk={startIdx:0,endIdx:0,buffer:null},this.inflate=this.getInflate(),this.prepare(0,1024)}Object.defineProperty(b,"__esModule",{value:!0}),b.InputStreamLess=d;var e=c(15);d.prototype.getInflate=function(){if(!this.inflate){this.inflate=new e.Inflate({level:3,chunkSize:this.DECOMPRESSED_chunk_SIZE});var a=this;this.inflate.onData=function(b){a.chunksByteLengthMax+=b.byteLength,a.chunksByteLengthMax<a.offset&&(b=null,a.chunksByteLengthMin=a.chunksByteLengthMax),a.chunks.push(b)},this.inflate.onEnd=function(){if(a.decompressEnd=!0,a.inflate=null,a.chunksByteLengthMax!=a.byteLength)throw"Decompress error, unexpected size."}}return this.inflate},d.prototype.prepare=function(a,b,c){if(this.chunksByteLengthMin>a&&(this.reset(),this.offset=a,this.range=b),!c){for(var d=Math.floor(a/this.DECOMPRESSED_chunk_SIZE),e=Math.floor(this.chunksByteLengthMin/this.DECOMPRESSED_chunk_SIZE),f=this.chunks.length<d?this.chunks.length:d,g=e;g<f;g++)this.chunks[g]=null;this.chunksByteLengthMin=f*this.DECOMPRESSED_chunk_SIZE}var b=b||1,h=a+b;h=h>this.byteLength?this.byteLength:h;for(var i=!1;h>this.chunksByteLengthMax;){var j=this.COMPRESSED_chunk_SIZE;this.compressedOffset+j>=this.compressedByteLength&&(j=this.compressedByteLength-this.compressedOffset,i=!0);var k=new Uint8Array(this.compressedBuffer.buffer,this.compressedOffset,j);if(this.getInflate().push(k,i),this.compressedOffset+=j,i)break}},d.prototype.ensurechunkData=function(a){a=a||1;var b=this.chunks.length,c=Math.floor(this.offset/this.DECOMPRESSED_chunk_SIZE),d=Math.floor((this.offset+a-1)/this.DECOMPRESSED_chunk_SIZE);if(d>=b){var e=(d-b+1)*this.DECOMPRESSED_chunk_SIZE;this.prepare(this.DECOMPRESSED_chunk_SIZE*b,e,!0)}if(c<d){if(this.tempchunk.startIdx>c||this.tempchunk.endIdx<d){var f=(d-c+1)*this.DECOMPRESSED_chunk_SIZE;this.tempchunk.buffer=new Uint8Array(f);for(var g=0,h=c;h<=d;h++)this.tempchunk.buffer.set(this.chunks[h],g),g+=this.DECOMPRESSED_chunk_SIZE;this.tempchunk.startIdx=c,this.tempchunk.endIdx=d}this.chunkPointer=this.tempchunk.buffer}else this.chunkPointer=this.chunks[c];this.chunkOffset=this.offset-c*this.DECOMPRESSED_chunk_SIZE,this.offset+=a},d.prototype.seek=function(a,b,c){this.offset=a,this.range=b,this.prepare(a,b,c)},d.prototype.getBytes=function(a){return this.ensurechunkData(a),new Uint8Array(this.chunkPointer.buffer,this.chunkOffset,a)},d.prototype.getVarints=function(){var a,b=0,c=0;do{this.ensurechunkData(),a=this.chunkPointer[this.chunkOffset],b|=(127&a)<<c,c+=7}while(128&a);return b},d.prototype.getUint8=function(){return this.ensurechunkData(),this.chunkPointer[this.chunkOffset]},d.prototype.getUint16=function(){return this.ensurechunkData(),this.convUint8[0]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),this.convUint8[1]=this.chunkPointer[this.chunkOffset],this.convUint16[0]},d.prototype.getInt16=function(){var a=this.getUint16();return a>32767&&(a|=4294901760),a},d.prototype.getInt32=function(){var a=this.convUint8;return this.ensurechunkData(),a[0]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),a[1]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),a[2]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),a[3]=this.chunkPointer[this.chunkOffset],this.convInt32[0]},d.prototype.getUint32=function(){var a=this.convUint8;return this.ensurechunkData(),a[0]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),a[1]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),a[2]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),a[3]=this.chunkPointer[this.chunkOffset],this.convUint32[0]},d.prototype.getFloat32=function(){var a=this.convUint8;return this.ensurechunkData(),a[0]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),a[1]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),a[2]=this.chunkPointer[this.chunkOffset],this.ensurechunkData(),a[3]=this.chunkPointer[this.chunkOffset],this.convFloat32[0]},d.prototype.getFloat64=function(){for(var a=this.convUint8,b=0;b<8;b++)this.ensurechunkData(),a[b]=this.chunkPointer[this.chunkOffset];return this.convFloat64[0]},d.prototype.getString=function(a){var b="";this.ensurechunkData(a);for(var c=this.chunkPointer,d=this.chunkOffset,e=this.chunkOffset+a;d<e;d++)b+=String.fromCharCode(c[d]);var f;try{f=decodeURIComponent(escape(b))}catch(a){f=b,debug("Failed to decode string "+f)}return f},d.prototype.reset=function(a){this.resetCount++,debug("InputStream Less Reset: "+this.resetCount),a&&(this.compressedBuffer=a,this.compressedByteLength=a.length),this.offset=0,this.chunks=[],this.chunksByteLengthMax=0,this.chunksByteLengthMin=0,this.compressedOffset=0,this.decompressEnd=!1,this.chunkPointer=null,this.chunkOffset=0,this.inflate=null,this.tempchunk.startIdx=0,this.tempchunk.endIdx=0,this.tempchunk.buffer=null}},function(a,b,c){"use strict";function d(a){var b=Autodesk.Viewing,d=b.Private;for(var e in a.av)b[e]=a.av[e];for(var f in a.avp)d[f]=a.avp[f];b.getGlobal().THREE=a.THREE,b.getGlobal().LMV=a,d.isRightClick=b.isRightClick,d.isMiddleClick=b.isMiddleClick,b.getGlobal().pako=c(15)}Object.defineProperty(b,"__esModule",{value:!0}),b.initializeLegacyNamespaces=d}]);!function(){"use strict";function a(a){this.parentDiv=a,this.container=document.createElement("div"),this.container.innerHTML=['<div class="path">','<svg width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">','<path d="M2.5,50a47.5,47.5 0 1,0 95,0a47.5,47.5 0 1,0 -95,0" vector-effect="non-scaling-stroke"/>','<path d="M 2.5 50 A 47.5 47.5 0 0 1 47.5 2.5" vector-effect="non-scaling-stroke"/>',"</svg>","</div>",'<div class="message" data-i18n="Spinner Loading">LOADING</div>'].join(""),this.container.className="loading-spinner"}Autodesk.Viewing,Autodesk.Viewing.UI;a.prototype.addClass=function(a){this.container.classList.add(a)},a.prototype.attachToDom=function(){return!this.container.parentNode&&(Autodesk.Viewing.i18n.localize(this.container),this.parentDiv.appendChild(this.container),!0)},a.prototype.removeFromDom=function(){return!!this.container.parentNode&&(this.container.parentNode.removeChild(this.container),!0)},a.prototype.setVisible=function(a){a?this.attachToDom():this.removeFromDom()},Autodesk.Viewing.UI.LoadingSpinner=a}(),function(){"use strict";var a=Autodesk.Viewing.UI,b=(Autodesk.Viewing,Autodesk.Viewing.Private),c=function(){};c.prototype.constructor=c,c.prototype.isTreeNodeGroup=function(a){throw"isTreeNodeGroup is not implemented."},c.prototype.getTreeNodeId=function(a){throw"getTreeNodeId is not implemented."},c.prototype.getTreeNodeIndex=function(a){throw"getTreeNodeIndex is not implemented."},c.prototype.getTreeNodeParentId=function(a){throw"getTreeNodeParentId is not implemented."},c.prototype.getTreeNodeLabel=function(a){return a.name},c.prototype.getTreeNodeCount=function(){throw"getTreeNodeCount is not implemented."},c.prototype.shouldCreateTreeNode=function(a){return!0},c.prototype.forEachChild=function(a,b){for(var c=a.children?a.children.length:0,d=0;d<c;++d){b(a.children[d])}},c.prototype.createTreeNode=function(a,b,c){var d=document.createElement("label");b.appendChild(d);var e=this.getTreeNodeLabel(a);c&&c.localize&&(d.setAttribute("data-i18n",e),e=Autodesk.Viewing.i18n.translate(e)),d.textContent=e},c.prototype.onTreeNodeClick=function(a,b,c){},c.prototype.onTreeNodeIconClick=function(a,b,c){a.delegate().isTreeNodeGroup(b)&&a.setCollapsed(b,!a.isCollapsed(b))},c.prototype.onTreeNodeDoubleClick=function(a,b,c){},c.prototype.onTreeNodeRightClick=function(a,b,c){},c.prototype.onTreeNodeReized=function(a){},c.prototype.getTreeNodeClass=function(a){return""},c.prototype.getTreeNodeParentMaxSize=function(a){return{width:0,height:0}},c.prototype.getTreeNodeClientHeight=function(a){return 0},c.prototype.getTreeNodeDepthOffset=function(a,b){return 0},c.prototype.onTreeNodeHover=function(a,b,c){},b.TreeDelegate=a.TreeDelegate=c}(),function(){"use strict";var a=Autodesk.Viewing.UI,b=Autodesk.Viewing,c=Autodesk.Viewing.Private,d=function(a,b,c,d){this.myDelegate=a,this.mySelectedNodes=[],this.myOptions=d||{};this.myGroupNodes=[],this.nodeToElement={},this.nodeIdToNode={};var e=this.myRootContainer=this.createHtmlElement_(c,"div","treeview"),f=this.rootElem=this.createElement_(b,e,d,0);this.setInputHandlers_(),d&&d.excludeRoot&&f.classList.add("exclude")};d.prototype.constructor=d,d.prototype.show=function(a){var b=this.myRootContainer;b.style.display=a?"block":"none"},d.prototype.getRootContainer=function(){return this.myRootContainer},d.prototype.getElementForNode=function(a){return"number"!=typeof a&&"string"!=typeof a&&(a=this.myDelegate.getTreeNodeId(a)),this.nodeToElement[a]},d.prototype.delegate=function(){return this.myDelegate},d.prototype.isCollapsed=function(a){return this.hasClass(a,"collapsed")},d.prototype.setCollapsed=function(a,b,c){b?(this.addClass(a,"collapsed",c),this.removeClass(a,"expanded",c)):(this.addClass(a,"expanded",c),this.removeClass(a,"collapsed",c))},d.prototype.setAllCollapsed=function(a){var b,c;a?(b=function(a){return a.classList.contains("expanded")},c=function(a){a.classList.add("collapsed"),a.classList.remove("expanded")}):(b=function(a){return a.classList.contains("collapsed")},c=function(a){a.classList.add("expanded"),a.classList.remove("collapsed")});for(var d=0;d<this.myGroupNodes.length;++d){var e=this.myGroupNodes[d];b(e)&&c(e)}},d.prototype.addToSelection=function(a){for(var b=this,c=a.length,d=0;d<c;++d){var e=a[d];(function(a){return-1===b.mySelectedNodes.indexOf(a)&&(b.mySelectedNodes.push(a),!0)})(e)&&this.addClass(e,"selected")}},d.prototype.removeFromSelection=function(a){for(var b=this,c=a.length-1;c>=0;--c){var d=a[c];(function(a){var c=b.mySelectedNodes.indexOf(a);return-1!==c&&(b.mySelectedNodes.splice(c,1),!0)})(d)&&this.removeClass(d,"selected")}},d.prototype.setSelection=function(a){return this.removeFromSelection(this.mySelectedNodes),this.addToSelection(a),this.mySelectedNodes},d.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedNodes)},d.prototype.isSelected=function(a){return this.hasClass(a,"selected")},d.prototype.scrollTo=function(a){var b=this.getElementForNode(a);if(b){var c=b.offsetTop;for(b=b.parentNode;b&&b!=this.myRootContainer;)c+=b.offsetTop,b=b.parentNode;this.myRootContainer.parentNode.scrollTop=c}},d.prototype.addClass=function(a,b,c){var d=this.getElementForNode(a);if(d){if(c){d=d.parentNode;for(var e=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;d&&d!==e;)d.classList.add(b),d=d.parentNode}else d.classList.add(b);return!0}return!1},d.prototype.removeClass=function(a,b,c){var d=this.getElementForNode(a);if(d){if(c){d=d.parentNode;for(var e=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;d&&d!==e;)d.classList.remove(b),d=d.parentNode}else d.classList.remove(b);return!0}return!1},d.prototype.hasClass=function(a,b){return this.getElementForNode(a).classList.contains(b)},d.prototype.clear=function(){for(var a=this.myRootContainer;a.hasChildNodes();)a.removeChild(a.lastChild);this.nodeToElement={},this.nodeIdToNode={}},d.prototype.createElement_=function(a,b,c,d){function e(b,d,e,f){var h=g.createHtmlElement_(b,d,e),i=g.myDelegate.getTreeNodeId(f);h.setAttribute("lmv-nodeId",i);var j=g.createHtmlElement_(h,"lmvheader"),k=g.createHtmlElement_(j,"icon");return k.addEventListener("mousedown",function(a){a.stopPropagation(),a.preventDefault()},!1),k.addEventListener("click",function(b){g.myDelegate.onTreeNodeIconClick(g,a,b),b.stopPropagation(),b.preventDefault()},!1),g.myDelegate.createTreeNode(a,j,c),h}if(void 0===a||null===a)return null;if(!this.myDelegate.shouldCreateTreeNode(a))return null;var f,g=this,h=this.myDelegate.getTreeNodeId(a);if(g.myDelegate.isTreeNodeGroup(a)){f=e(b,"group","expanded",a),g.nodeToElement[h]=f,g.nodeIdToNode[h]=a;var i=g.myOptions.excludeRoot?1:0;d==i&&(f.style.left="0px"),g.myGroupNodes.push(f),g.myDelegate.forEachChild(a,function(a){g.createElement_(a,f,c,d+1)})}else{f=e(b,"leaf","expanded",a),g.nodeToElement[h]=f,g.nodeIdToNode[h]=a;var i=g.myOptions.excludeRoot?1:0;d==i&&(f.style.marginLeft="0px")}var j=g.myDelegate.getTreeNodeClass(a);return j&&f.classList.add(j),f},d.prototype.setInputHandlers_=function(){var a=this,c=this.myRootContainer,d=function(b){var d=null,e=!1;do{b&&b!==c?b.hasAttribute("lmv-nodeId")?(d=b,e=!0):b=b.parentElement:(d=null,e=!0)}while(!e);if(d){var f=d.getAttribute("lmv-nodeId");return a.nodeIdToNode[f]||null}return null};b.isTouchDevice()&&(this.hammer=new b.Hammer.Manager(c,{recognizers:[b.GestureRecognizers.doubletap,b.GestureRecognizers.press],handlePointerEventMouse:!1,inputClass:b.isIE11?b.Hammer.PointerEventInput:b.Hammer.TouchInput}),this.hammer.on("doubletap",function(b){var c=d(b.target);null!==c&&a.myDelegate.onTreeNodeDoubleClick(a,c,b)}),this.hammer.on("press",function(b){var c=d(b.target);null!==c&&a.myDelegate.onTreeNodeRightClick(a,c,b)})),c.addEventListener("click",function(b){var c=d(b.target);null!==c&&(a.myDelegate.onTreeNodeClick(a,c,b),b.stopPropagation(),b.target.classList.contains("propertyLink")||b.preventDefault())},!1),c.addEventListener("dblclick",function(b){var c=d(b.target);null!==c&&(a.myDelegate.onTreeNodeDoubleClick(a,c,b),b.stopPropagation(),b.preventDefault())},!1),c.addEventListener("contextmenu",function(b){var c=d(b.target);null!==c&&(a.myDelegate.onTreeNodeRightClick(a,c,b),b.stopPropagation(),b.preventDefault())},!1),c.addEventListener("mouseover",function(b){var c=d(b.target);null!==c&&(a.myDelegate.onTreeNodeHover(a,c,b),b.stopPropagation(),b.preventDefault())},!1),c.addEventListener("mouseout",function(b){var c=b.toElement||b.relatedTarget;if(d(b.target)!=d(c)){a.myDelegate.onTreeNodeHover(a,-1,b),b.stopPropagation(),b.preventDefault()}},!1)},d.prototype.createHtmlElement_=function(a,b,c){var d=document.createElement(b);return a.appendChild(d),c&&(d.className=c),d},d.prototype.iterate=function(a,b){if(void 0!==a&&null!==a&&this.myDelegate.shouldCreateTreeNode(a)){var c=this.getElementForNode(a);if(c){b(a,c);var d=this;this.myDelegate.forEachChild(a,function(a){d.iterate(a,b)})}}},c.Tree=a.Tree=d}(),function(){"use strict";function a(a,b){this.dirty=!1,this.nextFrameId=0,this.scrollY=0,this.delegates=[],this.idToDelegate={},this.options=b,this.rootContainer=document.createElement("div"),this.rootContainer.classList.add("docking-panel-container-gradient"),this.rootContainer.classList.add("treeview"),this.rootContainer.classList.add("on-demand"),a.appendChild(this.rootContainer),this.paddingDiv=document.createElement("div"),this.paddingDiv.style.border=0,this.paddingDiv.style.margin=0,this.paddingDiv.style.padding=0,this.sizedDiv=a.parentNode,this.nodeCssTable=[[],["group"],["leaf"]],this.cssStringToNodeCssTable={"":0,group:1,leaf:2},this.nodeIndexToNodeCssTables={};for(var c=[],d=x,e=0;e<d;++e){var f=m();c[e]=f}this.elementsPool=c,this.elementsUsed=0,this.spinner=new v.LoadingSpinner(a),this.spinner.addClass("tree-loading-spinner");var h=u.isTouchDevice();h&&(this.hammer=new u.Hammer.Manager(this.rootContainer,{recognizers:[u.GestureRecognizers.doubletap,u.GestureRecognizers.press],handlePointerEventMouse:!1,inputClass:u.isIE11?u.Hammer.PointerEventInput:u.Hammer.TouchInput}));for(var e=0;e<d;++e){var f=c[e];h&&(this.hammer.on("doubletap",n.bind(this)),this.hammer.on("press",o.bind(this))),f.addEventListener("click",p.bind(this)),f.addEventListener("dblclick",q.bind(this)),f.addEventListener("contextmenu",r.bind(this)),f.icon.addEventListener("click",s.bind(this)),f.icon.addEventListener("mousedown",t.bind(this))}g(this)}function b(a){return{width:0|a.sizedDiv.clientWidth,height:0|a.sizedDiv.clientHeight}}function c(a){return a.dirty=!1,f(a),0===a.delegates.length?void a.spinner.setVisible(!1):1===a.delegates.length&&a.delegates[0].isLoading()?void a.spinner.setVisible(!0):1===a.delegates.length&&a.delegates[0].isNotAvailable()?(a.spinner.setVisible(!1),void a.displayNoProperties(!0)):(a.spinner.setVisible(!1),a.displayNoProperties(!1),void d(a))}function d(a){var c=a.rootContainer,d=b(a),f=d.height,g=0,h=0,i=!0;c.appendChild(a.paddingDiv);for(var j=a.delegates.slice(0),l=a.isExcludeRoot();j.length;){var m=j.shift(),n=m.modelDiv;c.appendChild(n);for(var o=[m.getRootId()],p={curr:l?-1:0,popIds:[]};o.length&&i;){if(g>a.scrollY+f+y){i=!1;break}if(a.elementsUsed===a.elementsPool.length){i=!1;break}var q=o.shift(),r=-1===p.curr?0:m.getTreeNodeClientHeight(q),s=g,t=s+r;if(r>0&&t+y>=a.scrollY){var u=a.elementsPool[a.elementsUsed++];u.setAttribute("lmv-nodeId",q),m.createTreeNode(q,u.header);var v=m.getTreeNodeClass(q);v&&u.classList.add(v);var w=k(a,m,q);if(w)for(var x=w.length,z=0;z<x;++z)u.classList.add(w[z]);var A=m.getTreeNodeDepthOffset(q,p.curr);u.header.style.paddingLeft=A+"px",n.appendChild(u)}t+y<a.scrollY&&(h=t),g=t;var B=e(a,m,q);if(B&&B.length>0){p.curr++;for(var C=B[B.length-1],D=p.popIds.length-1;D>=0&&p.popIds[D]===q;)p.popIds[D--]=C;p.popIds.push(C),o=B.concat(o)}for(;p.popIds.length>0&&q===p.popIds[p.popIds.length-1];)p.popIds.pop(),p.curr--}for(a.paddingDiv.style.height=h+"px";o.length;){var q=o.shift(),r=-1===p.curr?0:m.getTreeNodeClientHeight(q),s=g,t=s+r;g=t;var B=e(a,m,q);B&&B.length&&(o=B.concat(o))}}c.style.height=g+"px"}function e(a,b,c){if(!b.isTreeNodeGroup(c))return null;if(a.isCollapsed(b,c))return null;var d=[];return b.forEachChild(c,function(a){d.push(a)}),d}function f(a){for(var b=a.elementsUsed,c=a.elementsPool,d=0;d<b;++d){var e=c[d];e.setAttribute("lmv-nodeId",""),e.className="";for(var f=e.header,g=f.childNodes.length-1,h=0;h<g;++h)f.removeChild(f.lastChild)}a.clear()}function g(a,b){a.dirty&&!b||(b?c(a):(a.dirty=!0,a.nextFrameId=requestAnimationFrame(function(){c(a)})))}function h(a,b){return"number"!=typeof b&&"string"!=typeof b?a.threeDelegate.getTreeNodeId(0|b):b}function i(a,b){for(var c=null;b&&b!==a.rootContainer;){if(b.hasAttribute("lmv-nodeId")){c=b;break}b=b.parentElement}if(!c)return null;var d=c.getAttribute("lmv-nodeId");return parseFloat(d)}function j(a,b){for(var c=null;b&&b!==a.rootContainer;){if(b.hasAttribute("lmv-modelId")){c=b;break}b=b.parentElement}if(!c)return null;var d=c.getAttribute("lmv-modelId");return parseInt(d)}function k(a,b,c){if(b.isControlId(c))return b.getControlIdCss(c);var d=b.getTreeNodeIndex(c);return a.nodeCssTable[a.nodeIndexToNodeCssTables[b.model.id][d]]}function l(a,b,c,d){var e=d.join(" "),f=a.cssStringToNodeCssTable[e]||a.nodeCssTable.length;f===a.nodeCssTable.length&&(a.nodeCssTable.push(d),a.cssStringToNodeCssTable[e]=f);var g=b.getTreeNodeIndex(c);a.nodeIndexToNodeCssTables[b.model.id][g]=f}function m(a,b){var c=document.createElement("lmvheader"),d=document.createElement("icon");c.appendChild(d);var e=document.createElement("div");return e.header=c,e.icon=d,e.appendChild(c),e}function n(a){var b=i(this,a.target);if(b){var c=j(this,a.target),d=this.getDelegate(c);d&&d.onTreeNodeDoubleClick(this,b,a)}}function o(a){var b=i(this,a.target);if(b){var c=j(this,a.target),d=this.getDelegate(c);d&&d.onTreeNodeRightClick(this,b,a)}}function p(a){if(!a.target.classList.contains("group")&&!a.target.classList.contains("leaf")){var b=i(this,a.target);if(b){var c=j(this,a.target),d=this.getDelegate(c);d&&(d.onTreeNodeClick(this,b,a),a.stopPropagation(),a.preventDefault())}}}function q(a){if(!a.target.classList.contains("group")&&!a.target.classList.contains("leaf")){var b=i(this,a.target);if(b){var c=j(this,a.target),d=this.getDelegate(c);d&&(d.onTreeNodeDoubleClick(this,b,a),a.stopPropagation(),a.preventDefault())}}}function r(a){if(!a.target.classList.contains("group")&&!a.target.classList.contains("leaf")){var b=i(this,a.target);if(b){var c=j(this,a.target),d=this.getDelegate(c);d&&(d.onTreeNodeRightClick(this,b,a),a.stopPropagation(),a.preventDefault())}}}function s(a){var b=i(this,a.target);if(b){var c=j(this,a.target),d=this.getDelegate(c);d&&(d.onTreeNodeIconClick(this,b,a),a.stopPropagation(),a.preventDefault())}}function t(a){a.stopPropagation(),a.preventDefault()}var u=Autodesk.Viewing,v=Autodesk.Viewing.UI,w=Autodesk.Viewing.Private,x=150,y=300,z=a.prototype;z.constructor=a,z.pushDelegate=function(a){this.delegates.push(a),this.idToDelegate[a.model.id]=a,g(this)},z.removeDelegate=function(a){for(var b=0;b<this.delegates.length;++b){if(this.delegates[b].model.id===a)return this.delegates.splice(b,1),delete this.idToDelegate[a],delete this.nodeIndexToNodeCssTables[a],void g(this)}},z.setInstanceTree=function(a,b){if(a.setInstanceTree(b),g(this),b){var c=new Uint8Array(a.getTreeNodeCount()),d=function(b){var d=a.getTreeNodeIndex(b);c[d]=a.isTreeNodeGroup(b)?1:2},e=a.instanceTree.getRootId();a.forEachChild(e,d,!0);var f=a.model.id;this.nodeIndexToNodeCssTables[f]=c;var h=0,i=0;b.enumNodeChildren(e,function(a){i||(h=a),i++}),this.setAllCollapsed(a,!0);var j=this.options.excludeRoot,k=this.options.startCollapsed;j?(this.setCollapsed(a,e,!1),k||this.setCollapsed(a,h,!1)):k||this.setCollapsed(a,a.rootId,!1),g(this,!0)}},z.show=function(a){this.rootContainer.style.display=block},z.getRootContainer=function(){return this.rootContainer},z.getDelegate=function(a){return this.idToDelegate[parseInt(a)]},z.isCollapsed=function(a,b){var c=k(this,a,b);return c&&-1!==c.indexOf("collapsed")},z.setCollapsed=function(a,b,c,d){c?(this.addClass(a,b,"collapsed",d),this.removeClass(a,b,"expanded",d)):(this.addClass(a,b,"expanded",d),this.removeClass(a,b,"collapsed",d))},z.setAllCollapsed=function(a,b){var c=function(b){this.addClass(a,b,"collapsed",!1),this.removeClass(a,b,"expanded",!1)}.bind(b?this:this),d=a.instanceTree.getRootId();this.iterate(a,d,function(b){return a.isTreeNodeGroup(b)&&c(b),!0})},z.addToSelection=function(a,b){for(var c=b.length,d=0;d<c;++d)this.addClass(a,b[d],"selected",!1);g(this)},z.removeFromSelection=function(a,b){for(var c=b.length,d=0;d<c;++d)this.removeClass(a,b[d],"selected",!1);g(this)},z.setSelection=function(a,b){return this.clearSelection(a),this.addToSelection(a,b),this.selectedNodes},z.clearSelection=function(a){var b=[],c=function(c){var d=k(this,a,c);d&&-1!==d.indexOf("selected")&&(b[0]=c,this.removeFromSelection(a,b))}.bind(this),d=a.instanceTree.getRootId();a.forEachChild(d,c,!0)},z.isSelected=function(a){var b=k(this,delegate,a);return b&&-1!==b.indexOf("selected")},z.scrollTo=function(a,b){var c=this.getDelegate(b.id),d=!1,e=[],f=function(b,c){if(!(d=d||a===b)){e.push(c.getTreeNodeClientHeight(b));var g=e.length,h=c.isTreeNodeGroup(b)&&-1!==k(this,c,b).indexOf("expanded");c.forEachChild(b,function(a){f(a,c)}),h||d||e.length>g&&e.splice(g)}}.bind(this);this.setCollapsed(c,a,!1,!0);var h=c.getRootId();if(f(h,c),!d)return-1;for(var i=0,j=e.length,l=this.isExcludeRoot()?1:0;l<j;++l)i+=e[l];if(1===this.delegates.length)return g(this,!0),i;for(var l=0;l<this.delegates.length;++l){var m=this.delegates[l];if(m===c)break;e=[],a=-1,d=!1,h=m.getRootId(),f(h,m),j=e.length;for(var n=0,o=0;o<j;++o)n+=e[o];i+=n}return g(this,!0),i},z.addClass=function(a,b,c,d){function e(b,c,d){var e=k(b,a,c);if(e){-1===e.indexOf(d)&&(e=e.slice(0),e.push(d),e.sort(),l(b,a,c,e))}}if(d)for(var f=a.getTreeNodeParentId(h(this,b));f;)e(this,f,c),f=a.getTreeNodeParentId(f);else e(this,b,c);return g(this),!0},z.removeClass=function(a,b,c,d){function e(b,c,d){var e=k(b,a,c);if(e){var f=e.indexOf(d);-1!==f&&(e=e.slice(0),e.splice(f,1),l(b,a,c,e))}}if(d)for(var f=a.getTreeNodeParentId(h(this,b));f;)e(this,f,c),f=a.getTreeNodeParentId(f);else e(this,b,c);return g(this),!0},z.hasClass=function(a,b){return 1!==k(this,delegate,a).indexOf(b)},z.clear=function(){for(var a,b=this.rootContainer;a=b.lastChild;)b.removeChild(a);for(var c=0;c<this.delegates.length;++c)this.delegates[c].clean();this.elementsUsed=0},z.iterate=function(a,b,c){void 0!==b&&null!==b&&a.shouldCreateTreeNode(b)&&c(b)&&a.forEachChild(b,function(b){this.iterate(a,b,c)}.bind(this))},z.forEachDelegate=function(a){for(var b=0;b<this.delegates.length;++b)a(this.delegates[b])},z.destroy=function(){this.clear(),cancelAnimationFrame(this.nextFrameId),this.rootContainer.parentNode.removeChild(this.rootContainer),this.rootContainer=null,this.rootId=-1,this.nodeCssTable=null,this.nodeIndexToNodeCssTables=null,this.cssStringToNodeCssTable=null,this.elementsPool=null,this.elementsUsed=-1,this.scrollY=-1,this.hammer&&(this.hammer.destroy(),this.hammer=null)},z.setScroll=function(a){Math.abs(this.scrollY-a)>y&&(this.scrollY=a,g(this))},z.displayNoProperties=function(a){if(a){if(!this.divNoProps){this.divNoProps=document.createElement("div");var b="Model Browser is not available.";this.divNoProps.innerText=Autodesk.Viewing.i18n.translate(b),this.divNoProps.setAttribute("data-i18n",b),this.divNoProps.classList.add("lmv-no-properties")}if(!this.divNoProps.parentNode){this.rootContainer.parentNode.appendChild(this.divNoProps)}}else this.divNoProps&&this.divNoProps.parentNode&&this.divNoProps.parentNode.removeChild(this.divNoProps)},z.isExcludeRoot=function(){return 1===this.delegates.length&&this.options.excludeRoot},z.getDelegateCount=function(){return this.delegates.length},w.TreeOnDemand=v.TreeOnDemand=a}(),function(){"use strict";var a=(Autodesk.Viewing.UI,function(a,b,c,d){this.kMinWdth=100,this.kMinHeight=100,this.visibilityCallbacks=[],this.movedSinceLastClick=!1,this.movedSinceCreate=!1,this.parentContainer=a,this.container=document.createElement("div"),this.container.id=b,this.container.lastWidth="",this.container.dockRight=!1,this.container.dockBottom=!1,this.titleLabel=c,d=d||{},d.hasOwnProperty("localizeTitle")||(d.localizeTitle=!0),d.hasOwnProperty("addFooter")||(d.addFooter=!0),this.options=d,this.container.classList.add("docking-panel"),a.appendChild(this.container),this.listeners=[],this.initialize(),this.setVisible(!1)});a.prototype.initialize=function(){this.title=this.createTitleBar(this.titleLabel||this.container.id),this.container.appendChild(this.title),this.initializeMoveHandlers(this.title),this.setTitle(this.titleLabel||this.container.id,this.options),this.closer=this.createCloseButton(),this.container.appendChild(this.closer),this.options.addFooter&&(this.footer=this.createFooter(),this.container.appendChild(this.footer))},a.prototype.uninitialize=function(){for(var a=0;a<this.listeners.length;++a){var b=this.listeners[a];b.target.removeEventListener(b.eventId,b.callback)}this.listeners=[],this.visibilityCallbacks=[],this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null,this.title=null,this.closer=null},a.prototype.addVisibilityListener=function(a){this.visibilityCallbacks.push(a)},a.prototype.setVisible=function(a){if(a){var b=this.getContainerBoundingRect();if(this.container.dockRight){var c=b.width,d=300,e=this.container.lastWidth||this.container.style.width;e||(e=this.container.getBoundingClientRect().width),e&&(d=parseInt(e)),this.container.style.left=c-d+"px"}if(this.container.dockBottom){var f=b.height,g=300,h=this.container.lastHeight||this.container.style.height;h||(h=this.container.getBoundingClientRect().height),h&&(g=parseInt(h));var i=f-g;this.container.style.top=i>0?i+"px":0}this.container.style.maxHeight=b.height+"px",this.container.style.maxWidth=b.width+"px",this.container.style.display="block"}else this.container.lastWidth=this.container.style.width,this.container.lastHeight=this.container.style.height,this.container.style.display="none";for(var j=0;j<this.visibilityCallbacks.length;j++)this.visibilityCallbacks[j](a)},a.prototype.isVisible=function(){return"block"===this.container.style.display},a.prototype.visibilityChanged=function(){},a.prototype.initializeMoveHandlers=function(a){function b(a){var b=m.style.minWidth?parseInt(m.style.minWidth):n.kMinWdth,c=m.style.minHeight?parseInt(m.style.minHeight):n.kMinHeight,d=n.getContainerBoundingRect();m.style.maxWidth&&parseInt(m.style.width)>parseInt(m.style.maxWidth)&&(m.style.width=m.style.maxWidth),m.style.maxHeight&&parseInt(m.style.height)>parseInt(m.style.maxHeight)&&(m.style.height=m.style.maxHeight),parseInt(m.style.width)<b&&(m.style.width=b+"px"),parseInt(m.style.height)<c&&(m.style.height=c+"px"),"touchmove"===a.type&&(a.screenX=a.touches[0].screenX,a.screenY=a.touches[0].screenY),k+=a.screenX-g,l+=a.screenY-h,e=i+k,f=j+l;var o=parseInt(m.style.width),p=parseInt(m.style.height);isNaN(o)&&(o=n.container.getBoundingClientRect().width),isNaN(p)&&(p=n.container.getBoundingClientRect().height),e<5&&(e=0),f<5&&(f=0),m.dockRight=!1,m.dockBottom=!1,d.width-5<e+o&&(e=d.width-o,m.dockRight=!0),d.height-5<f+p&&(f=d.height-p,m.dockBottom=!0),m.style.left=e+"px",m.style.top=f+"px",m.style.maxWidth=d.width-e+"px",m.style.maxHeight=d.height-f+"px",g=a.screenX,h=a.screenY,n.onMove(a,e,f)}function c(a){window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",c),window.removeEventListener("touchmove",b),window.removeEventListener("touchend",c),n.onEndMove(a,e,f)}function d(a){"touchstart"===a.type&&(a.screenX=a.touches[0].screenX,a.screenY=a.touches[0].screenY),g=a.screenX,h=a.screenY,k=0,l=0,i=n.container.offsetLeft,j=n.container.offsetTop,window.addEventListener("mousemove",b,!1),window.addEventListener("mouseup",c,!1),window.addEventListener("touchmove",b,!1),window.addEventListener("touchend",c,!1),a.preventDefault(),n.onStartMove(a,i,j)}var e,f,g,h,i,j,k,l,m=this.container,n=this;n.addEventListener(a,"mousedown",d),n.addEventListener(a,"touchstart",d)},a.prototype.initializeCloseHandler=function(a){var b=this;b.addEventListener(a,"click",function(a){b.setVisible(!1)},!1)},a.prototype.createScrollContainer=function(a){var b=document.createElement("div"),c=b.classList;return c.add("docking-panel-scroll"),c.add("docking-panel-container-solid-color-a"),c.add(a&&a.left?"left":"right"),a&&a.heightAdjustment&&(b.style.height="calc(100% - "+a.heightAdjustment+"px)"),a&&a.marginTop&&(b.style.marginTop=a.marginTop+"px"),b.id=this.container.id+"-scroll-container",this.container.appendChild(b),this.scrollContainer=b,this.scrollEaseCurve=a&&a.scrollEaseCurve||[0,0,.29,1],this.scrollEaseSpeed=a&&a.scrollEaseSpeed||.003,b},a.prototype.createTitleBar=function(a){var b=document.createElement("div");b.classList.add("docking-panel-title"),b.textContent=a;var c=this;return c.addEventListener(b,"click",function(a){c.movedSinceLastClick||c.onTitleClick(a),c.movedSinceLastClick=!1}),c.addEventListener(b,"dblclick",function(a){c.onTitleDoubleClick(a)}),b},a.prototype.createFooter=function(){var a=new avp.ResizeFooter(this.container);return this.container.style.resize="none",a.footer},a.prototype.setTitle=function(a,b){b&&b.localizeTitle?(this.title.setAttribute("data-i18n",a),a=Autodesk.Viewing.i18n.translate(a)):this.title.removeAttribute("data-i18n"),this.title.textContent=a},a.prototype.createCloseButton=function(){var a=document.createElement("div");return a.className="docking-panel-close",this.initializeCloseHandler(a),a},a.prototype.onStartMove=function(a,b,c){},a.prototype.onEndMove=function(a,b,c){},a.prototype.onMove=function(a,b,c){this.movedSinceLastClick=!0,this.movedSinceCreate=!0},a.prototype.onTitleClick=function(a){},a.prototype.onTitleDoubleClick=function(a){},a.prototype.addEventListener=function(a,b,c){
a.addEventListener(b,c),this.listeners.push({target:a,eventId:b,callback:c})},a.prototype.removeEventListener=function(a,b,c){for(var d=0;d<this.listeners.length;++d){var e=this.listeners[d];if(e.target===a&&e.eventId===b&&e.callback===c)return a.removeEventListener(b,c),this.listeners.splice(d,1),!0}return!1},a.prototype.getContentSize=function(){return{height:this.container.clientHeight,width:this.container.clientWidth}},a.prototype.resizeToContent=function(a){if(this.isVisible()){var b=this.getContentSize(),c=b.height,d=this.container.getBoundingClientRect(),e=this.getContainerBoundingRect(),f=this.container.querySelector(".docking-panel-footer");f&&(c+=f.getBoundingClientRect().height);var g=e.height;g-=d.top-e.top+75,a&&void 0!==a.maxHeight&&(g=Math.min(g,a.maxHeight)),c>g&&(c=g),this.container.style.maxHeight=g.toString()+"px",this.container.style.height=c.toString()+"px"}},a.prototype.getContainerBoundingRect=function(){return this.parentContainer.getBoundingClientRect()},a.prototype.animateScroll=function(a,b,c){function d(a,b){var c=3*a[1],d=3*(a[3]-a[1])-c;return(((1-c-d)*b+d)*b+c)*b}function e(j){var k=(j-i)*g;k=Math.min(k,1);var l=d(f,k),m=a+(b-a)*l;h.scrollTop=m,c&&c(m),k<1&&requestAnimationFrame(e)}var f=this.scrollEaseCurve,g=this.scrollEaseSpeed,h=this.scrollContainer,i=performance.now();requestAnimationFrame(e)},a.prototype.onViewerResize=function(a,b,c,d,e,f){var g=this.container,h=g.getBoundingClientRect(),i=h.width,j=h.height;if(!i||!j)return!1;var k=h.top,l=h.bottom,m=h.left,n=h.right;return e<i&&(i=Math.round(e),g.style.width=i+"px"),f<j&&(j=Math.round(f),g.style.height=j+"px"),(d<n||g.dockRight)&&(m=Math.round(d-i-c),g.style.left=m+"px"),(b<l||g.dockBottom)&&(k=Math.round(b-j-a),k<0&&(k=0),g.style.top=k+"px"),g.style.maxWidth=Math.round(e)+"px",g.style.maxHeight=Math.round(f)+"px",!0},Autodesk.Viewing.UI.DockingPanel=a}(),function(){"use strict";function a(a){var b=a.instanceTree;if(b){var c,d=a.rootId,e=b.getNodeName(d),f=0,g=0;b.enumNodeChildren(d,function(a){g||(c=b.getNodeName(a),f=a),g++}),a.hasDoubleRoot=1===g&&e===c,a.rootId=a.hasDoubleRoot?f:d}}function b(a){var b=a.getData();if(!b)return"";var c=b.urn;try{c=atob(b.urn)}catch(a){}var d=c.lastIndexOf("/");return-1===d?c:(c=c.substr(d+1),d=c.indexOf("?"),-1!==d&&(c=c.substr(0,d)),c)}function c(a){var b=a.getData();return b&&b.loadOptions&&b.loadOptions.modelNameOverride?b.loadOptions.modelNameOverride:""}var d=Autodesk.Viewing.UI,e=Autodesk.Viewing,f=Autodesk.Viewing.Private,g=function(a,b){d.TreeDelegate.call(),this.panel=a,this.model=b,this.modelDiv=document.createElement("div"),this.modelDiv.classList.add("model-div"),this.modelDiv.setAttribute("lmv-modelId",b.id),this.instanceTree=null,this.rootId=-1,this.state=1};g.prototype=Object.create(d.TreeDelegate.prototype),g.prototype.constructor=g,g.prototype.isLoading=function(){return 1===this.state},g.prototype.isAvailable=function(){return 2===this.state},g.prototype.isNotAvailable=function(){return 3===this.state},g.prototype.isControlId=function(a){return-1===a||-2===a},g.prototype.getControlIdCss=function(a){return null},g.prototype.getRootId=function(){return this.rootId},g.prototype.getTreeNodeId=function(a){return"object"==typeof a?(f.logger.warn("Object used instead of dbId. Fix it."),a.dbId):a},g.prototype.getTreeNodeIndex=function(a){return this.instanceTree.nodeAccess.dbIdToIndex[a]},g.prototype.getTreeNodeLabel=function(a){if(-1===a){var d=c(this.model);return d||(d=b(this.model)),e.i18n.translate("Loading model",{name:d})}if(-2===a){var d=c(this.model);return d||(d=b(this.model)),d}if(a===this.getRootId()){var d=c(this.model);if(d)return d}return-1e10==a?"Object 0":this.instanceTree.getNodeName(a)||"Object "+a},g.prototype.getTreeNodeClass=function(a){return-1===a||-2===a?"message-unexpected":""},g.prototype.getTreeNodeParentId=function(a){return this.instanceTree.nodeAccess.getParentId(a)},g.prototype.getTreeNodeCount=function(){return this.instanceTree.nodeAccess.getNumNodes()},g.prototype.getTreeNodeClientHeight=function(a){return 36},g.prototype.getTreeNodeDepthOffset=function(a,b){return 13+25*b},g.prototype.isTreeNodeGroup=function(a){return!this.isControlId(a)&&this.instanceTree.getChildCount(a)>0},g.prototype.shouldCreateTreeNode=function(a){return!0},g.prototype.createTreeNode=function(a,b){if(b.addEventListener("mousedown",function(){var a=function(){this.classList.remove("highlight"),document.removeEventListener("mouseup",a)}.bind(b);b.classList.add("highlight"),document.addEventListener("mouseup",a)}),!this.isControlId(a)){var c=document.createElement("div");c.dbId=a,c.classList.add("visibility"),c.addEventListener("mousedown",function(a){a.preventDefault(),a.stopPropagation()}),c.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation();var b=parseInt(a.target.dbId);this.panel.onEyeIcon(b,this.model)}.bind(this)),b.appendChild(c)}if(-1===a){var e=document.createElement("img");e.src=f.getResourceUrl("res/ui/spinner.png"),e.style.animation="lmv-spinner-perpetual-motion 1s infinite linear",e.style.float="right",e.style.marginRight="5px",e.style.width="20px",b.appendChild(e)}var g={localize:-1===a||-2===a};d.TreeDelegate.prototype.createTreeNode.call(this,a,b,g)},g.prototype.onTreeNodeRightClick=function(a,b,c){this.isControlId(b)||this.panel.onTreeNodeRightClick(a,b,this.model,c)},g.prototype.onTreeNodeClick=function(a,b,c){this.isControlId(b)||this.panel.onTreeNodeClick(a,b,this.model,c)},g.prototype.onTreeNodeDoubleClick=function(a,b,c){},g.prototype.onTreeNodeIconClick=function(a,b,c){if(this.isTreeNodeGroup(b)){var d=a.isCollapsed(this,b);a.setCollapsed(this,b,!d)}},g.prototype.onTreeNodeReized=function(a){},g.prototype.forEachChild=function(a,b,c){this.isControlId(a)||this.instanceTree.enumNodeChildren(a,b,c)},g.prototype.setInstanceTree=function(b){this.instanceTree=b,this.state=b?2:3,this.rootId=b?b.getRootId():-2,a(this)},g.prototype.clean=function(){for(var a,b=this.modelDiv;a=b.lastChild;)b.removeChild(a)},d.ModelStructureTreeDelegate=g}(),function(){"use strict";var a=Autodesk.Viewing.UI,b=(Autodesk.Viewing.Private,function(b,c,d,e){a.DockingPanel.call(this,b,c,d,e),this.container.classList.add("model-structure-panel"),e=e||{},e.heightAdjustment||(e.heightAdjustment=40),e.marginTop||(e.marginTop=0),e.left=!0,this.createScrollContainer(e),this.onScroll=this.onScroll.bind(this),this.scrollContainer.addEventListener("scroll",this.onScroll),this.scrollContainer.style["overflow-x"]="hidden",this.options=e,this.tree=null,this._pendingModels=[],this.uiCreated=!1;var f=this;this.addVisibilityListener(function(a){a&&(f.uiCreated||f.createUI(),f.resizeToContent())})});b.prototype=Object.create(a.DockingPanel.prototype),b.prototype.constructor=b,b.prototype.uninitialize=function(b){this.scrollContainer.addEventListener("scroll",this.onScroll),this.scrollContainer.parentNode.removeChild(this.scrollContainer),a.DockingPanel.prototype.uninitialize.call(this)},b.prototype.addModel=function(a){a&&(this.uiCreated?this.createTreeUI(a):this._pendingModels.push(a))},b.prototype.unloadModel=function(a){if(a)if(this.uiCreated)this.removeTreeUI(a);else{var b=this._pendingModels.indexOf(a);if(-1===b)return;this._pendingModels.splice(b,1)}},b.prototype.createUI=function(){if(!this.uiCreated){var b="",c=!0;if(this.options&&this.options.defaultTitle?(b=this.options.defaultTitle,c=!!this.options.localizeTitle):(b=this.modelTitle,c=!1),b||(b="Browser"),this.setTitle(b,{localizeTitle:c}),this.uiCreated=!0,this.tree=new a.TreeOnDemand(this.scrollContainer,this.options),0!==this._pendingModels.length){for(var d=0;d<this._pendingModels.length;++d)this.createTreeUI(this._pendingModels[d]);this._pendingModels=[]}}},b.prototype.createTreeUI=function(b){var c=new a.ModelStructureTreeDelegate(this,b);this.tree.pushDelegate(c);var d=this;b.getObjectTree(function(a){d.setInstanceTree(c,a)},function(){d.setInstanceTree(c,null)})},b.prototype.setInstanceTree=function(a,b){this.tree.setInstanceTree(a,b)},b.prototype.removeTreeUI=function(a){this.tree.removeDelegate(a.id),this.scrollContainer.scrollTop=0,this.onScroll()},b.prototype.onScroll=function(a){this.tree.setScroll(this.scrollContainer.scrollTop)},b.prototype.getNodeLabel=function(a){return this.myDelegate.getNodeLabel(a)},b.prototype.onTreeNodeClick=function(a,b,c,d){throw new Error("Method must be overriden.")},b.prototype.onTreeNodeRightClick=function(a,b,c,d){throw new Error("Method must be overriden.")},b.prototype.onTitleClick=function(a){},b.prototype.onTitleDoubleClick=function(a){},Autodesk.Viewing.UI.ModelStructurePanel=b}(),function(){"use strict";function a(a){a=String(a);var b=' target="blank" class="propertyLink" ';return[{pattern:/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,value:"<a"+b+'href="$&">$&</a>'},{pattern:/(^|[^\/])(www\.[\S]+(\b|$))/gim,value:"$1<a"+b+'href="http://$2">$2</a>'}].reduce(function(a,b){return a.replace(b.pattern,b.value)},a)}var b=Autodesk.Viewing.UI,c=function(a,c,d,e){b.DockingPanel.call(this,a,c,d,e),this.title.classList.add("docking-panel-delimiter-shadow"),this.container.classList.add("property-panel"),this.container.dockRight=!0,this.createScrollContainer({left:!1,heightAdjustment:70,marginTop:0}),this.highlightableElements={};var f=this,g=function(){function a(a){return"category"===a.type}var c=new b.TreeDelegate;return c.getTreeNodeId=function(a){return a.name+(a.hasOwnProperty("value")?a.value:"")+(a.hasOwnProperty("category")?a.category:"")},c.getTreeNodeClass=function(b){return a(b)?f.getCategoryClass(b):f.getPropertyClass(b)},c.isTreeNodeGroup=function(b){return a(b)},c.onTreeNodeClick=function(b,c,d){a(c)?f.onCategoryClick(c,d):f.onPropertyClick(c,d)},c.onTreeNodeRightClick=function(b,c,d){a(c)?f.onCategoryRightClick(c,d):f.onPropertyRightClick(c,d)},c.onTreeNodeDoubleClick=function(b,c,d){a(c)?f.onCategoryDoubleClick(c,d):f.onPropertyDoubleClick(c,d)},c.onTreeNodeIconClick=function(b,c,d){a(c)?f.onCategoryIconClick(c,d):f.onPropertyIconClick(c,d)},c.createTreeNode=function(b,c,d){var e=null;(e=a(b)?f.displayCategory(b,c,d):f.displayProperty(b,c,d))&&(f.highlightableElements[this.getTreeNodeId(b)]=e)},c}();this.tree=new b.Tree(g,null,this.scrollContainer,{})};c.prototype=Object.create(b.DockingPanel.prototype),c.prototype.constructor=c,c.prototype.setProperties=function(a,b){this.removeAllProperties();for(var c=[],d=[],e=0;e<a.length;e++){var f=a[e];if(!f.hidden){var g=a[e].displayCategory;g&&"string"==typeof g&&""!==g?c.push(f):d.push(f)}}if(c.length+d.length===0)return void this.showNoProperties();for(var e=0;e<c.length;e++){var f=c[e],h=f.precision||Autodesk.Viewing.Private.calculatePrecision(f.displayValue),i=Autodesk.Viewing.Private.formatValueWithUnits(f.displayValue,f.units,f.type,h);this.addProperty(f.displayName,i,f.displayCategory)}for(var j=c.length>0,e=0;e<d.length;e++){var f=d[e],h=f.precision||Autodesk.Viewing.Private.calculatePrecision(f.displayValue),i=Autodesk.Viewing.Private.formatValueWithUnits(f.displayValue,f.units,f.type,h);this.addProperty(f.displayName,i,j?"Other":"",j?{localizeCategory:!0}:{})}},c.prototype.showNoProperties=function(){this.removeAllProperties();var a=this.tree.myRootContainer,b=document.createElement("div");b.className="no-properties";var c="No properties to display";b.setAttribute("data-i18n",c),b.textContent=Autodesk.Viewing.i18n.translate(c),a.appendChild(b)},c.prototype.showDefaultProperties=function(){this.showNoProperties(),this.resizeToContent()},c.prototype.areDefaultPropertiesShown=function(){return!this.hasProperties()},c.prototype.addProperty=function(a,b,c,d){if(this.tree.getElementForNode({name:a,value:b,category:c}))return!1;var e=null,f={name:a,value:b,type:"property"};return c?(e=this.tree.getElementForNode({name:c}),e||(e=this.tree.createElement_({name:c,type:"category"},this.tree.myRootContainer,d&&d.localizeCategory?{localize:!0}:null)),f.category=c):e=this.tree.myRootContainer,this.tree.createElement_(f,e,d&&d.localizeProperty?{localize:!0}:null),!0},c.prototype.hasProperties=function(){for(var a in this.highlightableElements)return!0;return!1},c.prototype.removeProperty=function(a,b,c,d){var e={name:a,value:b,category:c},f=this.tree.getElementForNode(e);return!!f&&(delete this.highlightableElements[this.tree.delegate().getTreeNodeId(e)],f.parentNode.removeChild(f),!0)},c.prototype.removeAllProperties=function(){this.highlightableElements={},this.tree.clear()},c.prototype.setCategoryCollapsed=function(a,b){var c=this.tree.delegate().getTreeNodeId(a);this.tree.setCollapsed(c,b)},c.prototype.isCategoryCollapsed=function(a){var b=this.tree.delegate().getTreeNodeId(a);return this.tree.isCollapsed(b)},c.prototype.getContentSize=function(){var a=this.tree.myRootContainer;return{height:a.clientHeight+55,width:a.clientWidth}},c.prototype.highlight=function(a,b){for(var c in this.highlightableElements)for(var d=this.highlightableElements[c],e=0;e<d.length;++e)!function(b){var c=b.innerHTML,d=c.replace(/(<highlight>|<\/highlight>)/gim,"");if(c!==d&&(b.innerHTML=d),a&&""!==a){var e=new RegExp("(\\b"+a+"\\b)","gim"),f=d.replace(e,"<highlight>$1</highlight>");b.innerHTML=f}}(d[e])},c.prototype.displayCategory=function(a,b,c){var d=document.createElement("div"),e=a.name;return c&&c.localize&&(d.setAttribute("data-i18n",e),e=Autodesk.Viewing.i18n.translate(e)),d.textContent=e,d.title=e,d.className="category-name",b.appendChild(d),[d]},c.prototype.displayProperty=function(b,c,d){var e=document.createElement("div"),f=b.name;d&&d.localize&&(e.setAttribute("data-i18n",f),f=Autodesk.Viewing.i18n.translate(f)),e.textContent=f,e.title=f,e.className="property-name";var g=document.createElement("div");g.className="separator";var h=document.createElement("div");h.textContent=b.value;var i=b.value;return h.title=i,i=a(i),h.innerHTML=i,h.className="property-value",c.appendChild(e),c.appendChild(g),c.appendChild(h),[e,h]},c.prototype.getCategoryClass=function(a){return"category"},c.prototype.getPropertyClass=function(a){return"property"},c.prototype.onCategoryClick=function(a,b){this.setCategoryCollapsed(a,!this.isCategoryCollapsed(a))},c.prototype.onPropertyClick=function(a,b){},c.prototype.onCategoryIconClick=function(a,b){this.setCategoryCollapsed(a,!this.isCategoryCollapsed(a))},c.prototype.onPropertyIconClick=function(a,b){},c.prototype.onCategoryDoubleClick=function(a,b){},c.prototype.onPropertyDoubleClick=function(a,b){},c.prototype.onCategoryRightClick=function(a,b){},c.prototype.onPropertyRightClick=function(a,b){},Autodesk.Viewing.UI.PropertyPanel=c}(),function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.Private,c=function(a){this.viewer=a,this.menus=[],this.container=null,this.open=!1};c.prototype.constructor=c,c.prototype.show=function(a,b){var c=this.viewer.container.getBoundingClientRect();Array.isArray(a.changedPointers)&&a.changedPointers.length>0&&(a.clientX=a.changedPointers[0].clientX,a.clientY=a.changedPointers[0].clientY);var d=a.clientX-c.left,e=a.clientY-c.top;this.open||(this.showMenu(b,d,e),this.open=!0)},c.prototype.showMenu=function(c,d,e){var f,g=[],h=document.createElement("div");h.style.left="0",h.style.top="0",h.style.width="100%",h.style.height="100%",h.style.position="absolute",h.style.zIndex="10";var i=document.createElement("div");i.classList.add("menu"),i.classList.add("docking-panel"),i.classList.add("docking-panel-container-solid-color-a"),h.appendChild(i),this.viewer.container.appendChild(h),this.container=h,this.menus.push(i);for(var j=0;j<c.length;++j){var k=c[j],l=k.title,m=k.target,n=k.icon,o=k.shortcut;f=this.createMenuItem(l,n,o),i.appendChild(f),"function"==typeof m?this.addCallbackToMenuItem(f,m):Array.isArray(m)?g.push({menuItem:f,target:m}):b.logger.warn("Invalid context menu option:",l,m)}var p=i.getBoundingClientRect(),q=p.width,r=p.height,s=this.viewer.container.getBoundingClientRect(),t=s.width,u=s.height,v=a.isTouchDevice()&&!this.viewer.navigation.getUseLeftHandedInput();for(v&&(d-=q),d<0&&(d=0),t<d+q&&(d=t-q)<0&&(d=0),e<0&&(e=0),u<e+r&&(e=u-r)<0&&(e=0),i.style.top=Math.round(e)+"px",i.style.left=Math.round(d)+"px",j=0;j<g.length;++j){var w=g[j];f=w.menuItem,p=f.getBoundingClientRect(),d=Math.round((v?p.left:p.right)-s.left),e=Math.round(p.top-s.top),this.addSubmenuCallbackToMenuItem(f,w.target,d,e)}this.OnHide=function(a){"menu-item"!==a.target.className&&0===a.button&&this.hide(a)}.bind(this),this.OnMove=function(a){"menu-item"!==a.target.className&&(this.hide(a),this.show(a,c))}.bind(this),this.container.addEventListener("touchend",this.OnHide),this.container.addEventListener("click",this.OnHide),this.container.addEventListener("contextmenu",this.OnMove)},c.prototype.createMenuItem=function(a,b,c){var d=document.createElement("div");return d.className="menu-item",c=c||"",this.setMenuItemIcon(d,b),this.setMenuItemText(d,a),this.setMenuItemShortcut(d,c),d},c.prototype.setMenuItemIcon=function(a,b){var c=document.createElement("div");c.classList.add("menu-item-icon"),b&&c.classList.add(b),a.appendChild(c)},c.prototype.setMenuItemText=function(a,b){var c=document.createElement("div");c.classList.add("menu-item-text"),c.setAttribute("data-i18n",b),c.textContent=Autodesk.Viewing.i18n.translate(b),a.appendChild(c)},c.prototype.setMenuItemShortcut=function(a,b){var c=document.createElement("div");c.classList.add("menu-item-shortcut"),c.textContent=b,a.appendChild(c)},c.prototype.addCallbackToMenuItem=function(a,b){var c=this;a.addEventListener("click",function(a){return c.hide(),b(),a.preventDefault(),!1},!1)},c.prototype.addSubmenuCallbackToMenuItem=function(a,b,c,d){var e=this;a.addEventListener("click",function(){e.showMenu(b,c,d)},!1)},c.prototype.hide=function(){return!!this.open&&(this.menus=[],this.open=!1,this.container.removeEventListener("touchend",this.OnHide),this.container.removeEventListener("click",this.OnHide),this.container.removeEventListener("contextmenu",this.OnMove),this.container.parentNode.removeChild(this.container),this.container=null,!0)},Autodesk.Viewing.Private.ContextMenu=c}(),function(){"use strict";var a=(Autodesk.Viewing.UI,Autodesk.Viewing.Private),b=function(b){this.viewer=b,this.contextMenu=new a.ContextMenu(b)};b.prototype.constructor=b,b.prototype.show=function(a){var b=this.viewer.getSelectionCount(),c=this.viewer.getSelectionVisibility(),d={numSelected:b,hasSelected:0<b,hasVisible:c.hasVisible,hasHidden:c.hasHidden},e=this.buildMenu(a,d);this.viewer.runContextMenuCallbacks(e,d),e&&0<e.length&&this.contextMenu.show(a,e)},b.prototype.hide=function(){return this.contextMenu.hide()},b.prototype.buildMenu=function(a,b){return null},Autodesk.Viewing.UI.ObjectContextMenu=b}(),function(){AutodeskNamespace("Autodesk.Viewing.Private");var a=Autodesk.Viewing,b=Autodesk.Viewing.Private;b.OptionSlider=function(b,c,d,e,f){function g(a){a.target!=h.stepperElement&&(h.stepperElement.value=h.sliderElement.value),h.fireChangeEvent()}var h=this;this.tbody=e;var i=f&&f.insertAtIndex?f.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(i);var j=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",b),this.caption.textContent=a.i18n.translate(b),this.sliderElement=document.createElement("input"),this.sliderElement.type="range",this.sliderElement.id=b+"_slider",this.sliderElement.min=c,this.sliderElement.max=d,j.appendChild(this.caption),j.appendChild(this.sliderElement),j=this.sliderRow.insertCell(1),this.stepperElement=document.createElement("input"),this.stepperElement.type="number",this.stepperElement.id=b+"_stepper",this.stepperElement.min=c,this.stepperElement.max=d,this.stepperElement.step=1,this.stepperElement.style.width="64px",j.appendChild(this.stepperElement),this.blockEvent=!1,this.stepperElement.addEventListener("change",function(a){a.target!=h.sliderElement&&(h.sliderElement.value=h.stepperElement.value),h.fireChangeEvent()},!1),this.sliderElement.addEventListener("change",g,!1),this.sliderElement.addEventListener("input",g,!1)},b.OptionSlider.prototype.constructor=b.OptionSlider,a.EventDispatcher.prototype.apply(b.OptionSlider.prototype),b.OptionSlider.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.value=this.sliderElement.value;var a=new CustomEvent("change",{detail:{target:this,value:this.sliderElement.value}});this.dispatchEvent(a)}},b.OptionSlider.prototype.setValue=function(a){this.blockEvent=!0,this.value=a,this.sliderElement.value=a,this.stepperElement.value=a,this.blockEvent=!1},b.OptionSlider.prototype.setDisabled=function(a){this.sliderElement.disabled=a,this.stepperElement.disabled=a,this.caption.disabled=a},b.OptionCheckbox=function(b,c,d,e,f){var g=this;this.tbody=c;var h=f&&f.insertAtIndex?f.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(h),this.sliderRow.classList.add("switch-slider-row");var i=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",b),this.caption.textContent=a.i18n.translate(b),i.appendChild(this.caption),i=this.sliderRow.insertCell(1),e&&(this.description=document.createElement("div"),this.description.setAttribute("data-i18n",e),this.description.textContent=a.i18n.translate(e),i.appendChild(this.description),i=this.sliderRow.insertCell(2));var j=document.createElement("label");j.classList.add("switch"),this.checkElement=document.createElement("input"),this.checkElement.type="checkbox",this.checkElement.id=b+"_check",this.checkElement.checked=d,j.appendChild(this.checkElement);var k=document.createElement("div");k.classList.add("slider"),j.appendChild(k),i.appendChild(j),this.blockEvent=!1,this.checked=d,this.checkElement.addEventListener("change",function(a){g.fireChangeEvent()},!1),a.isTouchDevice()&&(this.sliderRowHammer=new a.Hammer.Manager(this.sliderRow,{recognizers:[[a.Hammer.Tap]],handlePointerEventMouse:!1,inputClass:a.isIE11?a.Hammer.PointerEventInput:a.Hammer.TouchInput}),this.sliderRowHammer.on("tap",function(a){a.preventDefault(),a.target.click()})),this.checkElement.addEventListener("click",function(a){a.stopPropagation()},!1),this.sliderRow.addEventListener("click",function(a){g.checkElement.disabled||(g.checkElement.checked=!g.checkElement.checked,g.fireChangeEvent())},!1)},b.OptionCheckbox.prototype.constructor=b.OptionCheckbox,a.EventDispatcher.prototype.apply(b.OptionCheckbox.prototype),b.OptionCheckbox.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.checked=this.checkElement.checked;var a=new CustomEvent("change",{detail:{target:this,value:this.checkElement.checked}});this.dispatchEvent(a)}},b.OptionCheckbox.prototype.setChecked=function(a){this.checkElement.checked!=a&&(this.checkElement.checked=a,this.fireChangeEvent())},b.OptionCheckbox.prototype.setValue=function(a){this.blockEvent=!0,this.checked=a,this.checkElement.checked=a,this.blockEvent=!1},b.OptionCheckbox.prototype.getValue=function(){return this.checkElement.checked},b.OptionCheckbox.prototype.setDisabled=function(a){this.checkElement.disabled=a,this.caption.disabled=a},b.OptionCheckbox.prototype.setVisibility=function(a){this.sliderRow.style.display=a?"table-row":"none"},b.OptionLabel=function(b,c,d){this.tbody=c;var e=d&&d.insertAtIndex?d.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(e);var f=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",b),this.caption.textContent=a.i18n.translate(b),f.appendChild(this.caption),f.colSpan="3",this.blockEvent=!1},b.OptionDropDown=function(b,c,d,e,f,g){var h=this;this.tbody=c;var i=g&&g.insertAtIndex?g.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(i),this.dropdownElement=document.createElement("select"),this.dropdownElement.id=b+"_dropdown",this.dropdownElement.classList.add("option-drop-down");for(var j=0;j<d.length;j++){var k=document.createElement("option");k.value=j,k.setAttribute("data-i18n",d[j]),k.textContent=a.i18n.translate(d[j]),this.dropdownElement.add(k)}this.selectedIndex=this.dropdownElement.selectedIndex=e;var l=this.sliderRow.insertCell(0);if(this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",b),this.caption.textContent=a.i18n.translate(b),l.appendChild(this.caption),f){l.colSpan="2",this.sliderRow=this.tbody.insertRow(i);var l=this.sliderRow.insertCell(0);l.appendChild(this.dropdownElement),l.colSpan="2",this.dropdownElement.classList.add("tabcell")}else{var l=this.sliderRow.insertCell(1);l.appendChild(this.dropdownElement)}l.style.paddingLeft=(g&&void 0!==g.paddingLeft?g.paddingLeft:5)+"px",l.style.paddingRight=(g&&void 0!==g.paddingRight?g.paddingRight:5)+"px",this.blockEvent=!1,this.dropdownElement.addEventListener("change",function(a){h.fireChangeEvent()},!1)},b.OptionDropDown.prototype.constructor=b.OptionDropDown,a.EventDispatcher.prototype.apply(b.OptionDropDown.prototype),b.OptionDropDown.prototype.setSelectedIndex=function(a){this.blockEvent=!0,this.selectedIndex=this.dropdownElement.selectedIndex=a,this.blockEvent=!1},b.OptionDropDown.prototype.setSelectedValue=function(a){this.blockEvent=!0,this.dropdownElement.selectedValue=a,this.selectedIndex=this.dropdownElement.selectedIndex,this.blockEvent=!1},b.OptionDropDown.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.selectedIndex=this.dropdownElement.selectedIndex;var a=new CustomEvent("change",{detail:{target:this,value:this.selectedIndex}});this.dispatchEvent(a)}},b.OptionDropDown.prototype.setDisabled=function(a){this.dropdownElement.disabled=a,this.caption.disabled=a},b.ResizeFooter=function(a,b){var c=document.createElement("div");c.classList.add("docking-panel-footer");var d=document.createElement("div");d.classList.add("docking-panel-footer-resizer"),c.appendChild(d);var e=!1,f=a.getBoundingClientRect(),g={x:0,y:0},h=document.createElement("div");h.classList.add("adsk-viewing-viewer"),h.classList.add("docking-panel-resize-overlay");var i=function(b){e=!0,f=a.getBoundingClientRect(),document.body.appendChild(h),document.addEventListener("touchmove",k),document.addEventListener("touchcancel",j),document.addEventListener("touchend",j),document.addEventListener("mousemove",k),document.addEventListener("mouseup",j),b.preventDefault(),b.stopPropagation()},j=function(a){document.body.contains(h)&&(document.body.removeChild(h),document.removeEventListener("touchmove",k),document.removeEventListener("touchcancel",j),document.removeEventListener("touchend",j),document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",j),a.preventDefault(),a.stopPropagation())},k=function(c){"touchmove"===c.type&&(c.canvasX=c.touches[0].screenX,c.canvasY=c.touches[0].screenY),e&&(e=!1,g.x=c.canvasX||c.clientX,g.y=c.canvasY||c.clientY);var d=(c.canvasX||c.clientX)-g.x,h=(c.canvasY||c.clientY)-g.y,i=parseInt(f.width+d),j=parseInt(f.height+h);a.style.width=i+"px",a.style.height=j+"px",b&&b(i,j),c.preventDefault(),c.stopPropagation()};d.addEventListener("touchstart",i),d.addEventListener("mousedown",i),a.style.resize="none",a.appendChild(c),this.footer=c,this.resizer=d}}(),function(){"use strict";var a=function(a){this.bg=document.createElement("div"),this.bg.className="progressbg",this.fg=document.createElement("div"),this.fg.className="progressfg",this.bg.appendChild(this.fg),this.lastValue=-1,a.appendChild(this.bg),this.widthScale=this.fg.clientWidth};a.prototype.setPercent=function(a){a!=this.lastValue&&(this.lastValue=a,a>=99?this.bg.style.visibility="hidden":(this.bg.style.visibility="visible",this.fg.style.width=this.widthScale*a*.01+"px"))},Autodesk.Viewing.Private.ProgressBar=a}(),AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.RenderOptionsPanel=function(a){var b=this,c=Autodesk.Viewing,d=Autodesk.Viewing.Private;this.viewer=a,Autodesk.Viewing.UI.DockingPanel.call(this,a.container,"RenderOptionsPanel","Rendering Options"),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.createScrollContainer({heightAdjustment:70}),this.scrollContainer.appendChild(this.table),this.container.style.width="320px",this.container.style.top="260px",this.container.style.left="220px",this.container.style.height="460px",this.container.dockRight=!0,this.postprocStyle=new d.OptionSlider("Postprocess Style",0,4,this.tbody),this.postprocStyle.setValue(0),this.postprocStyle.sliderElement.step=this.postprocStyle.stepperElement.step=1,this.addEventListener(this.postprocStyle,"change",function(c){var d=Math.floor(parseFloat(b.postprocStyle.value)),e="";switch(d){case 0:e="";break;case 1:e="edging";break;case 2:e="cel";break;case 3:e="graphite";break;case 4:e="pencil"}a.impl.preloadPostProcessStyle(),a.impl.setPostProcessParameter("style",e);var f=0!=d;b.edgesToggle.setDisabled(!f),b.grayscaleToggle.setDisabled(!f),b.brightness.setDisabled(!f),b.contrast.setDisabled(!f),b.preserveColor.setDisabled(!f),b.firstParam.setDisabled(d<2),b.secondParam.setDisabled(d<3)}),this.edgesToggle=new d.OptionCheckbox("Display edges",this.tbody,!0),this.edgesToggle.setDisabled(!0),this.addEventListener(this.edgesToggle,"change",function(c){a.impl.setPostProcessParameter("edges",b.edgesToggle.checked)}),this.grayscaleToggle=new d.OptionCheckbox("Grayscale",this.tbody,!1),this.grayscaleToggle.setDisabled(!0),this.addEventListener(this.grayscaleToggle,"change",function(c){a.impl.setPostProcessParameter("grayscale",b.grayscaleToggle.checked)}),this.brightness=new d.OptionSlider("Brightness",-1,1,this.tbody),this.brightness.setValue(0),this.brightness.sliderElement.step=this.brightness.stepperElement.step=.01,this.brightness.setDisabled(!0),this.addEventListener(this.brightness,"change",function(c){a.impl.setPostProcessParameter("brightness",parseFloat(b.brightness.value))}),this.contrast=new d.OptionSlider("Contrast",-1,1,this.tbody),this.contrast.setValue(0),this.contrast.sliderElement.step=this.contrast.stepperElement.step=.01,this.contrast.setDisabled(!0),this.addEventListener(this.contrast,"change",function(c){a.impl.setPostProcessParameter("contrast",parseFloat(b.contrast.value))}),this.preserveColor=new d.OptionCheckbox("Preserve Color",this.tbody,!1),this.preserveColor.setDisabled(!0),this.addEventListener(this.preserveColor,"change",function(c){a.impl.setPostProcessParameter("preserveColor",b.preserveColor.checked)}),this.firstParam=new d.OptionSlider("2*Levels/Repeats",1,5,this.tbody),this.firstParam.setValue(3),this.firstParam.sliderElement.step=this.firstParam.stepperElement.step=.01,this.firstParam.setDisabled(!0),this.addEventListener(this.firstParam,"change",function(c){switch(Math.floor(parseFloat(b.postprocStyle.value))){case 1:break;case 2:a.impl.setPostProcessParameter("levels",2*parseFloat(b.firstParam.value));break;case 3:case 4:a.impl.setPostProcessParameter("repeats",parseFloat(b.firstParam.value))}}),this.secondParam=new d.OptionSlider("Rotation",0,1,this.tbody),this.secondParam.setValue(0),this.secondParam.sliderElement.step=this.secondParam.stepperElement.step=.01,this.secondParam.setDisabled(!0),this.addEventListener(this.secondParam,"change",function(c){a.impl.setPostProcessParameter("rotation",parseFloat(b.secondParam.value))}),this.saoToggle=new d.OptionCheckbox("AO Enabled",this.tbody,!0),this.addEventListener(this.saoToggle,"change",function(c){var d=b.saoToggle.checked;a.prefs.set("ambientShadows",d),a.setQualityLevel(d,a.impl.renderer().settings.antialias)}),this.saoRadius=new d.OptionSlider("AO Radius",0,200,this.tbody),this.saoRadius.setValue(10),this.saoRadius.sliderElement.step=this.saoRadius.stepperElement.step=.01,this.addEventListener(this.saoRadius,"change",function(c){a.impl.renderer().setAOOptions(parseFloat(b.saoRadius.value),parseFloat(b.saoIntensity.value)),a.impl.renderer().composeFinalFrame()}),this.saoIntensity=new d.OptionSlider("AO Intensity",0,3,this.tbody),this.saoIntensity.setValue(.4),this.saoIntensity.sliderElement.step=this.saoIntensity.stepperElement.step=.01,this.addEventListener(this.saoIntensity,"change",function(c){
a.impl.renderer().setAOOptions(parseFloat(b.saoRadius.value),parseFloat(b.saoIntensity.value)),a.impl.renderer().composeFinalFrame()}),this.groundShadowAlpha=new d.OptionSlider("Shadow Alpha",0,2,this.tbody),this.groundShadowAlpha.setValue(1),this.groundShadowAlpha.sliderElement.step=this.groundShadowAlpha.stepperElement.step=.1,this.addEventListener(this.groundShadowAlpha,"change",function(c){a.setGroundShadowAlpha(parseFloat(b.groundShadowAlpha.value))}),this.groundShadowColor=new d.OptionCheckbox("Shadow Color",this.tbody),c.isIE11||(this.groundShadowColor.checkElement.value="#000000",this.groundShadowColor.checkElement.type="color"),this.addEventListener(this.groundShadowColor,"change",function(c){var d=b.groundShadowColor.checkElement.value;a.setGroundShadowColor(new THREE.Color(parseInt(d.substr(1,7),16)))}),this.groundReflectionAlpha=new d.OptionSlider("Reflection Alpha",0,2,this.tbody),this.groundReflectionAlpha.setValue(1),this.groundReflectionAlpha.sliderElement.step=this.groundReflectionAlpha.stepperElement.step=.1,this.addEventListener(this.groundReflectionAlpha,"change",function(c){a.setGroundReflectionAlpha(parseFloat(b.groundReflectionAlpha.value))}),this.groundReflectionColor=new d.OptionCheckbox("Reflection Color",this.tbody),c.isIE11||(this.groundReflectionColor.checkElement.value="#000000",this.groundReflectionColor.checkElement.type="color"),this.addEventListener(this.groundReflectionColor,"change",function(c){var d=b.groundReflectionColor.checkElement.value;a.setGroundReflectionColor(new THREE.Color(parseInt(d.substr(1,7),16)))});for(var e=[],f=0;f<d.LightPresets.length;f++)e.push(d.LightPresets[f].name);this.envSelect=new d.OptionDropDown("Environment",this.tbody,e,a.impl.currentLightPreset()),this.addEventListener(this.envSelect,"change",function(c){var d=b.envSelect.selectedIndex;a.setLightPreset(d)});var g=a.impl.renderer().getToneMapMethod();this.toneMapMethod=new d.OptionDropDown("Tonemap Method",this.tbody,["None","Canon-Lum","Canon-RGB"],g),this.addEventListener(this.toneMapMethod,"change",function(){var c=b.toneMapMethod.selectedIndex;a.impl.setTonemapMethod(c)}),this.exposureBias=new d.OptionSlider("Exposure Bias",-30,30,this.tbody),this.exposureBias.setValue(a.impl.renderer().getExposureBias()),this.exposureBias.sliderElement.step=this.exposureBias.stepperElement.step=.1,this.addEventListener(this.exposureBias,"change",function(c){a.impl.setTonemapExposureBias(b.exposureBias.value,b.whiteScale.value)}),this.exposureBias.setDisabled(0==g),this.whiteScale=new d.OptionSlider("Light Intensity",-5,20,this.tbody);var h=0;a.impl.dir_light1&&(h=0!=a.impl.dir_light1.intensity?Math.log(a.impl.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(h),this.whiteScale.sliderElement.step=this.whiteScale.stepperElement.step=.1,this.addEventListener(this.whiteScale,"change",function(c){a.impl.dir_light1.intensity=Math.pow(2,b.whiteScale.value),a.impl.setTonemapExposureBias(b.exposureBias.value,b.whiteScale.value)}),this.fovAngle=new d.OptionSlider("FOV-degrees",6.88,100,this.tbody),this.fovAngle.setValue(a.getFOV()),this.addEventListener(this.fovAngle,"change",function(c){a.setFOV(parseFloat(b.fovAngle.value))}),this.frameRate=new d.OptionSlider("Frame rate:",1,100,this.tbody),this.frameRate.setValue(a.impl.getFrameRate()),this.frameRate.sliderElement.step=this.frameRate.stepperElement.step=1,this.addEventListener(this.frameRate,"change",function(c){a.impl.setFrameRate(b.frameRate.value)}),this.addEventListener(this.viewer,Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(c){var d=parseFloat(b.fovAngle.value),e=a.getFOV();d!=e&&b.fovAngle.setValue(e)}),this.addEventListener(this.viewer,Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,function(a){b.syncUI()}),this.addVisibilityListener(function(){b.resizeToContent()})},Autodesk.Viewing.Private.RenderOptionsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.Private.RenderOptionsPanel.prototype.constructor=Autodesk.Viewing.Private.RenderOptionsPanel,Autodesk.Viewing.Private.RenderOptionsPanel.prototype.getContentSize=function(){return{height:this.table.clientHeight+75,width:this.table.clientWidth}},Autodesk.Viewing.Private.RenderOptionsPanel.prototype.syncUI=function(){var a=this.viewer.impl,b=0;a.dir_light1&&(b=0!=a.dir_light1.intensity?Math.log(a.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(b),this.exposureBias.setValue(a.renderer().getExposureBias());var c=a.renderer().getToneMapMethod();this.toneMapMethod.setSelectedIndex(c),this.envSelect.setSelectedIndex(a.currentLightPreset()),this.exposureBias.setDisabled(0==c),this.saoToggle.setValue(a.renderer().getAOEnabled()),this.saoRadius.setDisabled(!a.renderer().getAOEnabled()),this.saoIntensity.setDisabled(!a.renderer().getAOEnabled()),this.saoRadius.setValue(a.renderer().getAORadius()),this.saoIntensity.setValue(a.renderer().getAOIntensity()),this.groundShadowAlpha.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundShadowColor.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundReflectionAlpha.setDisabled(!this.viewer.prefs.get("groundReflection")),this.groundReflectionColor.setDisabled(!this.viewer.prefs.get("groundReflection")),this.fovAngle.setValue(this.viewer.getFOV())},Autodesk.Viewing.Private.RenderOptionsPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this),this.table=null,this.tbody=null,this.postprocStyle=null,this.edgesToggle=null,this.grayscale=null,this.brightness=null,this.contrast=null,this.preserveColor=null,this.firstParam=null,this.secondParam=null,this.saoToggle=null,this.saoRadius=null,this.saoIntensity=null,this.groundShadowAlpha=null,this.envSelect=null,this.toneMapMethod=null,this.exposureBias=null,this.whiteScale=null,this.fovAngle=null,this.viewer=null},function(){"use strict";var a=Autodesk.Viewing,b=Autodesk.Viewing.UI,c=function(c,d,e,f){this.viewer=c,this.tree=null,this.layersRoot=null,this.visibilityImages={},this.isMac=-1!==navigator.userAgent.search("Mac OS");c.config.viewableName;b.DockingPanel.call(this,c.container,e,"Layers",f),this.container.classList.add("layers-panel"),this.container.style.top="10px",this.container.style.left="10px";var g=this;c.model?g.build():g.addEventListener(c,a.GEOMETRY_LOADED_EVENT,function(){g.build()});var h=!1;this.addVisibilityListener(function(){h||(h=!0,g.resizeToContent())})};c.prototype=Object.create(b.DockingPanel.prototype),c.prototype.constructor=c,c.prototype.uninitialize=function(){b.DockingPanel.prototype.uninitialize.call(this),this.viewer=null,this.tree=null,this.layersRoot=null,this.scrollContainer=null},c.prototype.build=function(){function c(){function a(b){var c=[];if(-1!==b.name.toLowerCase().indexOf(h))c.push(b);else if(!b.isLayer)for(var d=b.children,e=0;e<d.length;++e)c=c.concat(a(d[e]));return c}h?l&&0<l.childCount&&(e.lockoutClearFilter=!0,i.setLayerVisible(a(l),!0,!0),e.lockoutClearFilter=!1):i.setLayerVisible(null,!0),g=null}function d(a){g&&clearTimeout(g),h=a?a.toLowerCase():a,g=setTimeout(c,500)}var e=this,f=document.createElement("div");f.classList.add("visibility"),f.title=a.i18n.translate("Show/hide all layers"),f.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation(),this.viewer.setLayerVisible(null,this.viewer.allLayersHidden())}.bind(this)),this.container.appendChild(f),this.toogleAllVisibleButton=f;var g=null,h="",i=e.viewer;this.filterbox=new b.Filterbox(this.viewer.container.id+"LayersPanel-Filterbox",{filterFunction:d}),this.container.appendChild(this.filterbox.container),this.createScrollContainer({heightAdjustment:104,marginTop:0});var j=document.createElement("div");j.classList.add("docking-panel-container-gradient"),j.style.width="100%",j.style.height="100%",this.scrollContainer.appendChild(j);var k=function(){var a=new b.TreeDelegate;return a.getTreeNodeId=function(a){return a.id},a.getTreeNodeLabel=function(a){return e.getNodeLabel(a)},a.getTreeNodeClass=function(a){return e.getNodeClass(a)},a.isTreeNodeGroup=function(a){return e.isGroupNode(a)},a.shouldCreateTreeNode=function(a){return e.shouldInclude(a)},a.onTreeNodeClick=function(a,b,c){e.onClick(b,c)},a.onTreeNodeRightClick=function(a,b,c){e.onRightClick(b,c)},a.onTreeNodeDoubleClick=function(a,b,c){e.onDoubleClick(b,c)},a.onTreeNodeIconClick=function(a,b,c){e.onIconClick(b,c)},a.createTreeNode=function(a,b){e.createNode(a,b)},a}(),l=e.layersRoot=e.viewer.impl.getLayersRoot();l&&(e.tree=new b.Tree(k,l,j,{excludeRoot:!0}),e.update(),e.addEventListener(e.viewer,a.LAYER_VISIBILITY_CHANGED_EVENT,function(){e.update()}))},c.prototype.update=function(){function a(a,b){0===b?c.tree.addClass(a.id,"dim"):c.tree.removeClass(a.id,"dim")}function b(d){d.id;if(d.isLayer){a(d,c.viewer.isLayerVisible(d)?1:0)}else for(var e=d.children,f=0;f<e.length;++f)b(e[f])}var c=this;this.layersRoot&&0<this.layersRoot.childCount&&b(c.layersRoot),this.viewer.allLayersHidden()?this.toogleAllVisibleButton.classList.add("dim"):this.toogleAllVisibleButton.classList.remove("dim")},c.prototype.setLayerVisible=function(a,b){var c=b;null===a||b||(c=!this.viewer.impl.layers.isLayerVisible(a)),this.viewer.setLayerVisible(a,c,b),this.viewer.clearSelection()},c.prototype.getNodeLabel=function(a){return a.isLayer||0===a.childCount?a.name:a.name+" ("+a.childCount+")"},c.prototype.getNodeClass=function(a){return""},c.prototype.isGroupNode=function(a){return!a.isLayer},c.prototype.shouldInclude=function(a){return!0},c.prototype.onIconClick=function(a,b){this.setGroupCollapsed(a,!this.isGroupCollapsed(a))},c.prototype.setGroupCollapsed=function(a,b){var c=this.tree.delegate();if(c.isTreeNodeGroup(a)){var d=c.getTreeNodeId(a);this.tree.setCollapsed(d,b)}},c.prototype.isGroupCollapsed=function(a){var b=this.tree.delegate();if(b.isTreeNodeGroup(a)){var c=b.getTreeNodeId(a);return this.tree.isCollapsed(c)}return!1},c.prototype.onClick=function(a,b){},c.prototype.onDoubleClick=function(a,b){},c.prototype.onRightClick=function(a,b){},c.prototype.onImageClick=function(a,b){},c.prototype.getContentSize=function(){var a={width:0,height:this.options.heightAdjustment||0},b=this.filterbox.container;a.width+=b.clientWidth,a.height+=b.clientHeight;var c=this.container.querySelectorAll("leaf");return c.length>0&&(a.height+=c[0].clientHeight*c.length),a},c.prototype.createNode=function(b,c){var d=document.createElement("div");d.dbId=b,d.classList.add("visibility"),d.title=a.i18n.translate("Show/hide this layer"),d.addEventListener("mousedown",function(a){a.preventDefault(),a.stopPropagation()}.bind(this)),d.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation(),this.onImageClick(b,a)}.bind(this)),c.appendChild(d);var e=document.createElement("label");e.textContent=this.getNodeLabel(b),c.appendChild(e)},Autodesk.Viewing.UI.LayersPanel=c}(),AutodeskNamespace("Autodesk.Viewing.UI"),Autodesk.Viewing.UI.SettingsPanel=function(a,b,c,d){Autodesk.Viewing;Autodesk.Viewing.UI.DockingPanel.call(this,a,b,c,d),this.panelTabs=[],this.tabIdToIndex={},this.controls={},this.controlIdCount=0,this.shown=!1;var e=this,f=d&&void 0!==d.width?d.width:340;this.container.style.maxWidth="800px",this.container.style.minWidth=f+"px",this.container.style.top="10px",this.container.style.left=a.offsetWidth/2-170+"px",this.container.style.position="absolute",this.tabContainer=document.createElement("div"),this.tabContainer.classList.add("docking-panel-container-solid-color-b"),this.tabContainer.classList.add("settings-tabs"),this.tabContainer.classList.add("docking-panel-delimiter-shadow"),this.container.appendChild(this.tabContainer),this.tabs=document.createElement("ul"),this.tabContainer.appendChild(this.tabs),this.heightAdjustment=d&&d.heightAdjustment?d.heightAdjustment:179,this.createScrollContainer({left:!1,heightAdjustment:this.heightAdjustment,marginTop:0}),this.tablesContainer=document.createElement("div"),this.tablesContainer.classList.add("settings-tabs-tables-container"),this.scrollContainer.appendChild(this.tablesContainer),this.mouseOver=!1,this.addEventListener(this.container,"mouseover",function(a){var b=a.toElement||a.relatedTarget;if(e.mouseOver)return!0;for(var c=0;b&&b.parentNode&&b.parentNode!=window;){if(b.parentNode==this||b==this){b.preventDefault&&b.preventDefault(),e.mouseOver=!0;for(var c=0;c<e.panelTabs.length;c++)e.panelTabs[c].classList.remove("selectedmouseout");return!0}b=b.parentNode}}),this.addEventListener(this.container,"mouseout",function(a){var b=a.toElement||a.relatedTarget;if(e.mouseOver){for(;b&&b.parentNode&&b.parentNode!=window;){if(b.parentNode==this||b==this)return b.preventDefault&&b.preventDefault(),!1;b=b.parentNode}e.mouseOver=!1;for(var c=0;c<e.panelTabs.length;c++)e.panelTabs[c].classList.contains("tabselected")&&e.panelTabs[c].classList.add("selectedmouseout")}}),this.expandID=function(a){return b+"-"+a}},Autodesk.Viewing.UI.SettingsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.UI.SettingsPanel.prototype.constructor=Autodesk.Viewing.UI.SettingsPanel,Autodesk.Viewing.UI.SettingsPanel.prototype.setVisible=function(a){a&&(this.container.style.display="block",this.shown||this.resizeToContent(),this.shown=!0),Autodesk.Viewing.UI.DockingPanel.prototype.setVisible.call(this,a)},Autodesk.Viewing.UI.SettingsPanel.prototype.addTab=function(a,b,c){function d(b){e.selectTab(a)}var e=this;if(void 0!==this.tabIdToIndex[a])return!1;var f=c&&void 0!==c.className?c.className:null,g=c&&void 0!==c.width?c.width:200,h=c&&void 0!==c.index?c.index:this.panelTabs.length,i=document.createElement("li");i._id=a,i.id=this.expandID(i._id),i.classList.add(f);var j=document.createElement("a"),k=document.createElement("span");k.setAttribute("data-i18n",b),k.textContent=Autodesk.Viewing.i18n.translate(b),j.appendChild(k),i.appendChild(j),this.tabs.appendChild(i);var l=document.createElement("table");l._id=a+"-table",l.id=this.expandID(l._id),l.classList.add("settings-table"),l.classList.add("adsk-lmv-tftable"),l.classList.add(f);var m=document.createElement("tbody");return l.appendChild(m),this.tablesContainer.appendChild(l),this.addEventListener(i,"touchstart",av.touchStartToClick),this.addEventListener(i,"click",d),this.panelTabs.push(i),this.tabIdToIndex[a]=h,g>(this.container.style.minWidth?parseInt(this.container.style.minWidth):0)&&(this.container.style.minWidth=g+"px"),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.removeTab=function(a){var b=this.tabIdToIndex[a];if(!b)return!1;this.panelTabs.splice(b,1),this.tabs.removeChild(tabDom),this.tabIdToIndex={};for(var c=this.panelTabs.length,d=0;d<c;d++){var e=this.panelTabs[d];this.tabIdToIndex[e._id]=d}return!0},Autodesk.Viewing.UI.SettingsPanel.prototype.hasTab=function(a){var b=this.tabIdToIndex[a];return void 0!==this.panelTabs[b]},Autodesk.Viewing.UI.SettingsPanel.prototype.selectTab=function(a){if(this.isTabSelected(a))return!1;for(var b=this.panelTabs.length,c=0;c<b;c++){var d=this.panelTabs[c],e=document.getElementById(this.expandID(d._id+"-table"));a===d._id?(d.classList.add("tabselected"),e.classList.add("settings-selected-table"),this.mouseOver||d.classList.add("selectedmouseout")):(d.classList.remove("tabselected"),e.classList.remove("settings-selected-table"),this.mouseOver||this.panelTabs[c].classList.remove("selectedmouseout"))}return this.scrollContainer.scrollTop=0,!0},Autodesk.Viewing.UI.SettingsPanel.prototype.isTabSelected=function(a){var b=this.tabIdToIndex[a],c=this.panelTabs[b];return c&&c.classList.contains("tabselected")},Autodesk.Viewing.UI.SettingsPanel.prototype.addCheckbox=function(a,b,c,d,e,f){if(void 0===this.tabIdToIndex[a])return null;var g=document.getElementById(this.expandID(a+"-table")),h=new Autodesk.Viewing.Private.OptionCheckbox(b,g.tBodies[0],c,e,f);return h.changeListener=function(a){var b=a.detail.target.checked;d(b)},this.addEventListener(h,"change",h.changeListener),this.addControl(a,h)},Autodesk.Viewing.UI.SettingsPanel.prototype.addSlider=function(a,b,c,d,e,f,g){if(void 0===this.tabIdToIndex[a])return null;var h=document.getElementById(this.expandID(a+"-table")),i=new Autodesk.Viewing.Private.OptionSlider(b,c,d,h.tBodies[0],g);return i.setValue(e),i.sliderElement.step=i.stepperElement.step=1,this.addEventListener(i,"change",function(a){f(a)}),this.addControl(a,i)},Autodesk.Viewing.UI.SettingsPanel.prototype.addDropDownMenu=function(a,b,c,d,e,f){if(void 0===this.tabIdToIndex[a])return null;var g=document.getElementById(this.expandID(a+"-table")),h=new Autodesk.Viewing.Private.OptionDropDown(b,g.tBodies[0],c,d,f);return this.addEventListener(h,"change",function(a){e(a)}),this.addControl(a,h)},Autodesk.Viewing.UI.SettingsPanel.prototype.addControl=function(a,b,c){if(void 0===this.tabIdToIndex[a])return null;if(!b.hasOwnProperty("sliderRow")){var d=c&&c.insertAtIndex?c.insertAtIndex:-1,e=c&&c.caption?c.caption:null,f=document.getElementById(this.expandID(a+"-table"));d>f.length&&(d=-1);var g=f.tBodies[0].insertRow(d),h=g.insertCell(0);if(e){var i=document.createElement("div");i.setAttribute("data-i18n",e),i.textContent=Autodesk.Viewing.i18n.translate(e),h.appendChild(i),h=g.insertCell(1)}else h.colSpan=3;h.appendChild(b),b.sliderRow=g,b.tbody=f.tBodies[0]}var j=this.expandID("adsk_settings_control_id_"+this.controlIdCount.toString());return this.controlIdCount=this.controlIdCount+1,this.controls[j]=b,j},Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(a){return this.removeControl(a)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeSlider=function(a){return this.removeControl(a)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeDropdownMenu=function(a){return this.removeControl(a)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeControl=function(a){var b;if("object"==typeof a&&a.tbody){b=a;for(var c in this.controls)if(this.controls[c]===b){a=c;break}}else b=this.controls[a];if(void 0===b)return!1;var d=b.tbody,e=b.sliderRow,f=e.rowIndex;return d.deleteRow(f),delete this.controls[a],!0},Autodesk.Viewing.UI.SettingsPanel.prototype.getControl=function(a){return this.controls[a]||null},Autodesk.Viewing.UI.SettingsPanel.prototype.getContentSize=function(){for(var a=this.heightAdjustment,b=0,c=0;c<this.panelTabs.length;c++){var d=this.panelTabs[c],e=document.getElementById(this.expandID(d._id+"-table")),f=e?e.clientHeight:0;b=Math.max(b,f)}return{height:a+b,width:this.container.clientWidth}},function(){"use strict";var a=function(){};a.instances=[],a.displayError=function(b,c,d,e,f){var g=document.createElement("div");g.className="alert-box error",b.appendChild(g);var h=e;h||(h="img-item-not-found");var i=document.createElement("div");i.className="alert-box-image "+h,g.appendChild(i);var j=document.createElement("div");j.className="alert-box-msg",g.appendChild(j);var k=d;k||(k=Autodesk.Viewing.i18n.translate("Error Occurred",{defaultValue:"Error Occurred"}));var l=document.createElement("div");l.className="alert-box-title",l.textContent=k,l.setAttribute("data-i18n",k),j.appendChild(l);var m=document.createElement("div");if(m.className="alert-box-text",m.textContent=c,m.setAttribute("data-i18n",c),j.appendChild(m),f){var n=document.createElement("div");n.className="alert-box-content",j.appendChild(n);var o=document.createElement("ul");o.className="alert-box-content";for(var p=0;p<f.length;p++){var q=f[p];if(q){var r=document.createElement("li"),s=this.extractList(q);if(s.list.length){var t=this.generateListElement(list);o.appendChild(t)}r.innerHTML=s.msg,r.setAttribute("data-i18n",s.msg),o.appendChild(r)}}n.appendChild(o)}var u=document.createElement("div");u.className="alert-box-ok",u.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var v={alertBox:g,container:b};u.addEventListener("click",function(c){g.style.visibility="hidden",b.removeChild(g),a.instances.splice(a.instances.indexOf(v),1)}),g.appendChild(u),g.style.visibility="visible",a.instances.push(v)},a.displayErrors=function(b,c,d){var e=document.createElement("div");e.className="alert-box errors",b.appendChild(e);var f=c;f||(f="img-item-not-found");var g=document.createElement("div");g.className="alert-box-image "+f,e.appendChild(g);var h=document.createElement("div");h.className="alert-box-msg errors",e.appendChild(h);for(var i=0;i<d.length;i++){var j=d[i].header;j||(j=Autodesk.Viewing.i18n.translate("Error",{defaultValue:"Error"}));var k=document.createElement("div");k.className="alert-box-title errors",k.textContent=j,h.appendChild(k);var l=document.createElement("div");l.className="alert-box-text errors";var m=d[i].msg,n=this.extractList(m);if(n.list.length){var o=document.createElement("div"),p=this.generateListElement(n.list);o.appendChild(p),l.textContent=n.msg,l.appendChild(o)}else l.textContent=m;if(h.appendChild(l),d[i].hints){var q=document.createElement("ul");q.className="alert-box-content";for(var r=d[i].hints,s=0;s<r.length;s++){var t=r[s];if(t){var u=document.createElement("li");q.appendChild(u);var n=this.extractList(t);if(n.list.length){var p=this.generateListElement(n.list);q.appendChild(p)}u.innerHTML=n.msg}}h.appendChild(q)}}var v=document.createElement("div");v.className="alert-box-ok",v.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var w={alertBox:e,container:b};v.addEventListener("click",function(c){e.style.visibility="hidden",b.removeChild(e),a.instances.splice(a.instances.indexOf(w),1)}),e.appendChild(v),e.style.visibility="visible",a.instances.push(w)},a.extractList=function(a){var b={msg:a,list:[]};if(a&&-1!=a.indexOf("<ul>")){var c=a.split("<ul>");b.msg=c[0],c=c[1].split("</ul>"),b.list=c[0].split(", "),1===b.list.length&&(b.list=c[0].split(","))}return b},a.generateListElement=function(a){for(var b=document.createElement("ul"),c=0;c<a.length;c++){var d=document.createElement("li");d.textContent=a[c],d.setAttribute("data-i18n",a[c]),b.appendChild(d)}return b},a.dismiss=function(){if(a.instances.length>0){var b=a.instances.pop();return b.alertBox.style.visibility="hidden",b.container.removeChild(b.alertBox),!0}return!1},Autodesk.Viewing.Private.AlertBox=a}(),function(){"use strict";var a=Autodesk.Viewing,b=function(){};b.instances=[],b.displayMessage=function(c,d,e,f,g){function h(a){var b=window.getComputedStyle(a),c={top:parseInt(b["margin-top"]),bottom:parseInt(b["margin-bottom"])};return a.getBoundingClientRect().height+c.top+c.bottom}if(!(b.instances.length>0)){var i=d.msgTitleKey,j=d.msgTitleDefaultValue||i,k=d.messageKey,l=d.messageDefaultValue||k,m=d.buttonText,n=d.checkboxChecked||!1,o=document.createElement("div");o.classList.add("docking-panel"),o.classList.add("hud"),c.appendChild(o);var p=document.createElement("div");if(p.classList.add("docking-panel-title"),p.classList.add("docking-panel-delimiter-shadow"),p.textContent=a.i18n.translate(i,{defaultValue:j}),p.setAttribute("data-i18n",i),o.appendChild(p),e){var q=document.createElement("div");q.classList.add("docking-panel-close"),q.addEventListener("click",function(a){b.dismiss(),e&&e(a)}),o.appendChild(q)}var r=document.createElement("div");r.classList.add("hud-client"),r.classList.add("docking-panel-container-solid-color-b"),o.appendChild(r);var s=document.createElement("div");s.className="hud-message",s.textContent=a.i18n.translate(k,{defaultValue:l}),s.setAttribute("data-i18n",l),r.appendChild(s);var t=h(s);if(f){var u=document.createElement("div");u.classList.add("docking-panel-primary-button"),u.classList.add("hud-button"),u.textContent=a.i18n.translate(m,{defaultValue:m}),u.setAttribute("data-i18n",m),u.addEventListener("click",f),r.appendChild(u),t+=h(u)}if(g){var v=document.createElement("div"),w=document.createElement("input");w.className="hud-checkbox",w.type="checkbox",w.checked=n,v.appendChild(w);var x="Do not show this message again",y=document.createElement("label");y.setAttribute("for",x),y.setAttribute("data-i18n",x),y.textContent=a.i18n.translate(x,{defaultValue:x}),v.appendChild(y),w.addEventListener("change",g),r.appendChild(v),t+=h(g)}r.style.height=t+"px",o.style.height=t+h(p)+"px";var z={hudMessage:o,container:c};b.instances.push(z)}},b.dismiss=function(){if(b.instances.length>0){var a=b.instances.pop();return a.hudMessage.style.visibility="hidden",a.container.removeChild(a.hudMessage),!0}return!1},Autodesk.Viewing.Private.HudMessage=b}(),function(){"use strict";var a=function(){},b=Autodesk.Viewing,c=Autodesk.Viewing.Private;a.prototype.constructor=a,a.prototype.getNodeId=function(a){throw"getId is not implemented."},a.prototype.getNodeLabel=function(a){return a.name},a.prototype.getNodeClass=function(a){return""},a.prototype.hasThumbnail=function(a){return!1},a.prototype.getThumbnailOptions=function(a){return null},a.prototype.getThumbnail=function(a){return null},a.prototype.onNodeClick=function(a,b,c){},a.prototype.onNodeHover=function(a,b,c){},a.prototype.selectItem=function(a){},a.prototype.deselectItem=function(a){},a.prototype.hasContent=function(a){return!1},a.prototype.addContent=function(a,b){};var d=function(a,b,c){this.myDelegate=a,this.mySelectedIds=[];this.myRootContainerId=c+"-browserview",this.idToElement={},this.myRootContainer=document.createElement("div"),this.myRootContainer.id=this.myRootContainerId,this.myRootContainer.classList.add("browserview"),document.getElementById(c).appendChild(this.myRootContainer),this.createElements(b,this.myRootContainer)};d.prototype.constructor=d,d.prototype.show=function(a){a?(this.myRootContainer.classList.remove("browserHidden"),this.myRootContainer.classList.add("browserVisible"),this.myRootContainer.style.display="block"):(this.myRootContainer.classList.remove("browserVisible"),this.myRootContainer.classList.add("browserHidden"),this.myRootContainer.style.display="none")},d.prototype.getRootContainer=function(){return this.myRootContainer},d.prototype.delegate=function(){return this.myDelegate},d.prototype.addToSelection=function(a){for(var b=this,c=0,d=a.length;c<d;++c){var e=a[c];if(function(a){return-1==b.mySelectedIds.indexOf(a)&&(b.mySelectedIds.push(a),!0)}(e)){var f=b.idToElement[e];void 0===f?b.myDelegate.selectItem(e):f.classList.add("selected")}}},d.prototype.removeFromSelection=function(a){for(var b=this,c=a.length-1;c>=0;--c){var d=a[c];if(function(a){var c=b.mySelectedIds.indexOf(a);return-1!=c&&(b.mySelectedIds.splice(c,1),!0)}(d)){var e=this.idToElement[d];void 0===e?b.myDelegate.deselectItem(d):e.classList.remove("selected")}}},d.prototype.setSelection=function(a){return this.removeFromSelection(this.mySelectedIds),this.addToSelection(a),this.mySelectedIds},d.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedIds)},d.prototype.createElements=function(a,b){if(a)for(var c=this,d=0;d<a.length;d++){var e=a[d];c.createElement(e,b)}},d.prototype.createElement=function(a,d){var e=this,f=e.myDelegate.getNodeId(a),g=document.createElement("item");d.appendChild(g),this.idToElement[f]=g,g.onmouseover=function(){e.myDelegate.onNodeHover(e,a)},g.onclick=function(b){e.myRootContainer.querySelector(".flipped").removeClass("flipped"),e.myDelegate.onNodeClick(e,a,b)};var h=document.createElement("div");h.classList.add("card"),g.appendChild(h);var i=document.createElement("div");i.classList.add("browserElement"),h.appendChild(i);var j=e.myDelegate.getNodeLabel(a),k=document.createElement("label");k.innerHTML=j,i.appendChild(k),k.onclick=function(b){e.myDelegate.onNodeClick(e,a,b)};var l=e.myDelegate.getThumbnail(a);if(l){var m=document.createElement("img");m.classList.add("thumb");var n=e.myDelegate.getThumbnailOptions(a);b.Document.requestThumbnailWithSecurity(n,function(a,d){if(a)return void c.logger.error("Failed to load thumbnail: "+l,b.errorCodeString(b.ErrorCodes.NETWORK_FAILURE));m.src=window.URL.createObjectURL(d),m.onload=function(){window.URL.revokeObjectURL(m.src)}}),i.appendChild(m),m.onclick=function(b){e.myDelegate.onNodeClick(e,a,b)}}e.myDelegate.hasContent(a)&&e.myDelegate.addContent(a,h),g.classList.add(e.myDelegate.getNodeClass(a))},Autodesk.Viewing.Private.BrowserDelegate=a,Autodesk.Viewing.Private.Browser=d}(),AutodeskNamespace("Autodesk.Viewing.Private"),function(){var a=Autodesk.Viewing.Private;a.WEBGL_HELP_LINK=null,a.ErrorInfoData={1:{img:"img-reload","globalized-msg":"Viewer-UnknownFailure","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint>Try loading the item again. </hint><hint>Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},2:{img:"img-unsupported","globalized-msg":"Viewer-BadData","default-msg":"<title> Sorry </title><message>The item you are trying to view was not processed completely. </message><hint>Try loading the item again.</hint><hint>Please upload the file again to see if that fixes the issue.</hint>"},3:{img:"img-reload","globalized-msg":"Viewer-NetworkError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},4:{img:"img-unloack","globalized-msg":"Viewer-AccessDenied","default-msg":"<title> No access </title><message>Sorry. You dont have the required privileges to access this item.</message><hint> Please contact the author</hint>"},5:{img:"img-item-not-found","globalized-msg":"Viewer-FileNotFound","default-msg":'<title> Sorry </title><message>We cant display the item you are looking for. It may not have been processed yet. It may have been moved, deleted, or you may be using a corrupt file or unsupported file format.</message><hint> Try loading the item again.</hint><hint> Please upload the file again to see if that fixes the issue.</hint><hint> <a href="http://help.autodesk.com/view/ADSK360/ENU/?guid=GUID-488804D0-B0B0-4413-8741-4F5EE0FACC4A" target="_blank">See a list of supported formats.</a></hint>'},6:{img:"img-reload","globalized-msg":"Viewer-ServerError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},7:{img:"img-reload","globalized-msg":"Viewer-UnhandledResponseCode","default-msg":"<title> Network problem </title><message>Sorry. We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},8:{img:"img-unsupported","globalized-msg":"Viewer-WebGlNotSupported","default-msg":'<title>Sorry</title><message>We can\'t show this item because this browser doesn\'t support WebGL.</message><hint>Try Google Chrome, Mozilla Firefox, or another browser that supports WebGL 3D graphics.</hint><hint>For more information, see the <a href="WEBGL_HELP" target="_blank">A360 browser reqirements.</a></hint>'},9:{img:"img-item-not-found","globalized-msg":"Viewer-NoViewable","default-msg":"<title> No viewable content </title><message>Theres nothing to display for this item. It may not have been processed or it may not have content we can display.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},10:{img:"img-unsupported","globalized-msg":"Viewer-WebGlDisabled","default-msg":'<title>Sorry</title><message>We can\'t show this item because WebGL is disabled on this device.</message><hint> For more information see the <a href="WEBGL_HELP" target="_blank">A360 Help.</a></hint>'},11:{img:"img-item-not-found","globalized-msg":"Viewer-ModeIsEmpty",
"default-msg":"<title>Model is empty</title><message>Model is empty, there is no geometry for the viewer to show.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},12:{img:"img-unsupported","globalized-msg":"Viewer-RTCError","default-msg":"<title> Sorry </title><message>We couldnt connect to the Collaboration server.</message><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},13:{img:"img-unsupported","globalized-msg":"Viewer-FileExtNotSupported","default-msg":{title:"Sorry",message:"The file extension loaded into the Viewer is not supported",hints:["Try a different file"]}},15:{img:"img-unsupported","globalized-msg":"Viewer-WebGlContextLost","default-msg":{title:"WebGL context lost",message:"Unable to recover from software mode.  Please restart your browser and reload the Viewer",hints:["If you continue to encounter this issue when viewing this model, we recommend switching to a different browser."]}}},a.currentError=null,a.currentErrors=null,a.ErrorHandler=function(){},a.ErrorHandler.prototype.constructor=a.ErrorHandler,a.ErrorHandler.reportError=function(b,c,d,e,f,g){if(a.ErrorHandler.currentError=null,a.ErrorHandler.currentErrors=null,c){var h={category:"error",code:c,message:d,httpStatusCode:e,httpStatusText:f};a.logger.track(h,!0),a.ErrorHandler.currentError=[b,c,d,g];var i=a.ErrorInfoData[c];if(i){var j={defaultValue:""};j.defaultValue=i["default-msg"];var k=i.img,l=i["globalized-msg"],m=this.parseErrorString(l,j);if(c===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_DISABLED||c===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED)for(var n=a.WEBGL_HELP_LINK||"http://www.autodesk.com/a360-browsers",o=0;o<m.hints.length;o++){var p=m.hints[o].indexOf('href="WEBGL_HELP"');-1!==p&&(m.hints[o]=m.hints[o].replace('href="WEBGL_HELP"','href="'+n+'"'))}a.AlertBox.displayError(b,m.msg,m.header,k,m.hints)}else{var k="img-unsupported",j={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"};this.parseArguments(d,j);var m=this.parseErrorString(c,j);m.header||(m.header="warning"===g?Autodesk.Viewing.i18n.translate("header-warning"):""),a.AlertBox.displayError(b,m.msg,m.header,k,m.hints)}}},a.ErrorHandler.reportErrors=function(b,c){if(a.ErrorHandler.currentError=null,a.ErrorHandler.currentErrors=null,c){a.ErrorHandler.currentErrors=[b,c];for(var d={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},e=[],f=0;f<c.length;f++)if(c[f].code){this.parseArguments(c[f].message,d);var g=this.parseErrorString(c[f].code,d);g.header||(g.header="warning"===c[0].type?Autodesk.Viewing.i18n.translate("header-warning",{defaultValue:"Warning"}):""),e.push(g);var h={category:"error",code:c[f].code,message:c[f].message};a.logger.track(h,!0)}if(e.length){a.AlertBox.displayErrors(b,"img-unsupported",e)}}},a.ErrorHandler.parseArguments=function(a,b){if(a)if("string"==typeof a)b.defaultValue=a;else{b.defaultValue=a[0];for(var c=1;c<a.length;c++){var d=c-1,e=d.toString();b[e]=a[c]}}},a.ErrorHandler.parseErrorString=function(a,b){var c={msg:null,msgList:null,header:null,hints:null};if(!a)return c;if("object"==typeof b.defaultValue){var d=b.defaultValue;return c.header=d.title,c.msg=d.message,c.hints=d.hints.concat(),c}var e=Autodesk.Viewing.i18n.translate(a,b);if(!e)return c;if(-1!=e.indexOf("<title>")){var f=e.split("<title>")[1].split("</title>");c.header=f[0],e=f[1]}if(e&&-1!=e.indexOf("<message>")){var f=e.split("<message>")[1].split("</message>");c.msg=f[0],e=f[1]}else c.msg=e;if(e&&-1!=e.indexOf("<hint>")){c.hints=[];for(var g=e.split("<hint>"),h=0;h<g.length;h++){var i=g[h].split("</hint")[0];c.hints.push(i)}}return c},a.ErrorHandler.localize=function(){if(a.AlertBox.instances.length>0)if(a.AlertBox.dismiss(),a.ErrorHandler.currentError){var b=a.ErrorHandler.currentError.shift(),c=a.ErrorHandler.currentError;a.ErrorHandler.reportError(b,c[0],c[1],c[2])}else{var b=a.ErrorHandler.currentErrors.shift(),d=a.ErrorHandler.currentErrors[0];a.ErrorHandler.reportErrors(b,d)}}}(),Autodesk.Viewing.Extensions.ViewerPanelMixin=function(){this.getContainerBoundingRect=function(){var a=this.parentContainer.getBoundingClientRect(),b={height:0,width:0,left:0,bottom:0,right:0,top:0},c=document.getElementsByClassName("toolbar-menu");return c&&c.length>0&&(b=c[0].getBoundingClientRect()),{height:a.height-b.height,width:a.width,left:a.left,bottom:a.bottom-b.height,right:a.right,top:a.top}}},function(){"use strict";function a(a){var b=this.tree,c=a.toLowerCase(),d=[];return b.forEachDelegate(function(a){var e=a.getRootId(),f=[];b.iterate(a,e,function(b){var d=a.instanceTree.getNodeName(b);return d&&-1!==d.toLowerCase().indexOf(c)&&f.push(b),!0}),d.push({ids:f,delegate:a})}),d}var b=Autodesk.Viewing,c=Autodesk.Viewing.Private,d=Autodesk.Viewing.UI,e=Autodesk.Viewing.Extensions,f={click:{onObject:["toggleOverlayedSelection"]},clickShift:{onObject:["toggleMultipleOverlayedSelection"]},clickCtrl:{onObject:["toggleMultipleOverlayedSelection"]}};e.ViewerModelStructurePanel=function(b,c,e){this.viewer=b,this.visible=!1,this._trackNodeClick=!0,e=e||{},e.defaultTitle="Model",e.excludeRoot=void 0===e.excludeRoot||e.excludeRoot,e.startCollapsed=void 0!==e.startCollapsed&&e.startCollapsed,e.scrollEaseCurve=e.scrollEaseCurve||[0,0,.29,1],e.scrollEaseSpeed=void 0!==e.scrollEaseSpeed?e.scrollEaseSpeed:.003,e.addFooter=void 0===e.addFooter||e.addFooter,this.clickConfig=e&&e.docStructureConfig?e.docStructureConfig:f,this.isMac=-1!==navigator.userAgent.search("Mac OS"),e.hideSearch?(e.heightAdjustment=70,d.ModelStructurePanel.call(this,b.container,b.container.id+"ViewerModelStructurePanel",c,e),this.scrollContainer.classList.add("no-search")):(e.heightAdjustment=104,d.ModelStructurePanel.call(this,b.container,b.container.id+"ViewerModelStructurePanel",c,e),this.searchbox=new d.Searchbox(b.container.id+"ViewerModelStructurePanel-Searchbox",b,{excludeRoot:e.excludeRoot,searchFunction:a.bind(this)}),this.searchbox.addEventListener(d.Searchbox.Events.ON_SEARCH_SELECTED,function(a){var b=a.id,c=this.viewer.impl.findModel(a.modelId);this.viewer.select(b,c),this.viewer.fitToView([b],c,!1)}.bind(this)),this.container.appendChild(this.searchbox.container)),this._ignoreScroll=!1,this.selectedNodes={},this.onViewerSelect=this.onViewerSelect.bind(this),this.onViewerIsolate=this.onViewerIsolate.bind(this),this.onViewerHide=this.onViewerHide.bind(this),this.onViewerShow=this.onViewerShow.bind(this)},e.ViewerModelStructurePanel.prototype=Object.create(d.ModelStructurePanel.prototype),e.ViewerModelStructurePanel.prototype.constructor=e.ViewerModelStructurePanel,e.ViewerPanelMixin.call(e.ViewerModelStructurePanel.prototype),e.ViewerModelStructurePanel.prototype.uninitialize=function(){this.viewer&&(this.viewer.removeEventListener(b.AGGREGATE_SELECTION_CHANGED_EVENT,this.onViewerSelect),this.viewer.removeEventListener(b.AGGREGATE_ISOLATION_CHANGED_EVENT,this.onViewerIsolate),this.viewer.removeEventListener(b.HIDE_EVENT,this.onViewerHide),this.viewer.removeEventListener(b.SHOW_EVENT,this.onViewerShow),this.viewer=null),this.searchResults&&(this.searchResults.uninitialize(),this.searchResults=null),d.ModelStructurePanel.prototype.uninitialize.call(this)},e.ViewerModelStructurePanel.prototype.resizeToContent=function(){var a=this.scrollContainer,b=this.tree?this.tree.getRootContainer():null;if(a&&b){var c="calc(100% + "+a.scrollLeft+"px)";b.style.width=c}},e.ViewerModelStructurePanel.prototype.createUI=function(){if(!this.uiCreated){var a=this.viewer;d.ModelStructurePanel.prototype.createUI.call(this);var c=this.scrollContainer;c.classList.remove("left");var e=function(){this.visible&&this.resizeToContent(),requestAnimationFrame(e)}.bind(this);e();var f=this.options,g=0,h=a.container.getBoundingClientRect(),i=a.getToolbar(!1);f.maxHeight?f.maxHeight:h.height;if(i){var j=i.container.getBoundingClientRect();g=h.bottom-j.top}else g=0;this.container.style.top="10px",this.container.style.left="10px",this.container.style.height="calc(100% - "+(g+20)+"px)",this.container.style.maxHeight="calc(100% - "+(g+20)+"px)",c.addEventListener("contextmenu",function(a){this.viewer.contextMenu.show(a)}.bind(this)),this.viewer.addEventListener(b.AGGREGATE_SELECTION_CHANGED_EVENT,this.onViewerSelect),this.viewer.addEventListener(b.AGGREGATE_ISOLATION_CHANGED_EVENT,this.onViewerIsolate),this.viewer.addEventListener(b.HIDE_EVENT,this.onViewerHide),this.viewer.addEventListener(b.SHOW_EVENT,this.onViewerShow)}},e.ViewerModelStructurePanel.prototype.onViewerSelect=function(a){this.setSelection(a.selections),this._ignoreScroll||this.scrollToSelection(a.selections),this._ignoreScroll=!1},e.ViewerModelStructurePanel.prototype.onViewerIsolate=function(a){this.setIsolation(a.isolation)},e.ViewerModelStructurePanel.prototype.onViewerHide=function(a){this.setHidden(a.nodeIdArray.slice(),a.model,!0)},e.ViewerModelStructurePanel.prototype.onViewerShow=function(a){this.setHidden(a.nodeIdArray.slice(),a.model,!1)},e.ViewerModelStructurePanel.prototype.setVisible=function(a){d.ModelStructurePanel.prototype.setVisible.call(this,a),this.visible!==a&&(this.visible=a,this.visible&&this.sync())},e.ViewerModelStructurePanel.prototype.sync=function(){var a=this.viewer.getAggregateIsolation();if(this.setIsolation(a),0===a.length)for(var b=this.viewer.getAggregateHiddenNodes(),c=0;c<b.length;++c){var d=b[c].model,e=b[c].ids;this.setHidden(e,d,!0)}var f=this.viewer.getAggregateSelection();this.setSelection(f),this.scrollToSelection(f)},e.ViewerModelStructurePanel.prototype.removeTreeUI=function(a){delete this.selectedNodes[a.id],d.ModelStructurePanel.prototype.removeTreeUI.call(this,a)},e.ViewerModelStructurePanel.prototype.setHidden=function(a,b,c){for(var d=this.tree,e=d.getDelegate(b.id),f=c?function(a){return d.addClass(e,a,"dim",!1),d.removeClass(e,a,"visible",!1),!0}:function(a){return d.removeClass(e,a,"dim",!1),d.addClass(e,a,"visible",!1),!0},g=0;g<a.length;++g)d.iterate(e,a[g],f)},e.ViewerModelStructurePanel.prototype.setIsolation=function(a){if(0===a.length){var b=this.tree;return void b.forEachDelegate(function(a){var c=a.model,d=a.instanceTree;if(d){var e=d.getRootId();b.iterate(a,e,function(c){return b.removeClass(a,c,"dim",!1),b.removeClass(a,c,"visible",!1),!0}),this.setHidden([e],c,!1)}}.bind(this))}var c=[];a.length&&this.tree.forEachDelegate(function(b){for(var d=-1,e=0;e<a.length;e++)if(a[e].model===b.model){d=e;break}-1===d&&c.push(b)}.bind(this));for(var d=0;d<a.length;++d){var e=a[d].model,f=e.getData().instanceTree,g=f.getRootId(),b=this.tree,h=b.getDelegate(e.id);b.iterate(h,g,function(a){return b.removeClass(h,a,"dim",!1),b.removeClass(h,a,"visible",!1),!0});var i=a[d].ids;if(0!==i.length){if(1===i.length&&i[0]===g)return;this.setHidden([g],e,!0),this.setHidden(i,e,!1)}}for(var d=0;d<c.length;++d){var b=this.tree,h=c[d],e=h.model,g=h.instanceTree.getRootId();b.iterate(h,g,function(a){return b.removeClass(h,a,"dim",!1),b.removeClass(h,a,"visible",!1),!0}),this.setHidden([g],e,!0)}},e.ViewerModelStructurePanel.prototype.setSelection=function(a){var b,c,d,e,f,g,h,i=this.tree,j=this.viewer.impl.modelQueue();for(var k in this.selectedNodes)if(e=j.findModel(parseInt(k)),f=this.selectedNodes[k],g=i.getDelegate(k),h=g.instanceTree){for(c=0;c<f.length;++c)for(d=h.getNodeParentId(f[b]);d;)i.removeClass(g,d,"ancestor-selected"),d=h.getNodeParentId(d);i.clearSelection(g)}for(this.selectedNodes={},b=0;b<a.length;++b)if(e=a[b].model,f=a[b].dbIdArray||a[b].selection,g=i.getDelegate(e.id),h=g.instanceTree){for(c=0;c<f.length;++c)for(d=h.getNodeParentId(f[b]);d;)i.addClass(g,d,"ancestor-selected"),d=h.getNodeParentId(d);i.setSelection(g,f),this.selectedNodes[e.id]=f.concat()}},e.ViewerModelStructurePanel.prototype.scrollToSelection=function(a){var b=a[0];if(b){var c=b.model,d=b.dbIdArray||b.selection,e=this.tree.scrollTo(d[0],c),f=this.scrollContainer.scrollTop;this.scrollContainer.scrollTop=e;var g=this.scrollContainer.scrollTop;this.scrollContainer.scrollTop=f,this.options.scrollEaseSpeed>0?this.animateScroll(f,g,function(a){this.tree.setScroll(a)}.bind(this)):(this.scrollContainer.scrollTop=g,this.tree.setScroll(g))}},e.ViewerModelStructurePanel.prototype.onEyeIcon=function(a,b){this.viewer.toggleVisibility(a,b)},e.ViewerModelStructurePanel.prototype.onTreeNodeClick=function(a,b,d,e){if(this._trackNodeClick&&(c.logger.track({category:"node_selected",name:"model_browser_tool"}),this._trackNodeClick=!1),!this.isMac||!e.ctrlKey){var f="click";this.ctrlDown(e)&&(f+="Ctrl"),e.shiftKey&&(f+="Shift"),e.altKey&&(f+="Alt");var g=["toggleOverlayedSelection"],h=this.clickConfig[f];h&&(g=h.onObject),this.handleAction(g,b,d)}},e.ViewerModelStructurePanel.prototype.onTreeNodeRightClick=function(a,b,c,d){return this.isMac&&d.ctrlKey&&0===d.button?(this.clickConfig&&this.clickConfig.clickCtrl&&this.handleAction(this.clickConfig.clickCtrl.onObject,b,c),null):this.viewer.contextMenu.show(d)},e.ViewerModelStructurePanel.prototype.handleAction=function(a,b,c){for(var d in a)switch(a[d]){case"toggleOverlayedSelection":this.toggleOverlayedSelection(b,c);break;case"toggleMultipleOverlayedSelection":this.toggleMultipleOverlayedSelection(b,c);break;case"selectOnly":this.viewer.select(b,c);break;case"deselectAll":this.viewer.clearSelection();break;case"selectToggle":this.viewer.toggleSelect(b,c);break;case"isolate":this.viewer.isolate(b,c);break;case"showAll":this.viewer.showAll();break;case"focus":this.viewer.fitToView();break;case"hide":this.viewer.hide(b,c);break;case"show":this.viewer.show(b,c);break;case"toggleVisibility":this.viewer.toggleVisibility(b,c)}},e.ViewerModelStructurePanel.prototype.toggleOverlayedSelection=function(a,b){var c=this.selectedNodes[b.id],d=c?c.indexOf(a):-1;this._ignoreScroll=!0,-1===d?(this.viewer.select(a,b),this.viewer.fitToView([a],b,!1)):this.viewer.select([],void 0,b)},e.ViewerModelStructurePanel.prototype.toggleMultipleOverlayedSelection=function(a,b){var c=this.selectedNodes[b.id],d=c?c.indexOf(a):-1;-1===d?(c||(c=this.selectedNodes[b.id]=[]),c.push(a)):c.splice(d,1);var e=[];for(var f in this.selectedNodes)if(this.selectedNodes.hasOwnProperty(f)){var b=this.viewer.impl.findModel(parseInt(f)),g=this.selectedNodes[f];e.push({model:b,ids:g})}this._ignoreScroll=!0,this.viewer.impl.selector.setAggregateSelection(e);var h=this.viewer.getAggregateSelection();this.viewer.fitToView(h)},e.ViewerModelStructurePanel.prototype.ctrlDown=function(a){return this.isMac&&a.metaKey||!this.isMac&&a.ctrlKey}}(),function(){"use strict";function a(a){var b=a.getDocumentNode(),c=b&&b.findViewableParent();return!(!c||-1===c.name().toLocaleLowerCase().indexOf(".sld"))}function b(a,b,c){return new Promise(function(d,e){a.getBulkProperties(b,{ignoreHidden:!0},function(a){for(var b=0,e=a.length;b<e;++b)for(var f=a[b],g=0,h=f.properties.length;g<h;++g){for(var i=f.properties[g],j=!0,k=0,l=c.properties.length;k<l;++k)c.properties[k].displayName===i.displayName&&(j=!1,k=l);j&&c.properties.push(i)}d(c)})})}var c=Autodesk.Viewing,d=c.UI,e=function(a){this.viewer=a,this.currentNodeIds=[],this.currentModel=null,this.isDirty=!0,this.propertyNodeId=null,this.normalTitle="Properties",this.loadingTitle="Object Properties Loading...",d.PropertyPanel.call(this,a.container,"ViewerPropertyPanel",this.loadingTitle)};e.prototype=Object.create(d.PropertyPanel.prototype),e.prototype.constructor=e,c.Extensions.ViewerPanelMixin.call(e.prototype),e.prototype.initialize=function(){d.PropertyPanel.prototype.initialize.call(this);var a=this;a.addEventListener(a.viewer,c.AGGREGATE_SELECTION_CHANGED_EVENT,function(b){b.selections&&b.selections.length?(a.currentNodeIds=b.selections[0].dbIdArray,a.currentModel=b.selections[0].model):a.resetCurrentModel(),a.isDirty=!0,a.requestProperties()}),a.addEventListener(a.viewer,c.HIDE_EVENT,function(b){a.isDirty=!0,a.requestProperties()}),a.addEventListener(a.viewer,c.OBJECT_TREE_CREATED_EVENT,function(b){a.currentModel===b.model&&(a.isDirty=!0,a.requestProperties())}),a.addEventListener(a.viewer,c.SHOW_EVENT,function(b){a.isDirty=!0,a.requestProperties()});var b=this.viewer.getAggregateSelection();b.length?(this.currentModel=b[0].model,this.currentNodeIds=b[0].selection):this.resetCurrentModel()},e.prototype.resetCurrentModel=function(){var a=this.viewer?this.viewer.getVisibleModels():[];1===a.length?(this.currentModel=a[0],this.currentNodeIds=[]):(this.currentModel=null,this.currentNodeIds=[])},e.prototype.setTitle=function(a,b){a||(a="Object Properties",b=b||{},b.localizeTitle=!0),d.PropertyPanel.prototype.setTitle.call(this,a,b)},e.prototype.setVisible=function(a){d.DockingPanel.prototype.setVisible.call(this,a),this.requestProperties()},e.prototype.visibilityChanged=function(){d.DockingPanel.prototype.visibilityChanged.call(this),this.isVisible()&&this.requestProperties()},e.prototype.requestProperties=function(){this.isVisible()&&this.isDirty&&(this.currentModel&&this.currentNodeIds.length>0?this.setNodeProperties(this.currentNodeIds[this.currentNodeIds.length-1]):this.showDefaultProperties(),this.isDirty=!1)},e.prototype.setNodeProperties=function(c){var d=this;this.propertyNodeId=c,d.currentModel.getProperties(c,function(c){if(d.viewer){for(var e=[],f=c.properties,g=0,h=f.length;g<h;++g){var i=f[g];"__internalref__"===i.displayCategory&&e.push(i.displayValue)}var j;j=d.currentModel.is3d()&&a(d.currentModel)&&e.length>0?b(d.currentModel,e,c):Promise.resolve(c),j.then(function(a){d.setTitle(d.normalTitle,{localizeTitle:!0}),d.setProperties(a.properties),d.highlight(d.viewer.searchText),d.resizeToContent(),d.respositionPanel()}).catch(function(){d.setProperties([]),d.highlight(""),d.resizeToContent(),d.respositionPanel()})}},function(){d.setTitle(d.normalTitle,{localizeTitle:!0}),d.showNoProperties()})},e.prototype.respositionPanel=function(){if(this.isVisible()){var a=this.viewer.toolController,b=a.lastClickX,c=a.lastClickY,d=this.container.getBoundingClientRect(),e=d.left,f=d.top,g=d.width,h=d.height,i=this.viewer.impl.getCanvasBoundingClientRect(),j=i.left,k=i.top,l=i.width,m=i.height;e<=b&&b<e+g&&f<=c&&c<f+h&&(b<e+g/2&&b+g<j+l?(this.container.style.left=Math.round(b-j)+"px",this.container.dockRight=!1):j<=b-g?(this.container.style.left=Math.round(b-j-g)+"px",this.container.dockRight=!1):b+g<j+l?(this.container.style.left=Math.round(b-j)+"px",this.container.dockRight=!1):c+h<k+m?(this.container.style.top=Math.round(c-k)+"px",this.container.dockBottom=!1):k<=c-h&&(this.container.style.top=Math.round(c-k-h)+"px",this.container.dockBottom=!1))}},e.prototype.showDefaultProperties=function(){var a=this.currentModel?this.currentModel.getRootId():null;a?this.setNodeProperties(a):(this.propertyNodeId=null,this.setTitle(this.normalTitle,{localizeTitle:!0}),d.PropertyPanel.prototype.showDefaultProperties.call(this))},e.prototype.areDefaultPropertiesShown=function(){if(!this.currentModel)return!1;var a=this.currentModel.getRootId();return this.propertyNodeId===a},e.prototype.uninitialize=function(){d.PropertyPanel.prototype.uninitialize.call(this),this.viewer=null},e.prototype.onCategoryClick=function(a,b){d.PropertyPanel.prototype.onCategoryClick.call(this,a,b),this.resizeToContent()},e.prototype.onCategoryIconClick=function(a,b){d.PropertyPanel.prototype.onCategoryIconClick.call(this,a,b),this.resizeToContent()},Autodesk.Viewing.Extensions.ViewerPropertyPanel=e}(),function(){"use strict";var a=function(a){var b=a.container;Autodesk.Viewing.UI.LayersPanel.call(this,a,b,b.id+"ViewerLayersPanel",{heightAdjustment:55}),this.onRestoreStateBinded=this.onRestoreState.bind(this),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_STATE_RESTORED_EVENT,this.onRestoreStateBinded)};a.prototype=Object.create(Autodesk.Viewing.UI.LayersPanel.prototype),a.prototype.constructor=a,Autodesk.Viewing.Extensions.ViewerPanelMixin.call(a.prototype),a.prototype.uninitialize=function(){this.onRestoreStateBinded&&(this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_STATE_RESTORED_EVENT,this.onRestoreStateBinded),this.onRestoreStateBinded=null),Autodesk.Viewing.UI.LayersPanel.prototype.uninitialize.call(this)},a.prototype.onRestoreState=function(){this.update()},a.prototype.onClick=function(a,b){if(!this.isMac||!b.ctrlKey){var c=!(b.shiftKey||b.metaKey||b.ctrlKey);this.setLayerVisible(a,c)}},a.prototype.onRightClick=function(a,b){var c=!(b.shiftKey||b.metaKey||b.ctrlKey);this.setLayerVisible(a,c)},a.prototype.onImageClick=function(a,b){this.isMac&&b.ctrlKey||this.setLayerVisible(a)},a.prototype.onTitleClick=function(a){this.viewer.setLayerVisible(null,!0)},a.prototype.onTitleDoubleClick=function(a){this.viewer.fitToView()},Autodesk.Viewing.Extensions.ViewerLayersPanel=a}(),function(){"use strict";function a(){var a=LMV_VIEWER_VERSION+"."+LMV_VIEWER_PATCH;return"@"===LMV_VIEWER_VERSION.charAt(0)&&(a="0.0.0"),"v"+a}var b=Autodesk.Viewing,c=b.Private,d=Autodesk.Viewing.Extensions,e=Autodesk.Viewing.UI;d.ViewerSettingTab={Navigation:"navigationtab",Performance:"performancetab",Appearance:"appearance",Environment:"environment"};var f=0,g=function(a,g){this.viewer=a,this.is3dMode=!g.is2d(),this.visible=!1;e.SettingsPanel.call(this,a.container,"ViewerSettingsPanel"+a.id+"-"+f++,"Settings",{width:400,addFooter:!1,heightAdjustment:90}),this.container.classList.add("viewer-settings-panel"),this.addTab(d.ViewerSettingTab.Performance,"Performance",{className:"performance"}),this.addTab(d.ViewerSettingTab.Navigation,"Navigation",{className:"navigation"}),this.addTab(d.ViewerSettingTab.Appearance,"Appearance",{className:"appearance"}),this.is3dMode&&this.addTab(d.ViewerSettingTab.Environment,"Environment",{className:"environment"}),this.is3dMode||this.container.classList.add("for-2d-model"),this.createRestoreDefaultSettingsButton(),this.modelPreferenceCount=0,this.createNavigationPanel(),this.createPerformancePanel(),this.createAppearancePanel(),this.createEnvironmentPanel(),this.modelPreferenceCount&&c.logger.log("Model locked ("+this.modelPreferenceCount+") render settings in UI."),this.selectTab(d.ViewerSettingTab.Performance),this.syncUI=this.syncUI.bind(this),a.addEventListener(b.RESTORE_DEFAULT_SETTINGS_EVENT,this.syncUI),a.addEventListener(b.VIEWER_STATE_RESTORED_EVENT,this.syncUI)};g.prototype=Object.create(e.SettingsPanel.prototype),g.prototype.constructor=g,d.ViewerPanelMixin.call(g.prototype),g.prototype.uninitialize=function(){this.viewer&&(this.viewer.removeEventListener(b.RESTORE_DEFAULT_SETTINGS_EVENT,this.syncUI),this.viewer.removeEventListener(b.VIEWER_STATE_RESTORED_EVENT,this.syncUI)),this.viewer=null,e.SettingsPanel.prototype.uninitialize.call(this),this.envSelect=null},g.prototype.setVisible=function(a){this.visible=a,e.SettingsPanel.prototype.setVisible.call(this,a),a&&this.sizeToContent()},g.prototype.addCheckbox=function(a,b,c,d,f,g){function h(a){g&&i.prefs.set(g,a),f(a)}var i=this.viewer,j=i.prefs[g];d="boolean"==typeof j?j:d;var k=e.SettingsPanel.prototype.addCheckbox.call(this,a,b,d,h,c),l=this.getControl(k);return l.saveKey=g,g?i.prefs.addListeners(g,function(a){l.setValue(a)},function(a){l.setValue(a),f(a)}):l.sliderRow.classList.add("logical-group"),i.prefs.hasTag(g,"no-storage")&&(l.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),k},g.prototype.addGrid=function(a,c,d,e,f,g){var h=c,i=document.createElement("div");i.classList.add("environments-container"),h.appendChild(i);var j=document.createElement("div");j.classList.add("environments-lighting-table"),i.appendChild(j);for(var k=0;k<d.length;k++){var l=document.createElement("div");l.classList.add("settings-environment-cell"),l.index=k;var m=document.createElement("div");m.classList.add((k<10?"img0":"img")+k),m.classList.add("settings-environment-image"),l.appendChild(m);var n=document.createElement("span");n.textContent=b.i18n.translate(d[k]),n.classList.add("settings-environment-name"),n.setAttribute("data-i18n",d[k]),l.appendChild(n),l.addEventListener("click",function(){f(this.index)}),j.appendChild(l)}var o=this,p=this.viewer;return p.prefs.addListeners(g,function(){o.updateEnvironmentSelection()},function(a){f(p.prefs.lightPreset),o.updateEnvironmentSelection()}),this.updateEnvironmentSelection(),j},g.prototype.updateEnvironmentSelection=function(){if(this.is3dMode)for(var a=this.viewer.prefs.lightPreset,b=this.gridTable.querySelectorAll(".settings-environment-cell"),c=0;c<b.length;c++)b[c].index===a?b[c].classList.add("border-select"):b[c].classList.remove("border-select")},g.prototype.addLabel=function(a,b){var e,f=function(){switch(a){case d.ViewerSettingTab.Performance:return 0;case d.ViewerSettingTab.Navigation:return 1;case d.ViewerSettingTab.Appearance:return 2;case d.ViewerSettingTab.Environment:return 3;default:return-1}}();if(-1===f)return!1;e=this.tablesContainer.childNodes[f],this.settingsLabel=new c.OptionLabel(b,e.tBodies[0]),this.settingsLabel.sliderRow.classList.add("logical-group")},g.prototype.removeCheckbox=function(a){return this.viewer.prefs.removeListeners(a.saveKey),this.removeEventListener(a,"change",a.changeListener),e.SettingsPanel.prototype.removeCheckbox.call(this,a)},g.prototype.createNavigationPanel=function(){var a=this.viewer,c=d.ViewerSettingTab.Navigation;this.tablesContainer.childNodes[1];this.is3dMode&&(this.addLabel(c,"ViewCube"),this.addCheckbox(c,"Show ViewCube","Toggles availability of the ViewCube navigation control",!0,function(b){a.displayViewCube(b)},"viewCube"),b.isMobileDevice()||this.addCheckbox(c,"ViewCube acts on pivot","When enabled, the ViewCube orbits the view around the active pivot point When disabled, it orbits around the center of the view",!1,function(b){a.setUsePivotAlways(b)},"alwaysUsePivot"),this.addLabel(c,"Orbit"),this.addCheckbox(c,"Fusion style orbit","Enables Fusion-style orbit overlay and gives the ability to lock orbit axis",!1,function(b){b?a.loadExtension("Autodesk.Viewing.FusionOrbit",null):a.unloadExtension("Autodesk.Viewing.FusionOrbit",null)},"fusionOrbit"),this.addCheckbox(c,"Orbit past world poles","Allows view rotation to continue past the models North Pole",!0,function(b){a.setOrbitPastWorldPoles(b)},"orbitPastWorldPoles"),b.isMobileDevice()||(this.addLabel(c,"Zoom"),this.addCheckbox(c,"Zoom towards pivot","When disabled, zooming operations are centered at the current cursor location",!1,function(b){a.setZoomTowardsPivot(b)},"zoomTowardsPivot"),this.addCheckbox(c,"Reverse mouse zoom direction","Toggles direction of zooming in and out",!1,function(b){a.setReverseZoomDirection(b)},"reverseMouseZoomDir"),this.addLabel(c,"Mouse"),this.addCheckbox(c,"Left handed mouse setup","Swaps the buttons on the mouse",!1,function(b){a.setUseLeftHandedInput(b)},"leftHandedMouseSetup"),this.addCheckbox(c,"Set pivot with left mouse button","Change left-click behavior to set new pivot point (overrides select object)",!1,function(b){a.setClickToSetCOI(b)},"clickToSetCOI")),this.addCheckbox(c,"Open properties on select","Always show properties upon selecting object",!0,function(b){a.setPropertiesOnSelect(b)},"openPropertiesOnSelect")),this.is3dMode||(this.addLabel(c,"Zoom"),this.addCheckbox(c,"Reverse mouse zoom direction","Toggles direction of zooming in and out",!1,function(b){a.setReverseZoomDirection(b)},"reverseMouseZoomDir"),this.addLabel(c,"Mouse"),this.addCheckbox(c,"Open properties on select","Always show properties upon selecting object",!0,function(b){a.setPropertiesOnSelect(b)},"openPropertiesOnSelect"),this.addCheckbox(c,"Left handed mouse setup","Swaps the buttons on the mouse",!1,function(b){a.setUseLeftHandedInput(b)},"leftHandedMouseSetup"))},g.prototype.createPerformancePanel=function(){var a=this.viewer,c=d.ViewerSettingTab.Performance;this.tablesContainer.childNodes[0];this.is3dMode&&(this.addLabel(c,"Performance Optimization"),this.optimizeNavigationhkBoxId=this.addCheckbox(c,"Smooth navigation","Provides faster response(but degrades quality) while navigating",b.isMobileDevice(),function(b){a.setOptimizeNavigation(b)},"optimizeNavigation"),this.progressiveRenderChkBoxId=this.addCheckbox(c,"Progressive display","Shows incremental updates of the view and allows for more responsive interaction with the model (some elements may flicker) This improves perceived waiting time",!0,function(b){a.setProgressiveRendering(b)},"progressiveRendering"),this.addLabel(c,"Display"),this.ghosthiddenChkBoxId=this.addCheckbox(c,"Ghost hidden objects","Leave hidden objects slightly visible",!0,function(b){a.setGhosting(b)},"ghosting"),this.displayLinesId=this.addCheckbox(c,"Display Lines","Toggles display of line objects",!0,function(b){a.hideLines(!b)},"lineRendering"),this.displayPointsId=this.addCheckbox(c,"Display Points","Toggles display of point objects",!0,function(b){a.hidePoints(!b)},"pointRendering"),this.displayEdgesId=this.addCheckbox(c,"Display edges","Shows outline of model surfaces",!1,function(b){a.setDisplayEdges(b)},"edgeRendering")),this.is3dMode||(this.addLabel(c,"Performance Optimization"),this.progressiveRenderChkBoxId=this.addCheckbox(c,"Progressive display","Shows incremental updates of the view and allows for more responsive interaction with the model (some elements may flicker) This improves perceived waiting time",!0,function(b){a.setProgressiveRendering(b)},"progressiveRendering"))},g.prototype.createAppearancePanel=function(){var a=this.viewer,b=d.ViewerSettingTab.Appearance;this.tablesContainer.childNodes[2];this.is3dMode&&(this.addLabel(b,"Visual Quality Optimization"),this.antialiasingChkBoxId=this.addCheckbox(b,"Anti-aliasing","Remove jagged edges from lines",!0,function(b){a.setQualityLevel(a.prefs.ambientShadows,b)},"antialiasing"),this.ambientshadowsChkBoxId=this.addCheckbox(b,"Ambient shadows","Improve shading of occluded surfaces",!0,function(b){a.setQualityLevel(b,a.prefs.antialiasing)},"ambientShadows"),this.groundShadowChkBoxId=this.addCheckbox(b,"Ground shadow","Add simulated ground surface shadows",!0,function(b){a.setGroundShadow(b)},"groundShadow"),this.groundReflectionChkBoxId=this.addCheckbox(b,"Ground reflection","Add simulated ground surface reflections",!1,function(b){a.setGroundReflection(b)},"groundReflection")),this.is3dMode||(this.addLabel(b,"Existing behavior"),this.swapBlackAndWhiteChkBoxId=this.addCheckbox(b,"2D Sheet Color","Switch sheet color white to black",!0,function(b){a.setSwapBlackAndWhite(b)},"swapBlackAndWhite"))},g.prototype.createEnvironmentPanel=function(){if(this.is3dMode){var a=this.viewer,e=d.ViewerSettingTab.Environment,f=this.tablesContainer.childNodes[3];this.gridTable=f,this.addLabel(e,"Environment"),this.envMapBackgroundChkBoxId=this.addCheckbox(e,"Environment Image Visible","Shows lighting environment as background",!0,function(b){a.setEnvMapBackground(b)}.bind(this),"envMapBackground");var g=f.tBodies[0].insertRow(-1),h=g.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n","Environments and Lighting Selection"),this.caption.textContent=b.i18n.translate("Environments and Lighting Selection"),this.caption.classList.add("settings-row-title"),h.appendChild(this.caption),h.colSpan="3";for(var i=[],j=0;j<c.LightPresets.length;j++)i.push(c.LightPresets[j].name);this.envSelect=this.addGrid("Environments and Lighting Selection",f,i,a.impl.currentLightPreset(),function(b){a.setLightPreset(b)},"lightPreset"),this.envSelect.classList.add("with-environment")}},g.prototype.createRestoreDefaultSettingsButton=function(){var c=this.viewer;this.restoreDiv=document.createElement("div"),this.restoreDiv.classList.add("docking-panel-container-solid-color-b"),this.restoreDiv.classList.add("restore-defaults-container"),this.restoreButton=document.createElement("div"),this.restoreButton.className="docking-panel-tertiary-button",this.restoreButton.setAttribute("data-i18n","Restore all default settings"),this.restoreButton.textContent=Autodesk.Viewing.i18n.translate("Restore all default settings"),this.restoreDiv.appendChild(this.restoreButton),this.versionDiv=document.createElement("div"),this.versionDiv.textContent=a(),
this.versionDiv.className="docking-panel-version-label",this.addEventListener(this.restoreDiv,"touchstart",b.touchStartToClick),this.addEventListener(this.restoreDiv,"click",function(){c.restoreDefaultSettings()},!1),this.scrollContainer.appendChild(this.restoreDiv),this.scrollContainer.appendChild(this.versionDiv)},g.prototype.selectTab=function(a){Autodesk.Viewing.UI.SettingsPanel.prototype.selectTab.call(this,a),this.sizeToContent()},g.prototype.sizeToContent=function(){var a=this.getContentSize(),b=a.height+this.heightAdjustment,c=this.viewer.container.clientHeight-this.heightAdjustment,d=Math.min(b,c);this.container.style.height=parseInt(d)+"px"},g.prototype.onViewerResize=function(a,b,c,d,e,f){this.sizeToContent()},g.prototype.syncUI=function(){var a=this.viewer,b=this.viewer.prefs;this.setControlValue(this.antialiasingChkBoxId,b.antialiasing),this.setControlValue(this.ambientshadowsChkBoxId,b.ambientShadows),this.setControlValue(this.groundShadowChkBoxId,b.groundShadow),this.setControlValue(this.groundReflectionChkBoxId,b.groundReflection),this.setControlValue(this.envMapBackgroundChkBoxId,a.impl.isEnvMapBackground()),this.setControlValue(this.progressiveRenderChkBoxId,b.progressiveRendering),this.setControlValue(this.swapBlackAndWhiteChkBoxId,b.swapBlackAndWhite),this.setControlValue(this.ghosthiddenChkBoxId,b.ghosting),this.setControlValue(this.displayLinesId,b.lineRendering),this.setControlValue(this.displayPointsId,b.pointRendering),this.setControlValue(this.displayEdgesId,b.edgeRendering),this.updateEnvironmentSelection()},g.prototype.setControlValue=function(a,b){var c=this.getControl(a);c&&c.setValue(b)},d.ViewerSettingsPanel=g}(),function(){"use strict";function a(a){b.ObjectContextMenu.call(this,a)}var b=Autodesk.Viewing.UI,c=Autodesk.Viewing.Private;a.prototype=Object.create(b.ObjectContextMenu.prototype),a.prototype.constructor=a,a.prototype.buildMenu=function(a,b){var d=this,e=[],f=this.viewer.navigation,g=this.viewer.model.is2d();b.hasSelected&&(e.push({title:"Isolate",target:function(){var a=d.viewer.getAggregateSelection();d.viewer.impl.visibilityManager.aggregateIsolate(a),d.viewer.clearSelection(),c.logger.track({name:"isolate_count",aggregate:"count"})}}),b.hasVisible&&e.push({title:"Hide Selected",target:function(){var a=d.viewer.impl.visibilityManager;d.viewer.getAggregateSelection(function(b,c){a.hide(c,b)}),d.viewer.clearSelection()}}),b.hasHidden&&e.push({title:"Show Selected",target:function(){var a=d.viewer.getSelection();d.viewer.clearSelection(),d.viewer.show(a)}})),g&&e.push({title:"Show All Layers",target:function(){d.viewer.setLayerVisible(null,!0)}}),e.push({title:"Show All Objects",target:function(){d.viewer.showAll(),c.logger.track({name:"showall",aggregate:"count"})}});var h=d.viewer.getAggregateSelection();return!g&&1===h.length&&f.isActionEnabled("gotoview")&&e.push({title:"Focus",target:function(){if(h=d.viewer.getAggregateSelection(),h.length>0){var a=h[0];d.viewer.fitToView(a.selection,a.model)}else 0===h.length&&d.viewer.fitToView();c.logger.track({name:"fittoview",aggregate:"count"})}}),b.hasSelected&&e.push({title:"Clear Selection",target:function(){d.viewer.clearSelection(),c.logger.track({name:"clearselection",aggregate:"count"})}}),e},Autodesk.Viewing.Extensions.ViewerObjectContextMenu=a}();var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private,avu=Autodesk.Viewing.UI,ave=Autodesk.Viewing.Extensions,stringToDOM=avp.stringToDOM=function(a){var b=document.createElement("div");return b.innerHTML=a,b.firstChild};!function(){"use strict";av.TOOLBAR_CREATED_EVENT="toolbarCreated",av.VIEW_CUBE_CREATED_EVENT="viewCubeCreated",av.TOOLBAR={NAVTOOLSID:"navTools",MODELTOOLSID:"modelTools",SETTINGSTOOLSID:"settingsTools",MEASURETOOLSID:"measureTools"};var a=function(a,b){b||(b={}),b.startOnInitialize=!1,av.Viewer3D.call(this,a,b),this.toolbar=null,this.dockingPanels=[],this.modelstructure=null,this.layersPanel=null,this.onFullScreenModeEvent=this.onFullScreenModeEvent.bind(this)};a.prototype=Object.create(av.Viewer3D.prototype),a.prototype.constructor=a,a.prototype.initialize=function(){var a=av.Viewer3D.prototype.initialize.call(this);if(a>0)return avp.ErrorHandler.reportError(this.container,a),a;var b=this;if(this.toolController){var c=new av.HotGestureTool(this);this.toolController.registerTool(c),this.toolController.activateTool(c.getName())}return this.getToolbar(!0),this.addEventListener(av.FULLSCREEN_MODE_EVENT,this.onFullScreenModeEvent),this.contextMenu||this.setDefaultContextMenu(),this.progressbar=new avp.ProgressBar(this.container),this.addEventListener(av.PROGRESS_UPDATE_EVENT,function(a){void 0!==a.percent&&b.progressbar.setPercent(a.percent)},!1),this.selectionActive=!1,this.addEventListener(av.SELECTION_CHANGED_EVENT,function(a){if(b.selectionActive=a.dbIdArray.length>0,b.prefs.openPropertiesOnSelect){b.getPropertyPanel(!0).setVisible(b.selectionActive)}}),this.addEventListener(av.ISOLATE_EVENT,function(a){(b.prefs.openPropertiesOnSelect||a.nodeIdArray[0]===a.model.getRootId())&&b.propertygrid&&b.propertygrid.setVisible(a.nodeIdArray.length>0||b.selectionActive)}),this.addEventListener(av.VIEWER_STATE_RESTORED_EVENT,function(a){b.renderoptions&&b.renderoptions.syncUI()}),this.addEventListener(av.VIEWER_RESIZE_EVENT,function(a){b.resizePanels(),b.viewCubeUi&&b.viewCubeUi.cube&&b.viewCubeUi.cube.refreshCube(),b.updateToolbarButtons(a.width,a.height)}),this.addEventListener(av.NAVIGATION_MODE_CHANGED_EVENT,function(a){b.updateToolbarButtons(b.container.clientWidth,b.container.clientHeight)}),this.addEventListener(av.MODEL_UNLOADED_EVENT,function(a){b._onUnloadModel(a.model)}),this.initEscapeHandlers(),this.localize(),this.addEventListener(av.WEBGL_CONTEXT_LOST_EVENT,function(a){this.impl.stop();for(var b=this.container,c=b.childElementCount,d=0;d<c;++d)b.children[d].style.display="none";avp.ErrorHandler.reportError(this.container,av.ErrorCodes.WEBGL_LOST_CONTEXT)}.bind(this)),this.run(),0},a.prototype.uninitialize=function(){this.viewerSettingsPanel&&(this.viewerSettingsPanel.uninitialize(),this.viewerSettingsPanel=null),this.modelstructure&&(this.modelstructure.uninitialize(),this.modelstructure=null),this.layersPanel&&(this.layersPanel.uninitialize(),this.layersPanel=null),this.propertygrid&&(this.propertygrid.uninitialize(),this.propertygrid=null),this.renderoptions&&(this.renderoptions.uninitialize(),this.renderoptions=null),this.viewerOptionButton&&(this.viewerOptionButton=null),this.getHotkeyManager().popHotkeys("Autodesk.ROLL"),this.getHotkeyManager().popHotkeys("Autodesk.FOV"),this.removeEventListener(av.FULLSCREEN_MODE_EVENT,this.onFullScreenModeEvent),this.progressbar=null,this.modelTools=null,this.navTools=null,this.settingsTools=null,this.debugMenu=null,this.modelStats=null,this.explodeSlider=null,this.explodeSubmenu=null,this.toolbar=null,av.Viewer3D.prototype.uninitialize.call(this)},a.prototype.setUp=function(a){a||(a={}),a.startOnInitialize=!1,this.getToolbar(!0),av.Viewer3D.prototype.setUp.call(this,a)},a.prototype.tearDown=function(){av.Viewer3D.prototype.tearDown.call(this),this.toolbar&&(this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.modelstructure&&this.setModelStructurePanel(null),this.propertygrid&&this.setPropertyPanel(null),this.viewerSettingsPanel&&this.setSettingsPanel(null),this.layersPanel&&this.setLayersPanel(null),this.renderoptions&&(this.removePanel(this.renderoptions),this.renderoptions.uninitialize(),this.renderoptions=null),this.debugMenu=null,this.removeEventListener(av.GEOMETRY_LOADED_EVENT,this.initViewCube)},a.prototype.loadModel=function(a,b,c,d,e){function f(a){if(!i.running)return void avp.logger.error("createUI expects the viewer to be running.",av.errorCodeString(av.ErrorCodes.VIEWER_INTERNAL_ERROR));i.createUI(a)}function g(a){setTimeout(function(){b&&b.loadAsHidden||f(a),i._onLoadModel(a),c&&c.call(c,a)},1)}function h(a){avp.ErrorHandler.reportError(i.container,a),d&&d.apply(d,arguments)}var i=this;return av.Viewer3D.prototype.loadModel.call(this,a,b,g,h,e)},a.prototype.createUI=function(a){if(this.model===a){var b=this;this.initViewCube=function(){setTimeout(function(){b.displayViewCube(b.prefs.viewCube),b.removeEventListener(av.GEOMETRY_LOADED_EVENT,b.initViewCube)},1)};var c=this.config.disabledExtensions||{};this.initHotkeys(a);var d=this.getExtension("Autodesk.DefaultTools.NavTools");d?d.updateUI(a.is3d()):this.loadExtension("Autodesk.DefaultTools.NavTools",b.config),this.initModelTools(a),avp.ENABLE_DEBUG&&this.initDebugTools();"true"===avp.getParameterByName("lmv_viewer_debug")&&this.loadExtension("Autodesk.Debug",this.config),this.toolbar.container.style.display="block",this.dispatchEvent({type:av.TOOLBAR_CREATED_EVENT}),this.createViewCube(),this.dispatchEvent({type:av.VIEW_CUBE_CREATED_EVENT}),this.initModality(),this.resize(),a.is2d()?(this.unloadExtension("Autodesk.BimWalk"),this.unloadExtension("Autodesk.FirstPerson"),this.setDefaultNavigationTool("pan"),this.setClickToSetCOI(!1,!1),this.displayViewCube(!1,!1),setTimeout(function(){c.measure||b.loadExtension("Autodesk.Measure",b.config),c.hyperlink||b.loadExtension("Autodesk.Hyperlink",b.config)},1)):(-1===this.getDefaultNavigationToolName().indexOf("orbit")&&this.setDefaultNavigationTool("orbit"),setTimeout(function(){c.bimwalk||b.loadExtension("Autodesk.BimWalk",b.config),b.prefs.fusionOrbit&&b.loadExtension("Autodesk.Viewing.FusionOrbit",b.config),c.measure||b.loadExtension("Autodesk.Measure",b.config),c.section||b.loadExtension("Autodesk.Section",b.config),c.hyperlink||b.loadExtension("Autodesk.Hyperlink",b.config),c.scalarisSimulation||b.model.loader instanceof avp.ScalarisLoader&&b.loadExtension("Autodesk.Viewing.ScalarisSimulation",b.config)},1),this.addEventListener(av.GEOMETRY_LOADED_EVENT,this.initViewCube))}},a.prototype.onFullScreenModeEvent=function(a){this.resizePanels(),this.updateFullscreenButton(a.mode)},a.prototype._onLoadModel=function(a){this.modelstructure&&this.modelstructure.addModel(a)},a.prototype._onUnloadModel=function(a){this.modelstructure&&this.modelstructure.unloadModel(a)},a.prototype.addOptionToggle=function(a,b,c,d,e){var f=e?this.prefs[e]:null;c="boolean"==typeof f?f:c;var g=document.createElement("li");g.className="toolbar-submenu-listitem";var h=document.createElement("input");h.className="toolbar-submenu-checkbox",h.type="checkbox",h.id=b,g.appendChild(h);var i=document.createElement("label");return i.setAttribute("for",b),i.setAttribute("data-i18n",b),i.textContent=av.i18n.translate(b),g.appendChild(i),a.appendChild(g),h.checked=c,h.addEventListener("touchstart",av.touchStartToClick),i.addEventListener("touchstart",av.touchStartToClick),g.addEventListener("touchstart",av.touchStartToClick),h.addEventListener("click",function(a){d(h.checked),a.stopPropagation()}),i.addEventListener("click",function(a){a.stopPropagation()}),g.addEventListener("click",function(a){d(!h.checked),a.stopPropagation()}),e&&this.prefs.addListeners(e,function(a){h.checked=a},function(a){h.checked=a,d(a)}),h},a.prototype.addOptionList=function(a,b,c,d,e,f){var g=this.prefs[f];d="number"==typeof g?g:d;var h=function(a){var b=a.target.selectedIndex;e(b),a.stopPropagation()},i=document.createElement("select");i.className="option-drop-down",i.id="selectMenu_"+b;for(var j=0;j<c.length;j++){var k=document.createElement("option");k.value=j,k.setAttribute("data-i18n",c[j]),k.textContent=Autodesk.Viewing.i18n.translate(c[j]),i.add(k)}var l=document.createElement("li");l.className="toolbar-submenu-select";var m=document.createElement("div");return m.className="toolbar-submenu-selectlabel",m.setAttribute("for",b),m.setAttribute("data-i18n",b),m.textContent=av.i18n.translate(b),l.appendChild(m),l.appendChild(i),a.appendChild(l),i.selectedIndex=d,i.onchange=h,i.addEventListener("touchstart",function(a){a.stopPropagation()}),i.addEventListener("click",function(a){a.stopPropagation()}),f&&this.prefs.addListeners(f,function(a){i.selectedIndex=a},function(a){i.selectedIndex=a,e(a)}),i},a.prototype.showViewer3dOptions=function(a){var b=this.getSettingsPanel(!0);a&&b.isVisible()&&b.setVisible(!1),b.setVisible(a)},a.prototype.showRenderingOptions=function(a){this.renderoptions.setVisible(a)},a.prototype.showLayerManager=function(a){this.layersPanel.setVisible(a)},a.prototype.initHotkeys=function(a){var b,c,d=this,e=Autodesk.Viewing.KeyCode;if(!a.is2d()){var f;b=function(){return!(d.toolController.getIsLocked()||!d.navigation.isActionEnabled("fov"))&&(f=d.getActiveNavigationTool(),d.setActiveNavigationTool("fov"),!0)},c=function(){return!(d.toolController.getIsLocked()||!d.navigation.isActionEnabled("fov"))&&(d.setActiveNavigationTool(f),!0)},d.getHotkeyManager().pushHotkeys("Autodesk.FOV",[{keycodes:[e.CONTROL,e.SHIFT],onPress:b,onRelease:c}],{tryUntilSuccess:!0})}var g;b=function(){return!(d.toolController.getIsLocked()||!d.navigation.isActionEnabled("roll"))&&(g=d.getActiveNavigationTool(),d.setActiveNavigationTool("worldup"),!0)},c=function(){return!(d.toolController.getIsLocked()||!d.navigation.isActionEnabled("roll"))&&(d.setActiveNavigationTool(g),!0)},d.getHotkeyManager().pushHotkeys("Autodesk.ROLL",[{keycodes:[e.ALT,e.SHIFT],onPress:b,onRelease:c}],{tryUntilSuccess:!0})},a.prototype.setModelStructurePanel=function(a){if(a===this.modelstructure)return!1;var b=!1;if(this.modelstructure&&(b=!0,this.modelstructure.setVisible(!1),this.removePanel(this.modelstructure),this.modelstructure.uninitialize()),this.modelstructure=a,!a)return!0;if(this.addPanel(this.modelstructure),b)for(var c=this.impl.modelQueue().getModels(),d=0;d<c.length;++d)this.modelstructure.addModel(c[d]);var e=this;return a.addVisibilityListener(function(b){b&&e.onPanelVisible(a,e),e.settingsTools.structurebutton.setState(b?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)}),!0},a.prototype.setLayersPanel=function(a){var b=this;return!(this.model&&!this.impl.getLayersRoot())&&((a instanceof av.UI.LayersPanel||!a)&&(this.layersPanel&&(this.layersPanel.setVisible(!1),this.removePanel(this.layersPanel),this.layersPanel.uninitialize()),this.layersPanel=a,a&&(this.addPanel(a),a.addVisibilityListener(function(c){c&&b.onPanelVisible(a,b),b.settingsTools.layerButton.setState(c?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0))},a.prototype.setPropertyPanel=function(a){var b=this;return(a instanceof av.UI.PropertyPanel||!a)&&(this.propertygrid&&(this.propertygrid.setVisible(!1),this.removePanel(this.propertygrid),this.propertygrid.uninitialize()),this.propertygrid=a,a&&(this.addPanel(a),a.addVisibilityListener(function(c){c&&b.onPanelVisible(a,b),b.settingsTools.propertiesbutton.setState(c?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},a.prototype.getPropertyPanel=function(a){return!this.propertygrid&&a&&this.setPropertyPanel(new ave.ViewerPropertyPanel(this)),this.propertygrid},a.prototype.setSettingsPanel=function(a){var b=this;return(a instanceof av.UI.SettingsPanel||!a)&&(this.viewerSettingsPanel&&(this.viewerSettingsPanel.setVisible(!1),this.removePanel(this.viewerSettingsPanel),this.viewerSettingsPanel.uninitialize()),this.viewerSettingsPanel=a,a&&(this.addPanel(a),a.addVisibilityListener(function(c){c&&b.onPanelVisible(a,b),b.viewerOptionButton.setState(c?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},a.prototype.getSettingsPanel=function(a){return!this.viewerSettingsPanel&&a&&this.setSettingsPanel(new ave.ViewerSettingsPanel(this,this.model)),this.viewerSettingsPanel},a.prototype.createSettingsPanel=function(a){var b=new ave.ViewerSettingsPanel(this,a);this.setSettingsPanel(b),b.syncUI();var c=new avu.Button("toolbar-settingsTool");this.viewerOptionButton=c,c.setIcon("adsk-icon-settings"),c.setToolTip("Settings"),this.settingsTools.addControl(c),this.createViewerOptionsMenu(a)},a.prototype.initModelTools=function(a){var b=this;if(!a.is2d()){if(!b.modelstructure){var c={docStructureConfig:b.config.docStructureConfig,hideSearch:av.isMobileDevice(),excludeRoot:b.config.modelBrowserExcludeRoot,startCollapsed:b.config.modelBrowserStartCollapsed},d=this.config.defaultModelStructureTitle?this.config.defaultModelStructureTitle:"Browser";b.setModelStructurePanel(new ave.ViewerModelStructurePanel(b,d,c))}var e=new avu.Button("toolbar-modelStructureTool");e.setToolTip("Model browser"),e.setIcon("adsk-icon-structure"),e.onClick=function(a){b.showModelStructurePanel(!b.modelstructure.isVisible())},this.settingsTools.addControl(e),this.settingsTools.structurebutton=e,this.initExplodeSlider()}var f=function(){var a=b.impl.layers.getRoot();if(a&&a.childCount>0){var c=new ave.ViewerLayersPanel(this);this.setLayersPanel(c);var d=new avu.Button("toolbar-layers-tool");d.setToolTip("Layer Manager"),d.setIcon("adsk-icon-layers"),d.onClick=function(a){b.layersPanel||b.setLayersPanel(new ave.ViewerLayersPanel(b)),b.showLayerManager(!b.layersPanel.isVisible())};var e=this.settingsTools.indexOf("toolbar-modelStructureTool");e=-1!==e?e:0,this.settingsTools.addControl(d,{index:e+1}),this.settingsTools.layerButton=d}b.removeEventListener(av.MODEL_LAYERS_LOADED_EVENT,f)}.bind(this);b.impl.layers&&b.impl.layers.initialized?f():this.addEventListener(av.MODEL_LAYERS_LOADED_EVENT,f),b.addEventListener(av.RESET_EVENT,function(){b.model&&!b.model.is2d()&&(b.explode(0),b.explodeSlider.value=0),b.showAll()});var g=new avu.Button("toolbar-propertiesTool");if(g.setToolTip("Properties"),g.setIcon("adsk-icon-properties"),g.onClick=function(a){var c=b.getPropertyPanel(!0);c.setVisible(!c.isVisible())},g.setVisible(!b.prefs.openPropertiesOnSelect),this.settingsTools.addControl(g),this.settingsTools.propertiesbutton=g,this.createSettingsPanel(a),avp.ENABLE_DEBUG&&!a.is2d()){this.renderoptions=new avp.RenderOptionsPanel(this),this.addPanel(this.renderoptions);var h=new avu.Button("toolbar-renderOptionsTool");h.setToolTip("Rendering options"),h.setIcon("adsk-icon-settings-render"),h.onClick=function(a){b.showRenderingOptions(!b.renderoptions.isVisible())},this.settingsTools.addControl(h)}if(this.canChangeScreenMode()){var i=new avu.Button("toolbar-fullscreenTool",{collapsible:!1});i.setToolTip("Full screen"),i.setIcon("adsk-icon-fullscreen"),i.onClick=function(a){b.nextScreenMode()},this.settingsTools.addControl(i),this.settingsTools.fullscreenbutton=i,this.updateFullscreenButton(this.getScreenMode())}},a.prototype.setPropertiesOnSelect=function(a){this.prefs.set("openPropertiesOnSelect",a),this.settingsTools.propertiesbutton.setVisible(!a)},a.prototype.addDivider=function(a){var b=document.createElement("li");return b.className="toolbar-submenu-horizontal-divider",a.appendChild(b),b},a.prototype.createViewerOptionsMenu=function(a){function b(){c.getSettingsPanel(!0).isVisible()?c.showViewer3dOptions(!1):c.showViewer3dOptions(!0)}var c=this;this.viewerOptionButton.onClick=function(){b()}},a.prototype.initDebugTools=function(){if(this.debugMenu)return!1;var a=new avu.ControlGroup("debugTools");this.debugMenu=a;var b=new avu.Button("toolbar-debugTool");return b.setIcon("adsk-icon-bug"),a.addControl(b),this.debugMenu.debugSubMenuButton=b,this.createDebugSubmenu(this.debugMenu.debugSubMenuButton),this.toolbar.addControl(a),!0},a.prototype.removeDebugTools=function(){this.debugMenu&&(this.toolbar.removeControl(this.debugMenu),this.debugMenu=null)},a.prototype.createDebugSubmenu=function(a){function b(){c.localize()}var c=this,d=document.createElement("div");d.id="toolbar-debugToolSubmenu",d.classList.add("toolbar-submenu"),d.classList.add("toolbar-settings-sub-menu"),d.classList.add("adsk-hidden"),this.debugMenu.subMenu=d,this.debugMenu.subMenu.style.minWidth="180px",this.container.appendChild(d),this.initModelStats(),this.addDivider(d),this.addDivider(d);var e=avp.Lang.getLanguages(),f=e.map(function(a){return a.label}),g=e.map(function(a){return a.symbol}),h=c.selectedLanguage?c.selectedLanguage:0;this.addOptionList(d,"Language",f,h,function(a){var d=g[a];c.selectedLanguage=a,avp.setLanguage(d,b)},null).parentNode.style.paddingBottom="15px",this.addDivider(this.debugMenu.subMenu);var i=["UNKNOWN FAILURE","BAD DATA","NETWORK ERROR","NETWORK ACCESS DENIED","NETWORK FILE NOT FOUND","NETWORK SERVER ERROR","NETWORK UNHANDLED RESPONSE CODE","BROWSER WEBGL NOT SUPPORTED","BAD DATA NO VIEWABLE CONTENT"];this.addOptionList(d,"Error",i,0,function(a){var b=a+1;avp.ErrorHandler.reportError(c.container,b,"")},null).parentNode.style.paddingBottom="15px";var j=d.getBoundingClientRect();this.debugMenu.subMenu.style.width=j.width+"px",this.container.removeChild(d),a.container.appendChild(d);var k=j.left+j.width,l=this.container.getBoundingClientRect().right;if(k>l){var m=-(k-l+10)+"px";this.debugMenu.subMenu.style.left=m}a.onMouseOver=function(a){d.classList.remove("adsk-hidden")},a.onMouseOut=function(a){d.classList.add("adsk-hidden")},av.isTouchDevice()&&(a.onClick=function(a){d.classList.toggle("adsk-hidden")})},a.prototype.initModelStats=function(){function a(a){var b=c.impl,d="";c.model&&(d+="Geom&nbsp;polys:&nbsp;"+b.modelQueue().getGeometryList().geomPolyCount+"<br>",d+="Instance&nbsp;polys:&nbsp;"+b.modelQueue().getGeometryList().instancePolyCount+"<br>",d+="Fragments:&nbsp;"+b.modelQueue().getFragmentList().getCount()+"<br>",d+="Geoms:&nbsp;"+b.modelQueue().getGeometryList().geoms.length+"<br>",d+="Loading&nbsp;time:&nbsp;"+(b.model.loader.loadTime/1e3).toFixed(2)+" s<br>"),d+="# "+(a||""),c.modelStats.innerHTML=d}function b(){c.modelStats=document.createElement("div"),c.modelStats.className="statspanel",c.container.appendChild(c.modelStats),c.addEventListener(av.PROGRESS_UPDATE_EVENT,function(b){b.message&&a(b.message)}),c.fpsDisplay=document.createElement("div"),c.fpsDisplay.className="fps",c.container.appendChild(c.fpsDisplay)}var c=this;this.addOptionToggle(this.debugMenu.subMenu,"Model statistics",!1,function(d){d&&!c.modelStats&&(b(),a("")),c.modelStats.style.visibility=d?"visible":"hidden",c.fpsDisplay.style.visibility=d?"visible":"hidden",c.impl.fpsCallback=d?function(a){c.fpsDisplay.textContent=""+(0|a)}:null})},a.prototype.initEscapeHandlers=function(){var a=this;this.addEventListener(av.ESCAPE_EVENT,function(b){if(!a.contextMenu||!a.contextMenu.hide()){if(a.renderoptions&&a.renderoptions.isVisible())return void a.renderoptions.setVisible(!1);if(a.getActiveNavigationTool()!==a.getDefaultNavigationToolName())return a.toolController&&a.toolController.setIsLocked(!1),a.setActiveNavigationTool(),void avp.HudMessage.dismiss();if(a.selectionActive)return void a.clearSelection();if(!a.areAllVisible())return void a.showAll();if(!avp.AlertBox.dismiss()){for(var c=0;c<a.dockingPanels.length;++c){var d=a.dockingPanels[c];if("none"!==d.container.style.display&&""!==d.container.style.display)return void(d.container===a.modelstructure?a.showModelStructurePanel(!1):d.setVisible(!1))}a.escapeScreenMode()}}})},a.prototype.showViewCubeUI=function(a){this.viewCubeUi.setVisible(a)},a.prototype.showViewCubeTriad=function(a){this.viewCubeUi.showTriad(a)},a.prototype.displayViewCube=function(a,b){this.viewCubeUi.displayViewCube(a,b)},a.prototype.displayHomeandInfoButton=function(a){avp.logger.info("viewer.displayHomeandInfoButton() is deprecated. Use viewer.displayHomeButton() instead."),this.displayHomeButton(a)},a.prototype.displayHomeButton=function(a){var b=this.container.querySelector(".homeViewWrapper");b&&(b.style.display=a?"":"none")},a.prototype.getToolbar=function(a){if(!this.toolbar&&a){var b=av.UI;this.toolbar=new b.ToolBar("guiviewer3d-toolbar"),this.navTools=new b.RadioButtonGroup(av.TOOLBAR.NAVTOOLSID),this.modelTools=new b.ControlGroup(av.TOOLBAR.MODELTOOLSID),this.settingsTools=new b.ControlGroup(av.TOOLBAR.SETTINGSTOOLSID),this.toolbar.addControl(this.navTools),this.toolbar.addControl(this.modelTools),this.toolbar.addControl(this.settingsTools),this.container.appendChild(this.toolbar.container),this.toolbar.container.style.display="none"}return this.toolbar},a.prototype.showModelStructurePanel=function(a){this.modelstructure.setVisible(a)},a.prototype.onPanelVisible=function(a){this.dockingPanels.splice(this.dockingPanels.indexOf(a),1),this.dockingPanels.splice(0,0,a)},a.prototype.updateFullscreenButton=function(a){var b="adsk-icon-fullscreen";switch(a){case av.ScreenMode.kNormal:this.isScreenModeSupported(av.ScreenMode.kFullBrowser)||(b="adsk-icon-fullscreen");break;case av.ScreenMode.kFullBrowser:b=this.isScreenModeSupported(av.ScreenMode.kFullScreen)?"adsk-icon-fullscreen":"adsk-icon-fullscreen-exit";break;case av.ScreenMode.kFullScreen:b="adsk-icon-fullscreen-exit"}this.settingsTools.fullscreenbutton.setIcon(b)},a.prototype.localize=function(){av.i18n.localize(),this.debugMenu&&this.debugMenu.debugSubMenuButton&&(this.debugMenu.debugSubMenuButton.container.removeChild(this.debugMenu.subMenu),this.createDebugSubmenu(this.debugMenu.debugSubMenuButton)),avp.ErrorHandler.localize()},a.prototype.addPanel=function(a){return-1===this.dockingPanels.indexOf(a)&&(this.dockingPanels.push(a),!0)},a.prototype.removePanel=function(a){var b=this.dockingPanels.indexOf(a);return b>-1&&(this.dockingPanels.splice(b,1),!0)},a.prototype.resizePanels=function(a){a=a||{};var b=this.toolbar?this.toolbar.getDimensions().height:0,c=this.getDimensions(),d=c.height;a.dimensions&&a.dimensions.height?d=a.dimensions.height:a.dimensions={height:c.height,width:c.width},a.dimensions.height=d-b;var e=this,f=a?a.dockingPanels:null;f||(f=e.dockingPanels);var g,h,i=e.container.getBoundingClientRect(),j=i.top,k=i.bottom,l=i.left,m=i.right;a&&a.dimensions?(g=a.dimensions.width,h=a.dimensions.height,k=a.dimensions.height):(g=i.width,h=i.height);for(var n=0;n<f.length;++n)f[n].onViewerResize(j,k,l,m,g,h)},a.prototype.initExplodeSlider=function(){var a=this,b=new avu.Button("toolbar-explodeTool");b.setIcon("adsk-icon-explode"),b.setToolTip("Explode model"),a.modelTools.addControl(b,{index:0});this.explodeSubmenu=avp.stringToDOM('<div class="docking-panel docking-panel-container-solid-color-b explode-submenu" style="display:none"><input class="explode-slider" type="range" min="0" max="1" step="0.01" value="0"/></div>');var c;Autodesk.Viewing.isIOSDevice()?(c=document.querySelector("#toolbar-explodeTool").parentNode,this.explodeSubmenu.classList.add("ios")):c=b.container,c.appendChild(this.explodeSubmenu);var d=this.explodeSubmenu.querySelector(".explode-slider");a.explodeSlider=d,d.oninput=function(b){a.explode(d.value)},d.onchange=function(b){a.explode(d.value)},this.explodeSubmenu.onclick=function(a){a.stopPropagation()};var e=b.container.querySelector(".adsk-control-tooltip");b.onClick=function(c){var f=b.getState();f===avu.Button.State.INACTIVE?(b.setState(avu.Button.State.ACTIVE),e.style.display="none",a.explodeSubmenu.style.display="",avp.logger.track({category:"tool_changed",name:"explode"})):f===avu.Button.State.ACTIVE&&(b.setState(avu.Button.State.INACTIVE),e.style.display="",d.parentNode.style.display="none",a.explode(0),a.explodeSlider.value=0)}},a.prototype.initInspectTools=function(){var a=new avu.Button("toolbar-inspectTools");a.setToolTip("Inspect"),a.setIcon("measure"),a.setVisible(!1),this.modelTools.addControl(a);var b=new avu.RadioButtonGroup("toolbar-inspectSubMenu");b.addClass("toolbar-vertical-group"),b.setVisible(!1),this.modelTools.addControl(b),a.container.insertBefore(b.container,a.container.firstChild),a.onMouseOver=function(){b.setVisible(!0)},a.onMouseOut=function(){b.setVisible(!1)},av.isTouchDevice()&&(a.onClick=function(a){b.setVisible(!b.isVisible())})},a.prototype.initModality=function(){function a(b){for(var c=0;c<2&&b.parentElement;){var d=b.id;if(0===d.indexOf("toolbar-")){if(d.indexOf("arrow")===d.length-5)return;return a(b.parentElement)||b}b=b.parentElement,c++}}function b(a){return a.id.substring(8,a.id.length)}function c(a){return a.classList.contains("active")}function d(a){var b=document.createEvent("Event");b.initEvent("click",!0,!0),a.dispatchEvent(b)}function e(a,b,c){h[a]=c?b:void 0}function f(f){var i=(f.target.getAttribute("class")||"").split(/\s+/);if(-1===i.indexOf("clickoff")){var j=a(f.target);if(j){var k=b(j);if(g[k]&&("sectionTool"!==k||-1===i.indexOf("adsk-icon-section-analysis")&&!f.target.querySelector(".adsk-icon-section-analysis"))&&("measureTool"!==k||-1===i.indexOf("adsk-icon-measure-menu")&&!f.target.querySelector(".adsk-icon-measure-menu"))){h[k]&&e(k,j,!1);for(var l in h){var m=h[l];if(m){var n=b(m);c(m)?g[k][n]||d(m):e(n,m,!1)}}e(k,j,!0)}}}}var g={orbitTools:{explodeTool:1},panTool:{explodeTool:1},zoomTool:{explodeTool:1},beelineTool:{},sectionTool:{measureTool:0,calibrateTool:0},explodeTool:{measureTool:0,calibrateTool:0,firstPersonTool:1,bimWalkTool:1},measureTool:{section:0},firstPersonTool:{explodeTool:1},bimWalkTool:{explodeTool:1}},h={};this.toolbar.container.addEventListener("click",f,!0)},a.prototype.updateToolbarButtons=function(a,b){if(this.getToolbar(!1)){var c,d;d=a>310?"block":"none",c=this.modelTools.getControl("toolbar-explodeTool"),c&&c.setDisplay(d),d=a>380?"block":"none",c=this.modelTools.getControl("toolbar-collaborateTool"),c&&c.setDisplay(d),d=a>515?"block":"none";var e=this.navTools.getControl("toolbar-cameraSubmenuTool");e&&(e.setDisplay(d),c=e.subMenu.getControl("toolbar-homeTool"),c&&c.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),c=e.subMenu.getControl("toolbar-fitToViewTool"),c&&c.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),c=e.subMenu.getControl("toolbar-focalLengthTool"),c&&c.setDisplay(this.navigation.isActionEnabled("fov")?"block":"none"),(c=e.subMenu.getControl("toolbar-rollTool"))&&c.setDisplay(this.navigation.isActionEnabled("roll")?"block":"none")),d=a>700?"block":"none",c=this.modelTools.getControl("toolbar-measureTool"),c&&c.setDisplay(d),c=this.modelTools.getControl("toolbar-sectionTool"),c&&c.setDisplay(d),d=a>740?"block":"none",c=this.navTools.getControl("toolbar-beelineTool"),c&&c.setDisplay(this.navigation.isActionEnabled("walk")?d:"none"),c=this.navTools.getControl("toolbar-firstPersonTool"),c&&c.setDisplay(this.navigation.isActionEnabled("walk")?d:"none"),c=this.navTools.getControl("toolbar-zoomTool"),c&&c.setDisplay(this.navigation.isActionEnabled("zoom")?d:"none"),c=this.navTools.getControl("toolbar-panTool"),c&&c.setDisplay(this.navigation.isActionEnabled("pan")?d:"none"),(c=this.navTools.getControl("toolbar-orbitTools"))&&c.setDisplay(this.navigation.isActionEnabled("orbit")?d:"none")}},avp.GuiViewer3D=a}(),function(){"use strict";function a(a,b){this._id=a,this._isCollapsible=!b||b.collapsible,this._toolTipElement=null,this._listeners={},this.container=document.createElement("div"),this.container.id=a,this.addClass("adsk-control")}var b=Autodesk.Viewing;Autodesk.Viewing.UI;a.Event={VISIBILITY_CHANGED:"Control.VisibilityChanged",COLLAPSED_CHANGED:"Control.CollapsedChanged"},b.EventDispatcher.prototype.apply(a.prototype),a.prototype.constructor=a,a.prototype.container=null,a.prototype.getId=function(){return this._id},a.prototype.setVisible=function(b){if(!this.container.classList.contains("adsk-hidden")===b)return!1;b?this.container.classList.remove("adsk-hidden"):this.container.classList.add("adsk-hidden");var c={type:a.Event.VISIBILITY_CHANGED,target:this,controlId:this._id,isVisible:b};return this.dispatchEvent(c),!0},a.prototype.isVisible=function(){return!this.container.classList.contains("adsk-hidden")},a.prototype.setToolTip=function(a){return(!this._toolTipElement||this._toolTipElement.getAttribute("tooltipText")!==a)&&(this._toolTipElement||(this._toolTipElement=document.createElement("div"),this._toolTipElement.id=this._id+"-tooltip",this._toolTipElement.classList.add("adsk-control-tooltip"),this.container.appendChild(this._toolTipElement)),this._toolTipElement.setAttribute("data-i18n",a),this._toolTipElement.setAttribute("tooltipText",a),this._toolTipElement.textContent=Autodesk.Viewing.i18n.translate(a,{defaultValue:a}),!0)},a.prototype.getToolTip=function(){return this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")},a.prototype.setCollapsed=function(b){
if(!this._isCollapsible||this.isCollapsed()===b)return!1;b?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed");var c={type:a.Event.COLLAPSED_CHANGED,isCollapsed:b};return this.dispatchEvent(c),!0},a.prototype.isCollapsed=function(){return!!this.container.classList.contains("collapsed")},a.prototype.isCollapsible=function(){return this._isCollapsible},a.prototype.addClass=function(a){this.container.classList.add(a)},a.prototype.removeClass=function(a){this.container.classList.remove(a)},a.prototype.getPosition=function(){var a=this.container.getBoundingClientRect();return{top:a.top,left:a.left}},a.prototype.getDimensions=function(){var a=this.container.getBoundingClientRect();return{width:a.width,height:a.height}},a.prototype.setDisplay=function(a){this.container.style.display=a},Autodesk.Viewing.UI.Control=a}(),function(){"use strict";function a(c,d){b.Control.call(this,c,d);var e=this;this._controls=[],this.addClass("adsk-control-group"),this.handleChildSizeChanged=function(b){var c={type:a.Event.SIZE_CHANGED,childEvent:b};e.dispatchEvent(c)}}var b=Autodesk.Viewing.UI;a.Event={VISIBILITY_CHANGED:b.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:b.Control.Event.COLLAPSED_CHANGED,SIZE_CHANGED:"ControlGroup.SizeChanged",CONTROL_ADDED:"ControlGroup.ControlAdded",CONTROL_REMOVED:"ControlGroup.ControlRemoved"},a.prototype=Object.create(b.Control.prototype),a.prototype.constructor=a,a.prototype.addControl=function(c,d){var e=d&&void 0!==d.index?d.index:this._controls.length;if(null!==this.getControl(c.getId()))return!1;var f={type:a.Event.CONTROL_ADDED,control:c,index:e};return e<this._controls.length?(this.container.insertBefore(c.container,this._controls[e].container),this._controls.splice(e,0,c)):(this.container.appendChild(c.container),this._controls.push(c)),c.addEventListener(b.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),c.addEventListener(b.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),c instanceof a&&c.addEventListener(a.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.dispatchEvent(f),this.dispatchEvent(a.Event.SIZE_CHANGED),!0},a.prototype.indexOf=function(a){for(var b=0;b<this._controls.length;b++){var c=this._controls[b];if(c===a||"string"==typeof a&&a===c.getId())return b}return-1},a.prototype.removeControl=function(c){var d="string"==typeof c?this.getControl(c):c;if(!d)return!1;var e=this._controls.indexOf(d);if(-1===e)return!1;this._controls.splice(e,1),this.container.removeChild(d.container);var f={type:a.Event.CONTROL_REMOVED,control:d,index:e};return d.removeEventListener(b.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),d.removeEventListener(b.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),d instanceof a&&d.removeEventListener(a.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.dispatchEvent(f),this.dispatchEvent(a.Event.SIZE_CHANGED),!0},a.prototype.getControl=function(a){for(var b=0;b<this._controls.length;b++)if(a===this._controls[b].getId())return this._controls[b];return null},a.prototype.getControlId=function(a){return a<0||a>=this._controls.length?null:this._controls[a].getId()},a.prototype.getNumberOfControls=function(){return this._controls.length},a.prototype.setCollapsed=function(b){if(!this._isCollapsible)return!1;var c=!1;return this._controls.forEach(function(a){a.isCollapsible()&&a.setCollapsed(b)&&(c=!0)}),c&&(b?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this.dispatchEvent({type:a.Event.COLLAPSED_CHANGED,isCollapsed:b})),c},Autodesk.Viewing.UI.ControlGroup=a}(),function(){"use strict";function a(a,c){b.ControlGroup.call(this,a,c),this.removeClass("adsk-control-group"),this.addClass("adsk-toolbar")}var b=Autodesk.Viewing.UI;a.Event={VISIBILITY_CHANGED:b.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:b.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:b.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:b.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:b.ControlGroup.Event.SIZE_CHANGED},a.prototype=Object.create(b.ControlGroup.prototype),a.prototype.constructor=a,Autodesk.Viewing.UI.ToolBar=a}(),function(){"use strict";function a(d,e){c.Control.call(this,d,e);var f=this;this._state=a.State.INACTIVE,this.icon=document.createElement("div"),this.icon.classList.add("adsk-button-icon"),this.container.appendChild(this.icon),this.container.addEventListener("click",function(b){f.getState()!==a.State.DISABLED&&(f.dispatchEvent(a.Event.CLICK),f.onClick&&f.onClick(b)),b.stopPropagation()}),b.isTouchDevice()?this.container.addEventListener("touchstart",b.touchStartToClick):(this.container.addEventListener("mouseover",function(a){f.onMouseOver(a)}),this.container.addEventListener("mouseout",function(a){f.onMouseOut(a)})),this.addClass("adsk-button"),this.addClass(a.StateToClassMap[this._state])}var b=Autodesk.Viewing,c=Autodesk.Viewing.UI;a.Event={VISIBILITY_CHANGED:c.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:c.Control.Event.COLLAPSED_CHANGED,STATE_CHANGED:"Button.StateChanged",CLICK:"click"},a.State={ACTIVE:0,INACTIVE:1,DISABLED:2},a.StateToClassMap=function(){var b=a.State,c={};return c[b.ACTIVE]="active",c[b.INACTIVE]="inactive",c[b.DISABLED]="disabled",c}(),a.prototype=Object.create(c.Control.prototype),a.prototype.constructor=a,a.prototype.setState=function(b){if(b===this._state)return!1;this.removeClass(a.StateToClassMap[this._state]),this.addClass(a.StateToClassMap[b]),this._state=b;var c={type:a.Event.STATE_CHANGED,state:b};return this.dispatchEvent(c),!0},a.prototype.setIcon=function(a){this.iconClass&&this.icon.classList.remove(this.iconClass),this.iconClass=a,this.icon.classList.add(a)},a.prototype.getState=function(){return this._state},a.prototype.onClick=function(a){},a.prototype.onMouseOver=function(a){},a.prototype.onMouseOut=function(a){},Autodesk.Viewing.UI.Button=a}(),function(){"use strict";function a(a,d){b.Button.call(this,a,d),this.arrowButton=new b.Button(a+"arrow"),this.arrowButton.addClass("adsk-button-arrow"),this.arrowButton.removeClass("adsk-button"),this.subMenu=new b.RadioButtonGroup(a+"SubMenu"),this.subMenu.addClass("toolbar-vertical-group"),this.subMenu.setVisible(!1),this.container.insertBefore(this.subMenu.container,this.container.firstChild),this.container.insertBefore(this.arrowButton.container,this.container.firstChild);var e=this;this.arrowButton.onClick=function(a){e.subMenu.setVisible(!e.subMenu.isVisible())},this.toggleFlyoutVisible=function(){e.subMenu.setVisible(!e.subMenu.isVisible())},this.onClick=function(a){e.subMenu.setVisible(!e.subMenu.isVisible())},this.subMenuActiveButtonChangedHandler=function(a){a.isActiveButton?(e.setIcon(a.target.getActiveButton().iconClass),e.setToolTip(a.target.getActiveButton().getToolTip()),e.setState(b.Button.State.ACTIVE),e.onClick=a.button.onClick):e.setState(b.Button.State.INACTIVE)},this.subMenu.addEventListener(b.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.subMenuActiveButtonChangedHandler);var f=c.stringToDOM('<div class="clickoff" style="position:fixed; top:0; left:0; width:100vw; height:100vh;"></div>');this.subMenu.container.insertBefore(f,this.subMenu.container.firstChild),f.addEventListener("click",function(a){e.subMenu.setVisible(!1),a.stopPropagation()})}var b=Autodesk.Viewing.UI,c=Autodesk.Viewing.Private;a.prototype=Object.create(b.Button.prototype),a.prototype.constructor=a,a.prototype.addControl=function(a){this.subMenu.addControl(a),a.addEventListener(b.Button.Event.CLICK,this.toggleFlyoutVisible)},a.prototype.removeControl=function(a){a.removeEventListener(b.Button.Event.CLICK,this.toggleFlyoutVisible)},a.prototype.setState=function(a){if(a===b.Button.State.INACTIVE){var c=this.subMenu.getActiveButton();c&&c.setState(b.Button.State.INACTIVE)}b.Button.prototype.setState.call(this,a)},a.prototype.saveAsDefault=function(){this.defaultState={},this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")&&(this.defaultState.tooltip=this._toolTipElement.getAttribute("tooltipText")),this.defaultState.icon=this.iconClass,this.defaultState.onClick=this.onClick},a.prototype.restoreDefault=function(){this.defaultState&&(this.defaultState.tooltip&&this.setToolTip(this.defaultState.tooltip),this.defaultState.icon&&this.setIcon(this.defaultState.icon),this.onClick=this.defaultState.onClick,this.setState(b.Button.State.INACTIVE))},Autodesk.Viewing.UI.ComboButton=a}(),function(){"use strict";function a(c,d){b.ControlGroup.call(this,c,d);var e=this;this._activeButton=null,this._handleButtonStateChange=function(c){var d=b.Button.State;if(c.state!==d.ACTIVE)return void(c.target===e._activeButton&&(e._activeButton=null,e.dispatchEvent({type:a.Event.ACTIVE_BUTTON_CHANGED,button:c.target,isActiveButton:!1})));e._activeButton=c.target,e.dispatchEvent({type:a.Event.ACTIVE_BUTTON_CHANGED,button:c.target,isActiveButton:!0}),e._controls.forEach(function(a){a!==c.target&&a.getState()!==d.DISABLED&&a.setState(d.INACTIVE)})}}var b=Autodesk.Viewing.UI;a.Event={ACTIVE_BUTTON_CHANGED:"RadioButtonGroup.ActiveButtonChanged",VISIBILITY_CHANGED:b.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:b.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:b.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:b.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:b.ControlGroup.Event.SIZE_CHANGED},a.prototype=Object.create(b.ControlGroup.prototype),a.prototype.constructor=a,a.prototype.addControl=function(a,c){return a instanceof b.Button&&(!!b.ControlGroup.prototype.addControl.call(this,a,c)&&(a.addEventListener(b.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0))},a.prototype.removeControl=function(a){var c="string"==typeof a?this.getControl(a):a;return!(null===c||!b.ControlGroup.prototype.removeControl.call(this,c))&&(c.removeEventListener(b.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0)},a.prototype.getActiveButton=function(){return this._activeButton},Autodesk.Viewing.UI.RadioButtonGroup=a}(),function(){"use strict";function a(a,d,e){function f(){var a=g.value.trim();if(0===a.length)return void i();n&&(avp.logger.track({category:"search_node",name:"model_browser_tool"}),n=!1),g.classList.add("searching");var b=m._searchFunction(a);m.searchResults.setResults(a,b),m.searchResults.setVisible(!0)}this._id=a,this._listeners={},this._options=e||{},this._searchFunction=this._options.searchFunction||function(){},this.container=document.createElement("div"),this.container.id=a,this.addClass("adsk-control"),this.addClass("adsk-searchbox"),this.addClass("empty");var g=document.createElement("input");g.classList.add("search-box"),g.classList.add("docking-panel-delimiter-shadow"),g.type="search",g.results=[],g.placeholder=b.i18n.translate("Search"),g.setAttribute("data-i18n","Search"),g.incremental="incremental",g.autosave=this.container.id+"search_autosave",this.container.insertBefore(g,this.scrollContainer),this.searchbox=g;var h=function(){m.searchbox.value="",m.addClass("empty")},i=function(){m.searchbox.classList.remove("searching"),m.searchResults.setVisible(!1)},j=document.createElement("div");j.className="search-box-icon",this.container.insertBefore(j,g.nextSibling);var k=document.createElement("div");k.className="search-box-close",k.addEventListener("click",function(){h(),i()}),this.container.appendChild(k),this.searchResults=new c.SearchResults(this.container,e.excludeRoot,d),this.searchResults.addEventListener(c.Searchbox.Events.ON_SEARCH_SELECTED,function(a){h(),i(),m.fireEvent(a)});var l,m=this,n=!0;g.addEventListener("keydown",function(a){if(a=a||window.event,38===a.keyCode&&(m.searchResults.selectPrevious(),a.preventDefault()),40===a.keyCode&&(m.searchResults.selectNext(),a.preventDefault()),13===a.keyCode){var b=m.searchResults.getSelection();if(!b)return!1;h(),i(),m.fireEvent({type:c.Searchbox.Events.ON_SEARCH_SELECTED,id:b.nodeId,modelId:b.modelId}),a.preventDefault()}}),g.addEventListener("input",function(a){if(0===this.value.length)return m.container.classList.add("empty"),void i();m.container.classList.remove("empty"),this.value.length<3||(clearTimeout(l),l=setTimeout(f,800))}),g.addEventListener("change",function(a){a.target===document.activeElement&&(clearTimeout(l),f())}),g.addEventListener("focus",function(){j.classList.add("focused")}),g.addEventListener("blur",function(){j.classList.remove("focused")})}var b=Autodesk.Viewing,c=Autodesk.Viewing.UI;a.prototype=Object.create(c.Control.prototype),a.prototype.constructor=a,a.Events={ON_SEARCH_SELECTED:"search-selected"},Autodesk.Viewing.UI.Searchbox=a}(),function(){"use strict";function a(a,c){this._id=a,this._listeners={},this._options=c||{},this._filterFunction=this._options.filterFunction||function(){},this.container=document.createElement("div"),this.container.id=a,this.addClass("adsk-control"),this.addClass("adsk-filterbox"),this.addClass("empty");var d=document.createElement("input");d.classList.add("filter-box"),d.classList.add("docking-panel-delimiter-shadow"),d.type="search",d.placeholder=b.i18n.translate("Enter filter term"),d.setAttribute("data-i18n","Enter filter term"),d.incremental="incremental",d.autosave=this.container.id+"filter",this.container.appendChild(d),this.filterbox=d;var e=this,f=function(){e.filterbox.value="",e.addClass("empty")},g=function(a){a=a.trim(),0===a.length?e.container.classList.add("empty"):e.container.classList.remove("empty"),e._filterFunction&&e._filterFunction(a)},h=document.createElement("div");h.className="filter-box-icon",this.container.insertBefore(h,d.nextSibling);var i=document.createElement("div");i.className="filter-box-close",i.addEventListener("click",function(){f()}),this.container.appendChild(i),d.addEventListener("keydown",function(a){a=a||window.event,13===a.keyCode&&e.filterbox.blur()}),d.addEventListener("input",function(a){g(this.value)}),d.addEventListener("change",function(a){g(this.value)}),d.addEventListener("focus",function(){h.classList.add("focused")}),d.addEventListener("blur",function(){h.classList.remove("focused")})}var b=Autodesk.Viewing,c=Autodesk.Viewing.UI;a.prototype=Object.create(c.Control.prototype),a.prototype.constructor=a,Autodesk.Viewing.UI.Filterbox=a}(),function(){"use strict";function a(a){var b=a.target,c=this._getNodeAndModelIds(b);c&&(this.fireEvent({type:p.Searchbox.Events.ON_SEARCH_SELECTED,id:c.nodeId,modelId:c.modelId}),a.preventDefault())}function b(a){var b=this.container.results.scrollTop;Math.abs(this.scrollY-b)>=s&&(this.scrollY=b,c(this))}function c(a,b){a.dirty&&!b||(b?d(a):(a.dirty=!0,a.nextFrameId=requestAnimationFrame(function(){d(a)})))}function d(a){if(a.dirty=!1,e(a),0===a.resultCount)return void a.setDisplayNoResults(!0);a.setDisplayNoResults(!1),f(a)}function e(a){for(var b=a.elementsUsed,c=a.elementsPool,d=0;d<b;++d){l(c[d])}a.elementsUsed=0}function f(a){var b=a.container.results,c=0,d=b.clientHeight,e=a.scrollY,f=a.it.init(a.results),g=Math.max(0,a.scrollY-s),h=0|Math.floor(g/r),j=0;for(c=h*r;h;)h--,j++,f.next();var k=a.elementsPool[a.elementsUsed++];k.style.height=c+"px",a.scrollingContainer.appendChild(k);for(var l=!0;l;){if(f.next(),f.done()){l=!1;break}if(c>e+d+s){l=!1;break}if(a.elementsUsed===a.elementsPool.length){l=!1;break}var m=f.id(),n=f.delegate(),o=r,p=c,q=p+o,t=a.elementsPool[a.elementsUsed++];i(m,n,t,a,j===a.selectedIndex),a.scrollingContainer.appendChild(t),c=q,j++}var u=a.resultCount*r;a.scrollingContainer.style.height=u+"px"}function g(a){for(var b=0,c=0;c<a.length;++c){b+=a[c].ids.length}return b}function h(){return{init:function(a){return this.isDone=!1,this.results=a,this.indexRs=0,this.indexId=-1,this},done:function(){return this.isDone},next:function(){if(this.isDone)return this;for(this.indexId++;this.results.length!==this.indexRs&&this.indexId===this.results[this.indexRs].ids.length;)this.indexId=0,this.indexRs++;return this.isDone=this.indexRs===this.results.length,this},id:function(){return this.results[this.indexRs].ids[this.indexId]},delegate:function(){return this.results[this.indexRs].delegate}}}function i(a,b,c,d,e){c.classList.add("search-result"),e?c.classList.add("selected"):c.classList.remove("selected"),c.setAttribute("lmv-nodeId",a),c.setAttribute("lmv-modelId",b.model.id),c.style.height=r+"px";var f=b.instanceTree.getNodeName(a),g=d.searchString,h=f.toLowerCase().indexOf(g.toLowerCase()),i=f.substr(0,h),k=f.substr(h,g.length),l=f.substr(h+g.length);c.domPrefix.innerText=i,c.domMatch.innerText=k,c.domSufix.innerText=l;var m=j(a,b,d);c.domPath.innerText=m.join(" > ")}function j(a,b,c){for(var d=[],e=b.getRootId(),f=c.isRootExcluded(),g=b.instanceTree,h=a,i=!1;h&&!i&&(h!==e||(i=!0,!f));){var j=g.getNodeName(h);d.unshift(j),h=g.getNodeParentId(h)}return d}function k(){var a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("span"),d=document.createElement("span"),e=document.createElement("span"),f=document.createElement("span");return b.classList.add("search-result-container"),d.classList.add("search-match"),f.classList.add("search-path"),b.appendChild(c),b.appendChild(d),b.appendChild(e),b.appendChild(f),a.appendChild(b),a.domPrefix=c,a.domMatch=d,a.domSufix=e,a.domPath=f,a.domContainer=b,a}function l(a){a.setAttribute("lmv-nodeId",""),a.setAttribute("lmv-modelId",""),a.domPrefix.innerText="",a.domMatch.innerText="",a.domSufix.innerText="",a.domPath.innerText="",a.style.height="0"}function m(){var a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("div");a.classList.add("no-results-container"),a.style.display="none";b.setAttribute("data-i18n","No Results"),b.textContent=Autodesk.Viewing.i18n.translate("No Results"),b.classList.add("no-results-title");return c.setAttribute("data-i18n","Try another term"),c.textContent=Autodesk.Viewing.i18n.translate("Try another term"),c.classList.add("no-results-description"),a.appendChild(b),a.appendChild(c),a.domTitle=b,a.domMessage=c,a}function n(a,b){a.scrollTop+a.clientHeight<(b+1)*r&&(a.scrollTop+=(b+1)*r-(a.scrollTop+a.clientHeight)),a.scrollTop/r>b&&(a.scrollTop=b*r)}var o=Autodesk.Viewing,p=Autodesk.Viewing.UI,q=Autodesk.Viewing.Private,r=50,s=100,t=function(c,d,e){this.excludeRoot=d,this.viewer=e,this.results=[],this.resultCount=0,this.selectedIndex=-1,this.container=document.createElement("div"),this.container.classList.add("docking-panel"),this.container.classList.add("adsk-search-results"),this.container.results=document.createElement("div"),this.container.results.classList.add("docking-panel-scroll"),this.container.results.classList.add("docking-panel-container-solid-color-b"),this.container.results.addEventListener("scroll",b.bind(this)),this.container.appendChild(this.container.results),c.insertBefore(this.container,c.firstChild),this.scrollingContainer=document.createElement("div"),this.scrollingContainer.classList.add("adsk-search-results-scrolling-panel"),this.scrollingContainer.addEventListener("click",a.bind(this)),this.container.results.appendChild(this.scrollingContainer),this.footer=new q.ResizeFooter(this.container,function(){var a=this.container.getBoundingClientRect(),b=this.viewer.container.getBoundingClientRect();b.right<a.right&&(this.container.style.width=b.right-a.left+"px"),b.bottom<a.bottom&&(this.container.style.height=b.bottom-a.top+"px")}.bind(this)),this.divNoResults=m(),this.scrollingContainer.appendChild(this.divNoResults),this.scrollY=0,this.dirty=!1,this.nextFrameId=0,this.it=h(),this.elementsPool=[],this.elementsUsed=0;for(var f=0;f<150;++f)this.elementsPool[f]=k();this.setVisible(!1)};t.prototype.constructor=t,o.EventDispatcher.prototype.apply(t.prototype),t.prototype.setPosition=function(a,b){this.container.style.left=a+"px",this.container.style.top=b+"px"},t.prototype.setMinWidth=function(a){this.container.style.width=a+"px"},t.prototype.setMaxWidth=function(a){this.container.style.maxHeight=a+"px"},t.prototype.setVisible=function(a){this.container.style.display=a?"":"none"},t.prototype.setResults=function(a,b){this.searchString=a,this.results=b,this.resultCount=g(b),this.selectedIndex=0==this.resultCount?-1:0,this.container.style.height=this.resultCount*r+20+"px",this.container.results.scrollTop=0,this.scrollY=0,0===this.resultCount?this.container.classList.add("no-content"):this.container.classList.remove("no-content"),c(this)},t.prototype.getSelection=function(){var a=this.scrollingContainer.querySelector(".selected");if(!a)return null;var b=this._getNodeAndModelIds(a);return b||null},t.prototype.isRootExcluded=function(){return!(this.results&&this.results.length>1)&&(!(this.modelCount>1)&&this.excludeRoot)},t.prototype.uninitialize=function(){this.setVisible(!1),this.container=null,this.container.parentNode&&this.container.parentNode.removeChild(this.container),cancelAnimationFrame(this.nextFrameId),this.clearListeners()},t.prototype.setDisplayNoResults=function(a){this.divNoResults.style.display=a?"":"none"},t.prototype.selectNext=function(){0!==this.resultCount&&(this.selectedIndex=Math.min(this.resultCount-1,this.selectedIndex+1),n(this.container.results,this.selectedIndex),c(this))},t.prototype.selectPrevious=function(){0!==this.resultCount&&(this.selectedIndex=Math.max(0,this.selectedIndex-1),n(this.container.results,this.selectedIndex),c(this))},t.prototype._getNodeAndModelIds=function(a){for(;!a.hasAttribute("lmv-nodeId");)if(!(a=a.parentNode)||a===this.scrollingContainer)return;return{nodeId:parseInt(a.getAttribute("lmv-nodeId")),modelId:parseInt(a.getAttribute("lmv-modelId"))}},p.SearchResults=t}(),function(){"use strict";Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.Wireframes","extensions/Wireframes/Wireframes.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.ZoomWindow","extensions/ZoomWindow/ZoomWindow.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.MarkupsCore","extensions/Markups/Markups.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.MarkupsGui","extensions/Markups/MarkupsGui.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.WebVR","extensions/WebVR/WebVR.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.MemoryManager","extensions/MemoryManager/MemoryManager.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Beeline","extensions/Beeline/Beeline.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.FirstPerson","extensions/FirstPerson/FirstPerson.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.BimWalk","extensions/BimWalk/BimWalk.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.ScalarisSimulation","extensions/ScalarisSimulation/ScalarisSimulation.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Debug","extensions/Debug/Debug.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.ModelStructure","extensions/ModelStructure/ModelStructure.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.LayerManager","extensions/LayerManager/LayerManager.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.ViewerSettings","extensions/ViewerSettings/ViewerSettings.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.PropertiesManager","extensions/PropertiesManager/PropertiesManager.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.FullScreen","extensions/FullScreen/FullScreen.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Explode","extensions/Explode/Explode.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Section","extensions/Section/Section.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Measure","extensions/Measure/Measure.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Hyperlink","extensions/Hyperlink/Hyperlink.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.PixelCompare","extensions/PixelCompare/PixelCompare.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Moldflow","extensions/Moldflow/Moldflow.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.AEC.LevelsExtension","extensions/AEC/AEC.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.AEC.HyperlinkExtension","extensions/AEC/AEC.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.BIM360.Extension.PushPin","extensions/PushPin/PushPin.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.SplitScreen","extensions/SplitScreen/SplitScreen.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.AEC.DropMeExtension","extensions/AEC/AEC.min.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.AEC.CanvasBookmarkExtension","extensions/AEC/AEC.min.js")}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.name="cam360"}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a,a.prototype.load=function(){function a(){c.impl.setLightPreset(0,!0),c.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a)}var c=this.viewer,d=new b.CAMModelStructurePanel(this.viewer,"CAM Model Structure Loading",{});return c.setModelStructurePanel(d),c.hideLines(!1),c.setGhosting(!1),c.setQualityLevel(!1,!0),c.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a),!0},a.prototype.unload=function(){this.viewer.setModelStructurePanel(null)},a.prototype.activate=function(){return this.activeStatus||(this.viewer.showModelStructurePanel(!0),this.activeStatus=!0),!0},a.prototype.deactivate=function(){return this.activeStatus&&(this.viewer.showModelStructurePanel(!1),this.activeStatus=!1),!0},b.CAM360Extension=a,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.CAM360",b.CAM360Extension)}(),function(){"use strict";function a(a,b,d){c.ViewerModelStructurePanel.call(this,a,b,d),this.viewer=a,this.delegate=null,this.instanceTree=null,this.model=null,this.camNodes=[],this.camModelNodes=[],this.camSetupNodes=[],this.camStockNodes=[],this.camOperationNodes=[],this.camToolNodes=[],this.camFolderNodes=[]}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360"),c=Autodesk.Viewing.Extensions;a.prototype=Object.create(c.ViewerModelStructurePanel.prototype),a.prototype.constructor=a,a.prototype.sortCamNodes=function(a,b){function c(a,b){function c(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(d.displayName===b)return d.displayValue}return null}function d(d){var f=c(d.properties,"9429B915-D020-4CEB-971B-6ADD0A5D4BFA");f?("CAM_Setup"==f?e.camSetupNodes.push(a):"CAM_Operation"==f?e.camOperationNodes.push(a):"CAM_Tool"===f?e.camToolNodes.push(a):"CAM_Stock"===f?e.camStockNodes.push(a):"CAM_Folder"==f&&e.camFolderNodes.push(a),e.camNodes.push(a)):e.camModelNodes.push(a),b()}function f(a,c,d){b()}e.viewer.getProperties(a,d,f)}function d(){f.length>0?c(f.shift(),d):b()}var e=this,f=[];a.enumNodeChildren(a.getRootId(),function(a){f.push(a)},!0),f.shift(),d()},a.prototype.addModel=function(a){this.model=a,this.setVisible(!0),c.ViewerModelStructurePanel.prototype.addModel.call(this,a)},a.prototype.setInstanceTree=function(a,b){if(c.ViewerModelStructurePanel.prototype.setInstanceTree.call(this,a,b),b){this.delegate=a,this.instanceTree=b;var d=this;d.sortCamNodes(b,function(){d.SetCAMNodeVisible(!1),d.setVisible(!0),d.ExpandSetupNodes(),d.resizeToContent()})}},a.prototype.initialize=function(){function a(c){b.SetCAMNodeVisible(!1),b.removeEventListener(b.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a)}c.ViewerModelStructurePanel.prototype.initialize.call(this);var b=this;this.viewer.model&&this.viewer.model.isLoadDone()||b.addEventListener(b.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a),b.addEventListener(b.viewer,Autodesk.Viewing.SHOW_EVENT,function(a){var c=a.nodeIdArray;if(c)for(var d=0;d<c.length;d++)b.setCamNodeVisibility(c[d])}),b.addEventListener(b.viewer,Autodesk.Viewing.SELECTION_CHANGED_EVENT,function(a){var c=a.nodeArray;if(c)for(var d=0;d<c.length;d++)b.HideHightlightCAMNode(c[d])}),b.addEventListener(b.viewer,Autodesk.Viewing.ISOLATE_EVENT,function(a){var c=a.nodeIdArray;if(c)if(0==c.length)b.SetModelVisible(),b.SetCAMNodeVisible(!0);else for(var d=0;d<c.length;d++)b.setCamNodeVisibility(c[d])})},a.prototype.IsCAMNode=function(a){return-1!==this.camNodes.indexOf(a)},a.prototype.IsCAMSetupNode=function(a){return-1!==this.camSetupNodes.indexOf(a)},a.prototype.IsCAMStockNode=function(a){return-1!==this.camStockNodes.indexOf(a)},a.prototype.IsCAMToolNode=function(a){return-1!==this.camToolNodes.indexOf(a)},a.prototype.IsCAMOperationNode=function(a){return-1!==this.camOperationNodes.indexOf(a)},a.prototype.IsCAMFolderNode=function(a){return-1!==this.camFolderNodes.indexOf(a)},a.prototype.shouldInclude=function(a){return!this.IsCAMStockNode(a)},a.prototype.isGroupNode=function(a){return!this.IsCAMOperationNode(a)&&c.ViewerModelStructurePanel.prototype.isGroupNode.call(this,a)},a.prototype.setNodeVisibility=function(a,b){b?this.viewer.show(a):this.viewer.hide(a)},a.prototype.SetModelVisible=function(){if(this.camModelNodes)for(var a=0;a<this.camModelNodes.length;a++)this.setNodeVisibility(this.camModelNodes[a],!0)},a.prototype.SetCAMNodeVisible=function(a){if(this.camNodes){for(var b=0;b<this.camNodes.length;b++)this.setNodeVisibility(this.camNodes[b],a);this.SetToolNodeVisible(!1)}},a.prototype.SetToolNodeVisible=function(a){if(this.camToolNodes)for(var b=0;b<this.camToolNodes.length;b++)this.setNodeVisibility(this.camToolNodes[b],a)},a.prototype.HideHightlightNode=function(a){var b=this.viewer.impl,c=this;c.instanceTree.enumNodeFragments(a,function(a){b.highlightFragment(c.model,a,!1)},!0)},a.prototype.HideHightlightCAMNode=function(a){var b=this.IsCAMSetupNode(a),c=this.IsCAMOperationNode(a),d=this.IsCAMFolderNode(a),e=this;e.instanceTree.enumNodeChildren(a,function(a){b?e.IsCAMStockNode(a)||e.HideHightlightNode(a):c?e.IsCAMToolNode(a)&&e.HideHightlightNode(a):d&&e.HideHightlightNode(a)},!1)},a.prototype.setCamNodeVisibility=function(a){var b=this.IsCAMSetupNode(a),c=this.IsCAMOperationNode(a),d=this.IsCAMFolderNode(a),e=this;b?this.instanceTree.enumNodeChildren(a,function(a){var b=e.IsCAMStockNode(a);e.setNodeVisibility(a,b)}):c?this.instanceTree.enumNodeChildren(a,function(a){e.IsCAMToolNode(a)&&e.setNodeVisibility(a,!1)}):d&&this.instanceTree.enumNodeChildren(a,function(a){e.setNodeVisibility(a,!1)})},a.prototype.onClick=function(a,b){c.ViewerModelStructurePanel.prototype.onClick.call(this,a,b),this.SetModelVisible(),this.setCamNodeVisibility(a),this.viewer.fitToView()},a.prototype.ExpandSetupNodes=function(){if(this.camSetupNodes)for(var a=0;a<this.camSetupNodes.length;a++)this.tree.setCollapsed(this.delegate,this.camSetupNodes[a],!1)},b.CAMModelStructurePanel=a}(),function(){"use strict";function a(a){var b="";a<0&&(b="-",a=-a);var c=~~(a/3600),d=~~(a%3600/60),e=a%60,f=b;return c>0&&(f+=c+":"+(d<10?"0":"")),f+=d+":"+(e<10?"0":""),f+=e.toFixed(2)}var b=Autodesk.Viewing,c=b.UI;b.ANIMATION_PLAY_EVENT="animationPlayEvent",b.ANIMATION_PAUSE_EVENT="animationPauseEvent",b.ANIMATION_SEEK_EVENT="animationSeekEvent",b.ANIMATION_PREVIOUS_FRAME_EVENT="animationPreviousFrameEvent",b.ANIMATION_NEXT_FRAME_EVENT="animationNextFrameEvent",b.ANIMATION_TRACK_UPDATE_EVENT="animationTrackUpdateEvent",b.ANIMATION_TOOLBAR_CLOSE_EVENT="animationToolbarCloseEvent";var d=function(a,c){b.Extension.call(this,a,c),this.viewer=a,this.animTools=null,this.animToolsId="animationTools",this.playButton=null,this.playButtonIsPaused=!0,this.prevAnimationTime=-1,this.name="fusionanimation"};d.prototype=Object.create(b.Extension.prototype),d.prototype.constructor=d,d.prototype.load=function(){var a=this.viewer
;return this.onPlayCallbackBinded=this.onPlayCallback.bind(this),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onExplodeBinded=this.onExplode.bind(this),this.onResizeBinded=this.onResize.bind(this),this.onEscapeBinded=this.onEscape.bind(this),a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),a.addEventListener(Autodesk.Viewing.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),a.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded),a.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,this.onEscapeBinded),a.model&&a.model.isObjectTreeCreated()?this.onAnimationReady():(this.onAnimationReadyBinded=this.onAnimationReady.bind(this),a.addEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded)),!0},d.prototype.unload=function(){var a=this.viewer;if(this.onAnimationReadyBinded&&(a.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),this.rewind(),a.impl.invalidate(!0,!0,!0),this.onPlayCallbackBinded=null,this.animTools&&(this.animTools.removeControl(this.animTools.timeText.getId()),this.animTools.removeControl(this.animTools.timeline.getId()),this.animTools.removeControl(this.animTools.timeLeftText.getId()),this.animTools.removeControl(this.animTools.forwardButton.getId()),this.animTools.removeControl(this.animTools.backwardButton.getId()),this.animTools.removeControl(this.animTools.closeButton.getId())),this.toolbar&&(this.toolbar.removeControl(this.animTools),this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.playButton){var c=a.getToolbar(!1);c&&c.getControl(b.TOOLBAR.MODELTOOLSID).removeControl(this.playButton.getId())}return a.removeEventListener(b.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),a.removeEventListener(b.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),a.removeEventListener(b.VIEWER_RESIZE_EVENT,this.onResizeBinded),a.removeEventListener(b.ESCAPE_EVENT,this.onEscapeBinded),this.onToolbarCreatedBinded&&(a.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),!0},d.prototype.play=function(){if(!this.isPlaying()){this.resetExplode(0,!0);var a=this.viewer,b=a.impl.keyFrameAnimator;b&&(this.prevAnimationTime>0&&(b.goto(this.prevAnimationTime),this.prevAnimationTime=-1),b.play(0,this.onPlayCallbackBinded),this.updatePlayButton(b.isPaused),this.animTools&&(this.animTools.setVisible(!0),this.animTools.isPositionAdjusted||(this.adjustToolbarPosition(),this.animTools.isPositionAdjusted=!0)))}},d.prototype.pause=function(){if(!this.isPaused()){var a=this.viewer.impl.keyFrameAnimator;a&&(a.pause(),this.updatePlayButton(a.isPaused))}},d.prototype.isPlaying=function(){var a=this.viewer.impl.keyFrameAnimator;return!!a&&(a.isPlaying&&!a.isPaused)},d.prototype.isPaused=function(){var a=this.viewer.impl.keyFrameAnimator;return!!a&&a.isPaused},d.prototype.rewind=function(){this.setTimelineValue(0)},d.prototype.setTimelineValue=function(a){var b=this.viewer.impl.keyFrameAnimator;if(b){a=Math.min(Math.max(0,a),1);var c=a*b.duration;b.goto(c),this.updateUI()}},d.prototype.prevKeyframe=function(){var a=this.viewer.impl.keyFrameAnimator;a&&(a.prev(),this.updateUI())},d.prototype.nextKeyframe=function(){var a=this.viewer.impl.keyFrameAnimator;a&&(a.next(),this.updateUI())},d.prototype.getDuration=function(){var a=this.viewer.impl.keyFrameAnimator;return a?a.duration:0},d.prototype.getDurationLabel=function(){return a(this.getDuration())},d.prototype.getCurrentTime=function(){var a=this.viewer.impl.keyFrameAnimator;return a?a.currentTime:0},d.prototype.getCurrentTimeLabel=function(){return a(this.getCurrentTime())},d.prototype.onAnimationReady=function(){var a=this.viewer;this.onAnimationReadyBinded&&(a.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),a.impl.keyFrameAnimator&&(a.toolbar&&a.modelTools?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),a.addEventListener(b.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)))},d.prototype.updateUI=function(){var b=this.viewer.impl.keyFrameAnimator;this.animTools&&b&&(this.animTools.input.value=b.duration>0?b.currentTime/b.duration*100:0,this.animTools.lapse.value=a(b.currentTime),this.animTools.lapseLeft.value=a(b.duration),this.updatePlayButton(b.isPaused),this.updateToolbarBackground())},d.prototype.onPlayCallback=function(c){if(this.animTools){var d=this.viewer.impl.keyFrameAnimator;this.viewer.dispatchEvent({type:b.ANIMATION_TRACK_UPDATE_EVENT,data:{time:d.currentTime,duration:d.duration}}),this.animTools.input.value=c,this.animTools.lapse.value=a(d.currentTime),this.animTools.lapseLeft.value=a(d.duration),c>=100&&this.updatePlayButton(!0),this.updateToolbarBackground()}},d.prototype.updatePlayButton=function(a){if(this.playButton&&a!==this.playButtonIsPaused){this.playButtonIsPaused=a;var c=this.viewer.impl.keyFrameAnimator;a?(this.playButton.setIcon("toolbar-animation-play-icon"),this.playButton.setToolTip("Play"),this.viewer.dispatchEvent({type:b.ANIMATION_PAUSE_EVENT,data:{time:c.currentTime,duration:c.duration}})):(this.playButton.setIcon("toolbar-animation-pause-icon"),this.playButton.setToolTip("Pause"),this.viewer.dispatchEvent({type:b.ANIMATION_PLAY_EVENT,data:{time:c.currentTime,duration:c.duration}}))}},d.prototype.resetExplode=function(a,b){var c=this.viewer;c.model.is2d()||0===c.getExplodeScale()||(b&&c.explodeSlider&&(c.explodeSlider.value=a),c.explode(a))},d.prototype.adjustToolbarPosition=function(){var a=this.viewer;if(a.toolbar){var b=a.toolbar.getDimensions().width;b>a.container.getBoundingClientRect().width&&(b=a.modelTools.getDimensions().width);var c=b-(2*this.animTools.backwardButton.getDimensions().width+3*this.animTools.timeText.getDimensions().width+this.animTools.closeButton.getDimensions().width+20);this.animTools.input.style.width=c+"px"}},d.prototype.hideAnimateToolbar=function(){this.animTools&&this.animTools.setVisible(!1)},d.prototype.updateToolbarBackground=function(){if(this.animTools){var a=this.animTools.input,b=a.value,c="#393939";a.style.background="-webkit-linear-gradient(left,#ffffff "+b+"%, "+c+" "+b+"%)",a.style.background="-moz-linear-gradient(left,#ffffff "+b+"%, "+c+" "+b+"%)",a.style.background="-ms-linear-gradient(left,#ffffff "+b+"%, "+c+" "+b+"%)",a.style.background="-o-linear-gradient(left,#ffffff "+b+"%, "+c+" "+b+"%)",a.style.background="linear-gradient(to right,#ffffff "+b+"%, "+c+" "+b+"%)"}},d.prototype.onCameraChange=function(){if(this.viewer.toolController.cameraUpdated){var a=this.viewer.impl.keyFrameAnimator;if(!a)return;a.isPlaying&&!a.isPaused&&(a.pause(),this.updatePlayButton(a.isPaused))}},d.prototype.onResize=function(){this.toolbar&&(this.viewer.container.clientWidth<(b.isTouchDevice()?560:600)?this.toolbar.setCollapsed(!0):(this.toolbar.setCollapsed(!1),this.adjustToolbarPosition()))},d.prototype.onEscape=function(){this.isPlaying()?this.pause():this.hideAnimateToolbar()},d.prototype.onExplode=function(){var a=this.viewer.impl.keyFrameAnimator;a&&(0!==a.currentTime&&(this.prevAnimationTime=a.currentTime,a.goto(0)),this.updatePlayButton(!0)),this.hideAnimateToolbar()},d.prototype.onToolbarCreated=function(){var d=this.viewer,e=this;this.onToolbarCreatedBinded&&(d.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.toolbar=new c.ToolBar("animation-toolbar"),this.toolbar.addClass("toolbar-animation-subtoolbar"),d.container.appendChild(this.toolbar.container),this.animTools=new c.ControlGroup(this.animToolsId),this.animTools.setVisible(!1),this.toolbar.addControl(this.animTools),this.playButton=new c.Button("toolbar-animationPlay"),this.playButton.setIcon("toolbar-animation-play-icon"),this.playButton.setToolTip("Play"),this.playButton.onClick=function(){e.isPaused()?e.activate():e.deactivate()},d.modelTools.addControl(this.playButton),d.modelTools.resetModelButton&&(d.modelTools.resetModelButton.onClick=function(b){d.showAll();var c=d.impl.keyFrameAnimator;c&&(c.goto(0),g.value=0,f.value=a(0),i.value=a(c.duration),e.updatePlayButton(!0)),e.resetExplode(0,!0),e.updateToolbarBackground()}),this.animTools.backwardButton=new c.Button("toolbar-animationBackward"),this.animTools.backwardButton.setToolTip("Previous keyframe"),this.animTools.backwardButton.onClick=function(a){var c=d.impl.keyFrameAnimator;void 0!==c&&c&&(c.prev(),d.dispatchEvent({type:b.ANIMATION_PREVIOUS_FRAME_EVENT,data:{time:c.currentTime,duration:c.duration}}),e.updateUI())},this.animTools.backwardButton.addClass("toolbar-animation-button"),this.animTools.backwardButton.setIcon("toolbar-animation-backward-icon"),this.animTools.addControl(this.animTools.backwardButton),this.animTools.forwardButton=new c.Button("toolbar-animationForward"),this.animTools.forwardButton.setToolTip("Next keyframe"),this.animTools.forwardButton.onClick=function(a){var c=d.impl.keyFrameAnimator;void 0!==c&&c&&(c.next(),d.dispatchEvent({type:b.ANIMATION_NEXT_FRAME_EVENT,data:{time:c.currentTime,duration:c.duration}}),e.updateUI())},this.animTools.forwardButton.addClass("toolbar-animation-button"),this.animTools.forwardButton.setIcon("toolbar-animation-forward-icon"),this.animTools.addControl(this.animTools.forwardButton),this.animTools.timeText=new c.Control("toolbar-animation-time-lapse");var f=this.animTools.lapse=document.createElement("input");f.type="text",f.value="0",f.className="animation-time-lapse",f.disabled=!0,this.animTools.timeText.container.appendChild(f),this.animTools.timeText.addClass("toolbar-animation-button"),this.animTools.addControl(this.animTools.timeText),this.animTools.timeline=new c.Control("toolbar-animation-timeline");var g=this.animTools.input=document.createElement("input");g.type="range",g.value="0",g.className="animation-timeline",b.isIE11&&(g.style["padding-top"]="0",g.style["padding-bottom"]="0",g.style["margin-top"]="10px"),this.animTools.timeline.container.appendChild(g),g.addEventListener(b.isIE11?"change":"input",function(c){var h=d.impl.keyFrameAnimator;if(void 0!==h&&h){var j=g.value*h.duration/100;f.value=a(j),i.value=a(h.duration),h.goto(j),d.dispatchEvent({type:b.ANIMATION_SEEK_EVENT,data:{time:j,duration:h.duration}}),e.updatePlayButton(h.isPaused),e.updateToolbarBackground()}});var h=document.createElement("div");h.className="adsk-control-tooltip",h.textContent=Autodesk.Viewing.i18n.translate("Click-drag to scrub"),this.animTools.timeline.container.appendChild(h),g.addEventListener("mouseover",function(a){a.target===g&&(h.style.visibility="visible")}),g.addEventListener("mouseout",function(a){a.target===g&&(h.style.visibility="hidden")}),this.animTools.timeline.addClass("toolbar-animation-button"),this.animTools.timeline.addClass("toolbar-animation-timeline"),this.animTools.addControl(this.animTools.timeline),this.animTools.timeLeftText=new c.Control("toolbar-animationRemainingTime");var i=this.animTools.lapseLeft=document.createElement("input");i.type="text",i.value="0",i.className="animation-time-lapse",i.disabled=!0,this.animTools.timeLeftText.container.appendChild(i),this.animTools.timeLeftText.addClass("toolbar-animation-button"),this.animTools.addControl(this.animTools.timeLeftText),this.animTools.closeButton=new c.Button("toolbar-animation-Close"),this.animTools.closeButton.addClass("docking-panel-close"),this.animTools.closeButton.addClass("toolbar-animation-button"),this.animTools.closeButton.addClass("toolbar-animation-close-button"),this.animTools.closeButton.onClick=function(){e.hideAnimateToolbar(),d.dispatchEvent({type:b.ANIMATION_TOOLBAR_CLOSE_EVENT})},this.animTools.addControl(this.animTools.closeButton)},d.prototype.activate=function(){return this.play(),!0},d.prototype.deactivate=function(){return this.pause(),!0},d.prototype.isActive=function(){return this.isPlaying()},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360"),Autodesk.Viewing.Extensions.Fusion360.AnimationExtension=d,b.theExtensionManager.registerExtension("Autodesk.Fusion360.Animation",d)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var a=Autodesk.Viewing,b=a.Private,c=a.Extensions,d=c.Collaboration;d.InteractionInterceptor=function(a){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(a){},this.deactivate=function(a){},this.update=function(a){return!1},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a,b){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(b){return a.takeControl(),!1},this.handleButtonDown=function(b,c){return a.takeControl(),!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(b){return a.updatePointer(b),!1},this.handleGesture=function(b){return a.takeControl(),!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}},d.ViewTransceiver=function(c){function d(a){p=!0;var b=JSON.parse(a.data.msg);w.restoreState(b),o.impl.invalidate(!0,!1,!0),p=!1}function e(a){return Math.round(1e3*a)/1e3}function f(a){for(var b=0;b<a.length;b++)a[b]=e(a[b])}function g(a){var b=a.data.msg;!0===b[1]||r||(b[0]!=m&&(m=b[0],a.data.lastInControl=b[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:a.data})),q=!1,o.navigation.setView((new THREE.Vector3).set(b[2],b[3],b[4]),(new THREE.Vector3).set(b[5],b[6],b[7])),o.navigation.setCameraUpVector((new THREE.Vector3).set(b[8],b[9],b[10])))}function h(a){if(q||r){var b=a.camera,d=[b.position.x,b.position.y,b.position.z,b.target.x,b.target.y,b.target.z,b.up.x,b.up.y,b.up.z];f(d),d.unshift(r),d.unshift(c.getLocalId()),s.sendMessage("camera",d,n.channelId),m!=d[0]&&(m=d[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:{lastInControl:m}}))}}function i(a,b,c){a&&!u&&(u=document.createElement("div"),u.classList.add("collabPointer")),a&&!v?(o.container.appendChild(u),v=!0):!a&&v&&(o.container.removeChild(u),v=!1),a&&(u.style.left=b-6+"px",u.style.top=c-6+"px")}function j(a){if(!q&&!r){var b=a.data.msg;t.origin.set(b[1],b[2],b[3]),t.direction.set(b[4],b[5],b[6]);var c=t.at(o.getCamera().near);c.project(o.getCamera()),c=o.impl.viewportToClient(c.x,c.y),i(!0,c.x,c.y)}}function k(a){if(q){var b=o.impl.clientToViewport(a.canvasX,a.canvasY);o.impl.viewportToRay(b,t);var d=[t.origin.x,t.origin.y,t.origin.z,t.direction.x,t.direction.y,t.direction.z];f(d),d.unshift(c.getLocalId()),s.sendMessage("pointer",d,n.channelId)}}function l(a){if(!p){var b=w.getState(x);c.sendMessage("state",JSON.stringify(b),n.channelId)}}var m,n=this,o=this.viewer=null,p=!1,q=!1,r=!1,s=this.client=c,t=new THREE.Ray,u=null,v=!1;this.channelId=null;var w,x={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};this.takeControl=function(){q=!0,i(!1)},this.updatePointer=function(a){k(a)},this.connectCamera=function(a){r=!a},this.attach=function(c){o&&this.detach(),this.viewer=o=c,w=new b.ViewerState(o),s.addEventListener("cameraChange",g),s.addEventListener("pointerMove",j),s.addEventListener("viewerState",d),o.hasEventListener(a.CAMERA_CHANGE_EVENT,h)||o.addEventListener(a.CAMERA_CHANGE_EVENT,h),o.hasEventListener(a.SELECTION_CHANGED_EVENT,l)||(o.addEventListener(a.SELECTION_CHANGED_EVENT,l),o.addEventListener(a.ISOLATE_EVENT,l),o.addEventListener(a.HIDE_EVENT,l),o.addEventListener(a.SHOW_EVENT,l),o.addEventListener(a.EXPLODE_CHANGE_EVENT,l),o.addEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,l),o.addEventListener(a.CUTPLANES_CHANGE_EVENT,l))},this.detach=function(){s&&(s.removeEventListener("cameraChange",g),s.removeEventListener("viewerState",d)),o&&(o.removeEventListener(a.CAMERA_CHANGE_EVENT,h),o.removeEventListener(a.SELECTION_CHANGED_EVENT,l),o.removeEventListener(a.ISOLATE_EVENT,l),o.removeEventListener(a.HIDE_EVENT,l),o.removeEventListener(a.SHOW_EVENT,l),o.removeEventListener(a.EXPLODE_CHANGE_EVENT,l),o.removeEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,l),o.removeEventListener(a.CUTPLANES_CHANGE_EVENT,l),this.viewer=o=null,w=null)}},d.ViewTransceiver.prototype.constructor=d.ViewTransceiver,Autodesk.Viewing.EventDispatcher.prototype.apply(d.ViewTransceiver.prototype)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var a=Autodesk.Viewing,b=a.Extensions,c=a.Private,d=a.UI,e=b.Collaboration;b.Collaboration.Collaboration=function(b,c){a.Extension.call(this,b,c),c&&c.rtc&&c.rtc.disableRTCToolbarButton&&(this.disableRTCToolbarButton=!0),this.name="collaboration"},b.Collaboration.Collaboration.prototype=Object.create(a.Extension.prototype),b.Collaboration.Collaboration.prototype.constructor=b.Collaboration.Collaboration;var f=b.Collaboration.Collaboration.prototype;f.initNetwork=function(a){this.viewtx&&!a||(this.viewtx=new e.ViewTransceiver(this.client),this.interceptor=new e.InteractionInterceptor(this.viewtx),this.viewer.toolController.registerTool(this.interceptor))},f.createUI=function(){var a=this,f=this.viewer;if(this.initNetwork(!1),this.panel=new e.DockingCollabPanel(this.viewer,this.client,this.viewtx),b.Collaboration.Collaboration.Panel=this.panel,this.collabButton=new d.Button("toolbar-collaborateTool"),this.collabButton.setToolTip("Live review"),this.collabButton.setIcon("adsk-icon-live-review"),this.collabButton.onClick=function(b){var c=a.panel.isVisible();document.getElementById("collabBox")||(c||a.inviteDivInstantiated||a.activeStatus?a.deactivate():a.activate())},this.disableRTCToolbarButton&&this.collabButton.setVisible(!1,!0),this.panel.addVisibilityListener(function(b){if(b){if(f.model){var e=f.model.getData();a.viewtx.channelId=e.basePath,a.viewtx.attach(f),a.client.connect(a.viewtx.channelId),a.client.join(a.viewtx.channelId)}f.toolController.activateTool(a.interceptor.getName());a.collabButton.setState(d.Button.State.ACTIVE),c.logger.track({category:"viewer_rtc_start"})}else c.logger&&a.client.isConnected()&&c.logger.track({category:"viewer_rtc_stop"}),a.viewtx.detach(f),a.viewtx.channelId=null,a.client.disconnect(),a.panel.reset(),f.toolController.deactivateTool(a.interceptor.getName()),a.collabButton.setState(d.Button.State.INACTIVE)}),f.modelTools.addControl(this.collabButton),Autodesk.Viewing.Private.getParameterByName("invited")){var g=new CollabPromptBox,h=f.container;g.start(h,function(){a.panel.setVisible(!0,!0)},"Join a Live Review","Join Review")}},f.close=function(){this.panel.setVisible(!1,!0),this.panel.reset()},f.load=function(){function a(){function a(c){b.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a),d.createUI()}d.client=c.MessageClient.GetInstance(d.options?d.options.messageServerURL:void 0),d.socketErrorHandler=function(a){c.ErrorHandler.reportError(b.container,Autodesk.Viewing.ErrorCodes.RTC_ERROR,a.data),d.close()},d.client.addEventListener("socketError",d.socketErrorHandler),d.presenceChannelId=window.location.host,d.client.isConnected(),b.modelTools?d.createUI():b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a)}var b=this.viewer,d=this;return c.loadDependency("lmv_io","socket.io-1.3.5.js",a),!0},f.unload=function(){var a=this.viewer;return this.client.removeEventListener("socketError",this.socketErrorHandler),this.socketErrorHandler=null,this.viewtx.detach(a),this.client.disconnect(),this.panel&&(this.panel.reset(),this.panel.setVisible(!1),this.panel.uninitialize(),this.panel=null),a.toolController.deactivateTool(this.interceptor.getName()),this.interceptor=null,a.modelTools.removeControl(this.collabButton.getId()),this.collabButton=null,!0},f.activate=function(){if(!this.activeStatus){var a=this.viewer,b=new e.CollabPromptBox,c=a.container;b.start(c,function(){this.panel.setVisible(!0,!0)}.bind(this),"Start a Live Review","Start Review"),this.activeStatus=!0}return!0},f.deactivate=function(){return this.activeStatus&&(this.panel.setVisible(!1,!0),this.panel.reset(),this.activeStatus=!1),!0},a.theExtensionManager.registerExtension("Autodesk.Viewing.Collaboration",b.Collaboration.Collaboration)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){function a(a,c,d){this.viewer=a,this.client=c,this.viewtx=d;b.UI.DockingPanel.call(this,a.container,"CollabPanel","Live review"),this.container.classList.add("collabPanel"),this.container.style.height="auto",this.container.dockRight=!0,this.content=document.createElement("div"),this.container.appendChild(this.content),this.content.classList.add("collabPanelContent"),this.tableContainer=document.createElement("div"),this.tableContainer.classList.add("userListTable","docking-panel-scroll"),this.table=document.createElement("table"),this.table.classList.add("adsk-lmv-tftable"),this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.tableContainer.appendChild(this.table),this.content.appendChild(this.tableContainer),this.inviteDiv=document.createElement("div"),this.inviteDiv.className="collabBoxOK",this.inviteDiv.style.float="left",this.inviteDiv.style.width="232px",this.inviteDiv.setAttribute("data-i18n","Invite"),this.inviteDiv.textContent=Autodesk.Viewing.i18n.translate("Invite"),this.content.appendChild(this.inviteDiv),this.inviteDiv.addEventListener("click",function(b){var c=new CollabPromptBox,d=a.container;c.start(d,function(){var a=Autodesk.Viewing.i18n.translate("Please Join My Live Review");document.location.href="mailto:?subject="+a},"Invite Others","Email Invite",!0)}),this.chatHistory=document.createElement("div"),this.chatHistory.classList.add("chatHistory"),this.chatHistory.classList.add("textEntry"),this.chatHistory.classList.add("docking-panel-scroll"),this.content.appendChild(this.chatHistory),this.chatPanel=document.createElement("div"),this.chatPanel.classList.add("chatPanel"),this.textInput=document.createElement("input"),this.textInput.type="text",this.textInput.classList.add("textEntry"),this.textInput.placeholder=Autodesk.Viewing.i18n.translate("Type a message"),this.chatPanel.appendChild(this.textInput),this.content.appendChild(this.chatPanel),this.isCameraConnected=!0;var e=this;this.addEventListener(c,"userListChange",function(a){if(!a.channelId||a.channelId===e.viewtx.channelId){var b=e.client.getChannelInfo(e.viewtx.channelId);b&&e.updateUsers(b.users)}}),this.addEventListener(this.viewtx,"controlChange",function(a){a.channelId===e.viewtx.channelId&&e.updateUserInControl(a.data.lastInControl)}),this.addEventListener(c,"chatReceived",function(a){a.channelId===e.viewtx.channelId&&e.updateChatHistory(a)}),this.textInput.onkeyup=function(a){e.handleChatInput(a)}}var b=Autodesk.Viewing,c=b.Extensions,d=b.Private,e=(b.UI,c.Collaboration);Autodesk.Viewing.startLiveReviewSession=function(){e.Panel&&e.Panel.startSession()},Autodesk.Viewing.endLiveReviewSession=function(){e.Panel&&e.Panel.endSession()};a.prototype=Object.create(b.UI.DockingPanel.prototype),a.prototype.constructor=a,a.prototype.startSession=function(){var a=this;if(!this.isVisible()){var b=new CollabPromptBox,c=this.viewer.container;b.start(c,function(){a.setVisible(!0,!0)},"Start a Live Review","Start Review")}},a.prototype.endSession=function(){this.isVisible()&&(this.setVisible(!1,!0),this.reset())},a.prototype.updateUsers=function(a){for(var b=document.createElement("tbody"),c=0;c<a.length;c++){var d=b.insertRow(-1);d.id=a[c].id;var e=d.insertCell(0);e.style.width="14px",e.style.cursor="default";var f=document.createElement("div");f.classList.add("statusBase"),f.classList.add("statusNormal"),f.innerHTML="&#9679",e.appendChild(f);d.insertCell(1).textContent=a[c].name}this.table.replaceChild(b,this.tbody),this.tbody=b,this.fixComponentPlacement()},a.prototype.updateUserInControl=function(a){for(var b=0;b<this.tbody.rows.length;b++){var c=this.tbody.rows[b],d=c.cells[0].childNodes[0];c.id==a?(d.classList.remove("statusNormal"),d.classList.add("statusInControl"),d.innerHTML="&#9784",c.cells[1].style.color="#4CBA36"):(d.classList.remove("statusInControl"),d.classList.add("statusNormal"),d.innerHTML="&#9679",c.cells[1].style.color="#ffffff")}},a.prototype.updateChatHistory=function(a){var b=this.client.getUserById(a.data.from,a.channelId);if("/"!=a.data.msg.charAt(0)){if(this.chatHistory.lastUser!=b.name){var c=document.createElement("p"),d=document.createElement("div");d.classList.add("heading"),d.style.float="left",d.style.fontStyle="normal",d.style.color="#857E7E",d.textContent=b.name,c.appendChild(d);var e=document.createElement("div");e.classList.add("heading"),e.style.textAlign="right",e.style.fontStyle="normal",e.style.color="#857E7E",e.textContent=(new Date).toLocaleTimeString(),c.appendChild(e),this.chatHistory.appendChild(c),this.chatHistory.lastUser=b.name}else{var f=document.createElement("br");this.chatHistory.appendChild(f)}var g=document.createElement("span");g.classList.add("messageText"),g.textContent=a.data.msg,this.chatHistory.appendChild(g),this.chatHistory.scrollTop=this.chatHistory.scrollHeight}},a.prototype.handleChatInput=function(a){13==a.which&&0!=this.textInput.value.length&&(this.client.sendChatMessage(this.textInput.value,this.viewtx.channelId),this.textInput.value="",this.textInput.placeholder="")},a.prototype.fixComponentPlacement=function(a){var b=this.tableContainer.offsetHeight+this.chatPanel.offsetHeight;this.videoPanel?(b+=this.videoPanel.offsetHeight,this.chatHistory.style.height="calc(100% - "+b+"px)"):this.chatHistory.style.height="calc(100% - "+b+"px)"},a.prototype.removeCollabPrompt=function(){var a=document.getElementById("collabBox");a&&(a.style.visibility="hidden",this.viewer.container.removeChild(a))},a.prototype.removeVideoPanel=function(){this.videoPanel&&this.content.removeChild(this.videoPanel),this.videoPanel=null},a.prototype.reset=function(a){if(this.tbody){var b=document.createElement("tbody");this.table.replaceChild(b,this.tbody),this.tbody=b}this.chatHistory.textContent="",this.textInput.value="",this.removeVideoPanel(),this.removeCollabPrompt()},CollabPromptBox=function(){},CollabPromptBox.prototype.start=function(a,b,c,e,f){if(a&&!document.getElementById("collabBox")){var g=document.createElement("div");g.id="collabBox",g.className="collabBox",a.appendChild(g);var h=document.createElement("div");h.className="collabBoxTitle",h.textContent=Autodesk.Viewing.i18n.translate(c,{defaultValue:c}),g.appendChild(h);var i=document.createElement("span");i.className="collabBoxText";var j="Enter your name";f&&(j="Review URL"),i.textContent=Autodesk.Viewing.i18n.translate(j,{defaultValue:j}),g.appendChild(i);var k=document.createElement("span");k.className="collabBoxInputContainer",g.appendChild(k);var l=document.createElement("input");if(l.type="text",l.className="collabBoxInputText",f){var m=window.location.toString();-1==m.indexOf("?")?m+="?invited=true":m+="&invited=true",Autodesk.Viewing.Private.docItemId&&(m+="&itemid="+Autodesk.Viewing.Private.docItemId),m+="&doNotRedirect=true",l.value=m}k.appendChild(l),l.onkeyup=function(c){13==c.keyCode&&(g.style.visibility="hidden",a.removeChild(g),d.setUserName(l.value),b())};var n=document.createElement("div");if(n.className="collabBoxClose",n.innerHTML="&times;",n.addEventListener("click",function(b){g.style.visibility="hidden",a.removeChild(g)}),g.appendChild(n),f){var i=document.createElement("span");i.className="collabBoxText",i.style.marginTop="0px";var j="Copy and send this URL to invite others";i.textContent=Autodesk.Viewing.i18n.translate(j,{defaultValue:j}),g.appendChild(i)}else{var o=document.createElement("div");o.className="collabBoxOK",o.textContent=Autodesk.Viewing.i18n.translate(e,{defaultValue:e}),o.addEventListener("click",function(c){g.style.visibility="hidden",a.removeChild(g),""!==l.value.trim()&&d.setUserName(l.value),b()}),g.appendChild(o)}g.style.visibility="visible",l.focus(),f&&l.select()}},e.DockingCollabPanel=a,e.CollabPromptBox=CollabPromptBox}(),function(){"use strict";function a(a,b,c){return function(){a.isActive(c)?a.deactivate():a.activate(c)}}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.DefaultTools"),c=Autodesk.Viewing,d=c.UI,e=function(a,b){c.Extension.call(this,a,b),this.name="navtools",this.modes=["pan","dolly","freeorbit","orbit","fov","worldup","fittoview"],this.onToolChanged=this.onToolChanged.bind(this),this.onNavigationModeChanged=this.onNavigationModeChanged.bind(this)};e.prototype=Object.create(c.Extension.prototype),e.prototype.constructor=e;var f=e.prototype;f.load=function(){var a=this.viewer,b=new c.FovTool(a),d=new c.WorldUpTool(a.impl,a);return a.toolController.registerTool(b),a.toolController.registerTool(d),this.createUI(this.viewer.model.is3d()),this.initFocalLengthOverlay(),a.addEventListener(c.TOOL_CHANGE_EVENT,this.onToolChanged),a.addEventListener(c.NAVIGATION_MODE_CHANGED_EVENT,this.onNavigationModeChanged),!0},f.updateUI=function(a){a!==this.is3d&&(this.destroyUI(),this.createUI(a))},f.createUI=function(b){var e=this.viewer,f=e.getToolbar(!0),g=f.getControl(c.TOOLBAR.NAVTOOLSID),h=function(a){return e.navigation.isActionEnabled(a)?"block":"none"};if(b){var i=new d.ComboButton("toolbar-orbitTools");i.setToolTip("Orbit"),i.setIcon("adsk-icon-orbit-constrained"),i.setDisplay(h("orbit")),this.createOrbitSubmenu(i),g.addControl(i),g.orbittoolsbutton=i,i.setState(d.Button.State.ACTIVE),g.returnToDefault=function(){i.setState(d.Button.State.ACTIVE)}}var j=new d.Button("toolbar-panTool");j.setToolTip("Pan"),j.setIcon("adsk-icon-pan"),j.onClick=a(this,j,"pan"),j.setDisplay(h("pan")),g.addControl(j),g.panbutton=j,b||(g.returnToDefault=function(){j.setState(d.Button.State.ACTIVE)},g.returnToDefault());var k=new d.Button("toolbar-zoomTool");k.setToolTip("Zoom"),k.setIcon("adsk-icon-zoom"),k.onClick=a(this,k,"dolly"),k.setDisplay(h("zoom")),g.addControl(k),g.dollybutton=k;var l=new d.ComboButton("toolbar-cameraSubmenuTool");l.setToolTip("Camera interactions"),l.setIcon("adsk-icon-camera"),l.saveAsDefault(),this.createCameraSubmenu(l,b),g.addControl(l),g.camerabutton=l,this.is3d=b},f.createOrbitSubmenu=function(b){var e=this.viewer,f=e.getToolbar(!0),g=f.getControl(c.TOOLBAR.NAVTOOLSID),h=new d.Button("toolbar-freeOrbitTool");h.setToolTip("Free orbit"),h.setIcon("adsk-icon-orbit-free"),h.onClick=a(this,h,"freeorbit"),b.addControl(h),g.freeorbitbutton=h;var i=new d.Button("toolbar-orbitTool");i.setToolTip("Orbit"),i.setIcon("adsk-icon-orbit-constrained"),i.onClick=a(this,i,"orbit"),b.addControl(i),g.orbitbutton=i,b.onClick=i.onClick},f.createCameraSubmenu=function(b,e){var f=this,g=this.viewer,h=g.getToolbar(!0),i=h.getControl(c.TOOLBAR.NAVTOOLSID),j=function(a){return g.navigation.isActionEnabled(a)?"block":"none"};if(c.isTouchDevice()){var k=new d.Button("toolbar-homeTool");k.setToolTip("Home"),k.setIcon("adsk-icon-home"),k.onClick=function(){g.navigation.setRequestHomeView(!0);var a=g.getDefaultNavigationToolName();f.activate(a),b.restoreDefault()},k.setDisplay(j("gotoview")),b.addControl(k),i.homebutton=k}var l=new d.Button("toolbar-fitToViewTool");if(l.setToolTip("Fit to view"),l.setIcon("adsk-icon-fit-to-view"),l.onClick=function(a){g.impl.fitToView(g.impl.selector.getAggregateSelection());var c=g.getDefaultNavigationToolName();g.setActiveNavigationTool(c),b.restoreDefault()},l.setDisplay(j("gotoview")),b.addControl(l),i.fittoviewbutton=l,e){var m=new d.Button("toolbar-focalLengthTool");m.setToolTip("Focal length"),m.setIcon("adsk-icon-fov"),m.onClick=a(this,m,"fov"),m.setDisplay(j("fov")),b.addControl(m),i.fovbutton=m}var n=new d.Button("toolbar-rollTool");n.setToolTip("Roll"),n.setIcon("adsk-icon-roll"),n.onClick=a(this,n,"worldup"),n.setDisplay(j("roll")),b.addControl(n),i.rollbutton=n},f.onToolChanged=function(a){if("fov"===a.toolName&&this.showFocalLengthOverlay(a.active),a.active)switch(a.toolName){case"dolly":this.handleAltRelease("dollybutton");break;case"pan":this.handleAltRelease("panbutton");break;case"worldup":
this.handleAltRelease("rollbutton");break;case"fov":this.handleAltRelease("fovbutton")}},f.onNavigationModeChanged=function(a){if(this.viewer.getDefaultNavigationToolName()===a.id){var b=this.viewer.getToolbar();if(!b)return;var d=b.getControl(c.TOOLBAR.NAVTOOLSID);if(!d)return;d.returnToDefault&&d.returnToDefault()}},f.handleAltRelease=function(a){var b=this.viewer.getToolbar();if(b){var e=b.getControl(c.TOOLBAR.NAVTOOLSID),f=e&&e[a];f&&f.setState(d.Button.State.ACTIVE)}},f.initFocalLengthOverlay=function(){var a=this.focallength=document.createElement("div");a.classList.add("message-panel"),a.classList.add("docking-panel"),a.classList.add("focal-length"),a.classList.add("docking-panel-container-solid-color-b");var b=document.createElement("table"),c=document.createElement("tbody");b.appendChild(c),a.appendChild(b),this.viewer.container.appendChild(a);var d=c.insertRow(-1),e=d.insertCell(0);e.classList.add("name"),e.setAttribute("data-i18n","Focal Length"),e.textContent=Autodesk.Viewing.i18n.translate("Focal Length"),e=d.insertCell(1),e.classList.add("value"),e.textContent="",this.fovCell=e,a.style.visibility="hidden"},f.showFocalLengthOverlay=function(a){function b(a){if(a){var b={msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic",messageDefaultValue:"The view is set to Orthographic. Changing the focal length will switch to Perspective."};c.Private.HudMessage.displayMessage(h.container,b)}else c.Private.HudMessage.dismiss()}function d(a){a&&e(),g.focallength&&(g.focallength.style.visibility=a?"visible":"hidden")}function e(){var a=h.getFocalLength();i!==a&&(i=a,g.fovCell.textContent=a.toString()+" mm")}function f(a){if(e(),"fov"===h.toolController.getActiveToolName()){var c=h.navigation.getCamera(),f=c&&!c.isPerspective;d(!f),b(f)}}var g=this,h=this.viewer,i=0,j=h.navigation.getCamera(),k=j&&!j.isPerspective;d(a&&!k),b(a&&k),a?h.addEventListener(c.CAMERA_CHANGE_EVENT,f):h.removeEventListener(c.CAMERA_CHANGE_EVENT,f)},f.unload=function(){return this.destroyUI(),!0},f.destroyUI=function(){var a=this.viewer,b=a.getToolbar(!1);if(!b)return!0;var e=b.getControl(c.TOOLBAR.NAVTOOLSID);return!e||(this.is3d&&(e.orbittoolsbutton.subMenu.removeEventListener(d.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,e.orbittoolsbutton.subMenuActiveButtonChangedHandler(e)),e.removeControl(e.orbittoolsbutton.getId()),e.orbittoolsbutton=null,e.orbitbutton.onClick=null,e.orbitbutton=null,e.freeorbitbutton.onClick=null,e.freeorbitbutton=null,e.fovbutton.onClick=null,e.fovbutton=null),e.removeControl(e.panbutton.getId()),e.panbutton.onClick=null,e.panbutton=null,e.removeControl(e.dollybutton.getId()),e.dollybutton.onClick=null,e.dollybutton=null,e.camerabutton.subMenu.removeEventListener(d.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,e.camerabutton.subMenuActiveButtonChangedHandler(e)),e.removeControl(e.camerabutton.getId()),e.camerabutton.onClick=null,e.camerabutton=null,e.rollbutton.onClick=null,e.rollbutton=null,e.removeControl(e.fittoviewbutton.getId()),e.fittoviewbutton.onClick=null,e.fittoviewbutton=null,a.container.removeChild(this.focallength),this.focallength=null,a.removeEventListener(c.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.toolChangedHandler=null,a.removeEventListener(c.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler),this.navChangedHandler=null,!0)},f.activate=function(a){return!this.isActive(a)&&("fittoview"===a?(this.viewer.impl.fitToView(this.viewer.impl.selector.getAggregateSelection()),!0):-1!=this.modes.indexOf(a)&&(this.viewer.setActiveNavigationTool(a),!0))},f.deactivate=function(){return this.viewer.setActiveNavigationTool(),!0},f.isActive=function(a){return this.viewer.getActiveNavigationTool()===a},Autodesk.Viewing.Extensions.NavToolsExtension=e,b.NavToolsExtension=e,c.theExtensionManager.registerExtension("Autodesk.DefaultTools.NavTools",e)}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.FusionOrbit");var a=Autodesk.Viewing,b=a.UI,c=a.Extensions.FusionOrbit,d=function(b,c){a.Extension.call(this,b,c),this.name="fusionorbit",this.modes=["fusionorbit","fusionfreeorbit"]};d.prototype=Object.create(a.Extension.prototype),d.prototype.constructor=d;var e=d.prototype;e.load=function(){function b(){e.removeEventListener(a.TOOLBAR_CREATED_EVENT,b),d.createUI()}var d=this,e=this.viewer,f=e.getToolbar?e.getToolbar(!0):void 0;if(this.tool=new c.FusionOrbitTool,this.tool.setViewer(e),e.toolController.registerTool(this.tool),f){var g=f.getControl(a.TOOLBAR.NAVTOOLSID);g&&g.getNumberOfControls()>0?b():e.addEventListener(a.TOOLBAR_CREATED_EVENT,b)}else e.addEventListener(a.TOOLBAR_CREATED_EVENT,b);return!0},e.createUI=function(){var c=this,d=this.viewer,e=d.getToolbar(!1),f=e.getControl(a.TOOLBAR.NAVTOOLSID);this.classicBehavior={},this.classicBehavior.orbitOnClick=f.orbitbutton.onClick,this.classicBehavior.freeorbitOnClick=f.freeorbitbutton.onClick,this.classicBehavior.returnToDefault=f.returnToDefault,f.freeorbitbutton.onClick=function(a){var d=f.freeorbitbutton.getState();d===b.Button.State.INACTIVE?(c.activate("fusionfreeorbit"),f.freeorbitbutton.setState(b.Button.State.ACTIVE)):d===b.Button.State.ACTIVE&&(c.deactivate(),f.freeorbitbutton.setState(b.Button.State.INACTIVE))},f.orbitbutton.onClick=function(a){var d=f.orbitbutton.getState();d===b.Button.State.INACTIVE?(c.activate("fusionorbit"),f.orbitbutton.setState(b.Button.State.ACTIVE)):d===b.Button.State.ACTIVE&&c.deactivate()},f.returnToDefault=function(){f.orbittoolsbutton&&f.orbittoolsbutton.setState(b.Button.State.ACTIVE)},f.orbittoolsbutton.setState(b.Button.State.INACTIVE),d.prefs.fusionOrbitConstrained?(f.orbittoolsbutton.onClick=f.orbitbutton.onClick,f.orbittoolsbutton.setIcon(f.orbitbutton.iconClass),d.setDefaultNavigationTool("orbit")):(f.orbittoolsbutton.onClick=f.freeorbitbutton.onClick,f.orbittoolsbutton.setIcon(f.freeorbitbutton.iconClass),d.setDefaultNavigationTool("freeorbit")),d.setActiveNavigationTool(),f.returnToDefault&&f.returnToDefault()},e.unload=function(){var c=this.viewer,d=c.getToolbar(!1),e=d.getControl(a.TOOLBAR.NAVTOOLSID);return e&&(e.orbitbutton&&(e.orbitbutton.onClick=this.classicBehavior.orbitOnClick),e.freeorbitbutton&&(e.freeorbitbutton.onClick=this.classicBehavior.freeorbitOnClick),e.returnToDefault=this.classicBehavior.returnToDefault,e.orbittoolsbutton&&(e.orbitbutton?e.orbittoolsbutton.onClick=e.orbitbutton.onClick:e.orbittoolsbutton.onClick=null,e.orbittoolsbutton.setIcon("adsk-icon-orbit-constrained"),e.orbittoolsbutton.setState(b.Button.State.ACTIVE))),c.setActiveNavigationTool("orbit"),c.setDefaultNavigationTool("orbit"),c.toolController.deregisterTool(this.tool),this.tool.setViewer(null),this.tool=null,!0},e.activate=function(a){if(!this.activeStatus||this.mode!==a){switch(a){default:case"fusionorbit":this.viewer.setActiveNavigationTool("fusion orbit constrained"),this.mode="fusionorbit";break;case"fusionfreeorbit":this.viewer.setActiveNavigationTool("fusion orbit"),this.mode="fusionfreeorbit"}return this.activeStatus=!0,!0}},e.deactivate=function(){return this.activeStatus&&(this.viewer.setActiveNavigationTool(),this.activeStatus=!1),!0},c.FusionOrbitExtension=d,a.theExtensionManager.registerExtension("Autodesk.Viewing.FusionOrbit",d)}(),Autodesk.Viewing.Extensions.FusionOrbit.html=['<div class="orbit-gizmo noselect">','<div class="outside"></div>','<div class="ring"></div>','<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="layout-mid">','<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="circle">','<div class="crosshair-area">','<div class="crosshair-v"></div>','<div class="crosshair-h"></div>',"</div>","</div>",'<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>",'<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>"].join("\n"),Autodesk.Viewing.Extensions.FusionOrbit.FusionOrbitTool=function(){var a,b,c,d,e,f=Autodesk.Viewing,g=Autodesk.Viewing.Private,h=["fusion orbit","fusion orbit constrained"],i={HORIZONTAL:0,VERTICAL:1,ROLL:2},j={HORIZONTAL:.005,VERTICAL:.005,ROLL:1},k={},l=f.isTouchDevice(),m=!1,n={buttons:[],src:void 0,x:0,y:0,dx:0,dy:0,firstMove:!0,mode:void 0},o=this;this.setViewer=function(a){this.viewer=a,this.navapi=a?a.navigation:null};var p=function(a){n.buttons[a.touches?0:a.button]=!0,n.src=a.target.className,n.x=0,n.y=0,n.dx=0,n.dy=0,n.firstMove=!0,n.mode=void 0,"ring"===n.src?n.mode=i.ROLL:"edgemark-area"===n.src&&("layout-ver"===a.target.parentNode.className?n.mode=i.HORIZONTAL:"layout-hor"===a.target.parentNode.className&&(n.mode=i.VERTICAL)),w(),a.stopPropagation()},q=function(a){n.buttons[a.touches?0:a.button]=!1,n.src=void 0},r=function(a){n.buttons[0]&&(s(a),t(),n.firstMove=!1)},s=function(a){var b=a.touches?a.touches[0].pageX:a.pageX,c=a.touches?a.touches[0].pageY:a.pageY;n.firstMove||(n.dx=b-n.x,n.dy=c-n.y),n.x=b,n.y=c},t=function(){switch(n.mode){case i.ROLL:if(!o.navapi.isActionEnabled("roll"))return;break;case i.HORIZONTAL:case i.VERTICAL:if(!o.navapi.isActionEnabled("orbit"))return}var a=e.target.clone().sub(e.position).normalize(),b=a.clone().cross(e.up).normalize(),c=b.clone().cross(a).normalize();if(e.up.copy(c),n.mode===i.ROLL){var f=new THREE.Vector3(n.x-k.center.x,n.y-k.center.y,0),g=new THREE.Vector3(n.dx,n.dy,0).add(f);f.normalize(),g.normalize();var h=f.clone().cross(g),l=Math.asin(h.z);e.up.applyAxisAngle(a,-l*j.ROLL)}else{var m,p;n.mode===i.HORIZONTAL?(p=-n.dx*j.HORIZONTAL,d&&(e.up=Autodesk.Viewing.Navigation.snapToAxis(e.up.clone())),m=e.up):n.mode===i.VERTICAL&&(p=-n.dy*j.VERTICAL,d?(n.firstMove&&(e.up=Autodesk.Viewing.Navigation.snapToAxis(e.up.clone())),m=a.clone().cross(e.up).normalize()):m=b,e.up.applyAxisAngle(m,p));var q=o.navapi.getPivotPoint(),r=e.position.clone().sub(q);r.applyAxisAngle(m,p),e.position.addVectors(q,r);var s=e.target.clone().sub(q);s.applyAxisAngle(m,p),e.target.addVectors(q,s)}e.dirty=!0},u=function(){var a=e.target.clone().sub(e.position).normalize(),b=o.viewer.impl.rayIntersect(new THREE.Ray(e.position,a));return b&&b.intersectPoint?b.intersectPoint:e.target},v=function(a,b){var c=b||a.clone().sub(e.position).normalize();return new THREE.Plane(c,-c.x*a.x-c.y*a.y-c.z*a.z)},w=function(){var a=e.target.clone().sub(e.position).normalize(),b=v(e.position,a),c=b.distanceToPoint(e.pivot);e.pivot.copy(a).multiplyScalar(c).add(e.position)},x=function(a){a.touches||0!==a.button||w()},y=function(a){m&&o.viewer.setActiveNavigationTool()},z=function(a,b){var c,d=o.viewer.impl.hitTest(a,b);if(d&&d.intersectPoint)c=d.intersectPoint;else{c=o.viewer.impl.viewportToRay(o.viewer.impl.clientToViewport(a,b)).intersectPlane(v(e.target))}var f=e.position.clone().sub(u()).add(c);o.navapi.setRequestTransition(!0,f,c,e.fov)};this.register=function(){a=g.stringToDOM(Autodesk.Viewing.Extensions.FusionOrbit.html),a.style.display="none",this.viewer.canvasWrap.insertBefore(a,this.viewer.canvasWrap.firstChild),b=a.querySelector(".ring"),b.addEventListener("mousedown",p),Array.prototype.forEach.call(a.querySelectorAll(".edgemark-area"),function(a,b){a.addEventListener("mousedown",p),l&&a.addEventListener("touchstart",p)}),window.addEventListener("mouseup",q),window.addEventListener("mousemove",r),c=a.querySelector(".outside"),c.addEventListener("mousedown",y);var d=a.querySelector(".circle");d.addEventListener("mousedown",x),l&&(b.addEventListener("touchstart",p),window.addEventListener("touchend",q),window.addEventListener("touchmove",r),c.addEventListener("touchstart",y),d.addEventListener("touchstart",x)),e=this.viewer.impl.camera},this.deregister=function(){window.removeEventListener("mouseup",q),window.removeEventListener("mousemove",r),c.removeEventListener("mousedown",y),l&&(window.removeEventListener("touchend",q),window.removeEventListener("touchmove",r),c.removeEventListener("touchstart",y)),this.viewer.canvasWrap.removeChild(a),a=void 0,b=void 0,c=void 0},this.activate=function(b){a.style.display="",this.handleResize(),d="fusion orbit constrained"===b;var c=this.viewer.toolController.isToolActivated("hyperlink");c&&this.viewer.toolController.deactivateTool("hyperlink"),d?(this.viewer.setDefaultNavigationTool("orbit"),this.viewer.prefs.set("fusionOrbitConstrained",!0)):(this.viewer.setDefaultNavigationTool("freeorbit"),this.viewer.prefs.set("fusionOrbitConstrained",!1)),c&&this.viewer.toolController.activateTool("hyperlink"),this.viewer.navigation.setZoomTowardsPivot(!0)},this.deactivate=function(b){a.style.display="none",this.viewer.navigation.setZoomTowardsPivot(this.viewer.prefs.zoomTowardsPivot)},this.getNames=function(){return h},this.getName=function(){return h[0]},this.update=function(){return!1},this.handleSingleClick=function(a,b){return z(a.canvasX,a.canvasY),!0},this.handleDoubleClick=function(a,b){return!0},this.handleSingleTap=function(a){return z(a.canvasX,a.canvasY),!0},this.handleDoubleTap=function(a){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){return!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(a){var b,d=this.viewer.impl.getCanvasBoundingClientRect();b=d.width>d.height?new THREE.Vector2(((a.canvasX+.5)/d.width*2-1)*d.width/d.height,-(a.canvasY+.5)/d.height*2+1):new THREE.Vector2((a.canvasX+.5)/d.width*2-1,(-(a.canvasY+.5)/d.height*2+1)*d.height/d.width);var e=b.length(),f=e>1.2;return m!==f&&(c.style.cursor=f?"":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto",m=f),!1},this.handleGesture=function(a){return w(),!1},this.handleBlur=function(a){return!1},this.handleResize=function(){var c=a.getBoundingClientRect();k.left=c.left+window.pageXOffset,k.top=c.top+window.pageYOffset,k.width=c.width,k.height=c.height,k.center={},k.center.x=k.left+k.width/2,k.center.y=k.top+k.height/2;var d=.8*(window.innerWidth>window.innerHeight?window.innerHeight:window.innerWidth);a.style.width=a.style.height=d+"px",a.style.top=a.style.left="calc(50% - "+d/2+"px)",b.style.borderWidth=.1*d+"px"}},function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim");var a=function(){function a(){var a=this;a.SimulationStudies={LSS:"SimCaseLSS",MODAL:"SimCaseModalFrequencies",BUCKLING:"SimCaseStructuralBuckling",THERMAL:"SimCaseThermalSteady",THERMALSTRESS:"SimCaseThermalStress",SHAPEGENERATOR:"SimCaseTopOpt",NAMES:{UNKNOWN:"Unknown",LSS:"Static Stress",MODAL:"Modal Frequencies",BUCKLING:"Structural Buckling",THERMAL:"Thermal",THERMALSTRESS:"Thermal Stress",SHAPEGENERATOR:"Shape Optimization"}},a.studyNode,a.loadCases={},a.pointMasssesNode=-1,a.pointMassNodes=[],a.connectorsNode=-1,a.connectorNodes=[],a.activeLoadCaseKey=null,a.modelNodes=[],a.analysisType=a.SimulationStudies.LSS,a.modelStructurePanel=null,a.simExt=null,a.simNodes=[]}a.prototype={constructor:a};var b=a.prototype;return b.studyName=function(){var a=this.SimulationStudies.NAMES.UNKNOWN;return this.analysisType===this.SimulationStudies.LSS?a=this.SimulationStudies.NAMES.LSS:this.analysisType===this.SimulationStudies.MODAL?a=this.SimulationStudies.NAMES.MODAL:this.analysisType===this.SimulationStudies.BUCKLING?a=this.SimulationStudies.NAMES.BUCKLING:this.analysisType===this.SimulationStudies.THERMAL?a=this.SimulationStudies.NAMES.THERMAL:this.analysisType===this.SimulationStudies.THERMALSTRESS?a=this.SimulationStudies.NAMES.THERMALSTRESS:this.analysisType===this.SimulationStudies.SHAPEGENERATOR&&(a=this.SimulationStudies.NAMES.SHAPEGENERATOR),a},b.reset=function(){var a=this;a.studyNode=-1,a.modelNodes=[],a.analysisType=a.SimulationStudies.LSS,a.loadCases={},a.pointMasssesNode=-1,a.pointMassNodes=[],a.connectorsNode=-1,a.connectorNodes=[],a.activeLoadCaseKey=null,a.simNodes=[],a.modelStructurePanel=null},b.addLoadCase=function(a,b,c){var d=this,e=new aves.Fusion360Sim.SimulationLoadCaseDef;return e.loadCase=c,e.loadCaseName=a,d.loadCases["SIM_LOAD_CASE"+b]=e,1===Object.keys(d.loadCases).length&&(d.activeLoadCaseKey="SIM_LOAD_CASE"+b),e},b.shouldDisplayInTree=function(a){var b=this,c=a.dbId;if(b.simNodes.indexOf(c)<0)return!1;if(b.studyNode===c)return!0;if(null===b.activeLoadCaseKey)return!1;if(b.pointMasssesNode===c)return!0;if(-1!==b.pointMassNodes.indexOf(c))return!0;if(-1!==b.connectorNodes.indexOf(c))return!0;if(b.connectorsNode===c)return!0;for(var d=Object.keys(b.loadCases),e=0;e<d.length;e++){var f=b.loadCases[d[e]];if(f.isImportant(c))return f.shouldDisplayInTree(c)}return!1},a}();Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef=a;var b=function(){function a(){var a=this;a.loadCase=-1,a.loadCaseName="",a.constraintsNode=-1,a.constraintNodes=[],a.loadsNode=-1,a.loadNodes=[],a.resultsNode=-1,a.undeformedResults=-1,a.resultTypes={},a.resultGroups={},a.modalResults={}}a.prototype={constructor:a};var b=a.prototype;return b.associateResult=function(a,b){this.resultTypes[b]=a},b.associateResultGroup=function(a,b){this.resultGroups[b]=a},b.associateModalResult=function(a,b){var c=[];if(c=this.modalResults[a])c.push(b);else{var d=[];d.push(b),c=d}this.modalResults[a]=c},b.isImportant=function(a){var b=this;return b.loadCase===a||(-1!==b.loadNodes.indexOf(a)||(-1!==b.constraintNodes.indexOf(a)||(b.resultsNode===a||(b.constraintsNode===a||b.loadsNode===a))))},b.shouldDisplayInTree=function(a){var b=this;return b.loadCase===a||(-1!==b.loadNodes.indexOf(a)||(-1!==b.constraintNodes.indexOf(a)||b.resultsNode!==a&&(b.constraintsNode===a||b.loadsNode===a)))},b.reset=function(){var a=this;a.constraintsNode=-1,a.constraintNodes=[],a.loadsNode=-1,a.loadNodes=[],a.resultsNode=-1,a.undeformedResults=-1,a.resultTypes={},a.resultGroups={},a.modalResults={}},a}();Autodesk.Viewing.Extensions.Fusion360Sim.SimulationLoadCaseDef=b}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim");var a=Autodesk.Viewing,b=(a.Extension,a.Extensions),c=a.UI,d=a.i18n,e=function(){function e(a,b){if(a&&b){var c=a.style.cssText.trim();";"===c.substring(c.length-1)||(c+=";");var d=[];for(var e in b)d[d.length]=[e,b[e]].join(":");d=d.join(";"),a.style.cssText=d}}function f(){var a,b,e,f,g,h,i,j,k,l,m,n,o=this;c.DockingPanel.prototype.initialize.call(o);var p=o.container;p.classList.add("property-panel","simulation-container","position-"+(o.position||"left")+"-corner"),p.dockRight=!0,f=o.legend=document.createElement("div");var q=document.createDocumentFragment(),r=document.createElement("div");r.classList.add("sim-div-Results"),e=o.resultsGroup=document.createElement("select"),e.classList.add("simulation-resultGroup"),r.appendChild(e),g=o.resultTypes=document.createElement("select"),g.classList.add("simulation-resultTypes"),r.appendChild(g),q.appendChild(r);var s=document.createElement("div");s.classList.add("sim-div-options"),b=o.optUndeformed=document.createElement("input"),b.classList.add("sim-undeformedOption"),b.setAttribute("type","checkbox"),b.setAttribute("name","optUndeformed"),b.setAttribute("id","Undeformed"),b.addEventListener("change",function(a){var b=o.simDef.loadCases[o.simDef.activeLoadCaseKey];null!==b&&-1!==b.undeformedResults&&(o.optUndeformed.checked?o.viewer.show(b.undeformedResults):o.viewer.hide(b.undeformedResults))}),b.checked=!1,s.appendChild(b),b.checked=!1,a=o.labelUndeformed=document.createElement("label"),a.classList.add("sim-undeformedOptionText"),a.htmlFor="Undeformed",a.setAttribute("data-i18n","Show Undeformed Model"),a.textContent=d.translate("Show Undeformed Model"),s.appendChild(a),q.appendChild(s),h=o.divColorScale=document.createElement("div"),h.classList.add("sim-div-colorscale"),h.classList.add("sim-div-colorscale-top1"),i=o.colorScale=document.createElement("div"),i.classList.add("simulation-colorscale"),h.appendChild(i),j=o.colorScaleTopText=document.createElement("div"),j.classList.add("sim-colorScaleTopText"),j.innerHTML="- 3333",h.appendChild(j),k=o.colorScaleBottomText=document.createElement("div"),k.classList.add("sim-colorScaleBottomText"),k.innerHTML="- 3333",h.appendChild(k),q.appendChild(h),l=o.line2=document.createElement("hr"),l.classList.add("sim-line2"),q.appendChild(l);var t=document.createElement("div");t.classList.add("sim-div-Table"),t.addEventListener("click",function(a){t.classList.add("sim-div-Table-Collapse"),p.classList.add("simulation-container-Collapse"),h.classList.add("sim-div-colorscale-Collapse")}),h.addEventListener("click",function(a){t.classList.remove("sim-div-Table-Collapse"),p.classList.remove("simulation-container-Collapse"),h.classList.remove("sim-div-colorscale-Collapse")}),m=o.tbl=document.createElement("table"),n=o.tblBody=document.createElement("tbody"),m.appendChild(n),m.classList.add("sim-table"),t.appendChild(m),q.appendChild(t),f.appendChild(q),p.appendChild(f)}function g(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(d.displayName===b)return d.displayValue}return null}function h(a,b){var c=!1,d='""';b<=1&&(c=!0,d="none"),a.disabled=c,e(a,{"-webkit-appearance":d,"-moz-appearance":d,appearance:d})}function i(a,b){var d=this;b=b||{},d.viewer=a,d.simDef=null,c.DockingPanel.call(d,a.container,"Simulation-Panel","Simulation Results"),d.position=b.position||"right"}i.prototype=Object.create(c.DockingPanel.prototype);var j=i.prototype;return j.constructor=i,j.initialize=function(){var a=this;f.call(a),a.resultsGroup.addEventListener("change",function(b){var c=a.simDef,d=c.loadCases[a.simDef.activeLoadCaseKey];a.viewer.hide(d.resultsNode);var e="fillResultTypes";c.modalAnalysis&&(e="fillModalResultTypes"),a[e](c.activeLoadCaseKey,a.resultsGroup.value),setTimeout(function(){a.setSimObjectsVisibility()},100)}),a.resultTypes.addEventListener("change",function(){var b=a.simDef.loadCases[a.simDef.activeLoadCaseKey];a.viewer.hide(b.resultsNode),a.setSimObjectsVisibility()})},j.setSimulationDef=function(a){function b(a){var b=g(a.properties,"Name");k.setTitle(b)}function c(a,b,c){}function e(a){var b=g(a.properties,"Elements"),c=g(a.properties,"Nodes");k.rowElements.cells[1].innerText=b,k.rowNodes.cells[1].innerText=c}var f,h,i,j,k=this;if(k.simDef=a,f=1*a.studyNode,-1===a.undeformedResults&&(k.optUndeformed.classList.add("sim-hide"),k.labelUndeformed.classList.add("sim-hide"),k.divColorScale.classList.remove("sim-div-colorscale-top1"),k.divColorScale.classList.add("sim-div-colorscale-top2")),k.viewer.getProperties(f,b,c),h=d.translate(a.studyName()),i=k.tblBody,k.rowType)k.rowType.cells[1].innerHTML=h;else{[{name:"rowType",content:[d.translate("Analysis Type"),h]},{name:"rowNodes",content:[d.translate("Nodes"),"1872"]},{name:"rowElements",content:[d.translate("Elements"),"1084"]},{name:"rowMin",content:[d.translate("Min"),"0.000E+02 MPa"]},{name:"rowMax",content:[d.translate("Max"),"5.117E+02 MPa"]}].forEach(function(a){k[a.name]=i.insertRow(-1),a.content.forEach(function(b){k[a.name].insertCell(-1).innerHTML=b})})}j=k.viewer,j.model.getObjectTree(function(b){k.instanceTree=b,k.fillResultsGroup(k.simDef.activeLoadCaseKey);var c=a.analysisType===a.SimulationStudies.MODAL||a.analysisType===a.SimulationStudies.BUCKLING?"fillModalResultTypes":"fillResultTypes";k[c](k.simDef.activeLoadCaseKey,k.resultsGroup.value),setTimeout(function(){a.simExt.showResultsDlg(!0),a.simExt.applySettings(),k.setSimObjectsVisibility()},500)});var l=+k.simDef.resultsNode;j.getProperties(l,e,c)},j.processNodes=function(a,c){function e(a,b){function c(c){var e=c.properties,f=g(c.properties,"A1C6011B-E1A6-4ADF-975D-A0003C592F87");if(f){switch(f){case"SIM_STUDY":j.studyNode=a;var h=g(c.properties,"Study Type");j.analysisType=h;break;case"SIM_POINT_MASSES":j.pointMasssesNode=a;break;case"SIM_POINT_MASS":j.pointMassNodes.push(a);break;case"SIM_CONNECTORS":j.connectorsNode=a;break;case"SIM_CONNECTOR":j.connectorNodes.push(a);break;case"SIM_LOAD_CASE":l=j.addLoadCase(g(c.properties,"Name"),a,a);break;case"SIM_CONSTRAINTS":null==l&&(l=j.addLoadCase(d.translate("Load Case:1"),0,0)),l.constraintsNode=a;break;case"SIM_CONSTRAINT":l.constraintNodes.push(a);break;case"SIM_LOADS":null==l&&(l=j.addLoadCase(d.translate("Load Case:1"),0,0)),l.loadsNode=a;break;case"SIM_LOAD":l.loadNodes.push(a);break;case"SIM_RESULTS_SCALAR_PLOT":null==l&&(l=j.addLoadCase(d.translate("Load Case:1"),0,0)),j.analysisType===j.SimulationStudies.LSS||j.analysisType===j.SimulationStudies.THERMAL||j.analysisType===j.SimulationStudies.THERMALSTRESS||j.analysisType===j.SimulationStudies.SHAPEGENERATOR?l.associateResult(g(e,"Name"),a):l.associateModalResult(g(e,"Name"),a);break;case"SIM_RESULTS_GROUP":null==l&&(l=j.addLoadCase(d.translate("Load Case:1"),0,0)),j.analysisType!==j.SimulationStudies.LSS&&j.analysisType!==j.SimulationStudies.THERMAL&&j.analysisType!==j.SimulationStudies.THERMALSTRESS&&j.analysisType!==j.SimulationStudies.SHAPEGENERATOR||l.associateResultGroup(g(e,"Name"),a);break;case"SIM_RESULTS":null==l&&(l=j.addLoadCase(d.translate("Load Case:1"),0,0)),l.resultsNode=a;break;case"SIM_RESULTS_UNDEFORMED_FEATURE_EDGES_PLOT":null==l&&(l=j.addLoadCase(d.translate("Load Case:1"),0,0)),l.undeformedResults=a}j.simNodes.push(a)}else j.modelNodes.push(a);b()}function e(a,c,d){b()}a&&k&&k.getProperties(a,c,e)}function f(){i.length>0?e(i.shift(),f):c(j)}var h=this,i=[],j=h.simDef,k=h.viewer,l=null;j?j.reset():j=new b.Fusion360Sim.SimulationDef,a.enumNodeChildren(a.getRootId(),function(a){i[i.length]=a},!0),f()},j.initModel=function(b,c){var d=this;d.viewer&&(d.processNodes(b,function(a){a.simExt=c,d.setSimulationDef(a)}),d.addEventListener(d.viewer,a.SELECTION_CHANGED_EVENT,function(a){var b=a.nodeArray;b&&d.handleClick(b[0])}))},j.fillResultsGroup=function(a){var b=this,c=b.simDef,e=c.loadCases[a],f=b.resultsGroup;f.options.length=0;for(var g=Object.keys(c.analysisType===c.SimulationStudies.MODAL||c.analysisType===c.SimulationStudies.BUCKLING?e.modalResults:e.resultGroups),i=0;i<g.length;i++){var j=document.createElement("option");j.value=g[i];var k=c.analysisType===c.SimulationStudies.MODAL||c.analysisType===c.SimulationStudies.BUCKLING?g[i]:e.resultGroups[g[i]];j.setAttribute("data-i18n",k),j.textContent=d.translate(k),f.add(j)}h(f,f.options.length,!1)},j.fillResultTypes=function(a,b){function c(a,b,c){}function e(a){function b(a){if(g(a.properties,e)===f){var b=document.createElement("option");b.value=a.dbId;var c=l.resultTypes[a.dbId];b.setAttribute("data-i18n",c),b.textContent=d.translate(c),j.add(b),h(j,j.options.length,0===k.options.length)}}for(var e="Result group",f=g(a.properties,e),m=Object.keys(l.resultTypes),n=0;n<m.length;n++){var o=+m[n];i.getProperties(o,b,c)}}var f=this,i=f.viewer,j=f.resultTypes,k=f.resultsGroup,l=f.simDef.loadCases[a];j.options.length=0;var m=+b;i.getProperties(m,e,c)},j.fillModalResultTypes=function(a,b){function c(a){if(g(a.properties,"Result type")===k){var b=document.createElement("option");b.value=a.dbId;var c=g(a.properties,"Mode"),d=c;b.setAttribute("data-i18n",d),b.textContent=d,e.resultTypes.add(b),h(f,f.options.length,0===i.options.length)}}function d(a,b,c){}var e=this,f=e.resultTypes,i=e.resultsGroup,j=e.simDef.loadCases[a];f.options.length=0;for(var k=b,l=j.modalResults[k]||[],m=0;m<l.length;m++){var n=+l[m];e.viewer.getProperties(n,c,d)}},j.uninitialize=function(){c.DockingPanel.prototype.uninitialize.call(this),this.viewer=null},j.setTitle=function(a,b){a||(a="Simulations",b=b||{},b.localizeTitle=!0),c.DockingPanel.prototype.setTitle.call(this,a,b)},j.setModelNodesVisible=function(a){var b=this,c=b.viewer;if(b.simDef){var d=b.simDef.modelNodes;if(d&&d.length>0)for(var e=0;e<d.length;e++)c[a?"show":"hide"](d[e])}},j.setNodeVisibility=function(a,b){this.viewer[b?"show":"hide"](a)},j.isSimStudyNode=function(a){return!!this.simDef.studyNode&&this.simDef.studyNode===a},j.handleClick=function(a){var b=this;if(null===b.simDef)return!1;var c=b.simDef.loadCases[b.simDef.activeLoadCaseKey];if(null===c)return!1;for(var d=Object.keys(b.simDef.loadCases),e=0;e<d.length;e++){var f=b.simDef.loadCases[d[e]];if(f.isImportant(a)&&c!==f){-1!==c.loadsNode&&b.viewer.hide(c.loadsNode),-1!==c.constraintsNode&&b.viewer.hide(c.constraintsNode),-1!==c.undeformedResults&&b.viewer.hide(c.undeformedResults),-1!==c.resultsNode&&b.viewer.hide(c.resultsNode),-1!==b.simDef.connectorsNode&&b.viewer.hide(b.simDef.connectorsNode),b.simDef.activeLoadCaseKey=d[e],b.fillResultsGroup(b.simDef.activeLoadCaseKey);var g=b.simDef.analysisType===b.simDef.SimulationStudies.MODAL||b.simDef.analysisType===b.simDef.SimulationStudies.BUCKLING?"fillModalResultTypes":"fillResultTypes";return b[g](b.simDef.activeLoadCaseKey,b.resultsGroup.value),setTimeout(function(){b.simDef.simExt.showResultsDlg(!0),b.setSimObjectsVisibility()},500),!0}}return!1},j.setSimObjectsVisibility=function(a){function b(a){var b=g(a.properties,"Minimal value"),c=g(a.properties,"Maximal value"),e=g(a.properties,"Scale reversed"),f=g(a.properties,"Unit");d.rowMin.cells[1].innerText=b+" "+f,d.rowMax.cells[1].innerText=c+" "+f;var h=g(a.properties,"Lower referential value"),i=g(a.properties,"Upper referential value");"True"===e?(d.colorScale.style.transform="rotate(90deg)",d.colorScale.style.moztransform="rotate(90deg)",d.colorScale.style.webkittransform="rotate(90deg)"):(d.colorScale.style.transform="rotate(-90deg)",d.colorScale.style.moztransform="rotate(-90deg)",d.colorScale.style.webkittransform="rotate(-90deg)"),d.colorScaleTopText.innerHTML="- "+i+" "+f,d.colorScaleBottomText.innerHTML="- "+h+" "+f}function c(a,b,c){}var d=this,e=d.simDef.loadCases[d.simDef.activeLoadCaseKey];if(!d.resultTypes||0===d.resultTypes.options.length||null===e)return d.setModelNodesVisible(!0),void d.simDef.simExt.showResultsDlg(!1);var f=+d.resultTypes.value;d.setModelNodesVisible(!1),-1!==f&&d.viewer.show(f),-1!==e.loadsNode&&d.viewer.show(e.loadsNode),-1!==e.constraintsNode&&d.viewer.show(e.constraintsNode),d.optUndeformed.checked&&-1!==e.undeformedResults&&d.viewer.show(e.undeformedResults),-1!==d.simDef.connectorsNode&&d.viewer.show(d.simDef.connectorsNode),d.viewer.getProperties(f,b,c)},i}();b.Fusion360Sim.GalleryPanel=e}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel=function(a,b,c){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.call(this,a.viewer,b,c),this.viewer=a.viewer,this.ext=a},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype=Object.create(Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype),Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel,Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.setGallery=function(a){this.simGalleryPanel=a},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.initialize=function(){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.initialize.call(this)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isSimResultsNode=function(a){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.resultsNode)&&this.simGalleryPanel.simDef.resultsNode==a},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isSimStudyNode=function(a){
return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.studyNode)&&this.simGalleryPanel.simDef.studyNode==a},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isModelNode=function(a){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.modelNodes&&0!=this.simGalleryPanel.simDef.modelNodes.length)&&-1!==this.simGalleryPanel.simDef.modelNodes.indexOf(a)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.shouldInclude=function(a){var b=this;if(!b.simGalleryPanel||!b.simGalleryPanel.simDef)return!1;if(b.isModelNode(a))return!0;if(b.isSimStudyNode(a))return!0;for(var c=b.simGalleryPanel.simDef,d=Object.keys(c.loadCases),e=0;e<d.length;e++){if(c.loadCases[d[e]].resultsNode===a)return!1}return!0},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.onClick=function(a,b){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.onClick.call(this,a,b),this.simGalleryPanel.handleClick(a)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.expandStudyNode=function(){this.simGalleryPanel.simDef.studyNode&&this.tree.setCollapsed(this.simGalleryPanel.simDef.studyNode,!1)}}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim");var a=Autodesk.Viewing;a.GEOMETRY_LOAD_START="geometryLoadStarted";var b=function(){function b(b,e){var f=this;e=e||{};for(var g in c)e[g]=e[g]||c[g];a.Extension.call(f,b,e),this.name="fusionsim",b.addEventListener(a.GEOMETRY_LOAD_START,function(a){d&&f.unload(),"Autodesk.Fusion360.Simulation"===a.data.extensions?d=!0:(f.unload(),d=!1)}),b.addEventListener(a.GEOMETRY_LOADED_EVENT,function(a){f.load()})}var c={},d=!1;b.prototype=Object.create(a.Extension.prototype);var e=b.prototype;return e.constructor=b,e.load=function(){var b=this,c=b.viewer;return!c.model||(b.galleryPanel=new a.Extensions.Fusion360Sim.GalleryPanel(b.viewer),b.viewer.addPanel(b.galleryPanel),b.simButton=new a.UI.Button("toolbar-simulation"),b.simButton.setVisible(!1),b.simButton.setToolTip("Simulation Results"),b.simButton.onClick=function(c){var d=b.galleryPanel.isVisible();d?b.deactivate(b.galleryPanel):b.activate(b.galleryPanel),b.simButton.setState(d?a.UI.Button.State.INACTIVE:a.UI.Button.State.ACTIVE)},b.simButton.setIcon("toolbar-simulationIcon"),c.settingsTools.addControl(b.simButton,{index:1}),b.hideLines=c.prefs.get("lineRendering"),b.ghosting=c.prefs.get("ghosting"),b.ambientShadow=c.prefs.get("ambientShadows"),b.antialiazing=c.prefs.get("antialiasing"),b.lightPreset=c.prefs.get("lightPreset"),c.model.getObjectTree(function(a){setTimeout(function(){b.galleryPanel.initModel(a,b),b.initModelBrowser()},100)}),!0)},e.unload=function(){var a=this;if(a.viewer.model)return a.showResultsDlg(!1),a.viewer.settingsTools.removeControl(this.simButton),a.viewer.removePanel(this.galleryPanel),a.galleryPanel.uninitialize(),a.viewer.hideLines(!a.hideLines),a.viewer.setGhosting(a.ghosting),a.viewer.setQualityLevel(a.ambientShadow,a.antialiazing),a.viewer.setLightPreset(a.lightPreset),!0},e.initModelBrowser=function(){var a=this;setTimeout(function(){a.options=a.options||{},a.options.addFooter=!0,a.modelStructurePanel=new Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel(a,"Simulation Model Structure Loading",a.options),a.viewer.setModelStructurePanel(a.modelStructurePanel),a.modelStructurePanel.setGallery(a.galleryPanel)},100)},e.showResultsDlg=function(b){var c=this;c.simButton.setState(b?a.UI.Button.State.ACTIVE:a.UI.Button.State.INACTIVE),c.simButton.setVisible(b),c.galleryPanel.setVisible(b)},e.applySettings=function(){var a=this.viewer;a.hideLines(!1),a.setGhosting(!1),a.setQualityLevel(!1,!0),a.setLightPreset(4)},e.simData=function(){return this.galleryPanel.simDef},e.activate=function(a){return this.activeStatus||(a.setVisible(!0),this.activeStatus=!0),!0},e.deactivate=function(a){return this.activeStatus&&(a.setVisible(!1),this.activeStatus=!1),!0},b}();a.Extensions.Simulation=b,a.theExtensionManager.registerExtension("Autodesk.Fusion360.Simulation",a.Extensions.Simulation)}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a,this.options=b,this.name="explode",this.slider=a.explodeSubmenu.querySelector(".explode-slider"),this.explodeButton=a.modelTools.getControl("toolbar-explodeTool")}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.Explode");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a;var c=a.prototype;c.activate=function(){return this.activeStatus||(this.viewer.explodeSubmenu.style.display="",this.activeStatus=!0),!0},c.deactivate=function(){return this.activeStatus&&(this.slider.parentNode.style.display="none",this.viewer.explode(0),this.viewer.explodeSlider.value=0,this.activeStatus=!1),!0},b.ExplodeExtension=a,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Explode",b.ExplodeExtension)}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a,this.options=b,this.name="fullscreen"}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.FullScreen");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a;var c=a.prototype;c.activate=function(){return this.activeStatus||(this.viewer.nextScreenMode(),this.activeStatus=!0),!0},c.deactivate=function(){return this.activeStatus&&(this.viewer.escapeScreenMode(),this.activeStatus=!1),!0},b.FullScreenExtension=a,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.FullScreen",b.FullScreenExtension)}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a,this.options=b,this.name="gohome"}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.GoHome");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a;var c=a.prototype;c.activate=function(){return this.viewer.navigation.setRequestHomeView(!0),!0},c.deactivate=function(){return!1},b.GoHomeExtension=a,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.GoHome",b.GoHomeExtension)}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a,this.options=b,this.name="layermanager"}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.LayerManager"),c=Autodesk.Viewing.Extensions;a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a;var d=a.prototype;d.activate=function(){return this.activeStatus||(this.viewer.layersPanel||this.viewer.setLayersPanel(new c.ViewerLayersPanel(this.viewer)),this.viewer.showLayerManager(!0),this.activeStatus=!0),!0},d.deactivate=function(){return this.activeStatus&&(this.viewer.layersPanel||this.viewer.setLayersPanel(new c.ViewerLayersPanel(this.viewer)),this.viewer.showLayerManager(!1),this.activeStatus=!1),!0},b.LayerManagerExtension=a,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.LayerManager",b.LayerManagerExtension)}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a,this.options=b,this.name="modelstructure"}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.ModelStructure");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a;var c=a.prototype;c.activate=function(){return this.activeStatus||(this.viewer.showModelStructurePanel(!0),this.activeStatus=!0),!0},c.deactivate=function(){return this.activeStatus&&(this.viewer.showModelStructurePanel(!1),this.activeStatus=!1),!0},b.ModelStructureExtension=a,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.ModelStructure",b.ModelStructureExtension)}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a,this.options=b,this.propertyPanel=this.viewer.getPropertyPanel(!0),this.name="propertiesmanager"}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.PropertiesManager");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a;var c=a.prototype;c.activate=function(){return this.activeStatus||(this.propertyPanel.setVisible(!0),this.activeStatus=!0),!0},c.deactivate=function(){return this.activeStatus&&(this.propertyPanel.setVisible(!1),this.activeStatus=!1),!0},b.PropertiesManagerExtension=a,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.PropertiesManager",b.PropertiesManagerExtension)}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a,this.options=b,this.name="viewersettings"}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.ViewerSettings"),c=Autodesk.Viewing.Extensions;a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a;var d=a.prototype;d.activate=function(){if(!this.activeStatus){this.viewer.showViewer3dOptions(!0);this.viewer.getSettingsPanel(!0).selectTab(c.ViewerSettingTab.Performance),this.activeStatus=!0}return!0},d.deactivate=function(){return this.activeStatus&&(this.viewer.showViewer3dOptions(!1),this.activeStatus=!1),!0},b.ViewerSettingsExtension=a,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.ViewerSettings",b.ViewerSettingsExtension)}();
//# sourceMappingURL=viewer3D.min.js.map